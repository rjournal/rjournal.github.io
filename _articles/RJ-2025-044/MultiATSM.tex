% !TeX root = RJwrapper.tex
\title{MultiATSM: An R Package for Arbitrage-Free Macrofinance Multicountry Affine Term Structure Models}


\author{by Rubens Moura}

\maketitle

\abstract{%
The MultiATSM package provides estimation tools and a wide range of outputs for eight macrofinance affine term structure model (ATSM) classes, supporting practitioners, academics, and policymakers. All models extend the single-country framework of Joslin et al.~(2014) to multicountry settings, with additional adaptations from Jotikasthira et al.~(2015) and Candelon and Moura (2024). These model extensions incorporate, respectively, the presence of a dominant (global) economy and adopt a global vector autoregressive (GVAR) setup to capture the joint dynamics of risk factors. The package generates diverse outputs for each ATSM, including graphical representations of model fit, risk premia, impulse response functions, and forecast error variance decompositions. It also implements bootstrap methods for confidence intervals and produces bond yield forecasts.
}

\section{Introduction}\label{introduction}

The term structure of interest rates (or yield curve) describes the relationship between bond yields and investment maturities. As \citet{Piazzesi2010} emphasizes, understanding its dynamics is essential for several reasons. First, long-term yields incorporate market expectations of future short-term rates, making the yield curve a handy forecasting tool for macroeconomic aggregates like output and inflation. As such, this supports optimal consumption-saving decisions and capital allocation by economic agents. Second, it plays a key role in the transmission of monetary policy, linking short-term policy rates to long-term borrowing costs. Third, it guides fiscal authorities in shaping debt maturities to balance refinancing risk and interest rate exposure. Fourth, it is essential for pricing and hedging interest rate derivatives, which rely on accurate yield curve modelling.

Affine Term Structure Models (ATSMs) are the workhorse in yield curve modelling. Based on the assumption of no arbitrage, ATSMs offer a flexible framework to assess how investors price risks and generate predictions for the price of any bond (see \citet{Piazzesi2010}; \citet{GurkaynakWright2012} for comprehensive reviews). Early ATSMs gained popularity for their ability to capture nearly all term structure fluctuations, appealing to both academics and practitioners \citep{Vasicek1977, DuffieKan1996, DaiSingleton2002}. While these models produce accurate statistical descriptions of the yield curve, they are silent on the deeper economic determinants that policymakers require for causal inference.

In response to this limitation, a large body of research has emerged to explore the interplay between the term structure and macroeconomic developments (seminal contributions include \citet{AngPiazzesi2003} and \citet{RudebuschWu2008}). A prominent contribution in this area is the unspanned economic risk framework developed by \citet{JoslinPriebschSingleton2014} (henceforth JPS, 2014). In essence, this model assumes an arbitrage-free bond market and considers a linear state space representation to describe the dynamics of the yield curve. Compared to earlier macrofinance ATSMs, JPS (2014) offers a tractable estimation approach that integrates traditional yield curve factors (spanned factors) with macroeconomic variables (unspanned factors). As a result, the model delivers a strong cross-sectional fit while explicitly linking bond yield responses to the state of the economy.

The work of JPS (2014) lays the foundational framework for the modelling tools included in the \CRANpkg{MultiATSM} package \citep{MultiATSM2025}. In addition to the original single-country setup proposed by JPS (2014), the package incorporates multicountry extensions developed by \citet{JotikasthiraLeLundblad2015} (henceforth JLL, 2015) and \citet{CandelonMoura2024} (henceforth CM, 2024). Altogether, the package offers functions to build eight types of ATSMs, covering the original versions and several variants of these three frameworks.

Beyond complete routines for model estimation, \CRANpkg{MultiATSM} produces a wide range of analytical outputs. In particular, it generates graphical representations such as model-implied bond yields, bond risk premia, and both orthogonalized and generalized versions of: \emph{(i)} impulse response functions, and \emph{(ii)} forecast error variance decompositions for yields and risk factors. Confidence intervals for the two latter outputs can be computed using three bootstrap methods: residual-based, block, or wild bootstrap. Moreover, the package supports out-of-sample forecasting of bond yields across the maturity spectrum. This paper provides detailed guidance on how to use the \CRANpkg{MultiATSM} package effectively.

There are a few notable packages for term structure modelling in the R programming environment. \CRANpkg{YieldCurve} \citep{YieldCurve2015} and \CRANpkg{fBonds} \citep{fBonds2017} provide a collection of functions to build term structures based on the frameworks of \citet{NelsonSiegel1987} and \citet{Svensson1994}. These yield curve methods have gained popularity for their parsimonious parameterization and good empirical fit. However, these models do not rule out arbitrage opportunities, a limitation addressed by ATSMs. Moreover, the focus of \CRANpkg{YieldCurve} and \CRANpkg{fBonds} is restricted to parameter estimation and yield curve fitting, without offering additional model outputs such as those provided by \CRANpkg{MultiATSM}.

Several other R packages support time series modeling \citep{HyndmanKillick2025}, particularly within state space and vector autoregressive (VAR) frameworks. State space packages are relatively few and tend to focus on either estimation, \CRANpkg{statespacer} \citep{statespacer2023}, or simulation, \CRANpkg{simStateSpace}\citep{simStateSpace2025}. VAR-based tools are more numerous. For instance, \CRANpkg{vars} \citep{vars2024} and \CRANpkg{MTS} \citep{MTS2022} provide extensive functionality for estimation, diagnostics, and forecasting, while \CRANpkg{svars} \citep{svars2023} adds structural identification methods. High-dimensional VARs are handled by packages like \CRANpkg{bigtime} \citep{bigtime2023} and \CRANpkg{BigVAR} \citep{BigVAR2025}, and cross-country spillovers are modeled by \CRANpkg{Spillover} \citep{Spillover2024} and \CRANpkg{BGVAR} \citep{BGVAR2024}.

Although these tools share some features with \CRANpkg{MultiATSM}, they are tailored to standard state space or VAR analysis. In contrast, \CRANpkg{MultiATSM} embeds VAR dynamics within a state space representation that is explicitly grounded in arbitrage-free asset pricing theory. As such, \CRANpkg{MultiATSM} fills a specific gap in the R ecosystem by combining the structure of ATSMs with the flexibility of modern time series tools.

The remainder of the paper is organized as follows. Section~\hyperref[S:ATSMTheory]{2} outlines the theoretical foundations of the ATSMs implemented in the \CRANpkg{MultiATSM} package, and Section~\hyperref[S:ATSMoptions]{3} details each model's features. The subsequent sections focus on the practical implementation of ATSMs. Section~\hyperref[S:SectionData]{4} presents the dataset included in the package. Section~\hyperref[S:SectionInputs]{5} explains the user inputs required for model estimation. Section~\hyperref[S:SectionEstimation]{6} explains the estimation procedure, and Section~\hyperref[S:SectionImplementation]{7} shows how to estimate ATSMs from scratch using \CRANpkg{MultiATSM}. Replications of published academic studies are provided in the Appendix.

\section{ATSMs with unspanned economic risks: theoretical background}\label{S:ATSMTheory}

In this section, I outline several arbitrage-free ATSMs with unspanned macroeconomic risks available in the \CRANpkg{MultiATSM} package. A key appealing feature of these setups is their ability to disentangle the yield curve into a cross-sectional component, governed by the risk-neutral (\(\mathbb{Q}\)) dynamics, and a time-series component, driven by the physical (\(\mathbb{P}\)) dynamics. In light of this characteristic of the models, I present the single and the multicountry \(\mathbb{Q}\)-dynamics model dimensions in Section~\hyperref[S:Qdyn]{2.1}. Next, I expose the specific features of the risk factor dynamics under the \(\mathbb{P}\)-measure of the various restricted and unrestricted VARs settings in Section~\hyperref[S:Pdyn]{2.2}. Section~\hyperref[S:ATSMestimation]{2.3} describes the model estimation procedures.

\subsection{Model cross-sectional dimension (Q-dynamics)}\label{S:Qdyn}

\subsubsection{Single-country specifications (individual Q-dynamics model classes)}\label{single-country-specifications-individual-q-dynamics-model-classes}

The model cross-sectional structure is based on two central equations. The first one assumes that the country \(i\) short-term interest rate at time \(t\), \(r_{i,t}\), is an affine function of \(N\) unobserved (latent) country-specific factors, \(\boldsymbol{X_{i,t}}\):
\begin{equation}
\underset{(1 \times 1)}{\vphantom{\Big|} 
r_{i,t}} = 
\underset{(1 \times 1)}{
\vphantom{\Big|}
\delta_{i,0}} + 
\underset{(1 \times N)}{%
\vphantom{\Big|}
\boldsymbol{\delta}_{i,1}^{\top}} 
\underset{(N \times 1)}{%
\vphantom{\Big|}
\boldsymbol{X}_{i,t}}\text{,} 
\label{eq:ShortRate}
\end{equation}
where \(\delta_{i,0}\) and \(\boldsymbol{\delta_{i,1}}\) are time-invariant parameters.

The second equation assumes that the unobserved factor dynamics for each country \(i\) follow a maximally flexible, first-order, \(N-\)dimensional multivariate Gaussian (\(\mathcal{N}\)) VAR model under the \(\mathbb{Q}\)-measure:

\begin{align}
&   \underset{(N \times 1)}{\boldsymbol{\vphantom{\Big|}
X_{i,t}}} = 
\underset{(N \times 1)}{\boldsymbol{\vphantom{\Big|}
\mu^{Q}_{i,X}}} + 
\underset{(N \times N)}{\vphantom{\Big|}
\Phi^{Q}_{i,X}} 
\underset{(N \times 1)}{\boldsymbol{\vphantom{\Big|}
X_{i,t-1}}} + 
\underset{(N \times N)}{\vphantom{\Big|}
\Gamma_{i,X}}
\underset{(N \times 1)}{\boldsymbol{\vphantom{\Big|}
\varepsilon_{i,t}^{Q}}}\text{,}
    &  \boldsymbol{\varepsilon_{i,t}^{Q}}\sim {\mathcal{N}_N}(\boldsymbol{0}_N,\mathrm{I}_N)\text{,} 
    \label{eq:VARQ}
\end{align}
where \(\boldsymbol{\mu^{Q}_{i,X}}\) contains intercepts, \(\Phi^{Q}_{i,X}\), the feedback matrix, and \(\Gamma_{i,X}\) a lower triangular matrix.

Based on Equations \eqref{eq:ShortRate} and \eqref{eq:VARQ}, \citet{DaiSingleton2000} show that the country-specific zero-coupon bond yield with maturity of \(n\) periods, \(y_{i,t}^{(n)}\), is affine in \(\boldsymbol{X_{i,t}}\):
\begin{equation}
\underset{(1 \times 1)}{\vphantom{\Big|}
y_{i,t}^{(n)}} = 
\underset{(1 \times 1)}{\vphantom{\Big|}
a_{i,n}(\Theta_{n})} + 
\underset{(1 \times N)}{\vphantom{\Big|}
\boldsymbol{b_{i,n}(\Theta_{n})}^\top} 
\underset{(N \times 1)}{\vphantom{\Big|}
\boldsymbol{X_{i,t}}}\text{,}
    \label{eq:AffineYieldsScalar}
\end{equation}
where \(a_{i,n}(\Theta _{n})\) and \(\boldsymbol{b_{i,n}(\Theta _{n})}\) are constrained to eliminate arbitrage opportunities within this bond market, as dictated by the well-known Riccati equations.\footnote{Specifically, the referred loadings are \(a_{i,n+1}(\Theta _{n+1}) = a_{i,n}(\Theta _{n}) + b_{i,n}(\Theta _{n}) \mu^{Q}_{i,X} + \frac{1}{2} b_{i,n}(\Theta _{n}) \Gamma_{i,X} \Gamma_{i,X}' b_{i,n}(\Theta _{n})' - \delta_{i,0}\) and \(b_{i, n+1}=b_{i,n}\Phi^{Q}_{i,X} - \delta_{i,1}\), considering that the boundary conditions are \(a_{i,1}(\Theta _1)=-\delta_{i,0}\) and \(b_{i,1}(\Theta_1)=-\delta_{i,1}\). These expressions assume that the Radon--Nikodym derivative, which maps the risk-neutral measure to the physical measure, follows a log-normal process, and that the market price of risk is time-varying and affine in \(X_t\). See \citet{AngPiazzesi2003} for a detailed derivation of these expressions.} For notational simplicity, we collect \(J\) bond yields into the vector \(\boldsymbol{Y_{i,t}}=[y_{i,t}^{(1)}, y_{i,t}^{(2)},...,y_{i,t}^{(J)}]^\top\), the \(J\) intercepts into \(\boldsymbol{A_X(\Theta_i)}=[a_{i,1}(\Theta _{1}), a_{i,2}(\Theta _{2}) ,...,a_{i,J}(\Theta _{J})]^\top\) \(\in \mathbb{R}^J\), and the \(N\) slope coefficients into a \(J \times N\) matrix \(B_X(\Theta_i)=[\boldsymbol{b_{i,1}(\Theta _{1})}^\top, \boldsymbol{b_{i,2}(\Theta _{2})}^\top, ...,\boldsymbol{b_{i,J}(\Theta _{J})}^\top]^\top\). Accordingly, the yield curve cross-section dimension of country \(i\) is:
\begin{equation}
    \underset{(J \times 1)}{\vphantom{\Big|}
    \boldsymbol{Y_{i,t}}} = 
    \underset{(J \times 1)}{\vphantom{\Big|}
    \boldsymbol{A_X(\Theta_i)}} +
    \underset{(J \times N)}{\vphantom{\Big|}
    B_X(\Theta_i)} 
    \underset{(N \times 1)}{\vphantom{\Big|}
    \boldsymbol{X_{i,t}}}\text{.} 
\label{eq:AffineYieldsVector}
\end{equation}

It follows from Equations \eqref{eq:ShortRate} and \eqref{eq:VARQ} that the parameter set \(\Theta_i =\{\boldsymbol{\mu^Q_{i,X}},\Phi^Q_{i,X}, \Gamma_{i,X}, \delta_{i,0}, \boldsymbol{\delta_{i,1}}\}\) fully characterizes the cross-section of country's \(i\) term structure. Importantly, \citet{DaiSingleton2000} demonstrate that this system is not identified without additional restrictions, since \(\boldsymbol{X_{i,t}}\) and any invertible affine transformation of \(\boldsymbol{X_{i,t}}\) yield observationally equivalent representations. To circumvent this problem, JPS (2014) adopt the three sets of (minimal) restrictions proposed by \citet{JoslinSingletonZhu2011}. First, they impose the latent factors to be zero-mean processes, forcing \(\boldsymbol{\mu^{Q}_{i,X}}= \boldsymbol{0}_N\). Second, they choose \(\boldsymbol{\delta_{i,1}}\) to be a \(N\)-dimensional vector whose entries are all equal to one. Lastly, \(\Phi^Q_{i,X}\) is a diagonal matrix, the elements of which are the real and distinct eigenvalues, \(\lambda^Q_i\), of the matrix of eigenvectors of \(\Phi^Q_{i,X}\). Based on this restriction set, \citet{JoslinSingletonZhu2011} show that no additional invariant rotation is possible.

\citet{JoslinSingletonZhu2011} also show that a rotation from \(\boldsymbol{X_{i,t}}\) to portfolios of yields, the spanned factors \(\boldsymbol{P_{i,t}}\), leads to an observationally equivalent model representation. This invariant transformation implies that \(N\) portfolios of yields are perfectly priced and observed without errors, while the remaining \(J-N\) portfolios are priced and observed imperfectly. Specifically, the spanned factors are computed as \(\boldsymbol{P_{i,t}}=V_i\boldsymbol{Y_{i,t}}\), for a full-rank matrix \(V_i\). Based on this definition, Equation \eqref{eq:AffineYieldsVector} can be rearranged as an affine function of \(\boldsymbol{P_{i,t}}\)

\begin{equation}
    \underset{(J \times 1)}{\vphantom{\Big|}
    \boldsymbol{Y_{i,t}}}= 
    \underset{(J \times 1)}{\vphantom{\Big|}
    \boldsymbol{A_P(\Theta_i)}}+ 
    \underset{(J \times N)}{\vphantom{\Big|}
    B_P(\Theta_i)}
    \underset{(N \times 1)}{\vphantom{\Big|}
    \boldsymbol{P_{i,t}}}\text{.}
    \label{eq:AffineYieldsSpanned}
\end{equation}
where \(\boldsymbol{A_P(\Theta_i)}= \mathrm{I}_n - B_X(\Theta_i ) \left[ V_iB_X(\Theta_i \right] ^{-1}V_i \boldsymbol{A_X(\Theta_i)}\) and
\(B_P(\Theta_i)=B_X(\Theta_i) \left[ V_iB_X(\Theta_i ) \right]^{-1}\).

The rotation from \(\boldsymbol{X_{i,t}}\) to \(\boldsymbol{P_{i,t}}\) is convenient for two key reasons. First, \(\boldsymbol{P_{i,t}}\) contains directly observable yield curve factors (unlike \(\boldsymbol{X_{i,t}}\)), with its \(N\) elements mapping to traditional yield curve components. For instance, for \(N=3\) and \(V_i\) being the weight matrix that results from a principal component analysis, the portfolios of yields \(\boldsymbol{P_{i,t}}\) are commonly referred to as the level, slope, and curvature factors (see Section~\hyperref[S:SpaFac]{6.1}). Second, it enables a convenient decomposition of the likelihood function, facilitating both estimation and the interpretation of model parameters.

\subsubsection{Multicountry specifications (joint Q-dynamics model classes)}\label{multicountry-specifications-joint-q-dynamics-model-classes}

The cross-section multicountry extension is formed by stacking the country yields, spanned factors, and intercepts from Equation \eqref{eq:AffineYieldsSpanned} into, respectively, \(\boldsymbol{Y_t}=[\boldsymbol{Y_{1,t}}^\top, \boldsymbol{Y_{2,t}}^\top, ...,\boldsymbol{Y_{C,t}}^\top]^\top\), \(\boldsymbol{P_t}=[\boldsymbol{P_{1,t}}^\top, \boldsymbol{P_{2,t}}^\top, ..., \boldsymbol{P_{C,t}}^\top]^\top\), and \(\boldsymbol{A_P(\Theta)}=[\boldsymbol{A_P^\top(\Theta_1)}, \boldsymbol{A_P^\top(\Theta_2)}, ..., \boldsymbol{A_P^\top(\Theta_C)}]^\top\), where \(C\) denotes the number of countries in this economic system. Additionally, we set \(B_{P}(\Theta)\) as block diagonal, \(B_P(\Theta)=B_P(\Theta_1) \oplus  B_P(\Theta_2) \oplus \dots \oplus B_P(\Theta_C)\), where \(\oplus\) refers to the direct sum symbol. Accordingly,\\
\begin{equation}
    \underset{(CJ \times 1)}{\vphantom{\Big|}
    \boldsymbol{Y_{t}}} = 
    \underset{(CJ \times 1)}{\vphantom{\Big|}
    \boldsymbol{A_{P}(\Theta)}} + 
    \underset{(CJ \times CN)}{\vphantom{\Big|}
    B_{P}(\Theta)}
    \underset{(CN \times 1)}{\vphantom{\Big|}
    \boldsymbol{P_{t}}}\text{.}
    \label{eq:AffineYieldsSpannedMultiCountry}
\end{equation}

\subsection{Model time series dimension (P-dynamics)}\label{S:Pdyn}

In the modelling frameworks implemented in the \CRANpkg{MultiATSM} package, the risk factor dynamics under the \(\mathbb{P}\)-measure must include at least \(N\) domestic spanned factors (\(\boldsymbol{P_{i,t}}\)) and \(M\) domestic unspanned factors (\(\boldsymbol{M_{i,t}}\)), and may optionally include \(G\) global unspanned factors (\(\boldsymbol{M_t^W}\)), depending on the specification. The dynamics of these risk factors evolves as either an unrestricted or a restricted VAR models. The unrestricted case corresponds to the JPS specification, while the restricted setup encompasses the GVAR and JLL frameworks.

It is worth stressing the role of unspanned factors in shaping the yield curve developments. Although these factors are absent in the cross-section dimension of the models, they influence the dynamics of the spanned factors which, in turn, affect directly bond yields.

\subsubsection{JPS-based models}\label{jps-based-models}

The country-specific state vector, \(\boldsymbol{Z_{i,t}}\), is formed from stacking the global and domestic (unspanned and spanned) risk factors: \(\boldsymbol{Z_{i,t}} = [\boldsymbol{M_t^{W^\top}}\), \(\boldsymbol{M_{i,t}}^\top\), \(\boldsymbol{P_{i,t}}^\top]^\top\). As such, \(\boldsymbol{Z_{i,t}}\) is a \(R\)-dimensional vector, where \(R =G + K\) and \(K = M + N\).
In JPS-based setups, \(\boldsymbol{Z_{i,t}}\) follows a standard unrestricted Gaussian VAR(1):
\begin{align}
    & \underset{(R \times 1)}{\vphantom{\Big|}
    \boldsymbol{Z_{i,t}}} =
    \underset{(R \times 1)}{\vphantom{\Big|}
     \boldsymbol{C_i^{\mathbb{P}}}} + 
     \underset{(R \times R)}{\vphantom{\Big|}
     \Phi_i^{\mathbb{P}}}
     \underset{ (R \times 1)}{\vphantom{\Big|}
     \boldsymbol{Z_{i,t-1}}} + 
     \underset{(R \times R)}{\vphantom{\Big|}
     \Gamma_i}
        \underset{(R \times 1)}{\vphantom{\Big|}
        \boldsymbol{\varepsilon_{Z,t}^{\mathbb{P}}}}\text{,}
        & \boldsymbol{\varepsilon_{Z,t}^{\mathbb{P}}} \sim
        {\mathcal{N}_R}(\boldsymbol{0}_R,\mathrm{I}_R)\text{,}%
    \label{eq:VARunspanned}
\end{align}
where \(\boldsymbol{C_i^{\mathbb{P}}}\) denotes the vector of intercepts; \(\Phi_i^{\mathbb{P}}\), the feedback matrix; and \(\Gamma_i\), the Cholesky factor (a lower triangular matrix).

\subsubsection{GVAR-based models}\label{S:GVARtheory}

In the \CRANpkg{MultiATSM} package, the GVAR setup is formed from two parts: the marginal and the VARX\(^{*}\) models. The former captures the joint dynamics of the global economy, whereas the latter describes the developments from the domestic factors. For a thorough description of GVAR models, See \citet{ChudikPesaran2016}.

The marginal model is an unrestricted VAR(\(1\)) featuring exclusively the global factors:
\begin{align}
& \underset{(G \times 1)}{\vphantom{\Big|}
\boldsymbol{M_t^W}}= 
\underset{(G \times 1)}{\vphantom{\Big|}
\boldsymbol{C^W}} + 
\underset{(G \times G)}{\vphantom{\Big|}
\Phi^W} \underset{(G \times 1)}{\vphantom{\Big|}
\boldsymbol{M_{t-1}^W}} +
\underset{(G \times G)}{\vphantom{\Big|}
\Gamma^W}\underset{(G \times 1)}{\vphantom{\Big|}
\boldsymbol{\varepsilon_{t}^W}}\text{,} & \boldsymbol{\varepsilon_t^W} \sim {\mathcal{N}_G}(\boldsymbol{0}_G,\mathrm{I}_G).
\label{eq:MarginalModel}
\end{align}

The VARX\(^{*}\) setups are country-specific small-scale VAR models containing global factors and weakly exogenous `star' variables --- weighted averages of foreign variables --- built as
\begin{equation}
 \boldsymbol{Z_{i,t}^{\ast^\top}} = \sum_{j=1}^{C} w_{i,j} \boldsymbol{Z_{j,t}^\top}, \qquad \sum_{j=1}^{C} w_{i,j}= 1, \quad w_{i,i}=0 \quad \forall i \in \{1,2, ...C \},
\label{eq:StarVar}
\end{equation}
where \(Z_{j,t}\) is a \(K-\)dimension vector of domestic factors \(\boldsymbol{Z_{j,t}} = [\boldsymbol{M_{j,t}}^\top\), \(\boldsymbol{P_{j,t}}^\top]^\top\) and \(w_{i,j}\) is a scalar that measures the degree of connectedness of country \(i\) with country \(j\).

These models follow a VARX\(^{*}(p,q,r)\) specification, where \(p\), \(q\) and \(r\) are the number of lags from, respectively, the domestic, the star, and the global risk factors. The \CRANpkg{MultiATSM} package provides the estimates for the case \(p=q=r=1\). In such a case, the dynamics of \(\boldsymbol{Z_{i,t}}\) is described as a VARX\(^{*}\) of the following form:
\begin{align}
& \underset{(K \times 1)}{\vphantom{\Big|}
\boldsymbol{Z_{i,t}}}  = 
\underset{(K \times 1)}{\vphantom{\Big|}
\boldsymbol{C^X_{i}}} + 
\underset{(K \times K)}{\vphantom{\Big|}
\Phi^X_{i}} 
\underset{(K \times 1)}{\vphantom{\Big|}
\boldsymbol{Z_{i,t-1}}} +
\underset{(K \times K)}{\vphantom{\Big|}
\Phi^{X^\ast}_i}  
\underset{(K \times 1)}{\vphantom{\Big|}
\boldsymbol{Z_{i,t-1}^{\ast}}} + 
\underset{(K \times G)}{\vphantom{\Big|}
\Phi_{i}^{X^{W}}} 
\underset{(G \times 1)}{\vphantom{\Big|}
\boldsymbol{M_{t-1}^{W}}} + 
\underset{(K \times K)}{\vphantom{\Big|}
\Gamma_{i}^{X}}
\underset{(K \times 1)}{\vphantom{\Big|}
\boldsymbol{\varepsilon^X_{i,t}}}\text{,}    & \boldsymbol{\varepsilon^X_{i,t}} \sim {\mathcal{N}_K}(\boldsymbol{0}_K,\mathrm{I}_K).
\label{eq:VARXmodel}
\end{align}

Additionally, GVAR models require, as an intermediate step, the specification of country-specific \(2K \times CK\)-link matrices, \(W_i\), to unify the individual VARX\(^{*}\) models. Formally,
\begin{equation}
\begin{bmatrix} \boldsymbol{Z_{i,t}} \\ \boldsymbol{Z_{i,t}}^{*} \end{bmatrix}_{2K \times 1} \equiv \underset{(2K \times CK)}{W_i} \begin{bmatrix} \boldsymbol{Z_{1,t}} \\  \boldsymbol{Z_{2,t}} \\     \vdots  \\ \boldsymbol{Z_{C,t}}
\end{bmatrix}_{CK \times 1}.
\label{eq:LinkMatequation}
\end{equation}

Last, to compose the \(F\)-dimensional state vector for \(F = G + CK\), we gather the global economic variables and the country-specific risk factors, as \(\boldsymbol{Z_t} = [\boldsymbol{M_{t}^{W^\top}}\), \(\boldsymbol{Z_{1,t}}^\top\), \(\boldsymbol{Z_{2,t}}^\top, \hdots    \boldsymbol{Z_{C,t}}^\top]^\top\). As such, we can form a first order GVAR process as
\begin{align}
    & \underset{(F \times 1)}{\vphantom{\Big|}
    \boldsymbol{Z_t}} =
    \underset{(F \times 1)}{\vphantom{\Big|}
    \boldsymbol{C_y}} +
    \underset{(F \times F)}{\vphantom{\Big|}
    \Phi_y} 
    \underset{(F \times F)}{\vphantom{\Big|}
    \boldsymbol{Z_{t-1}}} + 
    \underset{(F \times F)}{\vphantom{\Big|}
    \Gamma_y}
    \underset{(F \times 1)}{\vphantom{\Big|}
    \boldsymbol{\varepsilon_{y,t}}}\text{,} & 
    \boldsymbol{\varepsilon_{y,t}} \sim {\mathcal{N}_F}(\boldsymbol{0}_F,\mathrm{I}_F)\text{,}  \label{eq:GVARequation}
\end{align}
where \(\boldsymbol{C_y} = [\boldsymbol{C^{W^\top}}\), \(\boldsymbol{C_1^{X^\top}}\), \(\boldsymbol{C_2^{X^\top}}\),\ldots{} \(\boldsymbol{C_C^{X^\top}}]^\top\), \(\boldsymbol{\varepsilon_{y,t}} =[ \boldsymbol{\varepsilon^{W^\top}_t}\), \(\boldsymbol{\varepsilon_{1,t}^{X^\top}}\), \(\boldsymbol{\varepsilon_{2,t}^{X^\top}}\) \ldots{} \(\boldsymbol{\varepsilon_{C,t}^{X^\top}}]^\top\), \(\Gamma_y=\Gamma^W \oplus \Gamma_1^X \oplus \Gamma_2^X \oplus \dots \oplus \Gamma_C^X\), and

\begin{equation}
\Phi_y =
\begin{bmatrix}
\Phi^W & 0_{\scriptscriptstyle{G \times CK}}  \\
\Phi^{X^{W}} & G_1
\end{bmatrix}_{F \times F} ,
\end{equation}

where \(\Phi^{X^{W}}=
\begin{bmatrix}
\Phi^{X^{W}}_1 \\
\Phi^{X^{W}}_2 \\
\vdots \\
\Phi^{X^{W}}_C
\end{bmatrix}_{CK \times G}\)
and \(G_1=
\begin{bmatrix}
\Phi_1W_1 \\
\Phi_2W_2 \\
\vdots \\
\Phi_CW_C
\end{bmatrix}_{CK \times CK}\), for \(\Phi_i= [\Phi_i^{X}\), \(\Phi_i^{X^*}]\) and \(\quad \forall i \in \{1,2, ...C \}\).

\subsubsection{JLL-based models}\label{S:JLL}

JLL-based models incorporate three components: \emph{(i)} the global economy, \emph{(ii)} a dominant large economy,\footnote{Noticeably, in the context of the \CRANpkg{MultiATSM} package, the model type \texttt{JLL\ No\ DomUnit} is the only exception (see Section~\hyperref[S:ATSMoptions]{3}).} and \emph{(iii)} a set of smaller economies. The state vector is formed from a number of linear projections to build domestic risk factors that are free of the influence of the variables from other countries and/or from the global economy.

The construction of the domestic spanned factors proceeds in two steps. First, for each economy \(i\), \(\boldsymbol{P_{i,t}}\) is projected on \(\boldsymbol{M_{i,t}}\) of this same country
\begin{equation}
    \underset{ (N \times 1)}{\vphantom{\Big|}
    \boldsymbol{P_{i,t}}} = 
    \underset{(N \times M)}{\vphantom{\Big|}
    b_i} 
    \underset{(M \times 1)}{\vphantom{\Big|} 
    \boldsymbol{M_{i,t}}} + 
    \underset{ (N \times 1)}{\vphantom{\Big|}
    \boldsymbol{P_{i,t}^e}} \text{,}
\label{eq:PricingOrthoAll}
\end{equation}
where the residuals \(\boldsymbol{P_{i,t}^e}\) are orthogonal to the economic fundamentals of the country \(i\).

Second, for the non-dominant economies, \(\boldsymbol{P_{i,t}^e}\) is additionally projected on the orthogonalized spanned factors of the dominant country, indexed by \(D\), as follows:
\begin{equation}
    \underset{(N \times 1)}{\vphantom{\Big|}
    \boldsymbol{P_{i,t}^e}} = 
    \underset{(N \times N)}{\vphantom{\Big|}
    c_i^D} 
    \underset{(N \times 1)}{\vphantom{\Big|}
    \boldsymbol{P_{D,t}^e}} + 
    \underset{(N \times 1)}{\vphantom{\Big|}
    \boldsymbol{P_{i,t}^{e*}}}\text{,} \quad  i \neq D,
\label{eq:PricingOrthoNonDU}
\end{equation}
where \(\boldsymbol{P_{i,t}^{e*}}\) corresponds to the non-dominant country \(i\) set of residuals.

The design of the domestic unspanned factors also features two steps: for the dominant economy, \(\boldsymbol{M_{D,t}}\) is projected on the global economic factors
\begin{equation}
    \underset{(M \times 1)}{\vphantom{\Big|}
    \boldsymbol{M_{D,t}}} = 
    \underset{(M \times G)}{\vphantom{\Big|}
    a_D^W} 
    \underset{(G \times 1)}{\vphantom{\Big|}
    \boldsymbol{M_t^W}} + 
    \underset{(M \times 1)}{\vphantom{\Big|}
    \boldsymbol{M_{D,t}^e}} \text{,}
\label{eq:MacroOrthoDU}
\end{equation}
and, for the other economies, the residuals of the previous regression are used to compute
\begin{equation}
      \underset{(M \times 1)}{\vphantom{\Big|}
      \boldsymbol{M_{i,t}}} =   
      \underset{(M \times G)}{\vphantom{\Big|}
      a_i^W}  
      \underset{(G \times 1)}{\vphantom{\Big|}
      \boldsymbol{M_t^W}} +   
      \underset{(M \times M)}{\vphantom{\Big|}
      a_i^D}
      \underset{(M \times 1)}{\vphantom{\Big|}
      \boldsymbol{M_{D,t}^e}} + 
      \underset{(M \times 1)}{\vphantom{\Big|}
      \boldsymbol{M_{i,t}^{e*}}}\text{.}
\label{eq:MacroOrthoNonDU}
\end{equation}

Accordingly, the state vector is formed by \(\boldsymbol{Z_t^e}= [\boldsymbol{M_t^{W^\top}}\), \(\boldsymbol{M_{D,t}^{e^\top}}\), \(\boldsymbol{P_{D,t}^{e^\top}}\), \(\boldsymbol{M_{2,t}^{e*^\top}}\), \(\boldsymbol{P_{2,t}^{e*^\top}}\) \ldots{} \(\boldsymbol{M_{C,t}^{e*^\top}}\), \(\boldsymbol{P_{C,t}^{e*^\top}}]^\top\) and its dynamics evolve as a restricted VAR(1),
\begin{align}
& \underset{(F \times 1)}{\vphantom{\Big|}
\boldsymbol{Z_t^e}}= 
\underset{(F \times 1)}{\vphantom{\Big|}
\boldsymbol{C^{e}_Y}} + 
\underset{(F \times F)}{\vphantom{\Big|}
\Phi^e_Y} 
\underset{(F \times 1)}{\vphantom{\Big|}
\boldsymbol{Z_{t-1}^e}} + 
\underset{(F \times F)}{\vphantom{\Big|}
\Gamma_{Y}^e}
\underset{(F \times 1)}{\vphantom{\Big|}
\boldsymbol{\varepsilon^e_{Z,t}}}\text{,}  &  \boldsymbol{\varepsilon _{Z,t}^{e}} \sim {\mathcal{N}_F}(\boldsymbol{0}_F,\mathrm{I}_F).
\label{eq:VAROrtho}
\end{align}
JLL (2015) impose a set of zero restrictions on \(\Phi^e_Y\) and \(\Gamma_{Y}^e\), with their detailed structure provided in the original study.

\subsection{Estimation procedures}\label{S:ATSMestimation}

The approach proposed by JPS (2014) enables an efficient estimation procedure through its structural design. Specifically, the parameters governing the \(\mathbb{Q}\)- and \(\mathbb{P}\)-measures can be estimated independently. The only exception is the variance-covariance matrix, \(\Sigma\), which appears in both likelihood functions and, therefore, must be estimated jointly.

In JLL (2015), however, the authors adopt a simplified estimation procedure by estimating the \(\Sigma\) matrix exclusively under the \(\mathbb{P}\)-measure. While they acknowledge that this approach is not fully efficient, they argue that the empirical implications are limited in their application.

\section{The ATSMs available at the MultiATSM package}\label{S:ATSMoptions}

As outlined in the previous section, the ATSMs implemented in the \CRANpkg{MultiATSM} package differ in the specification of their \(\mathbb{Q}\)- and \(\mathbb{P}\)-measure dynamics. In short, under the \(\mathbb{Q}\)-measure, models can be specified either on a country-by-country basis (JPS, 2014) or jointly across countries (JLL, 2015; CM, 2024). Under the \(\mathbb{P}\)-measure, risk factor dynamics follow a VAR(1) process, which may be unrestricted, as in the JPS-related frameworks, or restricted, as in the JLL and GVAR specifications.

\CRANpkg{MultiATSM} provides support for eight different classes of ATSMs based on these modelling approaches. These classes vary along several dimensions: the specification of the \(\mathbb{P}\)- and \(\mathbb{Q}\)-dynamics, the estimation approach, and whether a dominant economy is included. Table \ref{tab:tab-ModFea-L} summarizes the defining features of each model class available in the package. A brief overview of these specifications follows below.

\begin{table}[!h]
\centering
\caption{\label{tab:tab-ModFea-L}Summary of model features}
\centering
\fontsize{7}{9}\selectfont
\begin{tabular}[t]{lcccccccccccccc}
\toprule
\multicolumn{2}{c}{\textbf{ }} & \multicolumn{5}{c}{\textbf{P-dynamics}} & \multicolumn{1}{c}{\textbf{ }} & \multicolumn{2}{c}{\textbf{Q-dynamics}} & \multicolumn{1}{c}{\textbf{ }} & \multicolumn{2}{c}{\textbf{Sigma estimation}} & \multicolumn{1}{c}{\textbf{ }} & \multicolumn{1}{c}{\textbf{Dom. Eco.}} \\
\cmidrule(l{3pt}r{3pt}){3-7} \cmidrule(l{3pt}r{3pt}){9-10} \cmidrule(l{3pt}r{3pt}){12-13} \cmidrule(l{3pt}r{3pt}){15-15}
\multicolumn{2}{c}{ } & \multicolumn{2}{c}{Single} & \multicolumn{3}{c}{Joint} & \multicolumn{1}{c}{ } & \multicolumn{1}{c}{Single} & \multicolumn{1}{c}{Joint} & \multicolumn{1}{c}{ } & \multicolumn{1}{c}{P} & \multicolumn{1}{c}{P and Q} & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-4} \cmidrule(l{3pt}r{3pt}){5-7} \cmidrule(l{3pt}r{3pt}){9-9} \cmidrule(l{3pt}r{3pt}){10-10} \cmidrule(l{3pt}r{3pt}){12-12} \cmidrule(l{3pt}r{3pt}){13-13}
\multicolumn{2}{c}{ } & \multicolumn{1}{c}{UR} & \multicolumn{1}{c}{R} & \multicolumn{1}{c}{UR} & \multicolumn{2}{c}{R} & \multicolumn{1}{c}{ } & \multicolumn{1}{c}{ } & \multicolumn{1}{c}{ } & \multicolumn{1}{c}{ } & \multicolumn{1}{c}{ } & \multicolumn{1}{c}{ } & \multicolumn{1}{c}{ } & \multicolumn{1}{c}{ } \\
\cmidrule(l{3pt}r{3pt}){3-3} \cmidrule(l{3pt}r{3pt}){4-4} \cmidrule(l{3pt}r{3pt}){5-5} \cmidrule(l{3pt}r{3pt}){6-7}
\textbf{ } & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{JLL} & \textbf{GVAR} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{}\\
\midrule
\addlinespace[0.3em]
\multicolumn{15}{l}{\textbf{Unrestricted VAR}}\\
\hspace{1em}JPS original &  & x &  &  &  &  &  & x &  &  &  & x &  & \\
\hspace{1em}JPS global &  &  &  & x &  &  &  & x &  &  &  & x &  & \\
\hspace{1em}JPS multi &  &  &  & x &  &  &  &  & x &  &  & x &  & \\
\addlinespace[0.3em]
\multicolumn{15}{l}{\textbf{Restricted VAR (GVAR)}}\\
\hspace{1em}GVAR single &  &  &  &  &  & x &  & x &  &  &  & x &  & \\
\hspace{1em}GVAR multi &  &  &  &  &  & x &  &  & x &  &  & x &  & \\
\addlinespace[0.3em]
\multicolumn{15}{l}{\textbf{Restricted VAR (JLL)}}\\
\hspace{1em}JLL original &  &  &  &  & x &  &  &  & x &  & x &  &  & x\\
\hspace{1em}JLL No DomUnit &  &  &  &  & x &  &  &  & x &  & x &  &  & \\
\hspace{1em}JLL joint Sigma &  &  &  &  & x &  &  &  & x &  &  & x &  & x\\
\bottomrule
\end{tabular}
\end{table}

\vspace{-2.5em}
\begin{center}
\captionsetup{type=table}
\caption*{\footnotesize Note: Risk factor dynamics under the $\mathbb{P}$-measure may follow either an unrestricted (UR) or a restricted (R) specification. The set of restrictions present in the JLL-based and GVAR-based models are described in \cite{JotikasthiraLeLundblad2015} and \cite{CandelonMoura2024}, respectively. The estimation of the $\Sigma$ matrix is done either exclusively with the other parameters of the $\mathbb{P}$-dynamics (\textit{P} column) or jointly under both $\mathbb{P}$- and $\mathbb{Q}$-parameters (\textit{P and Q} column). \textit{Dom. Eco.} relates to the presence of a dominant economy. The entries featuring \textit{x} indicate that the referred characteristic is part of the model.}
\end{center}

The ATSMs in which the estimation is performed separately for each country are labeled as \texttt{JPS\ original}, \texttt{JPS\ global} and \texttt{GVAR\ single}. In the \texttt{JPS\ original} setup, the set of risk factors includes exclusively each country's domestic variables and the global unspanned factors, whereas \texttt{JPS\ global} and \texttt{GVAR\ single} also incorporate domestic risk factors of the other countries of the economic system. Noticeably, the difference between \texttt{JPS\ global} and \texttt{GVAR\ single} stem from the set of restrictions imposed under the \(\mathbb{P}\)-dynamics.

Within the multicountry frameworks, certain features are worth noting. The \texttt{JLL\ original} model reproduces the setup in JLL (2015), assuming an economic cohort composed of a globally dominant economy and a set of smaller countries, and estimating the \(\Sigma\) matrix exclusively under the \(\mathbb{P}\)-measure. The two alternative versions assume the absence of a dominant country (\texttt{JLL\ No\ DomUnit}) and the estimation of \(\Sigma\) under both the \(\mathbb{P}\) and \(\mathbb{Q}\) measures (\texttt{JLL\ joint\ Sigma}), as in JPS (2014). The remaining specifications differ in their \(\mathbb{P}\)-dynamics: either by an unrestricted VAR model (\texttt{JPS\ multi}) or by a GVAR setup (\texttt{GVAR\ multi}), as proposed in CM (2024).

\section{Package dataset}\label{S:SectionData}

The \CRANpkg{MultiATSM} package provides datasets that approximate those used in the GVAR-based ATSMs of \citet{CandelonMoura2023} and CM (2024). The data requirements for estimating GVAR models encompass those of all other model classes, making them suitable for generating outputs across all models supported by the package. As such, the examples in the following sections use the dataset from CM (2024).

The \texttt{LoadData()} function provides access to the datasets included in the package. To load the data from CM (2024), set the argument to \texttt{CM\_2024}:

\begin{verbatim}
LoadData("CM_2024")
\end{verbatim}

This function returns three sets of data. The first contains time series of zero-coupon bond yields for four emerging market economies: China, Brazil, Mexico, and Uruguay. The data spans monthly intervals from June 2004 to January 2020. For the purpose of model estimation, the package requires that \emph{(i)} bond yield maturities are the same across all countries;\footnote{It is worth emphasizing that, although the \texttt{DataForEstimation()} and \texttt{InputsForOpt()} functions in the package accept inputs with differing maturities, their outputs are standardized to a common set of yields.} and \emph{(ii)} yields must be expressed in annualized percentage terms (not basis points). Note that the \CRANpkg{MultiATSM} package does not provide routines for bootstrapping zero-coupon yields from coupon bonds, so any such treatment must be handled by the user.

The second dataset comprises time series for unspanned risk factors --- specifically, the macroeconomic indicators economic growth and inflation --- covering the same period as the bond yield data. These data cover both \emph{(i)} domestic variables for each of the four countries in the sample and \emph{(ii)} corresponding global indicators. The construction of unspanned risk factors, like that of bond yields, must be carried out externally by the user.

The final dataset contains measures of interconnectedness, proxied by trade flows, which are specifically required for estimating the GVAR-based models. The trade flow data report the annual value of goods imported and exported between each pair of countries in the sample, starting from 1948. All values are expressed in U.S. dollars on a free-on-board basis. These data are used to construct the transition matrix in the GVAR framework.

\section{Required user inputs}\label{S:SectionInputs}

\subsection{Fundamental inputs}\label{fundamental-inputs}

To estimate any model, the user must specify several general inputs, which can be grouped into the following categories:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Desired ATSM class (\texttt{ModelType}): a character vector containing the label of the model to be estimated as described in Table \ref{tab:tab-ModFea-L};
\item
  Risk Factor Features. This includes the following list of elements:
\end{enumerate}

\begin{itemize}
\item
  Set of economies (\texttt{Economies}): a character vector containing the names of the economies which are part of the economic system;
\item
  Global variables (\texttt{GlobalVar}): a character vector containing the labels of the \(G\) global unspanned factors. Studies examining the impact of global developments on bond prices could include proxy measures of global inflation and global economic activity in this category \citep{JotikasthiraLeLundblad2015, AbbrittiDellErbaMorenoSola2018, CandelonMoura2024};
\item
  Domestic variables (\texttt{DomVar}): a character vector containing the labels of the \(M\) domestic unspanned factors. These typically correspond to measures of domestic inflation and economic activity, the standard macroeconomic indicators monitored by central banks \citep{AngPiazzesi2003, JoslinPriebschSingleton2014, JotikasthiraLeLundblad2015, CandelonMoura2024};
\item
  Number of spanned factors (\(N\)): a scalar representing the number of country-specific spanned factors. Although, in principle, \(N\) could vary across countries, the models provided in the package assume a common value of \(N\) for all countries.
  A common choice in the literature is \(N=3\), as in JPS (2014) and CM (2024), since this produces an excellent cross-sectional fit of bond yields (\citet{LittermanScheinkman1991}).
  Other studies, such as \citet{AdrianCrumpMoench2013}, extend the specification to \(N=5\), arguing that it improves the performance of model-implied term premia. Further intuition on the role and interpretation of spanned factors is provided in Section~\hyperref[S:SpaFac]{6.1}.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Sample span:
\end{enumerate}

\begin{itemize}
\item
  Initial sample date (\texttt{t0}): the start of the sample period in the format \emph{dd-mm-yyyy};
\item
  End sample date (\texttt{tF}): the end of the sample period in the format \emph{dd-mm-yyyy}.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\item
  Data Frequency (\texttt{DataFreq}): a character vector specifying the frequency of the time series data. The available options are: \texttt{Annually}, \texttt{Quarterly}, \texttt{Monthly}, \texttt{Weekly}, \texttt{Daily\ Business\ Days}, and \texttt{Daily\ All\ Days};
\item
  Stationarity constraint under the \(\mathbb{Q}\)-dynamics (\texttt{StatQ}): a logical that takes \texttt{TRUE} if the user wishes to impose that the largest eigenvalue under the \(\mathbb{Q}\)-measure, \(\lambda^Q_i\), is strictly less than 1. While enforcing this stationarity constraint may increase estimation time, it can improve convergence and numerical stability. Moreover, by inducing near-cointegration, the eigenvalue restriction helps to pin down more plausible dynamics for bond risk premia \citep{BauerRudebuschWu2012, JoslinPriebschSingleton2014};
\item
  Selected folder to save the graphical outputs (\texttt{Folder2Save}): path where the selected graphical outputs will be saved. If set to \texttt{NULL}, the outputs are stored in the user's temporary directory (accessible via \texttt{tempdir()});
\item
  Output label (\texttt{OutputLabel}): A single-element character vector containing the name used in the file name that stores the model outputs.
\end{enumerate}

The following provides an example of the basic model input specification:

\begin{verbatim}
ModelType <- "JPS original"
Economies <- c("Brazil", "Mexico", "Uruguay")
GlobalVar <- c("Gl_Eco_Act", "Gl_Inflation")
DomVar <- c("Eco_Act", "Inflation")
N <- 3
t0 <- "01-07-2005"
tF <- "01-12-2019"
DataFreq <- "Monthly"
StatQ <- FALSE
Folder2Save <- NULL
OutputLabel <- "Model_demo"
\end{verbatim}

\subsection{Model-specific inputs}\label{model-specific-inputs}

\subsubsection{GVARlist and JLLlist}\label{S:SectionGVARJLLinputs}

The inputs described above are sufficient for estimating all variants of the JPS models presented in Table \ref{tab:tab-ModFea-L}. However, estimating the GVAR or JLL setups requires additional elements. For clarity, these extra inputs should be organized into separate lists for each model. This section outlines the general structure of both lists, while Section~\hyperref[S:PdynEst]{6.2} provide a more detailed explanations of their components and available options, reflecting the broader scope of each setup.

For GVAR models, the required inputs are twofold. First, the user must specify the dynamic structure of each country's VARX model. For example:

\begin{verbatim}
VARXtype <- "unconstrained"
\end{verbatim}

Next, provide the desired inputs to build the transition matrix. For instance:

\begin{verbatim}
data('TradeFlows')
W_type <- "Sample Mean"
t_First_Wgvar <- "2000"
t_Last_Wgvar <- "2015"
DataConnectedness <- TradeFlows 
\end{verbatim}

Based on these inputs, a complete instance of the \texttt{GVARlist} object is

\begin{verbatim}
GVARlist <- list(VARXtype = "unconstrained", W_type = "Sample Mean", 
                 t_First_Wgvar = "2000", t_Last_Wgvar = "2015", 
                 DataConnectedness = TradeFlows) 
\end{verbatim}

For the JLL frameworks, if the chosen model is either \texttt{JLL\ original} or \texttt{JLL\ joint\ Sigma}, it suffices to specify the name of the dominant economy. Otherwise, for the \texttt{JLL\ No\ DomUnit} class, the user must set \texttt{None}. For instance:

\begin{verbatim}
# Example for "JLL original" and "JLL joint Sigma" models
JLLlist <- list(DomUnit =  "China")

# For "JLL No DomUnit" model
JLLlist <- list(DomUnit =  "None")
\end{verbatim}

\subsubsection{BRWlist}\label{S:SectionBRWinputs}

In an influential paper, \citet{BauerRudebuschWu2012} (henceforth BRW, 2012) show that estimates from traditional ATSMs often suffer from severe small-sample bias. This can lead to unrealistically stable expectations for future short-term interest rates and, consequently, distort term premium estimates for long-maturity bonds. To address this issue, BRW (2012) propose an indirect inference estimator based on a stochastic approximation algorithm, which corrects for bias and enhances the persistence of short-term interest rates, resulting in more plausible term premium dynamics.

It is worth noting that this framework serves as a complementary feature to the core ATSMs and can therefore be applied to any of the model types supported by the \CRANpkg{MultiATSM} package. If the user intends to implement a model following the BRW (2012) approach, a few additional inputs must be specified. These include:

\begin{itemize}
\item
  Mean or median of physical dynamic estimates (\texttt{Cent\_Measure}): compute the mean or the median of the \(\mathbb{P}\)-dynamics estimates after each bootstrap iteration by setting the option to \texttt{Mean} (for the mean) or \texttt{Median} (for the median);
\item
  Adjustment parameter (\texttt{gamma}): this parameter controls the degree of shrinkage applied to the difference between the estimates prior to the bias correction and the bootstrap-based estimates after each iteration. It remains fixed across iterations and must lie in the interval \((0,1)\);
\item
  Number of iteration (\texttt{N\_iter}) : total number of iterations used
  in the stochastic approximation algorithm after burn-in;
\item
  Number of bootstrap samples (\texttt{B}): quantity of simulated samples
  used in each burn-in or actual iteration;
\item
  Perform closeness check (\texttt{checkBRW}): indicates whether the user wishes to compute the root mean square distance between the model estimates obtained through the bias-correction method and those generated via no bias-correction. The default is \texttt{TRUE};
\item
  Number of bootstrap samples used in the closeness check (\texttt{B\_check}):
  default is equal to 100,000 samples;
\item
  Eigenvalue restriction (\texttt{Eigen\_rest}): impose a restriction on the largest eigenvalue under the \(P\)-measure after applying the bias correction procedure. Default is \(1\);
\item
  Number of burn-in iteration (\texttt{N\_burn}): quantity of the iterations
  to be discarded in the first stage of the bias-correction estimation
  process. The recommended number is \(15\%\) of the total number of
  iterations. In practice, this resembles the burn-in concept in Markov chain Monte Carlo methods. Particularly, the BRW (2012) stochastic approximation algorithm is iterative, and for a sufficiently large number of iterations, the parameters converge to their true values. As such, discarding early iterations avoids the need for assessing a computationally costly exit condition.
\end{itemize}

\begin{verbatim}
BRWlist <- within(list(Cent_Measure = "Mean", gamma = 0.2, N_iter = 500, B = 50, 
                       checkBRW = TRUE, B_check = 1000, Eigen_rest = 1), 
                       N_burn <- round(N_iter * 0.15))
\end{verbatim}

\subsection{Additional inputs for numerical and graphical outputs}\label{S:SectionNumOut}

Once the desired features are selected and the parameters of the chosen ATSM have been estimated, the \CRANpkg{MultiATSM} package provides tools to generate the following numerical and graphical outputs
via the \texttt{NumOutputs()} function:

\begin{itemize}
\tightlist
\item
  Time-series dynamics of the risk factors;
\item
  Model fit of the bond yields;
\item
  Orthogonalized impulse response functions (IRFs);
\item
  Orthogonalized forecast error variance decompositions (FEVDs);
\item
  Generalized impulse response functions (GIRFs);
\item
  Generalized forecast error variance decompositions (GFEVDs);
\item
  Decomposition of bond yields into expected and term premia components.
\end{itemize}

These outputs are organized into distinct analytical components, each offering different insights into model behavior and its economic interpretation.

The time-series dynamics of the risk factors are displayed in separate subplots: one for each global factor, and one subplot per domestic risk factor showing all countries in the economic system. The model fit of the bond yields is provided through two measures of model-implied yields. The first is a fitted measure derived solely from the cross-sectional component, as in Equation \eqref{eq:AffineYieldsSpanned} for single-country models and Equation \eqref{eq:AffineYieldsSpannedMultiCountry} for multicountry setups. This measure reflects the fit based exclusively on the parameters governing the \(\mathbb{Q}\)-dynamics. The second incorporates both the physical and risk-neutral dynamics, combining the cross-sectional equations with the state evolution specified by each ATSM.

The impulse response functions and variance decompositions are available in both orthogonalized and generalized forms. The orthogonalized outputs (IRFs and FEVDs) are computed using a short-run recursive identification scheme, meaning they depend on the ordering of the selected risk factors. Specifically, the package is structured to place global unspanned factors first, followed by its domestic unspanned and spanned factors within each country, in the order in which countries are listed in the \texttt{Economies} vector. In contrast, the generalized versions (GIRFs and GFEVDs) are robust to factor ordering but allow for correlated shocks across risk factors \citep{PesaranShin1998}. For the numerical computation of these outputs, a horizon of analysis has to be specified, \emph{e.g.}, \texttt{Horiz\ \textless{}-\ 100}.

The bond yield decomposition can be performed with respect to two measures of risk compensation: term premia and forward premia. While the term premium is derived directly from the bond yield levels, the forward premium is obtained from the decomposition of forward rates. A more formal presentation of both measures is provided in the Appendix.

Users must specify the desired graph types in a character vector. Available options include: \texttt{RiskFactors}, \texttt{Fit}, \texttt{IRF}, \texttt{FEVD}, \texttt{GIRF}, \texttt{GFEVD}, and \texttt{TermPremia}. For example:

\begin{verbatim}
DesiredGraphs <- c("Fit", "GIRF", "GFEVD", "TermPremia")
\end{verbatim}

Moreover, for all models, users must indicate the types of variables of interest (yields, risk factors, or both). For JLL-type models specifically, users must also specify whether to include the orthogonalized versions. Each of these options should be set to \texttt{TRUE} to generate the corresponding graphs, and \texttt{FALSE} otherwise.

\begin{verbatim}
WishGraphRiskFac <- FALSE
WishGraphYields <- TRUE
WishOrthoJLLgraphs <- FALSE
\end{verbatim}

The desired graphical outputs are stored in the selected folder, \texttt{Folder2Save}. Alternatively, users can display the desired plots directly in the console without saving them to \texttt{Folder2Save} by using the \texttt{autoplot()} method.

\subsubsection{Bootstrap settings}\label{S:SectionBootstrap}

\citet{Horowitz2019} shows that bootstrap methods generally produce more accurate statistical inference than those based on asymptotic distribution theory. To generate confidence intervals
using bootstrap, via the \texttt{Bootstrap()} function, an additional list of inputs must be provided:

\begin{itemize}
\tightlist
\item
  Desired bootstrap procedure (\texttt{methodBS}): the user must select one of the following options: \emph{(i)} standard residual bootstrap (\texttt{bs}); \emph{(ii)} wild bootstrap (\texttt{wild}); or \emph{(iii)} block bootstrap (\texttt{block}). If the block bootstrap is selected, the block length must also be specified.
  The residual bootstrap is a conventional method that is straightforward to implement when a parametric model, such as a VAR model, is available. The block bootstrap makes weaker assumptions about the data-generating process and is well-suited to handling both weak and strong serial dependence. The wild bootstrap is particularly appropriate for data exhibiting heteroskedasticity \citep{Horowitz2019};
\item
  Number of bootstrap draws (\texttt{ndraws}): \citet{KilianLutkepohl2017} suggest that, in VAR specifications, \texttt{ndraws} can range from a few hundred to several thousand, depending on factors such as sample size, lag order, and the desired quantiles of the distribution. Illustrating this, CM (2024) set \(ndraws= 1,000\) in their ATSM to construct confidence intervals for IRFs;
\item
  Confidence level expressed (\texttt{pctg}): the desired confidence level should be expressed in percentage points. Common choices in VAR-related setups include \(68\%\), \(90\%\) and \(95\%\) \citep{KilianLutkepohl2017}.
\end{itemize}

\begin{verbatim}
Bootlist <- list(methodBS = 'block', BlockLength = 4, ndraws =  1000, pctg   =  95)
\end{verbatim}

\subsubsection{Out-of-sample forecast settings}\label{S:SectionForecast}

To generate bond yield forecasts, use \texttt{ForecastYields()} with the following inputs:

\begin{itemize}
\tightlist
\item
  Forecast horizon (\texttt{ForHoriz}): Number of forecast horizons in periods;
\item
  Index of the first observation (\texttt{t0Sample}): time index of the first observation included in the information set;
\item
  Index of the last observation (\texttt{t0Forecast}): time index of the last observation in the information set used to generate the first forecast;
\item
  Method used for forecast computation (\texttt{ForType}): forecasts can be generated using either a rolling or expanding window. To use a rolling window, set this parameter to \texttt{Rolling}. In this case, the sample length for each forecast is fixed and defined by \texttt{t0Sample}. For expanding window forecasts, set this input to \texttt{Expanding}, allowing the information set to increase at each forecast iteration.
\end{itemize}

\begin{verbatim}
ForecastList <- list(ForHoriz = 12, t0Sample = 1, t0Forecast = 70, ForType = "Rolling")
\end{verbatim}

\section{Model estimation}\label{S:SectionEstimation}

Using the dataset described in Section~\hyperref[S:SectionData]{4}, the estimation of the ATSM proceeds in three main steps. First, the country-specific spanned factors are estimated, which, along with the global and domestic unspanned factors, form the complete set of risk factors used in the subsequent estimation steps. Second, the package estimates the parameters governing the dynamics of the risk factors under the \(\mathbb{P}\)-measure. Finally, it optimizes the full ATSM specification, including the parameters under the \(\mathbb{Q}\)-measure.

As will be made clear in Section~\hyperref[S:SectionImplementation]{7}, although the functions introduced in this section can be used individually, they are primarily designed to be used together with the broader set of functions available in the \CRANpkg{MultiATSM} package. However, as these functions play a central role in the package structure, they warrant a dedicated section.

\subsection{Spanned factors}\label{S:SpaFac}

The spanned factors for country \(i\), denoted by \(\boldsymbol{P_{i,t}}\), are typically obtained as the first \(N\) principal components (PCs) of the observed bond yields. The PC method provides orthogonal linear combinations of the original variables, ordered by their ability to capture the variance in the data. Formally, \(\boldsymbol{P_{i,t}}\) is computed as \(\boldsymbol{P_{i,t}} = w_i \boldsymbol{Y_{i,t}}\), where yields are ordered by increasing maturity in \(\boldsymbol{Y_{i,t}}\), and \(w_i\) is the matrix of eigenvectors derived from the covariance matrix of \(\boldsymbol{Y_{i,t}}\).

In the case of \(N = 3\), the spanned factors are traditionally interpreted as level, slope, and curvature components of the yield curve \citep{LittermanScheinkman1991}. This interpretation stems from the properties of the \(w_i\) matrix, as illustrated below:

\begin{verbatim}
data('Yields')
w <- pca_weights_one_country(Yields, Economy = "Uruguay")
\end{verbatim}

In matrix \emph{w}, each row holds the weights for constructing a spanned factor. The first row relates to the level factor, with weights loading roughly equally across maturities. As such, high (low) values of the level factor indicate an overall high (low) value of yields across all maturities. The second row features increasing weights with maturity, capturing the slope of the yield curve: high values indicate steep curves, while low values reflect flat or inverted curves. The third row corresponds to the curvature factor, with weights emphasizing medium-term maturities. This captures the `hump-shaped' features of the yield curve typically associated with changes in its curvature. These concepts are also graphically illustrated in Figure \ref{fig:pca-L}.

\begin{figure}
\centering
\pandocbounded{\includegraphics[keepaspectratio,alt={\label{fig:pca-L}Yield loadings on the spanned factors. Example using bond yield data for Uruguay. Graph was generated using the ggplot2 package .}]{MultiATSM_files/figure-latex/pca-L-1.pdf}}
\caption{\label{fig:pca-L}Yield loadings on the spanned factors. Example using bond yield data for Uruguay. Graph was generated using the ggplot2 package \citep{ggplot22016}.}
\end{figure}

The user can directly obtain the time series of the country-specific spanned factors by calling \texttt{Spanned\_Factors()}, as shown below:

\begin{verbatim}
data('Yields')
Economies <- c("China", "Brazil", "Mexico", "Uruguay")
N <- 2
SpaFact <- Spanned_Factors(Yields, Economies, N)
\end{verbatim}

\subsection{The P-dynamics estimation}\label{S:PdynEst}

As presented in Table \ref{tab:tab-ModFea-L} and explained in detail in Section~\hyperref[S:ATSMTheory]{2}, the dynamics of the risk factors under the \(\mathbb{P}\)-measure in the available models follow a VAR(1) process. This specification can be fully unrestricted, as in the JPS-related models, or subject to restrictions, as in the GVAR and JLL frameworks. This subsection illustrates how each of these model configurations is implemented.

\subsubsection{VAR}\label{S:SectionVAR}

To use \texttt{VAR()}, the user needs to select the appropriate set of risk factors for the model being estimated and specify \texttt{unconstrained} in the argument \texttt{VARtype}. In the two examples presented below, the outputs are the intercept vector, the feedback matrix, and the variance--covariance matrix for a VAR(1) model under the \(\mathbb{P}\)-measure:

\begin{verbatim}
# Example 1: "JPS global" and "JPS multi" models
data("RiskFacFull")
PdynPara <- VAR(RiskFacFull, VARtype = "unconstrained")

# Example 2: "JPS original" model for China 
FactorsChina <- RiskFacFull[1:7, ]
PdynPara <- VAR(FactorsChina, VARtype = "unconstrained")
\end{verbatim}

\subsubsection{GVAR}\label{S:SectionGVAR}

The \texttt{GVAR()} function estimates a GVAR(1) model constructed from country-specific VARX\(^{*}(1,1,1)\) specifications. It requires two main inputs: the number of domestic spanned factors (\(N\)) and a set of elements grouped in the \texttt{GVARinputs} list. The latter consists of four components:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Economies: a \(C-\)dimensional character vector containing the names of the economies present in the economic system;
\item
  GVAR list of risk factors: a list of risk factors sorted by country in addition to the global variables. An example of the expected data structure is:
\end{enumerate}

\begin{verbatim}
data("GVARFactors")
\end{verbatim}

To assist in formatting the data accordingly, users may use the \texttt{DatabasePrep()} function;

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  VARX type: a character vector specifying the desired structure of the VARX\(^{*}\) model. Two general options are available:
\end{enumerate}

\begin{itemize}
\item
  Fully unconstrained: specify as \texttt{unconstrained}. This option estimates each equation in the system separately via ordinary least squares, without imposing any restrictions.
\item
  With constraints: imposes specific set of zero restrictions on the feedback matrix. This category includes two sub-options:
  \emph{(a)} \texttt{constrained:\ Spanned\ Factors} prevents foreign spanned factors from affecting any domestic risk factor;
  \emph{(b)} \texttt{constrained:\ {[}factor\ name{]}} restricts the specified risk factor to be influenced only by its own lags and the lags of its associated star variables. In both cases, the VARX\(^{*}\) is estimated using restricted least squares.
\end{itemize}

\begin{verbatim}
data('GVARFactors')
GVARinputs <- list(Economies = Economies, GVARFactors = GVARFactors, 
                   VARXtype ="constrained: Inflation")
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Transition matrix: a \(C \times C\) matrix that captures the degree of interdependence across the countries in the system. Each entry \((i,j)\) represents the strength of the dependence of economy \(i\) on economy \(j\). As an example, the matrix below is computed from bilateral trade flow data, averaged over the period 2006--2019, for a system comprising China, Brazil, Mexico, and Uruguay. The rows are normalized so that the weights sum to \(1\) for each country (i.e., each row of the matrix sums to \(1\)).
  The transition matrix can be generated using \texttt{Transition\_Matrix()}, as illustrated in the Appendix :
\end{enumerate}

\begin{verbatim}
#>          China Brazil Mexico Uruguay
#> China   0.0000 0.6549 0.3155  0.0296
#> Brazil  0.8269 0.0000 0.1234  0.0497
#> Mexico  0.8596 0.1326 0.0000  0.0078
#> Uruguay 0.3811 0.5498 0.0691  0.0000
\end{verbatim}

With inputs specified, the user can estimate a GVAR model using:

\begin{verbatim}
data("GVARFactors")
GVARinputs <- list(Economies = Economies, GVARFactors = GVARFactors,  
                   VARXtype = "unconstrained", Wgvar = W_gvar)
N <- 3
GVARpara <- GVAR(GVARinputs, N, CheckInputs = TRUE)
\end{verbatim}

Note that the \texttt{CheckInputs} parameter should be set to TRUE to perform a consistency check on the inputs specified in \texttt{GVARinputs} prior to the \(\mathbb{P}\)-dynamics estimation.

\subsubsection{JLL}\label{S:SectionJLL}

The \texttt{JLL()} function estimates the physical parameters. Required inputs are:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Risk factors: a time series matrix of the risk factors in their non-orthogonalized form;
\item
  Number of spanned factors (\(N\)): a scalar representing the number of country-specific spanned factors;
\item
  \texttt{JLLinputs}: a list object containing the following elements:
\end{enumerate}

\begin{itemize}
\item
  Economies: a \(C\)-dimensional character vector listing the economies;
\item
  Dominant Economy: a character vector indicating either the name of the country assigned as the dominant economy (for \texttt{JLL\ original} and \texttt{JLL\ jointSigma} models), or \texttt{None} (for the \texttt{JLL\ No\ DomUnit} case);
\item
  Estimate Sigma Matrices: a logical equal to \texttt{TRUE} if the user wishes to estimate the full set of JLL sigma matrices (i.e., variance-covariance and Cholesky factor matrices), and \texttt{FALSE} otherwise. Since this numerical estimation is costly, it may significantly increase computation time;
\item
  Precomputed Variance-Covariance Matrix: in some instances, a precomputed variance-covariance matrix from the non-orthogonalized dynamics can be supplied here to save time and memory. If no such matrix is available, this input should be set to \texttt{NULL};
\item
  JLL type: a character string specifying the chosen JLL model, following the classification described in Table \ref{tab:tab-ModFea-L}.
\end{itemize}

\begin{verbatim}
# First set the JLLinputs 
ModelType <- "JLL original"   
JLLinputs <- list(Economies = Economies, DomUnit = "China", WishSigmas = TRUE,  
                  SigmaNonOrtho = NULL, JLLModelType = ModelType)

# Then, estimate the desired the P-dynamics from the desired JLL model
data("RiskFacFull")
N <- 3
JLLpara <- JLL(RiskFacFull, N, JLLinputs, CheckInputs = TRUE)
\end{verbatim}

The \texttt{CheckInputs} input is set to \texttt{TRUE} to perform a consistency check on the inputs specified in \texttt{JLLinputs} before running the \(\mathbb{P}\)-dynamics estimation.

\subsection{ATSM estimation}\label{atsm-estimation}

Estimating the ATSM parameters involves maximizing the log-likelihood function to obtain the best-fitting model parameters using \texttt{Optimization()}. The unspanned risk factor framework of JPS (2014) (and, therefore, all its multicountry extensions) follows a model parameterization similar to that proposed in \citet{JoslinSingletonZhu2011}. Particularly, it requires estimating a set of six parameter blocks:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  The risk-neutral long-run mean of the short rate (\(r0\));
\item
  The risk-neutral feedback matrix (\(K1XQ\));
\item
  Standard deviation of measurement errors for yields observed with error (\(se\));
\item
  The variance-covariance matrix from the VAR process (\(SSZ\));
\item
  The intercept matrix of the physical dynamics (\(K0Z\));
\item
  The feedback matrix of the physical dynamics (\(K1Z\)).
\end{enumerate}

The parameters \(K0Z\) and \(K1Z\) have closed-form solutions. Similarly, \(r0\) and \(se\) are derived analytically and are factored out of the log-likelihood function. In contrast, the remaining parameters, \(K1XQ\) and \(SSZ\), must be estimated numerically.

The optimization routine in \CRANpkg{MultiATSM} combines the \texttt{NelderMead} and \texttt{L-BFGS-B} algorithms, executed sequentially and repeated until convergence is achieved. At each iteration, the parameter vector yielding the highest likelihood is retained, enhancing robustness to local optima without resorting to full multi-start procedures. Convergence is achieved when the absolute change in the mean log-likelihood falls below a user-defined tolerance (default \(10^{-4}\)). For the bootstrap replications, the same optimization procedure is applied; however, only the \texttt{NelderMead} algorithm is used to reduce computation time.

\section{Full implementation of ATSMs}\label{S:SectionImplementation}

\subsection{Package workflow}\label{package-workflow}

The complete workflow of the \CRANpkg{MultiATSM} package is built around seven core functions, which together support a streamlined and modular process. An overview of these functions is provided below:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \texttt{LabFac()}: returns a list of risk factor labels used throughout the package. In particular, these labels assist in structuring sub-function inputs and generating variable and graph labels in a parsimonious manner;
\item
  \texttt{InputsForOpt()}: collects and processes the inputs needed to build the likelihood function as specified in Section~\hyperref[S:SectionInputs]{5}. It estimates the model's \(\mathbb{P}\)-dynamics and returns an object of class \emph{ATSMModelInputs}, which includes \texttt{print()} and \texttt{summary()} S3 methods. The \texttt{print()} method summarizes model inputs and system features, while \texttt{summary()} reports statistics on risk factors and bond yields;
\item
  \texttt{Optimization()}: performs the estimation of the model parameters, primarily the \(\mathbb{Q}\)-dynamics, using numerical optimization. This function returns a comprehensive list of the model's point estimates and can be computationally intensive;
\item
  \texttt{InputsForOutputs()}: an auxiliary function that compiles the necessary elements for producing numerical and graphical outputs. It also creates separate folders in the user's \texttt{Folder2Save} directory to store the generated figures;
\item
  \texttt{NumOutputs()}: produces the numerical outputs as selected in Section~\hyperref[S:SectionNumOut]{5.3}, based on the model's point estimates. The function returns an object of class \emph{ATSMNumOutputs}, for which an \texttt{autoplot()} S3 method is available. This method provides a convenient way to visualize the selected graphical outputs;
\item
  \texttt{Bootstrap()}: computes confidence bounds for the numerical outputs using the bootstrap procedures defined in Section~\hyperref[S:SectionNumOut]{5.3} (subsection ``Bootstrap settings''). The function returns an \emph{ATSMModelBoot} object, which can be accessed via the \texttt{autoplot()} S3 method to generate the desired graphical outputs with confidence intervals. As this step involves repeated model estimation, it may require several hours (possibly days) to complete;
\item
  \texttt{ForecastYields()}: generates bond yield forecasts and the corresponding forecast errors according to the specifications outlined in Section~\hyperref[S:SectionNumOut]{5.3} (subsection ``Out-of-sample forecast settings''). This function returns an object of class \emph{ATSMModelForecast}, accesible via the \texttt{plot()} S3 method, which displays Root Mean Squared Errors (RMSEs) by country and forecast horizon.
\end{enumerate}

\subsection{Complete implementation}\label{complete-implementation}

This section illustrates how to fully implement ATSMs using the \CRANpkg{MultiATSM} package. A simplified two-country \texttt{JPS\ original} framework serves as the example. The implementation steps are outlined below, and a sample of graphical outputs are presented in Figures \ref{fig:FitYields} -- \ref{fig:TermPremia}.

\begin{verbatim}
library(MultiATSM)
# 1) USER INPUTS
# A) Load database data
LoadData("CM_2024")

# B) GENERAL model inputs
ModelType <- "JPS original" 
Economies <- c("China", "Brazil") 
GlobalVar <- c("Gl_Eco_Act") 
DomVar <- c("Eco_Act") 
N <- 2  
t0_sample <- "01-05-2005" 
tF_sample <- "01-12-2019" 
OutputLabel <- "Test" 
DataFreq <-"Monthly"
Folder2Save <- NULL
StatQ <- FALSE 

# B.1) SPECIFIC model inputs
# GVAR-based models 
GVARlist <- list( VARXtype = "unconstrained", W_type = "Sample Mean", t_First_Wgvar = "2005",
                  t_Last_Wgvar = "2019", DataConnectedness = TradeFlows ) 

# JLL-based models 
JLLlist <- list(DomUnit =  "China")

# BRW inputs  
WishBC <- FALSE 
BRWlist <- within(list(Cent_Measure = "Mean", gamma = 0.05, N_iter = 250, B = 50, checkBRW = TRUE,
                       B_check = 1000, Eigen_rest = 1),  N_burn <- round(N_iter * 0.15))

# C) Decide on Settings for numerical outputs
WishFPremia <- TRUE 
FPmatLim <- c(60,120) 
                      
Horiz <- 30
DesiredGraphs <- c() 
WishGraphRiskFac <- FALSE
WishGraphYields <- FALSE
WishOrthoJLLgraphs <- FALSE

# D) Bootstrap settings
WishBootstrap <- TRUE 
BootList <- list(methodBS = 'bs', BlockLength = 4, ndraws = 5, pctg =  95)

# E) Out-of-sample forecast
WishForecast <- TRUE 
ForecastList <- list(ForHoriz = 12,  t0Sample = 1, t0Forecast = 162, ForType = "Rolling")

##########################################################################################
# NO NEED TO MAKE CHANGES FROM HERE:
# The sections below automatically process the inputs provided above, run the model 
# estimation, generate the numerical and graphical outputs, and save results.

# 2) Minor preliminary work: get the sets of factor labels
FactorLabels <- LabFac(N, DomVar, GlobalVar, Economies, ModelType)

# 3) Prepare the inputs of the likelihood function
ATSMInputs <- InputsForOpt(t0_sample, tF_sample, ModelType, Yields, GlobalMacro, 
                           DomMacro, FactorLabels, Economies, DataFreq, GVARlist, 
                           JLLlist, WishBC, BRWlist)

# 4) Optimization of the ATSM (Point Estimates)
ModelParaList <- Optimization(ATSMInputs, StatQ, DataFreq, FactorLabels, Economies, ModelType)

# 5) Numerical and graphical outputs
# a) Prepare list of inputs for graphs and numerical outputs
InputsForOutputs <- InputsForOutputs(ModelType, Horiz, DesiredGraphs, OutputLabel, StatQ, 
                                     DataFreq, WishGraphYields, WishGraphRiskFac, 
                                     WishOrthoJLLgraphs, WishFPremia, 
                                     FPmatLim, WishBootstrap, BootList, 
                                     WishForecast, ForecastList)
                                     
# b) Fit, IRF, FEVD, GIRF, GFEVD, and Term Premia
NumericalOutputs <- NumOutputs(ModelType, ModelParaList, InputsForOutputs, 
                               FactorLabels, Economies, Folder2Save)

# c) Confidence intervals (bootstrap analysis)
BootstrapAnalysis <- Bootstrap(ModelType, ModelParaList, NumericalOutputs, Economies, 
                               InputsForOutputs, FactorLabels, JLLlist, GVARlist, 
                               WishBC, BRWlist, Folder2Save)

# 6) Out-of-sample forecasting
Forecasts <- ForecastYields(ModelType, ModelParaList, InputsForOutputs, FactorLabels, 
                            Economies, JLLlist, GVARlist, WishBC, BRWlist, 
                            Folder2Save)
\end{verbatim}

\begin{figure}
\includegraphics[width=1\linewidth]{MultiATSM_files/figure-latex/FitYields-1} \caption{Chinese bond yield maturities with model fit comparisons. \emph{Model-fit} reflects estimation using only risk-neutral ($\mathbb{Q}$) dynamics parameters, while \emph{Model-implied} incorporates both physical ($\mathbb{P}$) and risk-neutral ($\mathbb{Q}$) dynamics. The $x$-axes represent time in months and the $y$-axis is in natural units.}\label{fig:FitYields}
\end{figure}

\begin{figure}
\includegraphics[width=1\linewidth]{MultiATSM_files/figure-latex/IRF-1} \caption{IRFs from the Brazilian bond yields to global economic activity. Size of the shock is one-standard deviation. The black lines are the point estimates. Gray dashed lines are the bounds of the 95\% confidence intervals and the green lines correspond to the median of these intervals. The $x$-axes are expressed in months and the $y$-axis is in natural units.}\label{fig:IRF}
\end{figure}

\begin{figure}
\includegraphics[width=1\linewidth]{MultiATSM_files/figure-latex/FEVD-1} \caption{FEVD from the Brazilian bond yield with maturity 60 months. The $x$-axis represents the forecast horizon in months and the $y$-axis is in natural units.}\label{fig:FEVD}
\end{figure}

\begin{figure}
\includegraphics[width=1\linewidth]{MultiATSM_files/figure-latex/TermPremia-1} \caption{Chinese sovereign yield curve decomposition showing (i) expected future short rates and (ii) term premia components. The $x$-axis represents time in months and the $y$-axis is expressed in percentage points.}\label{fig:TermPremia}
\end{figure}

\section{Concluding remarks}\label{concluding-remarks}

The \CRANpkg{MultiATSM} package aims to advance yield curve (term structure) modelling within the R programming environment. It provides a comprehensive yet user-friendly toolkit for practitioners, academics, and policymakers, featuring estimation routines and generating detailed outputs across several macrofinance model classes. This allows for an in-depth exploration of the relationship between the real economy developments and the fixed income markets.

The package covers eight classes of macrofinance term structure models, all built upon the single-country unspanned macroeconomic risk framework of \citet{JoslinPriebschSingleton2014}, which is also extended to a multicountry setting. Additional multicountry variants based on \citet{JotikasthiraLeLundblad2015} and \citet{CandelonMoura2024} are included, incorporating, respectively, a dominant economy and a GVAR structure to model cross-country interdependence.

Each model class provides analytical outputs that offer insight into term structure dynamics, including plots of model fit, risk premia, impulse responses, and forecast error variance decompositions.The \CRANpkg{MultiATSM} package also offers bootstrap procedures for confidence interval construction and out-of-sample forecasting of bond yields.

\section*{Acknowledgments}\label{acknowledgments}
\addcontentsline{toc}{section}{Acknowledgments}

I thank the editor, Rob Hyndman, and an anonymous referee for several helpful comments. I am also grateful to Bertrand Candelon, Adhir Dhoble and Gustavo Torregrosa for many insightful discussions. An earlier version of this paper circulated under the title \emph{MultiATSM: An R Package for Arbitrage-Free Multicountry Affine Term Structure of Interest Rate Models with Unspanned Macroeconomic Risk} and was part of the author's PhD dissertation at UCLouvain \citep{Moura2022}. The views expressed in this paper are those of the author and do not necessarily reflect those of Banco de Mexico.

\section*{Appendix}\label{appendix}
\addcontentsline{toc}{section}{Appendix}

\subsection*{A: Supplementary functions}\label{a-supplementary-functions}
\addcontentsline{toc}{subsection}{A: Supplementary functions}

\subsubsection{Importing data from Excel files}\label{importing-data-from-excel-files}

The \CRANpkg{MultiATSM} package also provides an automated procedure for importing data from Excel files via \texttt{Load\_Excel\_Data()} and preparing the risk factor database used directly in the model estimation. To ensure compatibility with the package functions, the following requirements must be met:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Databases must be organized in separate Excel files: one for unspanned factors and another for term structure data. For GVAR-based models, a third file containing the interdependence measures is also required;
\item
  Each Excel file should include one tab per country. In the case of unspanned factors, an additional tab must be included for the global variables if the user opts to incorporate them;
\item
  Variable names must be identical across all tabs within each file.
\end{enumerate}

An example Excel file meeting these requirements is provided with the package. Below is an example of how to import the data from excel and construct the input list to be supplied:

\begin{verbatim}
MacroData  <- Load_Excel_Data(system.file("extdata", "MacroData.xlsx", 
                                          package = "MultiATSM"))
YieldsData <- Load_Excel_Data(system.file("extdata", "YieldsData.xlsx", 
                                          package = "MultiATSM"))
\end{verbatim}

\begin{verbatim}
ModelType <- "JPS original"
Initial_Date <- "2006-09-01"
Final_Date <- "2019-01-01"
DataFrequency <- "Monthly"
GlobalVar <- c("GBC", "VIX")
DomVar <- c("Eco_Act", "Inflation", "Com_Prices", "Exc_Rates")
N <- 3
Economies <- c("China", "Mexico", "Uruguay", "Brazil", "Russia")
\end{verbatim}

These inputs are used to construct the \emph{RiskFactorsSet} variable, which holds the full collection of risk factors required by the model.

\begin{verbatim}
FactorLabels <- LabFac(N, DomVar, GlobalVar, Economies, ModelType)
RiskFactorsSet <- DataForEstimation(Initial_Date, Final_Date, Economies, N, FactorLabels,
                                    ModelType, DataFrequency, MacroData, YieldsData)
\end{verbatim}

\subsubsection{Transition matrix and star factors}\label{transition-matrix-and-star-factors}

To construct the transition matrix for GVAR specifications, the user can employ \texttt{Transition\_Matrix()}. This function requires:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Data selection: choose proxies for cross-country interdependence.
\item
  Time frame: specify the sample's start and end dates.
\item
  Dependence measure: select from:
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Time-varying (dynamic weights)
\item
  Sample Mean (static average)
\item
  A numeric scalar (fixed-year snapshot).
\end{itemize}

\begin{verbatim}
data("TradeFlows")
t_First <- "2006"
t_Last <- "2019"
Economies <- c("China", "Brazil", "Mexico", "Uruguay")
type <- "Sample Mean"
W_gvar <- Transition_Matrix(t_First, t_Last, Economies, type, TradeFlows)
\end{verbatim}

Note that if data is missing for any country in a given year, the corresponding transition matrix will contain only \texttt{NA}s.

A more flexible approach to modelling interdependence is to allow the transition matrix to vary over time. In this case, the star factors are constructed using trade flow weights specific to each year, adjusting the corresponding year's risk factors accordingly. To enable this feature, users must set the \texttt{type} argument to \texttt{Time-varying} and specify the same year for both the initial and final periods in the transition matrix. This indicates that the trade weights from that particular year is used when solving the GVAR system (i.e., in the construction of the link matrices, see Equation \eqref{eq:LinkMatequation}).

\subsection*{B: Additional theoretical considerations}\label{b-additional-theoretical-considerations}
\addcontentsline{toc}{subsection}{B: Additional theoretical considerations}

\subsubsection{Bond yield decomposition}\label{bond-yield-decomposition}

The \CRANpkg{MultiATSM} package allows for the calculation
of two risk compensation measures: term premia and forward premia. Assume that an \(n\)-maturity bond yield can be decomposed into two components: the expected short-rate (\(\mathrm{Exp}_{i,t}^{(n)}\)) and term premia
(\(\mathrm{TP}_{i,t}^{(n)}\)).
Technically: \[
y_{i,t}^{(n)} = \mathrm{Exp}_{i,t}^{(n)} + \mathrm{TP}_{i,t}^{(n)} \text{.}
\] In the package's standard form, the expected short rate term is
computed from time \(t\) to \(t+n\), which represents the bond's maturity:
\(\mathrm{Exp}_{i,t}^{(n)} = \sum_{h=0}^{n} E_t[y_{i, t+h}^{(1)}]\). Alternatively,
the decomposition for the forward rates (\(f_{i,t}^{(n)}\)) is
\(f_{i,t}^{(n)} = \sum_{h=m}^{n} E_t[y_{i,t+h}^{(1)}] + \mathrm{FP}_{i,t}^{(n)}\) where
\(\mathrm{FP}_{i,t}^{(n)}\) corresponds to the forward premia. In this case, the user
must specify \texttt{TRUE} if the computation of forward
premia is desired, or \texttt{FALSE} otherwise. If set to \texttt{TRUE}, the user must also
provide a two-element numerical vector containing the maturities
corresponding to the starting and ending dates of the bond maturity.
Example:

\begin{verbatim}
    WishFPremia <- TRUE  
    FPmatLim <- c(60, 120)
\end{verbatim}

\subsection*{C: Replication of existing research}\label{c-replication-of-existing-research}
\addcontentsline{toc}{subsection}{C: Replication of existing research}

\subsubsection{Joslin, Priebisch and Singleton (2014)}\label{joslin-priebisch-and-singleton-2014}

The dataset used in this replication was constructed by \citet{BauerRudebusch2017} (henceforth BR, 2017) and is available on Bauer's website. In their paper, BR (2017) investigate whether macrofinance term structure models are better suited to the unspanned macro risk framework of JPS (2014) or to earlier, traditional spanned settings such as \citet{AngPiazzesi2003}. To that end, BR (2017) replicate selected empirical results from JPS (2014). The corresponding R code is also available on Bauer's website.

Using the dataset from BR (2017), the code below applies the \CRANpkg{MultiATSM} package to estimate the key ATSM parameters following the \texttt{JPS\ original} modelling setup.

\begin{verbatim}
# 1) INPUTS
# A) Load database data
LoadData("BR_2017")

# B) GENERAL model inputs
ModelType <- "JPS original"

Economies <- c("US") 
GlobalVar <- c() 
DomVar <- c("GRO", "INF")
N <- 3 
t0_sample <- "January-1985"
tF_sample <- "December-2007"
DataFreq <- "Monthly" 
StatQ <- FALSE 

# 2) Minor preliminary work
FactorLabels <- LabFac(N, DomVar, GlobalVar, Economies, ModelType) 
Yields <- t(BR_jps_out$Y)
DomesticMacroVar <- t(BR_jps_out$M.o)
GlobalMacroVar <- c()

# 3) Prepare the inputs of the likelihood function
ATSMInputs <- InputsForOpt(t0_sample, tF_sample, ModelType, Yields, GlobalMacroVar, 
                           DomesticMacroVar, FactorLabels, Economies, DataFreq)

# 4) Optimization of the model
ModelPara <- Optimization(ATSMInputs, StatQ, DataFreq, FactorLabels, Economies, ModelType)
\end{verbatim}

The tables below compare the ATSM parameter estimates generated from BR (2017) and the \CRANpkg{MultiATSM}. Table \ref{tab:QdynTab-L} reports the risk-neutral parameters. While the values presented do not match exactly, the differences are well within convergence tolerance and are arguably economically negligible. Table \ref{tab:PdynTab-L}, by contrast, contains parameters related to the model's time-series dynamics. As these are derived in closed form, the estimates are exactly the same under both specifications.

\begin{table}[!h]
\centering
\caption{\label{tab:QdynTab-L}$Q$-dynamics parameters}
\centering
\fontsize{7}{9}\selectfont
\begin{tabular}[t]{lrr}
\toprule
  & MultiATSM & BR (2017)\\
\midrule
$r_0$ & $0.0006$ & $-0.0002$\\
$\lambda_1$ & $0.9967$ & $0.9968$\\
$\lambda_2$ & $0.9149$ & $0.9594$\\
$\lambda_3$ & $0.9149$ & $0.8717$\\
\bottomrule
\end{tabular}
\end{table}

\vspace{-2.0em}
\begin{center}
\footnotesize Note: $\lambda$'s are the eigenvalues from the risk-neutral feedback matrix and $r_0$ is the long-run mean of the short rate under $\mathbb{Q}$.
\end{center}

\begin{table}[!h]
\centering
\caption{\label{tab:PdynTab-L}$P$-dynamics parameters}
\centering
\fontsize{7}{9}\selectfont
\begin{tabular}[t]{lcccccc}
\toprule
\multicolumn{1}{c}{\textbf{ }} & \multicolumn{1}{c}{\textbf{K0Z}} & \multicolumn{5}{c}{\textbf{K1Z}} \\
\cmidrule(l{3pt}r{3pt}){2-2} \cmidrule(l{3pt}r{3pt}){3-7}
  &   & PC1 & PC2 & PC3 & GRO & INF\\
\midrule
\addlinespace[0.3em]
\multicolumn{7}{l}{\textbf{BR (2017)}}\\
\hspace{1em}PC1 & $\phantom{0}\phantom{0}0.0781$ & $\phantom{0}\phantom{0}0.9369$ & $\phantom{0}\text{-}0.0131$ & $\phantom{0}\text{-}0.0218$ & $\phantom{0}\phantom{0}0.1046$ & \vphantom{1} $\phantom{0}\phantom{0}0.1003$\\
\hspace{1em}PC2 & $\phantom{0}\phantom{0}0.0210$ & $\phantom{0}\phantom{0}0.0058$ & $\phantom{0}\phantom{0}0.9781$ & $\phantom{0}\phantom{0}0.1703$ & $\phantom{0}\text{-}0.1672$ & \vphantom{1} $\phantom{0}\text{-}0.0402$\\
\hspace{1em}PC3 & $\phantom{0}\phantom{0}0.1005$ & $\phantom{0}\text{-}0.0104$ & $\phantom{0}\text{-}0.0062$ & $\phantom{0}\phantom{0}0.7835$ & $\phantom{0}\text{-}0.0399$ & \vphantom{1} $\phantom{0}\phantom{0}0.0437$\\
\hspace{1em}GRO & $\phantom{0}\phantom{0}0.0690$ & $\phantom{0}\text{-}0.0048$ & $\phantom{0}\phantom{0}0.0180$ & $\phantom{0}\text{-}0.1112$ & $\phantom{0}\phantom{0}0.8818$ & \vphantom{1} $\phantom{0}\text{-}0.0025$\\
\hspace{1em}INF & $\phantom{0}\phantom{0}0.0500$ & $\phantom{0}\phantom{0}0.0018$ & $\phantom{0}\phantom{0}0.0064$ & $\phantom{0}\text{-}0.0592$ & $\phantom{0}\phantom{0}0.0277$ & \vphantom{1} $\phantom{0}\phantom{0}0.9859$\\
\addlinespace[0.3em]
\multicolumn{7}{l}{\textbf{MultiATSM}}\\
\hspace{1em}PC1 & $\phantom{0}\phantom{0}0.0781$ & $\phantom{0}\phantom{0}0.9369$ & $\phantom{0}\text{-}0.0131$ & $\phantom{0}\text{-}0.0218$ & $\phantom{0}\phantom{0}0.1046$ & $\phantom{0}\phantom{0}0.1003$\\
\hspace{1em}PC2 & $\phantom{0}\phantom{0}0.0210$ & $\phantom{0}\phantom{0}0.0058$ & $\phantom{0}\phantom{0}0.9781$ & $\phantom{0}\phantom{0}0.1703$ & $\phantom{0}\text{-}0.1672$ & $\phantom{0}\text{-}0.0402$\\
\hspace{1em}PC3 & $\phantom{0}\phantom{0}0.1005$ & $\phantom{0}\text{-}0.0104$ & $\phantom{0}\text{-}0.0062$ & $\phantom{0}\phantom{0}0.7835$ & $\phantom{0}\text{-}0.0399$ & $\phantom{0}\phantom{0}0.0437$\\
\hspace{1em}GRO & $\phantom{0}\phantom{0}0.0690$ & $\phantom{0}\text{-}0.0048$ & $\phantom{0}\phantom{0}0.0180$ & $\phantom{0}\text{-}0.1112$ & $\phantom{0}\phantom{0}0.8818$ & $\phantom{0}\text{-}0.0025$\\
\hspace{1em}INF & $\phantom{0}\phantom{0}0.0500$ & $\phantom{0}\phantom{0}0.0018$ & $\phantom{0}\phantom{0}0.0064$ & $\phantom{0}\text{-}0.0592$ & $\phantom{0}\phantom{0}0.0277$ & $\phantom{0}\phantom{0}0.9859$\\
\bottomrule
\multicolumn{7}{l}{\rule{0pt}{1em}\textit{Note: }}\\
\multicolumn{7}{l}{\rule{0pt}{1em}$K0Z$ is the intercept and $K1Z$ is the feedback matrix from the $P$-dynamics.}\\
\end{tabular}
\end{table}

For replicability, it is important to note that the physical dynamics results reported in Table \ref{tab:PdynTab-L} using \CRANpkg{MultiATSM} rely on the principal component weights provided by BR (2017). Such a matrix is simply a scaled-up version of the one provided by the function \texttt{pca\_weights\_one\_country()} of the current package. Accordingly, despite the numerical differences on the weight matrices, both methods generate time series of spanned factors which are perfectly correlated. Another difference between the two approaches relates to the construction of the log-likelihood function: while in the BR (2017) code this is expressed in terms of a portfolio of yields, the \CRANpkg{MultiATSM} package generates this same input directly as a function of observed yields (i.e.~both procedures lead to equivalent log-likelihood vales up to the Jacobian term).

Additionally, it is worth highlighting that the standard deviations for the portfolios of yields observed with errors are nearly identical, matching to seven decimal places: 0.0000546 for \CRANpkg{MultiATSM} and 0.0000550 for BR (2017).

\subsubsection{Candelon and Moura (2024)}\label{candelon-and-moura-2024}

The multicountry framework introduced in \citet{CandelonMoura2024} enhances the tractability of large-scale ATSMs and deepens our understanding of the global economic mechanisms driving domestic yield curve fluctuations. This framework also generates more precise model estimates and enhances the forecasting capabilities of these models. This novel setup, embodied by the \texttt{GVAR\ multi} model class, is benchmarked against the findings of \citet{JotikasthiraLeLundblad2015}, which are captured by the \texttt{JLL\ original} model class. The paper showcases an empirical illustration involving China, Brazil, Mexico, and Uruguay.

\begin{verbatim}
# 1) INPUTS
# A) Load database data
LoadData("CM_2024")

# B) GENERAL model inputs
ModelType <- "GVAR multi" 
Economies <- c("China", "Brazil", "Mexico", "Uruguay")
GlobalVar <- c("Gl_Eco_Act", "Gl_Inflation")
DomVar <- c("Eco_Act", "Inflation")
N <- 3
t0_sample <- "01-06-2004"
tF_sample <- "01-01-2020"
OutputLabel <- "CM_jfec"
DataFreq <-"Monthly"
StatQ <- FALSE

# B.1) SPECIFIC model inputs
# GVAR-based models 
GVARlist <- list( VARXtype = "unconstrained", W_type = "Sample Mean", t_First_Wgvar = "2004",
                  t_Last_Wgvar = "2019", DataConnectedness = TradeFlows )

# JLL-based models 
JLLlist <- list(DomUnit =  "China")

# BRW inputs
WishBC <- TRUE
BRWlist <- within(list(Cent_Measure = "Mean", gamma = 0.001, N_iter = 200, B = 50, checkBRW = TRUE,
                       B_check = 1000, Eigen_rest = 1),  N_burn <- round(N_iter * 0.15))

# C) Decide on Settings for numerical outputs
WishFPremia <- TRUE
FPmatLim <- c(24,36)

Horiz <- 25
DesiredGraphs <- c("GIRF", "GFEVD", "TermPremia")
WishGraphRiskFac <- FALSE
WishGraphYields <- TRUE
WishOrthoJLLgraphs <- TRUE

# D) Bootstrap settings
WishBootstrap <- FALSE 
BootList <- list(methodBS = 'bs', BlockLength = 4, ndraws = 1000, pctg =  95)

# E) Out-of-sample forecast
WishForecast <- TRUE
ForecastList <- list(ForHoriz = 12,  t0Sample = 1, t0Forecast = 100, ForType = "Rolling")

# 2) Minor preliminary work: get the sets of factor labels and  a vector of common maturities
FactorLabels <- LabFac(N, DomVar, GlobalVar, Economies, ModelType)

# 3) Prepare the inputs of the likelihood function
ATSMInputs <- InputsForOpt(t0_sample, tF_sample, ModelType, Yields, GlobalMacro, 
                           DomMacro, FactorLabels, Economies, DataFreq, 
                           GVARlist, JLLlist, WishBC, BRWlist)

# 4) Optimization of the ATSM (Point Estimates)
ModelParaList <- Optimization(ATSMInputs, StatQ, DataFreq, FactorLabels, Economies, ModelType)

# 5) Numerical and graphical outputs
# a) Prepare list of inputs for graphs and numerical outputs
InputsForOutputs <- InputsForOutputs(ModelType, Horiz, DesiredGraphs, OutputLabel, StatQ, 
                                     DataFreq, WishGraphYields, WishGraphRiskFac, 
                                     WishOrthoJLLgraphs, WishFPremia, FPmatLim, 
                                     WishBootstrap, BootList, WishForecast, 
                                     ForecastList)
                                    
# b) Fit, IRF, FEVD, GIRF, GFEVD, and Term Premia
NumericalOutputs <- NumOutputs(ModelType, ModelParaList, InputsForOutputs, 
                               FactorLabels, Economies)

# c) Confidence intervals (bootstrap analysis)
BootstrapAnalysis <- Bootstrap(ModelType, ModelParaList, NumericalOutputs, Economies,
                               InputsForOutputs, FactorLabels, JLLlist, GVARlist, 
                               WishBC, BRWlist)
                               
# 6) Out-of-sample forecasting
Forecasts <- ForecastYields(ModelType, ModelParaList, InputsForOutputs, FactorLabels, 
                            Economies, JLLlist, GVARlist, WishBC, BRWlist)
\end{verbatim}

\subsubsection{Candelon and Moura (2023)}\label{candelon-and-moura-2023}

In this paper, \citet{CandelonMoura2023} investigate the underlying factors that shape the sovereign yield curves of Brazil, India, Mexico, and Russia during the COVID\(-19\) pandemic crisis. The study adopts a \texttt{GVAR\ multi} approach to capture the complex global macrofinancial, and especially health-related interdependencies during the latest pandemic.

\begin{verbatim}
# 1) INPUTS
# A) Load database data
LoadData("CM_2023")

# B) GENERAL model inputs
ModelType <- "GVAR multi"
Economies <- c("Brazil", "India", "Russia", "Mexico")
GlobalVar <- c("US_Output_growth", "China_Output_growth", "SP500")
DomVar <- c("Inflation","Output_growth", "CDS", "COVID")
N <- 2
t0_sample <- "22-03-2020"
tF_sample <- "26-09-2021"
OutputLabel <- "CM_EM"
DataFreq <-"Weekly"
StatQ <- FALSE

# B.1) SPECIFIC model inputs
# GVAR-based models 
GVARlist <- list(VARXtype = "constrained: COVID", W_type = "Sample Mean", 
                 t_First_Wgvar = "2015", t_Last_Wgvar = "2020", 
                 DataConnectedness = TradeFlows_covid)

# BRW inputs  
WishBC <- FALSE

# C) Decide on Settings for numerical outputs
WishFPremia <- TRUE
FPmatLim <- c(47,48)

Horiz <- 12
DesiredGraphs <- c("GIRF", "GFEVD", "TermPremia")
WishGraphRiskFac <- FALSE
WishGraphYields <- TRUE
WishOrthoJLLgraphs <- FALSE

# D) Bootstrap settings
WishBootstrap <- TRUE 
BootList <- list(methodBS = 'bs', BlockLength = 4, ndraws = 100, pctg =  95)

# 2) Minor preliminary work: get the sets of factor labels and  a vector of common maturities
FactorLabels <- LabFac(N, DomVar, GlobalVar, Economies, ModelType)

# 3) Prepare the inputs of the likelihood function
ATSMInputs <- InputsForOpt(t0_sample, tF_sample, ModelType, Yields_covid, GlobalMacro_covid, 
                           DomMacro_covid, FactorLabels, Economies, DataFreq, GVARlist) 
                           
# 4) Optimization of the ATSM (Point Estimates)
ModelParaList <- Optimization(ATSMInputs, StatQ, DataFreq, FactorLabels, Economies, ModelType)

# 5) Numerical and graphical outputs
# a) Prepare list of inputs for graphs and numerical outputs
InputsForOutputs <- InputsForOutputs(ModelType, Horiz, DesiredGraphs, OutputLabel, StatQ, 
                                     DataFreq, WishGraphYields, WishGraphRiskFac, 
                                     WishOrthoJLLgraphs, WishFPremia, FPmatLim,
                                     WishBootstrap, BootList)

# b) Fit, IRF, FEVD, GIRF, GFEVD, and Term Premia
NumericalOutputs <- NumOutputs(ModelType, ModelParaList, InputsForOutputs, FactorLabels, 
                               Economies)

# c) Confidence intervals (bootstrap analysis)
BootstrapAnalysis <- Bootstrap(ModelType, ModelParaList, NumericalOutputs, Economies, 
                               InputsForOutputs, FactorLabels, 
                               JLLlist = NULL, GVARlist)
\end{verbatim}

\bibliography{References.bib}

\address{%
Rubens Moura\\
Banco de Mexico\\%
Avenida 5 de Mayo, 2\\ Mexico City, Mexico\\
%
%
\textit{ORCiD: \href{https://orcid.org/0000-0001-8105-4729}{0000-0001-8105-4729}}\\%
\href{mailto:rubens.guimaraes@banxico.org.mx}{\nolinkurl{rubens.guimaraes@banxico.org.mx}}%
}
