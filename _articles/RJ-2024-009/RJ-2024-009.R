# Generated by `rjournal_pdf_article()` using `knitr::purl()`: do not edit by hand
# Please edit RJ-2024-009.Rmd to modify this file

## ----eval = FALSE, echo = FALSE-----------------------------------------------
# # to be added to the yaml header when compiling to latex
# output:
#   rjtools::rjournal_pdf_article:
#     self_contained: yes
#     toc: no


## ----setup, include=FALSE-----------------------------------------------------
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, comment = NA)

library(shinymgr)
library(fs)
library(rjtools)
library(dplyr)


## ----eval = FALSE-------------------------------------------------------------
# include=knitr::is_latex_output(), eval=knitr::is_latex_output()


## ----fig1, echo = F, out.width = "100%", fig.cap = "Stages of a reproducible workflow, a process that moves an inquiry from raw data to insightful contribution."----
knitr::include_graphics('images/figure1.png')


## ----fig2,  echo = F, out.width = "100%", fig.cap = "Top:  The \"iris\\_explorer\" app guides a user through an analysis of the iris dataset in a tab-based sequence.  Bottom:  A blueprint of the \"iris\\_explorer\" app shows the 5 tabs, each containing a single module identified by name within blue ovals. Some of the shiny modules require inputs and generate outputs as identified in gray polygons.", fig.pos = "h"----
knitr::include_graphics('images/figure2.png')


## ----eval = FALSE, echo =TRUE-------------------------------------------------
# install.packages("shinymgr")


## ----eval = FALSE, echo =TRUE-------------------------------------------------
# remotes::install_gitlab(
#   repo = "vtcfwru/shinymgr",
#   auth_token = Sys.getenv("GITLAB_PAT"),
#   host = "code.usgs.gov",
#   build_vignettes = FALSE)


## ----warning=FALSE, eval = FALSE, echo = TRUE---------------------------------
# # set the directory path that will house the shinymgr project
# parentPath <- getwd()
# 
# # set up raw directories and fresh database
# shinymgr_setup(
#   parentPath = parentPath,
#   demo = TRUE)


## ----comment = NA, echo = FALSE-----------------------------------------------
fs::dir_tree(
  path = "shinymgr",
  recurse = TRUE)


## ----eval = FALSE, echo = TRUE------------------------------------------------
# # launch shinymgr
# launch_shinymgr(shinyMgrPath = paste0(parentPath, "/shinymgr"))


## ----fig3,  echo = F, out.width = "100%", fig.cap = "The shinymgr Developer Portal consists of a sidebar panel where developers can create new shiny modules and new apps, and test-drive analyses and reports from the user's perspective. The main panel shows the \"Build App\" tab within the \"Developer Tools\" section."----
knitr::include_graphics('images/figure3.png')


## ----fig4, echo = FALSE, out.width = "100%", fig.cap = "The 11 tables of the shinymgr SQLite database. Lines indicate how the tables are related to each other.", fig.pos = "b"----
knitr::include_graphics('images/figure4.jpg')


#> #!! ModName = iris_cluster
#> #!! ModDisplayName = Iris K-Means Clustering
#> #!! ModDescription = Clusters iris data based on 2 attributes
#> #!! ModCitation = Baggins, Bilbo.  (2023). iris_cluster. [Source code].
#> #!! ModNotes = Demo module for the shinymgr package.
#> #!! ModActive = 1
#> #!! FunctionReturn = returndf !! selected attributes and their assigned clusters !! data.frame

## ----fig5, echo = FALSE, out.width = "100%", fig.cap= "The shinymgr Developer Portal layout, showing the app builder in the Developer Tools.", fig.pos = "h"----

knitr::include_graphics('images/figure5.png')


## ----echo = TRUE--------------------------------------------------------------
# look at the appTabs table in the database
qry_app_flow("iris_explorer", shinyMgrPath = paste0(getwd(),"/shinymgr"))


## ----eval = TRUE, echo = FALSE------------------------------------------------
fs::dir_tree(
    path = "shinymgr",
    recurse = FALSE,
    regexp = '(modules)|(global)|(data$)|(reports)|(server)|(ui)|(www)'
)


## ----fig6, echo = FALSE, out.width = "100%", fig.cap= "An example of a deployed shinymgr app. The deployed version excludes the Developers Tools tab and is an example of what the end user sees when using a deployed app."----

knitr::include_graphics('images/figure6.png')



## ----eval = TRUE, echo = TRUE-------------------------------------------------
rds_filepath <- paste0(getwd(),"/shinymgr/analyses/iris_explorer_Gandalf_2023_06_05_16_30.RDS")
old_analysis <- readRDS(rds_filepath)
str(old_analysis, max.level = 2, nchar.max = 20, vec.len = 15)


## ----echo = TRUE, eval = FALSE------------------------------------------------
# rerun_analysis(analysis_path = rds_filepath)


## ----fig7, echo = F, out.width = "100%", fig.cap = "A screenshot of the rerun\\_analysis() function, as called on the saved analysis from the iris\\_explorer app (RDS file). The active tab, called \"The App\", allows a user to rerun a previously executed analysis. The \"Analysis Summary\" tab displays the values of all module arguments and returns, captured when the analysis was saved, along with a detailed description of the app, it's modules, the App's source code, and all package dependencies."----
knitr::include_graphics('images/figure7.png')


## ----comment = '', echo=FALSE, class.output='r'-------------------------------
rmd_filepath <- paste0(getwd(),"/shinymgr/reports/iris_explorer/iris_explorer_report.Rmd")
cat(paste(readLines(rmd_filepath), collapse = '\n'))


## ----warning = FALSE----------------------------------------------------------
learnr::available_tutorials(
  package = "shinymgr") %>% 
  dplyr::arrange(title)



## ----eval = FALSE, echo = TRUE------------------------------------------------
# learnr::run_tutorial(
#   name = "modules",
#   package = "shinymgr")


## ----eval = FALSE, echo = TRUE------------------------------------------------
# browseURL(paste0(find.package("shinymgr"), "/extdata/shinymgr_cheatsheet.pdf"))


## ----fig8, echo = F, out.width = "85%", fig.cap = "Entity relationship diagram for the shinymgr database, which tracks all components of an apps and modules.  The database consists of 11 tables. Primary keys are referenced with a \"pk\" prefix, while foreign keys are referenced with an \"fk\" prefix. A full description of the database is contained in the \"database\" learnr tutorial that comes with the shinymgr package.", fig.pos = 'h'----
knitr::include_graphics('images/figure8.png')


## ----comment = '', echo=FALSE, class.output='r'-------------------------------
rmd_filepath <- paste0(getwd(),"/shinymgr/modules/iris_cluster.R")
cat(paste(readLines(rmd_filepath), collapse = '\n'))

