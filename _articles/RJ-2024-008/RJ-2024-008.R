# Generated by `rjournal_pdf_article()` using `knitr::purl()`: do not edit by hand
# Please edit RJ-2024-008.Rmd to modify this file

## ----setup, include=FALSE-----------------------------------------------------
knitr::opts_chunk$set(
  echo = FALSE, 
  warning = FALSE, 
  message = FALSE
)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "figures/",
  dev = "png",
  dpi = 150,
  fig.asp = 0.8,
  fig.width = 8,
  fig.height = 4,
  out.width = "60%",
  fig.align = "center"
)

library(kableExtra)
library(nortsTest)
library(fGarch)
library(knitr)
library(forecast)


## ----echo = TRUE--------------------------------------------------------------
set.seed(298)
x = arima.sim(250,model = list(ar =c(0.5,0.2)),
                 rand.gen = rbeta,shape1 = 9,shape2 = 1)

# Asymptotic Epps test
epps.test(x)


## ----echo = TRUE--------------------------------------------------------------
set.seed(298)
epps.test(x, lambda = abs(rnorm(mean = c(1, 2), 2)))


## ----echo = TRUE--------------------------------------------------------------
set.seed(298)
epps_bootstrap.test(x, seed = 298)


## ----echo = TRUE--------------------------------------------------------------
set.seed(298)
x = arima.sim(250,model = list(ma = c(0.2, 0.3, -0.4)),
                 rand.gen = rgamma, rate = 3, shape = 6)
# Asymptotic Lobato & Velasco
lobato.test(x)


## ----echo = TRUE--------------------------------------------------------------
lobato_bootstrap.test(x, seed = 298)


## ----echo = TRUE--------------------------------------------------------------
set.seed(3468)
library(fGarch)
spec = garchSpec(model = list(alpha = 0.2, beta = 0.3))
x = ts(garchSim(spec, n = 300))
rp.test(x) 


## ----echo = TRUE--------------------------------------------------------------
set.seed(298)
x = arima.sim(250,model = list(ar = 0.2, ma = 0.34))
# Default, Psaradakis and Vavra's procedure
vavra.test(x, seed = 298)


## ----echo = TRUE--------------------------------------------------------------
vavra.test(x, normality = "cvm", seed = 298)


## ----echo=TRUE----------------------------------------------------------------
set.seed(23890)
x = arima.sim(250,model = list(ar = 0.2))
y = arima.sim(250,model = list(ar = c(0.4,0,.1)))
elbouch.test(y = y,x = x)


## ----tab1-static, eval = knitr::is_latex_output(),warning = FALSE-------------
load("data/r_sim.Rdata")
phi = c("-0.4","-0.25","0.0","0.25","0.4","max.phi")

r1 = results1[,2:14]
colnames(r1) = c("phi", phi, phi)

kable(r1, "latex", booktabs = TRUE,digits = 3, caption = "Part 1. Rejection rate estimates over $m=1,000$ trials of the seven studied goodness of fit test for the null hypothesis of normality. The data is drawn using the process defined in (8) for different values of $phi$ and $n$ displayed in the columns and different distributions for $epsilon_t$  in the rows.  $phi$ in { 0, 0.25, 0.4}, n in {100, 250}. For each test and distribution, max.phi represents the maximum rejection rate's running time in seconds among the different values of the AR parameter.") %>%
kable_styling(latex_options = c("hold_position", "scale_down"))%>%
add_header_above(c(" " = 1, "n = 100" = 6, "n = 250" = 6))%>%
pack_rows("Lobato and Velasco", 1, 5) %>%
pack_rows("Epps", 6, 10) %>%
pack_rows("Random Projections", 11, 15) %>%
pack_rows("Psaradakis and Vavra", 16, 20)%>%
pack_rows("Bootstrap Lobato", 21, 25)%>%
pack_rows("Bootstrap Epps", 26, 30)%>% 
pack_rows("El Bouch", 31, 35)


## ----tab1-interactive, eval = knitr::is_html_output(),warning = FALSE---------
# load("data/r_sim.Rdata")
# phi = c("-0.4","-0.25","0.0","0.25","0.4","max.phi")
# 
# r1 = results1[,2:14]
# colnames(r1) = c("phi", phi, phi)
# 
# kable(r1, "html", booktabs = TRUE, digits = 3, caption = "Part 1. Rejection rate estimates over $m=1,000$ trials of the seven studied goodness of fit test for the null hypothesis of normality. The data is drawn using the process defined in (8) for different values of $phi$ and $n$ displayed in the columns and different distributions for $epsilon_t$  in the rows.  $phi$ in { 0, 0.25, 0.4}, n in {100, 250}. For each test and distribution, max.phi represents the maximum rejection rate's running time in seconds among the different values of the AR parameter.") %>%
# kable_styling(latex_options = c("hold_position", "scale_down"))%>%
# add_header_above(c(" " = 1, "n = 100" = 6, "n = 250" = 6))%>%
# pack_rows("Lobato and Velasco", 1, 5) %>%
# pack_rows("Epps", 6, 10) %>%
# pack_rows("Random Projections", 11, 15) %>%
# pack_rows("Psaradakis and Vavra", 16, 20)%>%
# pack_rows("Bootstrap Lobato", 21, 25)%>%
# pack_rows("Bootstrap Epps", 26, 30)%>%
# pack_rows("El Bouch", 31, 35)


## ----tab2-static, eval = knitr::is_latex_output(),warning = FALSE-------------
r2 = results2[,2:14]
colnames(r2) = c("phi", phi, phi)

kable(r2, "latex", booktabs = TRUE, digits = 3, caption = "Part 2. Rejection rate estimates over $m=1,000$ trials of the seven studied goodness of fit test for the null hypothesis of normality. The data is drawn using the process defined in (8) for different values of $phi$ and $n$ displayed in the columns and different distributions for $epsilon_t$  in the rows.  $phi$ is in { 0, 0.25, 0.4} and n in {500, 1000}. For each test and distribution, max.phi represents the maximum rejection rate's running time in seconds among the different values of the AR parameter.") %>%
kable_styling(latex_options = c("hold_position", "scale_down"))%>%
add_header_above(c(" " = 1, "n = 500" = 6, "n = 1,000" = 6))%>%
pack_rows("Lobato and Velasco", 1, 5) %>%
pack_rows("Epps", 6, 10) %>%
pack_rows("Random Projections", 11, 15) %>%
pack_rows("Psaradakis and Vavra", 16, 20)%>%
pack_rows("Bootstrap Lobato", 21, 25)%>%
pack_rows("Bootstrap Epps", 26, 30)%>% 
pack_rows("El Bouch", 31, 35)


## ----tab2-interactive, eval = knitr::is_html_output(),warning = FALSE---------
# r2 = results2[,2:14]
# colnames(r2) = c("phi", phi, phi)
# 
# kable(r2, "html", booktabs = TRUE, digits = 3, caption = "Part 2. Rejection rate estimates over $m=1,000$ trials of the seven studied goodness of fit test for the null hypothesis of normality. The data is drawn using the process defined in (8) for different values of $phi$ and $n$ displayed in the columns and different distributions for $epsilon_t$  in the rows.  $phi$ is in { 0, 0.25, 0.4} and n in {500, 1000}. For each test and distribution, max.phi represents the maximum rejection rate's running time in seconds among the different values of the AR parameter.") %>%
# kable_styling(latex_options = c("hold_position", "scale_down"))%>%
# add_header_above(c(" " = 1, "n = 500" = 6, "n = 1,000" = 6))%>%
# pack_rows("Lobato and Velasco", 1, 5) %>%
# pack_rows("Epps", 6, 10) %>%
# pack_rows("Random Projections", 11, 15) %>%
# pack_rows("Psaradakis and Vavra", 16, 20)%>%
# pack_rows("Bootstrap Lobato", 21, 25)%>%
# pack_rows("Bootstrap Epps", 26, 30)%>%
# pack_rows("El Bouch", 31, 35)


## ----tab3-static, eval = knitr::is_latex_output(),warning = FALSE-------------
load("data/runtime.Rdata")

kable(runtime, "latex", booktabs = TRUE, digits = 4, caption = "Average running time in seconds, over 1000 iterations,  to compute the null hypothesis of Gaussianity for each of the studied tests (first column) and different sample sizes, $n=1000$ (second column), $n=2000$ (third column), $n=3000$ (fourth column), $n=4000$ (fifth column) and $n=5000$ (sixth column). Each iteration makes use of a Gaussian AR(1) process with parameter $phi = 0.5.$") 


## ----tab3-interactive, eval = knitr::is_html_output(),warning = FALSE---------
# load("data/runtime.Rdata")
# 
# kable(runtime,"html", booktabs = TRUE, digits = 4, caption = "Average running time in seconds, over 1000 iterations,  to compute the null hypothesis of Gaussianity for each of the studied tests (first column) and different sample sizes, $n=1000$ (second column), $n=2000$ (third column), $n=3000$ (fourth column), $n=4000$ (fifth column) and $n=5000$ (sixth column). Each iteration makes use of a Gaussian AR(1) process with parameter $phi = 0.5.$")


## ----fig1-static, fig.cap = "Left panel: CO2 Levels at Mauna Loa, time-series plot. The cardox data show a positive tendency and strong seasonality. Right panel: forecast of the next 12 months for the CO2 levels at Mauna Loa, the model's predictions capture the time-series behaviour.", eval = knitr::is_latex_output(), fig.alt="(ref:demo-caption1)", out.width = "75%"----
library(astsa)
g1 = autoplot(cardox, main = "CO2 levels at  Mauna Loa", 
         xlab = "years", ylab = "CO2 (ppm)")
g2 = autoplot(forecast(ets(cardox), h = 12),include = 100,
         xlab = "years",ylab = "CO2 (ppm)",
         main = "Forecast: CO2  Levels at Mauna Loa")
cowplot::plot_grid(g1,g2,ncol = 2)


## ----fig1-interactive, echo = knitr::is_html_output(), eval = knitr::is_html_output(),fig.cap="CO2 Levels at Mauna Loa, time-series plot. The cardox data show a positive tendency and strong seasonality."----
# library(astsa)
# 
# autoplot(cardox, main = "Carbon Dioxide levels at Mauna Loa",
#          xlab = "years", ylab = "CO2 (ppm)")


## ----echo = TRUE--------------------------------------------------------------
library(forecast)
library(astsa)
model = ets(cardox)
summary(model)


## ----echo = TRUE, eval = FALSE------------------------------------------------
# check_residuals(model,unit_root = "adf",normality = "rp",
#                    plot = TRUE)


## ----echo = FALSE, eval = TRUE------------------------------------------------
check_residuals(model,unit_root = "adf",normality = "rp", plot = FALSE)


## ----fig2-interactive, eval = knitr::is_html_output(), fig.cap = "Check residuals plot for the ETS(M,A,A) model. The upper panel shows the residuals time-series plot, showing small oscillations around zero, which insinuates stationarity. The middle plots are the residuals histogram (middle-left) and quantile-quantile plot (middle-right), both plots suggest that the residuals have a normal distribution. The lower panel shows the autocorrelation functions, for both plots, the autocorrelations are close to zero giving the impression of stationarity."----
# check_plot(model)


## ----fig2-static, fig.cap = "Check residuals plot for the ETS(M,A,A) model. The upper panel shows the residuals time-series plot, showing small oscillations around zero, which insinuates stationarity. The middle plots are the residuals histogram (middle-left) and quantile-quantile plot (middle-right), both plots suggest that the residuals have a normal distribution. The lower panel shows the autocorrelation functions, for both plots, the autocorrelations are close to zero giving the impression of stationarity.", eval = knitr::is_latex_output(), fig.alt= "(ref:demo-caption2)", out.width = "100%"----
check_plot(model)


## ----fig3-dynamic, echo = knitr::is_html_output(), eval = knitr::is_html_output(), fig.cap = "Forecast of the next 12 months for the CO2 levels at Mauna Loa, the model's predictions capture the time-series behaviour."----
# autoplot(forecast(model,h = 12),include = 100,
#          xlab = "years",ylab = "CO2 (ppm)",
#          main = "Forecast: Carbon Dioxide Levels at Mauna Loa")


## ----echo = knitr::is_latex_output(), eval = FALSE, fig.cap = "(ref:demo-caption3)"----
# autoplot(forecast(model,h = 12),include = 100,
#          xlab = "years",ylab = "CO2 (ppm)",
#          main = "Forecast: Carbon Dioxide Levels at Mauna Loa")


## ----echo = TRUE, eval = FALSE------------------------------------------------
# if (!requireNamespace("remotes")) install.packages("remotes")
# remotes::install_github("asael697/nortsTest",dependencies = TRUE)

