# Generated by `rjournal_pdf_article()` using `knitr::purl()`: do not edit by hand
# Please edit RJ-2025-025.Rmd to modify this file

## ----setup, include=FALSE-----------------------------------------------------
knitr::opts_chunk$set(echo = F, warning = F, message = F, cache = TRUE)
library(formatR)


## ----include=FALSE------------------------------------------------------------
options(tinytex.verbose = TRUE)


## ----fig-1, out.width='50%', fig.cap='Example boundary subgraphs. Gray cells are missing values, white cells are non-boundary cells, and purple cells are boundary elements. Subgraphs are each represented using a line connecting all the boundary element cells that comprise them.', fig.alt='10 by 10 matrix of squares, outlined in black. Most squares are white, with a few light grat squares in the top right and bottom left. There are three sets of purple squares, each making curved lines 1 to 2 squares wide. The sets pf purple squares are internally connected by blue lines.'----
knitr::include_graphics("figures/fig1.png")


## ----fig-2, out.width='100%', fig.cap='Example boundaries and statistics. (A) and (B) are boundary elements for hypothetical variables A and B. White cells are non-boundaries, gray are missing values, and purple or teal are boundary elements. (C) Length of the longest subgraph. (D) Produced by overlaying cells in A and B. Dark blue cells, highlighted by white dots, are where the boundary elements overlap. (E) For every boundary element for variable A, the nearest boundary element for variable B. Circular arrows indicate distance to self. (F) For every boundary element for B, the nearest boundary element for A.', fig.alt='Six squares labeled A, B, and C on the top row and D, E, and F on the bottom row. Each square is a 10 by 10 matrix of squares with black outlines. All the matrices have 4 light gray squares in the top right and 5 light gray squares in the bottom left. A is the same as figure 1, but without the blue lines. B is like A, except that there are light blue squares instead of purple, and the blue squares are configured differently. There are still three sets of touching blue squares. C is identical to A, except it shows a black line indicating the longest straight line that can be drawn along a set of touching purple squares. D shows what A and B look like overlayed one another. The squares where the purple light blue overlap are now dark blue. Each dark blue square has a white dot in the center. E is the same as D, except without the white dots, and with arrows on them. The arrows start from each purple square and points to the nearest light blue or dark blue square. Each dark blue square has a white circular arrow that points to itself. F is like E, except that the arrows point from each light blue square to the nearest purple or dark blue square.'----
knitr::include_graphics("figures/fig2.png")


## ----fig-3, out.width='100%', fig.cap='Modified random cluster procedure, adapted from Saura and Mart√≠nez-Millan 2000. (A)  Percolated raster with p = 0.5. (B) Marked cells merged into clusters. (C) Clusters assigned a category. (D) Unmarked cells filled based on neighbors.', fig.alt='Four squares in a horizontal row labeled A through D. A is a 10 by 10 matrix of squares outlined in black. Half the squares are white and half are dark blue. B is the same, except that neighboring blue cells have been merged, so there are no longer black boundaries separating them. In C, the formerly dark blue polygons have changed color to light purple, dark purple, light blue, and medium blue. D has the same colors as C, but the white squares have been merged into neighboring polygons, so that there are only polygons and no individual squares.'----
knitr::include_graphics("figures/fig3.png")


## ----ex5.1, echo=T------------------------------------------------------------
library(terra)
library(magrittr)

songs <- rast('data/2010_2022_song_boundaries.asc')
genetic <- rast('data/genetic_interpolation.asc') %>%
  resample(., songs)
songs <- crop(songs, genetic) %>%
  mask(., genetic)


## ----fig-4, out.width='75%', fig.cap='Maps of (A) song boundary intensity and (B) genetic admixture between two populations.', fig.alt='Two maps of the coast of California, centered near the San Francisco Bay. The land is gray and the ocean is white with gridded lines for latitude and longitude. A strip of coast is colored on both maps. On the left map, dark blue lines run from northeast to southwest, with some lines darker than others. On the right map, there is a gradient of color. The top of the strip of color is purple, then around Monterey Bay (two-thirds of the way south in the colored area), the color becomes light blue, and in the south it is dark blue.'----
knitr::include_graphics("figures/fig4.png")


## ----ex5.2, echo=T, tidy=T----------------------------------------------------
library(BoundaryStats)

song_boundaries <- define_boundary(songs)
genetic_boundaries <- define_boundary(genetic, calculate_intensity = TRUE)


## ----ex5.3, echo=T, eval=F, tidy=T--------------------------------------------
# plot_boundary(genetic_boundaries, song_boundaries, trait_names = c('Genetic', 'Song'))


## ----fig-5, fig.cap='Output of the plot\\_boundary function.'-----------------
plot_boundary(genetic_boundaries, song_boundaries, trait_names = c('Genetic', 'Song'))


## ----ex5.4, echo=T, tidy=T, tidy.opts=list(width.cutoff=80), results='hide'----
song_boundary_null <- boundary_null_distrib(songs, calculate_intensity = FALSE, cat = FALSE, n_iterations = 100, threshold = 0.2, model = 'gaussian')
genetic_boundary_null <- boundary_null_distrib(genetic, calculate_intensity = TRUE, cat = FALSE, n_iterations = 100, threshold = 0.2, model = 'gaussian')

boundary_overlap_null <- overlap_null_distrib(genetic, songs, rand_both = FALSE, n_iterations = 100, x_calculate_intensity = TRUE, threshold = 0.2, x_model = 'gaussian')


## ----ex5.5.1, echo=T, tidy=T--------------------------------------------------
n_boundaries(song_boundaries, song_boundary_null)
longest_boundary(song_boundaries, song_boundary_null)
n_boundaries(genetic_boundaries, genetic_boundary_null)
longest_boundary(genetic_boundaries, genetic_boundary_null)


## ----ex5.5.2, echo=T, tidy=T--------------------------------------------------
n_overlap_boundaries(genetic_boundaries, song_boundaries, boundary_overlap_null)
average_min_x_to_y(genetic_boundaries, song_boundaries, boundary_overlap_null)

