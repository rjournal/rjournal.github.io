<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
      margin-bottom: 0em;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
  <title>bartcs: An R Package for Bayesian Nonparametric Adjustment for Confounding</title>

  <meta property="description" itemprop="description" content="This article presents an overview of the&#10;[bartcs](https://CRAN.R-project.org/package=bartcs) R package, which&#10;employs a Bayesian additive regression trees-based method for&#10;selecting confounders. It uses a Dirichlet distribution as a common&#10;variable selection probability prior, updating both the exposure and&#10;outcome models simultaneously while fitting tree priors for each. This&#10;data-driven method determines which variables (i.e., confounders)&#10;affect both models by assigning more posterior weight to them. It&#10;supports continuous and binary exposure variables, as well as&#10;continuous outcome variables, and is written in C++ for improved&#10;computational speed. Additionally, it can take advantage of multiple&#10;threads for parallel computing if OpenMP is available on the platform."/>

  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2025-09-23"/>
  <meta property="article:created" itemprop="dateCreated" content="2025-09-23"/>
  <meta name="article:author" content="Yeonghoon Yoo"/>
  <meta name="article:author" content="Chanmin Kim (corresponding author)"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="bartcs: An R Package for Bayesian Nonparametric Adjustment for Confounding"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="This article presents an overview of the&#10;[bartcs](https://CRAN.R-project.org/package=bartcs) R package, which&#10;employs a Bayesian additive regression trees-based method for&#10;selecting confounders. It uses a Dirichlet distribution as a common&#10;variable selection probability prior, updating both the exposure and&#10;outcome models simultaneously while fitting tree priors for each. This&#10;data-driven method determines which variables (i.e., confounders)&#10;affect both models by assigning more posterior weight to them. It&#10;supports continuous and binary exposure variables, as well as&#10;continuous outcome variables, and is written in C++ for improved&#10;computational speed. Additionally, it can take advantage of multiple&#10;threads for parallel computing if OpenMP is available on the platform."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="bartcs: An R Package for Bayesian Nonparametric Adjustment for Confounding"/>
  <meta property="twitter:description" content="This article presents an overview of the&#10;[bartcs](https://CRAN.R-project.org/package=bartcs) R package, which&#10;employs a Bayesian additive regression trees-based method for&#10;selecting confounders. It uses a Dirichlet distribution as a common&#10;variable selection probability prior, updating both the exposure and&#10;outcome models simultaneously while fitting tree priors for each. This&#10;data-driven method determines which variables (i.e., confounders)&#10;affect both models by assigning more posterior weight to them. It&#10;supports continuous and binary exposure variables, as well as&#10;continuous outcome variables, and is written in C++ for improved&#10;computational speed. Additionally, it can take advantage of multiple&#10;threads for parallel computing if OpenMP is available on the platform."/>

  <!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
  <meta name="citation_title" content="bartcs: An R Package for Bayesian Nonparametric Adjustment for Confounding"/>
  <meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2025-019"/>
  <meta name="citation_pdf_url" content="RJ-2025-019.pdf"/>
  <meta name="citation_volume" content="17"/>
  <meta name="citation_issue" content="2"/>
  <meta name="citation_doi" content="10.32614/RJ-2025-019"/>
  <meta name="citation_journal_title" content="The R Journal"/>
  <meta name="citation_issn" content="2073-4859"/>
  <meta name="citation_firstpage" content="1"/>
  <meta name="citation_fulltext_world_readable" content=""/>
  <meta name="citation_online_date" content="2025/09/23"/>
  <meta name="citation_publication_date" content="2025/09/23"/>
  <meta name="citation_author" content="Yeonghoon Yoo"/>
  <meta name="citation_author_institution" content="Department of Statistics, SungKyunKwan University"/>
  <meta name="citation_author" content="Chanmin Kim (corresponding author)"/>
  <meta name="citation_author_institution" content="Department of Statistics, SungKyunKwan University"/>
  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Shrinkage bayesian causal forests for heterogeneous treatment effects estimation;citation_publisher=Taylor &amp; Francis;citation_volume=31;citation_author=Alberto Caron;citation_author=Gianluca Baio;citation_author=Ioanna Manolopoulou"/>
  <meta name="citation_reference" content="citation_title=BartMachine: Machine learning with Bayesian additive regression trees;citation_volume=70;citation_doi=10.18637/jss.v070.i04;citation_author=Adam Kapelner;citation_author=Justin Bleich"/>
  <meta name="citation_reference" content="citation_title=Semiparametric difference-in-differences estimators;citation_publisher=Wiley-Blackwell;citation_volume=72;citation_author=Alberto Abadie"/>
  <meta name="citation_reference" content="citation_title=Bayesian analysis of binary and polychotomous response data;citation_publisher=Taylor &amp; Francis;citation_volume=88;citation_author=James H Albert;citation_author=Siddhartha Chib"/>
  <meta name="citation_reference" content="citation_title=Log-linear Bayesian additive regression trees for multinomial logistic and count regression models;citation_publisher=Taylor &amp; Francis;citation_volume=116;citation_author=Jared S Murray"/>
  <meta name="citation_reference" content="citation_title=Nonparametric survival analysis using Bayesian additive regression trees (BART);citation_publisher=Wiley Online Library;citation_volume=35;citation_author=Rodney A Sparapani;citation_author=Brent R Logan;citation_author=Robert E McCulloch;citation_author=Purushottam W Laud"/>
  <meta name="citation_reference" content="citation_title=BayesPen: Bayesian penalized credible regions;citation_author=Ander Wilson;citation_author=Howard D. Bondell;citation_author=Brian J. Reich"/>
  <meta name="citation_reference" content="citation_title=NPCI: Non-parametrics for causal inference;citation_author=Vincent Dorie"/>
  <meta name="citation_reference" content="citation_title=Tableone: Create “table 1” to describe baseline characteristics with or without propensity score weights;citation_author=Kazuki Yoshida;citation_author=Alexander Bartel"/>
  <meta name="citation_reference" content="citation_title=Bayesian nonparametric modeling for causal inference;citation_publisher=Taylor &amp; Francis;citation_volume=20;citation_doi=10.1198/jcgs.2010.08162;citation_author=Jennifer L. Hill"/>
  <meta name="citation_reference" content="citation_title=Ggcharts: Shorten the distance from data visualization idea to actual plot;citation_author=Thomas Neitmann;citation_author=Julia Silge;citation_author=David Robinson"/>
  <meta name="citation_reference" content="citation_title=Effects of adjusting for instrumental variables on bias and precision of effect estimates;citation_publisher=Oxford University Press;citation_volume=174;citation_author=Jessica A Myers;citation_author=Jeremy A Rassen;citation_author=Joshua J Gagne;citation_author=Krista F Huybrechts;citation_author=Sebastian Schneeweiss;citation_author=Kenneth J Rothman;citation_author=Marshall M Joffe;citation_author=Robert J Glynn"/>
  <meta name="citation_reference" content="citation_title=Instrumental variables as bias amplifiers with general outcome and confounding;citation_publisher=Oxford University Press;citation_volume=104;citation_author=Peng Ding;citation_author=TJ VanderWeele;citation_author=James M Robins"/>
  <meta name="citation_reference" content="citation_title=Rank-normalization, folding, and localization: An improved R-hat for assessing convergence of MCMC (with discussion);citation_publisher=International Society for Bayesian Analysis;citation_volume=16;citation_author=Aki Vehtari;citation_author=Andrew Gelman;citation_author=Daniel Simpson;citation_author=Bob Carpenter;citation_author=Paul-Christian Bürkner"/>
  <meta name="citation_reference" content="citation_title=Efficient metropolis–hastings proposal mechanisms for Bayesian regression tree models;citation_volume=11;citation_author=Matthew T Pratola"/>
  <meta name="citation_reference" content="citation_title=Nonparametric machine learning and efficient computation with Bayesian additive regression trees: The BART R package;citation_volume=97;citation_doi=10.18637/jss.v097.i01;citation_author=Rodney Sparapani;citation_author=Charles Spanbauer;citation_author=Robert McCulloch"/>
  <meta name="citation_reference" content="citation_title=Coda: Output analysis and diagnostics for MCMC;citation_author=Martyn Plummer;citation_author=Nicky Best;citation_author=Kate Cowles;citation_author=Karen Vines;citation_author=Deepayan Sarkar;citation_author=Douglas Bates;citation_author=Russell Almond;citation_author=Arni Magnusson"/>
  <meta name="citation_reference" content="citation_title=CODA: Convergence diagnosis and output analysis for MCMC;citation_volume=6;citation_author=Martyn Plummer;citation_author=Nicky Best;citation_author=Kate Cowles;citation_author=Karen Vines"/>
  <meta name="citation_reference" content="citation_title=Extending the Bayesian adjustment for confounding algorithm to binary treatment covariates to estimate the effect of smoking on carotid intima-media thickness: The multi-ethnic study of atherosclerosis;citation_publisher=Wiley Online Library;citation_volume=33;citation_author=Geneviève Lefebvre;citation_author=Joseph A Delaney;citation_author=Robyn L McClelland"/>
  <meta name="citation_reference" content="citation_title=Principles of confounder selection;citation_publisher=Springer;citation_volume=34;citation_author=Tyler J VanderWeele"/>
  <meta name="citation_reference" content="citation_title=Bayesian effect estimation accounting for adjustment uncertainty;citation_publisher=Wiley Online Library;citation_volume=68;citation_author=Chi Wang;citation_author=Giovanni Parmigiani;citation_author=Francesca Dominici"/>
  <meta name="citation_reference" content="citation_title=Accounting for uncertainty in confounder and effect modifier selection when estimating average causal effects in generalized linear models;citation_publisher=Wiley Online Library;citation_volume=71;citation_author=Chi Wang;citation_author=Francesca Dominici;citation_author=Giovanni Parmigiani;citation_author=Corwin Matthew Zigler"/>
  <meta name="citation_reference" content="citation_title=Bayesian regression trees for high-dimensional prediction and variable selection;citation_publisher=Taylor &amp; Francis;citation_volume=113;citation_author=Antonio R Linero"/>
  <meta name="citation_reference" content="citation_title=Bayesian backfitting (with comments and a rejoinder by the authors);citation_publisher=Institute of Mathematical Statistics;citation_volume=15;citation_author=Trevor Hastie;citation_author=Robert Tibshirani"/>
  <meta name="citation_reference" content="citation_title=Optimal predictive model selection;citation_publisher=Institute of Mathematical Statistics;citation_volume=32;citation_author=Maria Maddalena Barbieri;citation_author=James O Berger"/>
  <meta name="citation_reference" content="citation_title=BART: Bayesian additive regression trees;citation_publisher=Institute of Mathematical Statistics;citation_volume=4;citation_author=Hugh A Chipman;citation_author=Edward I George;citation_author=Robert E McCulloch;citation_author=BART: Bayesian additive regression trees"/>
  <meta name="citation_reference" content="citation_title=Bayesian nonparametric adjustment of confounding;citation_volume=79;citation_doi=10.1111/biom.13833;citation_author=Chanmin Kim;citation_author=Mauricio Tec;citation_author=Corwin M. Zigler"/>
  <meta name="citation_reference" content="citation_title=Data-driven confounder selection via Markov and Bayesian networks;citation_publisher=Wiley Online Library;citation_volume=74;citation_author=Jenny Häggström"/>
  <meta name="citation_reference" content="citation_title=Bartcs: Bayesian additive regression trees for confounder selection;citation_author=Yeonghoon Yoo"/>
  <meta name="citation_reference" content="citation_title=Invited discussion for Bayesian regression tree models for causal inference: Regularization, confounding, and heterogeneous effects;citation_volume=15;citation_author=Georgia Papadogeorgou;citation_author=Fan Li"/>
  <meta name="citation_reference" content="citation_title=Invited discussion for Bayesian regression tree models for causal inference: Regularization, confounding, and heterogeneous effects;citation_volume=15;citation_author=Arman Oganisian;citation_author=Jason A Roy"/>
  <meta name="citation_reference" content="citation_title=Bayesian regression tree models for causal inference: Regularization, confounding, and heterogeneous effects;citation_publisher=International Society for Bayesian Analysis;citation_volume=15;citation_doi=10.1214/19-BA1195;citation_author=P Richard Hahn;citation_author=Jared S Murray;citation_author=Carlos M Carvalho"/>
  <meta name="citation_reference" content="citation_title=Confounder selection via penalized credible regions;citation_publisher=Wiley Online Library;citation_volume=70;citation_author=Ander Wilson;citation_author=Brian J Reich"/>
  <meta name="citation_reference" content="citation_title=Outcome-adaptive lasso: Variable selection for causal inference;citation_publisher=Wiley Online Library;citation_volume=73;citation_author=Susan M Shortreed;citation_author=Ashkan Ertefaie"/>
  <meta name="citation_reference" content="citation_title=Estimating causal effects of treatments in randomized and nonrandomized studies.;citation_publisher=American Psychological Association;citation_volume=66;citation_author=Donald B Rubin"/>
  <meta name="citation_reference" content="citation_title=Causal inference;citation_publisher=JSTOR;citation_volume=33;citation_author=Peng Ding;citation_author=Fan Li"/>
  <meta name="citation_reference" content="citation_title=Bayesian causal inference: A critical review;citation_publisher=The Royal Society;citation_volume=381;citation_author=Fan Li;citation_author=Peng Ding;citation_author=Fabrizia Mealli"/>
  <meta name="citation_reference" content="citation_title=The central role of the propensity score in observational studies for causal effects;citation_volume=70;citation_issn=00063444;citation_author=Paul R. Rosenbaum;citation_author=Donald B. Rubin"/>
  <meta name="citation_reference" content="citation_title=Discussion of randomization analysis of experimental data: The Fisher randomization test by D. Basu;citation_volume=75;citation_author=Donald B. Rubin"/>
  <meta name="citation_reference" content="citation_title=Causal effect inference with deep latent-variable models;citation_volume=30;citation_doi=10.48550/arXiv.1705.08821;citation_author=Christos Louizos;citation_author=Uri Shalit;citation_author=Joris M Mooij;citation_author=David Sontag;citation_author=Richard Zemel;citation_author=Max Welling"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","date_received","journal","volume","issue","slug","citation_url","packages","preview","bibliography","CTV","legacy_pdf","legacy_converted","output","draft","pdf_url","doi","creative_commons","csl"]}},"value":[{"type":"character","attributes":{},"value":["bartcs: An R Package for Bayesian Nonparametric Adjustment for Confounding"]},{"type":"character","attributes":{},"value":["This article presents an overview of the\n[bartcs](https://CRAN.R-project.org/package=bartcs) R package, which\nemploys a Bayesian additive regression trees-based method for\nselecting confounders. It uses a Dirichlet distribution as a common\nvariable selection probability prior, updating both the exposure and\noutcome models simultaneously while fitting tree priors for each. This\ndata-driven method determines which variables (i.e., confounders)\naffect both models by assigning more posterior weight to them. It\nsupports continuous and binary exposure variables, as well as\ncontinuous outcome variables, and is written in C++ for improved\ncomputational speed. Additionally, it can take advantage of multiple\nthreads for parallel computing if OpenMP is available on the platform.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Yeonghoon Yoo"]},{"type":"character","attributes":{},"value":["Department of Statistics, SungKyunKwan University"]},{"type":"character","attributes":{},"value":["25-2 SungKyunKwan University, Jongno-gu","Seoul 03063, South Korea","[yooyh.stat@gmail.com](yooyh.stat@gmail.com){.uri}\n"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","orcid_id","address"]}},"value":[{"type":"character","attributes":{},"value":["Chanmin Kim (corresponding author)"]},{"type":"character","attributes":{},"value":["Department of Statistics, SungKyunKwan University"]},{"type":"character","attributes":{},"value":["0000-0002-2588-6704"]},{"type":"character","attributes":{},"value":["25-2 SungKyunKwan University, Jongno-gu","Seoul 03063, South Korea","[chanmin.kim@skku.edu](chanmin.kim@skku.edu){.uri}\n"]}]}]},{"type":"character","attributes":{},"value":["2025-09-23"]},{"type":"character","attributes":{},"value":["2024-05-24"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"double","attributes":{},"value":[1]},{"type":"NULL"}]},{"type":"integer","attributes":{},"value":[17]},{"type":"integer","attributes":{},"value":[2]},{"type":"character","attributes":{},"value":["RJ-2025-019"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2025-019"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"list","attributes":{},"value":[]},{"type":"list","attributes":{},"value":[]}]},{"type":"character","attributes":{},"value":["preview.png"]},{"type":"character","attributes":{},"value":["yoo-kim.bib"]},{"type":"list","attributes":{},"value":[]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","mathjax","md_extension"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"]},{"type":"character","attributes":{},"value":["-tex_math_single_backslash"]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["RJ-2025-019.pdf"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2025-019"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["/home/hyndman/R/x86_64-pc-linux-gnu-library/4.5/rjtools/rjournal.csl"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["alg/algseparate.pdf","alg/algseparate.png","alg/algseparate.tex","alg/algsingle.pdf","alg/algsingle.png","alg/algsingle.tex","fig/conti_PIP_threshold.pdf","fig/conti_PIP_threshold.png","fig/conti_PIP_top_n.pdf","fig/conti_PIP_top_n.png","fig/fig0.png","fig/fig1.png","fig/fig2.png","fig/ihdp_PIP_threshold_separate.pdf","fig/ihdp_PIP_threshold_separate.png","fig/ihdp_PIP_threshold_single.pdf","fig/ihdp_PIP_threshold_single.png","fig/ihdp_trace_ATE.pdf","fig/ihdp_trace_ATE.png","fig/overlap.pdf","fig/overlap.png","fig/pip_s1.pdf","fig/pip_s1.png","fig/pip_s2.pdf","fig/pip_s2.png","fig/pip_s3.pdf","fig/pip_s3.png","fig/PIP_threshold.pdf","fig/PIP_threshold.png","fig/PIP_top_n.pdf","fig/PIP_top_n.png","fig/sep_mcmc_list.pdf","fig/sep_mcmc_list.png","fig/speed_trees100.pdf","fig/speed_trees100.png","fig/speed_trees200.pdf","fig/speed_trees200.png","fig/traceplot_alpha.pdf","fig/traceplot_alpha.png","fig/traceplot_ATE.pdf","fig/traceplot_ATE.png","motivation-letter/CoverLetter.pdf","RJ-2025-019_files/anchor-4.2.2/anchor.min.js","RJ-2025-019_files/bowser-1.9.3/bowser.min.js","RJ-2025-019_files/distill-2.2.21/template.v2.js","RJ-2025-019_files/header-attrs-2.29/header-attrs.js","RJ-2025-019_files/jquery-3.6.0/jquery-3.6.0.js","RJ-2025-019_files/jquery-3.6.0/jquery-3.6.0.min.js","RJ-2025-019_files/jquery-3.6.0/jquery-3.6.0.min.map","RJ-2025-019_files/popper-2.6.0/popper.min.js","RJ-2025-019_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2025-019_files/tippy-6.2.7/tippy-light-border.css","RJ-2025-019_files/tippy-6.2.7/tippy.css","RJ-2025-019_files/tippy-6.2.7/tippy.umd.min.js","RJ-2025-019_files/webcomponents-2.0.0/webcomponents.js","RJ-2025-019.zip","RJournal.sty","RJwrapper.aux","RJwrapper.bbl","RJwrapper.blg","RJwrapper.brf","RJwrapper.fdb_latexmk","RJwrapper.fls","RJwrapper.log","RJwrapper.out","RJwrapper.pdf","RJwrapper.synctex.gz","RJwrapper.tex","yoo-kim.bib","yoo-kim.tex"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
    font-size: 100%;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  hr.section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    margin: 0px;
  }


  d-byline {
    border-top: none;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
    border-top: none;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  /* tweak for Pandoc numbered line within distill */
  d-article pre.numberSource code > span {
      left: -2em;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // separator
    var separator = '<hr class="section-separator" style="clear: both"/>';
    // prepend separator above appendix
    $('.d-byline').before(separator);
    $('.d-article').before(separator);

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme, except when numbering line
    // in code chunk
    $('pre:not(.numberLines) code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        var author_name = front_matter.authors[i].author
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        const citeChild = $(this).children()[0]
        // Do not process if @xyz has been used without escaping and without bibliography activated
        // https://github.com/rstudio/distill/issues/466
        if (citeChild === undefined) return true

        if (citeChild.nodeName == "D-FOOTNOTE") {
          var fn = citeChild
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          // Could use CSS.escape too here, we insure backward compatibility in navigator
          return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="RJ-2025-019_files/header-attrs-2.29/header-attrs.js"></script>
  <script src="RJ-2025-019_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="RJ-2025-019_files/popper-2.6.0/popper.min.js"></script>
  <link href="RJ-2025-019_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="RJ-2025-019_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="RJ-2025-019_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="RJ-2025-019_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="RJ-2025-019_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="RJ-2025-019_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="RJ-2025-019_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Mathjax config (add automatic linebreaks when supported)
      // MathJax = {
      //    tex: {
      //        inlineMath: [['$', '$'], ['\\(', '\\)']],
      //        displayMath: [['$$', '$$'], ['\\[', '\\]']],
      //        tags: 'ams',
      //        multline: true,
      //    },
      //    options: {
      //        linebreaks: { automatic: true },
      //    },
      // };

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="' + slug + '.zip" class="dt-tag"><i class="fas fa-file-zipper"></i> Supplement</a>')

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").filter(function() {
        return !$(this).hasClass("subtitle");
      }).first();
      if (tpar) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append(tpar) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"bartcs: An R Package for Bayesian Nonparametric Adjustment for Confounding","description":"This article presents an overview of the\n[bartcs](https://CRAN.R-project.org/package=bartcs) R package, which\nemploys a Bayesian additive regression trees-based method for\nselecting confounders. It uses a Dirichlet distribution as a common\nvariable selection probability prior, updating both the exposure and\noutcome models simultaneously while fitting tree priors for each. This\ndata-driven method determines which variables (i.e., confounders)\naffect both models by assigning more posterior weight to them. It\nsupports continuous and binary exposure variables, as well as\ncontinuous outcome variables, and is written in C++ for improved\ncomputational speed. Additionally, it can take advantage of multiple\nthreads for parallel computing if OpenMP is available on the platform.","doi":"10.32614/RJ-2025-019","authors":[{"author":"Yeonghoon Yoo","authorURL":"#","affiliation":"Department of Statistics, SungKyunKwan University","affiliationURL":"#","orcidID":""},{"author":"Chanmin Kim (corresponding author)","authorURL":"#","affiliation":"Department of Statistics, SungKyunKwan University","affiliationURL":"#","orcidID":"0000-0002-2588-6704"}],"publishedDate":"2025-09-23T00:00:00.000+10:00","citationText":"Yoo & author), 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>bartcs: An R Package for Bayesian Nonparametric Adjustment for Confounding</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>This article presents an overview of the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> R package, which
employs a Bayesian additive regression trees-based method for
selecting confounders. It uses a Dirichlet distribution as a common
variable selection probability prior, updating both the exposure and
outcome models simultaneously while fitting tree priors for each. This
data-driven method determines which variables (i.e., confounders)
affect both models by assigning more posterior weight to them. It
supports continuous and binary exposure variables, as well as
continuous outcome variables, and is written in C++ for improved
computational speed. Additionally, it can take advantage of multiple
threads for parallel computing if OpenMP is available on the platform.</p></p>
</div>

<div class="d-byline">
  Yeonghoon Yoo  (Department of Statistics, SungKyunKwan University)
  
,   Chanmin Kim (corresponding author)  (Department of Statistics, SungKyunKwan University)
  
<br/>2025-09-23
</div>

<div class="d-article">
<h3 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h3>
<p>In observational studies, drawing causality often relies on the
ignorability assumption <span class="citation" data-cites="rosenbaum_central_1983">(<a href="#ref-rosenbaum_central_1983" role="doc-biblioref">Rosenbaum and Rubin 1983</a>)</span> that all confounders
are included in the adjustment procedure. Alternative approaches, such
as difference-in-differences <span class="citation" data-cites="abadie2005semiparametric">(<a href="#ref-abadie2005semiparametric" role="doc-biblioref">Abadie 2005</a>)</span>, still seek to
address confounding without relying on ignorability by adopting a
different set of assumptions (e.g., the parallel trends assumption). A
confounder or confounding variable is a common cause that simultaneously
affects both exposure and outcome (Figure
<a href="#fig:dag" data-reference-type="ref" data-reference="fig:dag">1</a> (a)). Two groups
with different exposure levels, distinguished by the distribution of the
confounding variable, also experience its impact on their respective
outcome values. Therefore, to estimate the causal relationship between
exposure and outcome, it is crucial to select this common cause in the
data and adjust for it. In many recent applications, the number of
potential confounders is often enormous, making it difficult to select
the optimal set of true confounders among them. In this context, the
optimal set is a confounder set with an appropriate level of uncertainty
that reduces bias in estimating the final causal effect.</p>
<p>The main distinction between confounder selection and the traditional
variable selection method is that variables that meet the ignorability
assumption should be chosen. Several criteria need to be met by the
selected confounders in order to reduce the bias of estimated causal
effects. Among them, “disjunctive cause
criterion”<span class="citation" data-cites="vanderweele2019principles">(<a href="#ref-vanderweele2019principles" role="doc-biblioref">VanderWeele 2019</a>)</span> requires that the chosen
variables be related to exposure and/or outcome. In Figure
<a href="#fig:dag" data-reference-type="ref" data-reference="fig:dag">1</a> (a), a
confounder set <span class="math inline">\(\boldsymbol{X}\)</span> that satisfies the disjunctive cause
criterion consists of variables that either affect exposure <span class="math inline">\(A\)</span>, affect
outcome <span class="math inline">\(Y\)</span>, or simultaneously affect both <span class="math inline">\(A\)</span> and <span class="math inline">\(Y\)</span>. A better
condition than this is “disjunctive cause criterion without
instruments”<span class="citation" data-cites="vanderweele2019principles">(<a href="#ref-vanderweele2019principles" role="doc-biblioref">VanderWeele 2019</a>)</span>, which removes the variables
related to exposure but not directly associated with outcome. An
instrument, or instrumental variable, is a variable that influences
exposure <span class="math inline">\(A\)</span> but does not affect outcome <span class="math inline">\(Y\)</span>. It is known to amplify
bias in causal effect estimation when there is an unmeasured confounder
<span class="citation" data-cites="myers2011effects">(<a href="#ref-myers2011effects" role="doc-biblioref">Myers et al. 2011</a>)</span>. In Figure <a href="#fig:dag" data-reference-type="ref" data-reference="fig:dag">1</a> (b), if a certain confounder from <span class="math inline">\(\boldsymbol{X}\)</span>
is unmeasured and not adjusted for (i.e., in the presence of an
unmeasured confounder), conducting adjustment for instrument <span class="math inline">\(Z\)</span> leads
to additional bias, known as “<span class="math inline">\(Z\)</span>-bias" <span class="citation" data-cites="ding2017instrumental">(<a href="#ref-ding2017instrumental" role="doc-biblioref">Ding et al. 2017</a>)</span>.
Therefore, the best practice is to remove this instrument during the
covariate adjustment process. However, manually identifying a set of
confounders that meet these criteria among a large number of potential
confounders is challenging.</p>
<p>Methods based on data and statistical models for performing such
confounder selection have recently been proposed. One such method is the
Bayesian adjustment for confounding (BAC) method proposed by
<span class="citation" data-cites="wang2012bayesian lefebvre2014extending">(<a href="#ref-wang2012bayesian" role="doc-biblioref">Wang et al. 2012</a>; <a href="#ref-lefebvre2014extending" role="doc-biblioref">Lefebvre et al. 2014</a>)</span>, which connects exposure and
outcome models through common variable inclusion indicator variables to
identify confounders. <span class="citation" data-cites="wang2015accounting">(<a href="#ref-wang2015accounting" role="doc-biblioref">Wang et al. 2015</a>)</span> later modified the BAC
method to work with generalized linear outcome models.
<span class="citation" data-cites="wilson2014confounder">(<a href="#ref-wilson2014confounder" role="doc-biblioref">Wilson and Reich 2014</a>)</span> suggested a method based on decision theory with
a similar goal, which performs well for a variety of sample sizes. In
terms of selecting relevant covariates for use in propensity score,
<span class="citation" data-cites="shortreed2017outcome">(<a href="#ref-shortreed2017outcome" role="doc-biblioref">Shortreed and Ertefaie 2017</a>)</span> proposed the outcome-adaptive LASSO method. In
addition, <span class="citation" data-cites="haggstrom2018data">(<a href="#ref-haggstrom2018data" role="doc-biblioref">Häggström 2018</a>)</span> proposed a method for identifying the
causal structure and estimating the causal effect using a probability
graphical model.</p>
<p>Despite the advantages of the previously mentioned methods, they each
have limitations. To address these shortcomings, <span class="citation" data-cites="kim2023bnp">(<a href="#ref-kim2023bnp" role="doc-biblioref">Kim et al. 2023</a>)</span> proposed
a novel Bayesian non-parametric model that aims to overcome these
limitations. They suggested a new method that employs Bayesian additive
regression trees (BART; <span class="citation" data-cites="chipman2010bart">(<a href="#ref-chipman2010bart" role="doc-biblioref">Chipman et al. 2010</a>)</span>) with a shared prior for the
selection probabilities, which links the exposure and outcome models.
This approach allows for the flexibility and precision of a Bayesian
nonparametric model, while also identifying and integrating covariates
that are related to both the exposure and outcome into the final
estimator. <span class="citation" data-cites="caron2022shrinkage">(<a href="#ref-caron2022shrinkage" role="doc-biblioref">Caron et al. 2022</a>)</span> similarly applied a sparsity-inducing
Dirichlet prior to the selection probabilities in the outcome model of
Bayesian Causal Forest, a variant of BART proposed by
<span class="citation" data-cites="hahn2020bayesian">(<a href="#ref-hahn2020bayesian" role="doc-biblioref">Hahn et al. 2020</a>)</span>. However, while their approach focuses on inducing
sparsity among variables used within the trees, our method introduces a
common prior shared by both the outcome and exposure models to
facilitate confounder identification. This paper introduces
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a>, a new R package
developed by <span class="citation" data-cites="bartcs">(<a href="#ref-bartcs" role="doc-biblioref">Yoo 2024</a>)</span> that implements the Bayesian additive regression
trees method for confounder selection proposed by <span class="citation" data-cites="kim2023bnp">(<a href="#ref-kim2023bnp" role="doc-biblioref">Kim et al. 2023</a>)</span>. The
package, which is written in C++ and integrated into R via Rcpp for fast
computation and easy use, can be downloaded from the Comprehensive R
Archive Network (CRAN) at <a href="https://cran.r-project.org/package=bartcs" class="uri">https://cran.r-project.org/package=bartcs</a>.
Certain sections of the code referred to the
<a href="https://cran.r-project.org/web/packages/BART/index.html">BART</a> package
by <span class="citation" data-cites="BART">(<a href="#ref-BART" role="doc-biblioref">Sparapani et al. 2021</a>)</span> under the GPL license, with modifications. In particular, the
development of efficient code involved referencing the existing
<a href="https://cran.r-project.org/web/packages/BART/index.html">BART</a> package
algorithm in following aspects: 1) code related to obtaining residuals
in the Bayesian backfitting process; 2) code dedicated to efficiently
searching for variables eligible for splitting when proposing a
splitting variable during the tree alteration process; 3) code for
calculating the <span class="math inline">\(\mu\)</span> parameter value of leaf nodes; 4) code for
obtaining sufficient statistics for all bottom nodes.</p>
<figure id="fig:dag">
<img src="fig/fig0.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 1: Directed Acyclic Graphs (DAGs): (a) the relationship between
exposure <span class="math inline">\(A\)</span> and outcome <span class="math inline">\(Y\)</span> is confounded by covariates <span class="math inline">\(X\)</span>; (b)
Adjusting for instrument <span class="math inline">\(Z\)</span>, which affects exposure <span class="math inline">\(A\)</span> but is
unrelated to outcome <span class="math inline">\(Y\)</span>, may introduce additional bias if there is an
unmeasured covariate in <span class="math inline">\(X\)</span>.</figcaption>
</figure>
<p>In this paper, we provide an overview of the package, including
installation instructions, usage examples, and a demonstration of its
performance on simulated data. We also include a comparison with other
existing confounder selection methods. Our aim is to provide researchers
with a useful tool for identifying relevant confounders in their causal
inference studies and to enable them to make more accurate causal
inferences.</p>
<div id="tab:models">
<table style="width:100%;">
<caption><span id="tab:T1">Table 1: </span> Summary of different confounder selection methods.</caption>
<colgroup>
<col style="width: 13%" />
<col style="width: 1%" />
<col style="width: 84%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Package</th>
<th style="text-align: left;">Lang.</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><a href="https://CRAN.R-project.org/package=bacr">bacr</a> <span class="citation" data-cites="wang2015accounting">(<a href="#ref-wang2015accounting" role="doc-biblioref">Wang et al. 2015</a>)</span></td>
<td style="text-align: left;">R</td>
<td style="text-align: left;">Assume (generalized-) linear models (i.e., <em>parametric</em> models) for exposure and outcome. Supports binomial, Poisson, Gaussian exposure and outcome.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://cran.r-project.org/package=BayesPen">BayesPen</a> <span class="citation" data-cites="bayespen">(<a href="#ref-bayespen" role="doc-biblioref">Wilson et al. 2015</a>)</span></td>
<td style="text-align: left;">R</td>
<td style="text-align: left;">Assume linear models (i.e., <em>parametric</em> models) for exposure and outcome. Support continuous outcome.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://cran.r-project.org/package=CovSelHigh">CovSelHigh</a> <span class="citation" data-cites="covselhigh">(<a href="#ref-covselhigh" role="doc-biblioref"><strong>covselhigh?</strong></a>)</span></td>
<td style="text-align: left;">R</td>
<td style="text-align: left;">Confounder selection performed via either Markov/Bayesian networks (model-free selection of confounders).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://cran.r-project.org/package=BART">BART</a> <span class="citation" data-cites="BART">(<a href="#ref-BART" role="doc-biblioref">Sparapani et al. 2021</a>)</span></td>
<td style="text-align: left;">C++</td>
<td style="text-align: left;">Incorporate the Dirichlet sparse prior of <span class="citation" data-cites="linero2018bayesian">(<a href="#ref-linero2018bayesian" role="doc-biblioref">Linero 2018</a>)</span> for variable selection in the BART outcome model. Support various outcome types (categorical, continuous, binary, survival outcome). <em>This does not primarily focus on confounder selection, but rather variable selection,</em> and this variable selection functionality is enabled by setting <code>sparse=TRUE</code> in <code>wbart</code> (continuous outcome) <code>pbart/lbart</code> (binary outcome) <code>mbart/mbart2</code> (categorical outcome) <code>surv.bart</code> (survival outcome) functions.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://cran.r-project.org/package=bcf">bcf</a> <span class="math inline">\(^\dagger\)</span> <span class="citation" data-cites="hahn2020bayesian">(<a href="#ref-hahn2020bayesian" role="doc-biblioref">Hahn et al. 2020</a>)</span></td>
<td style="text-align: left;">C++</td>
<td style="text-align: left;">Specify different BART models for confounding adjustment and heterogeneous effect estimation, and regularizing the treatment effect directly. <em>This model lacks the ability for both variable selection and confounder selection.</em> Support continuous outcome.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://cran.r-project.org/package=bartCause">bartCause</a><span class="math inline">\(^\dagger\)</span> <span class="citation" data-cites="bartcause">(<a href="#ref-bartcause" role="doc-biblioref">Hill 2011</a>)</span></td>
<td style="text-align: left;">C++</td>
<td style="text-align: left;">Fit exposure and outcome models using the BART algorithm, producing estimates of treatment effects. <em>This model lacks the ability for both variable selection and confounder selection.</em> Support continuous and binary outcome.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> <span class="citation" data-cites="bartcs">(<a href="#ref-bartcs" role="doc-biblioref">Yoo 2024</a>)</span></td>
<td style="text-align: left;">C++</td>
<td style="text-align: left;">Use BART outcome and exposure models with the common Dirichlet prior for confounder selection. Support binary and continuous exposure, and continuous outcome.</td>
</tr>
</tbody>
</table>
</div>
<h3 data-number="2" id="sec:models"><span class="header-section-number">2</span> Overview of model</h3>
<p>We first express causal estimation within a potential outcome framework
<span class="citation" data-cites="rubin1974estimating">(<a href="#ref-rubin1974estimating" role="doc-biblioref">Rubin 1974</a>)</span>. For each unit <span class="math inline">\(i=1, \cdots, N\)</span>, the potential
outcome for the <span class="math inline">\(i\)</span>-th unit is defined as <span class="math inline">\(Y_i(a)\)</span>, representing the
potential value of the outcome <span class="math inline">\(Y_i\)</span> that could be observed under the
binary exposure <span class="math inline">\(A_i=a \in \{0,1\}\)</span>. Under the Stable Unit Treatment
Value Assumption (SUTVA) <span class="citation" data-cites="rubin_discussion_1980">(<a href="#ref-rubin_discussion_1980" role="doc-biblioref">Rubin 1980</a>)</span>, the potential
outcomes correspond to the observed outcome as follows: <span class="math inline">\(Y_i = Y_i(A_i)\)</span>
for <span class="math inline">\(A_i \in \{0, 1\}\)</span>. The target causal estimand is
<span class="math display">\[\Delta(1,0) = E[Y_i(1) - Y_i(0)],\]</span>
which represents the average difference between two potential outcomes
under two exposure levels <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>. In the later section, we will
also explain the utilization of the proposed model by extending it for
cases involving continuous exposure.</p>
<p>However, unlike randomized trials, the exposure assignment is not
randomized in observational studies, making it impossible to directly
identify either <span class="math inline">\(E[Y_i(1)]\)</span> or <span class="math inline">\(E[Y_i(0)]\)</span> from observed data. With no
unmeasured confounders <span class="math inline">\(\boldsymbol{X}_i\)</span>, the following strong
ignorable treatment assignment assumption <span class="citation" data-cites="rosenbaum_central_1983">(<a href="#ref-rosenbaum_central_1983" role="doc-biblioref">Rosenbaum and Rubin 1983</a>)</span>
holds
<span class="math display">\[\{Y_i(1), Y_i(0)\} \perp A_i | \boldsymbol{X}_i,\]</span>
and <span class="math inline">\(0 &lt; Pr(A_i=1 | \boldsymbol{X}_i=\boldsymbol{x}) &lt; 1\)</span> for all
<span class="math inline">\(\boldsymbol{x}\)</span>; <span class="math inline">\(i=1, \cdots, N\)</span>. The first part is also known as the
unconfoundedness assumption, and the second part is referred to as the
positivity or overlap assumption, which states that each unit has a
non-zero probability of being assigned to each treatment condition. This
strong ignorable treatment assignment assumption is sufficient to
identify the target causal estimand <span class="math inline">\(\Delta(1,0)\)</span>
<span class="citation" data-cites="rosenbaum_central_1983 ding2018causal li2023bayesian">(<a href="#ref-rosenbaum_central_1983" role="doc-biblioref">Rosenbaum and Rubin 1983</a>; <a href="#ref-ding2018causal" role="doc-biblioref">Ding and Li 2018</a>; <a href="#ref-li2023bayesian" role="doc-biblioref">Li et al. 2023</a>)</span>. In
practice, even if the true treatment assignment mechanism satisfies the
above conditions, finite observed data may have only one treatment
condition value for certain combinations of <span class="math inline">\(\boldsymbol{X}\)</span>. In this
case, a non-overlap region occurs for that <span class="math inline">\(\boldsymbol{X}\)</span> combination,
and target causal estimates in such cases inevitably rely on
extrapolation dependent on the model. When non-overlap is severe, it can
amplify bias in the target causal estimate. Therefore, recent research
interest lies in whether estimates in such regions are provided with an
appropriate level of uncertainty
<span class="citation" data-cites="papadogeorgou2020invited oganisian2020invited li2023bayesian">(<a href="#ref-oganisian2020invited" role="doc-biblioref">Oganisian and Roy 2020</a>; <a href="#ref-papadogeorgou2020invited" role="doc-biblioref">Papadogeorgou and Li 2020</a>; <a href="#ref-li2023bayesian" role="doc-biblioref">Li et al. 2023</a>)</span>. Any
method based on outcome regression cannot provide accurate estimation in
the non-overlapping region. Further discussion on this topic is
available in <span class="citation" data-cites="li2023bayesian">(<a href="#ref-li2023bayesian" role="doc-biblioref">Li et al. 2023</a>)</span>.</p>
<p>Another notable aspect of this assumption is that it is untestable.
Therefore, it is not possible to conduct tests based on the data to
determine which confounder <span class="math inline">\(X\)</span> satisfies the above assumption. However,
confounders <span class="math inline">\(\boldsymbol{X}\)</span> that meet the criteria presented in the
introduction (disjunctive cause criterion or disjunctive cause criterion
without an instrument; <span class="citation" data-cites="vanderweele2019principles">(<a href="#ref-vanderweele2019principles" role="doc-biblioref">VanderWeele 2019</a>)</span>) can be considered a
minimum basis for a “proper” confounder set. With this strong ignorable
treatment assignment assumption in place, we can identify the causal
effect by the following equation of the observable quantities:
<span class="math display">\[\Delta(1, 0; \boldsymbol{x}) = E[Y_i|A_i=1, \boldsymbol{X}_i=\boldsymbol{x}]-E[Y_i|A_i=0, \boldsymbol{X}_i=\boldsymbol{x}],\]</span>
and finally identify and estimate the target estimand <span class="math inline">\(\Delta(1, 0)\)</span> by
averaging over confounders <span class="math inline">\(\boldsymbol{X}\)</span>. Thus, the two key tasks in
estimating causal effects are identifying the confounders among a
potentially large set of covariates, and determining the outcome model
(i.e., <span class="math inline">\(E[Y_i|A_i=a, \boldsymbol{X}_i=\boldsymbol{x}]\)</span>,
<span class="math inline">\(a \in \{0, 1\}\)</span>) with flexibility and precision. The
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> R package was
developed to address these challenges by utilizing Bayesian additive
regression trees (BART) models for confounder selection and causal
effect estimation.</p>
<h4 class="unnumbered" data-number="2.1" id="overview-of-bart">Overview of BART</h4>
<p>The BART model <span class="citation" data-cites="chipman2010bart">(<a href="#ref-chipman2010bart" role="doc-biblioref">Chipman et al. 2010</a>)</span> is an ensemble of decision trees that
can be represented by the following equations:</p>
<p><span class="math display">\[\begin{aligned}
y_i &amp;=&amp;  \mu_0+f(\boldsymbol{X}_i) + \epsilon_i \\
f(\boldsymbol{X}_i) &amp;=&amp; \sum_{t=1}^T g(\boldsymbol{X}_i ; \mathcal{T}_t, \mathcal{M}_t),
\end{aligned}\]</span>
where <span class="math inline">\(\epsilon_i\)</span> follows a normal distribution with mean 0 and
variance <span class="math inline">\(\sigma^2\)</span>, and
<span class="math inline">\(g(\boldsymbol{X}_i; \mathcal{T}_t, \mathcal{M}_t)\)</span> is a function that
maps the tree structure and parameters to the response, for all
<span class="math inline">\(i=1, \cdots, N\)</span>. We specify a BART prior on <span class="math inline">\(f\)</span>, comprised primarily of
two components: a prior concerning the complexity of each tree,
<span class="math inline">\(\mathcal{T}_t\)</span>, and a prior concerning its terminal nodes,
<span class="math inline">\(\mathcal{M}_t\)</span>. For each of <span class="math inline">\(T\)</span> distinct trees, <span class="math inline">\(\mathcal{T}_t\)</span>
represents the structure of the <span class="math inline">\(t\)</span>-th tree and
<span class="math inline">\(\mathcal{M}_t = \{\mu_{t,1}, \mu_{t,2}, \cdots, \mu_{t,n_t}\}\)</span>
represents its mean parameters at the terminal nodes. Each tree has
internal nodes that are split based on a “splitting variable” <span class="math inline">\(X_j\)</span> and
“splitting value” <span class="math inline">\(c\)</span> (Figure <a href="#fig:bart" data-reference-type="ref" data-reference="fig:bart">2</a>). In many papers that use continuous outcome data,
the outcome variable <span class="math inline">\(y\)</span> is centered. In this case, <span class="math inline">\(\mu_0\)</span> is set to
<span class="math inline">\(0\)</span>. As mentioned in <span class="citation" data-cites="sparapani2016nonparametric">(<a href="#ref-sparapani2016nonparametric" role="doc-biblioref">Sparapani et al. 2016</a>)</span>, when the sample size
is moderate or larger, centering is not necessarily required due to the
flexibility of <span class="math inline">\(f\)</span>. Proceeding with the assumption that the outcome data
has also been centered, <span class="math inline">\(\mu_0 = 0\)</span> for the explanation here.</p>
<p>In the Markov Chain Monte Carlo (MCMC) update, Bayesian
backfitting<span class="citation" data-cites="hastie2000bayesian">(<a href="#ref-hastie2000bayesian" role="doc-biblioref">Hastie and Tibshirani 2000</a>)</span> is utilized within a
Metropolis-within-Gibbs sampler. This involves fitting each tree in the
ensemble sequentially, using the residual responses:
<span class="math inline">\(\mathbf{R}_{-t} : = \mathbf{y} - \sum_{j \neq t} g(\boldsymbol{X}; \mathcal{T}_j, \mathcal{M}_j)\)</span>
where <span class="math inline">\(\mathbf{R}_{-t}\)</span> denotes unexplained outcome residuals for the
<span class="math inline">\(t\)</span>-th tree. In each iteration of the MCMC update, a new tree structure
is proposed by randomly selecting one of three possible tree
alterations:</p>
<ul>
<li><p>GROW: Choose a terminal node at random, and create two new terminal
nodes. This process involves randomly selecting a predictor, <span class="math inline">\(X_j\)</span>,
and its associated “splitting value,” <span class="math inline">\(c\)</span>, to create the two new
terminal nodes.</p></li>
<li><p>PRUNE: Pick an internal node at random where both children are
terminal nodes (known as a “singly internal node”
<span class="citation" data-cites="kapelner2013bartmachine">(<a href="#ref-kapelner2013bartmachine" role="doc-biblioref">Kapelner and Bleich 2016</a>)</span>) and remove both of its children (thus
making it a terminal node).</p></li>
<li><p>CHANGE: Select an internal node at random and modify its splitting
variable and value according to the priors.</p></li>
</ul>
<p>When BART was first introduced by <span class="citation" data-cites="chipman2010bart">Chipman et al. (<a href="#ref-chipman2010bart" role="doc-biblioref">2010</a>)</span>, four tree alteration
steps (GROW, PRUNE, CHANGE, and SWAP) were considered. However,
following work by <span class="citation" data-cites="kapelner2013bartmachine">Kapelner and Bleich (<a href="#ref-kapelner2013bartmachine" role="doc-biblioref">2016</a>)</span>, who proposed the
<code>bartMachine</code> package for BART implementation, demonstrated that
omitting the SWAP step does not significantly affect the performance in
terms of tree updates or parameter mixing. Notably, since GROW and PRUNE
are paired as opposite moves, and CHANGE moves are reversible through
opposite-direction CHANGE moves, the detailed balance condition
continues to hold without the SWAP step. Specifically, when using the
grow and change alterations, a new covariate is randomly selected from a
set of <span class="math inline">\(P\)</span> available covariates as the splitting variable, according to
the assumed prior. The original BART model used a uniform prior of
<span class="math inline">\(\{1/P, 1/P, \cdots, 1/P\}\)</span> on the selection probabilities
<span class="math inline">\(\boldsymbol{s} = (s_1, s_2, \cdots, s_P)\)</span>. However, to promote
sparsity, Linero (2018) proposed using a Dirichlet prior
<span class="math inline">\((s_1, s_2, \cdots, s_P) \sim \mathcal{D}(\alpha/P, \cdots, \alpha/P)\)</span>.
This prior specification, as outlined in Table
<a href="#tab:T1" data-reference-type="ref" data-reference="tab:models">1</a>, enables the
variable selection functionality of the
<a href="https://cran.r-project.org/package=BART">BART</a> package. Through this,
it can be utilized as a Bayesian variable selection method to choose
important predictors in regression problems. <span class="citation" data-cites="kim2023bnp">(<a href="#ref-kim2023bnp" role="doc-biblioref">Kim et al. 2023</a>)</span> have adapted
this method for causal inference, proposing a way to select confounders.
By specifying a common Dirichlet prior on the selection probabilities of
the outcome and exposure models, it allows for the selection of
important variables (i.e., confounders) in both models. Additionally, it
is worth noting that a tree rotation proposal <span class="citation" data-cites="pratola2016efficient">(<a href="#ref-pratola2016efficient" role="doc-biblioref">Pratola 2016</a>)</span>
has been suggested to enable more radical mixing than the classical
‘change’ alteration step. This aspect is planned to be incorporated into
the future updates of the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> package. In the
following section, we will explain the specific setting of this method
and the steps involved in computing the posterior distributions.</p>
<figure id="fig:bart">
<img src="fig/fig1.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 2: The tree structures consist of <span class="math inline">\(T\)</span> trees, each with nodes
represented by circles. Terminal nodes, shown in blue, have <span class="math inline">\(\mu\)</span>
values. The outcome estimate <span class="math inline">\(\hat{Y}\)</span> of each observation is calculated
by adding up the <span class="math inline">\(\mu\)</span> values of the terminal nodes where the
observation falls within each tree. The method used to split each
internal node into two different children nodes is the “splitting rule,”
which consists of a “splitting variable” (i.e., <span class="math inline">\(X_j\)</span>) and a “splitting
value” (i.e., <span class="math inline">\(c\)</span>).</figcaption>
</figure>
<h4 class="unnumbered" data-number="2.2" id="bart-confounder-selection">BART confounder selection</h4>
<p>The <a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> package in R is
designed for selecting confounding variables, particularly when a large
number of potential confounding variables are present, and for
estimating the average treatment effect (ATE) given the chosen set of
confounding variables. To accomplish this, the package uses the Bayesian
additive regression trees (BART) model to specify the exposure and
outcome models as follows:
<span class="math display" id="eq:1">\[\begin{aligned}
P(A_i=1) &amp;=&amp; \Phi\left(\mu_1+f_1(\boldsymbol{X}_i)\right) \label{eq:1}
\end{aligned}   \tag{1}\]</span></p>
<p><span class="math display">\[\begin{aligned}
f_1(\boldsymbol{X}_i) &amp;=&amp;  \sum_{t=1}^T g_1(\boldsymbol{X}_i ; \mathcal{T}_t, \mathcal{M}_t) \nonumber
\end{aligned}\]</span></p>
<p><span class="math display" id="eq:2">\[\begin{aligned}
{\underline{Separate Outcome Models}}: \quad  Y_i | A_i =a &amp;=&amp;  \mu_2^a + f_2^a(\boldsymbol{X}_i)+ \epsilon_i^a, \quad \epsilon_i^a \sim N(0, \sigma_a^2) \label{eq:2}
\end{aligned}   \tag{2}\]</span></p>
<p><span class="math display">\[\begin{aligned}
f_2^a(\boldsymbol{X}_i) &amp;=&amp;  \sum_{t=1}^T g_2^a(\boldsymbol{X}_i ; \mathcal{T}_t^a, \mathcal{M}_t^a) \nonumber
\end{aligned}\]</span></p>
<p><span class="math display" id="eq:3">\[\begin{aligned}
{\underline{Single Outcome Model}}: \qquad \qquad  \qquad Y_i &amp; = &amp; \mu_3 +  f_3(A_i, \boldsymbol{X}_i)+ \epsilon_i, \quad \epsilon_i \sim N(0, \sigma^2), \label{eq:3}
\end{aligned}   \tag{3}\]</span></p>
<p><span class="math display">\[\begin{aligned}
f_3(A_i, \boldsymbol{X}_i) &amp; = &amp; \sum_{t=1}^T g_3(A_i, \boldsymbol{X}_i ; \mathcal{T}_t^\prime, \mathcal{M}_t^\prime) \nonumber\\
f_1  \sim  \text{BART} ,&amp;&amp; f_2^a  \sim  \text{BART},  \qquad  f_3  \sim  \text{BART} \nonumber
\end{aligned}\]</span>
for <span class="math inline">\(i=1, \cdots, N\)</span> in Equations <a href="#eq:1">(1)</a> and <a href="#eq:3">(3)</a>, and for
<span class="math inline">\(i \in \mathcal{I}_a\)</span> where <span class="math inline">\(\mathcal{I}_a\)</span> denotes a set of units under
each exposure arm <span class="math inline">\(a \in \{0, 1\}\)</span> in Equation <a href="#eq:2">(2)</a>. In
Equation <a href="#eq:1">(1)</a>, <span class="math inline">\(\Phi(\cdot)\)</span> is the standard normal cumulative
distribution function. Note that it is required to replace
Equation <a href="#eq:1">(1)</a> with
<span class="math inline">\(A_i = \mu_1+f_1(\boldsymbol{X}_i) + \epsilon_i\)</span> where
<span class="math inline">\(\epsilon_i \sim N(0, \tau^2)\)</span> when considering a continuous exposure
(in Section 5). As mentioned earlier, here we will proceed with the
assumption that the outcome data has been centered, setting <span class="math inline">\(\mu_1\)</span>,
<span class="math inline">\(\mu_2^a\)</span>, and <span class="math inline">\(\mu_3\)</span> to 0 for the purpose of elaborating on the
methodology. We incorporate a common sparsity-inducing Dirichlet prior
<span class="math inline">\(\boldsymbol{s}_{12}=(s_1, s_2, \cdots, s_P) \sim \mathcal{D}(\alpha/P, \cdots, \alpha/P)\)</span>
in the exposure model (Equation <a href="#eq:1">(1)</a>) and the outcome model
(Equation <a href="#eq:2">(2)</a>) resulting in a conjugate update (Figure
<a href="#fig:connection" data-reference-type="ref" data-reference="fig:connection">3</a>).
Alternatively, a common Dirichlet prior is introduced on
<span class="math inline">\(\boldsymbol{s}_{13} = (s_0, s_1, s_2, \cdots , s_P)\)</span> in the single
outcome model (Equation <a href="#eq:3">(3)</a>), where <span class="math inline">\(s_0\)</span> represents the
probability of exposure <span class="math inline">\(A\)</span>, and the transformed form of
<span class="math inline">\(\boldsymbol{s}_{13}\)</span> is incorporated as the selection probability in
the exposure model. We will delve into this aspect in detail later.</p>
<p>If a particular covariate, <span class="math inline">\(X_j\)</span>, is frequently used as a splitting
variable in either the model for <span class="math inline">\(A\)</span> or the model for <span class="math inline">\(Y\)</span>, the model
will assign more weight to the selection probability <span class="math inline">\(s_j\)</span> through
larger numbers of splits on <span class="math inline">\(X_j\)</span>. This means that the selection
probabilities will tend to favor covariates that have a relationship
with <span class="math inline">\(A\)</span>, <span class="math inline">\(Y\)</span>, or both <span class="math inline">\(A\)</span> and <span class="math inline">\(Y\)</span>. The final confounders chosen for
effect estimation in the model for <span class="math inline">\(Y\)</span> will be those that were proposed
for splitting through this prior and were accepted during the updating
step of the model for <span class="math inline">\(Y\)</span>, which will further prioritize variables that
have a relationship with <span class="math inline">\(Y\)</span>. This characteristic satisfies the
“disjunctive cause criterion without instruments” in confounder
selection.</p>
<figure id="fig:connection">
<img src="fig/fig2.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 3: A shared sparsity-inducing prior for the selection
probability vector connects the exposure model and outcome model,
enabling the selection of the splitting variables in both models. The
selection probability vector is updated based on the number of splitting
variables used to describe each tree.</figcaption>
</figure>
<h5 class="unnumbered" data-number="2.2.1" id="remark">Remark</h5>
<p>The proposed method assumes that the available set of high-dimensional
covariates in the dataset includes all true confounders. Therefore, it
is not necessary (and indeed may be detrimental) to pre-select
covariates, as doing so could inadvertently exclude true confounders. By
providing all available <span class="math inline">\(P\)</span> covariates (potential confounders) as input,
the proposed method will select confounders in a data-driven manner.</p>
<p>However, if there are unmeasured confounders (i.e., if not all true
confounders are included in the set of potential confounders), our
method cannot entirely avoid biases (e.g., Z-bias, M-bias, etc.). If you
suspect that important confounders are unmeasured (thus missing from the
potential confounders set), we recommend excluding, in advance,
variables that are suspected of being instrumental variables (which
affect only the exposure but not the outcome), as well as potential
colliders (variables that are believed to have no direct effects on both
exposure and outcome), before applying the proposed method.</p>
<h5 class="unnumbered" data-number="2.2.2" id="separate-outcome-models">Separate outcome models</h5>
<p>For a binary exposure, we separate the outcome model into two distinct
sub-models, in order to align the dimensions of the covariates in both
the exposure and outcome models (note that the outcome model includes
exposure <span class="math inline">\(A\)</span> as an additional covariate if a single outcome model is
specified). For Equations <a href="#eq:1">(1)</a> and <a href="#eq:2">(2)</a>, a
sparsity-inducing prior is applied to
<span class="math inline">\(\boldsymbol{s}_{12} = (s_1, s_2, \cdots, s_P)\)</span>, which is shared among
three models: one for exposure and two for outcomes.</p>
<p>We use “Bayesian backfitting”<span class="citation" data-cites="hastie2000bayesian">(<a href="#ref-hastie2000bayesian" role="doc-biblioref">Hastie and Tibshirani 2000</a>)</span> to obtain posterior
samples for the exposure and outcome models. For the exposure model,
this involves a Metropolis-within-Gibbs sampler, where we fit each tree
<span class="math inline">\(\mathcal{T}_t\)</span> iteratively using residual responses :
<span class="math display">\[R_{i,-t} = Z_i - \sum_{j \neq t}g_1(\boldsymbol{X}_i; \mathcal{T}_j, \mathcal{M}_j)\]</span>
for <span class="math inline">\(i=1, \cdots, N\)</span> where <span class="math inline">\(Z_i\)</span> is a latent variable for the binary
exposure constructed based on <span class="citation" data-cites="albert1993bayesian">(<a href="#ref-albert1993bayesian" role="doc-biblioref">Albert and Chib 1993</a>)</span> as follows
<span class="math display">\[Z_i \sim \left\{ \begin{array}{ll}
         N\left(f_1(\boldsymbol{X}_i), 1\right)I_{(Z_i  &gt; 0)} &amp; for A_i =1 ;\\
        N\left(f_1(\boldsymbol{X}_i), 1\right)I_{(Z_i  \leq 0)} &amp; for A_i = 0 .\end{array} \right.\]</span>
Note that the variance parameter (<span class="math inline">\(\sigma^2\)</span>) is assigned a value of <span class="math inline">\(1\)</span>
as a result of the construction of the latent variable. For each tree
<span class="math inline">\(\mathcal{T}_t\)</span> for the exposure model, we propose a new tree structure
<span class="math inline">\(\mathcal{T}_t\)</span> from the full conditional
<span class="math inline">\([\mathcal{T}_t | R_{1, -t}, \cdots, R_{n, -t}]\)</span> (i.e., grow, prune or
change alterations), and update the parameters within the tree through
the full conditional
<span class="math inline">\([\mathcal{M}_t | \mathcal{T}_t, R_{1, -t}, \cdots, R_{n, -t}]\)</span>.</p>
<p>To draw samples for <span class="math inline">\(\mathcal{M}_t\)</span>, we assume a prior
<span class="math inline">\(\mu \sim N(\mu_\mu/T, \sigma^2_\mu)\)</span> on each of the leaf parameters
<span class="math inline">\(\mathcal{M}_t=\{\mu_1, \mu_2, \cdots, \mu_{t_b}\}\)</span>, where <span class="math inline">\({t_b}\)</span> is
the number of terminal nodes in tree <span class="math inline">\(\mathcal{T}_t\)</span>. The range center
of latent variable <span class="math inline">\(Z_i\)</span>’s is set as the mean, <span class="math inline">\(\mu_\mu\)</span>, and
<span class="math inline">\(\sigma^2_\mu\)</span> is empirically determined to satisfy
<span class="math inline">\(T \mu_\mu - 2 \sqrt{T} \sigma_\mu = Z_{\text{min}}\)</span> and
<span class="math inline">\(T \mu_\mu + 2 \sqrt{T} \sigma_\mu = Z_{\text{max}}\)</span> where
<span class="math inline">\(Z_{\text{min}}\)</span> and <span class="math inline">\(Z_{\text{max}}\)</span> represent the minimum and maximum
values of <span class="math inline">\(Z_i\)</span>’s <span class="citation" data-cites="kapelner2013bartmachine">(<a href="#ref-kapelner2013bartmachine" role="doc-biblioref">Kapelner and Bleich 2016</a>)</span>.</p>
<p>We generate a sample <span class="math inline">\(\mu_\eta\)</span> from the posterior distribution for the
<span class="math inline">\(\eta\)</span>-th terminal node in tree <span class="math inline">\(\mathcal{T}_t\)</span> by using the following
equation:
<span class="math display">\[\mu_\eta \sim N\left(\frac{1}{1/\sigma_\mu^2+n_\eta/\sigma^2} \left(\frac{\mu_\mu/T}{\sigma^2_\mu}+\frac{\sum_{i\in \mathcal{O}_\eta} R_{i, -t}}{\sigma^2}\right), \left(\frac{1}{\sigma_\mu^2}+\frac{n_\eta}{\sigma^2}\right)^{-1}\right),\]</span>
where <span class="math inline">\(\mathcal{O}_\eta\)</span> and <span class="math inline">\(n_\eta\)</span> correspond to the observation
indices and the number of observations, respectively, for the <span class="math inline">\(\eta\)</span>-th
terminal node. In our implementation, we set the <span class="math inline">\(\mu_\mu\)</span> value to 0,
and consequently, the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> package is
constructed to shift the <span class="math inline">\(Y\)</span> and <span class="math inline">\(Z\)</span> variables to have a mean value of
0.</p>
<p>For separate outcome models, we also perform a backfitting step to draw
samples from
<span class="math inline">\(P(\mathcal{T}_1^a, \cdots, \mathcal{T}_T^a,  \mathcal{M}_1^a, \cdots, \mathcal{M}_T^a, \sigma^2_a | \boldsymbol{D})\)</span>
for each <span class="math inline">\(A = a \in \{0, 1\}\)</span> by computing the residual responses
iteratively as follows:
<span class="math display">\[H_{i,-t}^a = y_i - \sum_{j\neq t} g_2^a(\boldsymbol{X}_i; \mathcal{T}_j^a, \mathcal{M}_j^a) \,\, \text{ for } i \in \mathcal{I}_a,\]</span>
where <span class="math inline">\(\mathcal{I}_a\)</span> represents the set of observations corresponding
to <span class="math inline">\(A=a \in \{0,1\}\)</span>. Afterwards, a process is undertaken to update each
tree based on <span class="math inline">\([\mathcal{T}_t^a | H_{\cdot, -t}^a, \sigma_a^2]\)</span> and the
parameters of its corresponding terminal nodes from
<span class="math inline">\([\mathcal{M}_t^a | \mathcal{T}_t^a, H_{\cdot, -t}, \sigma_a^2]\)</span> for
each exposure level <span class="math inline">\(a \in \{0,1\}\)</span>. This process is analogous to the
one described earlier for the exposure model.</p>
<p>For each MCMC iteration, once all the tree structures and corresponding
parameters have been updated, we proceed to update the variance
parameter (<span class="math inline">\(\sigma^2_a\)</span> in each outcome model (<a href="#eq:2">(2)</a>)) using the
Gibbs sampler. This is achieved by sampling from the inverse gamma
distribution given by:
<span class="math display">\[\sigma^2_{a} \sim \text{Inv.Gamma}\left(a_\sigma+\frac{|\mathcal{I}_a|}{2}, b_\sigma+\frac{1}{2}\left\{\sum_{i \in \mathcal{I}_a} \left(y_i - \sum_{t=1}^T g_2^a(\boldsymbol{X}_i; \mathcal{T}_t^a, \mathcal{M}_t^a)\right) \right\}\right),\]</span>
where <span class="math inline">\(a_\sigma=b_\sigma=3\)</span>.</p>
<p>Next, we update the parameter <span class="math inline">\(\alpha\)</span> in the prior distribution of
selection probabilities
<span class="math inline">\(\boldsymbol{s}_{12} \sim \mathcal{D}(\alpha/P, \cdots, \alpha/P)\)</span> based
on a prior of the form <span class="math inline">\(\alpha/(\alpha+P) \sim \text{Beta}(a_0, b_0)\)</span>,
where <span class="math inline">\(a_0=0.5\)</span> and <span class="math inline">\(b_0=1\)</span> <span class="citation" data-cites="linero2018bayesian">(<a href="#ref-linero2018bayesian" role="doc-biblioref">Linero 2018</a>)</span>. The
Metropolis-Hastings algorithm is then used to update the parameter. To
delve deeper into the <span class="math inline">\(\alpha\)</span> prior in high-dimensional data, refer to
<span class="citation" data-cites="BART">(<a href="#ref-BART" role="doc-biblioref">Sparapani et al. 2021</a>)</span>. Finally, we update <span class="math inline">\(\boldsymbol{s}_{12}\)</span> using a conjugate
sampling update as follows:
<span class="math inline">\(\boldsymbol{s}_{12} \sim \mathcal{D}(\alpha/P+n_{1,1}+n_{1,21}+n_{1,20}, \cdots, \alpha/P+n_{P,1}+n_{P,21}+n_{P,20})\)</span>,
where <span class="math inline">\(n_{j,21}\)</span> and <span class="math inline">\(n_{j,20}\)</span> represent the numbers of splits on the
confounder <span class="math inline">\(X_j\)</span> in two separate outcome models, and <span class="math inline">\(n_{j,1}\)</span>
represents the number of splits on <span class="math inline">\(X_j\)</span> in the exposure model.</p>
<p>The posterior computation process for the approach employing the
separate outcome models strategy is outlined in Algorithm 1 through
pseudocode.</p>
<figure id="alg:separate">
<img src="alg/algseparate.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Algorithm 1: Posterior Computation (Separate Outcome
Models)</figcaption>
</figure>
<h5 class="unnumbered" data-number="2.2.3" id="single-outcome-model">Single outcome model</h5>
<p>Using two separate outcome models for two exposure levels, as outlined
in <span class="citation" data-cites="bartcause">(<a href="#ref-bartcause" role="doc-biblioref">Hill 2011</a>)</span> and <span class="citation" data-cites="hahn2020bayesian">(<a href="#ref-hahn2020bayesian" role="doc-biblioref">Hahn et al. 2020</a>)</span>, can result in biased estimates
if there is a lack of common support in confounders. While a single
outcome model can be a viable alternative, it can be challenging to
apply a shared sparsity-inducing prior to
<span class="math inline">\(\boldsymbol{s}_{12} = (s_1, s_2, \cdots, s_P)\)</span> due to differences in
covariate dimensions between the exposure and outcome models. Let
<span class="math inline">\(\boldsymbol{s}_{13} =(s_0, s_1, s_2, \cdots, s_P)\)</span> represent the
selection probabilities, with <span class="math inline">\(s_0\)</span> denoting the probability of exposure
<span class="math inline">\(A\)</span> used in the outcome model. To apply this vector to the exposure
model, <span class="math inline">\(\boldsymbol{s}_{13}\)</span> is transformed to
<span class="math inline">\(\boldsymbol{s}_{13}^\prime = (s_1/(1-s_0), s_2/(1-s_0), \cdots, s_P/(1-s_0))\)</span>.
Then, updating <span class="math inline">\(\boldsymbol{s}_{13}\)</span> is based on the following equation
(likelihood <span class="math inline">\(\times\)</span> prior):
<span class="math display">\[Q = \left(1-s_0\right)^{-n_{\cdot,1}} s_0^{n_{0,3}+\alpha/P-1} s_1^{n_{1,3}+n_{1,1}+\alpha/P-1} \cdots s_P^{n_{P,3}+n_{P,1}+\alpha/P-1},\]</span>
using the Metropolis-Hastings algorithm, where <span class="math inline">\(n_{j,3}\)</span> represents the
number of splits on the confounder <span class="math inline">\(X_j\)</span> in the single outcome model and
<span class="math inline">\(n_{\cdot, 1} = \sum_{j=1}^P n_{j,1}\)</span>. The proposal distribution for
<span class="math inline">\(\boldsymbol{s}_{13}\)</span> is designed to follow the full conditional in the
separate outcome models,
<span class="math inline">\(\mathcal{D}(n_{0,3}+c+\alpha/P, n_{1,1}+n_{1,3}+\alpha/P, n_{2,1}+n_{2,3}+\alpha/P, \cdots, n_{P,1}+n_{P,3}+\alpha/P)\)</span>,
and a positive value <span class="math inline">\(c\)</span> is added to prevent proposals for infrequent
exposure. In the <a href="https://cran.r-project.org/package=bartcs">bartcs</a>
package, the value of <span class="math inline">\(c\)</span> is set to the number of splits on <span class="math inline">\(A\)</span> in the
outcome model (<span class="math inline">\(n_{0,3}\)</span>). This is to ensure sufficient proposal
probability for exposure. Whether the proposed variables are actually
accepted is determined through the M-H step, so based on our experience,
this setting does not significantly affect the performance of confounder
selection.</p>
<p>All posterior computation steps are identical to the separate outcome
models method, except for the difference that there is only one outcome
model. Therefore, updates for the trees and parameters of the outcome
model are based on one
<span class="math inline">\([\mathcal{T}_t^\prime | \boldsymbol{H}_{\cdot, -t}, \sigma^2]\)</span> and one
<span class="math inline">\([\mathcal{M}^\prime_t | \mathcal{T}_t^\prime, \boldsymbol{H}_{\cdot, -t}, \sigma^2]\)</span>
for each tree <span class="math inline">\(t\)</span>. Subsequently, sampling for <span class="math inline">\(\sigma^2\)</span> is carried out
based on the following inverse gamma distribution:
<span class="math display">\[\sigma^2 \sim \text{Inv.Gamma}\left(a_\sigma+\frac{N}{2}, b_\sigma+\frac{1}{2}\left\{\sum_{i=1}^{N} \left(Y_i - \sum_{t=1}^T g_3(\boldsymbol{X}_i; \mathcal{T}_t^\prime, \mathcal{M}_t^\prime)\right) \right\}\right),\]</span>
where <span class="math inline">\(a_\sigma=b_\sigma=3\)</span>. The posterior computation process for the
approach employing the single outcome model strategy is outlined in
Algorithm 2 through pseudocode.</p>
<figure id="alg:single">
<img src="alg/algsingle.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Algorithm 2: Posterior Computation (Single Outcome
Model)</figcaption>
</figure>
<p>Given the <span class="math inline">\(M\)</span> set of posterior samples for BART parameters, the causal
effect estimand <span class="math inline">\(\Delta(1, 0)\)</span> can be estimated using either the
separate models or the single model. For the separate outcome models,
the estimate is obtained by
<span class="math display">\[\hat{\Delta}(1,0) = \frac{1}{N} \sum_{i=1}^N\left[\frac{1}{M} \sum_{m=1}^M \left\{f_2^{1,(m)}(\boldsymbol{X}_i) - f_2^{0,(m)}(\boldsymbol{X}_i) \right\}\right],\]</span>
where <span class="math inline">\(f_2^{a,(m)}\)</span> is the <span class="math inline">\(m\)</span>-th posterior samples for
<span class="math inline">\(A = a\in\{0, 1\}\)</span>. For the single outcome model, the estimate is
obtained by
<span class="math display">\[\hat{\Delta}(1,0) = \frac{1}{N} \sum_{i=1}^N\left[\frac{1}{M} \sum_{m=1}^M \left\{f_3^{(m)}(1, \boldsymbol{X}_i) - f_3^{(m)}(0, \boldsymbol{X}_i)\right\}\right],\]</span>
where <span class="math inline">\(f_3^{(m)}\)</span> is the <span class="math inline">\(m\)</span>-th posterior samples.</p>
<h3 data-number="3" id="sec:simulated"><span class="header-section-number">3</span> Simulated example</h3>
<p>The <a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> R package makes
it easy to implement the confounder selection process described in the
previous section. It includes two main functions, <code>separate_bart()</code> for
the separate outcome models and <code>single_bart()</code> for the single outcome
model. The package not only offers a summary of the estimated causal
effects but also includes visualizations of posterior inclusion
probabilities and convergence.</p>
<p>The <a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> package offers
multi-threading support through Open Multi-Processing (OpenMP), an API
for shared memory parallel programming that manages thread creation,
management, and synchronization for efficient data and computation
division among different threads. This allows
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> to specify intensive
computations as parallel regions, leading to improved computational
efficiency through parallel computing.</p>
<p>The <a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> package is
available under the general public license (GPL <span class="math inline">\(\geq3\)</span>) from the
Comprehensive R Archive Network (CRAN) at
<a href="https://CRAN.R-project.org/package=bartcs">https://cran.r-project.org/package=bartcs</a>
and can be installed and loaded into the current R session as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;bartcs&quot;</span>, <span class="at">dependencies=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;bartcs&quot;</span>)</span></code></pre></div>
<p>We will showcase the practical usage of the features in the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> package using
simulated examples and the Infant Health and Development Program (IHDP)
data.</p>
<p>As a simple example of the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> package, we use a
simulated dataset from Scenario 1 in <span class="citation" data-cites="kim2023bnp">(<a href="#ref-kim2023bnp" role="doc-biblioref">Kim et al. 2023</a>)</span> to illustrate its
features. The data-generating model incorporates both the non-linear
propensity score and outcome models, and serves to evaluate the ability
to detect 5 true confounding variables out of a huge set of possible
covariates, along with the precision of the model’s estimation. The
dataset consists of 300 observations with 100 potential confounders
(<span class="math inline">\(X_1 - X_{100}\)</span>), each generated from a normal distribution with mean 0
and variance 1. Of the 100 possible confounders, <span class="math inline">\(X_1 - X_5\)</span> are true
confounders. The outcome model includes the five true confounders and
two additional predictors, <span class="math inline">\(X_6\)</span> and <span class="math inline">\(X_7\)</span> as follows:</p>
<p><span class="math display">\[\begin{aligned}
P(A_i=1) &amp;=&amp; \Phi(0.5+h_1(X_{i,1}) + h_2(X_{i,2}) - 0.5 |X_{i,3}-1| +1.5 X_{i,4} X_{i,5})\\
Y_i &amp; = &amp; f(\boldsymbol{X}_i) + \epsilon_i, \quad \epsilon_i \sim N(0, 0.3^2) \\
f(\boldsymbol{X}_i) &amp; = &amp; h_1(X_{i,1}) + 1. 5 h_2(X_{i,2}) - A_i + 2 |X_{i,3}+1| + 2 X_{i,4} + \exp(0.5 X_{i,5}) \\
&amp; &amp; - 0.5 A_i |X_{i,6}| - A_i |X_{i,7}+1|
\end{aligned}\]</span>
where <span class="math inline">\(h_1(x) = (-1)^{I(x&lt;0)}\)</span> and <span class="math inline">\(h_2(x) = (-1)^{I(x\geq0)}\)</span> for
<span class="math inline">\(i=1, \cdots, 300\)</span>. The data was generated with the following code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>cov <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>     cov[[i]] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, cov)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(X[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(X[, <span class="dv">2</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="fl">0.5</span> <span class="sc">+</span> h1 <span class="sc">+</span> h2 <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">*</span> X[, <span class="dv">5</span>])</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>Trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, prob)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">*</span> h1 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> h2 <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">+</span> <span class="fu">exp</span>(<span class="fl">0.5</span> <span class="sc">*</span> X[, <span class="dv">5</span>]) <span class="sc">-</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.5</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">6</span>]) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">7</span>] <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">*</span> h1 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> h2 <span class="sc">-</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">+</span> <span class="fu">exp</span>(<span class="fl">0.5</span> <span class="sc">*</span> X[, <span class="dv">5</span>]) <span class="sc">-</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.5</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">6</span>]) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">7</span>] <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, mu1, <span class="fl">0.3</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, mu0, <span class="fl">0.3</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Trt <span class="sc">*</span> Y1 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> Trt) <span class="sc">*</span> Y0</span></code></pre></div>
<p>For users’ convenience, the same data can be generated using the
built-in function <code>synthetic_data( )</code> from the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> package with the
following arguments settings: <code>N</code> = 300 (sample size), <code>P</code> = 100 (number
of potential confounders), and <code>seed</code> = 42 (seed number).</p>
<p>Examining the standardized mean differences (SMD) of the (potential)
confounders generated through the data generating process above, the
following observations can be made. The standardized mean differences
(SMD) values presented below were computed using the
<a href="https://cran.r-project.org/package=tableone">tableone</a> R package
<span class="citation" data-cites="tableone">(<a href="#ref-tableone" role="doc-biblioref">Yoshida and Bartel 2022</a>)</span>, which can be installed from CRAN.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tableone&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Xdata <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Trt,X))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Xdata) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Trt&quot;</span>, <span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="st">&quot;X&quot;</span>, <span class="dv">100</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Table <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(<span class="at">vars =</span> <span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="st">&quot;X&quot;</span>, <span class="dv">12</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>), <span class="at">strata =</span> <span class="st">&quot;Trt&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> Xdata, <span class="at">test =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Table, <span class="at">smd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                 Stratified by Trt</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                  <span class="dv">0</span>            <span class="dv">1</span>            SMD</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  n                 <span class="dv">164</span>          <span class="dv">136</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X1</span> (<span class="fu">mean</span> (SD))   <span class="fl">0.28</span> (<span class="fl">0.96</span>) <span class="sc">-</span><span class="fl">0.39</span> (<span class="fl">0.90</span>)  <span class="fl">0.718</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X2</span> (<span class="fu">mean</span> (SD))  <span class="sc">-</span><span class="fl">0.25</span> (<span class="fl">0.99</span>)  <span class="fl">0.24</span> (<span class="fl">0.92</span>)  <span class="fl">0.517</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X3</span> (<span class="fu">mean</span> (SD))  <span class="sc">-</span><span class="fl">0.14</span> (<span class="fl">1.02</span>)  <span class="fl">0.03</span> (<span class="fl">0.90</span>)  <span class="fl">0.178</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X4</span> (<span class="fu">mean</span> (SD))   <span class="fl">0.06</span> (<span class="fl">1.08</span>) <span class="sc">-</span><span class="fl">0.07</span> (<span class="fl">1.04</span>)  <span class="fl">0.118</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X5</span> (<span class="fu">mean</span> (SD))  <span class="sc">-</span><span class="fl">0.08</span> (<span class="fl">0.86</span>)  <span class="fl">0.01</span> (<span class="fl">1.05</span>)  <span class="fl">0.091</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X6</span> (<span class="fu">mean</span> (SD))  <span class="sc">-</span><span class="fl">0.03</span> (<span class="fl">1.06</span>)  <span class="fl">0.15</span> (<span class="fl">0.98</span>)  <span class="fl">0.177</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X7</span> (<span class="fu">mean</span> (SD))  <span class="sc">-</span><span class="fl">0.04</span> (<span class="fl">1.03</span>)  <span class="fl">0.01</span> (<span class="fl">0.94</span>)  <span class="fl">0.050</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X8</span> (<span class="fu">mean</span> (SD))  <span class="sc">-</span><span class="fl">0.11</span> (<span class="fl">0.99</span>)  <span class="fl">0.20</span> (<span class="fl">1.00</span>)  <span class="fl">0.312</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X9</span> (<span class="fu">mean</span> (SD))   <span class="fl">0.07</span> (<span class="fl">1.04</span>)  <span class="fl">0.05</span> (<span class="fl">1.02</span>)  <span class="fl">0.017</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X10</span> (<span class="fu">mean</span> (SD)) <span class="sc">-</span><span class="fl">0.04</span> (<span class="fl">1.13</span>) <span class="sc">-</span><span class="fl">0.13</span> (<span class="fl">0.96</span>)  <span class="fl">0.087</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X11</span> (<span class="fu">mean</span> (SD))  <span class="fl">0.05</span> (<span class="fl">1.02</span>) <span class="sc">-</span><span class="fl">0.12</span> (<span class="fl">0.98</span>)  <span class="fl">0.169</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">X12</span> (<span class="fu">mean</span> (SD))  <span class="fl">0.13</span> (<span class="fl">1.01</span>) <span class="sc">-</span><span class="fl">0.23</span> (<span class="fl">0.99</span>)  <span class="fl">0.363</span></span></code></pre></div>
<p>When looking at the results for the first 12 <span class="math inline">\(X\)</span> variables, it is noted
that for true confounders <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span>, SMD values greater than 0.1,
indicative of inadequate covariate balance between the groups, are
observed. Similar lack of covariate balance between the groups is also
noticed for <span class="math inline">\(X_3\)</span> and <span class="math inline">\(X_4\)</span>. However, due to randomness, differences
between the groups are observed for some covariates other than the true
confounders. In this simulation scenario, with the partial presence of
the signal from some covariates other than true confounders, the goal is
to assess the performance of the model under consideration.</p>
<p>With a generated data set, we fit the BART confounder selection model
(the separate outcome models) using <code>separate_bart()</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;bartcs&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>separate_fit <span class="ot">&lt;-</span> <span class="fu">separate_bart</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">Y =</span> Y, <span class="at">trt =</span> Trt, <span class="at">X =</span> X, <span class="at">num_tree =</span> <span class="dv">200</span>, <span class="at">num_chain =</span> <span class="dv">4</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">num_burn_in =</span> <span class="dv">10000</span>, <span class="at">num_thin =</span> <span class="dv">5</span>, <span class="at">num_post_sample =</span> <span class="dv">2000</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>   )</span></code></pre></div>
<p>The following are the main arguments used in the <code>separate_bart()</code>
function call:</p>
<ul>
<li><p><code>Y</code> represents a vector of observed outcome values.</p></li>
<li><p><code>trt</code> denotes a vector of exposure(treatment) values, which is
binary. Binary treatment values need to be either <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>.
Continuous exposure values can be handled in <code>single_bart()</code>
function.</p></li>
<li><p><code>X</code> is a data frame of potential confounders.</p></li>
</ul>
<p>The following are the remaining settings for the fit: 4 MCMC chains
(<code>num_chain</code>) with 200 trees (<code>num_tree</code>) are used. Each MCMC chain runs
20000 iterations, with 10000 burn-in iterations (<code>num_burn_in</code>) and a
thinning factor of 5 (<code>num_thin</code>). There are other optional arguments
available for hyper-parameter settings with the following default
values:</p>
<ul>
<li><p><span class="math inline">\(\alpha=0.95\)</span> (<code>alpha</code>) and <span class="math inline">\(\beta=2\)</span> (<code>beta</code>): these govern the
probability that a node at depth <span class="math inline">\(d\)</span> is nonterminal as follows
<span class="math display">\[\alpha(1+d)^{-\beta}.\]</span></p></li>
<li><p><span class="math inline">\(\nu=3\)</span> (<code>nu</code>) and <span class="math inline">\(q = 0.95\)</span> (<code>q</code>): to set a conjugate prior for
the variance <span class="math inline">\(\sigma^2\)</span> with
<span class="math inline">\(\sigma^2 \sim \nu \lambda / \chi_\nu^2\)</span>, we use the following
equation to determine the values <span class="math inline">\(P(\sigma &lt; \hat{\sigma}) = q\)</span>,
where <span class="math inline">\(\hat{\sigma}\)</span> represents the residual standard deviation
obtained from a linear regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span>.</p></li>
<li><p><span class="math inline">\(P_\text{GROW}=0.28, P_\text{PRUNE}=0.28, P_\text{CHANGE}=0.44\)</span>
(<code>step_prob =  c(0.28, 0.28, 0.44)</code>): probabilities of three tree
alteration steps.</p></li>
<li><p><code>dir_alpha</code> = 5: this is an initial value for hyperparameter
<span class="math inline">\(\alpha\)</span> in the sparsity inducing Dirichlet prior
<span class="math inline">\(\mathcal{D}(\alpha/P, \alpha/P, \cdots, \alpha/P)\)</span>.</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>separate_fit</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">separate_bart()</span><span class="st">`</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>           mean       <span class="fl">2.5</span><span class="sc">%      97.5%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>SATE <span class="sc">-</span><span class="fl">2.2851546</span> <span class="sc">-</span><span class="fl">2.6022894</span> <span class="sc">-</span><span class="fl">1.9692134</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>Y1    <span class="fl">0.7195622</span>  <span class="fl">0.4663024</span>  <span class="fl">0.9833689</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>Y0    <span class="fl">3.0047169</span>  <span class="fl">2.8116436</span>  <span class="fl">3.1946016</span></span></code></pre></div>
<p>The <code>separate_bart()</code> returns a S3
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> object. A
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> object includes the
posterior means and 95% credible intervals for the sample average
treatment effect (<span class="math inline">\(SATE\)</span>), and the potential outcomes <span class="math inline">\(Y(1)\)</span> and <span class="math inline">\(Y(0)\)</span>.
It is important to note that the true values for the <span class="math inline">\(SATE\)</span>, <span class="math inline">\(E[Y(1)]\)</span>,
and <span class="math inline">\(E[Y(0)]\)</span> are <span class="math inline">\(-2.55\)</span>, <span class="math inline">\(0.64\)</span>, and <span class="math inline">\(3.19\)</span> respectively, and the 95%
credible intervals produced by the <code>separate_bart()</code> function include
these values.</p>
<p>For a more in-depth understanding of the output, the <code>summary()</code>
function can be used. It provides details regarding the treatment
values, tree structure, MCMC chain, and outcomes for each of the chains.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(separate_fit)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">separate_bart()</span><span class="st">`</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Treatment Value</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  Treated group    <span class="sc">:</span>      <span class="dv">1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  Control group    <span class="sc">:</span>      <span class="dv">0</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>Tree Parameters</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  Number of Tree   <span class="sc">:</span>    <span class="dv">200</span>     Value  of alpha    <span class="sc">:</span>   <span class="fl">0.95</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  Prob.  of Grow   <span class="sc">:</span>   <span class="fl">0.28</span>     Value  of beta     <span class="sc">:</span>      <span class="dv">2</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  Prob.  of Prune  <span class="sc">:</span>   <span class="fl">0.28</span>     Value  of nu       <span class="sc">:</span>      <span class="dv">3</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  Prob.  of Change <span class="sc">:</span>   <span class="fl">0.44</span>     Value  of q        <span class="sc">:</span>   <span class="fl">0.95</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>Chain Parameters</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  Number of Chains <span class="sc">:</span>      <span class="dv">4</span>     Number of burn<span class="sc">-</span><span class="cf">in</span>  <span class="sc">:</span>  <span class="dv">10000</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  Number of Iter   <span class="sc">:</span>  <span class="dv">20000</span>     Number of thinning <span class="sc">:</span>      <span class="dv">5</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  Number of Sample <span class="sc">:</span>   <span class="dv">2000</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>Outcome</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a> estimand chain       <span class="fl">2.5</span><span class="sc">%         1Q       mean     median         3Q      97.5%</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>     SATE     <span class="dv">1</span> <span class="sc">-</span><span class="fl">2.6070044</span> <span class="sc">-</span><span class="fl">2.3892357</span> <span class="sc">-</span><span class="fl">2.2830389</span> <span class="sc">-</span><span class="fl">2.2800555</span> <span class="sc">-</span><span class="fl">2.1765359</span> <span class="sc">-</span><span class="fl">1.9757766</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>     SATE     <span class="dv">2</span> <span class="sc">-</span><span class="fl">2.6013548</span> <span class="sc">-</span><span class="fl">2.4017854</span> <span class="sc">-</span><span class="fl">2.2877997</span> <span class="sc">-</span><span class="fl">2.2877071</span> <span class="sc">-</span><span class="fl">2.1798863</span> <span class="sc">-</span><span class="fl">1.9611401</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>     SATE     <span class="dv">3</span> <span class="sc">-</span><span class="fl">2.5961329</span> <span class="sc">-</span><span class="fl">2.3952700</span> <span class="sc">-</span><span class="fl">2.2794876</span> <span class="sc">-</span><span class="fl">2.2793208</span> <span class="sc">-</span><span class="fl">2.1609143</span> <span class="sc">-</span><span class="fl">1.9644475</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>     SATE     <span class="dv">4</span> <span class="sc">-</span><span class="fl">2.6090523</span> <span class="sc">-</span><span class="fl">2.4001084</span> <span class="sc">-</span><span class="fl">2.2902924</span> <span class="sc">-</span><span class="fl">2.2923171</span> <span class="sc">-</span><span class="fl">2.1812900</span> <span class="sc">-</span><span class="fl">1.9761443</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>     SATE   agg <span class="sc">-</span><span class="fl">2.6022894</span> <span class="sc">-</span><span class="fl">2.3965077</span> <span class="sc">-</span><span class="fl">2.2851546</span> <span class="sc">-</span><span class="fl">2.2842764</span> <span class="sc">-</span><span class="fl">2.1748201</span> <span class="sc">-</span><span class="fl">1.9692134</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">1</span>  <span class="fl">0.4705203</span>  <span class="fl">0.6322748</span>  <span class="fl">0.7174467</span>  <span class="fl">0.7174147</span>  <span class="fl">0.8027479</span>  <span class="fl">0.9668359</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">2</span>  <span class="fl">0.4707973</span>  <span class="fl">0.6305094</span>  <span class="fl">0.7223111</span>  <span class="fl">0.7213076</span>  <span class="fl">0.8153911</span>  <span class="fl">0.9851455</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">3</span>  <span class="fl">0.4653391</span>  <span class="fl">0.6277828</span>  <span class="fl">0.7190511</span>  <span class="fl">0.7194586</span>  <span class="fl">0.8080547</span>  <span class="fl">0.9804701</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">4</span>  <span class="fl">0.4614500</span>  <span class="fl">0.6273396</span>  <span class="fl">0.7194400</span>  <span class="fl">0.7175295</span>  <span class="fl">0.8087480</span>  <span class="fl">0.9920899</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>       Y1   agg  <span class="fl">0.4663024</span>  <span class="fl">0.6292846</span>  <span class="fl">0.7195622</span>  <span class="fl">0.7185828</span>  <span class="fl">0.8087121</span>  <span class="fl">0.9833689</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">1</span>  <span class="fl">2.8082437</span>  <span class="fl">2.9361088</span>  <span class="fl">3.0004857</span>  <span class="fl">2.9998629</span>  <span class="fl">3.0664869</span>  <span class="fl">3.1897135</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">2</span>  <span class="fl">2.8189069</span>  <span class="fl">2.9442181</span>  <span class="fl">3.0101107</span>  <span class="fl">3.0107896</span>  <span class="fl">3.0778268</span>  <span class="fl">3.2013420</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">3</span>  <span class="fl">2.8002284</span>  <span class="fl">2.9362280</span>  <span class="fl">2.9985387</span>  <span class="fl">2.9972708</span>  <span class="fl">3.0646989</span>  <span class="fl">3.1920314</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">4</span>  <span class="fl">2.8210957</span>  <span class="fl">2.9427012</span>  <span class="fl">3.0097324</span>  <span class="fl">3.0133450</span>  <span class="fl">3.0772579</span>  <span class="fl">3.1960383</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>       Y0   agg  <span class="fl">2.8116436</span>  <span class="fl">2.9404458</span>  <span class="fl">3.0047169</span>  <span class="fl">3.0053406</span>  <span class="fl">3.0713420</span>  <span class="fl">3.1946016</span></span></code></pre></div>
<p>For each estimand category, there are five results (rows) that represent
the output from each of the 4 MCMC chains and an aggregated output.</p>
<p>For visualization purposes, there are two options available as S3
methods for the <a href="https://CRAN.R-project.org/package=bartcs">bartcs</a>
object. The first option is the posterior inclusion probability (PIP)
plot. PIP is the probability that a variable is used as a splitting
variable, and can be interpreted as the importance of a variable. The
<code>inclusion_plot()</code> function is a wrapper for the <code>bar_chart()</code> function
from the <a href="https://cran.r-project.org/package=ggcharts">ggcharts</a> package
<span class="citation" data-cites="ggcharts">(<a href="#ref-ggcharts" role="doc-biblioref">Neitmann et al. 2020</a>)</span>, allowing the use of its arguments to customize the plot.
The recommended arguments to use are <code>top_n</code> and <code>threshold</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(separate_fit, <span class="at">method =</span> <span class="st">&quot;pip&quot;</span>, <span class="at">top_n =</span> <span class="dv">10</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(separate_fit, <span class="at">method =</span> <span class="st">&quot;pip&quot;</span>, <span class="at">threshold =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<figure id="fig:pip">
<table>
<caption>
</caption>
<tbody>
<tr>
<td style="text-align: center;">
<img src="fig/PIP_top_n.png"
style="width:100.0%" alt="graphic without alt text" />
</td>
<td style="text-align: center;">
<img src="fig/PIP_threshold.png"
style="width:100.0%" alt="graphic without alt text" />
</td>
</tr>
<tr>
<td style="text-align: center;">
<ol type="a">
<li>Plotting PIP with <code>top_n</code>
argument
</td>
<td style="text-align: center;">
<ol start="2" type="a">
<li>Plotting PIP with
<code>threshold</code> argument
</td>
</tr>
</tbody>
</table>
<figcaption>
Figure 4: Posterior inclusion probability (PIP)
plots
</figcaption>
</figure></li>
</ol></li>
</ol>
<p>In Figure <a href="#fig:pip" data-reference-type="ref" data-reference="fig:pip">4</a>, the
argument <code>top_n</code> allows us to select variables with the top <code>top_n</code>
highest PIPs. The argument <code>threshold</code> displays variables with PIP
greater than <code>threshold</code>. From a decision-theoretical perspective
<span class="citation" data-cites="barbieri2004optimal linero2018bayesian">(<a href="#ref-barbieri2004optimal" role="doc-biblioref">Barbieri and Berger 2004</a>; <a href="#ref-linero2018bayesian" role="doc-biblioref">Linero 2018</a>)</span>, variables with PIPs larger
than 0.5 can be considered chosen confounders. It is worth noting that
the five true confounders <span class="math inline">\(X_1-X_5\)</span> are all correctly selected as true
confounders with PIPs of 1, along with one extra predictor <span class="math inline">\(X_7\)</span> in the
outcome model.</p>
<p>The second option for visualization is the traceplot, which is mainly
used to check MCMC convergence. The function provides a traceplot of the
sample average treatment effect (SATE) for each MCMC chain. Traceplots
of other parameters such as <code>dir_alpha</code> (the hyperparameter <span class="math inline">\(\alpha\)</span> in
the sparsity-inducing Dirichlet prior
<span class="math inline">\(\mathcal{D}(\alpha/P, \cdots, \alpha/P)\)</span>) and <code>sigma2_out</code> (the
variance parameter in the outcome model) are also available by using the
argument <code>parameter</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(separate_fit, <span class="at">method =</span> <span class="st">&#39;trace&#39;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(separate_fit, <span class="at">method =</span> <span class="st">&#39;trace&#39;</span>, <span class="at">parameter =</span> <span class="st">&#39;dir_alpha&#39;</span>)</span></code></pre></div>
<p>In Figure <a href="#fig:traceplot" data-reference-type="ref" data-reference="fig:traceplot">5</a>, the traceplots of the SATE and <code>dir_alpha</code>
parameters are shown for four different MCMC chains. Concerning the
<code>dir_alpha</code> parameter (<span class="math inline">\(\alpha\)</span>), the actual value employed as the
hyper-parameter for the Dirichlet prior is derived by dividing the total
number of potential confounders, denoted as <span class="math inline">\(P\)</span> (i.e., <span class="math inline">\(\alpha /P\)</span>). In
the setting of simulation data where <span class="math inline">\(P=100\)</span> is utilized, the
hyper-parameter to be estimated is notably small, represented as
<span class="math inline">\(\alpha /100\)</span>. Hence, compared to the variability observed in the
traceplot, the variability of the actual <span class="math inline">\(\alpha /P\)</span> (illustrated within
the range of 0.5/100 to 4.5/100 in Figure
<a href="#fig:traceplot" data-reference-type="ref" data-reference="fig:traceplot">5</a>.(b))
can be interpreted as substantially smaller. Alternatively, extending
the chain length for sampling the <span class="math inline">\(\alpha\)</span> parameter could be
considered. However, in this dataset, due to the significant presence of
confounders (i.e., the counts of splits <span class="math inline">\(n_{j,1}, n_{j,21}, n_{j,20}\)</span>
added to <span class="math inline">\(\alpha/P\)</span> during the conjugate update are quite large),
confounder selection is minimally influenced by the current <span class="math inline">\(\alpha\)</span>
samples.</p>
<p>Although traceplots offer a convenient means of visual inspection, it is
recommended to employ the Gelman-Rubin diagnostics provided by the
<code>gelman.diag()</code> function in the
<a href="https://cran.r-project.org/package=coda">coda</a> package <span class="citation" data-cites="RCODA coda">(<a href="#ref-coda" role="doc-biblioref">Plummer et al. 2006</a>, <a href="#ref-RCODA" role="doc-biblioref">2020</a>)</span> for a
comprehensive convergence assessment, as illustrated in the subsequent
section. Furthermore, despite the suggestion of a modified <span class="math inline">\(\hat{R}\)</span>
<span class="citation" data-cites="vehtari2021">(<a href="#ref-vehtari2021" role="doc-biblioref">Vehtari et al. 2021</a>)</span> as an alternative to the Gelman-Rubin diagnostic, it is
presently unsupported in the
<a href="https://cran.r-project.org/package=coda">coda</a> package. Nonetheless,
once the <code>mcmc.list</code> object is generated (explained later in this
section), it can be directly employed if a function for computing the
modified <span class="math inline">\(\hat{R}\)</span> becomes available within the coda package in the
future.</p>
<figure id="fig:traceplot">
<table>
<caption>
</caption>
<tbody>
<tr>
<td style="text-align: center;">
<img src="fig/traceplot_ATE.png"
style="width:100.0%" alt="graphic without alt text" />
</td>
<td style="text-align: center;">
<img src="fig/traceplot_alpha.png"
style="width:100.0%" alt="graphic without alt text" />
</td>
</tr>
<tr>
<td style="text-align: center;">
<ol type="a">
<li>Traceplot of <span class="math inline"><em>S</em><em>A</em><em>T</em><em>E</em></span>
</td>
<td style="text-align: center;">
<ol start="2" type="a">
<li>Traceplot of <code>dir-alpha</code>
parameter
</td>
</tr>
</tbody>
</table>
<figcaption>
Figure 5: Traceplots for multiple MCMC chains
</figcaption>
</figure></li>
</ol></li>
</ol>
<p>We evaluated the performance of
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> in comparison to
other models, including those generated by the
<a href="https://CRAN.R-project.org/package=bacr">bacr</a> R package
<span class="citation" data-cites="wang2015accounting">(<a href="#ref-wang2015accounting" role="doc-biblioref">Wang et al. 2015</a>)</span> that inspired our model development. The
<a href="https://CRAN.R-project.org/package=bacr">bacr</a> package is easily
installed via CRAN and loaded into the current R session as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;bacr&quot;</span>, <span class="at">dependencies=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;bacr&quot;</span>)</span></code></pre></div>
<p>To fit the model of this package, we used the <code>bac()</code> function where the
input data needs to be provided in the form of a data frame. To fit the
exposure and outcome models in this case, a generalized linear model is
used, and it is necessary to specify the family of the model based on
the data type (e.g.. <code>familyX="binomial"</code> and <code>familyY="gaussian"</code>). The
MCMC algorithm was run for 10000 iterations after discarding the first
10000 iterations as burn-ins. Additionally, no interaction between the
exposure and each confounder was assumed.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Y,Trt,X))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>fit.bac <span class="ot">&lt;-</span> <span class="fu">bac</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> Z, <span class="at">exposure =</span> <span class="st">&quot;Trt&quot;</span>, <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">confounders =</span> <span class="fu">paste</span>(<span class="st">&quot;V&quot;</span>, <span class="dv">3</span><span class="sc">:</span>(P <span class="sc">+</span> <span class="dv">2</span>), <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">interactors =</span> <span class="cn">NULL</span>, <span class="at">familyX =</span> <span class="st">&quot;binomial&quot;</span>, <span class="at">familyY =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">omega =</span> <span class="cn">Inf</span>, <span class="at">num_its =</span> <span class="dv">20000</span>, <span class="at">burnM =</span> <span class="dv">10000</span>, <span class="at">burnB =</span> <span class="dv">10000</span>, <span class="at">thin =</span> <span class="dv">5</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>   )</span></code></pre></div>
<p>The result can be checked through the <code>summary()</code> function as follows:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.bac)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>BAC objects<span class="sc">:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>Exposure effect estimate<span class="sc">:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        posterior mean     <span class="dv">95</span>% posterior interval</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">-</span><span class="fl">1.6</span>               (<span class="sc">-</span><span class="fl">2.1</span>, <span class="sc">-</span><span class="fl">1.3</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>Covariates with posterior inclusion probability <span class="sc">&gt;</span> <span class="fl">0.5</span><span class="sc">:</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    posterior inclusion probability</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>V3                          <span class="fl">1.00000</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>V4                          <span class="fl">1.00000</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>V5                          <span class="fl">1.00000</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>V6                          <span class="fl">1.00000</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>V7                          <span class="fl">1.00000</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>V99                         <span class="fl">0.92100</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>V14                         <span class="fl">0.70305</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>V54                         <span class="fl">0.67480</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>V90                         <span class="fl">0.62345</span></span></code></pre></div>
<p>The posterior mean of the SATE was estimated to be <span class="math inline">\(-1.6\)</span>, which was
significantly different from the true SATE value of <span class="math inline">\(-2.55\)</span>. Moreover,
the 95% credible interval <span class="math inline">\((-2.1, -1.3)\)</span> did not include the true value.
When considering the importance of selected confounders based on the
posterior inclusion probability,
<a href="https://CRAN.R-project.org/package=bacr">bacr</a> included all important
confounders <span class="math inline">\(X_1-X_5\)</span> (that is, <span class="math inline">\(V3-V7\)</span> in the summary), but also added
<span class="math inline">\(X_{12}, X_{52}, X_{88}, \text {and } X_{97}\)</span> (that is,
<span class="math inline">\(V14, V54, V90, V99\)</span> in the summary) with high PIPs, which were not true
confounders. Notably, <span class="math inline">\(X_6\)</span> and <span class="math inline">\(X_7\)</span>, which are additional predictors
of the outcome model, were not included. This result may be attributed
to the fact that <a href="https://CRAN.R-project.org/package=bacr">bacr</a> relies
on a parametric model and therefore may struggle to account for the
non-linear and complex data structure.</p>
<h4 class="unnumbered" data-number="3.1" id="connection-to-coda-package">Connection to coda package</h4>
<p>To summarize the results, generic functions such as <code>summary()</code> and
<code>plot()</code> were adapted to work on the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> objects.
Additionally, <code>mcmc.list</code> objects were included as components in the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> object to allow for
the use of functions from the
<a href="https://cran.r-project.org/package=coda">coda</a> R package <span class="citation" data-cites="RCODA coda">(<a href="#ref-coda" role="doc-biblioref">Plummer et al. 2006</a>, <a href="#ref-RCODA" role="doc-biblioref">2020</a>)</span>. The
<code>mcmc_list</code> component of the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> object can produce
summary statistics for each of <span class="math inline">\(E[Y(1)], E[Y(0)], SATE\)</span> using the
summary function and generate trace plots and posterior densities for
parameters using the plot function. Figure
<a href="#fig:mcmc_list" data-reference-type="ref" data-reference="fig:mcmc_list">6</a>
displays plot of <code>mcmc_list</code> based on
<a href="https://cran.r-project.org/package=coda">coda</a> package.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(separate_fit<span class="sc">$</span>mcmc_list)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>Iterations <span class="ot">=</span> <span class="dv">10005</span><span class="sc">:</span><span class="dv">20000</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>Thinning interval <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>Number of chains <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>Sample size per chain <span class="ot">=</span> <span class="dv">2000</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> Empirical mean and standard deviation <span class="cf">for</span> each variable,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>   plus standard error of the mean<span class="sc">:</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                 Mean        SD  Naive SE Time<span class="sc">-</span>series SE</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>SATE        <span class="sc">-</span><span class="fl">2.285155</span> <span class="fl">0.1639173</span> <span class="fl">1.833e-03</span>      <span class="fl">2.489e-03</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>Y1           <span class="fl">0.719562</span> <span class="fl">0.1328857</span> <span class="fl">1.486e-03</span>      <span class="fl">2.122e-03</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>Y0           <span class="fl">3.004717</span> <span class="fl">0.0977850</span> <span class="fl">1.093e-03</span>      <span class="fl">1.790e-03</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>dir_alpha    <span class="fl">1.576421</span> <span class="fl">0.7317213</span> <span class="fl">8.181e-03</span>      <span class="fl">6.836e-02</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>sigma2_out1  <span class="fl">0.001731</span> <span class="fl">0.0003359</span> <span class="fl">3.756e-06</span>      <span class="fl">5.533e-06</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>sigma2_out0  <span class="fl">0.001310</span> <span class="fl">0.0002334</span> <span class="fl">2.609e-06</span>      <span class="fl">3.784e-06</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> Quantiles <span class="cf">for</span> each variable<span class="sc">:</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">2.5</span><span class="sc">%       25%</span>       <span class="dv">50</span><span class="sc">%       75%</span>     <span class="fl">97.5</span>%</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>SATE        <span class="sc">-</span><span class="fl">2.6022894</span> <span class="sc">-</span><span class="fl">2.396508</span> <span class="sc">-</span><span class="fl">2.284276</span> <span class="sc">-</span><span class="fl">2.174820</span> <span class="sc">-</span><span class="fl">1.969213</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>Y1           <span class="fl">0.4663024</span>  <span class="fl">0.629285</span>  <span class="fl">0.718583</span>  <span class="fl">0.808712</span>  <span class="fl">0.983369</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>Y0           <span class="fl">2.8116436</span>  <span class="fl">2.940446</span>  <span class="fl">3.005341</span>  <span class="fl">3.071342</span>  <span class="fl">3.194602</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>dir_alpha    <span class="fl">0.5772667</span>  <span class="fl">1.024000</span>  <span class="fl">1.423480</span>  <span class="fl">2.003651</span>  <span class="fl">3.390765</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>sigma2_out1  <span class="fl">0.0011718</span>  <span class="fl">0.001490</span>  <span class="fl">0.001698</span>  <span class="fl">0.001935</span>  <span class="fl">0.002483</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>sigma2_out0  <span class="fl">0.0009263</span>  <span class="fl">0.001146</span>  <span class="fl">0.001289</span>  <span class="fl">0.001446</span>  <span class="fl">0.001845</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(separate_fit<span class="sc">$</span>mcmc_list)</span></code></pre></div>
<figure id="fig:mcmc_list">
<img src="fig/sep_mcmc_list.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 6: Plot of <code>mcmc-list</code> using the <strong>coda</strong> R
package</figcaption>
</figure>
<p>The convergence of the MCMC can be assessed by utilizing the convergence
diagnostics offered by the
<a href="https://cran.r-project.org/package=coda">coda</a> package. To examine the
convergence of six parameters, we can employ the <code>gelman.diag()</code>
function on the <code>mcmc.list</code> object, specifically on
<code>separate_fit$mcmc_list</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;coda&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(separate_fit<span class="sc">$</span>mcmc_list)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>Potential scale reduction factors<span class="sc">:</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            Point est. Upper C.I.</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>ATE               <span class="fl">1.00</span>       <span class="fl">1.00</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>Y1                <span class="fl">1.00</span>       <span class="fl">1.00</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>Y0                <span class="fl">1.00</span>       <span class="fl">1.01</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>dir_alpha         <span class="fl">1.02</span>       <span class="fl">1.07</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>sigma2_out1       <span class="fl">1.00</span>       <span class="fl">1.00</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>sigma2_out0       <span class="fl">1.00</span>       <span class="fl">1.00</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>Multivariate psrf</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fl">1.02</span></span></code></pre></div>
<p>Based on the convergence diagnostics, it can be concluded that there are
no issues with the convergence of the MCMC, similar to the visual
inspection.</p>
<h3 data-number="4" id="sec:real_data"><span class="header-section-number">4</span> Real data example</h3>
<p>In the previous section, the <code>separate_bart()</code> function was used to
demonstrate a separate outcome model strategy. In this section, a single
outcome model is tested using the <code>single_bart()</code> function, based on the
Infant Health and Development Program (IHDP) dataset as an example. This
dataset was collected from a longitudinal study that tracked the
development of low-birth-weight premature infants. The study
participants in the treatment group received intensive care and home
visits from trained providers and their cognitive test scores were
evaluated at the end of the intervention period. The dataset includes a
variety of pretreatment variables, including 6 continuous and 19 binary
covariates. The original IHDP data is generated from a randomized
experiment setting. However, the IHDP data used by <span class="citation" data-cites="bartcause">(<a href="#ref-bartcause" role="doc-biblioref">Hill 2011</a>)</span> and
<span class="citation" data-cites="louizos:2017">(<a href="#ref-louizos:2017" role="doc-biblioref">Louizos et al. 2017</a>)</span> was manipulated to induce covariate imbalance between
treatment groups by removing a subset of the treated group.
Specifically, all children with nonwhite mothers were removed from the
treated group. We utilize a synthesized variant of the IHDP data as
presented in <span class="citation" data-cites="louizos:2017">(<a href="#ref-louizos:2017" role="doc-biblioref">Louizos et al. 2017</a>)</span>. This version was created employing the
<a href="https://github.com/vdorie/npci">NPCI</a> package <span class="citation" data-cites="npci">(<a href="#ref-npci" role="doc-biblioref">Dorie 2016</a>)</span> to ascertain the
true counterfactual values. As seen in Figure
<a href="#fig:ioverlap" data-reference-type="ref" data-reference="fig:ioverlap">7</a>, the
data generated in this manner significantly violates the overlap
assumption for estimating the sample average treatment effect (SATE).
This figure depicts the degree of overlap between two groups (Treated vs
Control) for selected covariates. Red crosses represent the control
group, and blue triangles represent the treated group. In certain
intervals of extreme values for each covariate, there are regions where
only control group data exists, or very few data points from the treated
group are present. For example, in the interval where the <span class="math inline">\(X_5\)</span>
covariate is less than <span class="math inline">\(-4\)</span>, there is no data from the treated group.
Non-overlap occurs in these regions. In the case of the binary covariate
<span class="math inline">\(X_{18}\)</span>, there is only one data point from the treated group at the
value of 0. Therefore, technically speaking, situations like non-overlap
can occur in the estimation process. In such a scenario, one of the
objectives is to investigate whether a single outcome model can properly
estimate the true SATE.</p>
<p>The IHDP data can be loaded by</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ihdp&quot;</span>, <span class="at">package =</span> <span class="st">&quot;bartcs&quot;</span>)</span></code></pre></div>
<p>and Table <a href="#tab:T2" data-reference-type="ref" data-reference="tab:iphd">2</a>
displays the summary statistics of the variables. In the dataset,
<code>y_factual</code> is the observed outcome <span class="math inline">\(Y\)</span> (i.e., <span class="math inline">\(Y(A)\)</span>) and <code>y_cfactual</code>
is the counterfactual outcome <span class="math inline">\(Y\)</span> (i.e., <span class="math inline">\(Y(1-A)\)</span>).</p>
<div id="tab:iphd">
<table style="width:98%;">
<caption><span id="tab:T2">Table 2: </span> Summary statistics for the IHDP data set. <span class="math inline">\(\star\)</span>
denotes a continuous potential confounder.</caption>
<colgroup>
<col style="width: 18%" />
<col style="width: 24%" />
<col style="width: 16%" />
<col style="width: 24%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Treatment = 1 (n=139)</th>
<th></th>
<th style="text-align: center;">Treatment = 0 (n=608)</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Variable</td>
<td style="text-align: center;">Mean</td>
<td>IQR</td>
<td style="text-align: center;">Mean</td>
<td>IQR</td>
</tr>
<tr class="even">
<td><span class="math inline">\(Y\)</span></td>
<td style="text-align: center;">6.43</td>
<td>(5.83, 7.34)</td>
<td style="text-align: center;">2.41</td>
<td>(1.45, 3.08)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X^{\star}_{1}\)</span></td>
<td style="text-align: center;">0.21</td>
<td>(-0.40, 0.95)</td>
<td style="text-align: center;">-0.05</td>
<td>(-0.75, 0.79)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X^{\star}_{2}\)</span></td>
<td style="text-align: center;">0.18</td>
<td>(-0.20, 0.60)</td>
<td style="text-align: center;">-0.04</td>
<td>(-0.60, 0.60)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X^{\star}_{3}\)</span></td>
<td style="text-align: center;">-0.04</td>
<td>(-0.73, 0.38)</td>
<td style="text-align: center;">0.01</td>
<td>(-0.73, 0.76)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X^{\star}_{4}\)</span></td>
<td style="text-align: center;">-0.22</td>
<td>(-0.88, 0.16)</td>
<td style="text-align: center;">0.05</td>
<td>(-0.88, 0.16)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X^{\star}_{5}\)</span></td>
<td style="text-align: center;">-0.14</td>
<td>(-0.69, 0.56)</td>
<td style="text-align: center;">0.03</td>
<td>(-0.50, 0.68)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X^{\star}_{6}\)</span></td>
<td style="text-align: center;">0.21</td>
<td>(-0.53, 0.96)</td>
<td style="text-align: center;">-0.05</td>
<td>(-0.86, 0.63)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_{7}\)</span></td>
<td style="text-align: center;">0.52</td>
<td>(0.00, 1.00)</td>
<td style="text-align: center;">0.51</td>
<td>(0.00, 1.00)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_{8}\)</span></td>
<td style="text-align: center;">0.09</td>
<td>(0.00, 0.00)</td>
<td style="text-align: center;">0.1</td>
<td>(0.00, 0.00)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_{9}\)</span></td>
<td style="text-align: center;">0.68</td>
<td>(0.00, 1.00)</td>
<td style="text-align: center;">0.49</td>
<td>(0.00, 1.00)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_{10}\)</span></td>
<td style="text-align: center;">0.29</td>
<td>(0.00, 1.00)</td>
<td style="text-align: center;">0.38</td>
<td>(0.00, 1.00)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_{11}\)</span></td>
<td style="text-align: center;">0.25</td>
<td>(0.00, 0.50)</td>
<td style="text-align: center;">0.27</td>
<td>(0.00, 1.00)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_{12}\)</span></td>
<td style="text-align: center;">0.22</td>
<td>(0.00, 0.00)</td>
<td style="text-align: center;">0.22</td>
<td>(0.00, 0.00)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_{13}\)</span></td>
<td style="text-align: center;">0.38</td>
<td>(0.00, 1.00)</td>
<td style="text-align: center;">0.35</td>
<td>(0.00, 1.00)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_{14}\)</span></td>
<td style="text-align: center;">1.58</td>
<td>(1.00, 2.00)</td>
<td style="text-align: center;">1.44</td>
<td>(1.00, 2.00)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_{15}\)</span></td>
<td style="text-align: center;">0.14</td>
<td>(0.00, 0.00)</td>
<td style="text-align: center;">0.14</td>
<td>(0.00, 0.00)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_{16}\)</span></td>
<td style="text-align: center;">0.94</td>
<td>(1.00, 1.00)</td>
<td style="text-align: center;">0.97</td>
<td>(1.00, 1.00)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_{17}\)</span></td>
<td style="text-align: center;">0.69</td>
<td>(0.00, 1.00)</td>
<td style="text-align: center;">0.57</td>
<td>(0.00, 1.00)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_{18}\)</span></td>
<td style="text-align: center;">0.99</td>
<td>(1.00, 1.00)</td>
<td style="text-align: center;">0.96</td>
<td>(1.00, 1.00)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_{19}\)</span></td>
<td style="text-align: center;">0.15</td>
<td>(0.00, 0.00)</td>
<td style="text-align: center;">0.13</td>
<td>(0.00, 0.00)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_{20}\)</span></td>
<td style="text-align: center;">0.06</td>
<td>(0.00, 0.00)</td>
<td style="text-align: center;">0.15</td>
<td>(0.00, 0.00)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_{21}\)</span></td>
<td style="text-align: center;">0.17</td>
<td>(0.00, 0.00)</td>
<td style="text-align: center;">0.15</td>
<td>(0.00, 0.00)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_{22}\)</span></td>
<td style="text-align: center;">0.04</td>
<td>(0.00, 0.00)</td>
<td style="text-align: center;">0.09</td>
<td>(0.00, 0.00)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_{23}\)</span></td>
<td style="text-align: center;">0.01</td>
<td>(0.00, 0.00)</td>
<td style="text-align: center;">0.09</td>
<td>(0.00, 0.00)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X_{24}\)</span></td>
<td style="text-align: center;">0.06</td>
<td>(0.00, 0.00)</td>
<td style="text-align: center;">0.14</td>
<td>(0.00, 0.00)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X_{25}\)</span></td>
<td style="text-align: center;">0.27</td>
<td>(0.00, 1.00)</td>
<td style="text-align: center;">0.13</td>
<td>(0.00, 0.00)</td>
</tr>
</tbody>
</table>
</div>
<figure id="fig:ioverlap">
<img src="fig/overlap.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 7: A plot illustrating the degree of overlap between two groups
(Treated vs Control) for selected covariates. Red crosses represent the
control group, and blue triangles represent the treated group. In
certain intervals for each covariate, there are regions where only
control group data exists, or very few data points from the treated
group are present. Non-overlap occurs in these
regions.</figcaption>
</figure>
<p>We fit the single outcome model using the <code>single_bart()</code> function.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>single_fit <span class="ot">&lt;-</span> <span class="fu">single_bart</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y               =</span> ihdp<span class="sc">$</span>y_factual,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt             =</span> ihdp<span class="sc">$</span>treatment,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">X               =</span> ihdp[, <span class="dv">6</span><span class="sc">:</span><span class="dv">30</span>],</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_tree        =</span> <span class="dv">50</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_chain       =</span> <span class="dv">4</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_post_sample =</span> <span class="dv">2000</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_thin        =</span> <span class="dv">5</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_burn_in     =</span> <span class="dv">10000</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>single_fit</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">single_bart()</span><span class="st">`</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>         mean     <span class="fl">2.5</span><span class="sc">%    97.5%</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>SATE <span class="fl">3.964842</span> <span class="fl">3.747028</span> <span class="fl">4.180764</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>Y1   <span class="fl">6.382810</span> <span class="fl">6.188199</span> <span class="fl">6.581852</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>Y0   <span class="fl">2.417969</span> <span class="fl">2.338264</span> <span class="fl">2.496962</span></span></code></pre></div>
<p>The function <code>single_bart()</code> returns a
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> object, which
displays the posterior means and 95% credible intervals for the sample
average treatment effect (SATE), and the potential outcomes <span class="math inline">\(Y(1)\)</span> and
<span class="math inline">\(Y(0)\)</span>. The <code>summary()</code> and <code>plot()</code> functions can also be used with
this <a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> object
generated by <code>single_bart()</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(single_fit)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">single_bart()</span><span class="st">`</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>Treatment Value</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  Treated group    <span class="sc">:</span>      <span class="dv">1</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  Control group    <span class="sc">:</span>      <span class="dv">0</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>Tree Parameters</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  Number of Tree   <span class="sc">:</span>     <span class="dv">50</span>     Value  of alpha    <span class="sc">:</span>   <span class="fl">0.95</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  Prob.  of Grow   <span class="sc">:</span>   <span class="fl">0.28</span>     Value  of beta     <span class="sc">:</span>      <span class="dv">2</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  Prob.  of Prune  <span class="sc">:</span>   <span class="fl">0.28</span>     Value  of nu       <span class="sc">:</span>      <span class="dv">3</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  Prob.  of Change <span class="sc">:</span>   <span class="fl">0.44</span>     Value  of q        <span class="sc">:</span>   <span class="fl">0.95</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>Chain Parameters</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  Number of Chains <span class="sc">:</span>      <span class="dv">4</span>     Number of burn<span class="sc">-</span><span class="cf">in</span>  <span class="sc">:</span>  <span class="dv">10000</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  Number of Iter   <span class="sc">:</span>  <span class="dv">20000</span>     Number of thinning <span class="sc">:</span>      <span class="dv">5</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  Number of Sample <span class="sc">:</span>   <span class="dv">2000</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>Outcome</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a> estimand chain     <span class="fl">2.5</span><span class="sc">%       1Q     mean   median       3Q    97.5%</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>      SATE    <span class="dv">1</span> <span class="fl">3.758373</span> <span class="fl">3.894465</span> <span class="fl">3.969119</span> <span class="fl">3.968867</span> <span class="fl">4.042380</span> <span class="fl">4.183131</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>      SATE    <span class="dv">2</span> <span class="fl">3.744731</span> <span class="fl">3.886575</span> <span class="fl">3.957434</span> <span class="fl">3.956101</span> <span class="fl">4.026455</span> <span class="fl">4.165961</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>      SATE    <span class="dv">3</span> <span class="fl">3.760480</span> <span class="fl">3.905973</span> <span class="fl">3.980315</span> <span class="fl">3.980162</span> <span class="fl">4.054086</span> <span class="fl">4.206488</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>      SATE    <span class="dv">4</span> <span class="fl">3.730287</span> <span class="fl">3.879606</span> <span class="fl">3.952498</span> <span class="fl">3.953050</span> <span class="fl">4.028315</span> <span class="fl">4.158430</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>      SATE  agg <span class="fl">3.747028</span> <span class="fl">3.891543</span> <span class="fl">3.964842</span> <span class="fl">3.965384</span> <span class="fl">4.038288</span> <span class="fl">4.180764</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">1</span> <span class="fl">6.196530</span> <span class="fl">6.318675</span> <span class="fl">6.387760</span> <span class="fl">6.387443</span> <span class="fl">6.453303</span> <span class="fl">6.589611</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">2</span> <span class="fl">6.181788</span> <span class="fl">6.310026</span> <span class="fl">6.376027</span> <span class="fl">6.376233</span> <span class="fl">6.439727</span> <span class="fl">6.573960</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">3</span> <span class="fl">6.196317</span> <span class="fl">6.329945</span> <span class="fl">6.396885</span> <span class="fl">6.397153</span> <span class="fl">6.464297</span> <span class="fl">6.601299</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">4</span> <span class="fl">6.169429</span> <span class="fl">6.303404</span> <span class="fl">6.370570</span> <span class="fl">6.371514</span> <span class="fl">6.435679</span> <span class="fl">6.562172</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>       Y1   agg <span class="fl">6.188199</span> <span class="fl">6.314489</span> <span class="fl">6.382810</span> <span class="fl">6.382215</span> <span class="fl">6.449542</span> <span class="fl">6.581852</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">1</span> <span class="fl">2.339020</span> <span class="fl">2.391137</span> <span class="fl">2.418640</span> <span class="fl">2.418824</span> <span class="fl">2.446414</span> <span class="fl">2.498677</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">2</span> <span class="fl">2.336131</span> <span class="fl">2.392407</span> <span class="fl">2.418593</span> <span class="fl">2.418124</span> <span class="fl">2.446167</span> <span class="fl">2.495229</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">3</span> <span class="fl">2.337997</span> <span class="fl">2.388738</span> <span class="fl">2.416570</span> <span class="fl">2.416414</span> <span class="fl">2.444457</span> <span class="fl">2.495583</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">4</span> <span class="fl">2.340288</span> <span class="fl">2.389536</span> <span class="fl">2.418073</span> <span class="fl">2.418218</span> <span class="fl">2.446018</span> <span class="fl">2.497264</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>       Y0   agg <span class="fl">2.338264</span> <span class="fl">2.390199</span> <span class="fl">2.417969</span> <span class="fl">2.418042</span> <span class="fl">2.445718</span> <span class="fl">2.496962</span></span></code></pre></div>
<p>We also fitted separate outcome models to the <code>ihdp</code> data and compared
the results from the single outcome model.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>separate_fit <span class="ot">&lt;-</span> <span class="fu">separate_bart</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">Y               =</span> ihdp<span class="sc">$</span>y_factual,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">trt             =</span> ihdp<span class="sc">$</span>treatment,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">X               =</span> ihdp[, <span class="dv">6</span><span class="sc">:</span><span class="dv">30</span>],</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">num_tree        =</span> <span class="dv">50</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">num_chain       =</span> <span class="dv">4</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">num_post_sample =</span> <span class="dv">2000</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">num_thin        =</span> <span class="dv">5</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">num_burn_in     =</span> <span class="dv">10000</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>separate_fit</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">separate_bart()</span><span class="st">`</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>         mean     <span class="fl">2.5</span><span class="sc">%    97.5%</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>SATE <span class="fl">3.924013</span> <span class="fl">3.702316</span> <span class="fl">4.148937</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>Y1   <span class="fl">6.342504</span> <span class="fl">6.134043</span> <span class="fl">6.550242</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>Y0   <span class="fl">2.418491</span> <span class="fl">2.340920</span> <span class="fl">2.497081</span></span></code></pre></div>
<p>Similar to the separate outcome models strategy, in <code>single_bart()</code>, the
<code>plot()</code> function for the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> object can also be
employed to check the convergence of the MCMC chain. The traceplots for
the ATE is presented in Figure <a href="#fig:ihdp_trace" data-reference-type="ref" data-reference="fig:ihdp_trace">8</a> with the following line.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(single_fit, <span class="at">method =</span> <span class="st">&#39;trace&#39;</span>)</span></code></pre></div>
<figure id="fig:ihdp_trace">
<img src="fig/ihdp_trace_ATE.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 8: Traceplot of SATE for IHDP
dataset</figcaption>
</figure>
<p>As this is a simulated version of the IHDP data, the true values are
known and are 4.02 for the sample average treatment effect (SATE), 6.45
for <span class="math inline">\(E[Y(1)]\)</span>, and 2.43 for <span class="math inline">\(E[Y(0)]\)</span>. The outputs from the two models
accurately reflect these true values within their 95% credible
intervals. Additionally, the PIP plots (Figure
<a href="#fig:ihdp_pip" data-reference-type="ref" data-reference="fig:ihdp_pip">9</a>)
depict chosen confounders with PIP values larger than 0.5.</p>
<p>The important aspect here is that in the case of the single outcome
model, the exposure variable (<code>trt</code>) is also incorporated into the
selection process. As indicated in Equation <a href="#eq:2">(2)</a>, because the
exposure variable is included as one of the covariates in the outcome
model, it is subject to variable selection. This means that in the
computation of PIP, it is treated similarly to other confounders,
producing the following plot (a) in Figure
<a href="#fig:ihdp_pip" data-reference-type="ref" data-reference="fig:ihdp_pip">9</a>. In
Figure <a href="#fig:ihdp_pip" data-reference-type="ref" data-reference="fig:ihdp_pip">9</a>, plot (a) displays the potential confounders
for the single outcome model, which have a posterior inclusion
probability of 0.5 or more, while plot (b) illustrates the confounders
with a posterior inclusion probability of 0.5 or more when the separate
outcome models strategy is used. It is noteworthy that <span class="math inline">\(X_4\)</span>, <span class="math inline">\(X_6\)</span>, and
<span class="math inline">\(X_{15}\)</span> were consistently chosen as confounders with posterior
inclusion probability 1.</p>
<figure id="fig:ihdp_pip">
<table>
<caption>
</caption>
<tbody>
<tr>
<td style="text-align: center;">
<img
src="fig/ihdp_PIP_threshold_single.png" style="width:100.0%"
alt="graphic without alt text" />
</td>
<td style="text-align: center;">
<img
src="fig/ihdp_PIP_threshold_separate.png" style="width:100.0%"
alt="graphic without alt text" />
</td>
</tr>
<tr>
<td style="text-align: center;">
<ol type="a">
<li><span>PIP plot of single
model</span>
</td>
<td style="text-align: center;">
<ol start="2" type="a">
<li><span>PIP plot of separate
model</span>
</td>
</tr>
</tbody>
</table>
<figcaption>
Figure 9: PIP plot for IHDP dataset
</figcaption>
</figure></li>
</ol></li>
</ol>
<h4 class="unnumbered" data-number="4.1" id="sec:speed">Computation speed</h4>
<p>In Figure <a href="#fig:speed" data-reference-type="ref" data-reference="fig:speed">10</a>,
the computational speed of two models, the separate and single models,
is depicted for two different settings of the number of trees (100 vs.
200) based on the scenario in Section 3. The speed was assessed using
5000 MCMC iterations across various combinations of <span class="math inline">\(N\)</span> and <span class="math inline">\(P\)</span>. We
considered three values of <span class="math inline">\(N\)</span> (100, 500, and 1000) and three values of
<span class="math inline">\(P\)</span> (circle for <span class="math inline">\(N\times 0.3\)</span>, triangle for <span class="math inline">\(N\times 0.5\)</span>, and cross for
<span class="math inline">\(N\times 1\)</span>).</p>
<p>For 100 BART trees, the separate models required 8 to 98 seconds (18 to
190 seconds for 200 BART trees) for computation, while the single model
took 7 to 86 seconds (14 to 168 seconds for 200 BART trees), depending
on the (<span class="math inline">\(N, P\)</span>) combination. Both models exhibited similar computational
speeds overall, considering the MCMC iterations. However, the single
model, which fits two BART models (exposure and one outcome model), was
found to be more efficient with slightly smaller biases and mean square
errors (MSEs) across various scenarios <span class="citation" data-cites="kim2023bnp">(<a href="#ref-kim2023bnp" role="doc-biblioref">Kim et al. 2023</a>)</span>. Therefore, it is
recommended to utilize the single model (<code>single_bart()</code> function),
especially when <span class="math inline">\(N\)</span> is large, due to its faster computational speed.</p>
<p>Additionally, depending on the number of trees used, a significant
improvement in computation speed can be observed. It is generally
suggested to start with 50 trees as a “good starting value,”
<span class="citation" data-cites="kapelner2013bartmachine">(<a href="#ref-kapelner2013bartmachine" role="doc-biblioref">Kapelner and Bleich 2016</a>)</span> so using a smaller number of trees is also
advised to gain computational advantages in terms of speed. The results
in this manuscript were obtained using R 4.3.0 on a Mac Studio with a M1
chip and 128 GB of memory.
<a href="https://cran.r-project.org/package=bartcs">bartcs</a> 1.2.2 and
<a href="https://cran.r-project.org/package=bacr">bacr</a> 1.0.1 were used for the
analysis.</p>
<figure id="fig:speed">
<table>
<caption>
</caption>
<tbody>
<tr>
<td style="text-align: center;">
<img src="fig/speed_trees100.png"
style="width:100.0%" alt="graphic without alt text" />
</td>
<td style="text-align: center;">
<img src="fig/speed_trees200.png"
style="width:100.0%" alt="graphic without alt text" />
</td>
</tr>
</tbody>
</table>
<figcaption>
Figure 10: The computation times for both the single outcome
model (red) and separate outcome models (black) based on the number of
observations (<span class="math inline"><em>N</em></span>) under two
different numbers of trees. A cross symbol (+) represents the scenario
where the number of potential confounders (<span class="math inline"><em>P</em></span>) is equal to the number of
observations (<span class="math inline"><em>N</em></span>), a triangle
(<span class="math inline">△</span>) represents the scenario where <span class="math inline"><em>P</em> = <em>N</em> × 0.5</span> and a circle
(<span class="math inline">○</span>) represents the scenario where <span class="math inline"><em>P</em> = <em>N</em> × 0.3</span>. These results
are obtained from 5000 MCMC iterations based on the scenario in Section
3.
</figcaption>
</figure>
<h3 data-number="5" id="sec:continuous"><span class="header-section-number">5</span> Continuous exposure example</h3>
<p>When it comes to a continuous exposure variable, the formula in
Equation <a href="#eq:1">(1)</a> is changed as follows:
<span class="math display" id="eq:4">\[\begin{aligned}
A_i &amp; = &amp;\mu_1 +  f_1(\boldsymbol{X}_i) + \epsilon_i, \quad \epsilon_j \sim N(0, \tau^2). \label{eq:4}\\
f_1(\boldsymbol{X}_i) &amp; = &amp;\sum_{t=1}^T g_1(\boldsymbol{X}_i ; \mathcal{T}_t, \mathcal{M}_t) \nonumber
\end{aligned}   \tag{4}\]</span>
This altered formula is used in conjunction with the single outcome
model to perform confounder selection. However, the separate outcome
models strategy, which fits two distinct outcome models based on the two
exposure levels, is not suitable for the continuous exposure variable.
The <code>single_bart()</code> function has the versatility to handle both binary
and continuous treatments, and automatically identifies the binary
treatment when there are only two unique values. To demonstrate this, we
generate a data set similar to the previous example.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>cov <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P) {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>     cov[[i]] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, cov)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(X[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(X[, <span class="dv">2</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>mu_trt <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">+</span> h1 <span class="sc">+</span> h2 <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">*</span> X[, <span class="dv">5</span>]</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>Trt <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, mu_trt, <span class="fl">0.3</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>mu_y <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">*</span> h1 <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> h2 <span class="sc">-</span> Trt <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">+</span> <span class="fu">exp</span>(<span class="fl">0.5</span> <span class="sc">*</span> X[, <span class="dv">5</span>]) <span class="sc">-</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.5</span> <span class="sc">*</span> Trt <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">6</span>]) <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> Trt <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">7</span>] <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, mu_y, <span class="fl">0.3</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>treatment <span class="ot">&lt;-</span> <span class="fu">quantile</span>(Trt, <span class="fl">0.75</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">quantile</span>(Trt, <span class="fl">0.25</span>)</span></code></pre></div>
<p>We use the function <code>single_bart()</code> to fit the generated data. The first
and third quantile values of <code>Trt</code> will serve as the basis for comparing
two different exposure levels. As arguments in <code>single_bart()</code>, we need
to provide these two pre-specified exposure levels (<span class="math inline">\(a=\)</span><code>trt_treated</code>
and <span class="math inline">\(a^\prime=\)</span><code>trt_control</code>). In the this case, the causal estimand is
<span class="math inline">\(\Delta(a, a^\prime) = E[(Y(a)-Y(a^\prime)]\)</span>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>single_fit <span class="ot">&lt;-</span> <span class="fu">single_bart</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> Y, <span class="at">trt =</span> Trt, <span class="at">X =</span> X,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">trt_treated =</span> treatment, <span class="at">trt_control =</span> control,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_tree =</span> <span class="dv">200</span>, <span class="at">num_chain =</span> <span class="dv">4</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_burn_in =</span> <span class="dv">10000</span>, <span class="at">num_thin =</span> <span class="dv">5</span>, <span class="at">num_post_sample =</span> <span class="dv">2000</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>single_fit</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">single_bart()</span><span class="st">`</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>           mean       <span class="fl">2.5</span><span class="sc">%     97.5%</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>SATE <span class="sc">-</span><span class="fl">2.8097339</span> <span class="sc">-</span><span class="fl">4.2581469</span> <span class="sc">-</span><span class="fl">1.732448</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>Y1    <span class="fl">0.9982417</span>  <span class="fl">0.2753606</span>  <span class="fl">1.677726</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>Y0    <span class="fl">3.8079756</span>  <span class="fl">3.0967180</span>  <span class="fl">4.740133</span></span></code></pre></div>
<p>Similar to other <a href="https://CRAN.R-project.org/package=bartcs">bartcs</a>
objects, the <code>summary()</code> and <code>plot()</code> functions can be applied to the
continuous exposure scenario. Figure
<a href="#fig:conti_pip" data-reference-type="ref" data-reference="fig:conti_pip">11</a>
displays a PIP plot, which demonstrates that out of 100 possible
confounders, all of the true confounders except <span class="math inline">\(X_1\)</span>, <span class="math inline">\(X_2\)</span>, and two
additional predictors were captured effectively, with high PIP values.</p>
<figure id="fig:conti_pip">
<table>
<caption>
</caption>
<tbody>
<tr>
<td style="text-align: center;">
<img src="fig/conti_PIP_top_n.png"
style="width:100.0%" alt="graphic without alt text" />
</td>
<td style="text-align: center;">
<img src="fig/conti_PIP_threshold.png"
style="width:100.0%" alt="graphic without alt text" />
</td>
</tr>
<tr>
<td style="text-align: center;">
<ol type="a">
<li><span>Plotting PIP with
<code>top_n</code> argument</span>
</td>
<td style="text-align: center;">
<ol start="2" type="a">
<li><span>Plotting PIP with
<code>threshold = 0.5</code> argument</span>
</td>
</tr>
</tbody>
</table>
<figcaption>
Figure 11: PIP plot for continuous exposure
</figcaption>
</figure></li>
</ol></li>
</ol>
<h3 data-number="6" id="sec:hetero"><span class="header-section-number">6</span> Heterogeneous effects</h3>
<p>The proposed method not only estimates the SATE but also provides
posterior samples of <span class="math inline">\(Y_i(1)\)</span> and <span class="math inline">\(Y_i(0)\)</span>, enabling inference on
individual heterogeneous treatment effects. The return object includes a
component called <code>chains</code>, which is a list containing the results from
each MCMC chain. Each element in this list is an <code>mcmc.list</code> object
(from the
<a href="https://cran.r-project.org/web/packages/coda/index.html">coda</a> package)
that holds the posterior samples of <span class="math inline">\(Y_i(1)\)</span> and <span class="math inline">\(Y_i(0)\)</span>. The following
explains how to extract posterior samples when applying the separate
model to the generated data from Section 3.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>separate_fit <span class="ot">&lt;-</span> <span class="fu">separate_bart</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y, <span class="at">trt =</span> Trt, <span class="at">X =</span> X, <span class="at">num_tree =</span> <span class="dv">200</span>, <span class="at">num_chain =</span> <span class="dv">4</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_burn_in =</span> <span class="dv">10000</span>, <span class="at">num_thin =</span> <span class="dv">5</span>, <span class="at">num_post_sample =</span> <span class="dv">2000</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Y(1) samples from the 1st MCMC chain</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>separate_fit<span class="sc">$</span>chains[[<span class="dv">1</span>]]<span class="sc">$</span>Y1_sample</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Y(0) samples from the 1st MCMC chain</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>separate_fit<span class="sc">$</span>chains[[<span class="dv">1</span>]]<span class="sc">$</span>Y0_sample</span></code></pre></div>
<p>The posterior means of <span class="math inline">\(Y_i(1)\)</span> and <span class="math inline">\(Y_i(0)\)</span> for <span class="math inline">\(i=1, \cdots, N\)</span> can be
obtained by aggregating the posterior samples across multiple chains, as
shown below:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Y1_sample <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, <span class="fu">lapply</span>(separate_fit<span class="sc">$</span>chains, <span class="cf">function</span>(x) x<span class="sc">$</span>Y1_sample))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rowMeans</span>(Y1_sample)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>Y0_sample <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, <span class="fu">lapply</span>(separate_fit<span class="sc">$</span>chains, <span class="cf">function</span>(x) x<span class="sc">$</span>Y0_sample))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rowMeans</span>(Y0_sample)</span></code></pre></div>
<h3 data-number="7" id="sec:summary"><span class="header-section-number">7</span> Summary and discussion</h3>
<p>In conclusion, the <a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> R
package is a powerful tool for causal inference using BART. It allows
users to adjust for confounders and estimate treatment effects using a
flexible non-parametric method. The package’s ability to handle
high-dimensional and non-linear confounding, binary exposure, and
continuous exposure makes it a versatile tool for a wide range of
applications. Additionally, the package’s support for parallel computing
and visualization of results make it a user-friendly and
easy-to-interpret tool. The
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> package is a
valuable resource for researchers in various fields.</p>
<p>In this paper, we assessed the performance of the proposed method in a
scenario where all true confounders are included in the potential
confounder pool, and additional predictors for the outcome model are
also present within the potential confounder pool. In this scenario, the
proposed method demonstrated precise average treatment effect (SATE)
estimation and accurately identified the true confounders. Moreover, in
the study by <span class="citation" data-cites="kim2023bnp">(<a href="#ref-kim2023bnp" role="doc-biblioref">Kim et al. 2023</a>)</span>, the proposed method exhibited accurate
confounder selection performance and reliable estimation of SATEs even
in scenarios involving instrumental variables in the data generating
process. This success is attributed to the satisfaction of the
disjunctive cause criterion without instruments by the proposed method,
as outlined in the introduction section <span class="citation" data-cites="vanderweele2019principles">(<a href="#ref-vanderweele2019principles" role="doc-biblioref">VanderWeele 2019</a>)</span>.
Additionally, the method demonstrated outstanding results in simulation
scenarios with diverse effect sizes and varying numbers of true
confounders.</p>
<p>The single outcome model and separate outcome models introduced in this
paper both demonstrate excellent performance in confounder selection and
average treatment effect estimation. However, in cases where a
continuous treatment variable is required, the single outcome model
should be applied. Additionally, as indicated in Section 4, the single
outcome model has a slightly faster computation speed than the separate
outcome models when the sample size is large because it uses one less
BART model. On the other hand, the separate outcome models strategy has
the advantage of relatively faster convergence of the MCMC chain during
the process of updating the selection probability vector of the BART
prior using a simple Gibbs update. Therefore, it is necessary to
selectively choose between the two models based on the context of the
data being applied.</p>
<p>While not currently integrated into the
<a href="https://CRAN.R-project.org/package=bartcs">bartcs</a> package, the
confounder selection method presented here using BART holds potential
for extension to various data types. For count or categorical outcomes,
it might be feasible to substitute the proposed outcome model with the
log-linear BART model suggested by <span class="citation" data-cites="murray2021log">(<a href="#ref-murray2021log" role="doc-biblioref">Murray 2021</a>)</span>. Similarly, for
survival outcomes, the survival BART model proposed by
<span class="citation" data-cites="sparapani2016nonparametric">(<a href="#ref-sparapani2016nonparametric" role="doc-biblioref">Sparapani et al. 2016</a>)</span> could serve as the outcome model.
Exploring the specific computation algorithms for these extensions could
be a fruitful avenue for future research.</p>
<p>One limitation of the proposed method is its lack of consideration for
correlation and temporal relationships among potential confounders.
Currently, no research has explored the distribution of weights in the
selection probability vector when high correlation exists among
covariates in the potential confounder pool. An approach worth
investigating may involve leveraging a causal Directed Acyclic Graph
(DAG) to constrain the selection of certain covariates in the prior
setting of the selection probability vector. This too presents a
promising direction for future research. Furthermore, our model
currently assumes a common hyper-prior for all hyperparameters
<span class="math inline">\(\boldsymbol{\alpha}\)</span> associated with the selection probability vector.
This approach restricts our ability to incorporate differing prior
weights across potential confounders. Exploring more flexible
specifications, such as assigning separate hyper-priors to each
<span class="math inline">\(\alpha\)</span>, represents an important avenue for future research.</p>
<p>Another limitation, as mentioned previously in the remark in Section 2,
is that biases arising from unmeasured confounders are inherently
unavoidable when the set of potential confounders does not include all
true confounders. If important confounding variables are suspected to be
missing from the available data, one should carefully exclude—prior to
using the proposed method—variables suspected to be instruments (which
influence the exposure but not the outcome) and potential colliders
(which do not directly affect both exposure and outcome).</p>
<h3 class="unnumbered" id="computational-details">Computational details</h3>
<p>R itself and all packages used are available from the Comprehensive R
Archive Network (CRAN) at <a href="https://CRAN.R-project.org/" class="uri">https://CRAN.R-project.org/</a>. The results in
this manuscript were obtained using R 4.3.0 on a Mac Studio with a M1
chip and 128 GB of memory.
<a href="https://cran.r-project.org/package=bartcs">bartcs</a> 1.3.0 and
<a href="https://cran.r-project.org/package=bacr">bacr</a> 1.0.1 were used for the
analysis.</p>
<h3 class="unnumbered" id="acknowledgments">Acknowledgments</h3>
<p>This work is supported by the National Research Foundation of Korea
(NRF) grants funded by the Korea government (RS-2025-00554477,
RS-2024-00407300, NRF-2022R1F1A1062904).</p>
<h3 class="unnumbered" id="appendix">Appendix</h3>
<p>The appendix presents results from simulation studies conducted under
various scenarios that were not covered in the main text.</p>
<section id="scenario-a-5-true-confounders-and-2-additional-predictors" class="unnumbered">
<h4 class="unnumbered">Scenario A: 5 true confounders and 2 additional predictors</h4>
<p>The results from applying the single model to the example in Section 3
demonstrate that the estimates closely match the true values of SATE
(-2.55), <span class="math inline">\(E[Y(1)]\)</span> (0.64), and <span class="math inline">\(E[Y(0)]\)</span> (3.19), consistent with
findings from the separate model. Notably, all corresponding 95%
credible intervals contain the true parameter values.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(<span class="fu">synthetic_data</span>(<span class="at">N =</span> <span class="dv">300</span>, <span class="at">P =</span> <span class="dv">100</span>, <span class="at">seed =</span> <span class="dv">42</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>single_fit <span class="ot">&lt;-</span> <span class="fu">single_bart</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> Y, <span class="at">trt =</span> Trt, <span class="at">X =</span> X,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_tree =</span> <span class="dv">200</span>, <span class="at">num_chain =</span> <span class="dv">4</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_burn_in =</span> <span class="dv">10000</span>, <span class="at">num_thin =</span> <span class="dv">5</span>, <span class="at">num_post_sample =</span> <span class="dv">2000</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>single_fit</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">single_bart()</span><span class="st">`</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>           mean       <span class="fl">2.5</span><span class="sc">%      97.5%</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>SATE <span class="sc">-</span><span class="fl">2.4219319</span> <span class="sc">-</span><span class="fl">2.6327170</span> <span class="sc">-</span><span class="fl">2.2125321</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>Y1    <span class="fl">0.7077994</span>  <span class="fl">0.5664953</span>  <span class="fl">0.8491844</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>Y0    <span class="fl">3.1297313</span>  <span class="fl">3.0100750</span>  <span class="fl">3.2520308</span></span></code></pre></div>
<p>For a more in-depth understanding of the output, the <code>summary()</code>
function can be used. It provides details regarding the treatment
values, tree structure, MCMC chain, and outcomes for each of the chains.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(single_fit)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">single_bart()</span><span class="st">`</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>Treatment Value</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  Treated group    <span class="sc">:</span>      <span class="dv">1</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  Control group    <span class="sc">:</span>      <span class="dv">0</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>Tree Parameters</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  Number of Tree   <span class="sc">:</span>    <span class="dv">200</span>     Value  of alpha    <span class="sc">:</span>   <span class="fl">0.95</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  Prob.  of Grow   <span class="sc">:</span>   <span class="fl">0.28</span>     Value  of beta     <span class="sc">:</span>      <span class="dv">2</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  Prob.  of Prune  <span class="sc">:</span>   <span class="fl">0.28</span>     Value  of nu       <span class="sc">:</span>      <span class="dv">3</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  Prob.  of Change <span class="sc">:</span>   <span class="fl">0.44</span>     Value  of q        <span class="sc">:</span>   <span class="fl">0.95</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>Chain Parameters</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  Number of Chains <span class="sc">:</span>      <span class="dv">4</span>     Number of burn<span class="sc">-</span><span class="cf">in</span>  <span class="sc">:</span>  <span class="dv">10000</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  Number of Iter   <span class="sc">:</span>  <span class="dv">20000</span>     Number of thinning <span class="sc">:</span>      <span class="dv">5</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  Number of Sample <span class="sc">:</span>   <span class="dv">2000</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>Outcome</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a> estimand chain       <span class="fl">2.5</span><span class="sc">%         1Q       mean     median         3Q      97.5%</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>      SATE    <span class="dv">1</span> <span class="sc">-</span><span class="fl">2.6372424</span> <span class="sc">-</span><span class="fl">2.4971912</span> <span class="sc">-</span><span class="fl">2.4278177</span> <span class="sc">-</span><span class="fl">2.4274520</span> <span class="sc">-</span><span class="fl">2.3559219</span> <span class="sc">-</span><span class="fl">2.2195278</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>      SATE    <span class="dv">2</span> <span class="sc">-</span><span class="fl">2.6347996</span> <span class="sc">-</span><span class="fl">2.4962662</span> <span class="sc">-</span><span class="fl">2.4236981</span> <span class="sc">-</span><span class="fl">2.4257645</span> <span class="sc">-</span><span class="fl">2.3521617</span> <span class="sc">-</span><span class="fl">2.2205205</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>      SATE    <span class="dv">3</span> <span class="sc">-</span><span class="fl">2.6229176</span> <span class="sc">-</span><span class="fl">2.4872413</span> <span class="sc">-</span><span class="fl">2.4163175</span> <span class="sc">-</span><span class="fl">2.4188511</span> <span class="sc">-</span><span class="fl">2.3472130</span> <span class="sc">-</span><span class="fl">2.1968565</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>      SATE    <span class="dv">4</span> <span class="sc">-</span><span class="fl">2.6321432</span> <span class="sc">-</span><span class="fl">2.4898965</span> <span class="sc">-</span><span class="fl">2.4198942</span> <span class="sc">-</span><span class="fl">2.4185564</span> <span class="sc">-</span><span class="fl">2.3492909</span> <span class="sc">-</span><span class="fl">2.2160691</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>      SATE  agg <span class="sc">-</span><span class="fl">2.6327170</span> <span class="sc">-</span><span class="fl">2.4929933</span> <span class="sc">-</span><span class="fl">2.4219319</span> <span class="sc">-</span><span class="fl">2.4229442</span> <span class="sc">-</span><span class="fl">2.3510791</span> <span class="sc">-</span><span class="fl">2.2125321</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">1</span>  <span class="fl">0.5635365</span>  <span class="fl">0.6562010</span>  <span class="fl">0.7044118</span>  <span class="fl">0.7037438</span>  <span class="fl">0.7524049</span>  <span class="fl">0.8418673</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">2</span>  <span class="fl">0.5678166</span>  <span class="fl">0.6558246</span>  <span class="fl">0.7050962</span>  <span class="fl">0.7054015</span>  <span class="fl">0.7548294</span>  <span class="fl">0.8466451</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">3</span>  <span class="fl">0.5718781</span>  <span class="fl">0.6606816</span>  <span class="fl">0.7112623</span>  <span class="fl">0.7108116</span>  <span class="fl">0.7596594</span>  <span class="fl">0.8529911</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>       Y1     <span class="dv">4</span>  <span class="fl">0.5598710</span>  <span class="fl">0.6626540</span>  <span class="fl">0.7104274</span>  <span class="fl">0.7117518</span>  <span class="fl">0.7603410</span>  <span class="fl">0.8518614</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>       Y1   agg  <span class="fl">0.5664953</span>  <span class="fl">0.6587662</span>  <span class="fl">0.7077994</span>  <span class="fl">0.7082389</span>  <span class="fl">0.7566797</span>  <span class="fl">0.8491844</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">1</span>  <span class="fl">3.0100293</span>  <span class="fl">3.0916675</span>  <span class="fl">3.1322295</span>  <span class="fl">3.1333000</span>  <span class="fl">3.1735625</span>  <span class="fl">3.2536797</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">2</span>  <span class="fl">3.0101642</span>  <span class="fl">3.0857730</span>  <span class="fl">3.1287944</span>  <span class="fl">3.1295026</span>  <span class="fl">3.1688030</span>  <span class="fl">3.2518096</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">3</span>  <span class="fl">3.0067741</span>  <span class="fl">3.0866910</span>  <span class="fl">3.1275798</span>  <span class="fl">3.1257193</span>  <span class="fl">3.1693086</span>  <span class="fl">3.2485622</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>       Y0     <span class="dv">4</span>  <span class="fl">3.0158387</span>  <span class="fl">3.0909104</span>  <span class="fl">3.1303216</span>  <span class="fl">3.1291042</span>  <span class="fl">3.1697493</span>  <span class="fl">3.2501879</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>       Y0   agg  <span class="fl">3.0100750</span>  <span class="fl">3.0885669</span>  <span class="fl">3.1297313</span>  <span class="fl">3.1291107</span>  <span class="fl">3.1705643</span>  <span class="fl">3.2520308</span></span></code></pre></div>
<p>To evaluate the performance of confounder selection, 500 simulated
datasets were generated using the data-generating process described in
Section 3, with five true confounders and two additional predictors
included in the outcome model. Figure <a href="#Fig:A1" data-reference-type="ref" data-reference="Fig:A1">12</a> presents the average posterior inclusion
probabilities across these datasets, comparing the separate model (top
panel) with the single model (bottom panel). The results clearly
indicate that all five true confounders (highlighted by red circles) are
selected with posterior probability equal to one, while irrelevant noise
variables are consistently excluded. Additionally, in the single model,
the starred point representing the treatment variable is also selected
with probability one.</p>
<figure id="Fig:A1">
<img src="fig/pip_s1.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 12: Average PIPs across 500 simulated datasets based on the
scenario described in Section 3, comparing the separate and single
models. Red circles indicate the true confounders, green circles
represent additional predictor variables included in the outcome model,
and empty circles denote noise variables. In the single model, the first
starred point corresponds to the treatment
variable.</figcaption>
</figure>
</section>
<section id="scenario-b-20-true-confounders" class="unnumbered">
<h4 class="unnumbered">Scenario B: 20 true confounders</h4>
<p>This scenario is designed to assess the performance of confounder
selection when there are 20 true confounders among 100 potential
confounders. Data were generated using the following data-generating
prcoess:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">600</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>cov <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(P)) {</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  cov[[i]] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, cov)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(X[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(X[, <span class="dv">2</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="fl">0.5</span> <span class="sc">+</span> h1 <span class="sc">+</span> h2 <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                <span class="fl">1.5</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">*</span> X[, <span class="dv">5</span>] <span class="sc">+</span> X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">20</span>] <span class="sc">%*%</span> <span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">15</span>))</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>Trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, prob)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">*</span> h1 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> h2 <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">+</span> <span class="fu">exp</span>(<span class="fl">0.5</span> <span class="sc">*</span> X[, <span class="dv">5</span>]) <span class="sc">-</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.5</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">6</span>]) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">7</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">20</span>] <span class="sc">%*%</span> <span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">15</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">*</span> h1 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> h2 <span class="sc">-</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">+</span> <span class="fu">exp</span>(<span class="fl">0.5</span> <span class="sc">*</span> X[, <span class="dv">5</span>]) <span class="sc">-</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.5</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">6</span>]) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">7</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">20</span>] <span class="sc">%*%</span> <span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">15</span>)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, mu1, <span class="fl">0.3</span>)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, mu0, <span class="fl">0.3</span>)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Trt <span class="sc">*</span> Y1 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> Trt) <span class="sc">*</span> Y0</span></code></pre></div>
<p>Examining the results from the separate model shows that the estimated
SATE slightly deviates from its true value of -2.55. This deviation
stems primarily from a minor bias in the estimation of <span class="math inline">\(E[Y(0)]\)</span>. Such
bias arises because, as the number of confounders increases, achieving
adequate overlap in confounder distributions between treatment groups
becomes more challenging within a limited sample size.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>separate_fit <span class="ot">&lt;-</span> <span class="fu">separate_bart</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">Y =</span> Y, <span class="at">trt =</span> Trt, <span class="at">X =</span> X, <span class="at">num_tree =</span> <span class="dv">200</span>, <span class="at">num_chain =</span> <span class="dv">4</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">num_burn_in =</span> <span class="dv">10000</span>, <span class="at">num_thin =</span> <span class="dv">5</span>, <span class="at">num_post_sample =</span> <span class="dv">2000</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>separate_fit</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">separate_bart()</span><span class="st">`</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>          mean       <span class="fl">2.5</span><span class="sc">%     97.5%</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>SATE <span class="sc">-</span><span class="fl">2.207329</span> <span class="sc">-</span><span class="fl">2.4512574</span> <span class="sc">-</span><span class="fl">1.958840</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>Y1    <span class="fl">1.050447</span>  <span class="fl">0.8839941</span>  <span class="fl">1.224950</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>Y0    <span class="fl">3.257776</span>  <span class="fl">3.0882004</span>  <span class="fl">3.425323</span></span></code></pre></div>
<p>In the case of the single model, the bias is noticeably smaller. This
reflects the relative advantage of the single model, as also discussed
in <span class="citation" data-cites="kim2023bnp">(<a href="#ref-kim2023bnp" role="doc-biblioref">Kim et al. 2023</a>)</span>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>single_fit</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">single_bart()</span><span class="st">`</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>          mean       <span class="fl">2.5</span><span class="sc">%     97.5%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>SATE <span class="sc">-</span><span class="fl">2.352218</span> <span class="sc">-</span><span class="fl">2.5377421</span> <span class="sc">-</span><span class="fl">2.162899</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>Y1    <span class="fl">1.011433</span>  <span class="fl">0.9065068</span>  <span class="fl">1.120402</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>Y0    <span class="fl">3.363651</span>  <span class="fl">3.2602485</span>  <span class="fl">3.465711</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>single_fit</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">single_bart()</span><span class="st">`</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>          mean       <span class="fl">2.5</span><span class="sc">%     97.5%</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>SATE <span class="sc">-</span><span class="fl">2.352218</span> <span class="sc">-</span><span class="fl">2.5377421</span> <span class="sc">-</span><span class="fl">2.162899</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>Y1    <span class="fl">1.011433</span>  <span class="fl">0.9065068</span>  <span class="fl">1.120402</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>Y0    <span class="fl">3.363651</span>  <span class="fl">3.2602485</span>  <span class="fl">3.465711</span></span></code></pre></div>
<p>To assess confounder selection performance, 500 simulated datasets were
generated based on the data-generating process described above,
including 20 true confounders. Figure <a href="#Fig:A2" data-reference-type="ref" data-reference="Fig:A2">13</a> shows the average posterior inclusion probabilities
obtained across these datasets, comparing results from the separate
model (top panel) and the single model (bottom panel). The results
clearly demonstrate that all 20 true confounders (marked with red
circles) are consistently selected with posterior probabilities equal to
one, whereas irrelevant noise variables are effectively excluded from
the models.</p>
<figure id="Fig:A2">
<img src="fig/pip_s2.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 13: Average PIPs across 500 simulated datasets based on the
scenario containing 20 true confounders, comparing the separate and
single models. Red circles indicate the true confounders, and empty
circles denote noise variables. In the single model, the first starred
point represents the treatment variable.</figcaption>
</figure>
</section>
<section id="scenario-c-5-true-confounders-and-2-instrumental-variables" class="unnumbered">
<h4 class="unnumbered">Scenario C: 5 true confounders and 2 instrumental variables</h4>
<p>This scenario includes 5 true confounders among 100 potential
confounders, and in particular, it includes 2 instrumental variables
(i.e., variables that affect only the exposure). The data generating
process for this scenario is as follows:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>cov <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(P)) {</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  cov[[i]] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, cov)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(X[, <span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(X[, <span class="dv">2</span>] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="fl">0.5</span> <span class="sc">+</span> h1 <span class="sc">+</span> h2 <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                <span class="fl">1.5</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">*</span> X[, <span class="dv">5</span>] <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> X[, <span class="dv">6</span>] <span class="sc">-</span> <span class="dv">1</span> <span class="sc">*</span> X[, <span class="dv">7</span>])</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>Trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, prob)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">*</span> h1 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> h2 <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">+</span> <span class="fu">exp</span>(<span class="fl">0.5</span> <span class="sc">*</span> X[, <span class="dv">5</span>])</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">*</span> h1 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> h2 <span class="sc">-</span> <span class="dv">0</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(X[, <span class="dv">3</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span> <span class="sc">*</span> X[, <span class="dv">4</span>] <span class="sc">+</span> <span class="fu">exp</span>(<span class="fl">0.5</span> <span class="sc">*</span> X[, <span class="dv">5</span>])</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, mu1, <span class="fl">0.3</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, mu0, <span class="fl">0.3</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Trt <span class="sc">*</span> Y1 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> Trt) <span class="sc">*</span> Y0</span></code></pre></div>
<p>When the separate model is fitted, the 95% credible intervals
successfully capture the true values of SATE, E<span class="math display">\[Y(1)\]</span>, and E<span class="math display">\[Y(0)\]</span>,
which are -0.98, 2.21, and 3.19, respectively. Similarly, the single
model also provides accurate estimates of the true values.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>separate_fit <span class="ot">&lt;-</span> <span class="fu">separate_bart</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">Y =</span> Y, <span class="at">trt =</span> Trt, <span class="at">X =</span> X, <span class="at">num_tree =</span> <span class="dv">200</span>, <span class="at">num_chain =</span> <span class="dv">4</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">num_burn_in =</span> <span class="dv">10000</span>, <span class="at">num_thin =</span> <span class="dv">5</span>, <span class="at">num_post_sample =</span> <span class="dv">2000</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>separate_fit</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">separate_bart()</span><span class="st">`</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>          mean      <span class="fl">2.5</span><span class="sc">%     97.5%</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>SATE <span class="sc">-</span><span class="fl">0.905955</span> <span class="sc">-</span><span class="fl">1.172369</span> <span class="sc">-</span><span class="fl">0.634617</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>Y1    <span class="fl">2.173088</span>  <span class="fl">1.976194</span>  <span class="fl">2.375582</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>Y0    <span class="fl">3.079043</span>  <span class="fl">2.898203</span>  <span class="fl">3.261354</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>single_fit <span class="ot">&lt;-</span> <span class="fu">single_bart</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">Y =</span> Y, <span class="at">trt =</span> Trt, <span class="at">X =</span> X, <span class="at">num_tree =</span> <span class="dv">200</span>, <span class="at">num_chain =</span> <span class="dv">4</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">num_burn_in =</span> <span class="dv">10000</span>, <span class="at">num_thin =</span> <span class="dv">5</span>, <span class="at">num_post_sample =</span> <span class="dv">2000</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>single_fit</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">bartcs</span><span class="st">`</span> fit by <span class="st">`</span><span class="at">single_bart()</span><span class="st">`</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>           mean      <span class="fl">2.5</span><span class="sc">%      97.5%</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>SATE <span class="sc">-</span><span class="fl">0.9421112</span> <span class="sc">-</span><span class="fl">1.116511</span> <span class="sc">-</span><span class="fl">0.7714885</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>Y1    <span class="fl">2.1999294</span>  <span class="fl">2.089350</span>  <span class="fl">2.3124345</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>Y0    <span class="fl">3.1420407</span>  <span class="fl">3.040003</span>  <span class="fl">3.2451105</span></span></code></pre></div>
<p>To assess confounder selection performance, 500 simulated datasets were
generated based on the data-generating process described above,
including 5 true confounders and 2 instrumental variables. Figure
<a href="#Fig:A3" data-reference-type="ref" data-reference="Fig:A3">14</a> shows the average
posterior inclusion probabilities obtained across these datasets,
comparing results from the separate model (top panel) and the single
model (bottom panel). The results clearly demonstrate that all 5 true
confounders (marked with red circles) are consistently selected with
posterior probabilities equal to one, whereas irrelevant noise variables
are effectively excluded from the models.</p>
<figure id="Fig:A3">
<img src="fig/pip_s3.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 14: Average PIPs across 500 simulated datasets based on the
scenario containing 5 true confounders and 2 instrumental variables,
comparing the separate and single models. Red circles indicate the true
confounders, green circles represent the instrumental variables, and
empty circles denote noise variables. In the single model, the first
starred point represents the treatment
variable.</figcaption>
</figure>
<div class="sourceCode" id="cb32"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
</section>
<h3 class="appendix" data-number="8" id="supplementary-materials"><span class="header-section-number">8</span> Supplementary materials</h3>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2025-019.zip">RJ-2025-019.zip</a></p>
<h3 class="appendix" data-number="9" id="note"><span class="header-section-number">9</span> Note</h3>
<p>This article is converted from a Legacy LaTeX article using the
<a href="https://cran.r-project.org/package=texor">texor</a> package.
The pdf version is the official version. To report a problem with the html,
refer to CONTRIBUTE on the R Journal homepage.</p>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-abadie2005semiparametric" class="csl-entry" role="listitem">
A. Abadie. Semiparametric difference-in-differences estimators. <em>The <span>R</span>eview of <span>E</span>conomic <span>S</span>tudies</em>, 72(1): 1–19, 2005.
</div>
<div id="ref-albert1993bayesian" class="csl-entry" role="listitem">
J. H. Albert and S. Chib. Bayesian analysis of binary and polychotomous response data. <em>Journal of the American Statistical Association</em>, 88(422): 669–679, 1993.
</div>
<div id="ref-barbieri2004optimal" class="csl-entry" role="listitem">
M. M. Barbieri and J. O. Berger. Optimal predictive model selection. <em>The Annals of Statistics</em>, 32(3): 870–897, 2004.
</div>
<div id="ref-caron2022shrinkage" class="csl-entry" role="listitem">
A. Caron, G. Baio and I. Manolopoulou. Shrinkage bayesian causal forests for heterogeneous treatment effects estimation. <em>Journal of Computational and Graphical Statistics</em>, 31(4): 1202–1214, 2022.
</div>
<div id="ref-chipman2010bart" class="csl-entry" role="listitem">
H. A. Chipman, E. I. George, R. E. McCulloch, et al. <span>BART</span>: Bayesian additive regression trees. <em>The Annals of Applied Statistics</em>, 4(1): 266–298, 2010.
</div>
<div id="ref-ding2018causal" class="csl-entry" role="listitem">
P. Ding and F. Li. Causal inference. <em>Statistical Science</em>, 33(2): 214–237, 2018.
</div>
<div id="ref-ding2017instrumental" class="csl-entry" role="listitem">
P. Ding, T. VanderWeele and J. M. Robins. Instrumental variables as bias amplifiers with general outcome and confounding. <em>Biometrika</em>, 104(2): 291–302, 2017.
</div>
<div id="ref-npci" class="csl-entry" role="listitem">
V. Dorie. <em>NPCI: Non-parametrics for causal inference.</em> 2016. URL <a href="https://github.com/vdorie/npci">https://github.com/vdorie/npci</a>.
</div>
<div id="ref-haggstrom2018data" class="csl-entry" role="listitem">
J. Häggström. Data-driven confounder selection via <span>M</span>arkov and <span>B</span>ayesian networks. <em>Biometrics</em>, 74(2): 389–398, 2018.
</div>
<div id="ref-hahn2020bayesian" class="csl-entry" role="listitem">
P. R. Hahn, J. S. Murray and C. M. Carvalho. Bayesian regression tree models for causal inference: Regularization, confounding, and heterogeneous effects. <em>Bayesian Analysis</em>, 15(3): 965–1056, 2020. DOI <a href="https://doi.org/10.1214/19-BA1195">10.1214/19-BA1195</a>.
</div>
<div id="ref-hastie2000bayesian" class="csl-entry" role="listitem">
T. Hastie and R. Tibshirani. Bayesian backfitting (with comments and a rejoinder by the authors). <em>Statistical Science</em>, 15(3): 196–223, 2000.
</div>
<div id="ref-bartcause" class="csl-entry" role="listitem">
J. L. Hill. Bayesian nonparametric modeling for causal inference. <em>Journal of Computational and Graphical Statistics</em>, 20(1): 217–240, 2011. DOI <a href="https://doi.org/10.1198/jcgs.2010.08162">10.1198/jcgs.2010.08162</a>.
</div>
<div id="ref-kapelner2013bartmachine" class="csl-entry" role="listitem">
A. Kapelner and J. Bleich. Bart<span>M</span>achine: Machine learning with <span>B</span>ayesian additive regression trees. <em>Journal of Statistical Software</em>, 70(4): 1–40, 2016. DOI <a href="https://doi.org/10.18637/jss.v070.i04">10.18637/jss.v070.i04</a>.
</div>
<div id="ref-kim2023bnp" class="csl-entry" role="listitem">
C. Kim, M. Tec and C. M. Zigler. Bayesian nonparametric adjustment of confounding. <em>Biometrics</em>, 79(4): 3252–3265, 2023. DOI <a href="https://doi.org/10.1111/biom.13833">10.1111/biom.13833</a>.
</div>
<div id="ref-lefebvre2014extending" class="csl-entry" role="listitem">
G. Lefebvre, J. A. Delaney and R. L. McClelland. Extending the <span>B</span>ayesian adjustment for confounding algorithm to binary treatment covariates to estimate the effect of smoking on carotid intima-media thickness: The multi-ethnic study of atherosclerosis. <em>Statistics in Medicine</em>, 33(16): 2797–2813, 2014.
</div>
<div id="ref-li2023bayesian" class="csl-entry" role="listitem">
F. Li, P. Ding and F. Mealli. Bayesian causal inference: A critical review. <em>Philosophical Transactions of the Royal Society A</em>, 381(2247): 20220153, 2023.
</div>
<div id="ref-linero2018bayesian" class="csl-entry" role="listitem">
A. R. Linero. Bayesian regression trees for high-dimensional prediction and variable selection. <em>Journal of the American Statistical Association</em>, 113(522): 626–636, 2018.
</div>
<div id="ref-louizos:2017" class="csl-entry" role="listitem">
C. Louizos, U. Shalit, J. M. Mooij, D. Sontag, R. Zemel and M. Welling. Causal effect inference with deep latent-variable models. <em>Advances in Neural Information Processing Systems</em>, 30: 2017. URL <a href="https://github.com/AMLab-Amsterdam/CEVAE">https://github.com/AMLab-Amsterdam/CEVAE</a>.
</div>
<div id="ref-murray2021log" class="csl-entry" role="listitem">
J. S. Murray. Log-linear <span>B</span>ayesian additive regression trees for multinomial logistic and count regression models. <em>Journal of the American Statistical Association</em>, 116(534): 756–769, 2021.
</div>
<div id="ref-myers2011effects" class="csl-entry" role="listitem">
J. A. Myers, J. A. Rassen, J. J. Gagne, K. F. Huybrechts, S. Schneeweiss, K. J. Rothman, M. M. Joffe and R. J. Glynn. Effects of adjusting for instrumental variables on bias and precision of effect estimates. <em>American <span>J</span>ournal of <span>E</span>pidemiology</em>, 174(11): 1213–1222, 2011.
</div>
<div id="ref-ggcharts" class="csl-entry" role="listitem">
T. Neitmann, J. Silge and D. Robinson. <em>Ggcharts: Shorten the distance from data visualization idea to actual plot.</em> 2020. URL <a href="https://CRAN.R-project.org/package=ggcharts">https://CRAN.R-project.org/package=ggcharts</a>. <span>R</span> package version 0.2.1.
</div>
<div id="ref-oganisian2020invited" class="csl-entry" role="listitem">
A. Oganisian and J. A. Roy. Invited discussion for <span>B</span>ayesian regression tree models for causal inference: Regularization, confounding, and heterogeneous effects. <em>Bayesian Analysis</em>, 15(3): 998–1006, 2020.
</div>
<div id="ref-papadogeorgou2020invited" class="csl-entry" role="listitem">
G. Papadogeorgou and F. Li. Invited discussion for <span>B</span>ayesian regression tree models for causal inference: Regularization, confounding, and heterogeneous effects. <em>Bayesian Analysis</em>, 15(3): 1007–1013, 2020.
</div>
<div id="ref-coda" class="csl-entry" role="listitem">
M. Plummer, N. Best, K. Cowles and K. Vines. CODA: Convergence diagnosis and output analysis for MCMC. <em>R News</em>, 6(1): 7–11, 2006. URL <a href="https://journal.r-project.org/archive/">https://journal.r-project.org/archive/</a>.
</div>
<div id="ref-RCODA" class="csl-entry" role="listitem">
M. Plummer, N. Best, K. Cowles, K. Vines, D. Sarkar, D. Bates, R. Almond and A. Magnusson. <em>Coda: Output analysis and diagnostics for MCMC.</em> 2020. URL <a href="https://CRAN.R-project.org/package=coda">https://CRAN.R-project.org/package=coda</a>. <span>R</span> package version 0.19-4.
</div>
<div id="ref-pratola2016efficient" class="csl-entry" role="listitem">
M. T. Pratola. Efficient metropolis–hastings proposal mechanisms for <span>B</span>ayesian regression tree models. <em>Bayesian Analysis</em>, 11(3): 885–911, 2016.
</div>
<div id="ref-rosenbaum_central_1983" class="csl-entry" role="listitem">
P. R. Rosenbaum and D. B. Rubin. The central role of the propensity score in observational studies for causal effects. <em>Biometrika</em>, 70(1): 41–55, 1983.
</div>
<div id="ref-rubin_discussion_1980" class="csl-entry" role="listitem">
D. B. Rubin. Discussion of randomization analysis of experimental data: The <span>Fisher</span> randomization test by <span>D</span>. <span>Basu</span>. <em>Journal of the American Statistical Association</em>, 75(371): 591–593, 1980.
</div>
<div id="ref-rubin1974estimating" class="csl-entry" role="listitem">
D. B. Rubin. Estimating causal effects of treatments in randomized and nonrandomized studies. <em>Journal of Educational Psychology</em>, 66(5): 688, 1974.
</div>
<div id="ref-shortreed2017outcome" class="csl-entry" role="listitem">
S. M. Shortreed and A. Ertefaie. Outcome-adaptive lasso: Variable selection for causal inference. <em>Biometrics</em>, 73(4): 1111–1122, 2017.
</div>
<div id="ref-sparapani2016nonparametric" class="csl-entry" role="listitem">
R. A. Sparapani, B. R. Logan, R. E. McCulloch and P. W. Laud. Nonparametric survival analysis using <span>B</span>ayesian additive regression trees (BART). <em>Statistics in <span>M</span>edicine</em>, 35(16): 2741–2753, 2016.
</div>
<div id="ref-BART" class="csl-entry" role="listitem">
R. Sparapani, C. Spanbauer and R. McCulloch. Nonparametric machine learning and efficient computation with <span>B</span>ayesian additive regression trees: The <span>BART</span> <span>R</span> package. <em>Journal of Statistical Software</em>, 97(1): 1–66, 2021. DOI <a href="https://doi.org/10.18637/jss.v097.i01">10.18637/jss.v097.i01</a>.
</div>
<div id="ref-vanderweele2019principles" class="csl-entry" role="listitem">
T. J. VanderWeele. Principles of confounder selection. <em>European Journal of Epidemiology</em>, 34(3): 211–219, 2019.
</div>
<div id="ref-vehtari2021" class="csl-entry" role="listitem">
A. Vehtari, A. Gelman, D. Simpson, B. Carpenter and P.-C. Bürkner. Rank-normalization, folding, and localization: An improved <span>R</span>-hat for assessing convergence of <span>MCMC</span> (with discussion). <em>Bayesian Analysis</em>, 16(2): 667–718, 2021.
</div>
<div id="ref-wang2015accounting" class="csl-entry" role="listitem">
C. Wang, F. Dominici, G. Parmigiani and C. M. Zigler. Accounting for uncertainty in confounder and effect modifier selection when estimating average causal effects in generalized linear models. <em>Biometrics</em>, 71(3): 654–665, 2015.
</div>
<div id="ref-wang2012bayesian" class="csl-entry" role="listitem">
C. Wang, G. Parmigiani and F. Dominici. Bayesian effect estimation accounting for adjustment uncertainty. <em>Biometrics</em>, 68(3): 661–671, 2012.
</div>
<div id="ref-bayespen" class="csl-entry" role="listitem">
A. Wilson, H. D. Bondell and B. J. Reich. <em>BayesPen: Bayesian penalized credible regions.</em> 2015. URL <a href="https://anderwilson.github.io/BayesPen">https://anderwilson.github.io/BayesPen</a>. R package version 1.2.
</div>
<div id="ref-wilson2014confounder" class="csl-entry" role="listitem">
A. Wilson and B. J. Reich. Confounder selection via penalized credible regions. <em>Biometrics</em>, 70(4): 852–861, 2014.
</div>
<div id="ref-bartcs" class="csl-entry" role="listitem">
Y. Yoo. <em>Bartcs: Bayesian additive regression trees for confounder selection.</em> 2024. URL <a href="https://CRAN.R-project.org/package=bartcs">https://CRAN.R-project.org/package=bartcs</a>. R package version 1.2.2.
</div>
<div id="ref-tableone" class="csl-entry" role="listitem">
K. Yoshida and A. Bartel. <em>Tableone: Create <span>“table 1”</span> to describe baseline characteristics with or without propensity score weights.</em> 2022. URL <a href="https://CRAN.R-project.org/package=tableone">https://CRAN.R-project.org/package=tableone</a>. R package version 0.13.2.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
<h3 id="reuse">Reuse</h3>
<p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
<h3 id="citation">Citation</h3>
<p>For attribution, please cite this work as</p>
<pre class="citation-appendix short">Yoo &amp; author), "bartcs: An R Package for Bayesian Nonparametric Adjustment for Confounding", The R Journal, 2025</pre>
<p>BibTeX citation</p>
<pre class="citation-appendix long">@article{RJ-2025-019,
  author = {Yoo, Yeonghoon and author), Chanmin Kim (corresponding},
  title = {bartcs: An R Package for Bayesian Nonparametric Adjustment for Confounding},
  journal = {The R Journal},
  year = {2025},
  note = {https://doi.org/10.32614/RJ-2025-019},
  doi = {10.32614/RJ-2025-019},
  volume = {17},
  issue = {2},
  issn = {2073-4859},
  pages = {1}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
