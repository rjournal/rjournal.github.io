\documentclass[preview,border=5pt]{standalone}
\usepackage{xcolor}
\usepackage{verbatim}
\usepackage[T1]{fontenc}
\usepackage{hyperref}
\newcommand{\code}[1]{\texttt{#1}}
\newcommand{\R}{R}
\newcommand{\pkg}[1]{#1}
\newcommand{\CRANpkg}[1]{\pkg{#1}}%
\newcommand{\BIOpkg}[1]{\pkg{#1}}
\usepackage{amsmath,amssymb,array}
\usepackage{booktabs}
\usepackage{verbatim}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{subcaption}
\begin{document}
\nopagecolor
\begin{algorithmic}[1]
\Require Samples from the previous iteration $(\mathcal{T}_t, \mathcal{T}^1_t, \mathcal{T}^0_t,\mathcal{M}_t,\mathcal{M}_t^1,\mathcal{M}_t^0)$ for $t=1, \ldots, T$ and $(\sigma_1^2, \sigma_0^2, \boldsymbol{s}_{12})$, and data $(y_i, A_i, \boldsymbol{X}_i)$ for $i=1, \cdots, N$
\For{$r=1, \ldots, M$ iteration}
\For{$i=1, \ldots, N$}
\State $Z_i \sim \left\{ \begin{array}{ll}
         N\left(\sum_{t=1}^T g_1(\boldsymbol{X}_i; \mathcal{T}_t, \mathcal{M}_t), 1\right)I_{(Z_i  > 0)} & \mbox{for $A_i =1 $};\\
        N\left(\sum_{t=1}^T g_1(\boldsymbol{X}_i; \mathcal{T}_t, \mathcal{M}_t), 1\right)I_{(Z_i  \leq 0)} & \mbox{for $A_i = 0 $}\end{array} \right.$ \Comment{latent exposure variable}
\EndFor
\For{$j=1, \ldots, T$}
\For{$i=1, \ldots, N$}
\State $R_{i,-j}^{(r)} = Z_i - \sum_{t\neq j} g_1(\boldsymbol{X}_i; \mathcal{T}_t, \mathcal{M}_t)$  \Comment{residual of the exposure model}
\State $H_{i,-j}^{1, (r)} = y_i - \sum_{t\neq j} g_2^1(\boldsymbol{X}_i; \mathcal{T}_t^1, \mathcal{M}_t^1)$  \Comment{residual of the outcome model for $i \in \mathcal{I}_1$}
\State $H_{i,-j}^{0, (r)} = y_i - \sum_{t\neq j} g_2^0(\boldsymbol{X}_i; \mathcal{T}_t^0, \mathcal{M}_t^0)$  \Comment{residual of the outcome model for $i \in \mathcal{I}_0$}
\EndFor
\State $\mathcal{T}_j^{(r)} \sim [\mathcal{T}_j | R_{1, -j}^{(r)}, \cdots, R_{N, -j}^{(r)}, 1]$  \Comment{based on one of the three acceptance ratios}
\State $\mathcal{T}_j^{1,(r)} \sim [\mathcal{T}_j^1 | \boldsymbol{H}_{\cdot, -j}^{1, (r)}, \sigma^2_1]$  \Comment{based on one of the three acceptance ratios}
\State $\mathcal{T}_j^{0,(r)} \sim [\mathcal{T}_j^0 | \boldsymbol{H}_{\cdot, -j}^{0, (r)}, \sigma^2_0]$  \Comment{based on one of the three acceptance ratios}
\State $\mathcal{M}_j^{(r)} \sim [\mathcal{M}_j | \mathcal{T}_j^{(r)}, R_{1, -j}^{(r)}, \cdots, R_{N, -j}^{(r)}, 1]$
\State $\mathcal{M}_j^{1,(r)} \sim [\mathcal{M}_j^1 | \mathcal{T}_j^{1,(r)}, \boldsymbol{H}_{\cdot, -j}^{1,(r)}, \sigma^2_1]$
\State $\mathcal{M}_j^{0,(r)} \sim [\mathcal{M}_j^0 | \mathcal{T}_j^{0,(r)}, \boldsymbol{H}_{\cdot, -j}^{0,(r)}, \sigma^2_0]$
where, for each $a\in\{0,1\}$, $\boldsymbol{H}_{\cdot, -j}^{a, (r)}$ denotes $\{H_{i, -j}^{a, (r)} | i \in \mathcal{I}_a\}$
\EndFor
\State \[\sigma^2_{1} \sim \text{Inv.Gamma}\left(a_\sigma+\frac{|\mathcal{I}_1|}{2}, b_\sigma+\frac{1}{2}\left\{\sum_{i \in \mathcal{I}_1} \left(y_i - \sum_{t=1}^T g_2^1(\boldsymbol{X}_i; \mathcal{T}_t^1, \mathcal{M}_t^1)\right) \right\}\right)\]
\[\sigma^2_{0} \sim \text{Inv.Gamma}\left(a_\sigma+\frac{|\mathcal{I}_0|}{2}, b_\sigma+\frac{1}{2}\left\{\sum_{i \in \mathcal{I}_0} \left(y_i - \sum_{t=1}^T g_2^0(\boldsymbol{X}_i; \mathcal{T}_t^0, \mathcal{M}_t^0)\right) \right\}\right)\]
\State Update $\boldsymbol{s}_{12}^{(r)}$ via the Gibbs algorithm:
 \[\boldsymbol{s}_{12}^{(r)} \sim \mathcal{D}\left(n_{1,1}+n_{1,21}+n_{1,20} + \alpha/P, \cdots, n_{P,1}+n_{P,21}+n_{p,20} + \alpha/P\right)\]
\EndFor
\end{algorithmic}
\end{document}
