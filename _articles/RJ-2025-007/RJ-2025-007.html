<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
      margin-bottom: 0em;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Structured Bayesian Regression Tree Models for Estimating Distributed Lag Effects: The R Package dlmtree</title>

  <meta property="description" itemprop="description" content="When examining the relationship between an exposure and an outcome,&#10;there is often a time lag between exposure and the observed effect on&#10;the outcome. A common statistical approach for estimating the&#10;relationship between the outcome and lagged measurements of exposure&#10;is a distributed lag model (DLM). Because repeated measurements are&#10;often autocorrelated, the lagged effects are typically constrained to&#10;vary smoothly over time. A recent statistical development on the&#10;smoothing constraint is a tree structured DLM framework. We present an&#10;R package dlmtree, available on CRAN, that integrates tree structured&#10;DLM and extensions into a comprehensive software package with&#10;user-friendly implementation. A conceptual background on tree&#10;structured DLMs and a demonstration of the fitting process of each&#10;model using simulated data are provided. We also demonstrate inference&#10;and interpretation using the fitted models, including summary and&#10;visualization. Additionally, a built-in shiny app for heterogeneity&#10;analysis is included."/>

  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2025-08-11"/>
  <meta property="article:created" itemprop="dateCreated" content="2025-08-11"/>
  <meta name="article:author" content="Seongwon Im"/>
  <meta name="article:author" content="Ander Wilson"/>
  <meta name="article:author" content="Daniel Mork"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Structured Bayesian Regression Tree Models for Estimating Distributed Lag Effects: The R Package dlmtree"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="When examining the relationship between an exposure and an outcome,&#10;there is often a time lag between exposure and the observed effect on&#10;the outcome. A common statistical approach for estimating the&#10;relationship between the outcome and lagged measurements of exposure&#10;is a distributed lag model (DLM). Because repeated measurements are&#10;often autocorrelated, the lagged effects are typically constrained to&#10;vary smoothly over time. A recent statistical development on the&#10;smoothing constraint is a tree structured DLM framework. We present an&#10;R package dlmtree, available on CRAN, that integrates tree structured&#10;DLM and extensions into a comprehensive software package with&#10;user-friendly implementation. A conceptual background on tree&#10;structured DLMs and a demonstration of the fitting process of each&#10;model using simulated data are provided. We also demonstrate inference&#10;and interpretation using the fitted models, including summary and&#10;visualization. Additionally, a built-in shiny app for heterogeneity&#10;analysis is included."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Structured Bayesian Regression Tree Models for Estimating Distributed Lag Effects: The R Package dlmtree"/>
  <meta property="twitter:description" content="When examining the relationship between an exposure and an outcome,&#10;there is often a time lag between exposure and the observed effect on&#10;the outcome. A common statistical approach for estimating the&#10;relationship between the outcome and lagged measurements of exposure&#10;is a distributed lag model (DLM). Because repeated measurements are&#10;often autocorrelated, the lagged effects are typically constrained to&#10;vary smoothly over time. A recent statistical development on the&#10;smoothing constraint is a tree structured DLM framework. We present an&#10;R package dlmtree, available on CRAN, that integrates tree structured&#10;DLM and extensions into a comprehensive software package with&#10;user-friendly implementation. A conceptual background on tree&#10;structured DLMs and a demonstration of the fitting process of each&#10;model using simulated data are provided. We also demonstrate inference&#10;and interpretation using the fitted models, including summary and&#10;visualization. Additionally, a built-in shiny app for heterogeneity&#10;analysis is included."/>

  <!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
  <meta name="citation_title" content="Structured Bayesian Regression Tree Models for Estimating Distributed Lag Effects: The R Package dlmtree"/>
  <meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2025-007"/>
  <meta name="citation_pdf_url" content="RJ-2025-007.pdf"/>
  <meta name="citation_volume" content="17"/>
  <meta name="citation_issue" content="1"/>
  <meta name="citation_doi" content="10.32614/RJ-2025-007"/>
  <meta name="citation_journal_title" content="The R Journal"/>
  <meta name="citation_issn" content="2073-4859"/>
  <meta name="citation_firstpage" content="136"/>
  <meta name="citation_lastpage" content="159"/>
  <meta name="citation_fulltext_world_readable" content=""/>
  <meta name="citation_online_date" content="2025/08/11"/>
  <meta name="citation_publication_date" content="2025/08/11"/>
  <meta name="citation_author" content="Seongwon Im"/>
  <meta name="citation_author_institution" content="Department of Statistics"/>
  <meta name="citation_author" content="Ander Wilson"/>
  <meta name="citation_author_institution" content="Department of Statistics"/>
  <meta name="citation_author" content="Daniel Mork"/>
  <meta name="citation_author_institution" content="Department of Biostatistics"/>
  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Distributed lags and investment analysis;citation_publisher=North-Holland Publishing Company Amsterdam;citation_volume=4;citation_author=Leendert M. Koyck"/>
  <meta name="citation_reference" content="citation_title=Distributed lag models to identify the cumulative effects of training and recovery in athletes using multivariate ordinal wellness data;citation_publisher=De Gruyter;citation_volume=17;citation_author=Erin M. Schliep;citation_author=Toryn L. J. Schafer;citation_author=Matthew Hawkey"/>
  <meta name="citation_reference" content="citation_title=The measurement of cumulative advertising effects;citation_publisher=JSTOR;citation_volume=38;citation_author=Kristian S. Palda"/>
  <meta name="citation_reference" content="citation_title=Prenatal ambient air pollutant mixture exposure and neurodevelopment in urban children in the northeastern United States;citation_publisher=Elsevier;citation_volume=233;citation_author=Yueh-Hsiu M. Chiu;citation_author=Ander Wilson;citation_author=Hsiao-Hsien L. Hsu;citation_author=Harris Jamal;citation_author=Nicole Mathews;citation_author=Itai Kloog;citation_author=Joel Schwartz;citation_author=David C. Bellinger;citation_author=Naim Xhani;citation_author=Robert O. Wright;citation_author=Prenatal ambient air pollutant mixture exposure and neurodevelopment in urban children in the northeastern United States"/>
  <meta name="citation_reference" content="citation_title=BART: Bayesian additive regression trees;citation_publisher=Institute of Mathematical Statistics;citation_volume=4;citation_author=Hugh A. Chipman;citation_author=Edward I. George;citation_author=Robert E. McCulloch"/>
  <meta name="citation_reference" content="citation_title=Penalized distributed lag interaction model: Air pollution, birth weight, and neighborhood vulnerability;citation_publisher=Wiley Online Library;citation_author=Danielle Demateis;citation_author=Kayleigh P. Keller;citation_author=David Rojas-Rueda;citation_author=Marianthi-Anna Kioumourtzoglou;citation_author=Ander Wilson"/>
  <meta name="citation_reference" content="citation_title=Distributed lag non-linear models;citation_publisher=Wiley Online Library;citation_volume=29;citation_author=Antonio Gasparrini;citation_author=Ben Armstrong;citation_author=Mike G. Kenward"/>
  <meta name="citation_reference" content="citation_title=Distributed lag linear and non-linear models in R: The package dlnm;citation_volume=43;citation_author=A. Gasparrini"/>
  <meta name="citation_reference" content="citation_title=Prenatal ambient air pollutant mixture exposure and early school-age lung function;citation_publisher=LWW;citation_volume=7;citation_author=Hsiao-Hsien L. Hsu;citation_author=Ander Wilson;citation_author=Joel Schwartz;citation_author=Itai Kloog;citation_author=Robert O. Wright;citation_author=Brent A. Coull;citation_author=Rosalind J. Wright"/>
  <meta name="citation_reference" content="citation_title=Treed distributed lag nonlinear models;citation_publisher=Oxford University Press;citation_volume=23;citation_author=Daniel Mork;citation_author=Ander Wilson"/>
  <meta name="citation_reference" content="citation_title=Bayesian inference for logistic models using pólya–gamma latent variables;citation_publisher=Taylor &amp; Francis;citation_volume=108;citation_author=Nicholas G. Polson;citation_author=James G. Scott;citation_author=Jesse Windle"/>
  <meta name="citation_reference" content="citation_title=Spatial-temporal modeling of the association between air pollution exposure and preterm birth: Identifying critical windows of exposure;citation_publisher=Oxford University Press;citation_volume=68;citation_author=Joshua Warren;citation_author=Montserrat Fuentes;citation_author=Amy Herring;citation_author=Peter Langlois"/>
  <meta name="citation_reference" content="citation_title=Heterogeneous distributed lag models to estimate personalized effects of maternal exposures to air pollution;citation_publisher=Taylor &amp; Francis;citation_volume=119;citation_author=Daniel Mork;citation_author=Marianthi-Anna Kioumourtzoglou;citation_author=Marc Weisskopf;citation_author=Brent A. Coull;citation_author=Ander Wilson"/>
  <meta name="citation_reference" content="citation_title=Estimating perinatal critical windows of susceptibility to environmental mixtures via structured Bayesian regression tree pairs;citation_publisher=Oxford University Press;citation_volume=79;citation_author=Daniel Mork;citation_author=Ander Wilson"/>
  <meta name="citation_reference" content="citation_title=Incorporating prior information into distributed lag nonlinear models with zero-inflated monotone regression trees;citation_publisher=International Society for Bayesian Analysis;citation_volume=1;citation_author=Daniel Mork;citation_author=Ander Wilson"/>
  <meta name="citation_reference" content="citation_title=Bayesian zero-inflated negative binomial regression based on pólya-gamma mixtures;citation_publisher=NIH Public Access;citation_volume=14;citation_author=Brian Neelon"/>
  <meta name="citation_reference" content="citation_title=Association between prenatal particulate air pollution exposure and telomere length in cord blood: Effect modification by fetal sex;citation_publisher=Elsevier;citation_volume=172;citation_author=Maria José Rosa;citation_author=Hsiao-Hsien L. Hsu;citation_author=Allan C. Just;citation_author=Kasey J. Brennan;citation_author=Tessa Bloomquist;citation_author=Itai Kloog;citation_author=Ivan Pantic;citation_author=Adriana Mercado Garcı́a;citation_author=Ander Wilson;citation_author=Brent A. Coull;citation_author=Association between prenatal particulate air pollution exposure and telomere length in cord blood: Effect modification by fetal sex"/>
  <meta name="citation_reference" content="citation_title=The distributed lag between air pollution and daily deaths;citation_publisher=LWW;citation_volume=11;citation_author=Joel Schwartz"/>
  <meta name="citation_reference" content="citation_title=Generalized additive distributed lag models: Quantifying mortality displacement;citation_publisher=Oxford University Press;citation_volume=1;citation_author=Antonella Zanobetti;citation_author=Matt P. Wand;citation_author=Joel Schwartz;citation_author=Louise M. Ryan"/>
  <meta name="citation_reference" content="citation_title=Potential for bias when estimating critical windows for air pollution in children’s health;citation_volume=186;citation_doi=10.1093/aje/kwx184;citation_issn=0002-9262;citation_author=Ander Wilson;citation_author=Yueh-Hsiu M. Chiu;citation_author=Hsiao-Hsien L. Hsu;citation_author=Robert O. Wright;citation_author=Rosalind J. Wright;citation_author=Brent A. Coull"/>
  <meta name="citation_reference" content="citation_title=Bayesian variable selection in distributed lag models: A focus on binary quantile and count data regressions;citation_author=Daniel Dempsey;citation_author=Jason Wyse"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","date_received","journal","volume","issue","slug","citation_url","packages","preview","bibliography","CTV","legacy_pdf","legacy_converted","output","draft","pdf_url","doi","creative_commons","csl"]}},"value":[{"type":"character","attributes":{},"value":["Structured Bayesian Regression Tree Models for Estimating Distributed Lag Effects: The R Package dlmtree"]},{"type":"character","attributes":{},"value":["When examining the relationship between an exposure and an outcome,\nthere is often a time lag between exposure and the observed effect on\nthe outcome. A common statistical approach for estimating the\nrelationship between the outcome and lagged measurements of exposure\nis a distributed lag model (DLM). Because repeated measurements are\noften autocorrelated, the lagged effects are typically constrained to\nvary smoothly over time. A recent statistical development on the\nsmoothing constraint is a tree structured DLM framework. We present an\nR package dlmtree, available on CRAN, that integrates tree structured\nDLM and extensions into a comprehensive software package with\nuser-friendly implementation. A conceptual background on tree\nstructured DLMs and a demonstration of the fitting process of each\nmodel using simulated data are provided. We also demonstrate inference\nand interpretation using the fitted models, including summary and\nvisualization. Additionally, a built-in shiny app for heterogeneity\nanalysis is included.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Seongwon Im"]},{"type":"character","attributes":{},"value":["Department of Statistics"]},{"type":"character","attributes":{},"value":["Colorado State University","United States of America","(0009-0000-8447-5852)","[seongwon.im@colostate.edu](seongwon.im@colostate.edu){.uri}\n"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Ander Wilson"]},{"type":"character","attributes":{},"value":["Department of Statistics"]},{"type":"character","attributes":{},"value":["Colorado State University","United States of America","(0000-0003-4774-3883)","[ander.wilson@colostate.edu](ander.wilson@colostate.edu){.uri}\n"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Daniel Mork"]},{"type":"character","attributes":{},"value":["Department of Biostatistics"]},{"type":"character","attributes":{},"value":["Harvard T.H. Chan School of Public Health","United States of America","(0000-0002-7924-0706)","[dmork@hsph.harvard.edu](dmork@hsph.harvard.edu){.uri}\n"]}]}]},{"type":"character","attributes":{},"value":["2025-08-11"]},{"type":"character","attributes":{},"value":["2024-07-12"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[136]},{"type":"integer","attributes":{},"value":[159]}]},{"type":"integer","attributes":{},"value":[17]},{"type":"integer","attributes":{},"value":[1]},{"type":"character","attributes":{},"value":["RJ-2025-007"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2025-007"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["dlnm","dlim","bdlim","DiscreteDLM","dlmtree","shiny","dplyr"]},{"type":"list","attributes":{},"value":[]}]},{"type":"character","attributes":{},"value":["preview.png"]},{"type":"character","attributes":{},"value":["main.bib"]},{"type":"character","attributes":{},"value":["Databases","ModelDeployment","TimeSeries","WebTechnologies"]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","mathjax","md_extension"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"]},{"type":"character","attributes":{},"value":["-tex_math_single_backslash"]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["RJ-2025-007.pdf"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2025-007"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["/home/mitchell/R/x86_64-pc-linux-gnu-library/4.5/rjtools/rjournal.csl"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["images/decisiontree.png","images/dlmtree.png","images/dlmtreepair.png","images/HDLM_Shiny1.png","images/HDLM_Shiny2.png","images/HDLM_Shiny3.png","images/HDLM_Shiny4.png","images/nestedtree.png","images/TDLM_pm.png","images/TDLMM_int.png","images/TDLMM_main.png","main.bib","main.tex","RJ-2025-007_files/anchor-4.2.2/anchor.min.js","RJ-2025-007_files/bowser-1.9.3/bowser.min.js","RJ-2025-007_files/distill-2.2.21/template.v2.js","RJ-2025-007_files/header-attrs-2.30/header-attrs.js","RJ-2025-007_files/jquery-3.6.0/jquery-3.6.0.js","RJ-2025-007_files/jquery-3.6.0/jquery-3.6.0.min.js","RJ-2025-007_files/jquery-3.6.0/jquery-3.6.0.min.map","RJ-2025-007_files/popper-2.6.0/popper.min.js","RJ-2025-007_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2025-007_files/tippy-6.2.7/tippy-light-border.css","RJ-2025-007_files/tippy-6.2.7/tippy.css","RJ-2025-007_files/tippy-6.2.7/tippy.umd.min.js","RJ-2025-007_files/webcomponents-2.0.0/webcomponents.js","RJ-2025-007.pdf","RJ-2025-007.zip","RJournal.sty","RJwrapper.tex","scripts/pkg_main.R","scripts/pkg_supp.R"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
    font-size: 100%;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  hr.section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    margin: 0px;
  }


  d-byline {
    border-top: none;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
    border-top: none;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  /* tweak for Pandoc numbered line within distill */
  d-article pre.numberSource code > span {
      left: -2em;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // separator
    var separator = '<hr class="section-separator" style="clear: both"/>';
    // prepend separator above appendix
    $('.d-byline').before(separator);
    $('.d-article').before(separator);

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme, except when numbering line
    // in code chunk
    $('pre:not(.numberLines) code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        var author_name = front_matter.authors[i].author
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        const citeChild = $(this).children()[0]
        // Do not process if @xyz has been used without escaping and without bibliography activated
        // https://github.com/rstudio/distill/issues/466
        if (citeChild === undefined) return true

        if (citeChild.nodeName == "D-FOOTNOTE") {
          var fn = citeChild
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          // Could use CSS.escape too here, we insure backward compatibility in navigator
          return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="RJ-2025-007_files/header-attrs-2.30/header-attrs.js"></script>
  <script src="RJ-2025-007_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="RJ-2025-007_files/popper-2.6.0/popper.min.js"></script>
  <link href="RJ-2025-007_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="RJ-2025-007_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="RJ-2025-007_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="RJ-2025-007_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="RJ-2025-007_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="RJ-2025-007_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="RJ-2025-007_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Mathjax config (add automatic linebreaks when supported)
      // MathJax = {
      //    tex: {
      //        inlineMath: [['$', '$'], ['\\(', '\\)']],
      //        displayMath: [['$$', '$$'], ['\\[', '\\]']],
      //        tags: 'ams',
      //        multline: true,
      //    },
      //    options: {
      //        linebreaks: { automatic: true },
      //    },
      // };

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      
      // Conditionally add supplementary files button
      if (document.getElementById('supplementary-materials')) {
        // create element safely
        const btn_suppl = document.createElement('a');
        btn_suppl.href = slug + '.zip';
        btn_suppl.className = 'dt-tag';
        btn_suppl.innerHTML = '<i class="fas fa-file-zipper"></i> Supplement';
        buttons.append(btn_suppl);
      }

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").filter(function() {
        return !$(this).hasClass("subtitle");
      }).first();
      if (tpar) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append(tpar) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Structured Bayesian Regression Tree Models for Estimating Distributed Lag Effects: The R Package dlmtree","description":"When examining the relationship between an exposure and an outcome,\nthere is often a time lag between exposure and the observed effect on\nthe outcome. A common statistical approach for estimating the\nrelationship between the outcome and lagged measurements of exposure\nis a distributed lag model (DLM). Because repeated measurements are\noften autocorrelated, the lagged effects are typically constrained to\nvary smoothly over time. A recent statistical development on the\nsmoothing constraint is a tree structured DLM framework. We present an\nR package dlmtree, available on CRAN, that integrates tree structured\nDLM and extensions into a comprehensive software package with\nuser-friendly implementation. A conceptual background on tree\nstructured DLMs and a demonstration of the fitting process of each\nmodel using simulated data are provided. We also demonstrate inference\nand interpretation using the fitted models, including summary and\nvisualization. Additionally, a built-in shiny app for heterogeneity\nanalysis is included.","doi":"10.32614/RJ-2025-007","authors":[{"author":"Seongwon Im","authorURL":"#","affiliation":"Department of Statistics","affiliationURL":"#","orcidID":""},{"author":"Ander Wilson","authorURL":"#","affiliation":"Department of Statistics","affiliationURL":"#","orcidID":""},{"author":"Daniel Mork","authorURL":"#","affiliation":"Department of Biostatistics","affiliationURL":"#","orcidID":""}],"publishedDate":"2025-08-11T00:00:00.000+10:00","citationText":"Im, et al., 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Structured Bayesian Regression Tree Models for Estimating Distributed Lag Effects: The R Package dlmtree</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>When examining the relationship between an exposure and an outcome,
there is often a time lag between exposure and the observed effect on
the outcome. A common statistical approach for estimating the
relationship between the outcome and lagged measurements of exposure
is a distributed lag model (DLM). Because repeated measurements are
often autocorrelated, the lagged effects are typically constrained to
vary smoothly over time. A recent statistical development on the
smoothing constraint is a tree structured DLM framework. We present an
R package dlmtree, available on CRAN, that integrates tree structured
DLM and extensions into a comprehensive software package with
user-friendly implementation. A conceptual background on tree
structured DLMs and a demonstration of the fitting process of each
model using simulated data are provided. We also demonstrate inference
and interpretation using the fitted models, including summary and
visualization. Additionally, a built-in shiny app for heterogeneity
analysis is included.</p></p>
</div>

<div class="d-byline">
  Seongwon Im  (Department of Statistics)
  
,   Ander Wilson  (Department of Statistics)
  
,   Daniel Mork  (Department of Biostatistics)
  
<br/>2025-08-11
</div>

<div class="d-article">
<div class="article">
<h3 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h3>
<p>In many fields, there is interest in estimating the lagged relationship between an exposure (or treatment) and an outcome. In such cases, the length of the lag or how the exposure effect varies is often unknown. The lagged relationship can take either of two forms. The first form is the association between the exposure at one time point and an outcome distributed across several subsequent times. For example, the impact of advertisement persists beyond that single time point of the investment <span class="citation" data-cites="koyck_1954_econDLM palda_1965_advertise">(<a href="#ref-koyck_1954_econDLM" role="doc-biblioref">Koyck 1954</a>; <a href="#ref-palda_1965_advertise" role="doc-biblioref">Palda 1965</a>)</span>
or exposure to an environmental pollutant affects mortality on the same day and each of the following days <span class="citation" data-cites="schwartz_distributed_2000">(<a href="#ref-schwartz_distributed_2000" role="doc-biblioref">Schwartz 2000</a>)</span>. The second form is an exposure assessed longitudinally and an outcome assessed post-exposure. Examples of this form are maternal exposure to environmental chemicals during pregnancy on birth outcomes and children’s health and development <span class="citation" data-cites="wilson_2017_bias chiu2023prenatal hsu_prenatal_2023">(<a href="#ref-wilson_2017_bias" role="doc-biblioref">Wilson et al. 2017</a>; <a href="#ref-chiu2023prenatal" role="doc-biblioref">Chiu et al. 2023</a>; <a href="#ref-hsu_prenatal_2023" role="doc-biblioref">Hsu et al. 2023</a>)</span> and the effect of training and recovery activities over multiple days on athlete wellness <span class="citation" data-cites="schliep_2021_wellness">(<a href="#ref-schliep_2021_wellness" role="doc-biblioref">Schliep et al. 2021</a>)</span>. A popular statistical method to estimate the time-varying association between exposure and outcome is a distributed lag model (DLM).</p>
<p>The DLM regresses a scalar outcome on the exposure measured at preceding time points <span class="citation" data-cites="schwartz_distributed_2000 gasparrini_distributed_2010">(<a href="#ref-schwartz_distributed_2000" role="doc-biblioref">Schwartz 2000</a>; <a href="#ref-gasparrini_distributed_2010" role="doc-biblioref">Gasparrini et al. 2010</a>)</span>. The DLM framework is particularly useful as it allows for estimating time-resolved exposure effects and quantifies the temporal relationship between the exposure and the outcome. Because the repeated measurements of exposure are often correlated, DLMs typically include a smoothing constraint to add temporal structure to the estimated time-specific effects and to regularize the exposure effects in the presence of multicollinearity across the measurements. Constraints include polynomials, splines, and Gaussian processes <span class="citation" data-cites="zanobetti_generalized_2000 warren_spatial-temporal_2012">(<a href="#ref-zanobetti_generalized_2000" role="doc-biblioref">Zanobetti et al. 2000</a>; <a href="#ref-warren_spatial-temporal_2012" role="doc-biblioref">Warren et al. 2012</a>)</span>. Notably, <span class="citation" data-cites="mork_estimating_2023">Mork and Wilson (<a href="#ref-mork_estimating_2023" role="doc-biblioref">2023</a>)</span> introduced an approach for constrained DLM using regression tree structures based on the Bayesian additive regression tree (BART) framework <span class="citation" data-cites="chipman2010">(<a href="#ref-chipman2010" role="doc-biblioref">Chipman et al. 2010</a>)</span>. More recent methods have extended the tree structured DLM framework in several directions, including nonlinear exposure-response relationships <span class="citation" data-cites="mork_treed_2022">(<a href="#ref-mork_treed_2022" role="doc-biblioref">Mork and Wilson 2022</a>)</span>, models with lagged interactions among multiple exposures <span class="citation" data-cites="mork_estimating_2023">(<a href="#ref-mork_estimating_2023" role="doc-biblioref">Mork and Wilson 2023</a>)</span>, and models with heterogeneous lag effects <span class="citation" data-cites="mork_heterogeneous_2023">(<a href="#ref-mork_heterogeneous_2023" role="doc-biblioref">Mork et al. 2024</a>)</span>.</p>
<p>There are several related methods and packages for DLM implementation.
Table <a href="#tab:pkgs" data-reference-type="ref" data-reference="tab:pkgs">1</a> lists
currently available R packages for DLMs that are generally appropriate
for the type of epidemiology studies considered in this paper. The
<a href="https://CRAN.R-project.org/package=dlnm"><strong>dlnm</strong></a> package contains
software for estimating a DLM with linear or nonlinear exposure-response
relationships using splines for the smoothing constraint <span class="citation" data-cites="gasparrini_dlnm_2013">(<a href="#ref-gasparrini_dlnm_2013" role="doc-biblioref">Gasparrini 2011</a>)</span>. <span class="citation" data-cites="mork_treed_2022">Mork and Wilson (<a href="#ref-mork_treed_2022" role="doc-biblioref">2022</a>)</span> and <span class="citation" data-cites="mork_estimating_2023">Mork and Wilson (<a href="#ref-mork_estimating_2023" role="doc-biblioref">2023</a>)</span> compare model performance between
the spline-based and tree structured DLM implementations. The
<a href="https://CRAN.R-project.org/package=dlnm"><strong>dlnm</strong></a> package does not
consider heterogeneity or multiple exposures. There are several DLM
methods for the linear effect of a single exposure with modification by
a single covariate. The
<a href="https://CRAN.R-project.org/package=dlim"><strong>dlim</strong></a> package allows for
modification by a single continuous factor <span class="citation" data-cites="demateis_penalized_2024">(<a href="#ref-demateis_penalized_2024" role="doc-biblioref">Demateis et al. 2024</a>)</span> and
the <a href="https://CRAN.R-project.org/package=bdlim"><strong>bdlim</strong></a> package allows
for modification by a single categorical factor (Wilson et al. 2017a).
However, these packages do not allow for multiple candidate modifying
factors or multiple exposures. The package
<a href="https://CRAN.R-project.org/package=DiscreteDLM"><strong>DiscreteDLM</strong></a>
extends Bayesian estimation to categorical outcomes but does not
consider mixtures or heterogeneity <span class="citation" data-cites="dempsey2025bayesianvariableselectiondistributed">(<a href="#ref-dempsey2025bayesianvariableselectiondistributed" role="doc-biblioref">Dempsey and Wyse 2025</a>)</span>. Hence, the
<a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a> package fills
several gaps including heterogeneous effects of multiple candidate
modifiers and analysis of mixture or multivariate lagged exposures.</p>
<div id="tab:pkgs">
<table style="width:98%;">
<caption><span id="tab:T1">Table 1: </span> Available DLM related R packages with functionalities. Note: This table excludes packages designed for autoregressive DLMs, which are used in a different context from the models proposed here.</caption>
<colgroup>
<col style="width: 55%" />
<col style="width: 4%" />
<col style="width: 14%" />
<col style="width: 8%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Package</th>
<th style="text-align: center;">GLM</th>
<th style="text-align: center;">Nonlinearity</th>
<th style="text-align: center;">Mixture</th>
<th style="text-align: center;">Heterogeneity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><a href="https://CRAN.R-project.org/package=bdlim"><strong>bdlim</strong></a></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://CRAN.R-project.org/package=DiscreteDLM"><strong>DiscreteDLM</strong></a></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://CRAN.R-project.org/package=dlim"><strong>dlim</strong></a></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://CRAN.R-project.org/package=dlnm"><strong>dlnm</strong></a></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</div>
<p>In this article, we introduce a comprehensive R package
<a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a> which
consolidates a wide range of tree structured DLMs. The package offers a
user-friendly and computationally efficient environment to fit tree
structured DLMs and to address multiple potential research assumptions
including nonlinearity, monotonicity and prior information, multiple
simultaneous exposures, and heterogeneous lag effects. We first provide
a conceptual review of a regression tree as a smoothing constraint in a
DLM framework and an overview of the extensions of tree structured DLMs.
We present a decision tree to help users select an appropriate model for
their analysis. We illustrate the model fitting process with detailed
descriptions and syntax of functions for implementing models, obtaining
the summary output and inferential information, and plotting the fitted
models for visualization. The package is available in the comprehensive
R archive network (CRAN), and the installation instructions are provided
at <a href="https://danielmork.github.io/dlmtree/" class="uri">https://danielmork.github.io/dlmtree/</a>.</p>
<h3 data-number="2" id="sec:treeDLM"><span class="header-section-number">2</span> Tree structured DLMs</h3>
<h4 class="unnumbered" data-number="2.1" id="dlm-tree-as-a-smoothing-constraint">DLM tree as a smoothing constraint</h4>
<p>In this section, we review the regression tree approach to constrained
DLM estimation, a key idea underlying the tree structured DLMs in the
<a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a> package.
Classically, the DLM model is applied to time-series studies, and time
is defined in terms of the outcome time. Let <span class="math inline">\(y_{t}\)</span> be the observed
outcome and <span class="math inline">\(x_{t}\)</span> the observed exposure at time <span class="math inline">\(t\)</span> for
<span class="math inline">\(t=1,\ldots,T\)</span>. For clarity, we assume a continuous outcome when
presenting the models. We discuss extensions to generalized linear
models in Section <a href="#sec:glm" data-reference-type="ref" data-reference="sec:glm">2.4</a>. The DLM applied to time-series is
<span class="math display" id="eq:eqnDLMts">\[\label{eqn:DLMts}
    y_{t}= \sum_{l=1}^L x_{t-l}\beta_l + \boldsymbol{\mathbf{z}}_{t}&#39; \boldsymbol{\mathbf{\gamma}} + \varepsilon_{t},   \tag{1}\]</span>
where <span class="math inline">\(\beta_l\)</span> is the linear effect of exposure at lag <span class="math inline">\(l\)</span> (<span class="math inline">\(l\)</span> days
prior to the outcome assessment), <span class="math inline">\(\boldsymbol{\mathbf{z}}_{t}\)</span> is a
vector of covariates including the intercept,
<span class="math inline">\(\boldsymbol{\mathbf{\gamma}}\)</span> is a vector of regression coefficients
for the covariates, <span class="math inline">\(\varepsilon_{t}\)</span> is independent error assumed to
follow <span class="math inline">\(\text{Normal}(0, \sigma^2)\)</span>.</p>
<p>In this paper, we focus on an alternative and more general
representation of the DLM that does not assume repeated assessments of
an outcome in a time-series design. Consider a vector of outcomes
<span class="math inline">\(\boldsymbol{\mathbf{y}} = (y_1, \ldots, y_n)\)</span> for a sample
<span class="math inline">\(i = 1, \ldots, n\)</span>. Suppose we are interested in the lagged association
between the outcome and a single longitudinally assessed exposure
<span class="math inline">\(\boldsymbol{\mathbf{x}}_i = (x_{i1}, \ldots, x_{iT})\)</span> measured at
equally spaced time points, <span class="math inline">\(t = 1, \ldots, T\)</span>. Here, exposure time is
not explicitly defined relative to the outcome. Most commonly, the
exposures are in the <span class="math inline">\(T\)</span> time points prior to outcome assessment, as in <a href="#eq:eqnDLMts">(1)</a>,
but that is not required. In the illustrations
in this manuscript, we consider exposure during the first <span class="math inline">\(T\)</span> weeks of
pregnancy and a birth or early childhood health outcome as our
motivating example. Using this representation, the DLM is
<span class="math display" id="eq:eqnDLM">\[\label{eqn:DLM}
    y_i = f(\boldsymbol{\mathbf{x}}_i) + \boldsymbol{\mathbf{z}}_i&#39; \boldsymbol{\mathbf{\gamma}} + \varepsilon_i, \quad f(\boldsymbol{\mathbf{x}}_i) = \sum_{t=1}^T x_{it}\theta_t,   \tag{2}\]</span>
where <span class="math inline">\(\boldsymbol{\mathbf{z}}_i\)</span>, <span class="math inline">\(\boldsymbol{\mathbf{\gamma}}\)</span> and
<span class="math inline">\(\varepsilon_i\)</span> are as defined above, and <span class="math inline">\(f\)</span> is a distributed lag
function parameterized by <span class="math inline">\(\theta_t\)</span> representing the linear effect of
exposure at time <span class="math inline">\(t\)</span>. The time-series design can also be modeled using
this format, and we discuss the data processing needed to convert
time-series data to this format in
Section <a href="#sec:dataprep" data-reference-type="ref" data-reference="sec:dataprep">4.2</a>.</p>
<p>The estimation of <span class="math inline">\(\theta_t\)</span> for <span class="math inline">\(t = 1, \ldots, T\)</span> in
<a href="#eq:eqnDLM">(2)</a>
requires an appropriate temporal structure, such as a smooth or
piecewise-smooth constraint on <span class="math inline">\(\theta_t\)</span>, to account for
autocorrelation within the exposure measurements. <span class="citation" data-cites="mork_estimating_2023">Mork and Wilson (<a href="#ref-mork_estimating_2023" role="doc-biblioref">2023</a>)</span>
introduced a regression tree-structure, shown in Figure
<a href="#fig:dlmtree" data-reference-type="ref" data-reference="fig:dlmtree">1</a>,
referred to as a DLM tree.</p>
<figure id="fig:dlmtree">
<img src="images/dlmtree.png" style="width:50mm" alt="Figure 1: A DLM tree, \mathcal{T}. A binary tree splits the time span into non-overlapping intervals, here resulting in three terminal nodes representing three time segments (gray nodes). Each terminal node is assigned a constant effect (gray dashed lines)." />
<figcaption aria-hidden="true">Figure 1: A DLM tree, <span class="math inline">\(\mathcal{T}\)</span>. A binary tree splits the time
span into non-overlapping intervals, here resulting in three terminal
nodes representing three time segments (gray nodes). Each terminal node
is assigned a constant effect (gray dashed
lines).</figcaption>
</figure>
<p>A DLM tree, denoted <span class="math inline">\(\mathcal{T}\)</span>, is a binary tree that splits the
exposure time span into non-overlapping segments. We denote the terminal
nodes of <span class="math inline">\(\mathcal{T}\)</span> as <span class="math inline">\(\lambda_c\)</span> for <span class="math inline">\(c = 1, \ldots, C\)</span> where <span class="math inline">\(C\)</span>
is the total number of terminal nodes. Each terminal node of the DLM
tree is assigned a scalar parameter <span class="math inline">\(\delta_c\)</span> that represents the
effect of the time lags contained in that terminal node. We denote a set
of scalar parameters of the DLM tree <span class="math inline">\(\mathcal{T}\)</span> as
<span class="math inline">\(\mathcal{D} = \{\delta_1, \ldots, \delta_C\}\)</span>. A DLM tree defines a
function of a time lag,
<span class="math display" id="eq:eqng1">\[g(t | \mathcal{T}, \mathcal{D}) = \delta_c \quad \text{ if } t \in \lambda_c.
    \label{eqn:g1}   \tag{3}\]</span></p>
<p>The treed distributed lag model (TDLM) is a tree structured DLM in its
simplest form and is a Bayesian additive model that consists of an
ensemble of <span class="math inline">\(A\)</span> DLM trees, indexed as <span class="math inline">\(\mathcal{T}_a\)</span>, with a
corresponding set of scalar parameters <span class="math inline">\(\mathcal{D}_{a}\)</span> for
<span class="math inline">\(a = 1, \dots, A\)</span>. TDLM defines <span class="math inline">\(\theta_t\)</span> in
<a href="#eq:eqnDLM">(2)</a> as
<span class="math display" id="eq:eqnTDLM">\[\label{eqn:TDLM}
    \theta_{t} = \sum^A_{a = 1} g(t|\mathcal{T}_{a}, \mathcal{D}_{a}).   \tag{4}\]</span>
The representation of the DLM tree ensemble provides several advantages.
Each DLM tree provides a temporal structure on the
exposure-time-response function with data-driven learning of the change
points and time spans related to the outcome. The ensemble structure
allows for flexibility to approximate smoothness in the
exposure-time-response function as each DLM tree in the ensemble splits
the time span differently.</p>
<h4 class="unnumbered" data-number="2.2" id="sec:treepair">DLM tree pair for lagged multivariate exposures</h4>
<p>A distributed lag mixture model extends the DLM framework to a
multivariate exposure (also referred to as mixture exposures in the
environmental literature) assessed longitudinally. For mixture exposures
with <span class="math inline">\(M \geq 2\)</span> exposures, we denote the vector of longitudinally
assessed measurements of the <span class="math inline">\(m^{\text{th}}\)</span> exposure, for
<span class="math inline">\(m = 1, \dots, M\)</span>, as
<span class="math inline">\(\boldsymbol{\mathbf{x}}_{im} =(x_{im1}, \dots, x_{imT})\)</span>. The
exposure-time-response function <span class="math inline">\(f(\boldsymbol{\mathbf{x}}_i)\)</span> in
<a href="#eq:eqnDLM">(2)</a> is
replaced with a mixture-exposure-time-response function that
incorporates the main effect of each exposure and the pairwise lagged
interaction effects between exposures. The
mixture-exposure-time-response function is
<span class="math display" id="eq:eqnDLMM">\[\label{eqn:DLMM}
    f(\boldsymbol{\mathbf{x}}_{i1}, \ldots, \boldsymbol{\mathbf{x}}_{iM}) = \sum^M_{m = 1} \sum^T_{t = 1} x_{imt}\theta_{mt} +\sum^{M}_{m_1 = 1}\sum^M_{m_2 = m_1} \sum^T_{t_1 = 1}\sum^T_{t_2 = 1} x_{im_1t_1}x_{im_2t_2}\theta_{m_1m_2t_1t_2},   \tag{5}\]</span>
where <span class="math inline">\(\theta_{mt}\)</span> is a main effect of exposure <span class="math inline">\(m\)</span> at time <span class="math inline">\(t\)</span> and
<span class="math inline">\(\theta_{m_1m_2t_1t_2}\)</span> is an interaction effect of exposure <span class="math inline">\(m_1\)</span> at
time <span class="math inline">\(t_1\)</span> and exposure <span class="math inline">\(m_2\)</span> at time <span class="math inline">\(t_2\)</span>.</p>
<p>Estimating the function in <a href="#eq:eqnDLMM">(5)</a>
is challenging due to autocorrelation across repeated exposure
measurements, correlation at the same time lag between exposures, and a
high-dimensional parameter space. <span class="citation" data-cites="mork_estimating_2023">Mork and Wilson (<a href="#ref-mork_estimating_2023" role="doc-biblioref">2023</a>)</span> introduced the
treed distributed lag mixture model (TDLMM) that structures the
parameters in <a href="#eq:eqnDLMM">(5)</a> using a DLM tree pair. Figure
<a href="#fig:dlmtreepair" data-reference-type="ref" data-reference="fig:dlmtreepair">2</a>
illustrates a single DLM tree pair, denoted
<span class="math inline">\(\{\mathcal{T}_1, \mathcal{T}_2, \mathcal{T}_1 \times \mathcal{T}_2\}\)</span>
with corresponding parameters sets
<span class="math inline">\(\{\mathcal{D}_1, \mathcal{D}_2, \Omega\}\)</span>, where <span class="math inline">\(\mathcal{D}_1\)</span> and
<span class="math inline">\(\mathcal{D}_2\)</span> represent the scalar main effects for <span class="math inline">\(\mathcal{T}_1\)</span>
and <span class="math inline">\(\mathcal{T}_2\)</span>, respectively, and <span class="math inline">\(\Omega\)</span> contains the scalar
interaction effects for interaction surface, denoted
<span class="math inline">\(\mathcal{T}_1 \times \mathcal{T}_2\)</span>.</p>
<figure id="fig:dlmtreepair">
<img src="images/dlmtreepair.png" style="width:90.0%" alt="graphic without alt text" />
<figcaption>Figure 2: A DLM tree pair. Two DLM trees split the time span of the
assigned exposure into non-overlapping intervals, here resulting in
three time segments for exposure <span class="math inline">\(m_1\)</span> and four time segments for
exposure <span class="math inline">\(m_2\)</span> (colored nodes). Each terminal node is assigned a scalar
parameter that represents a constant effect of the assigned exposure
(colored dashed lines). The interaction surface is fully defined by two
DLM trees and each combination of time segments is assigned a scalar
parameter (color-shaded
boxes).</figcaption>
</figure>
<p>Each DLM tree in the pair is associated with one component of the
mixture exposures. Similar to the DLM tree described above, each DLM
tree in the pair partitions the time span of its assigned component.
Each DLM tree in a tree pair is defined similarly to
<a href="#eq:eqng1">(3)</a> such
that
<span class="math display" id="eq:eqng2">\[\label{eqn:g2}
    g(t|\mathcal{T}_{p}, \mathcal{D}_{p}) = \delta_{pc} \quad \text{ if } t \in \lambda_{pc}, \quad p = 1, 2.   \tag{6}\]</span></p>
<p>The DLM tree pair structure allows for an interaction surface to model
lagged interactions between exposures. The interaction surface
<span class="math inline">\(\mathcal{T}_1 \times \mathcal{T}_2\)</span> shown in the middle of Figure
<a href="#fig:dlmtreepair" data-reference-type="ref" data-reference="fig:dlmtreepair">2</a>,
is fully defined by the two DLM trees in a pair. Each time interval of
the first DLM tree is paired with every interval of the second DLM tree.
Each combination is assigned a scalar parameter <span class="math inline">\(\omega_{c_1c_2}\)</span> that
represents the lagged interaction effect where <span class="math inline">\(c_1\)</span> and <span class="math inline">\(c_2\)</span> are
indices for terminal nodes of the first and second DLM tree,
respectively. The interaction surface of a DLM tree pair defines a
function
<span class="math display" id="eq:eqng-I">\[\label{eqn:g_I}
    g_I(t_1, t_2| \mathcal{T}_{1} \times \mathcal{T}_{2}, \Omega) = \omega_{c_1c_2} \quad \text{if } t_1 \in \lambda_{c_1}, t_2 \in \lambda_{c_2}.   \tag{7}\]</span>
A DLM tree pair with an interaction surface provides a structure to
regularize the exposure-time-response function for two components and
their lagged interaction effects.</p>
<p>TDLMM employs an ensemble representation of <span class="math inline">\(A\)</span> DLM tree pairs denoted
<span class="math inline">\(\{\mathcal{T}_{a1}, \mathcal{T}_{a2}, \mathcal{T}_{a1} \times \mathcal{T}_{a2}\}\)</span>
with the corresponding set of scalar parameters
<span class="math inline">\(\{\mathcal{D}_{a1}, \mathcal{D}_{a2}, \Omega_a \}\)</span>, using the
formulation in <a href="#eq:eqng2">(6)</a> and <a href="#eq:eqng-I">(7)</a>. Each DLM tree <span class="math inline">\(\mathcal{T}_{ap}\)</span> is also
associated with exposure <span class="math inline">\(m\)</span>, indicated by <span class="math inline">\(S_{ap} = m\)</span>. With TDLMM, the
main effect of exposure <span class="math inline">\(m\)</span> at time <span class="math inline">\(t\)</span> in <a href="#eq:eqnDLMM">(5)</a> is
<span class="math display" id="eq:eqnTDLMMmain">\[\label{eqn:TDLMMmain}
    \theta_{mt} = \sum^A_{a = 1} \sum^2_{p=1} g(t| \mathcal{T}_{ap}, \mathcal{D}_{ap}) \mathbb{I}(S_{ap} = m).   \tag{8}\]</span>
The pairwise interaction effect between exposure <span class="math inline">\(m_1\)</span> at time <span class="math inline">\(t_1\)</span> and
exposure <span class="math inline">\(m_2\)</span> at time <span class="math inline">\(t_2\)</span> in <a href="#eq:eqnDLMM">(5)</a>
is
<span class="math display" id="eq:eqnTDLMMint">\[\label{eqn:TDLMMint}
    \theta_{m_1m_2t_1t_2} = \sum^A_{a=1}g_I(t_1, t_2| \mathcal{T}_{a1} \times \mathcal{T}_{a2}, \Omega_a) \mathbb{I}(S_{a1} = m_1, S_{a2} = m_2).   \tag{9}\]</span>
TDLMM has three representations depending on different assumptions of
lagged interactions between exposures. The simplest form, TDLMMadd,
assumes <span class="math inline">\(\theta_{m_1m_2t_1t_2} = 0\)</span> in
<a href="#eq:eqnDLMM">(5)</a>,
implying no interaction between exposures, resulting in an additive
model of the main effects of exposures. The second form, TDLMMns,
accounts for lagged interaction between exposures but not within
exposures. The last, TDLMMall, allows for all lagged interactions
between and within exposures, implying a nonlinear effect of exposure.</p>
<h4 class="unnumbered" data-number="2.3" id="sec:nonlinear">Extensions to nonlinear exposure-time-response functions</h4>
<p><span class="citation" data-cites="mork_treed_2022">Mork and Wilson (<a href="#ref-mork_treed_2022" role="doc-biblioref">2022</a>)</span> introduced the treed distributed lag nonlinear
model (TDLNM) to estimate the nonlinear association between a single
longitudinally assessed exposure and an outcome. The DLM tree, as shown
in <a href="#eq:eqng1">(3)</a>,
assumes a linear association between exposure at each time point and the
outcome. To relax the linearity assumption for a distributed lag
nonlinear model framework, TDLNM modifies the DLM tree to additionally
split exposure concentration levels along with the exposure time span,
partitioning the bi-dimensional space of exposure concentration and time
lags. <span class="citation" data-cites="mork_monotone_2024">Mork and Wilson (<a href="#ref-mork_monotone_2024" role="doc-biblioref">2024</a>)</span> further extended TDLNM to include a
monotonicity assumption, where the exposure-response is constrained to
be non-decreasing at each time point. See <span class="citation" data-cites="mork_treed_2022">Mork and Wilson (<a href="#ref-mork_treed_2022" role="doc-biblioref">2022</a>)</span> and <span class="citation" data-cites="mork_monotone_2024">Mork and Wilson (<a href="#ref-mork_monotone_2024" role="doc-biblioref">2024</a>)</span>
for details.</p>
<h4 class="unnumbered" data-number="2.4" id="sec:glm">Extensions to generalized linear models</h4>
<p>In various applications of DLMs, the response variables may be binary or counts. Examples of binary outcomes include the occurrence of conditions such as asthma or preterm birth, and an example of a count-valued outcome is the daily number of deaths in a county. The linear representation of the DLM framework allows the tree structured DLMs to extend to the generalized linear model setting. TDLM, TDLNM, and TDLMM have been extended to incorporate binary response variables via logistic regression <span class="citation" data-cites="mork_treed_2022 mork_estimating_2023">(<a href="#ref-mork_treed_2022" role="doc-biblioref">Mork and Wilson 2022</a>, <a href="#ref-mork_estimating_2023" role="doc-biblioref">2023</a>)</span>. Further extensions on these models allow for count data via negative binomial regression, including an option for zero-inflated negative binomial data. The extensions to binary and count data rely on a framework based on the Pólya-Gamma data augmentation approach <span class="citation" data-cites="polson_bayesian_2013 neelon_bayesian_2019">(<a href="#ref-polson_bayesian_2013" role="doc-biblioref">Polson et al. 2013</a>; <a href="#ref-neelon_bayesian_2019" role="doc-biblioref">Neelon 2019</a>)</span>.</p>
<h4 class="unnumbered" data-number="2.5" id="sec:het">Extensions to heterogeneous models</h4>
<p>Another extension to the DLM framework is to assume heterogeneous
exposure effects. The exposure effects may be heterogeneous due to a
single modifying factor or a set of factors. For example, the impact of
prenatal exposure to air pollution may be governed by genetic factors
such as fetal sex <span class="citation" data-cites="rosa_association_2019">(<a href="#ref-rosa_association_2019" role="doc-biblioref">Rosa et al. 2019</a>)</span>. The set of factors, referred to as
modifiers, may be continuous, categorical, or ordinal. The general
approach is to introduce an additional tree, known as a modifier tree,
that partitions the modifier space and has a DLM tree or a DLM tree pair
affixed to each terminal node.</p>
<figure id="fig:nesttree">
<img src="images/nestedtree.png" style="width:100mm" alt="Figure 3: A nested tree structure for heterogeneous tree structured DLMs. The top tree is a modifier tree that is applied to candidate modifiers, here resulting in three subgroups. DLM trees are affixed to the terminal nodes of a modifier tree to estimate the exposure-time-response relationship specific to the subgroups." />
<figcaption aria-hidden="true">Figure 3: A nested tree structure for heterogeneous tree structured
DLMs. The top tree is a modifier tree that is applied to candidate
modifiers, here resulting in three subgroups. DLM trees are affixed to
the terminal nodes of a modifier tree to estimate the
exposure-time-response relationship specific to the
subgroups.</figcaption>
</figure>
<p><span class="citation" data-cites="mork_heterogeneous_2023">Mork et al. (<a href="#ref-mork_heterogeneous_2023" role="doc-biblioref">2024</a>)</span> extended TDLM to the heterogeneous distributed lag
model (HDLM) by introducing a nested tree structure, as shown in Figure
<a href="#fig:nesttree" data-reference-type="ref" data-reference="fig:nesttree">3</a>. In a
nested tree, a modifier tree is applied to a set of candidate modifiers,
defining mutually exclusive subgroups of the sample at each terminal
node. A DLM tree is then attached to each terminal node of the modifier
tree to define subgroup-specific effects with unique parameters for each
subgroup. Other extensions include a heterogeneous distributed lag
mixture model (HDLMM) that extends TDLMM to incorporate heterogeneity
based on a set of multiple candidate modifiers using an ensemble of tree
triplet structures.</p>
<h3 data-number="3" id="sec:imp"><span class="header-section-number">3</span> Implementation</h3>
<p>The tree structured DLMs are classified with three main criteria: 1)
linear or nonlinear exposure-time-response function, 2) one lagged
component or a mixture of more than one lagged component, and 3)
homogeneous or heterogeneous exposure-time-response relationship. Figure
<a href="#fig:decisiontree" data-reference-type="ref" data-reference="fig:decisiontree">4</a> illustrates a decision tree as a guide to
choosing an appropriate tree structured DLM.</p>
<figure id="fig:decisiontree">
<img src="images/decisiontree.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 4: A decision tree for choosing tree structured DLMs. The
bullet points below the models list the data types of response variables
that each model can
incorporate.</figcaption>
</figure>
<p>The <a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a> package
offers tree structured DLMs shown in Figure
<a href="#fig:decisiontree" data-reference-type="ref" data-reference="fig:decisiontree">4</a>. A main function <code>dlmtree</code> is designed to
fit various tree structured DLMs, offering customizable analysis through
its arguments. The function <code>dlmtree</code> with its main arguments is as
follows.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dlmtree</span>(formula, data, exposure.data, family, dlm.type, mixture, het)</span></code></pre></div>
<p>The function requires a formula specifying an outcome and covariates for
the fixed effect, a data source, the data type of response variable, and
three arguments for model specification. The data for the <code>formula</code>,
including covariates and the outcome, are provided as an (<span class="math inline">\(n\times p\)</span>)
data frame in the <code>data</code> argument. The exposures are not specified in
the <code>formula</code> and are not needed in the <code>data</code> argument. Rather, the
exposure data is specified separately as an <span class="math inline">\((n \times T)\)</span> matrix of
exposure measurements or a list of <span class="math inline">\((n \times T)\)</span> matrices of exposure
measurements in the <code>exposure.data</code> argument.</p>
<div id="tab:dlmtreefit">
<table style="width:98%;">
<caption><span id="tab:T2">Table 2: </span> Arguments for <code>dlmtree</code> function</caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 71%" />
<col style="width: 2%" />
<col style="width: 2%" />
<col style="width: 2%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Argument</th>
<th style="text-align: left;">Description</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>formula</code></td>
<td style="text-align: left;">Object of class <code>formula</code> for the fixed effect</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>data</code></td>
<td style="text-align: left;">A data frame containing covariates and an outcome used in <code>formula</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>exposure.data</code></td>
<td style="text-align: left;">A numerical matrix of exposure data with the same length as data.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">For a mixture setting, a named list containing equally sized numerical</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">matrices of exposure data having the same length as the data</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>family</code></td>
<td style="text-align: left;"><code>gaussian</code> for a continuous response, <code>logit</code> for binomial, <code>zinb</code> for</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">count data</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>dlm.type</code></td>
<td style="text-align: left;">DLM type specification: <code>linear</code>, <code>nonlinear</code>, <code>monotone</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>mixture</code></td>
<td style="text-align: left;">logical; A flag for mixture exposures if <code>TRUE</code></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>het</code></td>
<td style="text-align: left;">logical; A flag for heterogeneity if <code>TRUE</code></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Table <a href="#tab:dlmtreefit" data-reference-type="ref" data-reference="tab:dlmtreefit">2</a> provides descriptions of the arguments. All
tree structured DLMs allow for continuous response variables, while
TDLM, TDLNM, and TDLMM additionally allow for binary and count-valued
response variables. Additional parameters, omitted here, include MCMC
sampling parameters, the number of trees in the ensemble, effect
shrinkage, sparsity parameters for exposure and modifier selection, and
model-specific hyperparameters. These parameters can be fine-tuned and
passed as a list to the corresponding <code>control</code> helper functions, each
suffixed with its purpose (e.g., <code>control.mcmc</code>, <code>control.hyper</code>).</p>
<p>A fitted model is assigned a class, determined by the model-specifying
arguments. The classes are: <code>tdlm</code>, <code>tdlmm</code>, <code>tdlnm</code>, <code>hdlm</code>, and
<code>hdlmm</code>. Each class uses an S3 object oriented system with <code>summary</code>
method. The <code>summary</code> method returns the model information, estimates
and credible intervals for the fixed effects and lag effects, and time
points of a significant effect, where the 95% credible intervals of the
lag effects do not contain zero (in some applications this is referred
to as critical window) of the exposure or mixture exposures. The <code>plot</code>
method on the summary object further returns the visualization of the
estimated main exposure effects (and interaction effects if applicable)
with 95% credible intervals. Additionally for classes of models with
heterogeneity: <code>hdlm</code> and <code>hdlmm</code>, the <code>shiny</code> method is built for
various types of statistical inference. The
<a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a> app interface
provides tools for identifying important modifiers and their splitting
points that contribute to heterogeneity. It also includes features for
evaluating personalized exposure effects with a set of user-specified
modifiers, and exposure effects specific to a subgroup defined by a set
of modifiers of interest.</p>
<h3 data-number="4" id="example-usage"><span class="header-section-number">4</span> Example usage</h3>
<p>We illustrate the example usage of tree structured DLMs through a set of
vignettes based on simulated data. We demonstrate data preparation and
the model fitting process for TDLM, TDLMM, HDLM, and HDLMM. An example
of fitting TDLNM is provided in the supplementary material.</p>
<h4 class="unnumbered" data-number="4.1" id="simulated-dataset">Simulated dataset</h4>
<p>We use the simulated dataset <code>sbd_dlmtree</code>, which is publicly available
in the <a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a> package
GitHub repository. The dataset contains 10,000 simulated mother-child
dyads with descriptions of maternal and birth information. The maternal
covariates include maternal age, height, prior weight, prior body mass
index (BMI), race, Hispanic designation, education attainment, smoking
habits, marital status, and yearly income. Additionally, the birth
information includes birth weight for gestational age z-scores (BWGAZ),
gestational age, sex of a child, and estimated date of conception. The
dataset contains five environmental chemicals measured at 37 weeks
preceding the birth for each dyad: fine particulate matter (PM<sub>2.5</sub>),
temperature, sulfur dioxide (SO<sub>2</sub>), carbon monoxide (CO), and nitrogen
dioxide (NO<sub>2</sub>). Each exposure measurement is scaled by its
interquartile range value. The dataset is constructed to have realistic
distributions and correlations of the covariates and exposures. It
contains a complex exposure-response relationship that includes
interactions and heterogeneous effects.</p>
<p>In the following examples, we examine the distributed lag effects of
maternal exposure to the environmental mixtures during the 37 weeks of
gestation on BWGAZ. The results provided in the example usage are solely
for demonstrative purposes of the model fitting process using the model
parameters and simulated data and do not represent any actual findings.</p>
<h4 class="unnumbered" data-number="4.2" id="sec:dataprep">Data preparation for model fitting</h4>
<p>We first load the required packages:
<a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a> and
<a href="https://CRAN.R-project.org/package=dplyr"><strong>dplyr</strong></a>. We used
<a href="https://CRAN.R-project.org/package=dplyr"><strong>dplyr</strong></a> for a better
presentation of the data processing. We set the seed for reproducibility
and load the external dataset <code>sbd_dlmtree</code> from
<a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a> package
repository using an embedded function <code>get_sbd_dlmtree</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries and seed</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dlmtree)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Download data as &#39;sbd&#39;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>sbd <span class="ot">&lt;-</span> <span class="fu">get_sbd_dlmtree</span>()</span></code></pre></div>
<p>The data frame <code>sbd</code> has a lagged format where each row has columns of
lagged measurements of each exposure (e.g. wide format data). Often,
datasets have a time-series format, which contains a single column of
dates and multiple columns of corresponding measurements of response
variables and exposures on that specific date only. This is particularly
common in time-series studies, whereas the wide format data is more
common in cohort studies. The model fitting function <code>dlmtree</code> is
designed to use a data frame in a wide format; hence, a data frame with
a time-series format must be pivoted to a wide format. An example data
frame of time-series format and a function for data pivoting are
provided in the supplementary materials. In addition to the wide format,
the software in this package requires that all individuals and all
exposures (for multi-exposure models) have the same number of exposure
time points.</p>
<p>To prepare the birth data in <code>sbd</code> for model fitting, we create a data
frame including the covariates and the response variable, BWGAZ. We note
that the categorical columns in the dataset are of class <code>factor</code>. We
consider five components for exposure data: PM<sub>2.5</sub>, temperature, SO<sub>2</sub>,
CO, and NO<sub>2</sub>, and store them as a list of exposure matrices with a size
of <span class="math inline">\((\text{10,000} \times 37)\)</span>. Each matrix is already in wide format,
where rows represent observations and columns represent exposure
measurements at different lags.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Response and covariates</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sbd_cov <span class="ot">&lt;-</span> sbd <span class="sc">%&gt;%</span> <span class="fu">select</span>(bwgaz, ChildSex, MomAge, GestAge, MomPriorBMI, Race,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                          Hispanic, MomEdu, SmkAny, Marital, Income,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                          EstDateConcept, EstMonthConcept, EstYearConcept)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Exposure data</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>sbd_exp <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">PM25 =</span> sbd <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;pm25_&quot;</span>)),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">TEMP =</span> sbd <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;temp_&quot;</span>)),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">SO2 =</span> sbd <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;so2_&quot;</span>)),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">CO =</span> sbd <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;co_&quot;</span>)),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">NO2 =</span> sbd <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;no2_&quot;</span>)))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>sbd_exp <span class="ot">&lt;-</span> sbd_exp <span class="sc">%&gt;%</span> <span class="fu">lapply</span>(as.matrix)</span></code></pre></div>
<p>Each matrix of the exposure data list can be centered and scaled with
caution to different interpretations of the resulting estimates.
Specifically, when using the TDLMM with lagged interaction, it is
crucial to avoid centering the exposure data as it can lead to an
inaccurate estimate of the marginal exposure effect when considering
co-exposures.</p>
<h4 class="unnumbered" data-number="4.3" id="ex_tdlm">TDLM: Estimating linear relationship between an outcome and a single exposure</h4>
<h5 class="unnumbered" data-number="4.3.1" id="model-fitting-and-summary">Model fitting and summary</h5>
<p>We first assume that we are interested in the linear association between
BWGAZ and weekly exposure to PM<sub>2.5</sub> during the first 37 gestational
weeks. We include the following covariates to control for fixed effects:
child sex, maternal age, BMI, race, Hispanic designation, smoking
habits, and month of conception. We fit TDLM with the following code.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tdlm.fit <span class="ot">&lt;-</span> <span class="fu">dlmtree</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> bwgaz <span class="sc">~</span> ChildSex <span class="sc">+</span> MomAge <span class="sc">+</span> MomPriorBMI <span class="sc">+</span> Race <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                        Hispanic <span class="sc">+</span> SmkAny <span class="sc">+</span> EstMonthConcept,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sbd_cov,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure.data =</span> sbd_exp[[<span class="st">&quot;PM25&quot;</span>]], <span class="co"># A single numeric matrix</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dlm.type =</span> <span class="st">&quot;linear&quot;</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.mcmc =</span> <span class="fu">list</span>(<span class="at">n.burn =</span> <span class="dv">2500</span>, <span class="at">n.iter =</span> <span class="dv">10000</span>, <span class="at">n.thin =</span> <span class="dv">5</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The resulting fitted object of class <code>tdlm</code> has attributes of the fitted
model information and posterior samples of parameters of interest. The
<code>summary</code> method applied to the object <code>tdlm.fit</code> returns a clear
overview of the model fit. The summary of the model is obtained with the
following code.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>tdlm.sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(tdlm.fit)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tdlm.sum)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>TDLM summary</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>Model run info<span class="sc">:</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> bwgaz <span class="sc">~</span> ChildSex <span class="sc">+</span> MomAge <span class="sc">+</span> MomPriorBMI <span class="sc">+</span> Race <span class="sc">+</span> Hispanic <span class="sc">+</span> SmkAny <span class="sc">+</span> EstMonthConcept</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> sample size<span class="sc">:</span> <span class="dv">10</span>,<span class="dv">000</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> family<span class="sc">:</span> gaussian</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">20</span> trees</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">2500</span> burn<span class="sc">-</span><span class="cf">in</span> iterations</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">10000</span> post<span class="sc">-</span>burn iterations</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">5</span> thinning factor</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> exposure measured at <span class="dv">37</span> time points</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="fl">0.95</span> confidence level</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>Fixed effect coefficients<span class="sc">:</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                       Mean  Lower  Upper</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>(Intercept)          <span class="fl">2.289</span>  <span class="fl">2.032</span>  <span class="fl">2.542</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>ChildSexM           <span class="sc">-</span><span class="fl">2.105</span> <span class="sc">-</span><span class="fl">2.126</span> <span class="sc">-</span><span class="fl">2.085</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>MomAge                <span class="fl">0.000</span> <span class="sc">-</span><span class="fl">0.001</span>  <span class="fl">0.002</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>MomPriorBMI         <span class="sc">-</span><span class="fl">0.021</span> <span class="sc">-</span><span class="fl">0.022</span> <span class="sc">-</span><span class="fl">0.019</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>RaceAsianPI           <span class="fl">0.069</span> <span class="sc">-</span><span class="fl">0.057</span>  <span class="fl">0.192</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>RaceBlack             <span class="fl">0.078</span> <span class="sc">-</span><span class="fl">0.050</span>  <span class="fl">0.205</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>Racewhite             <span class="fl">0.059</span> <span class="sc">-</span><span class="fl">0.060</span>  <span class="fl">0.181</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>HispanicNonHispanic  <span class="fl">0.255</span>  <span class="fl">0.233</span>  <span class="fl">0.278</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>SmkAnyY             <span class="sc">-</span><span class="fl">0.403</span> <span class="sc">-</span><span class="fl">0.451</span> <span class="sc">-</span><span class="fl">0.356</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>EstMonthConcept2     <span class="sc">-</span><span class="fl">0.049</span> <span class="sc">-</span><span class="fl">0.109</span>  <span class="fl">0.010</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept3    <span class="sc">-</span><span class="fl">0.145</span> <span class="sc">-</span><span class="fl">0.211</span> <span class="sc">-</span><span class="fl">0.077</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept4    <span class="sc">-</span><span class="fl">0.230</span> <span class="sc">-</span><span class="fl">0.295</span> <span class="sc">-</span><span class="fl">0.160</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept5    <span class="sc">-</span><span class="fl">0.207</span> <span class="sc">-</span><span class="fl">0.265</span> <span class="sc">-</span><span class="fl">0.147</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept6    <span class="sc">-</span><span class="fl">0.205</span> <span class="sc">-</span><span class="fl">0.260</span> <span class="sc">-</span><span class="fl">0.153</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>EstMonthConcept7     <span class="sc">-</span><span class="fl">0.032</span> <span class="sc">-</span><span class="fl">0.083</span>  <span class="fl">0.023</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept8     <span class="fl">0.145</span>  <span class="fl">0.081</span>  <span class="fl">0.210</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept9     <span class="fl">0.393</span>  <span class="fl">0.326</span>  <span class="fl">0.460</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept10    <span class="fl">0.372</span>  <span class="fl">0.311</span>  <span class="fl">0.437</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept11    <span class="fl">0.330</span>  <span class="fl">0.271</span>  <span class="fl">0.387</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept12    <span class="fl">0.129</span>  <span class="fl">0.078</span>  <span class="fl">0.181</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="er">*</span> <span class="er">=</span> CI does not contain zero</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>DLM effect<span class="sc">:</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>range <span class="ot">=</span> [<span class="sc">-</span><span class="fl">0.019</span>, <span class="fl">0.008</span>]</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>signal<span class="sc">-</span>to<span class="sc">-</span>noise <span class="ot">=</span> <span class="fl">0.021</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>critical windows<span class="sc">:</span> <span class="dv">11-20</span>,<span class="dv">36-37</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>             Mean  Lower  Upper</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">1</span>    <span class="fl">0.003</span> <span class="sc">-</span><span class="fl">0.005</span>  <span class="fl">0.015</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">2</span>    <span class="fl">0.000</span> <span class="sc">-</span><span class="fl">0.006</span>  <span class="fl">0.010</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">3</span>   <span class="sc">-</span><span class="fl">0.002</span> <span class="sc">-</span><span class="fl">0.010</span>  <span class="fl">0.004</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">4</span>   <span class="sc">-</span><span class="fl">0.002</span> <span class="sc">-</span><span class="fl">0.010</span>  <span class="fl">0.003</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">5</span>   <span class="sc">-</span><span class="fl">0.001</span> <span class="sc">-</span><span class="fl">0.007</span>  <span class="fl">0.004</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">6</span>   <span class="sc">-</span><span class="fl">0.001</span> <span class="sc">-</span><span class="fl">0.006</span>  <span class="fl">0.005</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">7</span>   <span class="sc">-</span><span class="fl">0.001</span> <span class="sc">-</span><span class="fl">0.006</span>  <span class="fl">0.006</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">8</span>   <span class="sc">-</span><span class="fl">0.001</span> <span class="sc">-</span><span class="fl">0.008</span>  <span class="fl">0.004</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">9</span>   <span class="sc">-</span><span class="fl">0.002</span> <span class="sc">-</span><span class="fl">0.011</span>  <span class="fl">0.003</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">10</span>  <span class="sc">-</span><span class="fl">0.002</span> <span class="sc">-</span><span class="fl">0.012</span>  <span class="fl">0.006</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">11</span> <span class="sc">-</span><span class="fl">0.016</span> <span class="sc">-</span><span class="fl">0.024</span> <span class="sc">-</span><span class="fl">0.007</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">12</span> <span class="sc">-</span><span class="fl">0.017</span> <span class="sc">-</span><span class="fl">0.024</span> <span class="sc">-</span><span class="fl">0.010</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">13</span> <span class="sc">-</span><span class="fl">0.017</span> <span class="sc">-</span><span class="fl">0.024</span> <span class="sc">-</span><span class="fl">0.012</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">14</span> <span class="sc">-</span><span class="fl">0.017</span> <span class="sc">-</span><span class="fl">0.022</span> <span class="sc">-</span><span class="fl">0.010</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">15</span> <span class="sc">-</span><span class="fl">0.017</span> <span class="sc">-</span><span class="fl">0.022</span> <span class="sc">-</span><span class="fl">0.011</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">16</span> <span class="sc">-</span><span class="fl">0.017</span> <span class="sc">-</span><span class="fl">0.022</span> <span class="sc">-</span><span class="fl">0.011</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">17</span> <span class="sc">-</span><span class="fl">0.017</span> <span class="sc">-</span><span class="fl">0.024</span> <span class="sc">-</span><span class="fl">0.011</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">18</span> <span class="sc">-</span><span class="fl">0.019</span> <span class="sc">-</span><span class="fl">0.030</span> <span class="sc">-</span><span class="fl">0.013</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">19</span> <span class="sc">-</span><span class="fl">0.018</span> <span class="sc">-</span><span class="fl">0.027</span> <span class="sc">-</span><span class="fl">0.011</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">20</span> <span class="sc">-</span><span class="fl">0.015</span> <span class="sc">-</span><span class="fl">0.024</span> <span class="sc">-</span><span class="fl">0.003</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">21</span>  <span class="sc">-</span><span class="fl">0.007</span> <span class="sc">-</span><span class="fl">0.019</span>  <span class="fl">0.002</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">22</span>  <span class="sc">-</span><span class="fl">0.002</span> <span class="sc">-</span><span class="fl">0.010</span>  <span class="fl">0.006</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">23</span>  <span class="sc">-</span><span class="fl">0.003</span> <span class="sc">-</span><span class="fl">0.012</span>  <span class="fl">0.003</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">24</span>  <span class="sc">-</span><span class="fl">0.002</span> <span class="sc">-</span><span class="fl">0.008</span>  <span class="fl">0.004</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">25</span>   <span class="fl">0.000</span> <span class="sc">-</span><span class="fl">0.005</span>  <span class="fl">0.006</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">26</span>   <span class="fl">0.000</span> <span class="sc">-</span><span class="fl">0.005</span>  <span class="fl">0.006</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">27</span>  <span class="sc">-</span><span class="fl">0.001</span> <span class="sc">-</span><span class="fl">0.005</span>  <span class="fl">0.005</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">28</span>  <span class="sc">-</span><span class="fl">0.001</span> <span class="sc">-</span><span class="fl">0.006</span>  <span class="fl">0.004</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">29</span>  <span class="sc">-</span><span class="fl">0.001</span> <span class="sc">-</span><span class="fl">0.007</span>  <span class="fl">0.004</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">30</span>  <span class="sc">-</span><span class="fl">0.002</span> <span class="sc">-</span><span class="fl">0.008</span>  <span class="fl">0.003</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">31</span>  <span class="sc">-</span><span class="fl">0.002</span> <span class="sc">-</span><span class="fl">0.008</span>  <span class="fl">0.004</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">32</span>  <span class="sc">-</span><span class="fl">0.001</span> <span class="sc">-</span><span class="fl">0.008</span>  <span class="fl">0.005</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">33</span>   <span class="fl">0.002</span> <span class="sc">-</span><span class="fl">0.004</span>  <span class="fl">0.010</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">34</span>   <span class="fl">0.004</span> <span class="sc">-</span><span class="fl">0.003</span>  <span class="fl">0.012</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>Period <span class="dv">35</span>   <span class="fl">0.006</span> <span class="sc">-</span><span class="fl">0.001</span>  <span class="fl">0.014</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">36</span>  <span class="fl">0.008</span>  <span class="fl">0.000</span>  <span class="fl">0.017</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>Period <span class="dv">37</span>  <span class="fl">0.008</span>  <span class="fl">0.000</span>  <span class="fl">0.019</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="er">*</span> <span class="er">=</span> CI does not contain zero</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>residual standard errors<span class="sc">:</span> <span class="fl">0.004</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span></code></pre></div>
<p>The summary output first presents a section <code>Model run info</code> with the
model fitting information including the formula, sample size, data type
of the response variable, number of trees in the ensemble, MCMC
parameters, number of lags, and a confidence level. The next section,
<code>Fixed effect coefficients</code>, shows the estimates with credible intervals
for the regression coefficients of the covariates. Lastly, the summary
output returns <code>DLM effect</code> section including the range of DLM effects,
signal-to-noise ratio, and estimated lagged effects with credible
intervals. Each lag is marked with an asterisk if it is identified as a
critical window based on a pointwise 0.95 probability credible interval.
In context, TDLM estimated a negative association between BWGAZ and
PM<sub>2.5</sub> with gestational weeks 11–20 as critical windows.</p>
<p>The cumulative effect of the exposure is defined as the effect of a one
unit increment of the exposure across all time points. The following
code returns the estimated cumulative effect with its 95% credible
interval from an attribute <code>cumulative.effect</code> of the summary object
<code>tdlm.sum</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tdlm.sum<span class="sc">$</span>cumulative.effect</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>      mean       <span class="fl">2.5</span><span class="sc">%      97.5%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">0.1738753</span> <span class="sc">-</span><span class="fl">0.2124918</span> <span class="sc">-</span><span class="fl">0.1367665</span></span></code></pre></div>
<p>In this context, TDLM estimates that a unit increment of exposure to
PM<sub>2.5</sub> across all gestational weeks has a cumulative exposure effect of
-0.17 (95% CrI: <span class="math display">\[-0.21, -0.14\]</span>) on BWGAZ.</p>
<h5 class="unnumbered" data-number="4.3.2" id="visualizing-exposure-effects">Visualizing exposure effects</h5>
<p>For a more intuitive view of the overall trend of the distributed lag
effects, the <code>plot</code> method may be applied to the summary object
<code>tdlm.sum</code> to visualize the effect estimates as the following.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tdlm.sum, <span class="at">main =</span> <span class="st">&quot;Estimated effect of PM2.5&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Effect&quot;</span>)</span></code></pre></div>
<figure id="fig:tdlm">
<img src="images/TDLM_pm.png" style="width:130mm" alt="Figure 5: Estimated distributed lag effects of PM2.5 on BWGAZ during 37 gestational weeks, using TDLM. These results are based on simulated data." />
<figcaption aria-hidden="true">Figure 5: Estimated distributed lag effects of PM<sub>2.5</sub> on BWGAZ during
37 gestational weeks, using TDLM. These results are based on simulated
data.</figcaption>
</figure>
<p>Figure <a href="#fig:tdlm" data-reference-type="ref" data-reference="fig:tdlm">5</a> shows
the plot of the estimated exposure effect of PM<sub>2.5</sub> in the simulated
dataset where the x-axis is the lags (or weeks) and the y-axis is the
estimated exposure effect. The gray area showing the 95% credible
intervals of exposure effects during weeks 11–20 does not cover the red
line of a null effect, which indicates a critical window. The <code>plot</code>
method also includes additional arguments of <code>main</code>, <code>xlab</code>, and <code>ylab</code>
for customizing the main title, x-axis, and y-axis label. For a
customized plot, the estimated values can be obtained from the
attributes of the summary object <code>tdlm.sum</code>: <code>matfit</code>, <code>cilower</code>, and
<code>ciupper</code>.</p>
<h4 class="unnumbered" data-number="4.4" id="ex_tdlmm">TDLMM: Analyzing linear relationship between an outcome and multiple exposures</h4>
<h5 class="unnumbered" data-number="4.4.1" id="model-fitting-with-pairwise-lagged-interactions">Model fitting with pairwise lagged interactions</h5>
<p>Suppose we are interested in the linear association between BWGAZ and
mixture exposures of five exposures: PM<sub>2.5</sub>, temperature, SO<sub>2</sub>, CO,
and NO<sub>2</sub>. We are mainly interested in the marginal effects of each
exposure on BWGAZ, the pairwise lagged interactions between exposures,
and which exposures are most correlated with BWGAZ. Here, we use all
five exposures to illustrate the flexibility and capability of our
package to handle multiple exposures. In practice, users should
carefully determine the number of exposures included in the model by
considering the complexity of the model relative to the number of
observations and the expected signal-to-noise ratio. The key differences
between the code for the model for multiple exposures below and the code
for the previous single exposure model are that the <code>exposure.data</code> is
provided with a list of matrices of five different exposures and we
specify <code>mixture = TRUE</code>. The code is as follows.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tdlmm.fit <span class="ot">&lt;-</span> <span class="fu">dlmtree</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> bwgaz <span class="sc">~</span> ChildSex <span class="sc">+</span> MomAge <span class="sc">+</span> MomPriorBMI <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                        Race <span class="sc">+</span> Hispanic <span class="sc">+</span> SmkAny <span class="sc">+</span> EstMonthConcept,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sbd_cov,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure.data =</span> sbd_exp,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dlm.type =</span> <span class="st">&quot;linear&quot;</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mixture =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.mix =</span> <span class="fu">list</span>(<span class="at">interactions =</span> <span class="st">&quot;noself&quot;</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.mcmc =</span> <span class="fu">list</span>(<span class="at">n.burn =</span> <span class="dv">2500</span>, <span class="at">n.iter =</span> <span class="dv">10000</span>, <span class="at">n.thin =</span> <span class="dv">5</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The model assumption regarding lagged interaction can be additionally
specified for the TDLMM fitting with <code>interactions</code> argument within
<code>control.mix</code>. The options include no interaction (<code>none</code>), no-self
interactions (<code>noself</code>), and all interactions (<code>all</code>). We use TDLMM with
no-self lagged interaction, which is the default argument.</p>
<h5 class="unnumbered" data-number="4.4.2" id="model-summary-accounting-for-co-exposures">Model summary accounting for co-exposures</h5>
<p>The <code>summary</code> method can be applied to the fitted object <code>tdlmm.fit</code>. As
TDLMM allows for pairwise lagged interaction between mixture exposures,
the estimated exposure effect for each exposure varies with the levels
of the co-exposures. The <code>summary</code> method on class <code>tdlmm</code> offers
additional control argument <code>marginalize</code> to address this. The argument
<code>marginalize</code> requires a fixed level used for co-exposure
marginalization. The default is the empirical means of co-exposures,
which provides the distributed lag function for a single exposure
estimated when all other exposures are fixed at their means. This is
equivalent to integrating out all co-exposures. The following code
returns the summary of the <code>tdlmm.fit</code> with marginalization using the
empirical means of co-exposures.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Marginalization with co-exposure fixed at the empirical means</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>tdlmm.sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(tdlmm.fit, <span class="at">marginalize =</span> <span class="st">&quot;mean&quot;</span>)</span></code></pre></div>
<p>Other marginalization options are available for conducting different
types of inferences. The second option is to specify a number between 0
and 100, representing a percentile of the co-exposures that will be used
for marginalization. The following code returns the summary of the
<code>tdlmm.fit</code> with marginalization fixing all co-exposures at their 25th
percentile values.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Marginalization with co-exposure fixed at 25th percentile</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>tdlmm.sum.percentile <span class="ot">&lt;-</span> <span class="fu">summary</span>(tdlmm.fit, <span class="at">marginalize =</span> <span class="dv">25</span>)</span></code></pre></div>
<p>The last option is to specify the exact levels of co-exposures. This
option requires the argument <code>marginalize</code> to be a numeric vector of the
same length as the number of exposures used for the model fitting. The
specified values in the vector must also follow the order of the
exposures in the fitted model. This method of marginalization offers
flexibility as these exposure levels can be specified based on
pre-informed levels using existing data or to address hypothetical
questions. For example, the following code can be used to obtain the
marginal exposure effect of PM<sub>2.5</sub> when temperature, SO<sub>2</sub>, CO, and
NO<sub>2</sub> are all fixed to 1. The marginalized effects of other exposures
are calculated in a similar manner.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Marginalization with co-exposure fixed at exact levels for each exposure</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>tdlmm.sum.level <span class="ot">&lt;-</span> <span class="fu">summary</span>(tdlmm.fit, <span class="at">marginalize =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p>Below is the summary result of <code>tdlmm.sum</code> with the default argument
using empirical means.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tdlmm.sum)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>TDLMM summary</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>Model run info<span class="sc">:</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> bwgaz <span class="sc">~</span> ChildSex <span class="sc">+</span> MomAge <span class="sc">+</span> MomPriorBMI <span class="sc">+</span> Race <span class="sc">+</span> Hispanic <span class="sc">+</span> SmkAny <span class="sc">+</span> EstMonthConcept</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> sample size<span class="sc">:</span> <span class="dv">10</span>,<span class="dv">000</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> family<span class="sc">:</span> gaussian</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">20</span> <span class="fu">trees</span> (<span class="at">alpha =</span> <span class="fl">0.95</span>, <span class="at">beta =</span> <span class="dv">2</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">2500</span> burn<span class="sc">-</span><span class="cf">in</span> iterations</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">10000</span> post<span class="sc">-</span>burn iterations</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">5</span> thinning factor</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">5</span> exposures measured at <span class="dv">37</span> time points</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">10</span> two<span class="sc">-</span>way <span class="fu">interactions</span> (no<span class="sc">-</span>self interactions)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">1</span> kappa sparsity prior</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="fl">0.95</span> confidence level</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>Fixed effects<span class="sc">:</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                       Mean  Lower  Upper</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>(Intercept)          <span class="fl">0.172</span>  <span class="fl">0.043</span>  <span class="fl">0.307</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>ChildSexM           <span class="sc">-</span><span class="fl">2.063</span> <span class="sc">-</span><span class="fl">2.085</span> <span class="sc">-</span><span class="fl">2.041</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a> MomAge               <span class="fl">0.001</span> <span class="sc">-</span><span class="fl">0.001</span>  <span class="fl">0.002</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>MomPriorBMI         <span class="sc">-</span><span class="fl">0.020</span> <span class="sc">-</span><span class="fl">0.022</span> <span class="sc">-</span><span class="fl">0.019</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a> RaceAsianPI          <span class="fl">0.027</span> <span class="sc">-</span><span class="fl">0.058</span>  <span class="fl">0.117</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a> RaceBlack            <span class="fl">0.033</span> <span class="sc">-</span><span class="fl">0.063</span>  <span class="fl">0.124</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a> Racewhite            <span class="fl">0.016</span> <span class="sc">-</span><span class="fl">0.067</span>  <span class="fl">0.100</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>HispanicNonHispanic  <span class="fl">0.248</span>  <span class="fl">0.224</span>  <span class="fl">0.272</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>SmkAnyY             <span class="sc">-</span><span class="fl">0.393</span> <span class="sc">-</span><span class="fl">0.441</span> <span class="sc">-</span><span class="fl">0.346</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a> EstMonthConcept2     <span class="fl">0.073</span> <span class="sc">-</span><span class="fl">0.003</span>  <span class="fl">0.145</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept3     <span class="fl">0.107</span>  <span class="fl">0.009</span>  <span class="fl">0.211</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept4     <span class="fl">0.158</span>  <span class="fl">0.038</span>  <span class="fl">0.282</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept5     <span class="fl">0.255</span>  <span class="fl">0.126</span>  <span class="fl">0.388</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept6     <span class="fl">0.200</span>  <span class="fl">0.064</span>  <span class="fl">0.333</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept7     <span class="fl">0.223</span>  <span class="fl">0.084</span>  <span class="fl">0.354</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept8     <span class="fl">0.199</span>  <span class="fl">0.068</span>  <span class="fl">0.331</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept9     <span class="fl">0.291</span>  <span class="fl">0.164</span>  <span class="fl">0.418</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept10    <span class="fl">0.182</span>  <span class="fl">0.070</span>  <span class="fl">0.296</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept11    <span class="fl">0.135</span>  <span class="fl">0.040</span>  <span class="fl">0.236</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a> EstMonthConcept12    <span class="fl">0.006</span> <span class="sc">-</span><span class="fl">0.062</span>  <span class="fl">0.077</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="er">*</span> <span class="er">=</span> CI does not contain zero</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>Exposure effects<span class="sc">:</span> critical windows</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> <span class="er">=</span> Exposure selected by Bayes Factor</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>(x.xx) <span class="ot">=</span> Relative effect size</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a> <span class="sc">*</span><span class="fu">PM25</span> (<span class="fl">0.7</span>)<span class="sc">:</span> <span class="dv">11-20</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a> <span class="sc">*</span><span class="fu">TEMP</span> (<span class="fl">0.7</span>)<span class="sc">:</span> <span class="dv">5-19</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a> <span class="sc">*</span><span class="fu">SO2</span> (<span class="fl">0.21</span>)<span class="sc">:</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a> <span class="er">*</span><span class="fu">CO</span> (<span class="fl">0.63</span>)<span class="sc">:</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a> <span class="er">*</span><span class="fu">NO2</span> (<span class="fl">0.26</span>)<span class="sc">:</span> <span class="dv">23</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>Interaction effects<span class="sc">:</span> critical windows</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a> PM25<span class="sc">/</span><span class="fu">TEMP</span> (<span class="fl">0.8</span>)<span class="sc">:</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a> <span class="dv">12</span><span class="sc">/</span><span class="dv">6-19</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a> <span class="dv">13</span><span class="sc">/</span><span class="dv">6-19</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a> <span class="dv">14</span><span class="sc">/</span><span class="dv">6-20</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a> <span class="dv">15</span><span class="sc">/</span><span class="dv">6-20</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a> <span class="dv">16</span><span class="sc">/</span><span class="dv">6-20</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a> <span class="dv">17</span><span class="sc">/</span><span class="dv">6-21</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a> <span class="dv">18</span><span class="sc">/</span><span class="dv">5-22</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a> <span class="dv">19</span><span class="sc">/</span><span class="dv">5-22</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a> <span class="dv">20</span><span class="sc">/</span><span class="dv">6-21</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>residual standard errors<span class="sc">:</span> <span class="fl">0.005</span></span></code></pre></div>
<p>The summary output of the TDLMM fit contains similar information to that
of the TDLM. The <code>Model run info</code> section in the output includes
additional information specific to mixture exposures: the number of
exposures included in the model, the number of pairwise interactions,
and a sparsity parameter for exposure selection. The summary output does
not include the lagged effects for each exposure to prevent overwhelming
the output with excessive information. The summary presents the critical
window of the marginal effects of each exposure with the relative effect
size, indicating the effect size of exposure relative to that of other
exposures. The summary also returns the critical window of lagged
interaction effects with relative effect size. In our context, all five
exposures are considered to be significantly associated with BWGAZ,
based on a Bayes factor threshold of 0.5. The TDLMM estimated
gestational weeks 11–20, 5–19, and 23 as critical windows of PM<sub>2.5</sub>,
temperature, and NO<sub>2</sub>, respectively. The model fit also identified
significant PM<sub>2.5</sub>–temperature lagged interaction effects.</p>
<h5 class="unnumbered" data-number="4.4.3" id="additional-statistical-inferences-using-tdlmm">Additional statistical inferences using TDLMM</h5>
<p>More useful statistical inferences are possible with <code>tdlmm.fit</code> and
<code>tdlmm.sum</code>. First, a function <code>adj_coexposure</code> can be used to obtain
the marginalized exposure effect while accounting for the expected
change in co-exposures. In comparison to using the argument
<code>marginalize</code> in <code>summary</code> method, the function <code>adj_coexposure</code> uses a
spline-based method to predict the expected changes in co-exposures
corresponding with a pre-defined change in an exposure of interest and
calculates the marginalized effects of the primary exposure with
co-exposure at the predicted levels. The following code shows an example
usage of the function with its output omitted.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower and upper exposure levels specified as 25th and 75th percentiles</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>tdlmm.coexp <span class="ot">&lt;-</span> <span class="fu">adj_coexposure</span>(sbd_exp, tdlmm.fit, <span class="at">contrast_perc =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))</span></code></pre></div>
<p>The function requires exposure data, the model fit of class <code>tdlmm</code>, and
an argument <code>contrast_perc</code> which can be specified with a vector of two
percentiles used for co-exposure prediction. Another argument
<code>contrast_exp</code> is available for specifying exact exposure levels for
each exposure.</p>
<p>Second, the marginal cumulative effect of each exposure can be obtained
with the summary object <code>tdlmm.sum</code>. The object has a list attribute
<code>DLM</code>, which contains estimates of marginal exposure effect and
cumulative effect with their credible intervals. These estimated effects
correspond to the argument <code>marginalize</code> specified within <code>summary</code>
method. The code below returns the estimates of the cumulative effect of
PM<sub>2.5</sub>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tdlmm.sum<span class="sc">$</span>DLM<span class="sc">$</span>PM25<span class="sc">$</span>cumulative</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>mean</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">0.3790024</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>ci.lower</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      <span class="fl">2.5</span>%</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">0.5318544</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>ci.upper</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>     <span class="fl">97.5</span>%</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">0.2305391</span></span></code></pre></div>
<p>PM<sub>2.5</sub> can be replaced with other exposures if desired, e.g.,
<code>tdlmm.sum$DLM$TEMP$cumulative</code> for temperature. In this context, the
TDLMM estimates that the marginal cumulative effect of a unit increase
of PM<sub>2.5</sub> across all gestational weeks is -0.38 (95% CrI: <span class="math display">\[-0.53,
-0.23\]</span>).</p>
<h5 class="unnumbered" data-number="4.4.4" id="visualizing-main-exposure-effects-and-lagged-interaction-effects">Visualizing main exposure effects and lagged interaction effects</h5>
<p>The <code>plot</code> method on the summary object <code>tdlmm.sum</code> requires a single
exposure or a pair of exposures. The <code>plot</code> method returns the marginal
effect of an exposure when specified with a single exposure. For
instance, for the three exposures, PM<sub>2.5</sub>, temperature, and NO<sub>2</sub>, we
can use the following code.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(tdlmm.sum, <span class="at">exposure1 =</span> <span class="st">&quot;PM25&quot;</span>, <span class="at">main =</span> <span class="st">&quot;PM2.5&quot;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(tdlmm.sum, <span class="at">exposure1 =</span> <span class="st">&quot;TEMP&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Temperature&quot;</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">plot</span>(tdlmm.sum, <span class="at">exposure1 =</span> <span class="st">&quot;NO2&quot;</span>, <span class="at">main =</span> <span class="st">&quot;NO2&quot;</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<figure id="fig:tdlmm_main">
<img src="images/TDLMM_main.png" style="width:140mm" alt="Figure 6: Estimated marginal distributed lag effects of PM2.5, temperature, and NO2 on BWGAZ during 37 gestational weeks, using TDLMM. These results are based on simulated data." />
<figcaption aria-hidden="true">Figure 6: Estimated marginal distributed lag effects of PM<sub>2.5</sub>,
temperature, and NO<sub>2</sub> on BWGAZ during 37 gestational weeks, using
TDLMM. These results are based on simulated
data.</figcaption>
</figure>
<p>The <code>plot</code> method with arguments of two exposures visualizes an
interaction surface of two specified exposures. The following code plots
an estimated pairwise interaction surface of two specified exposures:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tdlmm.sum, <span class="at">exposure1 =</span> <span class="st">&quot;PM25&quot;</span>, <span class="at">exposure2 =</span> <span class="st">&quot;TEMP&quot;</span>)</span></code></pre></div>
<figure id="fig:tdlmm_int">
<img src="images/TDLMM_int.png" style="width:120mm" alt="Figure 7: Estimated lagged interaction effects between PM2.5 and temperature, using TDLMM. These results are based on simulated data." />
<figcaption aria-hidden="true">Figure 7: Estimated lagged interaction effects between PM<sub>2.5</sub> and
temperature, using TDLMM. These results are based on simulated
data.</figcaption>
</figure>
<p>Figure <a href="#fig:tdlmm_int" data-reference-type="ref" data-reference="fig:tdlmm_int">7</a> shows the estimated interaction surface
between PM<sub>2.5</sub> and temperature in the simulated data, estimated with
TDLMM. The gradient colors on the grid indicate the estimated
interaction effects where the x-axis is the exposure time span of
PM<sub>2.5</sub> and the y-axis is that of temperature. The red dots indicate
that the credible interval of the effect does not contain zero, with
larger dots indicating a higher probability of non-null effect. Figure
<a href="#fig:tdlmm_int" data-reference-type="ref" data-reference="fig:tdlmm_int">7</a>
indicates significant negative interaction effects at weeks 12–20 of
PM<sub>2.5</sub> and 6–19 weeks of temperature at 95% confidence level, implying
that increased exposure to PM<sub>2.5</sub> may decrease the exposure effect of
temperature, and vice versa.</p>
<h4 class="unnumbered" data-number="4.5" id="het_fit">HDLM &amp; HDLMM: Introducing heterogeneity to distributed lag effects</h4>
<p>We illustrate heterogeneous models for a single exposure (HDLM) and for
a mixture exposure (HDLMM) for estimating heterogeneous exposure
effects. We focus our demonstration on a
<a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a> interface built
for HDLM and HDLMM for examining the most significant modifying factors,
the personalized exposure effects, and the subgroup-specific exposure
effects.</p>
<h5 class="unnumbered" data-number="4.5.1" id="model-fitting-and-summary-with-selected-modifiers">Model fitting and summary with selected modifiers</h5>
<p>Suppose we are interested in the linear association between BWGAZ and a
single exposure PM<sub>2.5</sub>. We additionally assume that the exposure effect
of PM<sub>2.5</sub> may be modified by child sex, maternal age, BMI, and smoking
habits across the population. Specifically, to fit heterogeneous models,
additional arguments can be passed to <code>control.het</code> as a list. An
argument <code>modifiers</code> can be set to a vector of modifier names. These
modifiers must be included in the data frame provided to the <code>data</code>
argument (<code>sbd_cov</code> in this example). By default, the argument is set to
include all covariates included in the <code>formula</code> argument as modifiers.
Also, the possible number of splitting points of modifiers for
heterogeneity can be specified with an integer argument
<code>modifier.splits</code> to manage the computational cost. We specify
<code>het = TRUE</code> to fit the HDLM with the following code.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>hdlm.fit <span class="ot">&lt;-</span> <span class="fu">dlmtree</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> bwgaz <span class="sc">~</span> ChildSex <span class="sc">+</span> MomAge <span class="sc">+</span> MomPriorBMI <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                        Race <span class="sc">+</span> Hispanic <span class="sc">+</span> SmkAny <span class="sc">+</span> EstMonthConcept,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sbd_cov,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure.data =</span> sbd_exp[[<span class="st">&quot;PM25&quot;</span>]],</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dlm.type =</span> <span class="st">&quot;linear&quot;</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">het =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.het =</span> <span class="fu">list</span>(</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">modifiers =</span> <span class="fu">c</span>(<span class="st">&quot;ChildSex&quot;</span>, <span class="st">&quot;MomAge&quot;</span>, <span class="st">&quot;MomPriorBMI&quot;</span>, <span class="st">&quot;SmkAny&quot;</span>),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">modifier.splits =</span> <span class="dv">10</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.mcmc =</span> <span class="fu">list</span>(<span class="at">n.burn =</span> <span class="dv">2500</span>, <span class="at">n.iter =</span> <span class="dv">10000</span>, <span class="at">n.thin =</span> <span class="dv">5</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The <code>summary</code> method applied to the object <code>hdlm.fit</code> returns the
overview of the model fit. The following code returns the summary.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>hdlm.sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(hdlm.fit)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hdlm.sum)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>HDLM summary</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>Model run info<span class="sc">:</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> bwgaz <span class="sc">~</span> ChildSex <span class="sc">+</span> MomAge <span class="sc">+</span> MomPriorBMI <span class="sc">+</span> Race <span class="sc">+</span> Hispanic <span class="sc">+</span> SmkAny <span class="sc">+</span> EstMonthConcept</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> sample size<span class="sc">:</span> <span class="dv">10</span>,<span class="dv">000</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> family<span class="sc">:</span> gaussian</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">20</span> trees</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">2500</span> burn<span class="sc">-</span><span class="cf">in</span> iterations</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">10000</span> post<span class="sc">-</span>burn iterations</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="dv">5</span> thinning factor</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> exposure measured at <span class="dv">37</span> time points</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="fl">0.5</span> modifier sparsity prior</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="fl">0.95</span> confidence level</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>Fixed effects<span class="sc">:</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>                       Mean  Lower  Upper</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>(Intercept)          <span class="fl">1.272</span>  <span class="fl">0.914</span>  <span class="fl">1.629</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a> ChildSexM            <span class="fl">0.127</span> <span class="sc">-</span><span class="fl">0.302</span>  <span class="fl">0.566</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a> MomAge               <span class="fl">0.001</span> <span class="sc">-</span><span class="fl">0.002</span>  <span class="fl">0.004</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>MomPriorBMI         <span class="sc">-</span><span class="fl">0.021</span> <span class="sc">-</span><span class="fl">0.024</span> <span class="sc">-</span><span class="fl">0.018</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a> RaceAsianPI          <span class="fl">0.045</span> <span class="sc">-</span><span class="fl">0.074</span>  <span class="fl">0.171</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a> RaceBlack            <span class="fl">0.055</span> <span class="sc">-</span><span class="fl">0.070</span>  <span class="fl">0.182</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a> Racewhite            <span class="fl">0.034</span> <span class="sc">-</span><span class="fl">0.082</span>  <span class="fl">0.157</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>HispanicNonHispanic  <span class="fl">0.255</span>  <span class="fl">0.233</span>  <span class="fl">0.278</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>SmkAnyY             <span class="sc">-</span><span class="fl">0.406</span> <span class="sc">-</span><span class="fl">0.453</span> <span class="sc">-</span><span class="fl">0.359</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a> EstMonthConcept2    <span class="sc">-</span><span class="fl">0.050</span> <span class="sc">-</span><span class="fl">0.104</span>  <span class="fl">0.004</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept3    <span class="sc">-</span><span class="fl">0.129</span> <span class="sc">-</span><span class="fl">0.188</span> <span class="sc">-</span><span class="fl">0.070</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept4    <span class="sc">-</span><span class="fl">0.201</span> <span class="sc">-</span><span class="fl">0.265</span> <span class="sc">-</span><span class="fl">0.139</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept5    <span class="sc">-</span><span class="fl">0.195</span> <span class="sc">-</span><span class="fl">0.246</span> <span class="sc">-</span><span class="fl">0.144</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept6    <span class="sc">-</span><span class="fl">0.199</span> <span class="sc">-</span><span class="fl">0.249</span> <span class="sc">-</span><span class="fl">0.144</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a> EstMonthConcept7    <span class="sc">-</span><span class="fl">0.035</span> <span class="sc">-</span><span class="fl">0.087</span>  <span class="fl">0.019</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept8     <span class="fl">0.147</span>  <span class="fl">0.088</span>  <span class="fl">0.208</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept9     <span class="fl">0.395</span>  <span class="fl">0.331</span>  <span class="fl">0.455</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept10    <span class="fl">0.388</span>  <span class="fl">0.328</span>  <span class="fl">0.446</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept11    <span class="fl">0.343</span>  <span class="fl">0.290</span>  <span class="fl">0.397</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span>EstMonthConcept12    <span class="fl">0.141</span>  <span class="fl">0.091</span>  <span class="fl">0.190</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="er">*</span> <span class="er">=</span> CI does not contain zero</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>Modifiers<span class="sc">:</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>               PIP</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>ChildSex    <span class="fl">1.0000</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>MomAge      <span class="fl">0.6305</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>MomPriorBMI <span class="fl">0.9055</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>SmkAny      <span class="fl">0.0975</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>PIP <span class="ot">=</span> Posterior inclusion probability</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>residual standard errors<span class="sc">:</span> <span class="fl">0.004</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>To obtain exposure effect estimates, use the <span class="st">&#39;shiny(fit)&#39;</span> function.</span></code></pre></div>
<p>As before, the summary output includes <code>Model run info</code> and
<code>Fixed effects</code> sections with the estimates and the 95% credible
intervals of the regression coefficients of the fixed effect. The
summary additionally shows the sparsity hyperparameter set for modifier
selection and the posterior inclusion probability (PIP) of the modifiers
included in the model. The fitted HDLM identified child sex, maternal
age, and BMI to be the modifiers that contributed the most heterogeneity
to the exposure effect of PM<sub>2.5</sub>. It is important to note that a high
PIP does not necessarily indicate modification. Instead, it suggests
that their posterior should be examined to determine if any meaningful
modification is present.</p>
<p>A similar model fitting process can be done when examining the
heterogeneous exposure effect of a mixture of five exposures on BWGAZ.
The following code additionally specifies <code>mixture = TRUE</code> and fits
HDLMM with the same potential modifiers:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>hdlmm.fit <span class="ot">&lt;-</span> <span class="fu">dlmtree</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> bwgaz <span class="sc">~</span> ChildSex <span class="sc">+</span> MomAge <span class="sc">+</span> MomPriorBMI <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                        Race <span class="sc">+</span> Hispanic <span class="sc">+</span> SmkAny <span class="sc">+</span> EstMonthConcept,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sbd_cov,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure.data =</span> sbd_exp,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dlm.type =</span> <span class="st">&quot;linear&quot;</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mixture =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">het =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.het =</span> <span class="fu">list</span>(</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">modifiers =</span> <span class="fu">c</span>(<span class="st">&quot;ChildSex&quot;</span>, <span class="st">&quot;MomAge&quot;</span>, <span class="st">&quot;MomPriorBMI&quot;</span>, <span class="st">&quot;SmkAny&quot;</span>),</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">modifier.splits =</span> <span class="dv">10</span>),</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    control.mcmc <span class="ot">=</span> <span class="fu">list</span>(<span class="at">n.burn =</span> <span class="dv">2500</span>, <span class="at">n.iter =</span> <span class="dv">10000</span>, <span class="at">n.thin =</span> <span class="dv">5</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="er">)</span></span></code></pre></div>
<p>As previously, the <code>summary</code> method on <code>hdlmm</code> model object similarly
returns the summary of the fitted HDLMM. The summary output, omitted
here, is similar to that of HDLM, with additional information such as
the number of exposures, number of pairwise interactions, and sparsity
parameters for modifier selection and exposure selection. Unlike the
<code>summary</code> method applied to the model of class <code>tdlmm</code> in Section
<a href="#ex_tdlmm" data-reference-type="ref" data-reference="ex_tdlmm">4.4</a>,
marginalization methods are unavailable for the fitted model <code>hdlmm.fit</code>
as the marginalization of co-exposure with heterogeneity is not well
defined.</p>
<h5 class="unnumbered" data-number="4.5.2" id="shiny">Using shiny app to investigate heterogeneous distributed lag effects</h5>
<p>Exposure effects are estimated at the individual level and can be
summarized at either the individual or subgroup level. This flexibility
makes summarizing and visualizing the estimated effects challenging. A
built-in <a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a> app with
an object of class <code>hdlm</code> and <code>hdlmm</code> provides a comprehensive analysis
of the exposure effects. HDLM and HDLMM share the same
<a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a> interface but the
<code>shiny</code> method applied to class <code>hdlmm</code> additionally includes an option
in the panel to select an exposure of interest from mixture exposures.
We present the <a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a> app
interface using the fitted HDLM for a single exposure, using the same
argument specification for fitting the model <code>hdlmm.fit</code>. The
<a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a> app is launched
with the following code.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shiny</span>(hdlm.fit)</span></code></pre></div>
<figure id="fig:hdlm_shiny">
<img src="images/HDLM_Shiny1.png" style="width:90.0%" alt="graphic without alt text" />
<figcaption>Figure 8: Example of R
<a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a> user interface for
the fitted HDLM. The displayed results are based on simulated
data.</figcaption>
</figure>
<p>Figure <a href="#fig:hdlm_shiny" data-reference-type="ref" data-reference="fig:hdlm_shiny">8</a> shows the main screen, also the first tab,
of the <a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a> app for the
fitted HDLM. The <a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a>
interface includes three tabs. The first tab labeled ‘Modifier’ presents
two panels including a bar plot of modifier PIPs and the proportions of
split points of a user-selected continuous modifier used to split the
internal nodes of modifier trees.</p>
<p>In the ‘Individual’ tab, the user can adjust the levels of modifiers to
obtain the individualized estimate of the distributed lag effects. In
our context, the <a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a>
app provides the personalized exposure effect and critical windows when
the sex of a child, age, BMI, and smoking habits of a mother are
specified. Figure <a href="#fig:hdlm_shiny2" data-reference-type="ref" data-reference="fig:hdlm_shiny2">9</a> shows the estimated personalized exposure
effect of PM<sub>2.5</sub> during gestational weeks for a 29-year-old mother with
a BMI of 24, whose child is male and who does not smoke.</p>
<figure id="fig:hdlm_shiny2">
<img src="images/HDLM_Shiny2.png" style="width:90.0%" alt="graphic without alt text" />
<figcaption>Figure 9: Example of estimated personalized exposure effect in R
<a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a> app. The displayed
results are based on simulated
data.</figcaption>
</figure>
<p>The last tab labeled ‘Subgroup’ offers subgroup-specific analyses. In
the top panel, shown in Figure
<a href="#fig:hdlm_shiny3" data-reference-type="ref" data-reference="fig:hdlm_shiny3">10</a>, the user can select one or two modifiers
to group the samples into multiple subgroups and obtain personalized
exposure effects for individuals in each subgroup. Each line of the
resulting plot represents an exposure effect of an individual accounting
for all modifiers of that individual. This is useful for simultaneously
assessing how much exposure effects vary among individuals and across
subgroups.</p>
<figure id="fig:hdlm_shiny3">
<img src="images/HDLM_Shiny3.png" style="width:90.0%" alt="graphic without alt text" />
<figcaption>Figure 10: Example of estimated personalized exposure effects with
subgroups in R <a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a>
app. The displayed results are based on simulated
data.</figcaption>
</figure>
<p>The bottom panel allows users to select one or two modifiers for
subgroup-specific distributed lag effects. Subgroup-specific distributed
lag effects are calculated by marginalizing out the modifiers not
specified in the panel. Two modifiers at most can be specified for
analyzing how much each modifier affects heterogeneity in the exposure
effects. For example, Figure <a href="#fig:hdlm_shiny4" data-reference-type="ref" data-reference="fig:hdlm_shiny4">11</a> shows the estimated exposure-time-response
function for four subgroups, grouped by two categorical modifiers: child
sex and smoking habit. The difference in subgroup-specific exposure
effects indicates that smoking habit does not contribute much
heterogeneity in the exposure effect of PM<sub>2.5</sub>, while child sex
introduces a considerable amount, which aligns with the modifier PIPs in
the summary output. Using the simulated dataset, the subgroup-specific
effects suggest that mothers with a male child may be more vulnerable to
PM<sub>2.5</sub>.</p>
<figure id="fig:hdlm_shiny4">
<img src="images/HDLM_Shiny4.png" style="width:82.0%" alt="graphic without alt text" />
<figcaption>Figure 11: Example of estimated subgroup-specific effects, grouped by
child sex and maternal smoking status, in R
<a href="https://CRAN.R-project.org/package=shiny"><strong>shiny</strong></a> app. These results
are based on simulated data.</figcaption>
</figure>
<h3 data-number="5" id="sec:practical"><span class="header-section-number">5</span> Practical considerations</h3>
<p>R package <a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a>
offers highly flexible and integrative models for analyzing the effects
of repeatedly measured exposures. The package allows user specification
for adjusting the flexibility of the exposure-lag-response relationship,
number of exposures, types of lagged interaction terms, modifiers, and
MCMC simulation control. We highlight important considerations and best
practices when using the package to obtain reliable results.</p>
<p>The models included in
<a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a> are very
flexible and highly parametric. It is, therefore, important to be
mindful of whether such a complex model is relevant to a research
question. Factors that increase model complexity are: increased number
of time points the exposure is assessed at, more unique exposures and
allowing for additional interactions between or within exposures across
time, and including heterogeneity and the number of candidate modifiers.
The BART framework and shrinkage and selection priors are effective at
regularizing these models. However, more complex models can still result
in increased variance, identifiability issues where the model becomes
sensitive to model specification, and challenges in interpretation.
Therefore, we recommend users employ standard best practices in model
building, such as carefully assessing what should be included in the
model, considering pre-selection of exposures or combining related
exposures into a single index, aggregating exposure measurements to a
coarser time interval, being mindful of extreme multicollinearity, and
conducting sensitivity analyses with simpler models where possible.</p>
<p>When running heterogeneous distributed lag models, potentially important
modifiers can be identified using the PIP. When the number of modifiers
is small relative to the number of trees, all modifiers will have a
higher baseline PIP. Additionally, a large PIP does not necessarily
imply meaningful effect modification, and the posterior distribution of
the exposure-response function should be explored to better identify
important modifiers. Related to model complexity, when two or more
modifiers are highly correlated, one or both may be identified as
driving heterogeneity. Therefore, considering the mechanisms of effect
modification is essential when selecting modifiers and interpreting
results.</p>
<p>For practical implementation, we recommend running longer MCMC chains
than are used in the examples in this paper. While the examples
presented use short iterations for demonstration, longer chains are
necessary for stable estimates and to improve mixing and convergence.
Given the high dimensionality of the tree structured DLMs, a longer
chain will sample more reliable full posterior distributions for
inference. Additionally, for logistic and negative binomial models,
longer burn-in periods are important to ensure convergence. For example,
in our previous large data analyses with this software <span class="citation" data-cites="mork_estimating_2023 mork_heterogeneous_2023 mork_treed_2022">(<a href="#ref-mork_treed_2022" role="doc-biblioref">Mork and Wilson 2022</a>, <a href="#ref-mork_estimating_2023" role="doc-biblioref">2023</a>; <a href="#ref-mork_heterogeneous_2023" role="doc-biblioref">Mork et al. 2024</a>)</span> we have used upwards of 10,000 burn-in
iterations.</p>
<p>Convergence can be assessed in several ways. We have relied on trace
plots, which graph the chain of posterior draws for key parameters. When
possible, another approach is to run multiple Markov chains with
different seeds and compare results across chains. To help users assess
model convergence and identify potential issues with mixing, our package
provides a <code>diagnose</code> S3 method for model summary objects which returns
a comprehensive convergence diagnostics panel customized for the treed
DLM framework. It provides an overview of key outputs including trace
plots and posterior density plots of distributed lag effects,
Metropolis-Hastings acceptance rate for tree updates, and changes in
tree sizes throughout MCMC sampling. The example usage of <code>diagnose</code> is
demonstrated in the supplementary materials.</p>
<h3 data-number="6" id="summary"><span class="header-section-number">6</span> Summary</h3>
<p>We introduced the R package
<a href="https://CRAN.R-project.org/package=dlmtree"><strong>dlmtree</strong></a>, a
user-friendly software for addressing a wide range of research questions
regarding the relationship between a longitudinally assessed exposure or
mixture and a scalar outcome. Our software provides functionality to
estimate distributed lag linear or nonlinear models, quantify main and
interaction effects, and account for heterogeneity in the
exposure-time-response function. Furthermore, the methods in our package
have been carefully optimized for computational efficiency under a
custom C<code>++</code> language framework with a convenient R wrapper function,
<code>dlmtree</code>, designed for accessibility by all researchers. In this paper,
we provided an overview of the regression tree approaches used for
estimating DLMs, and through a collection of vignettes, we highlighted a
variety of tools available for processing data, fitting models,
conducting inference, and visualizing the results. Our goal in making
this package available is to bring robust data science tools to expand
the range of questions that can be asked and answered with
longitudinally assessed data.</p>
<h3 data-number="7" id="acknowledgements"><span class="header-section-number">7</span> Acknowledgements</h3>
<p>Research reported in this publication was supported by National
Institute of Environmental Health Sciences of the National Institutes of
Health under award numbers ES035735, ES029943, ES028811, AG066793, and
ES034021. The content is solely the responsibility of the authors and
does not necessarily represent the official views of the National
Institutes of Health.</p>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-chipman2010" class="csl-entry" role="listitem">
Chipman, Hugh A., Edward I. George, and Robert E. McCulloch. 2010.
“BART: Bayesian Additive Regression Trees.” <em>The Annals of Applied
Statistics</em> 4 (1): 266–98. <a href="https://doi.org/10.1214/09-AOAS285" class="uri">https://doi.org/10.1214/09-AOAS285</a>.
</div>
<div id="ref-chiu2023prenatal" class="csl-entry" role="listitem">
Chiu, Yueh-Hsiu M., Ander Wilson, Hsiao-Hsien L. Hsu, Harris Jamal,
Nicole Mathews, Itai Kloog, Joel Schwartz, et al. 2023. “Prenatal
Ambient Air Pollutant Mixture Exposure and Neurodevelopment in Urban
Children in the Northeastern United States.” <em>Environmental Research</em>
233: 116394. <a href="https://doi.org/j.envres.2023.116394" class="uri">https://doi.org/j.envres.2023.116394</a>.
</div>
<div id="ref-demateis_penalized_2024" class="csl-entry" role="listitem">
Demateis, Danielle, Kayleigh P. Keller, David Rojas-Rueda,
Marianthi-Anna Kioumourtzoglou, and Ander Wilson. 2024. “Penalized
Distributed Lag Interaction Model: Air Pollution, Birth Weight, and
Neighborhood Vulnerability.” <em>Environmetrics</em>, e2843.
<a href="https://doi.org/10.1002/env.2843" class="uri">https://doi.org/10.1002/env.2843</a>.
</div>
<div id="ref-dempsey2025bayesianvariableselectiondistributed" class="csl-entry" role="listitem">
Dempsey, Daniel, and Jason Wyse. 2025. “Bayesian Variable Selection in
Distributed Lag Models: A Focus on Binary Quantile and Count Data
Regressions.” <a href="https://arxiv.org/abs/2403.03646" class="uri">https://arxiv.org/abs/2403.03646</a>.
</div>
<div id="ref-gasparrini_dlnm_2013" class="csl-entry" role="listitem">
Gasparrini, A. 2011. “Distributed Lag Linear and Non-Linear Models in R:
The Package Dlnm.” <em>Journal of Statistical Software</em> 43 (8): 1–20.
<a href="https://doi.org/10.18637/jss.v043.i08" class="uri">https://doi.org/10.18637/jss.v043.i08</a>.
</div>
<div id="ref-gasparrini_distributed_2010" class="csl-entry" role="listitem">
Gasparrini, Antonio, Ben Armstrong, and Mike G. Kenward. 2010.
“Distributed Lag Non-Linear Models.” <em>Statistics in Medicine</em> 29 (21):
2224–34. <a href="https://doi.org/10.1002/sim.3940" class="uri">https://doi.org/10.1002/sim.3940</a>.
</div>
<div id="ref-hsu_prenatal_2023" class="csl-entry" role="listitem">
Hsu, Hsiao-Hsien L., Ander Wilson, Joel Schwartz, Itai Kloog, Robert O.
Wright, Brent A. Coull, and Rosalind J. Wright. 2023. “Prenatal Ambient
Air Pollutant Mixture Exposure and Early School-Age Lung Function.”
<em>Environmental Epidemiology</em> 7 (2): e249.
<a href="https://doi.org/10.1097/EE9.0000000000000249" class="uri">https://doi.org/10.1097/EE9.0000000000000249</a>.
</div>
<div id="ref-koyck_1954_econDLM" class="csl-entry" role="listitem">
Koyck, Leendert M. 1954. <em>Distributed Lags and Investment Analysis</em>.
Vol. 4. North-Holland Publishing Company Amsterdam.
</div>
<div id="ref-mork_heterogeneous_2023" class="csl-entry" role="listitem">
Mork, Daniel, Marianthi-Anna Kioumourtzoglou, Marc Weisskopf, Brent A.
Coull, and Ander Wilson. 2024. “Heterogeneous Distributed Lag Models to
Estimate Personalized Effects of Maternal Exposures to Air Pollution.”
<em>Journal of the American Statistical Association</em> 119 (545): 14–26.
<a href="https://doi.org/10.1080/01621459.2023.2258595" class="uri">https://doi.org/10.1080/01621459.2023.2258595</a>.
</div>
<div id="ref-mork_treed_2022" class="csl-entry" role="listitem">
Mork, Daniel, and Ander Wilson. 2022. “Treed Distributed Lag Nonlinear
Models.” <em>Biostatistics</em> 23 (3): 754–71.
<a href="https://doi.org/10.1093/biostatistics/kxaa051" class="uri">https://doi.org/10.1093/biostatistics/kxaa051</a>.
</div>
<div id="ref-mork_estimating_2023" class="csl-entry" role="listitem">
———. 2023. “Estimating Perinatal Critical Windows of
Susceptibility to Environmental Mixtures via Structured Bayesian
Regression Tree Pairs.” <em>Biometrics</em> 79 (1): 449–61.
<a href="https://doi.org/10.1111/biom.13568" class="uri">https://doi.org/10.1111/biom.13568</a>.
</div>
<div id="ref-mork_monotone_2024" class="csl-entry" role="listitem">
———. 2024. “Incorporating Prior Information into Distributed Lag
Nonlinear Models with Zero-Inflated Monotone Regression Trees.”
<em>Bayesian Analysis</em> 1 (1): 1–29. <a href="https://doi.org/10.1214/23-BA1412" class="uri">https://doi.org/10.1214/23-BA1412</a>.
</div>
<div id="ref-neelon_bayesian_2019" class="csl-entry" role="listitem">
Neelon, Brian. 2019. “Bayesian Zero-Inflated Negative Binomial
Regression Based on pólya-Gamma Mixtures.” <em>Bayesian Analysis</em> 14 (3):
829. <a href="https://doi.org/10.1214/18-ba1132" class="uri">https://doi.org/10.1214/18-ba1132</a>.
</div>
<div id="ref-palda_1965_advertise" class="csl-entry" role="listitem">
Palda, Kristian S. 1965. “The Measurement of Cumulative Advertising
Effects.” <em>The Journal of Business</em> 38 (2): 162–79.
</div>
<div id="ref-polson_bayesian_2013" class="csl-entry" role="listitem">
Polson, Nicholas G., James G. Scott, and Jesse Windle. 2013. “Bayesian
Inference for Logistic Models Using pólya–Gamma Latent Variables.”
<em>Journal of the American Statistical Association</em> 108 (504): 1339–49.
<a href="https://doi.org/10.1080/01621459.2013.829001" class="uri">https://doi.org/10.1080/01621459.2013.829001</a>.
</div>
<div id="ref-rosa_association_2019" class="csl-entry" role="listitem">
Rosa, Maria José, Hsiao-Hsien L. Hsu, Allan C. Just, Kasey J. Brennan,
Tessa Bloomquist, Itai Kloog, Ivan Pantic, et al. 2019. “Association
Between Prenatal Particulate Air Pollution Exposure and Telomere Length
in Cord Blood: Effect Modification by Fetal Sex.” <em>Environmental
Research</em> 172: 495–501. <a href="https://doi.org/10.1016/j.envres.2019.03.003" class="uri">https://doi.org/10.1016/j.envres.2019.03.003</a>.
</div>
<div id="ref-schliep_2021_wellness" class="csl-entry" role="listitem">
Schliep, Erin M., Toryn L. J. Schafer, and Matthew Hawkey. 2021.
“Distributed Lag Models to Identify the Cumulative Effects of Training
and Recovery in Athletes Using Multivariate Ordinal Wellness Data.”
<em>Journal of Quantitative Analysis in Sports</em> 17 (3): 241–54.
<a href="https://doi.org/10.1515/jqas-2020-0051" class="uri">https://doi.org/10.1515/jqas-2020-0051</a>.
</div>
<div id="ref-schwartz_distributed_2000" class="csl-entry" role="listitem">
Schwartz, Joel. 2000. “The Distributed Lag Between Air Pollution and
Daily Deaths.” <em>Epidemiology</em> 11 (3): 320–26.
<a href="https://doi.org/10.1097/00001648-200005000-00016" class="uri">https://doi.org/10.1097/00001648-200005000-00016</a>.
</div>
<div id="ref-warren_spatial-temporal_2012" class="csl-entry" role="listitem">
Warren, Joshua, Montserrat Fuentes, Amy Herring, and Peter Langlois.
2012. “Spatial-Temporal Modeling of the Association Between Air
Pollution Exposure and Preterm Birth: Identifying Critical Windows of
Exposure.” <em>Biometrics</em> 68 (4): 1157–67.
<a href="https://doi.org/10.1111/j.1541-0420.2012.01774.x" class="uri">https://doi.org/10.1111/j.1541-0420.2012.01774.x</a>.
</div>
<div id="ref-wilson_bayesian_2017" class="csl-entry" role="listitem">
Wilson, Ander, Yueh-Hsiu M. Chiu, Hsiao-Hsien L. Hsu, Robert O. Wright,
Rosalind J. Wright, and Brent A. Coull. 2017a. “Bayesian Distributed Lag
Interaction Models to Identify Perinatal Windows of Vulnerability in
Children’s Health.” <em>Biostatistics</em> 18 (3): 537–52.
<a href="https://doi.org/10.1093/biostatistics/kxx002" class="uri">https://doi.org/10.1093/biostatistics/kxx002</a>.
</div>
<div id="ref-wilson_2017_bias" class="csl-entry" role="listitem">
———. 2017b. “Potential for Bias When Estimating Critical Windows
for Air Pollution in Children’s Health.” <em>American Journal of
Epidemiology</em> 186 (11): 1281–89. <a href="https://doi.org/10.1093/aje/kwx184" class="uri">https://doi.org/10.1093/aje/kwx184</a>.
</div>
<div id="ref-zanobetti_generalized_2000" class="csl-entry" role="listitem">
Zanobetti, Antonella, Matt P. Wand, Joel Schwartz, and Louise M. Ryan.
2000. “Generalized Additive Distributed Lag Models: Quantifying
Mortality Displacement.” <em>Biostatistics</em> 1 (3): 279–92.
<a href="https://doi.org/10.1093/biostatistics/1.3.279" class="uri">https://doi.org/10.1093/biostatistics/1.3.279</a>.
</div>
<div id="ref-chipman2010" class="csl-entry" role="listitem">
H. A. Chipman, E. I. George and R. E. McCulloch. <span>BART: <span>Bayesian</span></span> additive regression trees. <em>The Annals of Applied Statistics</em>, 4(1): 266–298, 2010. URL <a href="https://doi.org/10.1214/09-AOAS285">https://doi.org/10.1214/09-AOAS285</a>.
</div>
<div id="ref-chiu2023prenatal" class="csl-entry" role="listitem">
Y.-H. M. Chiu, A. Wilson, H.-H. L. Hsu, H. Jamal, N. Mathews, I. Kloog, J. Schwartz, D. C. Bellinger, N. Xhani, R. O. Wright, et al. Prenatal ambient air pollutant mixture exposure and neurodevelopment in urban children in the northeastern <span>United States</span>. <em>Environmental Research</em>, 233: 116394, 2023. URL <a href="https://doi.org/j.envres.2023.116394">https://doi.org/j.envres.2023.116394</a>.
</div>
<div id="ref-demateis_penalized_2024" class="csl-entry" role="listitem">
D. Demateis, K. P. Keller, D. Rojas-Rueda, M.-A. Kioumourtzoglou and A. Wilson. Penalized distributed lag interaction model: Air pollution, birth weight, and neighborhood vulnerability. <em>Environmetrics</em>, e2843, 2024. URL <a href="https://doi.org/10.1002/env.2843">https://doi.org/10.1002/env.2843</a>.
</div>
<div id="ref-dempsey2025bayesianvariableselectiondistributed" class="csl-entry" role="listitem">
D. Dempsey and J. Wyse. <span>Bayesian</span> variable selection in distributed lag models: A focus on binary quantile and count data regressions. 2025. URL <a href="https://arxiv.org/abs/2403.03646">https://arxiv.org/abs/2403.03646</a>.
</div>
<div id="ref-gasparrini_dlnm_2013" class="csl-entry" role="listitem">
A. Gasparrini. Distributed lag linear and non-linear models in <span>R</span>: The package dlnm. <em>Journal of Statistical Software</em>, 43(8): 1–20, 2011. URL <a href="https://doi.org/10.18637/jss.v043.i08">https://doi.org/10.18637/jss.v043.i08</a>.
</div>
<div id="ref-gasparrini_distributed_2010" class="csl-entry" role="listitem">
A. Gasparrini, B. Armstrong and M. G. Kenward. Distributed lag non-linear models. <em>Statistics in Medicine</em>, 29(21): 2224–2234, 2010. URL <a href="https://doi.org/10.1002/sim.3940">https://doi.org/10.1002/sim.3940</a>.
</div>
<div id="ref-hsu_prenatal_2023" class="csl-entry" role="listitem">
H.-H. L. Hsu, A. Wilson, J. Schwartz, I. Kloog, R. O. Wright, B. A. Coull and R. J. Wright. Prenatal ambient air pollutant mixture exposure and early school-age lung function. <em>Environmental Epidemiology</em>, 7(2): e249, 2023. URL <a href="https://doi.org/10.1097/EE9.0000000000000249">https://doi.org/10.1097/EE9.0000000000000249</a>.
</div>
<div id="ref-koyck_1954_econDLM" class="csl-entry" role="listitem">
L. M. Koyck. <em>Distributed lags and investment analysis.</em> North-Holland Publishing Company Amsterdam, 1954.
</div>
<div id="ref-mork_heterogeneous_2023" class="csl-entry" role="listitem">
D. Mork, M.-A. Kioumourtzoglou, M. Weisskopf, B. A. Coull and A. Wilson. Heterogeneous distributed lag models to estimate personalized effects of maternal exposures to air pollution. <em>Journal of the American Statistical Association</em>, 119(545): 14–26, 2024. URL <a href="https://doi.org/10.1080/01621459.2023.2258595">https://doi.org/10.1080/01621459.2023.2258595</a>.
</div>
<div id="ref-mork_estimating_2023" class="csl-entry" role="listitem">
D. Mork and A. Wilson. Estimating perinatal critical windows of susceptibility to environmental mixtures via structured <span>Bayesian</span> regression tree pairs. <em>Biometrics</em>, 79(1): 449–461, 2023. URL <a href="https://doi.org/10.1111/biom.13568">https://doi.org/10.1111/biom.13568</a>.
</div>
<div id="ref-mork_monotone_2024" class="csl-entry" role="listitem">
D. Mork and A. Wilson. Incorporating prior information into distributed lag nonlinear models with zero-inflated monotone regression trees. <em>Bayesian Analysis</em>, 1(1): 1–29, 2024. URL <a href="https://doi.org/10.1214/23-BA1412">https://doi.org/10.1214/23-BA1412</a>.
</div>
<div id="ref-mork_treed_2022" class="csl-entry" role="listitem">
D. Mork and A. Wilson. Treed distributed lag nonlinear models. <em>Biostatistics</em>, 23(3): 754–771, 2022. URL <a href="https://doi.org/10.1093/biostatistics/kxaa051">https://doi.org/10.1093/biostatistics/kxaa051</a>.
</div>
<div id="ref-neelon_bayesian_2019" class="csl-entry" role="listitem">
B. Neelon. <span>Bayesian</span> zero-inflated negative binomial regression based on p<span>ó</span>lya-gamma mixtures. <em>Bayesian Analysis</em>, 14(3): 829, 2019. URL <a href="https://doi.org/10.1214/18-ba1132">https://doi.org/10.1214/18-ba1132</a>.
</div>
<div id="ref-palda_1965_advertise" class="csl-entry" role="listitem">
K. S. Palda. The measurement of cumulative advertising effects. <em>The Journal of Business</em>, 38(2): 162–179, 1965.
</div>
<div id="ref-polson_bayesian_2013" class="csl-entry" role="listitem">
N. G. Polson, J. G. Scott and J. Windle. <span>Bayesian</span> inference for logistic models using p<span>ó</span>lya–gamma latent variables. <em>Journal of the American Statistical Association</em>, 108(504): 1339–1349, 2013. URL <a href="https://doi.org/10.1080/01621459.2013.829001">https://doi.org/10.1080/01621459.2013.829001</a>.
</div>
<div id="ref-rosa_association_2019" class="csl-entry" role="listitem">
M. J. Rosa, H.-H. L. Hsu, A. C. Just, K. J. Brennan, T. Bloomquist, I. Kloog, I. Pantic, A. M. Garcı́a, A. Wilson, B. A. Coull, et al. Association between prenatal particulate air pollution exposure and telomere length in cord blood: Effect modification by fetal sex. <em>Environmental Research</em>, 172: 495–501, 2019. URL <a href="https://doi.org/10.1016/j.envres.2019.03.003">https://doi.org/10.1016/j.envres.2019.03.003</a>.
</div>
<div id="ref-schliep_2021_wellness" class="csl-entry" role="listitem">
E. M. Schliep, T. L. J. Schafer and M. Hawkey. Distributed lag models to identify the cumulative effects of training and recovery in athletes using multivariate ordinal wellness data. <em>Journal of Quantitative Analysis in Sports</em>, 17(3): 241–254, 2021. URL <a href="https://doi.org/10.1515/jqas-2020-0051">https://doi.org/10.1515/jqas-2020-0051</a>.
</div>
<div id="ref-schwartz_distributed_2000" class="csl-entry" role="listitem">
J. Schwartz. The distributed lag between air pollution and daily deaths. <em>Epidemiology</em>, 11(3): 320–326, 2000. URL <a href="https://doi.org/10.1097/00001648-200005000-00016">https://doi.org/10.1097/00001648-200005000-00016</a>.
</div>
<div id="ref-warren_spatial-temporal_2012" class="csl-entry" role="listitem">
J. Warren, M. Fuentes, A. Herring and P. Langlois. Spatial-temporal modeling of the association between air pollution exposure and preterm birth: Identifying critical windows of exposure. <em>Biometrics</em>, 68(4): 1157–1167, 2012. URL <a href="https://doi.org/10.1111/j.1541-0420.2012.01774.x">https://doi.org/10.1111/j.1541-0420.2012.01774.x</a>.
</div>
<div id="ref-wilson_2017_bias" class="csl-entry" role="listitem">
A. Wilson, Y.-H. M. Chiu, H.-H. L. Hsu, R. O. Wright, R. J. Wright and B. A. Coull. Potential for bias when estimating critical windows for air pollution in children’s health. <em>American Journal of Epidemiology</em>, 186(11): 1281–1289, 2017. URL <a href="https://doi.org/10.1093/aje/kwx184">https://doi.org/10.1093/aje/kwx184</a>.
</div>
<div id="ref-zanobetti_generalized_2000" class="csl-entry" role="listitem">
A. Zanobetti, M. P. Wand, J. Schwartz and L. M. Ryan. Generalized additive distributed lag models: Quantifying mortality displacement. <em>Biostatistics</em>, 1(3): 279–292, 2000. URL <a href="https://doi.org/10.1093/biostatistics/1.3.279">https://doi.org/10.1093/biostatistics/1.3.279</a>.
</div>
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h3 class="appendix" data-number="8" id="supplementary-materials"><span class="header-section-number">8</span> Supplementary materials</h3>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2025-007.zip">RJ-2025-007.zip</a></p>
<h3 class="appendix" data-number="9" id="cran-packages-used"><span class="header-section-number">9</span> CRAN packages used</h3>
<p><a href="https://cran.r-project.org/package=dlnm">dlnm</a>, <a href="https://cran.r-project.org/package=dlim">dlim</a>, <a href="https://cran.r-project.org/package=bdlim">bdlim</a>, <a href="https://cran.r-project.org/package=DiscreteDLM">DiscreteDLM</a>, <a href="https://cran.r-project.org/package=dlmtree">dlmtree</a>, <a href="https://cran.r-project.org/package=shiny">shiny</a>, <a href="https://cran.r-project.org/package=dplyr">dplyr</a></p>
<h3 class="appendix" data-number="10" id="cran-task-views-implied-by-cited-packages"><span class="header-section-number">10</span> CRAN Task Views implied by cited packages</h3>
<p><a href="https://cran.r-project.org/view=Databases">Databases</a>, <a href="https://cran.r-project.org/view=ModelDeployment">ModelDeployment</a>, <a href="https://cran.r-project.org/view=TimeSeries">TimeSeries</a>, <a href="https://cran.r-project.org/view=WebTechnologies">WebTechnologies</a></p>
<h3 class="appendix" data-number="11" id="note"><span class="header-section-number">11</span> Note</h3>
<p>This article is converted from a Legacy LaTeX article using the
<a href="https://cran.r-project.org/package=texor">texor</a> package.
The pdf version is the official version. To report a problem with the html,
refer to CONTRIBUTE on the R Journal homepage.</p>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
<h3 id="reuse">Reuse</h3>
<p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
<h3 id="citation">Citation</h3>
<p>For attribution, please cite this work as</p>
<pre class="citation-appendix short">Im, et al., "Structured Bayesian Regression Tree Models for Estimating Distributed Lag Effects: The R Package dlmtree", The R Journal, 2025</pre>
<p>BibTeX citation</p>
<pre class="citation-appendix long">@article{RJ-2025-007,
  author = {Im, Seongwon and Wilson, Ander and Mork, Daniel},
  title = {Structured Bayesian Regression Tree Models for Estimating Distributed Lag Effects: The R Package dlmtree},
  journal = {The R Journal},
  year = {2025},
  note = {https://doi.org/10.32614/RJ-2025-007},
  doi = {10.32614/RJ-2025-007},
  volume = {17},
  issue = {1},
  issn = {2073-4859},
  pages = {136-159}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
