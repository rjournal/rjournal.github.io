<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>Computer Algebra in R Bridges a Gap Between Symbolic Mathematics and Data in the Teaching of Statistics and Data Science</title>

<meta property="description" itemprop="description" content="The capability of R to do symbolic mathematics is enhanced by the  reticulate and caracas packages. The workhorse behind these packages is the Python computer algebra library SymPy.  Via reticulate, the SymPy library can be accessed from within R.  This, however, requires some knowledge of SymPy, Python and reticulate. The caracas package, on the other hand, provides access to SymPy (via reticulate) but by  using R syntax, and this is the main contribution of caracas. We show examples of how to use the  SymPy library from R via reticulate and caracas. Using caracas,  we demonstrate how mathematics and statistics can benefit from  bridging computer algebra and data via R.  The caracas package integrates well with Rmarkdown and Quarto,  and as such supports creation of teaching material and scientific reports. As inspiration for teachers, we include ideas for  small student projects."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2023-090/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2024-04-11"/>
<meta property="article:created" itemprop="dateCreated" content="2024-04-11"/>
<meta name="article:author" content="Mikkel Meyer Andersen"/>
<meta name="article:author" content="Søren Højsgaard"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Computer Algebra in R Bridges a Gap Between Symbolic Mathematics and Data in the Teaching of Statistics and Data Science"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="The capability of R to do symbolic mathematics is enhanced by the  reticulate and caracas packages. The workhorse behind these packages is the Python computer algebra library SymPy.  Via reticulate, the SymPy library can be accessed from within R.  This, however, requires some knowledge of SymPy, Python and reticulate. The caracas package, on the other hand, provides access to SymPy (via reticulate) but by  using R syntax, and this is the main contribution of caracas. We show examples of how to use the  SymPy library from R via reticulate and caracas. Using caracas,  we demonstrate how mathematics and statistics can benefit from  bridging computer algebra and data via R.  The caracas package integrates well with Rmarkdown and Quarto,  and as such supports creation of teaching material and scientific reports. As inspiration for teachers, we include ideas for  small student projects."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2023-090/"/>
<meta property="og:image" content="https://journal.r-project.org/articles/RJ-2023-090/RJ-2023-090_files/figure-html5/calculus-1.png"/>
<meta property="og:image:width" content="960"/>
<meta property="og:image:height" content="249"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Computer Algebra in R Bridges a Gap Between Symbolic Mathematics and Data in the Teaching of Statistics and Data Science"/>
<meta property="twitter:description" content="The capability of R to do symbolic mathematics is enhanced by the  reticulate and caracas packages. The workhorse behind these packages is the Python computer algebra library SymPy.  Via reticulate, the SymPy library can be accessed from within R.  This, however, requires some knowledge of SymPy, Python and reticulate. The caracas package, on the other hand, provides access to SymPy (via reticulate) but by  using R syntax, and this is the main contribution of caracas. We show examples of how to use the  SymPy library from R via reticulate and caracas. Using caracas,  we demonstrate how mathematics and statistics can benefit from  bridging computer algebra and data via R.  The caracas package integrates well with Rmarkdown and Quarto,  and as such supports creation of teaching material and scientific reports. As inspiration for teachers, we include ideas for  small student projects."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2023-090/"/>
<meta property="twitter:image" content="https://journal.r-project.org/articles/RJ-2023-090/RJ-2023-090_files/figure-html5/calculus-1.png"/>
<meta property="twitter:image:width" content="960"/>
<meta property="twitter:image:height" content="249"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Computer Algebra in R Bridges a Gap Between Symbolic Mathematics and Data in the Teaching of Statistics and Data Science"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2023-090"/>
<meta name="citation_pdf_url" content="RJ-2023-090.pdf"/>
<meta name="citation_volume" content="15"/>
<meta name="citation_issue" content="4"/>
<meta name="citation_doi" content="10.32614/RJ-2023-090"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="181"/>
<meta name="citation_lastpage" content="197"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2024/04/11"/>
<meta name="citation_publication_date" content="2024/04/11"/>
<meta name="citation_author" content="Mikkel Meyer Andersen"/>
<meta name="citation_author_institution" content="Department of Mathematical Sciences, Aalborg University, Denmark"/>
<meta name="citation_author" content="Søren Højsgaard"/>
<meta name="citation_author_institution" content="Department of Mathematical Sciences, Aalborg University, Denmark"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Graphical models with R;citation_publisher=Springer;citation_doi=10.1007/978-1-4614-2299-0;citation_author=Søren Højsgaard;citation_author=David Edwards;citation_author=Steffen Lauritzen"/>
  <meta name="citation_reference" content="citation_title=Time series analysis and its applications;citation_publisher=Springer;citation_doi=10.1007/978-3-319-52452-8;citation_author=Robert H. Shumway;citation_author=David S. Stoffer"/>
  <meta name="citation_reference" content="citation_title=Generalized Linear Models;citation_publisher=Chapman &amp; Hall/CRC;citation_author=P McCullagh;citation_author=John A Nelder"/>
  <meta name="citation_reference" content="citation_title=caracas: Computer algebra in R;citation_publisher=The Open Journal;citation_volume=6;citation_doi=10.21105/joss.03438;citation_author=Mikkel Meyer Andersen;citation_author=Søren Højsgaard"/>
  <meta name="citation_reference" content="citation_title=Rmarkdown: Dynamic documents for r;citation_author=JJ Allaire;citation_author=Yihui Xie;citation_author=Jonathan McPherson;citation_author=Javier Luraschi;citation_author=Kevin Ushey;citation_author=Aron Atkins;citation_author=Hadley Wickham;citation_author=Joe Cheng;citation_author=Winston Chang;citation_author=Richard Iannone"/>
  <meta name="citation_reference" content="citation_title=Yacas - Yet another computer algebra system;citation_author=Ayal Pinkus;citation_author=Serge Winnitzky;citation_author=Grzegorz Mazur"/>
  <meta name="citation_reference" content="citation_title=YACAS: A Do-It-Yourself Symbolic Algebra Environment;citation_publisher=Springer-Verlag;citation_doi=10.1007/3-540-45470-5_29;citation_author=Ayal Pinkus;citation_author=Serge Winitzki"/>
  <meta name="citation_reference" content="citation_title=Reticulate: Interface to ’python’;citation_author=Kevin Ushey;citation_author=JJ Allaire;citation_author=Yuan Tang"/>
  <meta name="citation_reference" content="citation_title=R markdown: The definitive guide;citation_publisher=Chapman; Hall/CRC;citation_author=Yihui Xie;citation_author=J. J. Allaire;citation_author=Garrett Grolemund"/>
  <meta name="citation_reference" content="citation_title=R markdown cookbook;citation_publisher=Chapman; Hall/CRC;citation_author=Yihui Xie;citation_author=Christophe Dervieux;citation_author=Emily Riederer"/>
  <meta name="citation_reference" content="citation_title=doBy: Groupwise Statistics, LSmeans, Linear Estimates, Utilities;citation_author=Søren Højsgaard;citation_author=Ulrich Halekoh"/>
  <meta name="citation_reference" content="citation_title=ggplot2: Elegant graphics for data analysis;citation_publisher=Springer-Verlag New York;citation_author=Hadley Wickham"/>
  <meta name="citation_reference" content="citation_title=calculus: High-Dimensional Numerical and Symbolic Calculus in R;citation_volume=104;citation_doi=10.18637/jss.v104.i05;citation_author=Emanuele Guidotti"/>
  <meta name="citation_reference" content="citation_title=Numerical Optimization;citation_publisher=Springer New York;citation_doi=10.1007/978-0-387-40065-5;citation_author=Jorge Nocedal;citation_author=Stephen J. Wright"/>
  <meta name="citation_reference" content="citation_title=Quarto;citation_doi=10.5281/zenodo.5960048;citation_author=J. J. Allaire;citation_author=Charles Teague;citation_author=Carlos Scheidegger;citation_author=Yihui Xie;citation_author=Christophe Dervieux"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","always_allow_html","type","bibliography","date","date_received","journal","volume","issue","slug","packages","draft","preview","CTV","output","pdf_url","citation_url","doi","creative_commons","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Computer Algebra in R Bridges a Gap Between Symbolic Mathematics and Data in the Teaching of Statistics and Data Science"]},{"type":"character","attributes":{},"value":["The capability of R to do symbolic mathematics is enhanced by the  reticulate and caracas packages. The workhorse behind these packages is the Python computer algebra library SymPy.  Via reticulate, the SymPy library can be accessed from within R.  This, however, requires some knowledge of SymPy, Python and reticulate. The caracas package, on the other hand, provides access to SymPy (via reticulate) but by  using R syntax, and this is the main contribution of caracas. We show examples of how to use the  SymPy library from R via reticulate and caracas. Using caracas,  we demonstrate how mathematics and statistics can benefit from  bridging computer algebra and data via R.  The caracas package integrates well with Rmarkdown and Quarto,  and as such supports creation of teaching material and scientific reports. As inspiration for teachers, we include ideas for  small student projects."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Mikkel Meyer Andersen"]},{"type":"character","attributes":{},"value":["Department of Mathematical Sciences, Aalborg University, Denmark"]},{"type":"character","attributes":{},"value":["Skjernvej 4A","9220 Aalborg Ø, Denmark"]},{"type":"character","attributes":{},"value":["mikl@math.aau.dk"]},{"type":"character","attributes":{},"value":["0000-0002-0234-0266"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Søren Højsgaard"]},{"type":"character","attributes":{},"value":["Department of Mathematical Sciences, Aalborg University, Denmark"]},{"type":"character","attributes":{},"value":["Skjernvej 4A","9220 Aalborg Ø, Denmark"]},{"type":"character","attributes":{},"value":["sorenh@math.aau.dk"]},{"type":"character","attributes":{},"value":["0000-0002-3269-9552"]}]}]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["package"]},{"type":"character","attributes":{},"value":["RJreferences.bib"]},{"type":"character","attributes":{},"value":["2024-04-11"]},{"type":"character","attributes":{},"value":["2023-02-07"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[181]},{"type":"integer","attributes":{},"value":[197]}]},{"type":"integer","attributes":{},"value":[15]},{"type":"integer","attributes":{},"value":[4]},{"type":"character","attributes":{},"value":["RJ-2023-090"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"NULL"},{"type":"NULL"}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["preview.png"]},{"type":"list","attributes":{},"value":[]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","legacy_pdf"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["RJ-2023-090.pdf"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2023-090"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2023-090"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["/Library/Frameworks/R.framework/Versions/sitelib-4.4-arm64/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2023-090/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["graphical-abstract.pdf","info.json","paper-r03_files/anchor-4.2.2/anchor.min.js","paper-r03_files/bowser-1.9.3/bowser.min.js","paper-r03_files/distill-2.2.21/template.v2.js","paper-r03_files/figure-html5/budworm-1.png","paper-r03_files/figure-html5/calculus-1.png","paper-r03_files/figure-html5/correlated-1.png","paper-r03_files/figure-latex/budworm-1.pdf","paper-r03_files/figure-latex/calculus-1.pdf","paper-r03_files/figure-latex/correlated-1.pdf","paper-r03_files/header-attrs-2.25/header-attrs.js","paper-r03_files/jquery-3.6.0/jquery-3.6.0.js","paper-r03_files/jquery-3.6.0/jquery-3.6.0.min.js","paper-r03_files/jquery-3.6.0/jquery-3.6.0.min.map","paper-r03_files/kePrint-0.0.1/kePrint.js","paper-r03_files/lightable-0.0.1/lightable.css","paper-r03_files/popper-2.6.0/popper.min.js","paper-r03_files/tippy-6.2.7/tippy-bundle.umd.min.js","paper-r03_files/tippy-6.2.7/tippy-light-border.css","paper-r03_files/tippy-6.2.7/tippy.css","paper-r03_files/tippy-6.2.7/tippy.umd.min.js","paper-r03_files/webcomponents-2.0.0/webcomponents.js","paper-r03.log","paper-r04.pdf","paper-r04.tex","preamble.tex","RJ-2023-090_files/anchor-4.2.2/anchor.min.js","RJ-2023-090_files/bowser-1.9.3/bowser.min.js","RJ-2023-090_files/distill-2.2.21/template.v2.js","RJ-2023-090_files/figure-html5/budworm-1.png","RJ-2023-090_files/figure-html5/calculus-1.png","RJ-2023-090_files/figure-html5/correlated-1.png","RJ-2023-090_files/header-attrs-2.25/header-attrs.js","RJ-2023-090_files/jquery-3.6.0/jquery-3.6.0.js","RJ-2023-090_files/jquery-3.6.0/jquery-3.6.0.min.js","RJ-2023-090_files/jquery-3.6.0/jquery-3.6.0.min.map","RJ-2023-090_files/kePrint-0.0.1/kePrint.js","RJ-2023-090_files/lightable-0.0.1/lightable.css","RJ-2023-090_files/popper-2.6.0/popper.min.js","RJ-2023-090_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2023-090_files/tippy-6.2.7/tippy-light-border.css","RJ-2023-090_files/tippy-6.2.7/tippy.css","RJ-2023-090_files/tippy-6.2.7/tippy.umd.min.js","RJ-2023-090_files/webcomponents-2.0.0/webcomponents.js","RJ-2023-090.log","RJ-2023-090.pdf","RJ-2023-090.Rmd-orig","RJ-2023-090.tex","RJournal.sty","RJreferences.bib","RJwrapper.aux","RJwrapper.log","RJwrapper.out","RJwrapper.tex","Rlogo-5.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.25/header-attrs.js"></script>
  <script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="' + slug + '.zip" class="dt-tag"><i class="fas fa-file-zipper"></i> Supplement</a>')

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").first();
      if (tpar && ! tpar.hasClass("subtitle")) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append($("d-title p:not(:empty)").first()) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Computer Algebra in R Bridges a Gap Between Symbolic Mathematics and Data in the Teaching of Statistics and Data Science","description":"The capability of R to do symbolic mathematics is enhanced by the  reticulate and caracas packages. The workhorse behind these packages is the Python computer algebra library SymPy.  Via reticulate, the SymPy library can be accessed from within R.  This, however, requires some knowledge of SymPy, Python and reticulate. The caracas package, on the other hand, provides access to SymPy (via reticulate) but by  using R syntax, and this is the main contribution of caracas. We show examples of how to use the  SymPy library from R via reticulate and caracas. Using caracas,  we demonstrate how mathematics and statistics can benefit from  bridging computer algebra and data via R.  The caracas package integrates well with Rmarkdown and Quarto,  and as such supports creation of teaching material and scientific reports. As inspiration for teachers, we include ideas for  small student projects.","doi":"10.32614/RJ-2023-090","authors":[{"author":"Mikkel Meyer Andersen","authorURL":"#","affiliation":"Department of Mathematical Sciences, Aalborg University, Denmark","affiliationURL":"#","orcidID":"0000-0002-0234-0266"},{"author":"Søren Højsgaard","authorURL":"#","affiliation":"Department of Mathematical Sciences, Aalborg University, Denmark","affiliationURL":"#","orcidID":"0000-0002-3269-9552"}],"publishedDate":"2024-04-11T00:00:00.000+00:00","citationText":"Andersen & Højsgaard, 2024"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues/2024-2">Current</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../submissions.html">Submit</a>
<a href="../../editors.html">Editorial board</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Computer Algebra in R Bridges a Gap Between Symbolic Mathematics and Data in the Teaching of Statistics and Data Science</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>The capability of R to do symbolic mathematics is enhanced by the reticulate and caracas packages. The workhorse behind these packages is the Python computer algebra library SymPy. Via reticulate, the SymPy library can be accessed from within R. This, however, requires some knowledge of SymPy, Python and reticulate. The caracas package, on the other hand, provides access to SymPy (via reticulate) but by using R syntax, and this is the main contribution of caracas. We show examples of how to use the SymPy library from R via reticulate and caracas. Using caracas, we demonstrate how mathematics and statistics can benefit from bridging computer algebra and data via R. The caracas package integrates well with Rmarkdown and Quarto, and as such supports creation of teaching material and scientific reports. As inspiration for teachers, we include ideas for small student projects.</p></p>
</div>

<div class="d-byline">
  Mikkel Meyer Andersen  (Department of Mathematical Sciences, Aalborg University, Denmark)
  
,   Søren Højsgaard  (Department of Mathematical Sciences, Aalborg University, Denmark)
  
<br/>2024-04-11
</div>

<div class="d-article">
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>The capability of R to do symbolic mathematics is enhanced by the
<a href="https://cran.r-project.org/package=reticulate">reticulate</a> <span class="citation" data-cites="reticulate">(<a href="#ref-reticulate" role="doc-biblioref">Ushey et al. 2020</a>)</span> and <a href="https://cran.r-project.org/package=caracas">caracas</a> <span class="citation" data-cites="caracas:21">(<a href="#ref-caracas:21" role="doc-biblioref">Andersen and Højsgaard 2021</a>)</span>
packages.
The <code>reticulate</code> package allows R users to make use of various Python
libraries, such as the symbolic mathematics package SymPy, which is
the workhorse behind symbolic mathematics in this connection.
However, the <code>reticulate</code> package does require that the users are
somewhat familiar with Python syntax. The caracas package, on the
other hand, provides an interface to reticulate that conforms fully to
the existing R syntax. In short form, <code>caracas</code> provides the
following:</p>
<ol type="1">
<li><p>Mathematical tools like equation solving, summation, limits,
symbolic linear algebra in R syntax and formatting of tex output.</p></li>
<li><p>Symbolic mathematics can easily be combined with data which is
helpful in e.g. numerical optimization.</p></li>
</ol>
<!-- The `reticulate` package invokes functions from the Python -->
<!-- library SymPy, which is the workhorse behind symbolic mathematics in -->
<!-- this connection.  -->
<!-- The `reticulate` package requires some knowledge of -->
<!-- Python syntax whereas the `caracas` package provides an interface to -->
<!-- `reticulate` using R syntax.  -->
<!-- and how  -->
<!-- this can  -->
<!-- benefit from bridging computer algebra and data via -->
<!-- R.  -->
<p>In this paper we will illustrate the use of the <code>caracas</code> package
(version 2.1.0) in connection with teaching mathematics and statistics
and how students can benefit benefit from bridging computer algebra and data
via R.
Focus is on: 1) treating statistical models symbolically, 2)
bridging the gap between symbolic mathematics and numerical
computations and 3) preparing teaching material in a reproducible
framework
(provided by, e.g. <a href="https://cran.r-project.org/package=rmarkdown">rmarkdown</a> and Quarto; <span class="citation" data-cites="rmarkdown">Allaire et al. (<a href="#ref-rmarkdown" role="doc-biblioref">2021</a>)</span>; <span class="citation" data-cites="RMarkdownDefinitiveGuide">Xie et al. (<a href="#ref-RMarkdownDefinitiveGuide" role="doc-biblioref">2018</a>)</span>; <span class="citation" data-cites="RMarkdownCookbook">Xie et al. (<a href="#ref-RMarkdownCookbook" role="doc-biblioref">2020</a>)</span>; <span class="citation" data-cites="Allaire_Quarto_2022">Allaire et al. (<a href="#ref-Allaire_Quarto_2022" role="doc-biblioref">2022</a>)</span>)
.</p>
<p>The <code>caracas</code> package is available from CRAN. Several vignettes
illustrating <code>caracas</code> are provided with the package and they are also
available online together with the help pages, see
<a href="https://r-cas.github.io/caracas/" class="uri">https://r-cas.github.io/caracas/</a>. The development
version of <code>caracas</code> is available at
<a href="https://github.com/r-cas/caracas" class="uri">https://github.com/r-cas/caracas</a>.</p>
<p>The paper is organized in the following sections: The section
<a href="#introducing-caracas">Introducing <code>caracas</code></a> briefly introduces
the <code>caracas</code> package and its syntax, and
relates <code>caracas</code> to SymPy via <code>reticulate</code>.
The section <a href="#statistics-examples">Statistics examples</a> presents a sample of statistical models
where we believe that a
symbolic treatment can enhance purely numerical computations.
In the section <a href="#further-topics">Further topics</a> we
demonstrate further aspects of <code>caracas</code>, including how <code>caracas</code> can be
used in connection with preparing texts, e.g. teaching material and
working documents.
The section <a href="#hands-on-activities">Hands-on activities</a>
contains suggestions about hands-on activities, e.g. for students.
The last section <a href="#discussion">Discussion</a> contains a discussion of the
paper.</p>
<h3 data-number="1.1" id="installation"><span class="header-section-number">1.1</span> Installation</h3>
<p>The <code>caracas</code> package is available on CRAN and can be installed as usual with <code>install.packages('caracas')</code>.
Please ensure that you have SymPy installed, or else install it:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>caracas<span class="sc">::</span><span class="fu">has_sympy</span>()) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  caracas<span class="sc">::</span><span class="fu">install_sympy</span>()</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>caracas</code> package relies on the <code>reticulate</code> package to run Python code.
Thus, if you wish to configure your Python environment, you need to
first load <code>reticulate</code>, then configure the Python environment, and at
last load <code>caracas</code>.
The Python environment can be configured as
in <code>reticulate</code>’s “Python Version Configuration” vignette.
Again, configuring the Python environment needs to be done before
loading <code>caracas</code>.
Please find further details in <code>reticulate</code>’s documentation.</p>
<h2 data-number="2" id="introducing-caracas"><span class="header-section-number">2</span> Introducing <code>caracas</code></h2>
<p>Here we introduce key concepts and show functionality subsequently
needed in the section <a href="#statistics-examples">Statistics examples</a>.
We will demonstrate both <code>caracas</code> and
contrast this with using <code>reticulate</code> directly.</p>
<h3 data-number="2.1" id="symbols"><span class="header-section-number">2.1</span> Symbols</h3>
<p>A <code>caracas</code> symbol is a list with a <code>pyobj</code> slot and the class
<code>caracas_symbol</code>. The <code>pyobj</code> is a Python object (often a SymPy
object). As such, a <code>caracas</code> symbol (in R) provides a handle to a
Python object. In the design of <code>caracas</code> we have tried to make
this distinction something the user should not be concerned with, but
it is worthwhile being aware of the distinction. Whenever we refer to
a symbol we mean a <code>caracas</code> symbol. Two functions that create
symbols are <code>def_sym()</code> and <code>as_sym()</code>; these and other functions that
create symbols will be illustrated below.</p>
<h3 data-number="2.2" id="linear-algebra"><span class="header-section-number">2.2</span> Linear algebra</h3>
<p>We create a symbolic matrix (a <code>caracas</code> symbol) from an R object and
a symbolic vector (a <code>caracas</code> symbol) directly. A vector is a
one-column matrix which is printed as its transpose to save
space. Matrix products are computed using the <code>%*%</code> operator:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>M0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/toeplitz.html'>toeplitz</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'># Character matrix</span></span>
<span><span class='va'>M</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_sym.html'>as_sym</a></span><span class='op'>(</span><span class='va'>M0</span><span class='op'>)</span>             <span class='co'># as_sym() converts to a caracas symbol</span></span>
<span><span class='va'>v</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"v"</span><span class='op'>)</span>     <span class='co'># vector_sym creates symbolic vector</span></span>
<span><span class='va'>y</span>  <span class='op'>&lt;-</span> <span class='va'>M</span> <span class='op'><a href='https://rdrr.io/pkg/caracas/man/matrix-products.html'>%*%</a></span> <span class='va'>v</span></span>
<span><span class='va'>Minv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>M</span><span class='op'>)</span> </span>
<span><span class='va'>w</span> <span class='op'>&lt;-</span> <span class='va'>Minv</span> <span class='op'><a href='https://rdrr.io/pkg/caracas/man/matrix-products.html'>%*%</a></span> <span class='va'>y</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/simplify.html'>simplify</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Here we make use of the fact that <code>caracas</code> is tightly integrated with <code>R</code>
which has a <code>toeplitz()</code> function that can be used.
Similarly, <code>caracas</code> offers <code>matrix_sym()</code> and
<code>vector_sym()</code> for generating general matrix and vector objects.
The object <code>M</code> is</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>M</span></span></code></pre>
</div>
<pre><code>c: [[a, b],
    [b, a]]</code></pre>
</div>
<p>The LaTeX rendering using the <code>tex()</code> function of the symbols
above are (refer to section <a href="#further-topics">Further topics</a>):</p>
<p><span class="math display">\[\begin{equation}
M = \left[\begin{matrix}a &amp; b\\b &amp; a\end{matrix}\right]; \;
v = \left[\begin{matrix}v_{1}\\v_{2}\end{matrix}\right]; \;
y = \left[\begin{matrix}a v_{1} + b v_{2}\\a v_{2} + b v_{1}\end{matrix}\right]; \;
M^{-1} = \left[\begin{matrix}\frac{a}{a^{2} - b^{2}} &amp; - \frac{b}{a^{2} - b^{2}}\\- \frac{b}{a^{2} - b^{2}} &amp; \frac{a}{a^{2} - b^{2}}\end{matrix}\right]; \;
w = \left[\begin{matrix}v_{1}\\v_{2}\end{matrix}\right] .
\end{equation}\]</span></p>
<p>Symbols can be substituted with other symbols or with numerical values
using <code>subs()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>M2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/subs.html'>subs</a></span><span class='op'>(</span><span class='va'>M</span>, <span class='st'>"b"</span>, <span class='st'>"a^2"</span><span class='op'>)</span></span>
<span><span class='va'>M3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/subs.html'>subs</a></span><span class='op'>(</span><span class='va'>M2</span>, <span class='st'>"a"</span>, <span class='fl'>2</span><span class='op'>)</span> </span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
M2 = \left[\begin{matrix}a &amp; a^{2}\\a^{2} &amp; a\end{matrix}\right]; \quad
M3 = \left[\begin{matrix}2 &amp; 4\\4 &amp; 2\end{matrix}\right].
\end{equation}\]</span></p>
<h3 data-number="2.3" id="linear-algebra---using-reticulate"><span class="header-section-number">2.3</span> Linear algebra - using <code>reticulate</code></h3>
<p>The <code>reticulate</code> package already enables SymPy from within R,
but does not use standard R syntax for many operations (e.g. matrix multiplication),
and certain operations are more complicated than the R counterparts
(e.g. replacing elements in a matrix and constructing R expressions).
As illustration, the previous linear algebra example can also be done using <code>reticulate</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://rstudio.github.io/reticulate/'>reticulate</a></span><span class='op'>)</span></span>
<span><span class='va'>sympy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rstudio.github.io/reticulate/reference/import.html'>import</a></span><span class='op'>(</span><span class='st'>"sympy"</span><span class='op'>)</span></span>
<span><span class='va'>M_</span> <span class='op'>&lt;-</span> <span class='va'>sympy</span><span class='op'>$</span><span class='fu'>Matrix</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a_"</span>, <span class='st'>"b_"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"b_"</span>, <span class='st'>"a_"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>v_</span> <span class='op'>&lt;-</span> <span class='va'>sympy</span><span class='op'>$</span><span class='fu'>Matrix</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='st'>"v1_"</span>, <span class='st'>"v2_"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>y_</span> <span class='op'>&lt;-</span> <span class='va'>M_</span> <span class='op'>*</span> <span class='va'>v_</span></span>
<span><span class='va'>w_</span> <span class='op'>&lt;-</span> <span class='va'>M_</span><span class='op'>$</span><span class='fu'>inv</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>y_</span></span>
<span><span class='va'>sympy</span><span class='op'>$</span><span class='fu'>simplify</span><span class='op'>(</span><span class='va'>w_</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>Matrix([
[v1_],
[v2_]])</code></pre>
</div>
<p>This shows that it is possible to do the same linear algebra example
using only <code>reticulate</code>,
but it requires using non-standard R syntax (for
example, using <code>*</code> for matrix multiplication instead of <code>%*%</code>).</p>
<h3 data-number="2.4" id="functionality-and-r-syntax-provided-by-caracas"><span class="header-section-number">2.4</span> Functionality and R syntax provided by <code>caracas</code></h3>
<p>In <code>caracas</code> we use R syntax:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>v</span>, <span class='va'>v</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>v</span>, <span class='va'>v</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>v</span>, <span class='va'>v</span><span class='op'>)</span></span>
<span><span class='va'>v</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='st'>"v3"</span> <span class='co'># Insert element</span></span>
<span><span class='va'>M</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span></span>
<span><span class='va'>M</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span></span></code></pre>
</div>
</div>
<p>The code correspondence between <code>reticulate</code> and <code>caracas</code> shows
that the same can be achieved with <code>reticulate</code>. However, it can be argued that
the syntax is more involved, at least for users only familiar with R. Note in particular that
Python’s “object-oriented” syntax can make code harder to read due to
having to call methods with <code>$</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>v_</span><span class='op'>$</span><span class='fu'>row_join</span><span class='op'>(</span><span class='va'>v_</span><span class='op'>)</span>                                                <span class='co'># rbind(v, v)</span></span>
<span><span class='va'>v_</span><span class='op'>$</span><span class='cn'>T</span><span class='op'>$</span><span class='fu'>col_join</span><span class='op'>(</span><span class='va'>v_</span><span class='op'>$</span><span class='cn'>T</span><span class='op'>)</span>                                            <span class='co'># cbind(v, v)</span></span>
<span><span class='va'>sympy</span><span class='op'>$</span><span class='fu'>Matrix</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>v_</span><span class='op'>$</span><span class='fu'>tolist</span><span class='op'>(</span><span class='op'>)</span>, <span class='va'>v_</span><span class='op'>$</span><span class='fu'>tolist</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>                      <span class='co'># c(v, v)</span></span>
<span><span class='va'>sympy</span><span class='op'>$</span><span class='fu'>Matrix</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>v_</span><span class='op'>$</span><span class='fu'>tolist</span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>sympy</span><span class='op'>$</span><span class='fu'>symbols</span><span class='op'>(</span><span class='st'>"v3_"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># v[3] &lt;- "v3"</span></span>
<span><span class='va'>M_</span><span class='op'>$</span><span class='fu'>col</span><span class='op'>(</span><span class='fl'>1L</span><span class='op'>)</span>                                                     <span class='co'># M[, 2]</span></span>
<span><span class='va'>M_</span><span class='op'>$</span><span class='fu'>row</span><span class='op'>(</span><span class='fl'>1L</span><span class='op'>)</span><span class='op'>$</span><span class='fu'>col</span><span class='op'>(</span><span class='fl'>0L</span><span class='op'>)</span>                                             <span class='co'># M[2]</span></span></code></pre>
</div>
</div>
<p>Notice that SymPy uses 0-based indexing (as Python does), whereas
<code>caracas</code> uses 1-based indexing (as R does). Furthermore, indexing
has to be done using explicit integers
so above we write <code>1L</code> (an integer) rather than simply <code>1</code>
(a numeric).</p>
<p>We have already shown that <code>caracas</code> can coerce R matrices to
symbols. Additionally, <code>caracas</code> provides various convenience
functions:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>M</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>matrix_sym</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>2</span>, entry <span class='op'>=</span> <span class='st'>"sigma"</span><span class='op'>)</span></span>
<span><span class='va'>D</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>matrix_sym_diag</a></span><span class='op'>(</span><span class='fl'>2</span>, entry <span class='op'>=</span> <span class='st'>"d"</span><span class='op'>)</span></span>
<span><span class='va'>S</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>matrix_sym_symmetric</a></span><span class='op'>(</span><span class='fl'>2</span>, entry <span class='op'>=</span> <span class='st'>"s"</span><span class='op'>)</span></span>
<span><span class='va'>E</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/special_matrices.html'>eye_sym</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='va'>J</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/special_matrices.html'>ones_sym</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='fl'>2</span>, entry <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
M = \left[\begin{matrix}\sigma_{11} &amp; \sigma_{12}\\\sigma_{21} &amp; \sigma_{22}\end{matrix}\right];
D = \left[\begin{matrix}d_{1} &amp; 0\\0 &amp; d_{2}\end{matrix}\right];
S = \left[\begin{matrix}s_{11} &amp; s_{21}\\s_{21} &amp; s_{22}\end{matrix}\right];
E = \left[\begin{matrix}1 &amp; 0\\0 &amp; 1\end{matrix}\right];
J = \left[\begin{matrix}1 &amp; 1\\1 &amp; 1\end{matrix}\right];
b = \left[\begin{matrix}b_{1}\\b_{2}\end{matrix}\right]
\end{equation}\]</span></p>
<p>A <code>caracas</code> symbol can be turned into an R function for subsequent
numerical evaluation using <code>as_func()</code> or into an R expression using <code>as_expr()</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_func.html'>as_func</a></span><span class='op'>(</span><span class='va'>M</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>function (sigma11, sigma12, sigma21, sigma22) 
{
    matrix(c(sigma11, sigma21, sigma12, sigma22), nrow = 2)
}
&lt;environment: 0x10f0379a8&gt;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_expr.html'>as_expr</a></span><span class='op'>(</span><span class='va'>M</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>expression(matrix(c(sigma11, sigma21, sigma12, sigma22), nrow = 2))</code></pre>
</div>
<h3 data-number="2.5" id="algebra-and-calculus"><span class="header-section-number">2.5</span> Algebra and calculus</h3>
<p>We can define a polynomial <span class="math inline">\(p\)</span> in the variable <span class="math inline">\(x\)</span>. This is done by
defining a <code>caracas</code> symbol <code>x</code> and subsequently a <code>caracas</code>
polynomial <code>p</code> in <code>x</code> (notice that <code>p</code> gets automatically coerced into
a symbol as well, because <code>p</code> is defined in terms of the symbol <code>x</code>):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/def_sym.html'>def_sym</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span></span>
<span><span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='op'>-</span> <span class='va'>x</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>^</span><span class='fl'>3</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>^</span><span class='fl'>4</span><span class='op'>/</span><span class='fl'>4</span> <span class='op'>-</span> <span class='fl'>3</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>^</span><span class='fl'>5</span> <span class='op'>/</span> <span class='fl'>5</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>^</span><span class='fl'>6</span> <span class='op'>/</span> <span class='fl'>6</span></span></code></pre>
</div>
</div>
<p>The function <code>def_sym()</code> creates the symbol <code>x</code>.
Alternatively, <code>x &lt;- as_sym("x")</code> can be used,
but it has the drawback that you could also write <code>y &lt;- as_sym("x")</code>.
We investigate <code>p</code> further by finding the first and second derivatives of <code>p</code>, i.e. the gradient and Hessian of
<code>p</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>g</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/der.html'>der</a></span><span class='op'>(</span><span class='va'>p</span>, <span class='va'>x</span><span class='op'>)</span></span>
<span><span class='va'>g2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/factor_.html'>factor_</a></span><span class='op'>(</span><span class='va'>g</span><span class='op'>)</span></span>
<span><span class='va'>h</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/der2.html'>der2</a></span><span class='op'>(</span><span class='va'>p</span>, <span class='va'>x</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Notice here that some functions have a postfix underscore as a simple
way of distinguishing them from R functions with a different
meaning. Thus, here the function <code>factor_()</code> factorizes the polynomial
which shows that the stationary points are
<span class="math inline">\(-1\)</span>, <span class="math inline">\(0\)</span>, <span class="math inline">\(1\)</span> and <span class="math inline">\(2\)</span>:</p>
<p><span class="math display">\[\begin{equation}
\texttt{g}  = x^{5} - 3 x^{4} + x^{3} + 3 x^{2} - 2 x; \quad
\texttt{g2}  = x \left(x - 2\right) \left(x - 1\right)^{2} \left(x + 1\right).
\end{equation}\]</span></p>
<p>In a more general setting we can find the stationary points by equating the gradient to zero:
The output <code>sol</code> is a list of solutions in which each solution is a list of <code>caracas</code> symbols.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>sol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/solve_sys.html'>solve_sys</a></span><span class='op'>(</span>lhs <span class='op'>=</span> <span class='va'>g</span>, rhs <span class='op'>=</span> <span class='fl'>0</span>, vars <span class='op'>=</span> <span class='va'>x</span><span class='op'>)</span></span>
<span><span class='va'>sol</span></span></code></pre>
</div>
<pre><code>x = -1
x = 0
x = 1
x = 2</code></pre>
</div>
<p>Notice that <code>solve_sys</code> also works with complex solutions:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/solve_sys.html'>solve_sys</a></span><span class='op'>(</span>lhs <span class='op'>=</span> <span class='va'>x</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fl'>1</span>, rhs <span class='op'>=</span> <span class='fl'>0</span>, vars <span class='op'>=</span> <span class='va'>x</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>x = -1i
x = 1i</code></pre>
</div>
<p>As noted before, a <code>caracas</code> symbol can be coerced to an R expression
using <code>as_expr()</code>. This can be used to get the roots of <code>g</code>
(the stationary points) above as an R object.
The sign of the second derivative in the stationary points can be obtained
by coercing the second derivative symbol to a function:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>sol_expr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_expr.html'>as_expr</a></span><span class='op'>(</span><span class='va'>sol</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/unname.html'>unname</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='va'>sol_expr</span></span></code></pre>
</div>
<pre><code>[1] -1  0  1  2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>h_fn</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_func.html'>as_func</a></span><span class='op'>(</span><span class='va'>h</span><span class='op'>)</span></span>
<span><span class='fu'>h_fn</span><span class='op'>(</span><span class='va'>sol_expr</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 12 -2  0  6</code></pre>
</div>
<p>The sign of the second derivative in the stationary points shows that <span class="math inline">\(-1\)</span> and
<span class="math inline">\(2\)</span> are local minima, <span class="math inline">\(0\)</span> is a local maximum and <span class="math inline">\(1\)</span> is an inflection
point. The polynomial, the first derivative and the second derivative are shown in
Fig. <a href="#fig:calculus">1</a>.
The stationary points, <span class="math inline">\(-1, 0, 1, 2\)</span>, are indicated in the plots.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:calculus"></span>
<img src="RJ-2023-090_files/figure-html5/calculus-1.png" alt="Left: A polynomial. Center: First derivative (the gradient). Right: Second derivative (the Hessian)." width="480" />
<p class="caption">
Figure 1: Left: A polynomial. Center: First derivative (the gradient). Right: Second derivative (the Hessian).
</p>
</div>
</div>
<h2 data-number="3" id="statistics-examples"><span class="header-section-number">3</span> Statistics examples</h2>
<p>In this section we examine larger statistical examples and
demonstrate how <code>caracas</code> can help improve understanding of the models.</p>
<h3 data-number="3.1" id="example-linear-models"><span class="header-section-number">3.1</span> Example: Linear models</h3>
<p>While the matrix form of linear models is quite clear and concise,
it can also be argued that matrix algebra
obscures what is being computed. Numerical examples are useful for
some aspects of the computations but not for others. In this respect
symbolic computations can be enlightening.</p>
<p>Consider a two-way analysis of variance (ANOVA) with one observation
per group, see Table <a href="#tab:anova-two-way-table">1</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table table-bordered" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:anova-two-way-table">Table 1: </span><span id="tab:anova-two-way-table">Table 2: </span>Two-by-two layout of data.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;border-left:1px solid;">
<span class="math inline">\(y_{11}\)</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span class="math inline">\(y_{12}\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;">
<span class="math inline">\(y_{21}\)</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span class="math inline">\(y_{22}\)</span>
</td>
</tr>
</tbody>
</table>
</div>
<p>Previously, it was demonstrated that a symbolic
vector could be defined with the <code>vector_sym()</code> function.
Another way to specify a symbolic vector with explicit elements is
by using <code>as_sym()</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>y</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_sym.html'>as_sym</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"y_11"</span>, <span class='st'>"y_21"</span>, <span class='st'>"y_12"</span>, <span class='st'>"y_22"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>r <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>)</span>, s <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>X</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/model.matrix.html'>model.matrix</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>r</span> <span class='op'>+</span> <span class='va'>s</span>, data <span class='op'>=</span> <span class='va'>dat</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_sym.html'>as_sym</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>, <span class='st'>"b"</span><span class='op'>)</span></span>
<span><span class='va'>mu</span> <span class='op'>&lt;-</span> <span class='va'>X</span> <span class='op'><a href='https://rdrr.io/pkg/caracas/man/matrix-products.html'>%*%</a></span> <span class='va'>b</span></span></code></pre>
</div>
</div>
<p>For the specific model we have random variables <span class="math inline">\(y=(y_{ij})\)</span>. All
<span class="math inline">\(y_{ij}\)</span>s are assumed independent and <span class="math inline">\(y_{ij}\sim N(\mu_{ij}, v)\)</span>.
The corresponding mean vector <span class="math inline">\(\mu\)</span> has the form given below:</p>
<p><span class="math display">\[\begin{equation}
y = \left[\begin{matrix}y_{11}\\y_{21}\\y_{12}\\y_{22}\end{matrix}\right]; \quad X=\left[\begin{matrix}1 &amp; . &amp; .\\1 &amp; 1 &amp; .\\1 &amp; . &amp; 1\\1 &amp; 1 &amp; 1\end{matrix}\right]; \quad b=\left[\begin{matrix}b_{1}\\b_{2}\\b_{3}\end{matrix}\right]; \quad  \mu = X b = \left[\begin{matrix}b_{1}\\b_{1} + b_{2}\\b_{1} + b_{3}\\b_{1} + b_{2} + b_{3}\end{matrix}\right] .
\end{equation}\]</span></p>
<p>Above and elsewhere, dots represent zero.
The least squares estimate of <span class="math inline">\(b\)</span> is the vector <span class="math inline">\(\hat{b}\)</span> that minimizes <span class="math inline">\(||y-X b||^2\)</span> which leads to the normal equations <span class="math inline">\((X^\top X)b = X^\top y\)</span> to be solved. If <span class="math inline">\(X\)</span> has full rank, the unique solution to the normal
equations is <span class="math inline">\(\hat{b} = (X^\top X)^{-1} X^\top y\)</span>. Hence the
estimated mean vector is <span class="math inline">\(\hat \mu = X\hat{b}=X(X^\top X)^{-1} X^\top y\)</span>. Symbolic computations are
not needed for quantities involving only the model matrix <span class="math inline">\(X\)</span>, but
when it comes to computations involving <span class="math inline">\(y\)</span>, a symbolic treatment of
<span class="math inline">\(y\)</span> is useful:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>Xty</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/pkg/caracas/man/matrix-products.html'>%*%</a></span> <span class='va'>y</span></span>
<span><span class='va'>b_hat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/pkg/caracas/man/matrix-products.html'>%*%</a></span> <span class='va'>X</span>, <span class='va'>Xty</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{align}
X^\top y &amp;= \left[\begin{matrix}y_{11} + y_{12} + y_{21} + y_{22}\\y_{21} + y_{22}\\y_{12} + y_{22}\end{matrix}\right]; \quad
\quad
\hat{b} = \frac{1}{2}  \left[\begin{matrix}\frac{3 y_{11}}{2} + \frac{y_{12}}{2} + \frac{y_{21}}{2} - \frac{y_{22}}{2}\\- y_{11} - y_{12} + y_{21} + y_{22}\\- y_{11} + y_{12} - y_{21} + y_{22}\end{matrix}\right].
\end{align}\]</span></p>
<p>Hence <span class="math inline">\(X^\top y\)</span> (a sufficient reduction of data if the variance is
known) consists of the sum of all observations, the sum of
observations in the second row and the sum of observations in the
second column. For <span class="math inline">\(\hat{b}\)</span>, the second component is, apart from a
scaling, the sum of the second row minus the sum of the first
row. Likewise, the third component is the sum of the second column
minus the sum of the first column. Hence, for example the second
component of <span class="math inline">\(\hat{b}\)</span> is the difference in mean between the first and
second column in Table <a href="#tab:anova-two-way-table">1</a>.</p>
<h3 data-number="3.2" id="example-logistic-regression"><span class="header-section-number">3.2</span> Example: Logistic regression</h3>
<p>In the following we go through details of the logistic regression model,
for a classical description see e.g. <span class="citation" data-cites="mccullagh">McCullagh and Nelder (<a href="#ref-mccullagh" role="doc-biblioref">1989</a>)</span> for a classical description.</p>
<p>As an example, consider the <code>budworm</code> data from the <a href="https://cran.r-project.org/package=doBy">doBy</a> package <span class="citation" data-cites="doBy">(<a href="#ref-doBy" role="doc-biblioref">Højsgaard and Halekoh 2023</a>)</span>.
The data shows the number of killed moth tobacco budworm
. Batches of 20 moths of each sex were
exposed for three days to the pyrethroid and the number in each batch
that were dead or knocked down was recorded.
Below we focus only on male budworms and the mortality is illustrated
in Figure <a href="#fig:budworm">2</a> (produced with <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>; <span class="citation" data-cites="ggplot2">Wickham (<a href="#ref-ggplot2" role="doc-biblioref">2016</a>)</span>). The <span class="math inline">\(y\)</span>-axis shows the empirical
logits, i.e. <span class="math inline">\(\log((\texttt{ndead} + 0.5)/(\texttt{ntotal}-\texttt{ndead} + 0.5))\)</span>. The figure suggests that log odds of dying grows linearly with log dose.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>budworm</span>, package <span class='op'>=</span> <span class='st'>"doBy"</span><span class='op'>)</span></span>
<span><span class='va'>bud</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>budworm</span>, <span class='va'>sex</span> <span class='op'>==</span> <span class='st'>"male"</span><span class='op'>)</span></span>
<span><span class='va'>bud</span></span></code></pre>
</div>
<pre><code>   sex dose ndead ntotal
1 male    1     1     20
2 male    2     4     20
3 male    4     9     20
4 male    8    13     20
5 male   16    18     20
6 male   32    20     20</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:budworm"></span>
<img src="RJ-2023-090_files/figure-html5/budworm-1.png" alt="Insecticide mortality of the moth tobacco budworm." width="480" />
<p class="caption">
Figure 2: Insecticide mortality of the moth tobacco budworm.
</p>
</div>
</div>
<p>Observables are binomially distributed, <span class="math inline">\(y_i \sim \text{bin}(p_i, n_i)\)</span>. The probability <span class="math inline">\(p_i\)</span> is connected to a <span class="math inline">\(q\)</span>-vector of
covariates <span class="math inline">\(x_i=(x_{i1}, \dots, x_{iq})\)</span> and a <span class="math inline">\(q\)</span>-vector of
regression coefficients <span class="math inline">\(b=(b_1, \dots, b_q)\)</span> as follows: The term
<span class="math inline">\(s_i = x_i \cdot b\)</span> is denoted the . The
probability <span class="math inline">\(p_i\)</span> can be linked to <span class="math inline">\(s_i\)</span> in different ways, but the
most commonly employed is via the which is
<span class="math inline">\(\text{logit}(p_i) = \log(p_i/(1-p_i))\)</span> so here <span class="math inline">\(\text{logit}(p_i) = s_i\)</span>. Based on Figure <a href="#fig:budworm">2</a>, we consider the specific
model with <span class="math inline">\(s_i = b_1 + b_2 \log2(dose_i)\)</span>. For later use, we define the data matrix below:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>DM</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/model.matrix.html'>model.matrix</a></span><span class='op'>(</span><span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log2</a></span><span class='op'>(</span><span class='va'>dose</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>bud</span><span class='op'>)</span>,</span>
<span>            <span class='va'>bud</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ndead"</span>, <span class='st'>"ntotal"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>  <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='va'>DM</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  (Intercept) log2(dose) ndead ntotal
1           1          0     1     20
2           1          1     4     20
3           1          2     9     20</code></pre>
</div>
<h4 class="unnumbered" data-number="3.2.1" id="each-component-of-the-likelihood">Each component of the likelihood</h4>
<p>The log-likelihood is <span class="math inline">\(\log L=\sum_i y_i \log(p_i) + (n_i-y_i) \log(1-p_i) = \sum_i \log L_i\)</span>, say.
Consider the contribution to the total log-likelihood from the <span class="math inline">\(i\)</span>th
observation which is <span class="math inline">\(\log L_i = l_i = y_i \log(p_i) + (n_i-y_i) \log(1-p_i)\)</span>.
Since we are focusing on one observation only, we shall ignore the
subscript <span class="math inline">\(i\)</span> in this section. First notice that with
<span class="math inline">\(s = \log(p/(1-p))\)</span> we can find <span class="math inline">\(p\)</span> as a function of <span class="math inline">\(s\)</span> as:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/def_sym.html'>def_sym</a></span><span class='op'>(</span><span class='va'>s</span>, <span class='va'>p</span><span class='op'>)</span> <span class='co'># The previous polynomial p is removed by this new declaration</span></span>
<span><span class='va'>sol_</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/solve_sys.html'>solve_sys</a></span><span class='op'>(</span>lhs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>p</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>-</span> <span class='va'>p</span><span class='op'>)</span><span class='op'>)</span>, rhs <span class='op'>=</span> <span class='va'>s</span>, vars <span class='op'>=</span> <span class='va'>p</span><span class='op'>)</span></span>
<span><span class='va'>p_s</span> <span class='op'>&lt;-</span> <span class='va'>sol_</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>p</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
\texttt{p\_s} = \frac{e^{s}}{e^{s} + 1}
\end{equation}\]</span></p>
<p>Next, find the likelihood as a function of <span class="math inline">\(p\)</span>, as a function of <span class="math inline">\(s\)</span>
and as a function of <span class="math inline">\(b\)</span>. The underscore in <code>logLb_</code> and elsewhere
indicates that this expression is defined in terms of other
symbols. The log-likelihood can be maximized using e.g. Newton-Raphson
(see e.g. <span class="citation" data-cites="nocedal">Nocedal and Wright (<a href="#ref-nocedal" role="doc-biblioref">2006</a>)</span>) and in this connection we need the score function,
<span class="math inline">\(S\)</span>, and the Hessian, <span class="math inline">\(H\)</span>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/def_sym.html'>def_sym</a></span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>n</span><span class='op'>)</span></span>
<span><span class='va'>b</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"b"</span><span class='op'>)</span></span>
<span><span class='va'>x</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"x"</span><span class='op'>)</span></span>
<span><span class='va'>logLp_</span> <span class='op'>&lt;-</span> <span class='va'>y</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>n</span> <span class='op'>-</span> <span class='va'>y</span><span class='op'>)</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>-</span> <span class='va'>p</span><span class='op'>)</span> <span class='co'># logL as fn of p</span></span>
<span><span class='va'>s_b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>*</span> <span class='va'>b</span><span class='op'>)</span>                           <span class='co'># s as fn of b</span></span>
<span><span class='va'>p_b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/subs.html'>subs</a></span><span class='op'>(</span><span class='va'>p_s</span>, <span class='va'>s</span>, <span class='va'>s_b</span><span class='op'>)</span>                    <span class='co'># p as fn of b</span></span>
<span><span class='va'>logLb_</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/subs.html'>subs</a></span><span class='op'>(</span><span class='va'>logLp_</span>, <span class='va'>p</span>, <span class='va'>p_b</span><span class='op'>)</span>              <span class='co'># logL as fn of b</span></span>
<span><span class='va'>Sb_</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/score_hessian.html'>score</a></span><span class='op'>(</span><span class='va'>logLb_</span>, <span class='va'>b</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/simplify.html'>simplify</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='va'>Hb_</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/score_hessian.html'>hessian</a></span><span class='op'>(</span><span class='va'>logLb_</span>, <span class='va'>b</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/simplify.html'>simplify</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{align}
\texttt{p\_b}   &amp;= \frac{e^{b_{1} x_{1} + b_{2} x_{2}}}{e^{b_{1} x_{1} + b_{2} x_{2}} + 1}; \\
\texttt{logLb}\_ &amp;= y \log{\left(\frac{e^{b_{1} x_{1} + b_{2} x_{2}}}{e^{b_{1} x_{1} + b_{2} x_{2}} + 1} \right)} + \left(n - y\right) \log{\left(1 - \frac{e^{b_{1} x_{1} + b_{2} x_{2}}}{e^{b_{1} x_{1} + b_{2} x_{2}} + 1} \right)}; \\
\texttt{Sb}\_    &amp;= \left[\begin{matrix}\frac{x_{1} \left(- n e^{b_{1} x_{1} + b_{2} x_{2}} + y e^{b_{1} x_{1} + b_{2} x_{2}} + y\right)}{e^{b_{1} x_{1} + b_{2} x_{2}} + 1}\\\frac{x_{2} \left(- n e^{b_{1} x_{1} + b_{2} x_{2}} + y e^{b_{1} x_{1} + b_{2} x_{2}} + y\right)}{e^{b_{1} x_{1} + b_{2} x_{2}} + 1}\end{matrix}\right]; \\
\texttt{Hb}\_    &amp;= \left[\begin{matrix}- \frac{n x_{1}^{2} e^{b_{1} x_{1} + b_{2} x_{2}}}{2 e^{b_{1} x_{1} + b_{2} x_{2}} + e^{2 b_{1} x_{1} + 2 b_{2} x_{2}} + 1} &amp; - \frac{n x_{1} x_{2} e^{b_{1} x_{1} + b_{2} x_{2}}}{2 e^{b_{1} x_{1} + b_{2} x_{2}} + e^{2 b_{1} x_{1} + 2 b_{2} x_{2}} + 1}\\- \frac{n x_{1} x_{2} e^{b_{1} x_{1} + b_{2} x_{2}}}{2 e^{b_{1} x_{1} + b_{2} x_{2}} + e^{2 b_{1} x_{1} + 2 b_{2} x_{2}} + 1} &amp; - \frac{n x_{2}^{2} e^{b_{1} x_{1} + b_{2} x_{2}}}{2 e^{b_{1} x_{1} + b_{2} x_{2}} + e^{2 b_{1} x_{1} + 2 b_{2} x_{2}} + 1}\end{matrix}\right] .
\end{align}\]</span></p>
<p>There are some possible approaches before
maximizing the total log likelihood. One is to insert data case by
case into the symbolic log likelihood:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>nms</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x1"</span>, <span class='st'>"x2"</span>, <span class='st'>"y"</span>, <span class='st'>"n"</span><span class='op'>)</span></span>
<span><span class='va'>DM_lst</span> <span class='op'>&lt;-</span> <span class='fu'>doBy</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/doBy/man/split_byrow_bycol.html'>split_byrow</a></span><span class='op'>(</span><span class='va'>DM</span><span class='op'>)</span></span>
<span><span class='va'>logLb_lst</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>DM_lst</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>vls</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/subs.html'>subs</a></span><span class='op'>(</span><span class='va'>logLb_</span>, <span class='va'>nms</span>, <span class='va'>vls</span><span class='op'>)</span></span>
<span><span class='op'>}</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>For example, the contribution from the third observation to the total log likelihood is:</p>
<p><span class="math display">\[\begin{align}
\texttt{logLb\_lst[[3]]}  &amp;= 9 \log{\left(\frac{e^{b_{1} + 2 b_{2}}}{e^{b_{1} + 2 b_{2}} + 1} \right)} + 11 \log{\left(1 - \frac{e^{b_{1} + 2 b_{2}}}{e^{b_{1} + 2 b_{2}} + 1} \right)}.
\end{align}\]</span></p>
<p>The full likelihood can be maximized either e.g. 
using SymPy (not pursued here) or by converting the sum to an R
function which can be maximized using one of R’s internal
optimization procedures:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>logLb_tot</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Reduce</a></span><span class='op'>(</span><span class='va'>`+`</span>, <span class='va'>logLb_lst</span><span class='op'>)</span> </span>
<span><span class='va'>logLb_fn</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_func.html'>as_func</a></span><span class='op'>(</span><span class='va'>logLb_tot</span>, vec_arg <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span><span class='va'>opt</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/optim.html'>optim</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>b1 <span class='op'>=</span> <span class='fl'>0</span>, b2 <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>, <span class='va'>logLb_fn</span>, </span>
<span>              control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>fnscale <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>, hessian <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span><span class='va'>opt</span><span class='op'>$</span><span class='va'>par</span></span></code></pre>
</div>
<pre><code>   b1    b2 
-2.82  1.26 </code></pre>
</div>
<p>The same model can be fitted e.g. using R’s <code>glm()</code> function as follows:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>ndead</span>, <span class='va'>ntotal</span> <span class='op'>-</span> <span class='va'>ndead</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log2</a></span><span class='op'>(</span><span class='va'>dose</span><span class='op'>)</span>, family<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>bud</span><span class='op'>)</span></span>
<span><span class='va'>m</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>(Intercept)  log2(dose) 
      -2.82        1.26 </code></pre>
</div>
<h4 class="unnumbered" data-number="3.2.2" id="the-total-likelihood-symbolically">The total likelihood symbolically</h4>
<p>We conclude this section by illustrating that the log-likelihood for the entire dataset
can be constructed in a few steps (output is omitted to save space):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>N</span> <span class='op'>&lt;-</span> <span class='fl'>6</span>; <span class='va'>q</span> <span class='op'>&lt;-</span> <span class='fl'>2</span></span>
<span><span class='va'>X</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>matrix_sym</a></span><span class='op'>(</span><span class='va'>N</span>, <span class='va'>q</span>, <span class='st'>"x"</span><span class='op'>)</span></span>
<span><span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='va'>N</span>, <span class='st'>"n"</span><span class='op'>)</span></span>
<span><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='va'>N</span>, <span class='st'>"y"</span><span class='op'>)</span></span>
<span><span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='va'>N</span>, <span class='st'>"p"</span><span class='op'>)</span></span>
<span><span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='va'>N</span>, <span class='st'>"s"</span><span class='op'>)</span></span>
<span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='va'>q</span>, <span class='st'>"b"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
X=\left[\begin{matrix}x_{11} &amp; x_{12}\\x_{21} &amp; x_{22}\\x_{31} &amp; x_{32}\\x_{41} &amp; x_{42}\\x_{51} &amp; x_{52}\\x_{61} &amp; x_{62}\end{matrix}\right]; \quad
n=\left[\begin{matrix}n_{1}\\n_{2}\\n_{3}\\n_{4}\\n_{5}\\n_{6}\end{matrix}\right]; \quad
y=\left[\begin{matrix}y_{1}\\y_{2}\\y_{3}\\y_{4}\\y_{5}\\y_{6}\end{matrix}\right] .
\end{equation}\]</span></p>
<p>The symbolic computations are as follows: We express the linear predictor <span class="math inline">\(s\)</span> as function of the regression coefficients <span class="math inline">\(b\)</span> and express the probability <span class="math inline">\(p\)</span> as function of the linear predictor:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>logLp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>n</span> <span class='op'>-</span> <span class='va'>y</span><span class='op'>)</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>-</span> <span class='va'>p</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># logL as fn of p</span></span>
<span><span class='va'>p_s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>1</span><span class='op'>)</span>                    <span class='co'># p as fn of s</span></span>
<span><span class='va'>s_b</span> <span class='op'>&lt;-</span> <span class='va'>X</span> <span class='op'><a href='https://rdrr.io/pkg/caracas/man/matrix-products.html'>%*%</a></span> <span class='va'>b</span>                                  <span class='co'># s as fn of b</span></span>
<span><span class='va'>p_b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/subs.html'>subs</a></span><span class='op'>(</span><span class='va'>p_s</span>, <span class='va'>s</span>, <span class='va'>s_b</span><span class='op'>)</span>                        <span class='co'># p as fn of b</span></span>
<span><span class='va'>logLb_</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/subs.html'>subs</a></span><span class='op'>(</span><span class='va'>logLp</span>, <span class='va'>p</span>, <span class='va'>p_b</span><span class='op'>)</span>                   <span class='co'># logL as fn of b</span></span></code></pre>
</div>
</div>
<p>Next step could be to go from symbolic to numerical computations by
inserting numerical values. From here, one may proceed by computing
the score function and the Hessian matrix and solve the score
equation, using e.g. Newton-Raphson. Alternatively, one might create an
R function based on the log-likelihood, and maximize this function
using one of R’s optimization methods (see the example in the
previous section):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>logLb</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/subs.html'>subs</a></span><span class='op'>(</span><span class='va'>logLb_</span>, <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>X</span>, <span class='va'>y</span>, <span class='va'>n</span><span class='op'>)</span>, <span class='va'>DM</span><span class='op'>)</span></span>
<span><span class='va'>logLb_fn</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_func.html'>as_func</a></span><span class='op'>(</span><span class='va'>logLb</span>, vec_arg <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span><span class='va'>opt</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/optim.html'>optim</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>b1 <span class='op'>=</span> <span class='fl'>0</span>, b2 <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>, <span class='va'>logLb_fn</span>, </span>
<span>              control <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>fnscale <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>, hessian <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span><span class='va'>opt</span><span class='op'>$</span><span class='va'>par</span></span></code></pre>
</div>
<pre><code>   b1    b2 
-2.82  1.26 </code></pre>
</div>
<h3 data-number="3.3" id="example-constrained-maximum-likelihood"><span class="header-section-number">3.3</span> Example: Constrained maximum likelihood</h3>
<p>In this section we illustrate constrained optimization using Lagrange multipliers.
This is demonstrated for the independence model for a two-way contingency table.
Consider a <span class="math inline">\(2 \times 2\)</span> contingency table with cell
counts <span class="math inline">\(y_{ij}\)</span> and cell probabilities <span class="math inline">\(p_{ij}\)</span> for <span class="math inline">\(i=1,2\)</span> and <span class="math inline">\(j=1,2\)</span>,
where <span class="math inline">\(i\)</span> refers to row and <span class="math inline">\(j\)</span> to column as
illustrated in Table <a href="#tab:anova-two-way-table">1</a>.</p>
<p>Under multinomial sampling, the log likelihood is</p>
<p><span class="math display">\[\begin{equation}
l = \log L = \sum_{ij} y_{ij} \log(p_{ij}).
\end{equation}\]</span></p>
<p>Under the assumption of independence between rows and columns, the cell
probabilities have the form, (see e.g. <span class="citation" data-cites="hojsgaard">Højsgaard et al. (<a href="#ref-hojsgaard" role="doc-biblioref">2012</a>)</span>, p. 32)</p>
<p><span class="math display">\[\begin{equation}
p_{ij}=u \cdot r_i \cdot s_j.
\end{equation}\]</span></p>
<p>To make the parameters <span class="math inline">\((u, r_i, s_j)\)</span> identifiable, constraints
must be imposed. One possibility is to require that <span class="math inline">\(r_1=s_1=1\)</span>. The
task is then to estimate <span class="math inline">\(u\)</span>, <span class="math inline">\(r_2\)</span>, <span class="math inline">\(s_2\)</span> by maximizing the log likelihood
under the constraint that <span class="math inline">\(\sum_{ij} p_{ij} = 1\)</span>. These constraints
can be
imposed using a Lagrange multiplier where we solve the
unconstrained optimization problem <span class="math inline">\(\max_p Lag(p)\)</span> where
<span class="math display">\[\begin{align}
  Lag(p) &amp;= -l(p) + \lambda g(p) \quad \text{under the constraint that} \\
  g(p) &amp;= \sum_{ij} p_{ij} - 1 = 0 ,
\end{align}\]</span>
where <span class="math inline">\(\lambda\)</span> is a Lagrange multiplier.
The likelihood equations can be found in closed-form.
In SymPy, <code>lambda</code> is a reserved symbol so it is denoted by an postfixed underscore below:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/def_sym.html'>def_sym</a></span><span class='op'>(</span><span class='va'>u</span>, <span class='va'>r2</span>, <span class='va'>s2</span>, <span class='va'>lambda_</span><span class='op'>)</span></span>
<span><span class='va'>y</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_sym.html'>as_sym</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"y_11"</span>, <span class='st'>"y_21"</span>, <span class='st'>"y_12"</span>, <span class='st'>"y_22"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_sym.html'>as_sym</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"u"</span>, <span class='st'>"u*r2"</span>, <span class='st'>"u*s2"</span>, <span class='st'>"u*r2*s2"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>logL</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>Lag</span>  <span class='op'>&lt;-</span> <span class='op'>-</span><span class='va'>logL</span> <span class='op'>+</span> <span class='va'>lambda_</span> <span class='op'>*</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> </span>
<span><span class='va'>vars</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>u</span>, <span class='va'>r2</span>, <span class='va'>s2</span>, <span class='va'>lambda_</span><span class='op'>)</span></span>
<span><span class='va'>gLag</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/der.html'>der</a></span><span class='op'>(</span><span class='va'>Lag</span>, <span class='va'>vars</span><span class='op'>)</span></span>
<span><span class='va'>sol</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/solve_sys.html'>solve_sys</a></span><span class='op'>(</span><span class='va'>gLag</span>, <span class='va'>vars</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>sol</span>, method <span class='op'>=</span> <span class='st'>"ascii"</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>Solution 1:
  lambda_ =  y_11 + y_12 + y_21 + y_22 
  r2      =  (y_21 + y_22)/(y_11 + y_12) 
  s2      =  (y_12 + y_22)/(y_11 + y_21) 
  u       =  (y_11 + y_12)*(y_11 + y_21)/(y_11 + y_12 + y_21 + y_22)^2 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>sol</span> <span class='op'>&lt;-</span> <span class='va'>sol</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span></span></code></pre>
</div>
</div>
<p>There is only one critical point. The fitted cell probabilities <span class="math inline">\(\hat p_{ij}\)</span> are:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p11</span> <span class='op'>&lt;-</span> <span class='va'>sol</span><span class='op'>$</span><span class='va'>u</span></span>
<span><span class='va'>p21</span> <span class='op'>&lt;-</span> <span class='va'>sol</span><span class='op'>$</span><span class='va'>u</span> <span class='op'>*</span> <span class='va'>sol</span><span class='op'>$</span><span class='va'>r2</span></span>
<span><span class='va'>p12</span> <span class='op'>&lt;-</span> <span class='va'>sol</span><span class='op'>$</span><span class='va'>u</span> <span class='op'>*</span> <span class='va'>sol</span><span class='op'>$</span><span class='va'>s2</span></span>
<span><span class='va'>p22</span> <span class='op'>&lt;-</span> <span class='va'>sol</span><span class='op'>$</span><span class='va'>u</span> <span class='op'>*</span> <span class='va'>sol</span><span class='op'>$</span><span class='va'>r2</span> <span class='op'>*</span> <span class='va'>sol</span><span class='op'>$</span><span class='va'>s2</span></span>
<span><span class='va'>p.hat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/matrix_.html'>matrix_</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>p11</span>, <span class='va'>p21</span>, <span class='va'>p12</span>, <span class='va'>p22</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
\hat p = \frac{1}{\left(y_{11} + y_{12} + y_{21} + y_{22}\right)^{2}}  \left[\begin{matrix}\left(y_{11} + y_{12}\right) \left(y_{11} + y_{21}\right) &amp; \left(y_{11} + y_{12}\right) \left(y_{12} + y_{22}\right)\\\left(y_{11} + y_{21}\right) \left(y_{21} + y_{22}\right) &amp; \left(y_{12} + y_{22}\right) \left(y_{21} + y_{22}\right)\end{matrix}\right]
\end{equation}\]</span></p>
<p>To verify that the maximum likelihood estimate has been found, we compute the Hessian matrix
which is negative definite (the Hessian matrix is diagonal so the eigenvalues are the diagonal entries and these are all negative), output omitted:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>H</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/score_hessian.html'>hessian</a></span><span class='op'>(</span><span class='va'>logL</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>u</span>, <span class='va'>r2</span>, <span class='va'>s2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/simplify.html'>simplify</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<!--
FIXME: eval = FALSE for faster compilation
-->
<div class="layout-chunk" data-layout="l-body">

</div>
<!--
FIXME: eval = FALSE for faster compilation
-->
<div class="layout-chunk" data-layout="l-body">

</div>
<h3 data-number="3.4" id="example-an-auto-regression-model"><span class="header-section-number">3.4</span> Example: An auto regression model</h3>
<h4 class="unnumbered" data-number="3.4.1" id="symbolic-computations">Symbolic computations</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>In this section we study the auto regressive model of order <span class="math inline">\(1\)</span> (an AR(1) model, see
e.g. <span class="citation" data-cites="shumway:etal:16">Shumway and Stoffer (<a href="#ref-shumway:etal:16" role="doc-biblioref">2016</a>)</span>, p. 75):
Consider random variables <span class="math inline">\(x_1, x_2, \dots, x_n\)</span> following a stationary zero mean AR(1) process:</p>
<p><span class="math display" id="eq:ar1">\[\begin{equation}
  x_i = a x_{i-1} + e_i; \quad i=2, \dots, n,
  \tag{1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(e_i \sim N(0, v)\)</span> and all independent and with constant variance <span class="math inline">\(v\)</span>.
The marginal distribution of <span class="math inline">\(x_1\)</span> is also assumed normal, and for the process to be stationary
we must have that the variance <span class="math inline">\(\mathbf{Var}(x_1) = v / (1-a^2)\)</span>.
Hence we can write <span class="math inline">\(x_1 = \frac 1 {\sqrt{1-a^2}} e_1\)</span>.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>For simplicity of exposition, we set <span class="math inline">\(n=4\)</span> such that <span class="math inline">\(e=(e_1, \dots, e_4)\)</span> and <span class="math inline">\(x=(x_1, \dots x_4)\)</span>. Hence <span class="math inline">\(e \sim N(0, v I)\)</span>. Isolating
error terms in <a href="#eq:ar1">(1)</a> gives</p>
<p><span class="math display">\[\begin{equation}
  e= \left[\begin{matrix}e_{1}\\e_{2}\\e_{3}\\e_{4}\end{matrix}\right] = \left[\begin{matrix}\sqrt{1 - a^{2}} &amp; . &amp; . &amp; .\\- a &amp; 1 &amp; . &amp; .\\. &amp; - a &amp; 1 &amp; .\\. &amp; . &amp; - a &amp; 1\end{matrix}\right] \left[\begin{matrix}x_{1}\\x_{2}\\x_{3}\\x_{4}\end{matrix}\right] = L x  .
\end{equation}\]</span></p>
<p>Since
<span class="math inline">\(\mathbf{Var}(e)=v I\)</span> we have <span class="math inline">\(\mathbf{Var}(e)=v I=L \mathbf{Var}(x) L^\top\)</span> so the covariance matrix of <span class="math inline">\(x\)</span> is <span class="math inline">\(V=\mathbf{Var}(x) = v L^{-1} \left (L^{-1} \right )^\top\)</span> while the concentration matrix (the inverse covariance
matrix) is <span class="math inline">\(K=v^{-1}L^\top L\)</span>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/def_sym.html'>def_sym</a></span><span class='op'>(</span><span class='va'>a</span>, <span class='va'>v</span><span class='op'>)</span></span>
<span><span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>4</span></span>
<span><span class='va'>L</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/diff_mat.html'>diff_mat</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='st'>"-a"</span><span class='op'>)</span> <span class='co'># The difference matrix, L, shown above</span></span>
<span><span class='va'>L</span><span class='op'>[</span><span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>-</span> <span class='va'>a</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='va'>Linv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>L</span><span class='op'>)</span></span>
<span><span class='va'>K</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/matrix_cross_product.html'>crossprod_</a></span><span class='op'>(</span><span class='va'>L</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>v</span></span>
<span><span class='va'>V</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/matrix_cross_product.html'>tcrossprod_</a></span><span class='op'>(</span><span class='va'>Linv</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>v</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><span class="math display">\[\begin{align}
    L^{-1} &amp;= \left[\begin{matrix}\frac{1}{\sqrt{1 - a^{2}}} &amp; . &amp; . &amp; .\\\frac{a}{\sqrt{1 - a^{2}}} &amp; 1 &amp; . &amp; .\\\frac{a^{2}}{\sqrt{1 - a^{2}}} &amp; a &amp; 1 &amp; .\\\frac{a^{3}}{\sqrt{1 - a^{2}}} &amp; a^{2} &amp; a &amp; 1\end{matrix}\right] ; \\
    K &amp;= \frac{1}{v}  \left[\begin{matrix}1 &amp; - a &amp; 0 &amp; 0\\- a &amp; a^{2} + 1 &amp; - a &amp; 0\\0 &amp; - a &amp; a^{2} + 1 &amp; - a\\0 &amp; 0 &amp; - a &amp; 1\end{matrix}\right] ; \\
    V &amp;= \frac{v}{a^{2} - 1}  \left[\begin{matrix}-1 &amp; - a &amp; - a^{2} &amp; - a^{3}\\- a &amp; -1 &amp; - a &amp; - a^{2}\\- a^{2} &amp; - a &amp; -1 &amp; - a\\- a^{3} &amp; - a^{2} &amp; - a &amp; -1\end{matrix}\right]  .
  \end{align}\]</span></p>
</div>
<p>The zeros in the concentration matrix <span class="math inline">\(K\)</span> implies a conditional
independence restriction: If the <span class="math inline">\(ij\)</span>th element of a concentration
matrix is zero then <span class="math inline">\(x_i\)</span> and <span class="math inline">\(x_j\)</span> are conditionally independent
given all other variables (see e.g. <span class="citation" data-cites="hojsgaard">Højsgaard et al. (<a href="#ref-hojsgaard" role="doc-biblioref">2012</a>)</span>, p. 84 for
details).</p>
<p>Next, we take the step from symbolic computations to numerical
evaluations. The joint distribution of <span class="math inline">\(x\)</span> is multivariate normal
distribution, <span class="math inline">\(x\sim N(0, K^{-1})\)</span>. Let <span class="math inline">\(W=x x^\top\)</span> denote the
matrix of (cross) products. The log-likelihood is therefore (ignoring
additive constants)</p>
<p><span class="math display">\[\begin{equation}
\log L = \frac n 2 (\log \mathbf{det}(K) - x^\top K x) = \frac n 2 (\log \mathbf{det}(K) - \mathbf{tr}(K W)),
\end{equation}\]</span></p>
<p>where we note that <span class="math inline">\(\mathbf{tr}(KW)\)</span> is the
sum of the elementwise products of <span class="math inline">\(K\)</span> and <span class="math inline">\(W\)</span> since both matrices are
symmetric. Ignoring the constant <span class="math inline">\(\frac n 2\)</span>,
this can be written symbolically to obtain the expression in
this particular case:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/generic-matrices.html'>vector_sym</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='st'>"x"</span><span class='op'>)</span></span>
<span><span class='va'>logL</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/linalg.html'>det</a></span><span class='op'>(</span><span class='va'>K</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>K</span> <span class='op'>*</span> <span class='op'>(</span><span class='va'>x</span> <span class='op'><a href='https://rdrr.io/pkg/caracas/man/matrix-products.html'>%*%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/simplify.html'>simplify</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
\log L = \log{\left(- \frac{a^{2}}{v^{4}} + \frac{1}{v^{4}} \right)} - \frac{- 2 a x_{1} x_{2} - 2 a x_{2} x_{3} - 2 a x_{3} x_{4} + x_{1}^{2} + x_{2}^{2} \left(a^{2} + 1\right) + x_{3}^{2} \left(a^{2} + 1\right) + x_{4}^{2}}{v} .
\end{equation}\]</span></p>
<h4 class="unnumbered" data-number="3.4.2" id="numerical-evaluation">Numerical evaluation</h4>
<p>Next we illustrate how bridge the gap from symbolic computations to numerical computations based on a dataset:
For a specific data vector we get:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>xt</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.1</span>, <span class='op'>-</span><span class='fl'>0.9</span>, <span class='fl'>0.4</span>, <span class='fl'>0.0</span><span class='op'>)</span></span>
<span><span class='va'>logL.</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/subs.html'>subs</a></span><span class='op'>(</span><span class='va'>logL</span>, <span class='va'>x</span>, <span class='va'>xt</span><span class='op'>)</span> </span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
\log L = \log{\left(- \frac{a^{2}}{v^{4}} + \frac{1}{v^{4}} \right)} - \frac{0.97 a^{2} + 0.9 a + 0.98}{v} .
\end{equation}\]</span></p>
<p>We can use R for numerical maximization of the likelihood and constraints on the
parameter values can be imposed e.g. in the <code>optim()</code> function:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>logL_wrap</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_func.html'>as_func</a></span><span class='op'>(</span><span class='va'>logL.</span>, vec_arg <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span><span class='va'>eps</span> <span class='op'>&lt;-</span> <span class='fl'>0.01</span></span>
<span><span class='va'>par</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/optim.html'>optim</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>a<span class='op'>=</span><span class='fl'>0</span>, v<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>, <span class='va'>logL_wrap</span>, </span>
<span>             lower<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>-</span><span class='va'>eps</span><span class='op'>)</span>, <span class='va'>eps</span><span class='op'>)</span>, upper<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>-</span><span class='va'>eps</span><span class='op'>)</span>, <span class='fl'>10</span><span class='op'>)</span>,</span>
<span>             method<span class='op'>=</span><span class='st'>"L-BFGS-B"</span>, control<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>fnscale<span class='op'>=</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>$</span><span class='va'>par</span></span>
<span><span class='va'>par</span></span></code></pre>
</div>
<pre><code>     a      v 
-0.376  0.195 </code></pre>
</div>
<p>The same model can be fitted e.g. using R’s <code>arima()</code> function as follows (output omitted):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/stats/arima.html'>arima</a></span><span class='op'>(</span><span class='va'>xt</span>, order <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span>, include.mean <span class='op'>=</span> <span class='cn'>FALSE</span>, method <span class='op'>=</span> <span class='st'>"ML"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>It is less trivial to do the optimization in <code>caracas</code> by solving the score equations.
There are some possibilities for putting assumptions on variables
in <code>caracas</code> (see the “Reference” vignette), but
it is not possible to restrict the parameter <span class="math inline">\(a\)</span> to only take values in <span class="math inline">\((-1, 1)\)</span>.</p>
<h3 data-number="3.5" id="example-variance-of-average-of-correlated-variables"><span class="header-section-number">3.5</span> Example: Variance of average of correlated variables</h3>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Consider random
variables <span class="math inline">\(x_1,\dots, x_n\)</span> where <span class="math inline">\(\mathbf{Var}(x_i)=v\)</span> and <span class="math inline">\(\mathbf{Cov}(x_i, x_j)=v r\)</span> for <span class="math inline">\(i\not = j\)</span>, where <span class="math inline">\(0 \le |r| \le1\)</span>.
For <span class="math inline">\(n=3\)</span>, the covariance matrix of <span class="math inline">\((x_1,\dots, x_n)\)</span> is therefore</p>
<p><span class="math display">\[\begin{equation}
  \label{eq:1}
  V = v R = v \left[\begin{matrix}1 &amp; r &amp; r\\r &amp; 1 &amp; r\\r &amp; r &amp; 1\end{matrix}\right].
\end{equation}\]</span></p>
<p>Let <span class="math inline">\(\bar x = \sum_i x_i / n\)</span> denote the average. Suppose interest is
in the variance of the average, <span class="math inline">\(w_{nr}=\mathbf{Var}(\bar x)\)</span>, when <span class="math inline">\(n\)</span> goes
to infinity. Here the
subscripts <span class="math inline">\(n\)</span> and <span class="math inline">\(r\)</span> emphasize the dependence on the sample size <span class="math inline">\(n\)</span>
and the correlation <span class="math inline">\(r\)</span>.
The variance of a sum <span class="math inline">\(x. = \sum_i x_i\)</span> is
<span class="math inline">\(\mathbf{Var}(x.) = \sum_i \mathbf{Var}(x_i) + 2 \sum_{ij:i&lt;j} \mathbf{Cov}(x_i, x_j)\)</span> (i.e., the sum of the elements of the
covariance matrix). Then <span class="math inline">\(w_{nr}=Var(\bar x) = Var(x.)/n^2\)</span>.
We can do this in <code>caracas</code> as follows using the <code>sum_</code> function
that calculate a symbolic sum:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/def_sym.html'>def_sym</a></span><span class='op'>(</span><span class='va'>v</span>, <span class='va'>r</span>, <span class='va'>n</span>, <span class='va'>j</span>, <span class='va'>i</span><span class='op'>)</span></span>
<span><span class='va'>s1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/sum_.html'>sum_</a></span><span class='op'>(</span><span class='va'>r</span>, <span class='va'>j</span>, <span class='va'>i</span><span class='op'>+</span><span class='fl'>1</span>, <span class='va'>n</span><span class='op'>)</span> <span class='co'># sum_{j = i+1}^n r</span></span>
<span><span class='va'>s2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/sum_.html'>sum_</a></span><span class='op'>(</span><span class='va'>s1</span>, <span class='va'>i</span>, <span class='fl'>1</span>, <span class='va'>n</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/simplify.html'>simplify</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='va'>var_sum</span> <span class='op'>&lt;-</span> <span class='va'>v</span><span class='op'>*</span><span class='op'>(</span><span class='va'>n</span> <span class='op'>+</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='va'>s2</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/simplify.html'>simplify</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='va'>w_nr</span> <span class='op'>&lt;-</span> <span class='va'>var_sum</span> <span class='op'>/</span> <span class='va'>n</span><span class='op'>^</span><span class='fl'>2</span></span></code></pre>
</div>
</div>
<p>Above, <code>s1</code> is the sum of elements <span class="math inline">\(i+1\)</span> to <span class="math inline">\(n\)</span> in row <span class="math inline">\(j\)</span> of the covariance matrix
and therefore <code>s2</code> is the sum of the entire upper triangular of the covariance matrix.</p>
<p><span class="math display">\[\begin{align}
\texttt{s1} &amp;= r \left(- i + n\right); \quad
\texttt{s2} = \frac{n r \left(n - 1\right)}{2}; \quad
w_{nr} = \mathbf{Var}(\bar x)= \frac{v \left(r \left(n - 1\right) + 1\right)}{n}.
\end{align}\]</span></p>
<p>The limiting behavior of the variance
<span class="math inline">\(w_{nr}\)</span> can be studied in different situations (results shown later):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>l_1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/lim.html'>lim</a></span><span class='op'>(</span><span class='va'>w_nr</span>, <span class='va'>n</span>, <span class='cn'>Inf</span><span class='op'>)</span>           <span class='co'># when sample size n goes to infinity</span></span>
<span><span class='va'>l_2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/lim.html'>lim</a></span><span class='op'>(</span><span class='va'>w_nr</span>, <span class='va'>r</span>, <span class='fl'>0</span>, dir <span class='op'>=</span> <span class='st'>'+'</span><span class='op'>)</span>  <span class='co'># when correlation r goes to zero</span></span>
<span><span class='va'>l_3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/lim.html'>lim</a></span><span class='op'>(</span><span class='va'>w_nr</span>, <span class='va'>r</span>, <span class='fl'>1</span>, dir <span class='op'>=</span> <span class='st'>'-'</span><span class='op'>)</span>  <span class='co'># when correlation r goes to one</span></span></code></pre>
</div>
</div>
<p>Moreover, for a given correlation
<span class="math inline">\(r\)</span> it is instructive to investigate how many independent variables,
say <span class="math inline">\(k_{nr}\)</span> the <span class="math inline">\(n\)</span> correlated variables correspond to (in the sense of
giving the same variance of the average), because then <span class="math inline">\(k_{nr}\)</span> can be seen as a
measure of the amount of information in data. We call <span class="math inline">\(k_{nr}\)</span> the
effective sample size. Moreover, one might study how <span class="math inline">\(k_{nr}\)</span> behaves
as function of <span class="math inline">\(n\)</span> when <span class="math inline">\(n \rightarrow \infty\)</span>. That is we must (1)
solve <span class="math inline">\(v (1 + (n-1)r)/n = v/k_{nr}\)</span> for <span class="math inline">\(k_{nr}\)</span> and (2) find the limit <span class="math inline">\(k_r = \lim_{n\rightarrow\infty} k_{nr}\)</span>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/def_sym.html'>def_sym</a></span><span class='op'>(</span><span class='va'>k_n</span><span class='op'>)</span></span>
<span><span class='va'>sol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/solve_sys.html'>solve_sys</a></span><span class='op'>(</span><span class='va'>w_nr</span> <span class='op'>-</span> <span class='va'>v</span> <span class='op'>/</span> <span class='va'>k_n</span>, <span class='va'>k_n</span><span class='op'>)</span></span>
<span><span class='va'>k_nr</span> <span class='op'>&lt;-</span> <span class='va'>sol</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>k_n</span>                  <span class='co'># effective sample size</span></span>
<span><span class='va'>k_r</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/lim.html'>lim</a></span><span class='op'>(</span><span class='va'>k_nr</span>, <span class='va'>n</span>, <span class='cn'>Inf</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The findings above are:</p>
<p><span class="math display">\[\begin{equation}
l_1 = \lim_{n\rightarrow\infty} w_{nr} = r v; \quad
l_2 = \lim_{r\rightarrow 0} w_{nr} = \frac{v}{n}; \quad
l_3 = \lim_{r\rightarrow 1} w_{nr} = v; \quad
k_{nr} = \frac{n}{n r - r + 1}; \quad
k_r = \frac{1}{r} .
\end{equation}\]</span></p>
<p>It is illustrative to supplement the symbolic computations above with
numerical evaluations, which shows that even a moderate correlation
reduces the effective sample size substantially. In
Fig. <a href="#fig:correlated">3</a>, this is illustrated for a wider range of
correlations and sample sizes.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>r <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.1</span>, <span class='fl'>.2</span>, <span class='fl'>.5</span><span class='op'>)</span>, n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>50</span>, <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>k_nr_fn</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_func.html'>as_func</a></span><span class='op'>(</span><span class='va'>k_nr</span><span class='op'>)</span></span>
<span><span class='va'>dat</span><span class='op'>$</span><span class='va'>k_nr</span> <span class='op'>&lt;-</span> <span class='fu'>k_nr_fn</span><span class='op'>(</span>r <span class='op'>=</span> <span class='va'>dat</span><span class='op'>$</span><span class='va'>r</span>, n <span class='op'>=</span> <span class='va'>dat</span><span class='op'>$</span><span class='va'>n</span><span class='op'>)</span></span>
<span><span class='va'>dat</span><span class='op'>$</span><span class='va'>k_r</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='op'>/</span> <span class='va'>dat</span><span class='op'>$</span><span class='va'>r</span></span>
<span><span class='va'>dat</span></span></code></pre>
</div>
<pre><code>    r    n k_nr k_r
1 0.1   10 5.26  10
2 0.2   10 3.57   5
3 0.5   10 1.82   2
4 0.1   50 8.47  10
5 0.2   50 4.63   5
6 0.5   50 1.96   2
7 0.1 1000 9.91  10
8 0.2 1000 4.98   5
9 0.5 1000 2.00   2</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span style="display:block;" id="fig:correlated"></span>
<img src="RJ-2023-090_files/figure-html5/correlated-1.png" alt="Effective sample size $k_{nr}$ as function of correlation $r$ for different values of $n$. The dashed line is the limit of $k_r$ as $r \rightarrow 1$, i.e. 1. " width="480"  />
<p class="caption">
Figure 3: Effective sample size <span class="math inline">\(k_{nr}\)</span> as function of correlation <span class="math inline">\(r\)</span> for different values of <span class="math inline">\(n\)</span>. The dashed line is the limit of <span class="math inline">\(k_r\)</span> as <span class="math inline">\(r \rightarrow 1\)</span>, i.e. 1.
</p>
</div>
</div>
<h2 data-number="4" id="further-topics"><span class="header-section-number">4</span> Further topics</h2>
<h3 data-number="4.1" id="integration-limits-and-unevaluated-expressions"><span class="header-section-number">4.1</span> Integration, limits, and unevaluated expressions</h3>
<p>The unit circle is given by <span class="math inline">\(x^2 + y^2 = 1\)</span> so the area of the upper
half of the unit circle is <span class="math inline">\(\int_{-1}^1 \sqrt{1-x^2}\; dx\)</span> (which is
known to be <span class="math inline">\(\pi/2\)</span>). This result is produced by <code>caracas</code> while the
<code>integrate</code> function in R produces the approximate result <span class="math inline">\(1.57\)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_sym.html'>as_sym</a></span><span class='op'>(</span><span class='st'>"x"</span><span class='op'>)</span></span>
<span><span class='va'>half_circle_</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>-</span> <span class='va'>x</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='va'>ad</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/int.html'>int</a></span><span class='op'>(</span><span class='va'>half_circle_</span>, <span class='st'>"x"</span><span class='op'>)</span>          <span class='co'># Anti derivative</span></span>
<span><span class='va'>area</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/int.html'>int</a></span><span class='op'>(</span><span class='va'>half_circle_</span>, <span class='st'>"x"</span>, <span class='op'>-</span><span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='co'># Definite integral</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
\texttt{ad} = \frac{x \sqrt{1 - x^{2}}}{2} + \frac{\operatorname{asin}{\left(x \right)}}{2}; \quad
\texttt{area} = \frac{\pi}{2}.
\end{equation}\]</span></p>
<p>Finally, we illustrate limits and the creation of unevaluated expressions:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/def_sym.html'>def_sym</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>n</span><span class='op'>)</span></span>
<span><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>/</span><span class='va'>n</span><span class='op'>)</span><span class='op'>^</span><span class='va'>n</span></span>
<span><span class='va'>l</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/lim.html'>lim</a></span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>n</span>, <span class='cn'>Inf</span>, doit <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span><span class='va'>l_2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/doit.html'>doit</a></span><span class='op'>(</span><span class='va'>l</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
l = \lim_{n \to \infty} \left(1 + \frac{x}{n}\right)^{n}; \quad l_2 = e^{x}
\end{equation}\]</span></p>
<p>Several functions have the <code>doit</code> argument, e.g. <code>lim()</code>, <code>int()</code> and <code>sum_()</code>.
Among other things, unevaluated expressions help making reproducible documents where the changes
in code appears automatically in the generated formulas.</p>
<h3 data-number="4.2" id="documents-with-mathematical-content"><span class="header-section-number">4.2</span> Documents with mathematical content</h3>
<p>A LaTeX rendering of a <code>caracas</code> symbol, say <code>x</code>, is obtained by typing
<code>$$x = `r tex(x)`$$</code>. This feature is useful
when creating documents with a mathematical content and has been used
extensively throughout this paper.</p>
<p>For rendering matrices, the <code>tex()</code> function
has a <code>zero_as_dot</code> argument which is useful:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>A</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/diag_.html'>diag_</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"c"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
\texttt{tex(A)} = \left[\begin{matrix}a &amp; 0 &amp; 0\\0 &amp; b &amp; 0\\0 &amp; 0 &amp; c\end{matrix}\right]; \quad \texttt{tex(A, zero\_as\_dot = TRUE)} = \left[\begin{matrix}a &amp; . &amp; .\\. &amp; b &amp; .\\. &amp; . &amp; c\end{matrix}\right]
\end{equation}\]</span></p>
<p>When displaying a matrix <span class="math inline">\(A\)</span>, the expression can sometimes be greatly
simplified by displaying <span class="math inline">\(k\)</span> and <span class="math inline">\((A/k)\)</span> for some factor <span class="math inline">\(k\)</span>. A specific
example could when displaying <span class="math inline">\(M^{-1}\)</span>. Here one may choose to display
<span class="math inline">\((1/det(M))\)</span> and <span class="math inline">\(M^{-1} det(M)\)</span>. This can be illustrated as follows:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>M0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/toeplitz.html'>toeplitz</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'># Character matrix</span></span>
<span><span class='va'>M</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_sym.html'>as_sym</a></span><span class='op'>(</span><span class='va'>M0</span><span class='op'>)</span>             <span class='co'># as_sym() converts to a caracas symbol</span></span>
<span><span class='va'>Minv</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/solve.html'>solve</a></span><span class='op'>(</span><span class='va'>M</span><span class='op'>)</span></span>
<span><span class='va'>Minv2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/scale_matrix.html'>scale_matrix</a></span><span class='op'>(</span><span class='va'>Minv</span>, <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/linalg.html'>det</a></span><span class='op'>(</span><span class='va'>Minv</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
\texttt{Minv} = \left[\begin{matrix}\frac{a}{a^{2} - b^{2}} &amp; - \frac{b}{a^{2} - b^{2}}\\- \frac{b}{a^{2} - b^{2}} &amp; \frac{a}{a^{2} - b^{2}}\end{matrix}\right]; \quad
\texttt{Minv2} = \frac{1}{a^{2} - b^{2}}  \left[\begin{matrix}a &amp; - b\\- b &amp; a\end{matrix}\right]
\end{equation}\]</span></p>
<h3 data-number="4.3" id="extending-caracas"><span class="header-section-number">4.3</span> Extending <code>caracas</code></h3>
<p>It is possible to easily extend <code>caracas</code> with additional
functionality from SymPy using <code>sympy_func()</code> from <code>caracas</code>
which we illustrate below. This example
illustrates how to use SymPy’s <code>diff()</code> function to find univariate
derivatives multiple times. The partial derivative of <span class="math inline">\(\sin(xy)\)</span>
with respect to <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> is found with <code>diff</code> in SymPy:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://rstudio.github.io/reticulate/'>reticulate</a></span><span class='op'>)</span></span>
<span><span class='va'>sympy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rstudio.github.io/reticulate/reference/import.html'>import</a></span><span class='op'>(</span><span class='st'>"sympy"</span><span class='op'>)</span></span>
<span><span class='va'>sympy</span><span class='op'>$</span><span class='fu'>diff</span><span class='op'>(</span><span class='st'>"sin(x * y)"</span>, <span class='st'>"x"</span>, <span class='st'>"y"</span><span class='op'>)</span> </span></code></pre>
</div>
<pre><code>-x*y*sin(x*y) + cos(x*y)</code></pre>
</div>
<p>Alternatively:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>sympy</span><span class='op'>$</span><span class='fu'>symbols</span><span class='op'>(</span><span class='st'>"x"</span><span class='op'>)</span></span>
<span><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='va'>sympy</span><span class='op'>$</span><span class='fu'>symbols</span><span class='op'>(</span><span class='st'>"y"</span><span class='op'>)</span></span>
<span><span class='va'>sympy</span><span class='op'>$</span><span class='fu'>diff</span><span class='op'>(</span><span class='va'>sympy</span><span class='op'>$</span><span class='fu'>sin</span><span class='op'>(</span><span class='va'>x</span><span class='op'>*</span><span class='va'>y</span><span class='op'>)</span>, <span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>One the other hand, the <code>der()</code> function in <code>caracas</code> finds the
gradient, which is a design choice in <code>caracas</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/def_sym.html'>def_sym</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span></span>
<span><span class='va'>f</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>*</span> <span class='va'>y</span><span class='op'>)</span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/caracas/man/der.html'>der</a></span><span class='op'>(</span><span class='va'>f</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>c: [y*cos(x*y), x*cos(x*y)]</code></pre>
</div>
<p>If we want to obtain
the functionality from SymPy
we can write a function that invokes <code>diff</code> in SymPy using the
<code>sympy_func()</code> function in <code>caracas</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>der_diff</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>expr</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>   <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/sympy_func.html'>sympy_func</a></span><span class='op'>(</span><span class='va'>expr</span>, <span class='st'>"diff"</span>, <span class='va'>...</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span><span class='fu'>der_diff</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>*</span> <span class='va'>y</span><span class='op'>)</span>, <span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>c: -x*y*sin(x*y) + cos(x*y)</code></pre>
</div>
<p>This latter function is especially useful if we need to find the higher-order
derivative with respect to the same variable:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>sympy</span><span class='op'>$</span><span class='fu'>diff</span><span class='op'>(</span><span class='st'>"sin(x * y)"</span>, <span class='st'>"x"</span>, <span class='fl'>100L</span><span class='op'>)</span></span>
<span><span class='fu'>der_diff</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>*</span> <span class='va'>y</span><span class='op'>)</span>, <span class='va'>x</span>, <span class='fl'>100L</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 data-number="4.4" id="switching-back-and-forth-between-caracas-and-reticulate"><span class="header-section-number">4.4</span> Switching back and forth between <code>caracas</code> and <code>reticulate</code></h3>
<p>Another way of invoking SymPy functionality that is not available in
<code>caracas</code> is the following. As mentioned, a <code>caracas</code> symbol is a
list with a slot called <code>pyobj</code> (accessed by <code>$pyobj</code>). Therefore, one can work with
<code>caracas</code> symbols in <code>reticulate</code>, and one can also coerce a Python
object into a <code>caracas</code> symbol. For example, it is straight forward
to create a Toeplitz matrix using <code>caracas</code>. The minor sub matrix
obtained by removing the first row and column using <code>reticulate</code> and
the result can be coerced to a <code>caracas</code> object with <code>as_sym()</code>,
e.g. for numerical evaluation (introduced later).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>A</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_sym.html'>as_sym</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/toeplitz.html'>toeplitz</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># caracas symbol</span></span>
<span><span class='va'>B_</span> <span class='op'>&lt;-</span> <span class='va'>A</span><span class='op'>$</span><span class='va'>pyobj</span><span class='op'>$</span><span class='fu'>minor_submatrix</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>   <span class='co'># reticulate object (notice: 0-based indexing)</span></span>
<span><span class='va'>B</span> <span class='op'>&lt;-</span> <span class='va'>B_</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/pkg/caracas/man/as_sym.html'>as_sym</a></span><span class='op'>(</span><span class='op'>)</span>                   <span class='co'># caracas symbol</span></span></code></pre>
</div>
</div>
<p><span class="math display">\[\begin{equation}
A = \left[\begin{matrix}a &amp; b &amp; 0\\b &amp; a &amp; b\\0 &amp; b &amp; a\end{matrix}\right]; \quad
B = \left[\begin{matrix}b &amp; b\\0 &amp; a\end{matrix}\right].
\end{equation}\]</span></p>
<h2 data-number="5" id="hands-on-activities"><span class="header-section-number">5</span> Hands-on activities</h2>
<div class="layout-chunk" data-layout="l-body">

</div>
<ol type="1">
<li>Related to Section <a href="#example-linear-models">Example: Linear models</a>:
<ol type="a">
<li>The orthogonal projection
matrix onto the span of the model matrix <span class="math inline">\(X\)</span> is <span class="math inline">\(P=X (X^\top X)^{-1}X^\top\)</span>. The residuals are <span class="math inline">\(r=(I-P)y\)</span>. From this one may
verify that these are not all independent.</li>
<li>If one of the factors
is ignored, then the two-way analysis of variance
model becomes a one-way analysis of variance
model, and it is illustrative to redo the computations in this setting.</li>
<li>Likewise if an interaction between the two factors
is included in the model, what are the residuals in this case?</li>
</ol></li>
<li>Related to Section <a href="#example-logistic-regression">Example: Logistic regression</a>:
<ol type="a">
<li>In <a href="#each-component-of-the-likelihood">Each component of the
likelihood</a>, Newton-Raphson can be implemented to solve the likelihood
equations. <!-- and compared to the output from `glm()`.  -->
Note how sensitive Newton-Raphson is to starting point.
This can be solved by another optimisation scheme, e.g. 
Nelder-Mead (optimising the log likelihood) or BFGS
(finding extreme for the score function).</li>
<li>The example is done as logistic regression with the logit
link function. Try other link functions such as cloglog (complementary log-log).</li>
</ol></li>
<li>Related to Section <a href="#example-constrained-maximum-likelihood">Example: Constrained maximum likelihood</a>:
<ol type="a">
<li>Identifiability of the parameters was handled by not including
<span class="math inline">\(r_1\)</span> and <span class="math inline">\(s_1\)</span> in the specification of <span class="math inline">\(p_{ij}\)</span>. An alternative is
to impose the restrictions <span class="math inline">\(r_1=1\)</span> and <span class="math inline">\(s_1=1\)</span>, and this can also
be handled via Lagrange multipliers. Another alternative is to regard
the model as a log-linear model where <span class="math inline">\(\log p_{ij} = \log u + \log r_i + \log s_j = \tilde{u} + \tilde{r}_i + \tilde{s}_j\)</span>. This model
is similar in its structure to the two-way ANOVA for Section <a href="#example-linear-models">Example: Linear
models</a>. This model can be fitted as a generalized linear model
with a Poisson likelihood and <span class="math inline">\(\log\)</span> as link function. Hence, one
may modify the results in Section <a href="#example-logistic-regression">Example: Logistic regression</a> to
provide an alternative way of fitting the model.</li>
<li>A simpler task is
to consider a multinomial distribution with four categories,
counts <span class="math inline">\(y_i\)</span> and cell probabilities <span class="math inline">\(p_i\)</span>, <span class="math inline">\(i=1,2,3,4\)</span> where <span class="math inline">\(\sum_i p_i=1\)</span>. For this model, find the maximum likelihood estimate for
<span class="math inline">\(p_i\)</span> (use the Hessian to verify that the critical point is a maximum).</li>
</ol></li>
<li>Related to Section <a href="#example-an-auto-regression-model">Example: An auto regression model</a>:
<ol type="a">
<li>Compare the estimated parameter values with those obtained from
the <code>arima()</code> function.</li>
<li>Modify the model in Equation <a href="#eq:ar1">(1)</a> by
setting <span class="math inline">\(x_1 = a x_n + e_1\)</span> (“wrapping around”) and see what happens
to the pattern of zeros in the concentration matrix.</li>
<li>Extend the
<span class="math inline">\(AR(1)\)</span> model to an <span class="math inline">\(AR(2)\)</span> model (“wrapping around”) and
investigate this model along the same lines. Specifically,
what are the conditional independencies (try at least <span class="math inline">\(n=6\)</span>)?</li>
</ol></li>
<li>Related to Section <a href="#example-variance-of-average-of-correlated-variables">Example: Variance of average of correlated variables</a>:
<ol type="a">
<li>Simulate the situation given in the paper (e.g. using the
function <code>mvrnorm()</code> in R package <code>MASS</code>)
and verify that the results align with the symbolic computations.</li>
<li>It is interesting to study such behaviours for other covariance
functions.
Replicate the calculations for the covariance matrix of the form
<span class="math display">\[\begin{equation}
  \label{eq:ex5}
  V = v R = v \left[\begin{matrix}1 &amp; r &amp; 0\\r &amp; 1 &amp; r\\0 &amp; r &amp; 1\end{matrix}\right],
\end{equation}\]</span>
i.e., a special case of a Toeplitz matrix.
How many independent variables, <span class="math inline">\(k\)</span>, do
the <span class="math inline">\(n\)</span> correlated variables correspond to?</li>
</ol></li>
</ol>
<h2 data-number="6" id="discussion"><span class="header-section-number">6</span> Discussion</h2>
<p>We have presented the <code>caracas</code> package and argued that the
package extends the functionality of R significantly with respect to
symbolic mathematics.
In contrast to using <code>reticulate</code> and SymPy directly, <code>caracas</code>
provides symbolic mathematics in standard R syntax.</p>
<p>One practical virtue of <code>caracas</code> is
that the package integrates nicely with <code>Rmarkdown</code>,
<span class="citation" data-cites="rmarkdown">(<a href="#ref-rmarkdown" role="doc-biblioref">Allaire et al. 2021</a>)</span>, (e.g. with the <code>tex()</code> functionality)<br />
and thus supports creating of scientific documents and teaching
material. As for the usability in practice we await feedback from
users.</p>
<p>Another related R package is <code>Ryacas</code> based on Yacas <span class="citation" data-cites="Pinkus2002 yacas">(<a href="#ref-Pinkus2002" role="doc-biblioref">Pinkus and Winitzki 2002</a>; <a href="#ref-yacas" role="doc-biblioref">Pinkus et al. 2016</a>)</span>.
The <code>Ryacas</code> package has existed for many years and is still of relevance.
<code>Ryacas</code> probably has fewer features than <code>caracas</code>. On the other
hand, <code>Ryacas</code> does not require Python (it is compiled).
Finally, the Yacas language is extendable (see e.g. the vignette
“User-defined yacas rules” in the <code>Ryacas</code> package).</p>
<p>One possible future development could be an R package which is
designed without a view towards the underlying engine (SymPy or Yacas)
and which then draws more freely from SymPy and Yacas.
In this connection we mention that there are additional resources
on CRAN such as <a href="https://cran.r-project.org/package=calculus">calculus</a> <span class="citation" data-cites="JSSv104i05">(<a href="#ref-JSSv104i05" role="doc-biblioref">Guidotti 2022</a>)</span>.</p>
<p>Lastly, with respect to freely available resources in a CAS context, we would
like to draw attention to <code>WolframAlpha</code>, see e.g. 
<a href="https://www.wolframalpha.com/" class="uri">https://www.wolframalpha.com/</a>, which provides an online service for
answering (mathematical) queries.</p>
<h2 data-number="7" id="acknowledgements"><span class="header-section-number">7</span> Acknowledgements</h2>
<p>We would like to thank the R Consortium for financial support for
creating the <code>caracas</code> package, users for pin pointing aspects
that can be improved in <code>caracas</code>
and Ege Rubak (Aalborg University, Denmark),
Poul Svante Eriksen (Aalborg University, Denmark),
Giovanni Marchetti (University of Florence, Italy)
and reviewers for constructive comments.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Allaire_Quarto_2022" class="csl-entry" role="listitem">
J. J. Allaire, C. Teague, C. Scheidegger, Y. Xie and C. Dervieux. <span>Quarto</span>. 2022. URL <a href="https://github.com/quarto-dev/quarto-cli">https://github.com/quarto-dev/quarto-cli</a>.
</div>
<div id="ref-rmarkdown" class="csl-entry" role="listitem">
J. Allaire, Y. Xie, J. McPherson, J. Luraschi, K. Ushey, A. Atkins, H. Wickham, J. Cheng, W. Chang and R. Iannone. <em>Rmarkdown: Dynamic documents for r.</em> 2021. URL <a href="https://github.com/rstudio/rmarkdown">https://github.com/rstudio/rmarkdown</a>. R package version 2.7.
</div>
<div id="ref-caracas:21" class="csl-entry" role="listitem">
M. M. Andersen and S. Højsgaard. <span class="nocase">caracas: Computer algebra in R</span>. <em>Journal of Open Source Software</em>, 6(63): 3438, 2021. URL <a href="https://doi.org/10.21105/joss.03438">https://doi.org/10.21105/joss.03438</a>.
</div>
<div id="ref-JSSv104i05" class="csl-entry" role="listitem">
E. Guidotti. <span class="nocase">calculus: High-Dimensional Numerical and Symbolic Calculus in R</span>. <em>Journal of Statistical Software</em>, 104(1): 1–37, 2022. URL <a href="https://www.jstatsoft.org/index.php/jss/article/view/v104i05">https://www.jstatsoft.org/index.php/jss/article/view/v104i05</a>.
</div>
<div id="ref-hojsgaard" class="csl-entry" role="listitem">
S. Højsgaard, D. Edwards and S. Lauritzen. <em>Graphical models with <span>R</span>.</em> New York: Springer, 2012. DOI <a href="https://doi.org/10.1007/978-1-4614-2299-0">10.1007/978-1-4614-2299-0</a>. ISBN 978-1-4614-2298-3.
</div>
<div id="ref-doBy" class="csl-entry" role="listitem">
S. Højsgaard and U. Halekoh. <em><span class="nocase">doBy: Groupwise Statistics, LSmeans, Linear Estimates, Utilities</span>.</em> 2023. URL <a href="https://github.com/hojsgaard/doby">https://github.com/hojsgaard/doby</a>. R package version 4.6.16.
</div>
<div id="ref-mccullagh" class="csl-entry" role="listitem">
P. McCullagh and J. A. Nelder. <em><span>Generalized Linear Models</span>.</em> 2nd ed Philadelphia, PA: Chapman &amp; Hall/<span>CRC</span>, 1989. URL <a href="https://www.routledge.com/Generalized-Linear-Models/McCullagh-Nelder/p/book/9780412317606">https://www.routledge.com/Generalized-Linear-Models/McCullagh-Nelder/p/book/9780412317606</a>.
</div>
<div id="ref-nocedal" class="csl-entry" role="listitem">
J. Nocedal and S. J. Wright. <em><span>Numerical Optimization</span>.</em> Springer New York, 2006. URL <a href="https://doi.org/10.1007/978-0-387-40065-5">https://doi.org/10.1007/978-0-387-40065-5</a>.
</div>
<div id="ref-Pinkus2002" class="csl-entry" role="listitem">
A. Pinkus and S. Winitzki. <span>YACAS: A Do-It-Yourself Symbolic Algebra Environment</span>. In <em>Proceedings of the joint international conferences on artificial intelligence, automated reasoning, and symbolic computation</em>, pages. 332–336 2002. London, UK, UK: Springer-Verlag. ISBN 3-540-43865-3. URL <a href="http://doi.org/10.1007/3-540-45470-5_29">http://doi.org/10.1007/3-540-45470-5_29</a>.
</div>
<div id="ref-yacas" class="csl-entry" role="listitem">
A. Pinkus, S. Winnitzky and G. Mazur. <span class="nocase">Yacas - Yet another computer algebra system</span>. 2016. URL <a href="https://yacas.readthedocs.io/en/latest/">https://yacas.readthedocs.io/en/latest/</a>.
</div>
<div id="ref-shumway:etal:16" class="csl-entry" role="listitem">
R. H. Shumway and D. S. Stoffer. <em>Time series analysis and its applications.</em> Fourth Edition Springer, 2016. DOI <a href="https://doi.org/10.1007/978-3-319-52452-8">10.1007/978-3-319-52452-8</a>.
</div>
<div id="ref-reticulate" class="csl-entry" role="listitem">
K. Ushey, J. Allaire and Y. Tang. <em>Reticulate: Interface to ’python’.</em> 2020. URL <a href="https://CRAN.R-project.org/package=reticulate">https://CRAN.R-project.org/package=reticulate</a>. R package version 1.18.
</div>
<div id="ref-ggplot2" class="csl-entry" role="listitem">
H. Wickham. <em><span class="nocase">g</span>gplot2: Elegant graphics for data analysis.</em> Springer-Verlag New York, 2016. URL <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-RMarkdownDefinitiveGuide" class="csl-entry" role="listitem">
Y. Xie, J. J. Allaire and G. Grolemund. <em>R markdown: The definitive guide.</em> Boca Raton, Florida: Chapman; Hall/<span>CRC</span>, 2018. URL <a href="https://bookdown.org/yihui/rmarkdown">https://bookdown.org/yihui/rmarkdown</a>. ISBN 9781138359338.
</div>
<div id="ref-RMarkdownCookbook" class="csl-entry" role="listitem">
Y. Xie, C. Dervieux and E. Riederer. <em>R markdown cookbook.</em> Boca Raton, Florida: Chapman; Hall/<span>CRC</span>, 2020. URL <a href="https://bookdown.org/yihui/rmarkdown-cookbook">https://bookdown.org/yihui/rmarkdown-cookbook</a>. ISBN 9780367563837.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Andersen &amp; Højsgaard, "Computer Algebra in R Bridges a Gap Between Symbolic Mathematics and Data in the Teaching of Statistics and Data Science", The R Journal, 2024</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2023-090,
  author = {Andersen, Mikkel Meyer and Højsgaard, Søren},
  title = {Computer Algebra in R Bridges a Gap Between Symbolic Mathematics and Data in the Teaching of Statistics and Data Science},
  journal = {The R Journal},
  year = {2024},
  note = {https://doi.org/10.32614/RJ-2023-090},
  doi = {10.32614/RJ-2023-090},
  volume = {15},
  issue = {4},
  issn = {2073-4859},
  pages = {181-197}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
