<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
      margin-bottom: 0em;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>Rendering LaTeX in R</title>

<meta property="description" itemprop="description" content="The xdvir package provides functions for rendering  LaTeX fragments as labels, annotations, and data symbols in R plots.  There are convenient high-level functions for rendering LaTeX fragments, including labels on ggplot2 plots, plus lower-level functions for more fine control over the separate authoring, typesetting, and rendering steps. There is support for making use of LaTeX packages, including TikZ graphics.  The rendered LaTeX output is fully integrated with R graphics output in the sense that LaTeX output  can be positioned and sized relative to R graphics output and vice versa."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2025-028/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2025-10-22"/>
<meta property="article:created" itemprop="dateCreated" content="2025-10-22"/>
<meta name="article:author" content="Paul Murrell"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Rendering LaTeX in R"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="The xdvir package provides functions for rendering  LaTeX fragments as labels, annotations, and data symbols in R plots.  There are convenient high-level functions for rendering LaTeX fragments, including labels on ggplot2 plots, plus lower-level functions for more fine control over the separate authoring, typesetting, and rendering steps. There is support for making use of LaTeX packages, including TikZ graphics.  The rendered LaTeX output is fully integrated with R graphics output in the sense that LaTeX output  can be positioned and sized relative to R graphics output and vice versa."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2025-028/"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="Rendering LaTeX in R"/>
<meta property="twitter:description" content="The xdvir package provides functions for rendering  LaTeX fragments as labels, annotations, and data symbols in R plots.  There are convenient high-level functions for rendering LaTeX fragments, including labels on ggplot2 plots, plus lower-level functions for more fine control over the separate authoring, typesetting, and rendering steps. There is support for making use of LaTeX packages, including TikZ graphics.  The rendered LaTeX output is fully integrated with R graphics output in the sense that LaTeX output  can be positioned and sized relative to R graphics output and vice versa."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2025-028/"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Rendering LaTeX in R"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2025-028"/>
<meta name="citation_pdf_url" content="RJ-2025-028.pdf"/>
<meta name="citation_volume" content="17"/>
<meta name="citation_issue" content="3"/>
<meta name="citation_doi" content="10.32614/RJ-2025-028"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="162"/>
<meta name="citation_lastpage" content="187"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2025/10/22"/>
<meta name="citation_publication_date" content="2025/10/22"/>
<meta name="citation_author" content="Paul Murrell"/>
<meta name="citation_author_institution" content="The University of Auckland"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Beyond memorability: Visualization recognition and recall;citation_volume=22;citation_doi=10.1109/TVCG.2015.2467732;citation_author=Michelle A. Borkin;citation_author=Zoya Bylinskii;citation_author=Nam Wook Kim;citation_author=Constance May Bainbridge;citation_author=Chelsea S. Yeh;citation_author=Daniel Borkin;citation_author=Hanspeter Pfister;citation_author=Aude Oliva"/>
  <meta name="citation_reference" content="citation_title=Show it or tell it? Text, visualization, and their combination;citation_publisher=Association for Computing Machinery;citation_volume=66;citation_doi=10.1145/3593580;citation_issn=0001-0782;citation_author=Marti A. Hearst"/>
  <meta name="citation_reference" content="citation_title=Frames and slants in titles of visualizations on controversial topics;citation_publisher=Association for Computing Machinery;citation_doi=10.1145/3173574.3174012;citation_author=Ha-Kyung Kong;citation_author=Zhicheng Liu;citation_author=Karrie Karahalios"/>
  <meta name="citation_reference" content="citation_title=ggtext: Improved text rendering support for ’ggplot2’;citation_doi=10.32614/CRAN.package.ggtext;citation_author=Claus O. Wilke;citation_author=Brenton M. Wiernik"/>
  <meta name="citation_reference" content="citation_title=gridtext: Improved text rendering support for ’grid’ graphics;citation_doi=10.32614/CRAN.package.gridtext;citation_author=Claus O. Wilke;citation_author=Brenton M. Wiernik"/>
  <meta name="citation_reference" content="citation_title=marquee: Markdown parser and renderer for R graphics;citation_doi=10.32614/CRAN.package.marquee;citation_author=Thomas Lin Pedersen;citation_author=Martin Mitáš"/>
  <meta name="citation_reference" content="citation_title=ggplot2: Elegant graphics for data analysis;citation_publisher=Springer-Verlag New York;citation_author=Hadley Wickham"/>
  <meta name="citation_reference" content="citation_title=gggrid: Draw with ’grid’ in ’ggplot2’;citation_doi=10.32614/CRAN.package.gggrid;citation_author=Paul Murrell"/>
  <meta name="citation_reference" content="citation_title=Annotated Equations in ggplot2;citation_author=W. Joel Schneider"/>
  <meta name="citation_reference" content="citation_title=gridGraphics: Redraw base graphics using ’grid’ graphics;citation_doi=10.32614/CRAN.package.gridGraphics;citation_author=Paul Murrell;citation_author=Zhijian Wen"/>
  <meta name="citation_reference" content="citation_title=Text in R graphics;citation_doi=10.1111/anzs.12438;citation_author=Paul Murrell"/>
  <meta name="citation_reference" content="citation_title=Data visualisation with R: 100 examples;citation_publisher=Springer Publishing Company, Incorporated;citation_author=Thomas Rahlf"/>
  <meta name="citation_reference" content="citation_title=Lattice: Multivariate data visualization with R;citation_publisher=Springer;citation_author=Deepayan Sarkar"/>
  <meta name="citation_reference" content="citation_title=R markdown: The definitive guide;citation_publisher=Chapman; Hall/CRC;citation_author=Yihui Xie;citation_author=J. J. Allaire;citation_author=Garrett Grolemund"/>
  <meta name="citation_reference" content="citation_title=Cairo graphics library;citation_author=Keith Packard;citation_author=Carl Worth;citation_author=Behdad Esfahbod"/>
  <meta name="citation_reference" content="citation_title=ragg: Graphic devices based on AGG;citation_doi=10.32614/CRAN.package.ragg;citation_author=Thomas Lin Pedersen;citation_author=Maxim Shemanarev"/>
  <meta name="citation_reference" content="citation_title=tinytex: Helper functions to install and maintain TeX Live, and compile LaTeX documents;citation_author=Yihui Xie"/>
  <meta name="citation_reference" content="citation_title=tikzDevice: R graphics output in LaTeX format;citation_doi=10.32614/CRAN.package.tikzDevice;citation_author=Charlie Sharpsteen;citation_author=Cameron Bracken"/>
  <meta name="citation_reference" content="citation_title=latex2exp: Use LaTeX expressions in plots;citation_doi=10.32614/CRAN.package.latex2exp;citation_author=Stefano Meschiari"/>
  <meta name="citation_reference" content="citation_title=geomtextpath: Curved text in ’ggplot2’;citation_doi=10.32614/CRAN.package.geomtextpath;citation_author=Allan Cameron;citation_author=Teun Brand"/>
  <meta name="citation_reference" content="citation_title=ggforce: Accelerating ’ggplot2’;citation_doi=10.32614/CRAN.package.ggforce;citation_author=Thomas Lin Pedersen"/>
  <meta name="citation_reference" content="citation_title=directlabels: Direct labels for multicolor plots;citation_doi=10.32614/CRAN.package.directlabels;citation_author=Toby Dylan Hocking"/>
  <meta name="citation_reference" content="citation_title=xtable: Export tables to LaTeX or HTML;citation_doi=10.32614/CRAN.package.xtable;citation_author=David B. Dahl;citation_author=David Scott;citation_author=Charles Roosen;citation_author=Arni Magnusson;citation_author=Jonathan Swinton"/>
  <meta name="citation_reference" content="citation_title=The gridGraphics package;citation_volume=7;citation_issn=2073-4859;citation_author=Paul Murrell"/>
  <meta name="citation_reference" content="citation_title=Ggtikz: Post-process ’ggplot2’ plots with ’TikZ’ code using plot coordinates;citation_doi=10.32614/CRAN.package.ggtikz;citation_author=Oliver Thomas"/>
  <meta name="citation_reference" content="citation_title=Latexpdf: Convert tables to PDF or PNG;citation_doi=10.32614/CRAN.package.latexpdf;citation_author=Tim Bergsma"/>
  <meta name="citation_reference" content="citation_title=texPreview: Compile and preview snippets of ’LaTeX’;citation_doi=10.32614/CRAN.package.texPreview;citation_author=Jonathan Sidi;citation_author=Daniel Polhamus"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","date","description","draft","author","type","output","header-includes","bibliography","date_received","volume","issue","slug","journal","pdf_url","citation_url","doi","creative_commons","packages","CTV","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Rendering LaTeX in R"]},{"type":"character","attributes":{},"value":["2025-10-22"]},{"type":"character","attributes":{},"value":["The xdvir package provides functions for rendering  LaTeX fragments as labels, annotations, and data symbols in R plots.  There are convenient high-level functions for rendering LaTeX fragments, including labels on ggplot2 plots, plus lower-level functions for more fine control over the separate authoring, typesetting, and rendering steps. There is support for making use of LaTeX packages, including TikZ graphics.  The rendered LaTeX output is fully integrated with R graphics output in the sense that LaTeX output  can be positioned and sized relative to R graphics output and vice versa."]},{"type":"logical","attributes":{},"value":[false]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email","url","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Paul Murrell"]},{"type":"character","attributes":{},"value":["The University of Auckland"]},{"type":"character","attributes":{},"value":["Department of Statistics","Auckland, New Zealand"]},{"type":"character","attributes":{},"value":["paul@stat.auckland.ac.nz"]},{"type":"character","attributes":{},"value":["https://www.stat.auckland.ac.nz/~paul/"]},{"type":"character","attributes":{},"value":["0000-0002-3224-8858"]}]}]},{"type":"character","attributes":{},"value":["package"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["rjtools::rjournal_pdf_article","distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","keep_tex"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["\\usepackage{metalogo}"]},{"type":"character","attributes":{},"value":["murrell-xdvir.bib"]},{"type":"character","attributes":{},"value":["2025-03-03"]},{"type":"integer","attributes":{},"value":[17]},{"type":"integer","attributes":{},"value":[3]},{"type":"character","attributes":{},"value":["RJ-2025-028"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[162]},{"type":"integer","attributes":{},"value":[187]}]},{"type":"character","attributes":{},"value":["RJ-2025-028.pdf"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2025-028"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2025-028"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["ggtext","gridtext","marquee","ggplot2","xtable","latexpdf","rmarkdown","texPreview","gridGraphics","gggrid","lattice","tinytex","geomtextpath","directlabels","ggforce","tikzDevice","ggtikz","latex2exp"]},{"type":"list","attributes":{},"value":[]}]},{"type":"character","attributes":{},"value":["ChemPhys","NetworkAnalysis","Phylogenetics","ReproducibleResearch","Spatial","TeachingStatistics"]},{"type":"character","attributes":{},"value":["/home/mitchell/R/x86_64-pc-linux-gnu-library/4.5/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2025-028/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["annotate-equations/annotate-equations.pdf","annotate-equations/annotate-equations.sty","annotate-equations/annotate-equations.tex","annotate-equations/LICENSE","annotate-equations/README.md","data/auckland-flights.csv","data/chile.csv","data/youth-crime.csv","diagram/diag-1.svg","diagram/diag-doc.pdf","diagram/diag-doc.tex","diagram/diag.dot","diagram/diag.pdf","diagram/diag.png","diagram/diag.svg","diagram/diag.tex","Fonts/Economica-Bold.ttf","Fonts/Economica-BoldItalic.ttf","Fonts/Economica-Italic.ttf","Fonts/Economica-Regular.ttf","Fonts/Economica.zip","murrell-xdvir.bib","murrell-xdvir.tex","RJ-2025-028_files/anchor-4.2.2/anchor.min.js","RJ-2025-028_files/bowser-1.9.3/bowser.min.js","RJ-2025-028_files/distill-2.2.21/template.v2.js","RJ-2025-028_files/figure-html5/anzjs-1.png","RJ-2025-028_files/figure-html5/anzjsplain-1.png","RJ-2025-028_files/figure-html5/diag-1.png","RJ-2025-028_files/figure-html5/elementlatex-1.png","RJ-2025-028_files/figure-html5/geomlatex-1.png","RJ-2025-028_files/figure-html5/lattice-1.png","RJ-2025-028_files/figure-html5/latticeplain-1.png","RJ-2025-028_files/figure-html5/rahlf-1.png","RJ-2025-028_files/figure-html5/rahlfplain-1.png","RJ-2025-028_files/figure-html5/schneider-1.png","RJ-2025-028_files/figure-html5/schneiderplain-1.png","RJ-2025-028_files/figure-html5/typesetting-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-19-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-21-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-27-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-28-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-29-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-30-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-32-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-33-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-35-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-36-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-37-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-38-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-40-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-42-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-5-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-7-1.png","RJ-2025-028_files/figure-html5/unnamed-chunk-8-1.png","RJ-2025-028_files/figure-html5/zref-1.png","RJ-2025-028_files/figure-latex/anzjs-1.pdf","RJ-2025-028_files/figure-latex/anzjsplain-1.pdf","RJ-2025-028_files/figure-latex/diag-1.pdf","RJ-2025-028_files/figure-latex/elementlatex-1.pdf","RJ-2025-028_files/figure-latex/geomlatex-1.pdf","RJ-2025-028_files/figure-latex/lattice-1.pdf","RJ-2025-028_files/figure-latex/latticeplain-1.pdf","RJ-2025-028_files/figure-latex/rahlf-1.pdf","RJ-2025-028_files/figure-latex/rahlfplain-1.pdf","RJ-2025-028_files/figure-latex/schneider-1.pdf","RJ-2025-028_files/figure-latex/schneiderplain-1.pdf","RJ-2025-028_files/figure-latex/typesetting-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-19-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-21-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-27-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-28-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-29-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-30-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-32-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-33-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-35-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-36-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-37-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-38-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-40-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-42-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-5-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-7-1.pdf","RJ-2025-028_files/figure-latex/unnamed-chunk-8-1.pdf","RJ-2025-028_files/figure-latex/zref-1.pdf","RJ-2025-028_files/header-attrs-2.30/header-attrs.js","RJ-2025-028_files/jquery-3.6.0/jquery-3.6.0.js","RJ-2025-028_files/jquery-3.6.0/jquery-3.6.0.min.js","RJ-2025-028_files/jquery-3.6.0/jquery-3.6.0.min.map","RJ-2025-028_files/popper-2.6.0/popper.min.js","RJ-2025-028_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2025-028_files/tippy-6.2.7/tippy-light-border.css","RJ-2025-028_files/tippy-6.2.7/tippy.css","RJ-2025-028_files/tippy-6.2.7/tippy.umd.min.js","RJ-2025-028_files/webcomponents-2.0.0/webcomponents.js","RJ-2025-028.log","RJ-2025-028.pdf","RJ-2025-028.tex","RJ-2025-028.zip","RJournal.sty","RJwrapper.log","RJwrapper.tex","scripts/anzjs.R","scripts/rahlf-plot.R","scripts/schneider.R","TeX/annotate-equations.sty","TeX/longley-doc.tex","TeX/longley.tex","TeX/rahlf-doc.tex","TeX/rahlf.tex","TeX/schneider-doc.pdf","TeX/schneider-doc.tex","TeX/schneider.tex"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.30/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Mathjax config (add automatic linebreaks when supported)
      // MathJax = {
      //    tex: {
      //        inlineMath: [['$', '$'], ['\\(', '\\)']],
      //        displayMath: [['$$', '$$'], ['\\[', '\\]']],
      //        tags: 'ams',
      //        multline: true,
      //    },
      //    options: {
      //        linebreaks: { automatic: true },
      //    },
      // };

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      
      // Conditionally add supplementary files button
      if (document.getElementById('supplementary-materials')) {
        // create element safely
        const btn_suppl = document.createElement('a');
        btn_suppl.href = slug + '.zip';
        btn_suppl.className = 'dt-tag';
        btn_suppl.innerHTML = '<i class="fas fa-file-zipper"></i> Supplement';
        buttons.append(btn_suppl);
      }

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").filter(function() {
        return !$(this).hasClass("subtitle");
      }).first();
      if (tpar) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append(tpar) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Rendering LaTeX in R","description":"The xdvir package provides functions for rendering  LaTeX fragments as labels, annotations, and data symbols in R plots.  There are convenient high-level functions for rendering LaTeX fragments, including labels on ggplot2 plots, plus lower-level functions for more fine control over the separate authoring, typesetting, and rendering steps. There is support for making use of LaTeX packages, including TikZ graphics.  The rendered LaTeX output is fully integrated with R graphics output in the sense that LaTeX output  can be positioned and sized relative to R graphics output and vice versa.","doi":"10.32614/RJ-2025-028","authors":[{"author":"Paul Murrell","authorURL":"https://www.stat.auckland.ac.nz/~paul/","affiliation":"The University of Auckland","affiliationURL":"#","orcidID":"0000-0002-3224-8858"}],"publishedDate":"2025-10-22T00:00:00.000+00:00","citationText":"Murrell, 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues/2025-3">Current</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../submissions.html">Submit</a>
<a href="../../contribute.html">Contribute</a>
<a href="../../editors.html">Editorial board</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Rendering LaTeX in R</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>The xdvir package provides functions for rendering LaTeX fragments as labels, annotations, and data symbols in R plots. There are convenient high-level functions for rendering LaTeX fragments, including labels on ggplot2 plots, plus lower-level functions for more fine control over the separate authoring, typesetting, and rendering steps. There is support for making use of LaTeX packages, including TikZ graphics. The rendered LaTeX output is fully integrated with R graphics output in the sense that LaTeX output can be positioned and sized relative to R graphics output and vice versa.</p></p>
</div>

<div class="d-byline">
  Paul Murrell <a href="https://www.stat.auckland.ac.nz/~paul/" class="uri">https://www.stat.auckland.ac.nz/~paul/</a> (The University of Auckland)
  
<br/>2025-10-22
</div>

<div class="d-article">
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>Text labels, titles, and annotations are essential components of
any data visualization. Viewers focus a lot of their attention
on text <span class="citation" data-cites="massvis">(<a href="#ref-massvis" role="doc-biblioref">Borkin et al. 2016</a>)</span>,
text is the most effective way to communicate some types of
information <span class="citation" data-cites="hearst">(<a href="#ref-hearst" role="doc-biblioref">Hearst 2023</a>)</span>,
and the message obtained from a data visualization can be
heavily influenced by the text on a plot <span class="citation" data-cites="kong">(<a href="#ref-kong" role="doc-biblioref">Kong et al. 2018</a>)</span>.</p>
<p>R provides relatively flexible tools for adding text labels to plots.
For example, in the <code>graphics</code> package, we can specify an
overall plot title and axis titles via the <code>main</code>,
<code>xlab</code>, and <code>ylab</code> arguments to the <code>plot()</code> function
and we can add text at arbitrary locations on the plot with the <code>text()</code>
and <code>mtext()</code> functions.</p>
<p>Unfortunately, these core tools for drawing text are quite limited
in terms of the formatting of the text.
For example, there is no facility for emphasizing an individual word using
a <strong>bold</strong> or <em>italic</em> face within a text label.</p>
<p>The <a href="https://cran.r-project.org/package=ggtext">ggtext</a> <span class="citation" data-cites="pkg-ggtext">(<a href="#ref-pkg-ggtext" role="doc-biblioref">Wilke and Wiernik 2022a</a>)</span> and <a href="https://cran.r-project.org/package=gridtext">gridtext</a> <span class="citation" data-cites="pkg-gridtext">(<a href="#ref-pkg-gridtext" role="doc-biblioref">Wilke and Wiernik 2022b</a>)</span>
packages greatly improved the situation by allowing text labels
to include a small subset of
markdown and HTML (plus CSS). This allowed, for example, changes in font face
and color within text labels.</p>
<p>More recently, the <a href="https://cran.r-project.org/package=marquee">marquee</a> package <span class="citation" data-cites="pkg-marquee">(<a href="#ref-pkg-marquee" role="doc-biblioref">Pedersen and Mitáš 2025</a>)</span>
improved the situation a great deal further by providing full support for
markdown within text labels. This made it possible to lay out more
complex arrangements of text and even graphical content within text labels.</p>
<p>However, despite these advances, there are still some text formatting tasks that
remain out of reach. For example, Figure <a href="#fig:typesetting">1</a>
shows a plot with a text annotation in the top-right corner that contains
a combination of features that cannot be produced using the
available text-drawing tools.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:typesetting"></span>
<img src="RJ-2025-028_files/figure-html5/typesetting-1.png" alt="A line plot with two curves, the details of which do not really matter.  One line is thick and red, the other is dashed and black.  The important part is the annotation in the top-right corner of the plot, which is a paragraph of text that contains all of the typesetting features that are described in the main text." width="100%" />
<p class="caption">
Figure 1: A plot with a text annotation in the top-right corner that contains several typesetting challenges: in-line mathematical expressions like <span class="math inline">\(\bar z_i\)</span>; changes in color so that the last two words match the colour of the thicker line in the plot; and automated line-breaks with full justification and hyphenation.
</p>
</div>
</div>
<p>The annotation in Figure <a href="#fig:typesetting">1</a>
may not appear to be particularly special nor particularly complicated
at first glance, but it harbors several important details:</p>
<ul>
<li><p>The text is a mixture of plain text and mathematical expressions (like
<span class="math inline">\(\bar{z}_i\)</span>). Furthermore, the mathematical expressions use a different font
(Latin Modern) than the plain text (TeX Gyre Adventor)
and the mixture is broken across multiple lines.</p>
<p>The R graphics system can draw mathematical expressions <span class="citation" data-cites="plotmath">(<a href="#ref-plotmath" role="doc-biblioref">Murrell and Ihaka 2000</a>)</span>
and that includes a mixture of plain text and mathematical expressions.
Furthermore, the R graphics system uses a separate symbol font
for mathematical expressions compared to plain text. However,
further changes in font within the plain text are not possible and line
breaks are not supported.
There is also the problem
that the typesetting of mathematical expressions in R graphics is not
of a very high quality.</p></li>
<li><p>The text is not all the same color; the final two words (but not the full
stop) are red. Furthermore, the final two words are <strong>bold</strong>;
they have a different
font face compared to the rest of the text.</p>
<p>The R graphics system can only draw a character value with a single color
and a single font face.
The <a href="https://cran.r-project.org/package=gridtext">gridtext</a> and
<a href="https://cran.r-project.org/package=ggtext">ggtext</a> packages make it possible to change color within
a character value, but they do not allow a mixture of character values and
R mathematical expressions. Furthermore, they do not provide support for
MathML <code>&lt;math&gt;</code> tags.</p></li>
<li><p>The text is broken over multiple lines. Furthermore, the text is fully
justified (not ragged-left or ragged-right justified) and one word
has been split across lines and hyphenated. Although it is not
obvious from the plot itself, the line breaks were also automatically
generated to fit the text into a fixed width.</p>
<p>The R graphics system can draw a character value across multiple lines, but
only if explicit newlines are embedded in the character value (i.e., the line
breaks are manual). The base function <code>strwrap()</code> can be used to break
lines, but it is only designed for monospaced terminal output
and ragged-right justification.
The <a href="https://cran.r-project.org/package=gridtext">gridtext</a> and
<a href="https://cran.r-project.org/package=ggtext">ggtext</a> packages can calculate simple
automated line breaks, but they will not break a word across lines (or
hyphenate) and they cannot fully justify the resulting text. The
<a href="https://cran.r-project.org/package=marquee">marquee</a> package can automate line breaks and fully justify
text, but it cannot hyphenate nor can it produce mathematical expressions.</p></li>
</ul>
<p>The features outlined above are all examples of <em>typesetting</em>; determining an
arrangement of individual characters and symbols (glyphs) that could be as
simple as placing one character after another (from left to right), but could
also be as complex as arranging mathematical symbols, splitting text into
multiple columns, or writing text vertically from top to bottom.</p>
<p>From R 4.3.0, it has been
possible to draw text from a set of typeset glyphs using the
functions <code>grDevices::glyphInfo()</code> and <code>grid::grid.glyph()</code>
<span class="citation" data-cites="murrell-pedersen-urbanek-glyphs-2023">(<a href="#ref-murrell-pedersen-urbanek-glyphs-2023" role="doc-biblioref">Murrell et al. 2023</a>)</span>. This facility
offers the promise of being able to render arbitrary typeset text
in R. However, it
presupposes that we are able to generate a set of typeset glyphs.</p>
<p>The <a href="https://cran.r-project.org/package=marquee">marquee</a> package provides an example of a package
that can generate typeset glyphs. It is capable of converting
markdown input into a set of glyphs and their positions, which are
then rendered in R.</p>
<p>This article describes the <code>xdvir</code> package, which is another example
of a package that can generate typeset glyphs.
In this case, the input is LaTeX, a TeX engine processes the
LaTeX source to create DVI output, which is essentially
a set of glyphs and their positions,
and then <code>xdvir</code> reads the DVI output and
renders the result in R.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>
The benefit of the <code>xdvir</code> package is that it provides access to the
typesetting capabilities of LaTeX, which includes hyphenation,
fully justified text, mixtures of plain text and mathematical expressions—all
of the features demonstrated in Figure <a href="#fig:typesetting">1</a>—and much more.</p>
<p>The next section describes the basic usage of the <code>xdvir</code> package.
This is followed by a section that breaks down the
design of the <code>xdvir</code> package to show the steps that are
required to render LaTeX output in R.
Subsequent sections explore several of the complexities
that can arise with rendering LaTeX text in R graphics and
some of the solutions that
the <code>xdvir</code> package provides.
The article ends with several extended examples of rendering LaTeX text in R.</p>
<h2 data-number="2" id="userinterface"><span class="header-section-number">2</span> LaTeX text labels in R</h2>
<p>The simplest way to draw LaTeX text with the <code>xdvir</code> package
is to call the <code>grid.latex()</code> function. The first argument to
this function is a character value, which is interpreted as
a fragment of LaTeX code.
For example, the following code draws a text label that contains
a subset of the larger annotation from
Figure <a href="#fig:typesetting">1</a>. We use just a subset here in order
to keep the code readable.</p>
<p>Because LaTeX code tends to contain
a large number of backslashes, the code below uses the <code>r"(...)"</code>
syntax for raw character constants, so that we do not have to
escape each backslash with a double backslash.
The resulting image is shown below the code.
Although it is not immediately obvious from that image,
the text, or rather the glyphs, in the image are rendered by R.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://stattech.wordpress.fos.auckland.ac.nz/2025/03/06/2025-01-latex-typesetting-in-r/'>xdvir</a></span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>simpleTeX</span> <span class='op'>&lt;-</span> <span class='st'>r"(We move the original mean to $\bar z_i$)"</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>simpleTeX</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-5-1.png" width="40%" /></p>
</div>
<p>It is possible to produce something similar to this result using
the <em>plotmath</em> feature in R, as shown in the following code (and the image
below the code). However, this demonstrates that
one advantage of using <code>xdvir</code>, even for a simple
piece of text like this, is the superior quality of the LaTeX
fonts and typesetting for mathematical expressions.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>plotmath</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='st'>"We move the original mean to "</span><span class='op'>*</span><span class='fu'>bar</span><span class='op'>(</span><span class='fu'>italic</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.text.html'>grid.text</a></span><span class='op'>(</span><span class='va'>plotmath</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-7-1.png" width="40%" /></p>
</div>
<p>Another immediate benefit of <code>xdvir</code> is that we can automatically fit
the text within a specified width.
For example, the following code draws the LaTeX fragment <code>tex</code>
again, but this time forces it to fit within a column that is half
the width of the image.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>simpleTeX</span>, width<span class='op'>=</span><span class='fl'>.5</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-8-1.png" width="40%" /></p>
</div>
<p>As the function name <code>grid.latex()</code> suggests, that function
produces low-level
drawing in the <code>grid</code> package graphics system.
The text is just drawn relative to the current <code>grid</code> viewport,
wherever that may be on the page.
While this is extremely flexible, it is more likely that
we want to combine and coordinate the text with a high-level plot
of some sort, like the annotation in Figure <a href="#fig:typesetting">1</a>.
There are various ways that low-level <code>grid</code> drawing can be combined
with a high-level plot, but we will leave those demonstrations to
later sections.</p>
<p>Instead, for now, we will demonstrate a more common scenario:
drawing LaTeX text labels on a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot <span class="citation" data-cites="pkg-ggplot2">(<a href="#ref-pkg-ggplot2" role="doc-biblioref">Wickham 2016</a>)</span>.
For this purpose, the <code>xdvir</code> package provides the
<code>element_latex()</code> function. This allows us to specify a LaTeX fragment
as a plot label and then we can indicate the special nature of the label
via the <code>ggplot2::theme()</code> function.</p>
<p>For example, the following code uses the same LaTeX fragment
from the example above as the title of a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot.
The resulting plot is shown in Figure <a href="#fig:elementlatex">2</a>.
One detail about this result is that the text in this title is larger
than the text drawn by the call to <code>grid.latex()</code> above,
even though exactly the same TeX fragment is being drawn.
A closer inspection reveals that the font is also different.
These differences reflect the fact that <code>grid.latex()</code> and <code>element_latex()</code>
respect the graphical parameter settings—font families and font sizes—that
are in effect when the LaTeX fragment is drawn. In Figure
<a href="#fig:elementlatex">2</a> that means respecting the theme settings
of the <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot.
The <code>ggIntro</code> object in the code below
contains a description of the main <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>
plot from Figure
<a href="#fig:typesetting">1</a>.
The code for generating
<code>ggIntro</code> is not shown in order to keep the code below readable,
but it is available in the supplementary materials for this article.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span></span></code></pre>
</div>
</div>

<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>ggIntro</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='va'>simpleTeX</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/element_latex.html'>element_latex</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:elementlatex"></span>
<img src="RJ-2025-028_files/figure-html5/elementlatex-1.png" alt="This is a line plot with the same two lines as in Figure 1, but without the text annotation in the top-right corner.  Instead, there is a plot title that is rendered from a LaTeX fragment containing a mathematical expression." width="100%" />
<p class="caption">
Figure 2: The <code>ggplot2</code> plot from Figure <a href="#fig:typesetting">1</a>, without the text annotation, but with a title that was specified using a LaTeX fragment and the function <code>element_latex()</code>.
</p>
</div>
</div>
<p>The <code>xdvir</code> package also provides a <code>geom_latex()</code> function for
drawing text labels, similar to the standard <code>ggplot2::geom_text()</code> function.
The values specified for the
<code>label</code> aesthetic for <code>geom_latex()</code> are treated as fragments of LaTeX
code.
For example, Figure <a href="#fig:geomlatex">3</a>
shows a plot with a set of red points
and a set of red labels, one for each point.
The points are drawn using the standard <code>ggplot::geom_point()</code> function,
but the labels are drawn using <code>geom_latex()</code> from the <code>xdvir</code> package.
The red labels for the red points in Figure <a href="#fig:geomlatex">3</a>
are small LaTeX fragments that each describe
a simple LaTeX mathematical expression.
The data set used for the red points and labels is stored
in a data frame called <code>means</code> and the LaTeX fragments are
in a column called <code>label</code>, as shown below.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>means</span><span class='op'>$</span><span class='va'>label</span></span></code></pre>
</div>
<pre><code>[1] &quot;$\\bar x_1$&quot; &quot;$\\bar x_2$&quot; &quot;$\\bar x_3$&quot; &quot;$\\bar x_4$&quot;
[5] &quot;$\\bar x_5$&quot;</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>The following code draws the plot in Figure <a href="#fig:geomlatex">3</a>.
A call to <code>ggplot2::geom_point()</code> draws the red points and a call
to <code>geom_latex()</code> draws the red labels.
The <code>ggGeom</code> object in the code below describes the
main plot, which consists of gray dots, horizontal and vertical lines,
and y-axis labels.
The code for generating
<code>ggGeom</code> is not shown in order to keep the code below readable,
but it is available in the supplementary materials for this article.</p>

<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>ggGeom</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>sample</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>means</span>, colour<span class='op'>=</span><span class='fl'>2</span>, size<span class='op'>=</span><span class='fl'>4</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/geom_latex.html'>geom_latex</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>sample</span>, label<span class='op'>=</span><span class='va'>label</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>means</span>, </span>
<span>               size<span class='op'>=</span><span class='fl'>6</span>, vjust<span class='op'>=</span><span class='op'>-</span><span class='fl'>.4</span>, colour<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>    </span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:geomlatex"></span>
<img src="RJ-2025-028_files/figure-html5/geomlatex-1.png" alt="A scatterplot with five rows of grey dots, where each row of dots represents a random sample of values from a population.  In addition, there is a red dot on each row that represents the mean value for each sample, plus a red label above each red dot that is based on a simple LaTeX mathematical expression." width="100%" />
<p class="caption">
Figure 3: A <code>ggplot2</code> plot with text labels specified as LaTeX fragments and drawn using the <code>geom_latex()</code> function.
</p>
</div>
</div>
<h2 data-number="3" id="underhood"><span class="header-section-number">3</span> Under the hood</h2>
<p>The previous section showed that simple usage of the <code>xdvir</code> package
only requires specifying a LaTeX fragment as the text to draw.
For example, several examples used the LaTeX fragment shown below.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>simpleTeX</span></span></code></pre>
</div>
<pre><code>[1] &quot;We move the original mean to $\\bar z_i$&quot;</code></pre>
</div>
<p>The <code>grid.latex()</code> function has three tasks to perform in order to
draw that LaTeX fragment in R:</p>
<dl>
<dt><strong>Authoring:</strong></dt>
<dd>
<p>The LaTeX fragment has to be turned into a complete
LaTeX document.</p>
</dd>
<dd>
<p>The <code>author()</code> function in the <code>xdvir</code> package
allows us to perform this step separately.
For example, the following code
takes the LaTeX fragment <code>simpleTeX</code> and produces a complete LaTeX
document, <code>simpleDoc</code>, that is ready to typeset.</p>
</dd>
</dl>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>simpleDoc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/author.html'>author</a></span><span class='op'>(</span><span class='va'>simpleTeX</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>simpleDoc</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>%% R package xdvir_0.1.3; engine name: XeTeX; engine version: XeTeX 3.141592653-2.6-
\documentclass[varwidth]{standalone}
\usepackage{unicode-math}
\begin{document}
We move the original mean to $\bar z_i$
\end{document}</code></pre>
</div>
<dl>
<dt><strong>Typesetting:</strong></dt>
<dd>
<p>The LaTeX document has to be typeset to produce a set of
glyphs and their positions.</p>
</dd>
<dd>
<p>The <code>typeset()</code> function in the <code>xdvir</code> package
allows us to perform this step separately.
For example, the following code takes the LaTeX document <code>simpleDoc</code> and
produces a <code>"DVI"</code> object, <code>simpleDVI</code>,
that contains instructions specifying the fonts to
use (lines that contain <code>x_fnt_def</code> and <code>fnt_num</code> in the output below),
the glyphs to use from those fonts (lines that contain
<code>x_glyph</code> in the output below), and where to draw those glyphs
(lines that contain <code>down</code> and <code>right</code> and <code>x_glyph</code>).
The output shown below has been trimmed to save space and to
make it easier to read.</p>
</dd>
</dl>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>simpleDVI</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/typeset.html'>typeset</a></span><span class='op'>(</span><span class='va'>simpleDoc</span><span class='op'>)</span></span>
<span><span class='va'>simpleDVI</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>pre          version=7, num=25400000, den=473628672, mag=1000,
             comment=R package xdvir_0.1.3; engine name: XeTeX; engine version: XeTe
bop          counters=1 0 0 0 0 0 0 0 0 0, p=-1
xxx1         k=47
             x=pdf:pagesize width 143.26802pt height 9.48027pt
down3        a=-4114988

...

push
x_fnt_def    fontnum=40, ptsize=655360
             fontname=/home/mitchell/.TinyTeX/texmf-dist/fonts/opentype/public/lm/lm
fnt_num_40
x_glyph      id=113, x=0, y=0
x_glyph      id=50, x=619315, y=0 
w3           b=218235 
x_glyph      id=75, x=0, y=0

...</code></pre>
</div>
<dl>
<dt><strong>Rendering:</strong></dt>
<dd>
<p>The result of the typesetting step has to be drawn in R.</p>
</dd>
<dd>
<p>The <code>render()</code> function in the <code>xdvir</code> package
allows us to perform this step separately.
For example, the code below renders the typesetting information from
the <code>simpleDVI</code> object
in R. The resulting image is shown below the code.</p>
</dd>
</dl>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.dvi.html'>render</a></span><span class='op'>(</span><span class='va'>simpleDVI</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-19-1.png" width="40%" /></p>
</div>
<p>One detail about the output above is that the rendered text from this
<code>render()</code> call is
smaller and in a different font compared to the example from
the previous section,
which was produced by a <code>grid.latex()</code> call.
This reflects the fact that <code>grid.latex()</code>,
in the authoring step, respects the font family and
font size that are in effect when the text is rendered.
By contrast, the <code>render()</code> call is drawing typeset information
from a LaTeX document that just makes use of the default LaTeX font,
Computer Modern (or to be more precise, a modernized version called
Latin Modern) at 10pt.</p>
<h2 data-number="4" id="packages"><span class="header-section-number">4</span> LaTeX packages</h2>
<p>The code examples so far have dealt with relatively simple fragments of
LaTeX code that consist of just text plus some simple mathematical expressions.
While this is already useful, it barely scratches the surface of
what is possible with
LaTeX code.</p>
<p>Many additional effects can be obtained with LaTeX code by loading
LaTeX packages. As a simple example, changing the color of text
requires loading the LaTeX package <code>xcolor</code>.
These LaTeX packages can be loaded using the <code>packages</code> argument of the
<code>grid.latex()</code> function (or the <code>element_latex()</code> function
or the <code>geom_latex()</code> function).
For example, the following code draws text with the last two
words in red.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>colourTeX</span> <span class='op'>&lt;-</span> <span class='st'>r"(We combine to get the \textcolor{red}{Fitness Function})"</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>colourTeX</span>, packages<span class='op'>=</span><span class='st'>"xcolor"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-21-1.png" width="40%" /></p>
</div>
<p>The argument <code>packages="xcolor"</code> is used in the authoring step to load the
package in the LaTeX document preamble. This is demonstrated below
with an explicit call to the <code>author()</code> function. We can see that
<code>\usepackage{xcolor}</code> has been added to the LaTeX document.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>colourDoc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/author.html'>author</a></span><span class='op'>(</span><span class='va'>colourTeX</span>, packages<span class='op'>=</span><span class='st'>"xcolor"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>colourDoc</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>%% R package xdvir_0.1.3; engine name: XeTeX; engine version: XeTeX 3.141592653-2.6-
\documentclass[varwidth]{standalone}
\usepackage{unicode-math}
\usepackage{xcolor}
\begin{document}
We combine to get the \textcolor{red}{Fitness Function}
\end{document}</code></pre>
</div>
<p>This in turn affects the typesetting step: without the <code>xcolor</code> package, the
LaTeX command <code>\textcolor</code> would not be recognized;
with the <code>xcolor</code> package,
the <code>\textcolor</code> command produces instructions to change color
in the <code>"DVI"</code> output. This is demonstrated below with an
explicit call to the <code>typeset()</code> function. An example of the color-change
instructions is the line containing <code>color push</code> in the output below the code.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>colourDVI</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/typeset.html'>typeset</a></span><span class='op'>(</span><span class='va'>colourDoc</span><span class='op'>)</span></span>
<span><span class='va'>colourDVI</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>pre          version=7, num=25400000, den=473628672, mag=1000,
             comment=R package xdvir_0.1.3; engine name: XeTeX; engine version: XeTe
bop          counters=1 0 0 0 0 0 0 0 0 0, p=-1

...

x_fnt_def    fontnum=40, ptsize=655360
             fontname=/home/mitchell/.TinyTeX/texmf-dist/fonts/opentype/public/lm/lm
fnt_num_40
x_glyph      id=113, x=0, y=0
x_glyph      id=50, x=619315, y=0 

...

xxx1         k=20
             x=color push rgb 1 0 0
x_glyph      id=54, x=0, y=0
x_glyph      id=66, x=427950, y=0

...</code></pre>
</div>
<p>The argument <code>packages="xcolor"</code> is also
used in the rendering step because, without it,
the rendering would not take any notice of the instructions to
change color. This is demonstrated below with an explicit
call to the <code>render()</code> function. The resulting image differs from
the previous one because it uses the default LaTeX font, but we can see the
same change in color for the last two words.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.dvi.html'>render</a></span><span class='op'>(</span><span class='va'>colourDVI</span>, packages<span class='op'>=</span><span class='st'>"xcolor"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-27-1.png" width="40%" /></p>
</div>
<p>There are several LaTeX packages with predefined support in the
<code>xdvir</code> package, including
<code>xcolor</code> for changes in color and <code>fontspec</code> for changes in font.
Support can be added for other LaTeX packages with the
<code>LaTeXpackage()</code> function. We will see other predefined packages
and an example of defining a new LaTeX
package in later sections.</p>
<h2 data-number="5" id="justifying-text"><span class="header-section-number">5</span> Justifying text</h2>
<p>By default, the LaTeX text drawn by <code>grid.latex()</code>
is centered upon a specified location.
For example, the following code draws the <code>simpleTeX</code>
fragment vertically centered
at a location half-way up the image (as indicated by the gray line).</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>simpleTeX</span>, y<span class='op'>=</span><span class='fl'>.5</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-28-1.png" width="40%" /></p>
</div>
<p>We can specify a different justification using the <code>vjust</code> argument.
For example, the following code draws the same <code>simpleTeX</code> fragment
at the same location, but with a bottom-justification.
Notice that the bottom of the text is based on the bounding box
of the text, so the bottom of the text is the bottom of the subscript “i”.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>simpleTeX</span>, y<span class='op'>=</span><span class='fl'>.5</span>, vjust<span class='op'>=</span><span class='st'>"bottom"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-29-1.png" width="40%" /></p>
</div>
<p>In some situations it will be much more useful to
justify text relative to the text baseline, as shown by the following code.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>simpleTeX</span>, y<span class='op'>=</span><span class='fl'>.5</span>, vjust<span class='op'>=</span><span class='st'>"baseline"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-30-1.png" width="40%" /></p>
</div>
<p>The <code>xdvir</code> package has a very simple algorithm for determining the text
baseline, but there is also predefined support for the LaTeX package <code>preview</code>,
which produces a more reliable baseline. That baseline can be accessed,
assuming the <code>preview</code> package is loaded, by
specifying <code>vjust="preview-baseline"</code>.</p>
<p>There is also an <code>hjust</code> argument for horizontal justification.
This accepts the standard values, <code>"left"</code>, <code>"centre"</code>, and <code>"right"</code>, but
also accepts <code>"bbleft"</code>, <code>"bbcentre"</code>, and <code>"bbright"</code>.
The latter three are based on a bounding box around the actual ink
that is drawn, which does not include space before or after glyphs
(left-side bearing and right-side bearing).
The following code provides a demonstration of the difference
by drawing the simple LaTeX fragment from previous examples as the title
of a ggplot2 plot.
We add a (mathematical) vertical bar to the end of the LaTeX fragment
and draw the title larger than normal and justify the text against the
right side of the plot region, using <code>"right"</code> justification first and
then using <code>"bbright"</code> justification.
The output below the code just shows the very top of the plot in order to save
space.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>rightBearingTeX</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>simpleTeX</span>, <span class='st'>"$|$"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>ggIntro</span> <span class='op'>+</span> </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='va'>rightBearingTeX</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/element_latex.html'>element_latex</a></span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>20</span>, hjust<span class='op'>=</span><span class='st'>"right"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-32-1.png" width="95%" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>ggIntro</span> <span class='op'>+</span> </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='va'>rightBearingTeX</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/element_latex.html'>element_latex</a></span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>20</span>, hjust<span class='op'>=</span><span class='st'>"bbright"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-33-1.png" width="95%" /></p>
</div>
<p>The difference between the two plots is that the second vertical bar is
precisely aligned with the right edge of the plot region whereas the
first vertical bar is slightly to the left of the right edge of the plot
region (because of the right-side bearing of the vertical bar glyph).
This is a very small detail, but it is something that can be visually
jarring if we are trying to align components of a plot in order
to produce a clean design. This fine level of control is exactly
the sort of precision that we are seeking by working with LaTeX typesetting.</p>
<h2 data-number="6" id="integrating-text"><span class="header-section-number">6</span> Integrating text</h2>
<p>Justifying LaTeX text is a simple example of a larger problem:
<em>integrating</em> LaTeX text. For example,
the text annotation in Figure <a href="#fig:typesetting">1</a>
is integrated with the plot in the sense that it is positioned
relative to the plot region. In fact, closer inspection reveals
that the text annotation
is carefully top-justified with the maximum y-value of the
red line and right-justified with the maximum x-value of the red line.</p>
<p>Put in terms of <em>integration</em> rather than justification,
the text annotation in Figure <a href="#fig:typesetting">1</a>
is integrated with the plot because the LaTeX text is drawn at a location
that is coordinated with the location of other R graphics drawing in the plot.</p>
<p>Another example of integration, that reverses the roles, is coordinating
other R graphics drawing with the location of LaTeX text.
The following code provides a simple example.
The LaTeX fragment is the simple one from previous examples with
two additions: there are <code>\zsavepos</code> commands to mark specific locations
within the text and associate them with labels (<code>"a"</code> and <code>"b"</code>);
and there are <code>\Rzmark</code> commands to export those
locations for R to see.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>zrefTeX</span> <span class='op'>&lt;-</span> <span class='st'>r"(We move the original\zsavepos{a} mean to \zsavepos{b}$\bar z_i$</span></span>
<span><span class='st'>\Rzmark{a}\Rzmark{b})"</span></span></code></pre>
</div>
</div>
<p>If we render this LaTeX fragment, we just get the familiar output.
The commands that we added to the LaTeX fragment
are based on the LaTeX package <code>zref</code>,
so we must load that package.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>zrefTeX</span>, packages<span class='op'>=</span><span class='st'>"zref"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-35-1.png" width="40%" /></p>
</div>
<p>However, we can now access the special locations in the LaTeX
output using the
<code>getMark()</code> function from the <code>xdvir</code> package.
For example, the following code accesses location <code>"a"</code>, which is just after
the word “original”, and draws
a small red dot at that location.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/getMark.html'>getMark</a></span><span class='op'>(</span><span class='st'>"a"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>grid.circle</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>$</span><span class='va'>devx</span>, <span class='va'>a</span><span class='op'>$</span><span class='va'>devy</span>, r<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='st'>"mm"</span><span class='op'>)</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='fl'>2</span>, fill<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-36-1.png" width="40%" /></p>
</div>
<p>The following code accesses location <code>"b"</code>, which is just before the letter “z”,
and draws a curved arrow
from <code>"a"</code> to <code>"b"</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/getMark.html'>getMark</a></span><span class='op'>(</span><span class='st'>"b"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/grid.xspline.html'>grid.xspline</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.c.html'>unit.c</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>$</span><span class='va'>devx</span>, <span class='fl'>.5</span><span class='op'>*</span><span class='op'>(</span><span class='va'>a</span><span class='op'>$</span><span class='va'>devx</span> <span class='op'>+</span> <span class='va'>b</span><span class='op'>$</span><span class='va'>devx</span><span class='op'>)</span>, <span class='va'>b</span><span class='op'>$</span><span class='va'>devx</span><span class='op'>)</span>,</span>
<span>             <span class='fu'><a href='https://rdrr.io/r/grid/unit.c.html'>unit.c</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>$</span><span class='va'>devy</span>, <span class='va'>a</span><span class='op'>$</span><span class='va'>devy</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='st'>"mm"</span><span class='op'>)</span>, <span class='va'>a</span><span class='op'>$</span><span class='va'>devy</span><span class='op'>)</span>,</span>
<span>             shape<span class='op'>=</span><span class='op'>-</span><span class='fl'>1</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='fl'>2</span>, fill<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>,</span>
<span>             arrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/arrow.html'>arrow</a></span><span class='op'>(</span>length<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"mm"</span><span class='op'>)</span>, type<span class='op'>=</span><span class='st'>"closed"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-37-1.png" width="40%" /></p>
</div>
<p>The exported locations also produce “anchors” that we can use to justify
LaTeX text. For example, the following code
draws the simple LaTeX fragment with position <code>"a"</code> at
the center of the image (which is indicated by gray lines).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>zrefTeX</span>, packages<span class='op'>=</span><span class='st'>"zref"</span>, hjust<span class='op'>=</span><span class='st'>"a"</span>, vjust<span class='op'>=</span><span class='st'>"a"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-38-1.png" width="40%" /></p>
</div>
<p>Figure <a href="#fig:zref">4</a> provides a more realistic demonstration.
This figure shows the plot from Figure <a href="#fig:typesetting">1</a>
with a line added to visually connect the thick red line with
the red part of the LaTeX annotation.
The code for this plot is not shown for reasons of space, but it
makes use of the same basic idea as the code above by saving locations within
the LaTeX output and then accessing them with the <code>getMark()</code> function.
The full code is available in the supplementary materials for this article.</p>
<div class="layout-chunk" data-layout="l-body">

</div>

<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:zref"></span>
<img src="RJ-2025-028_files/figure-html5/zref-1.png" alt="A line plot with two curves as in Figure 1.  The annotation is in the top-left corner as in Figure 1 and there is an additional red line from the thick red line in the plot to the last two words in the annotation, which are also red." width="100%" />
<p class="caption">
Figure 4: The <code>ggplot2</code> plot from Figure <a href="#fig:typesetting">1</a>, including the LaTeX annotation, with a line added relative to marked locations within the LaTeX annotation (and relative to the thick red line).
</p>
</div>
</div>
<h2 data-number="7" id="latex-graphics"><span class="header-section-number">7</span> LaTeX graphics</h2>
<p>The examples so far have demonstrated using LaTeX code to describe
text labels, combined with using R to draw general
graphics—lines and circles and so on.
It is also possible to use LaTeX to draw general graphics.
In particular, the LaTeX package TikZ provides very powerful and flexible
graphics facilities.
The <code>xdvir</code> package provides support for the LaTeX package TikZ,
so we are able to render TikZ graphics in R.</p>
<p>For example, the following LaTeX code describes a TikZ picture
consisting of two text labels enclosed within circles, with
arrows connecting the circles.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>tikzTeX</span> <span class='op'>&lt;-</span> <span class='st'>r"(%</span></span>
<span><span class='st'>\path (0, 0) node[circle,minimum size=.5in,draw,thick] (x) {\sffamily{R}} </span></span>
<span><span class='st'>       (3, 0) node[circle,minimum size=.5in,draw,thick] (y) {Ti\textit{k}Z!};</span></span>
<span><span class='st'>\draw[-{stealth},thick] (x) .. controls (1, 1) and (2, 1).. (y);</span></span>
<span><span class='st'>\draw[-{stealth},thick] (y) .. controls (2, -1) and (1, -1) .. (x);)"</span></span></code></pre>
</div>
</div>
<p>The following code draws this TikZ picture in R.
The argument
<code>packages="tikzPicture"</code> is necessary to ensure that the TikZ package
is loaded in the authoring step, that TikZ output is produced in the
typesetting step, and that R takes notice of the TikZ
output in the rendering step.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>tikzTeX</span>, packages<span class='op'>=</span><span class='st'>"tikzPicture"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-40-1.png" width="40%" /></p>
</div>
<p>The label on the x-axis of Figure <a href="#fig:geomlatex">3</a>
is another simple TikZ picture that
uses TikZ commands to draw the Greek letter mu
within a circle.
This example is not completely trivial because it uses the
LaTeX concept of “phantom” text to make the circle large enough to fit
a capital “M” even though no such character is drawn.
This is another example of the detailed typesetting capabilities
that access to LaTeX provides.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>muDot</span> <span class='op'>&lt;-</span> <span class='st'>r"(%</span></span>
<span><span class='st'>\begin{tikzpicture}</span></span>
<span><span class='st'>\node[draw,circle,thick,inner sep=0.5mm]{\vphantom{M}$\mu$};</span></span>
<span><span class='st'>\end{tikzpicture})"</span></span></code></pre>
</div>
</div>
<p>The LaTeX code this time includes an explicit <code>\begin{tikzpicture}</code>
and <code>\end{tikzpicture}</code>. Those commands were implicitly added in the previous
example because we specified <code>packages="tikzPicture"</code>.
This time, we have explicitly provided the commands, so we
just specify <code>packages="tikz"</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>muDot</span>, packages<span class='op'>=</span><span class='st'>"tikz"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2025-028_files/figure-html5/unnamed-chunk-42-1.png" width="40%" /></p>
</div>
<p>We will see a more complex example of TikZ output in a later section.
Figure <a href="#fig:diag">5</a> is also a TikZ picture that has been rendered
in R.</p>
<h2 data-number="8" id="programmatic-generation-of-latex"><span class="header-section-number">8</span> Programmatic generation of LaTeX</h2>
<p>One obstacle to adopting the <code>xdvir</code> package is that it
assumes that the user knows how to create a LaTeX fragment
(i.e., write LaTeX code). While the <code>xdvir</code> package provides
some assistance so that the user is only required to write a LaTeX
fragment rather than a complete LaTeX document, LaTeX fragments
for text labels tend to be more complex than
plain text labels, thanks to the additional markup that is required.</p>
<p>However, LaTeX code is still
just text. This means that all of the text-generating tools in R
are available to help with authoring LaTeX fragments.
For example, the labels used to render text data symbols in
Figure 3 could be generated via a simple call to the <code>paste0()</code> function,
as shown below.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"$\\bar x_"</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span>, <span class='st'>"$"</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] &quot;$\\bar x_1$&quot; &quot;$\\bar x_2$&quot; &quot;$\\bar x_3$&quot; &quot;$\\bar x_4$&quot;
[5] &quot;$\\bar x_5$&quot;</code></pre>
</div>
<p>There are also packages that can generate larger fragments of
LaTeX code. For example, there are packages like <a href="https://cran.r-project.org/package=xtable">xtable</a>
<span class="citation" data-cites="pkg:xtable">(<a href="#ref-pkg:xtable" role="doc-biblioref">Dahl et al. 2019</a>)</span> and <a href="https://cran.r-project.org/package=latexpdf">latexpdf</a> <span class="citation" data-cites="pkg:latexpdf">(<a href="#ref-pkg:latexpdf" role="doc-biblioref">Bergsma 2023</a>)</span>
for generating LaTeX tables and the <a href="https://cran.r-project.org/package=rmarkdown">rmarkdown</a>
package <span class="citation" data-cites="pkg:rmarkdown">(<a href="#ref-pkg:rmarkdown" role="doc-biblioref">Xie et al. 2018</a>)</span>
can generate LaTeX documents from Markdown input.
The Literate Programming section of the <a href="https://cran.r-project.org/web/views/ReproducibleResearch.html">Reproducible Research
CRAN Task View</a>
provides a more comprehensive list of relevant R packages.
The <a href="https://cran.r-project.org/package=texPreview">texPreview</a> package <span class="citation" data-cites="pkg:texPreview">(<a href="#ref-pkg:texPreview" role="doc-biblioref">Sidi and Polhamus 2024</a>)</span>
may also be helpful for previewing
the output of LaTeX code within an R session.</p>
<p>Some of
these tools can be particularly
useful for generating larger chunks of LaTeX code,
although the LaTeX code that is produced may consist of
entire documents rather than just LaTeX fragments.
The next section describes how we can cope with that situation.</p>
<h2 data-number="9" id="customization-and-debugging"><span class="header-section-number">9</span> Customization and debugging</h2>
<p>Most of the examples in this article take a fragment of LaTeX code
and pass it to the <code>grid.latex()</code> function, which performs an
authoring step, a typesetting step, and a rendering step.
We saw in a previous section that there are functions
<code>author()</code>, <code>typeset()</code>, and <code>render()</code>
that allow us to perform these steps separately (see Figure <a href="#fig:diag">5</a>).
This provides more control over the individual steps and allows
us to inspect the results of the individual steps, which can be
useful for debugging.
In this section, we explore further options for controlling the
authoring, typesetting, and rendering steps.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:diag"></span>
&lt;img src=“RJ-2025-028_files/figure-html5/diag-1.png” alt=“A diagram showing the structure of the xdvir package. Starting from a box labelled”LaTeX fragment” on the left, wecan follow an arrow to the right labelled “author()” to a box labelled “LaTeXdocument object”. From there we can follow an arrow to the right labelled “typeset()” to a box labelled “DVI object”. From there we can follow an arrow to the right labelled “render()” to a box labelled “rendered glyphs”. Alternatively, we can start at the left with the box labelled “LaTeX fragment” and follow an arrow labelled “grid.latex()” that curves up and over to the right in one step to the box labelled “rendered glyphs”. All of those boxes and arrows are within a grey rectangle labelled “R”. There are also two boxes below, outside the grey rectangle labelled “LateX document” and “DVI file” with an arrow labelled “xelatex” from left to right between them. We can follow an arrow up from “LaTeX document” into the grey rectangle to the box labelled “LaTeXdocument object” and an arrow up from “DVI file” into the grey rectangle labelled “DVI object”.” width=“100%” /&gt;
<p class="caption">
Figure 5: The design of the <code>xdvir</code> package.
</p>
</div>
</div>
<p>The <code>author()</code> function transforms a LaTeX fragment into a
complete LaTeX document. Although there are arguments to the <code>author()</code>
function that allow some control over that transformation,
e.g., the <code>packages</code> argument, it does not allow full control
over the composition of the LaTeX document.
Fortunately, a LaTeX document within R is essentially just a character vector,
so another way to author a LaTeX document is to create an external text file
and read that into R. This allows complete control over the content
of the LaTeX document.
Another possibility is that we want to use a LaTeX document that
we did not create, for example, if we write Markdown code and
convert it to LaTeX code.</p>
<p>The <code>typeset()</code> function transforms a LaTeX document into a <code>"DVI"</code> object
that contains a set of typeset glyphs. There is limited control over this
process as well, with only the <code>engine</code> argument allowing us to select between
<code>"xetex"</code> or <code>"luatex"</code>. Again, one way to
obtain greater control is to
perform this step outside of R by running
a TeX engine, e.g., <code>xelatex</code>, on an external text file to produce a DVI
file. The <code>xdvir</code> package provides the <code>readDVI()</code> function
to read external DVI files into R and these can then be passed to
the <code>render()</code> function for drawing.</p>
<p>One important caveat is that both
a <code>"LaTeXdocument"</code> object that is produced by
the <code>author()</code> function and a <code>"DVI"</code> object that is produced by the
<code>typeset()</code> function contain information about how they were created,
for example, the TeX <code>engine</code> that was specified and the LaTeX
packages that were loaded.
The <code>typeset()</code> function checks this information and warns if we ask
to typeset a <code>"LaTeXdocument"</code> that was produced for a different TeX engine.
Similarly, the <code>render()</code> function, which also has an <code>engine</code> argument,
checks and warns if we ask to render a
<code>"DVI"</code> object that was produced using a different TeX engine.</p>
<p>External LaTeX documents and DVI files do not (explicitly) contain this
information so it is up to the user to ensure that the TeX engine,
and any LaTeX packages, are consistent with the arguments provided
to the functions <code>typeset()</code> and <code>render()</code>.
In some situations, even with the appropriate level of care,
it will be impossible to avoid warnings.</p>
<h2 data-number="10" id="example-1"><span class="header-section-number">10</span> Example 1</h2>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>This section demonstrates a more complete example of rendering LaTeX text
within a plot. The plot, shown in Figure <a href="#fig:rahlf">6</a>,
provides a clear example of the more advanced typesetting
capabilities of LaTeX; the text annotation in the top-left corner
of the plot is not only typeset into two columns,
but both columns are fully justified and feature several examples of
hyphenation.</p>
<p>This example also demonstrates one way to integrate a
<code>grid.latex()</code> call with a plot that was drawn using functions
from the <code>graphics</code> package. We will also see a simple
demonstration of the <code>LaTeXpackage()</code> function to allow use of
a LaTeX package that has no predefined support in <code>xdvir</code>.</p>

<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:rahlf"></span>
<img src="RJ-2025-028_files/figure-html5/rahlf-1.png" alt="A line plot showing GDP of Chile increasing over time.  The important feature is an annotation in the top-left corner of the plot that consists of two fully-justified columns of text, which was produced from a fragment of LaTeX code." width="100%" />
<p class="caption">
Figure 6: A plot with a two-column text annotation. This plot is an adaptation of Figure 4.1 from Thomas Rahlf’s book “Data Visualisation with R” <span class="citation" data-cites="rahlf">(<a href="#ref-rahlf" role="doc-biblioref">Rahlf 2017</a>)</span>.
</p>
</div>
</div>
<p>The details of the code that produces the main plot—everything except
the two columns of text in the top-left corner—are not relevant
to this article so we perform this drawing
just with a call to a <code>rahlfPlot()</code> function that is defined in the
supplementary material for the article. The result is shown in
Figure <a href="#fig:rahlfplain">7</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'>rahlfPlot</span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>

<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:rahlfplain"></span>
<img src="RJ-2025-028_files/figure-html5/rahlfplain-1.png" alt="The main plot from Figure 6 without the two columns of text annotation. This plot is drawn using functions from the graphics package." width="100%" />
<p class="caption">
Figure 7: The main plot from Figure <a href="#fig:rahlf">6</a> without the two columns of text annotation. This plot is drawn using functions from the <code>graphics</code> package.
</p>
</div>
</div>
<p>Because the main plot is drawn using functions from the <code>graphics</code> package,
in order to integrate the output from <code>grid.latex()</code> with the plot,
we need to convert the plot to an equivalent drawing that uses
functions from the <code>grid</code> package.
This can be achieved with the <code>grid.echo()</code> function from the
<a href="https://cran.r-project.org/package=gridGraphics">gridGraphics</a> package <span class="citation" data-cites="pkg-gridgraphics">(<a href="#ref-pkg-gridgraphics" role="doc-biblioref">Murrell and Wen 2020</a>)</span>, as shown below.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/pmur002/gridgraphics'>gridGraphics</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/gridGraphics/man/grid.echo.html'>grid.echo</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We want to integrate
the LaTeX text with the main plot. In particular, we want
the top of the text to be aligned with the value 14,000 on the y-scale
of the plot. There is also a 1cm gap between the left of the text
and the y-axis line.
In order to achieve this, we can navigate to the <code>grid</code> viewport
that corresponds to the main plot region, which also has scales
that match the plot scales.
The naming scheme for the <code>grid</code> viewports that <code>grid.echo()</code>
generates is described in <span class="citation" data-cites="RJ-2015-012">Murrell (<a href="#ref-RJ-2015-012" role="doc-biblioref">2015</a>)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>downViewport</a></span><span class='op'>(</span><span class='st'>"graphics-window-1-1"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We are now ready to render the LaTeX text within the plot.
The LaTeX code for this example is shown below.
This is a larger LaTeX fragment than we have previously seen,
but more importantly it contains a larger number of LaTeX commands
to control the typesetting of the text.
For example, we control the font family with a <code>\setmainfont</code> command,
we control font size and vertical line spacing
with a <code>\fontsize</code> command,
we control the overall width of the text using a <code>minipage</code>
environment,
we set the number of columns using a <code>multicol</code> environment,
and we control the horizontal spacing between columns with
a <code>\setlength</code> command.</p>
<div class="layout-chunk" data-layout="l-body">
<pre><code>\setmainfont{Lato-Light}
\fontsize{12pt}{17pt}\selectfont
\setlength{\columnsep}{1cm}
\begin{minipage}[t]{16.25cm}
\begin{multicols}{2} 
From a general and economic policy perspective, the entire period from
1820 to 1930 can be described as a relatively liberal period. With the
&quot;Pacific War&quot;, as a result of which the nitrate mines were awarded to
Chile, the economy experienced a profound upswing. The period from
1940 to 1973 is generally seen as a phase in which the government
increasingly intervened in the economy and Chile was isolated
internationally. During the Allende regime (1971 to 1973), this policy
was exaggerated and the economy practically became a central
economy. The military regime (1973 to 1990)---despite numerous
violations of human rights---ensured liberalization of trade and
finance.
\end{multicols}
\end{minipage} </code></pre>
</div>
<p>The <code>\setmainfont</code> and
<code>\fontsize</code> commands in the LaTeX code require the LaTeX package <code>fontspec</code>
to be loaded, but this is not a problem because there is predefined support
for <code>fontspec</code> in the <code>xdvir</code> package. However, the <code>multicol</code> environment
in the LaTeX code requires the LaTeX package <code>multicol</code> and there is no
predefined support for that in <code>xdvir</code>. The following code uses the
<code>LaTeXpackage()</code> function to provide support for the LaTeX package <code>multicol</code>.
In a simple case like this, all we have to do is provide a name for the
package (<code>"multicol"</code>) and use the <code>preamble</code> argument to
provide the LaTeX code that should be added in the
authoring step to load the LaTeX package.
We also call the <code>registerPackage()</code> function so that we can refer to this
LaTeX package just by its name.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>multicol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/LaTeXpackage.html'>LaTeXpackage</a></span><span class='op'>(</span><span class='st'>"multicol"</span>,</span>
<span>                         preamble<span class='op'>=</span><span class='st'>"\\usepackage{multicol}"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/LaTeXpackage.html'>registerPackage</a></span><span class='op'>(</span><span class='va'>multicol</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Finally, we call <code>grid.latex()</code> to add the LaTeX text to the plot.
The object <code>rahlfTeX</code> contains the LaTeX code,
we specify the LaTeX packages that have to be loaded, including
the <code>"multicol"</code> package that we just registered, and
we position the text 1cm in from the left of the
the plot viewport and at 14,000 on the y-axis.
The final result is shown in Figure <a href="#fig:rahlf">6</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>rahlfTeX</span>, </span>
<span>           packages<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"fontspec"</span>, <span class='st'>"multicol"</span><span class='op'>)</span>,</span>
<span>           x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"cm"</span><span class='op'>)</span>, y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>14000</span>, <span class='st'>"native"</span><span class='op'>)</span>, </span>
<span>           hjust<span class='op'>=</span><span class='st'>"left"</span>, vjust<span class='op'>=</span><span class='st'>"top"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 data-number="11" id="example-2"><span class="header-section-number">11</span> Example 2</h2>
<p>This section looks at another more complete example of a plot with
a LaTeX annotation (Figure <a href="#fig:schneider">8</a>). This example
demonstrates the sophisticated effects that are possible by
combining TikZ graphics with LaTeX typesetting, in this case
to produce an annotated mathematical expression.
This example also demonstrates a way to integrate lower-level
<code>grid.latex()</code> output with a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot
(rather than using <code>element_latex()</code> or <code>geom_latex()</code>).</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>

<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:schneider"></span>
<img src="RJ-2025-028_files/figure-html5/schneider-1.png" alt="A Normal density curve plot.  The important feature is an annotation iin the top-right corner of the plot that consists of an annotated mathematical equation, which was produced from a fragment of LaTeX code." width="100%" />
<p class="caption">
Figure 8: A plot with annotated mathematical expression. This plot is an adaptation of the plot in <span class="citation" data-cites="schneider2023">Schneider (<a href="#ref-schneider2023" role="doc-biblioref">2023</a>)</span>.
</p>
</div>
</div>
<p>The main plot in this example is a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot.
The details of the code that generates the main plot
are not particularly relevant to this article, so the
main plot is described in the object <code>ggSchneider</code>, which
is defined in the supplementary materials for the article.
One point worth noting is that the labeling on the x-axis, which
combines italic Greek letters with upright digits and signs, is produced
using the <a href="https://cran.r-project.org/package=ggtext">ggtext</a> package.
In other words, this example combines two levels of text annotation:
labels on the x-axis that are relatively simple, but still beyond the
capabilities of core R text drawing; and much more sophisticated
text annotations that require access to a complex system like LaTeX.
The main plot produced by <code>ggSchneider</code> is shown in Figure
<a href="#fig:schneiderplain">9</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>ggSchneider</span></span></code></pre>
</div>
</div>

<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:schneiderplain"></span>
<img src="RJ-2025-028_files/figure-html5/schneiderplain-1.png" alt="The main plot from Figure 8 without the annotated mathematical expression. This plot is produced using the packages ggplot2 and ggtext." width="100%" />
<p class="caption">
Figure 9: The main plot from Figure <a href="#fig:schneider">8</a> without the annotated mathematical expression. This plot is produced using the packages <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> and <a href="https://cran.r-project.org/package=ggtext">ggtext</a>.
</p>
</div>
</div>
<p>The start of the LaTeX code for the annotated expression is shown below
(the full code is included in the supplementary materials for this article).
The LaTeX code
is arranged in three blocks: the first block of code defines some colors;
the second block describes the main mathematical expression, but includes
some <code>\eqnmark</code> commands to save locations within the expression;
and the third block shows one of the additional mathematical
expression annotations, which
refers to one of the saved locations within the main mathematical
expression, in this case
the “z”, and positions a
label relative to that location, in this case the label “z-score”,
which is positioned
above and to the left of the “z”.</p>
<div class="layout-chunk" data-layout="l-body">
<pre><code>\definecolor{myviolet}{HTML}{440154}
\definecolor{myblue}{HTML}{3B528B}
\definecolor{myindigo}{HTML}{21908C}
\definecolor{mygreen}{HTML}{5DC863}
    
\huge$
\eqnmark[myviolet]{z}{z} = 
\frac{
    \eqnmark[myblue]{x}{X}-
    \eqnmark[myindigo]{mu}{\mu}}{
    \eqnmark[mygreen]{sigma}{\sigma}}
$

\annotate[
    yshift=1em, 
    myviolet,
    align=right]
    {above, left}
    {z}
    {$z$-score}
    </code></pre>
</div>
<p>There are several LaTeX packages required by this LaTeX code,
in particular the <code>\eqnmark</code> and <code>\annotate</code> commands require the LaTeX
package <code>annotate-equations</code>.
As in the previous example, we can add support for this package
using the <code>LaTeXpackage()</code> and <code>registerPackage()</code> functions.
One difference this time is that the <code>annotate-equations</code> package is being
loaded from a local <code>TeX</code> directory. The previous example
relied on the LaTeX package being available as part of the
user’s (or the system-wide) TeX installation.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>annotateEquations</span> <span class='op'>&lt;-</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/LaTeXpackage.html'>LaTeXpackage</a></span><span class='op'>(</span>name<span class='op'>=</span><span class='st'>"annotate"</span>,</span>
<span>                 preamble<span class='op'>=</span><span class='st'>"\\usepackage{TeX/annotate-equations}"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/LaTeXpackage.html'>registerPackage</a></span><span class='op'>(</span><span class='va'>annotateEquations</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The LaTeX package <code>annotate-equations</code> is built on TikZ graphics.
We do not need to load the LaTeX package <code>tikz</code> because <code>annotate-equations</code>
will do that automatically. However, <code>xdvir</code> by default makes use
of the bounding box information from TikZ graphics and, for images with
saved locations like this, that bounding box is unreliable.
The predefined support for the LaTeX package <code>tikz</code> in the <code>xdvir</code> package
includes a <code>tikzPackage()</code> function that allows us to load TikZ, but
ignore its bounding boxes, as shown in the following code.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>tikzNoBBox</span> <span class='op'>&lt;-</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/tikzPackage.html'>tikzPackage</a></span><span class='op'>(</span>name<span class='op'>=</span><span class='st'>"tikzNoBBox"</span>, bbox<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/LaTeXpackage.html'>registerPackage</a></span><span class='op'>(</span><span class='va'>tikzNoBBox</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Finally, we will use the LaTeX package <code>roboto</code> to access
specific variations of the Roboto font for the text labels
in the annotated mathematical expressions.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>roboto</span> <span class='op'>&lt;-</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/LaTeXpackage.html'>LaTeXpackage</a></span><span class='op'>(</span>name<span class='op'>=</span><span class='st'>"roboto"</span>,</span>
<span>                 preamble<span class='op'>=</span><span class='st'>"\\usepackage[sfdefault,condensed]{roboto}"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/LaTeXpackage.html'>registerPackage</a></span><span class='op'>(</span><span class='va'>roboto</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Rendering the annotated mathematical expression on the plot
requires integrating the LaTeX output with the
<a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot. In particular, we want to align the top of the LaTeX
output with the top of the density curve and we want to align the right side
of the LaTeX output with the right edge of the label “160” on the x-axis.</p>
<p>We saw in an earlier section
how to use <code>element_latex()</code> to draw LaTeX text
in labels such as the plot title on a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot
and how to use <code>geom_latex()</code> to draw LaTeX text
as data symbols.
In this example, we are adding a single LaTeX annotation at a specific
position within a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot, so
we use the <a href="https://cran.r-project.org/package=gggrid">gggrid</a> package <span class="citation" data-cites="pkg-gggrid">(<a href="#ref-pkg-gggrid" role="doc-biblioref">Murrell 2022</a>)</span>.
This package provides the <code>grid_panel()</code> function, which we can
add to a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot, much like the standard <code>ggplot2::geom_point()</code>
function, to add <code>grid</code> drawing to a <code>ggplot2</code> plot.
The first argument to <code>grid_panel()</code> is a function that must
generate a <code>grid</code> grob for <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> to draw, based on the
data values that <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> passes to it.
In this case, we define a function called <code>annotation()</code>, which
calls the <code>xdvir</code> function <code>latexGrob()</code>. The <code>latexGrob()</code> function
is similar to
<code>grid.latex()</code> except that it creates a description of something to draw
rather than immediately drawing it.
We pass to <code>latexGrob()</code> the LaTeX code to draw the annotated
mathematical expression (<code>schneiderTeX</code>),
a set of <code>packages</code> to load, and arguments that position
the output relative to the plot.
The final result is shown in Figure <a href="#fig:schneider">8</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/pmur002/gggrid'>gggrid</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>annotation</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>coords</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>latexGrob</a></span><span class='op'>(</span><span class='va'>schneiderTeX</span>, </span>
<span>              packages<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"tikzNoBBox"</span>, <span class='st'>"annotate"</span>, <span class='st'>"roboto"</span>, <span class='st'>"xcolor"</span><span class='op'>)</span>,</span>
<span>              x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='va'>coords</span><span class='op'>$</span><span class='va'>x</span>, <span class='st'>"npc"</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.5</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/grid/stringWidth.html'>stringWidth</a></span><span class='op'>(</span><span class='st'>"160"</span><span class='op'>)</span>,</span>
<span>              y<span class='op'>=</span><span class='va'>coords</span><span class='op'>$</span><span class='va'>y</span>, hjust<span class='op'>=</span><span class='fl'>1</span>, vjust<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>ggSchneider</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/gggrid/man/grid_panel.html'>grid_panel</a></span><span class='op'>(</span><span class='va'>annotation</span>, </span>
<span>               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x</span>, y<span class='op'>=</span><span class='va'>y</span><span class='op'>)</span>, </span>
<span>               data<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>160</span>, y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span><span class='fl'>100</span>, mean<span class='op'>=</span><span class='fl'>100</span>, sd<span class='op'>=</span><span class='fl'>15</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 data-number="12" id="example-3"><span class="header-section-number">12</span> Example 3</h2>
<p>This section
provides another demonstration of the range of possibilities that is
provided by
LaTeX typesetting. This
time we add annotations that are formatted as numbered
list items below a plot (Figure <a href="#fig:anzjs">10</a>).</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>

<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:anzjs"></span>
<img src="RJ-2025-028_files/figure-html5/anzjs-1.png" alt="A line plot of the traffic at Auckland airport, covering the period of the COVID pandemic.  The important features are two annotations below the plot, at the start and end of the border closures in New Zealand.  Each annotation is a numbered list item produced from a fragment of LaTeX code." width="100%" />
<p class="caption">
Figure 10: A plot with numbered list items as annotations below the plot. This plot is an adaptation of Figure 10 from <span class="citation" data-cites="anzjs2025">Murrell (<a href="#ref-anzjs2025" role="doc-biblioref">in press</a>)</span>.
</p>
</div>
</div>
<p>The main plot is a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot with a number of relatively
simple annotations already added.
The details of the code are not particularly relevant to this
article, so the main plot is described in the object <code>ggANZJS</code>,
which is defined in the supplementary materials for the article.
One point worth noting is that the LaTeX annotations that we will
be adding are required to fit within the lines that extend below the plot.
In other words, we will be specifying a fixed width for the LaTeX output
to fit into.
The main plot produced by <code>ggANZJS</code> is shown in Figure <a href="#fig:anzjsplain">11</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>ggANZJS</span></span></code></pre>
</div>
</div>

<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:anzjsplain"></span>
<img src="RJ-2025-028_files/figure-html5/anzjsplain-1.png" alt="The main plot from Figure 10 without the numbered list items as annotations. This plot is produced using the ggplot2 package." width="100%" />
<p class="caption">
Figure 11: The main plot from Figure <a href="#fig:anzjs">10</a> without the numbered list items as annotations. This plot is produced using the <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> package.
</p>
</div>
</div>
<p>We will focus on drawing just the left-hand LaTeX annotation.
The LaTeX code is shown below.
This includes commands to control the font size and an <code>enumerate</code>
environment that creates a numbered list item.</p>
<div class="layout-chunk" data-layout="l-body">
<pre><code>%
\fontsize{10}{12}
\selectfont
\begin{enumerate}
\item New Zealand closes its borders to \textit{almost} all travellers at
\textbf{23:59, 19 March 2020 (NZDT)}.
\end{enumerate}</code></pre>
</div>
<p>As with the previous example, we have a single annotation that we want
to position quite carefully, so we define a function that generates
a <code>grid</code> grob to use with the <code>grid_panel()</code> function from the
<a href="https://cran.r-project.org/package=gggrid">gggrid</a> package.
The <code>labelLeft()</code> function calls <code>latexGrob()</code>, gives it the LaTeX code
to draw (<code>closeTeX</code>), specifies the position for the LaTeX output,
and specifies a <code>width</code> for the output to be typeset within.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>labelLeft</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>coords</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>x1</span> <span class='op'>&lt;-</span> <span class='va'>coords</span><span class='op'>$</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span></span>
<span>    <span class='va'>x2</span> <span class='op'>&lt;-</span> <span class='va'>coords</span><span class='op'>$</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span></span>
<span>    <span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>-</span> <span class='va'>x2</span>, <span class='st'>"npc"</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"mm"</span><span class='op'>)</span></span>
<span>    <span class='va'>gap</span> <span class='op'>&lt;-</span> <span class='fl'>15</span></span>
<span>    <span class='va'>latex1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>latexGrob</a></span><span class='op'>(</span><span class='va'>closeTeX</span>,</span>
<span>                        x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='va'>x1</span>, <span class='st'>"npc"</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"mm"</span><span class='op'>)</span>, </span>
<span>                        y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"npc"</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='va'>gap</span>, <span class='st'>"mm"</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"mm"</span><span class='op'>)</span>,</span>
<span>                        hjust<span class='op'>=</span><span class='fl'>1</span>, vjust<span class='op'>=</span><span class='fl'>1</span>,</span>
<span>                        width<span class='op'>=</span><span class='va'>w</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<p>The following code combines the left-hand label annotation,
and a very similar right-hand label annotation, with the
<code>ggANZJS</code> plot.
The final result is shown in Figure <a href="#fig:anzjs">10</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>ggANZJS</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/gggrid/man/grid_panel.html'>grid_panel</a></span><span class='op'>(</span><span class='va'>labelLeft</span>,</span>
<span>               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>borders</span><span class='op'>)</span>,</span>
<span>               data<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>borders<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>borderClosed</span>, <span class='va'>borderOpen</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/gggrid/man/grid_panel.html'>grid_panel</a></span><span class='op'>(</span><span class='va'>labelRight</span>,</span>
<span>               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>borders</span><span class='op'>)</span>,</span>
<span>               data<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>borders<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>borderClosed</span>, <span class='va'>borderOpen</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 data-number="13" id="example-4"><span class="header-section-number">13</span> Example 4</h2>
<p>This section provides an example of integrating <code>grid.latex()</code> output
with a multi-panel <a href="https://cran.r-project.org/package=lattice">lattice</a> plot <span class="citation" data-cites="pkg-lattice">(<a href="#ref-pkg-lattice" role="doc-biblioref">Sarkar 2008</a>)</span>.
The plot is shown in
Figure <a href="#fig:lattice">12</a>.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>

<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:lattice"></span>
<img src="RJ-2025-028_files/figure-html5/lattice-1.png" alt="A mulit-panel/facetted line plot showing crime statistics over time, with separate lines for males and females and a separate panel for each type of crime.  The important features are the labels in each panel that describe the type of crime, which are fully-justified to the widths of the panels and are based on fragments of LaTeX code.  The plot title is also based on a LaTeX fragment that colours the word Male the same blue as the lines representing males in each panel and the word Female the same yellow as the lines representing females in each panel." width="100%" />
<p class="caption">
Figure 12: A <a href="https://cran.r-project.org/package=lattice">lattice</a> plot with LaTeX text used for the plot title and for annotations in each panel.
</p>
</div>
</div>
<p>The main plot is a <a href="https://cran.r-project.org/package=lattice">lattice</a> plot consisting of multiple panels,
with separate lines for males and females.
The details of the code for generating the main plot are not relevant
to this article, so it is described in the object <code>latticeCrime</code>, which
is defined in the supplementary material.
The main plot produced by <code>latticeCrime</code> is shown in
Figure <a href="#fig:latticeplain">13</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>latticeCrime</span></span></code></pre>
</div>
</div>

<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:latticeplain"></span>
<img src="RJ-2025-028_files/figure-html5/latticeplain-1.png" alt="The main plot from Figure 12 without the title and annotations in each panel. This plot is produced using the lattice package." width="100%" />
<p class="caption">
Figure 13: The main plot from Figure <a href="#fig:lattice">12</a> without the title and annotations in each panel. This plot is produced using the <a href="https://cran.r-project.org/package=lattice">lattice</a> package.
</p>
</div>
</div>
<p>We can add drawing to each panel of a <a href="https://cran.r-project.org/package=lattice">lattice</a> plot by providing
a <em>panel function</em>. The panel function is passed the
relevant data for the panel, and the code within the panel function is run
in the panel viewport, which means that the appropriate axis scales are
available. This means that we can include a call to <code>grid.latex()</code>
within a panel function in order to add LaTeX text to each panel.
For example, the following code defines the panel function for
Figure <a href="#fig:lattice">12</a>.
This function calculates the appropriate label for the panel
and encloses that within a LaTeX <code>minipage</code> environment
that is the width of the panel. This means that the label is typeset
to be fully-justified within the panel (unless it is a single line that is
narrower than the panel).
We use a <code>minipage</code> environment in the LaTeX fragment
rather than just using the
<code>width</code> argument to <code>grid.latex()</code> because <code>minipage</code> produces a more
precise width.
The panel function then calls <code>grid.latex()</code> to draw
that LaTeX fragment, placing the label slightly above the first data value
for males. The call to the <code>mainPanel()</code> function draws the yellow and
blue lines that are part of the main plot.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>latexPanel</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>subscripts</span>, <span class='va'>groups</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>type</span> <span class='op'>&lt;-</span> <span class='va'>crime</span><span class='op'>$</span><span class='va'>Type</span><span class='op'>[</span><span class='va'>subscripts</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span></span>
<span>    <span class='va'>labelY</span> <span class='op'>&lt;-</span> <span class='va'>y</span><span class='op'>[</span><span class='va'>groups</span> <span class='op'>==</span> <span class='st'>"Male"</span><span class='op'>]</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span></span>
<span>    <span class='va'>labelWidth</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.convert.html'>convertWidth</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"npc"</span><span class='op'>)</span>, <span class='st'>"in"</span>, valueOnly<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span>    <span class='va'>panelTeX</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"\\begin{minipage}{"</span>, <span class='va'>labelWidth</span>, <span class='st'>"in}"</span>,</span>
<span>                       <span class='va'>type</span>, </span>
<span>                       <span class='st'>"\\end{minipage}"</span><span class='op'>)</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>grid.latex</a></span><span class='op'>(</span><span class='va'>panelTeX</span>, </span>
<span>               x<span class='op'>=</span><span class='fl'>0</span>, hjust<span class='op'>=</span><span class='st'>"left"</span>,</span>
<span>               y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='va'>labelY</span>, <span class='st'>"native"</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='st'>"mm"</span><span class='op'>)</span>, vjust<span class='op'>=</span><span class='st'>"bottom"</span>,</span>
<span>               gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='va'>lightGrey</span>, fontsize<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='fu'>mainPanel</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>subscripts</span>, <span class='va'>groups</span>, <span class='va'>...</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<p>The title of a <a href="https://cran.r-project.org/package=lattice">lattice</a> plot can be specified as a <code>grid</code>
grob. This means that we can call <code>latexGrob()</code> to generate a
title for the plot in Figure <a href="#fig:lattice">12</a>.
The LaTeX fragment below describes the label, first defining
three colors, and then giving the title text, with the words
“Male” and “Female” colored differently.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>titleTeX</span> <span class='op'>&lt;-</span> <span class='st'>r"(%</span></span>
<span><span class='st'>\definecolor{lightGrey}{RGB}{128,128,128}</span></span>
<span><span class='st'>\definecolor{lattice1}{RGB}{105,169,234}</span></span>
<span><span class='st'>\definecolor{lattice2}{RGB}{181,124,1}</span></span>
<span><span class='st'>\color{lightGrey}</span></span>
<span><span class='st'>Number of Incidents for \textcolor{lattice1}{Males} and </span></span>
<span><span class='st'>\textcolor{lattice2}{Females}</span></span>
<span><span class='st'>)"</span></span></code></pre>
</div>
</div>
<p>The following code calls <code>latexGrob()</code> to define the title.
We pass the LaTeX fragment <code>titleTeX</code>, we position the title
to line up with
the left edge of the first column of panels, and we
load the LaTeX package <code>xcolor</code> so that the colors work.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>latexTitle</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/xdvir/man/grid.latex.html'>latexGrob</a></span><span class='op'>(</span><span class='va'>titleTeX</span>, x<span class='op'>=</span><span class='va'>titleX</span>, hjust<span class='op'>=</span><span class='st'>"left"</span>, </span>
<span>                        packages<span class='op'>=</span><span class='st'>"xcolor"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The following code creates the final plot by adding the panel function
<code>latexPanel</code> and the title <code>latexTitle</code> to the main plot <code>latticeCrime</code>.
The final result is shown in Figure <a href="#fig:lattice">12</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>latticeCrime</span>,</span>
<span>       panel<span class='op'>=</span><span class='va'>latexPanel</span>,</span>
<span>       main<span class='op'>=</span><span class='va'>latexTitle</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 data-number="14" id="discussion"><span class="header-section-number">14</span> Discussion</h2>
<p>The <code>xdvir</code> package provides convenient high-level functions for
rendering LaTeX fragments as labels, annotations, or data symbols on
R plots. The package also provides lower-level functions that
allow more fine control over the authoring, typesetting, and
rendering of LaTeX code in R.</p>
<p>The benefit of the <code>xdvir</code> package is access to the typesetting capabilities
of LaTeX. This ranges from relatively simple features like changes in
font family, font weight, and font style, and automatic line breaks,
to intermediate features like full justification, hyphenation, and high-quality
mathematical expressions, and more advanced features like
enumerated lists, multiple columns, and TikZ graphics.</p>
<p>One limitation of the <code>xdvir</code> package is that rendering LaTeX
fragments is noticeably slower than rendering simple character values.
This is mainly because the typesetting
step requires running a TeX engine to produce a DVI file.
The <code>xdvir</code> package performs some caching in order to minimize the problem,
but the time cost can still be quite large. For example,
Figure <a href="#fig:lattice">12</a> requires running a TeX engine 17 times.</p>
<p>Another limitation of the <code>xdvir</code> package is that it requires a
graphics device that can render typeset glyphs. This currently includes
the <code>pdf()</code> and <code>quartz()</code> devices, plus all devices based on the
Cairo graphics library <span class="citation" data-cites="cairo">(<a href="#ref-cairo" role="doc-biblioref">Packard et al. 2025</a>)</span>, and graphics devices
provided by the <code>ragg</code> package <span class="citation" data-cites="pkg:ragg">(<a href="#ref-pkg:ragg" role="doc-biblioref">Pedersen and Shemanarev 2025</a>)</span>.</p>
<p>A final major limitation of <code>xdvir</code> is that it only currently supports two
TeX engines: XeTeX and recent LuaTeX.
The function <code>TeXstatus()</code> can be used to
report on whether these are available. An implicit limitation is that
<code>xdvir</code> requires a TeX installation, though that is simplified
through a dependency on the <a href="https://cran.r-project.org/package=tinytex">tinytex</a> package <span class="citation" data-cites="pkg:tinytex">(<a href="#ref-pkg:tinytex" role="doc-biblioref">Xie 2024</a>)</span>.</p>
<p>Given these limitations, it is worth discussing alternative approaches.
The first section of this article mentioned <a href="https://cran.r-project.org/package=gridtext">gridtext</a>,
<a href="https://cran.r-project.org/package=ggtext">ggtext</a>, and <a href="https://cran.r-project.org/package=marquee">marquee</a>. These packages
provide alternative ways to render non-trivial text labels, but
do so through Markdown and/or HTML rather than LaTeX.
Although they may not be able to produce as wide a range of results
compared to LaTeX code, they will perform much faster and
require fewer dependencies than <code>xdvir</code>.
There are also a number of packages that perform specific
text-placement tasks, for example <a href="https://cran.r-project.org/package=geomtextpath">geomtextpath</a> <span class="citation" data-cites="pkg:geomtextpath">(<a href="#ref-pkg:geomtextpath" role="doc-biblioref">Cameron and van den Brand 2025</a>)</span>,
which can arrange text along an arbitrary path, and
<a href="https://cran.r-project.org/package=directlabels">directlabels</a> [<span class="citation" data-cites="pkg:directlabels">Hocking (<a href="#ref-pkg:directlabels" role="doc-biblioref">2025</a>)</span>} and
<a href="https://cran.r-project.org/package=ggforce">ggforce</a> <span class="citation" data-cites="pkg:ggforce">(<a href="#ref-pkg:ggforce" role="doc-biblioref">Pedersen 2025</a>)</span>, which provide functions for cleverly
positioning text annotations, though without typesetting facilities.
The advantage of <code>xdvir</code> by comparison with these packages
is that it is possible to
produce more advanced typesetting results thanks to having access to LaTeX.</p>
<p>The <a href="https://cran.r-project.org/package=tikzDevice">tikzDevice</a> package <span class="citation" data-cites="pkg:tikzDevice">(<a href="#ref-pkg:tikzDevice" role="doc-biblioref">Sharpsteen and Bracken 2023</a>)</span> is an interesting
alternative because, where <code>xdvir</code> integrates LaTeX text with R graphics,
<a href="https://cran.r-project.org/package=tikzDevice">tikzDevice</a> reverses the process and integrates R graphics with
LaTeX.
The <a href="https://cran.r-project.org/package=tikzDevice">tikzDevice</a> package provides an R graphics device that
converts R plots into TikZ pictures so that R plots can include labels with
LaTeX fragments and R plots can be
deeply integrated with LaTeX documents.
There is also a <a href="https://cran.r-project.org/package=ggtikz">ggtikz</a> package <span class="citation" data-cites="pkg:ggtikz">(<a href="#ref-pkg:ggtikz" role="doc-biblioref">Thomas 2024</a>)</span>
that builds on <a href="https://cran.r-project.org/package=tikzDevice">tikzDevice</a>
to allow TikZ annotations on <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plots.
The main difference compared to <code>xdvir</code> is the destination:
if we use <code>xdvir</code>, we end up with LaTeX output within an R plot;
if we use <a href="https://cran.r-project.org/package=tikzDevice">tikzDevice</a> or <a href="https://cran.r-project.org/package=ggtikz">ggtikz</a>,
we end up with an R plot within LaTeX output.
If the final destination is a LaTeX document,
then <a href="https://cran.r-project.org/package=tikzDevice">tikzDevice</a> or <a href="https://cran.r-project.org/package=ggtikz">ggtikz</a> may provide more convenience
and greater control. However, if the final destination is
more general, or unknown, then <code>xdvir</code> may be the more appropriate
solution.</p>
<p>The <a href="https://cran.r-project.org/package=latex2exp">latex2exp</a> package <span class="citation" data-cites="pkg:latex2exp">(<a href="#ref-pkg:latex2exp" role="doc-biblioref">Meschiari 2022</a>)</span> is another package
that works in the opposite direction to <code>xdvir</code>. This package
takes a LaTeX fragment and converts it to an R <em>plotmath</em> expression.
This allows users familiar with LaTeX to access R’s math-drawing facility
whereas <code>xdvir</code> allows users to access LaTeX’s math-drawing facility,
which is far superior. The advantage of <a href="https://cran.r-project.org/package=latex2exp">latex2exp</a>, as with
many of these alternative approaches, is that it does not have any
system dependencies, whereas <code>xdvir</code> requires a TeX installation.</p>
<p>Another alternative approach to including LaTeX output in R plots
is to import an image of the LaTeX output.
This approach harks back to early solutions for including
LaTeX mathematical expressions in web pages by generating PNG images
from LaTeX fragments.
However, more modern technologies, such as SVG, mean that this
approach can yield a much higher-quality result, as
demonstrated by <span class="citation" data-cites="schneider2023">Schneider (<a href="#ref-schneider2023" role="doc-biblioref">2023</a>)</span>.
One simple advantage of the <code>xdvir</code> approach is the level of convenience
that it provides by automating the authoring and typesetting steps.
The <code>xdvir</code> package also provides more possibilities to integrate
LaTeX output with other drawing in R through anchors and saved positions.</p>
<p>Some of the limitations of <code>xdvir</code> may also be overcome by further
development. For example, it may be possible to extend support
to more TeX engines and to more graphics devices. Providing support
for more LaTeX packages is another area for
future work.</p>
<h2 data-number="15" id="acknowledgments"><span class="header-section-number">15</span> Acknowledgments</h2>
<p>The <code>xdvir</code> package depends on Yihui Xie’s <a href="https://cran.r-project.org/package=tinytex">tinytex</a> package
for the typesetting step. This package makes it much
simpler to make use of TeX engines,
including performing multiple runs when necessary, and much easier
to install
LaTeX packages (and TeX itself).</p>
<p>Claus O. Wilke’s <a href="https://cran.r-project.org/package=ggtext">ggtext</a> package and Thomas Lin Pedersen’s
<a href="https://cran.r-project.org/package=marquee">marquee</a> package provided excellent templates for the integration
of improved text-drawing facilities with <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>.</p>
<p>The author owes a debt of gratitude to Marc-Olivier Beausoleil
(Figure <a href="#fig:typesetting">1</a>),
Thomas Rahlf (Figure <a href="#fig:rahlf">6</a>),
and Joel Schneider (Figure <a href="#fig:schneider">8</a>)
for sharing their work and
for giving either implicit or explicit
permission to base several of the examples in this article
on their work.</p>
<p>Finally, thanks to the journal editor and an anonymous reviewer who
provided many helpful criticisms and suggestions that helped to
improve both the package and this article.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h3 class="appendix" data-number="15.1" id="supplementary-materials"><span class="header-section-number">15.1</span> Supplementary materials</h3>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2025-028.zip">RJ-2025-028.zip</a></p>
<h3 class="appendix" data-number="15.2" id="cran-packages-used"><span class="header-section-number">15.2</span> CRAN packages used</h3>
<p><a href="https://cran.r-project.org/package=ggtext">ggtext</a>, <a href="https://cran.r-project.org/package=gridtext">gridtext</a>, <a href="https://cran.r-project.org/package=marquee">marquee</a>, <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>, <a href="https://cran.r-project.org/package=xtable">xtable</a>, <a href="https://cran.r-project.org/package=latexpdf">latexpdf</a>, <a href="https://cran.r-project.org/package=rmarkdown">rmarkdown</a>, <a href="https://cran.r-project.org/package=texPreview">texPreview</a>, <a href="https://cran.r-project.org/package=gridGraphics">gridGraphics</a>, <a href="https://cran.r-project.org/package=gggrid">gggrid</a>, <a href="https://cran.r-project.org/package=lattice">lattice</a>, <a href="https://cran.r-project.org/package=tinytex">tinytex</a>, <a href="https://cran.r-project.org/package=geomtextpath">geomtextpath</a>, <a href="https://cran.r-project.org/package=directlabels">directlabels</a>, <a href="https://cran.r-project.org/package=ggforce">ggforce</a>, <a href="https://cran.r-project.org/package=tikzDevice">tikzDevice</a>, <a href="https://cran.r-project.org/package=ggtikz">ggtikz</a>, <a href="https://cran.r-project.org/package=latex2exp">latex2exp</a></p>
<h3 class="appendix" data-number="15.3" id="cran-task-views-implied-by-cited-packages"><span class="header-section-number">15.3</span> CRAN Task Views implied by cited packages</h3>
<p><a href="https://cran.r-project.org/view=ChemPhys">ChemPhys</a>, <a href="https://cran.r-project.org/view=NetworkAnalysis">NetworkAnalysis</a>, <a href="https://cran.r-project.org/view=Phylogenetics">Phylogenetics</a>, <a href="https://cran.r-project.org/view=ReproducibleResearch">ReproducibleResearch</a>, <a href="https://cran.r-project.org/view=Spatial">Spatial</a>, <a href="https://cran.r-project.org/view=TeachingStatistics">TeachingStatistics</a></p>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-pkg:latexpdf" class="csl-entry" role="listitem">
T. Bergsma. <em>Latexpdf: Convert tables to <span>PDF</span> or <span>PNG</span>.</em> 2023. URL <a href="https://CRAN.R-project.org/package=latexpdf">https://CRAN.R-project.org/package=latexpdf</a>. R package version 0.1.8.
</div>
<div id="ref-massvis" class="csl-entry" role="listitem">
M. A. Borkin, Z. Bylinskii, N. W. Kim, C. M. Bainbridge, C. S. Yeh, D. Borkin, H. Pfister and A. Oliva. Beyond memorability: Visualization recognition and recall. <em>IEEE Transactions on Visualization and Computer Graphics</em>, 22(1): 519–528, 2016. DOI <a href="https://doi.org/10.1109/TVCG.2015.2467732">10.1109/TVCG.2015.2467732</a>.
</div>
<div id="ref-pkg:geomtextpath" class="csl-entry" role="listitem">
A. Cameron and T. van den Brand. <em><span class="nocase">geomtextpath</span>: Curved text in <span class="nocase">’ggplot2’</span>.</em> 2025. URL <a href="https://CRAN.R-project.org/package=geomtextpath">https://CRAN.R-project.org/package=geomtextpath</a>. R package version 0.1.5.
</div>
<div id="ref-pkg:xtable" class="csl-entry" role="listitem">
D. B. Dahl, D. Scott, C. Roosen, A. Magnusson and J. Swinton. <em><span class="nocase">xtable</span>: Export tables to <span>LaTeX</span> or <span>HTML</span>.</em> 2019. URL <a href="https://CRAN.R-project.org/package=xtable">https://CRAN.R-project.org/package=xtable</a>. R package version 1.8-4.
</div>
<div id="ref-hearst" class="csl-entry" role="listitem">
M. A. Hearst. Show it or tell it? Text, visualization, and their combination. <em>Commun. ACM</em>, 66(10): 68–75, 2023. URL <a href="https://doi.org/10.1145/3593580">https://doi.org/10.1145/3593580</a>.
</div>
<div id="ref-pkg:directlabels" class="csl-entry" role="listitem">
T. D. Hocking. <em><span class="nocase">directlabels</span>: Direct labels for multicolor plots.</em> 2025. URL <a href="https://CRAN.R-project.org/package=directlabels">https://CRAN.R-project.org/package=directlabels</a>. R package version 2025.6.24.
</div>
<div id="ref-kong" class="csl-entry" role="listitem">
H.-K. Kong, Z. Liu and K. Karahalios. Frames and slants in titles of visualizations on controversial topics. In <em>Proceedings of the 2018 <span>CHI</span> conference on human factors in computing systems</em>, pages. 1–12 2018. New York, NY, USA: Association for Computing Machinery. ISBN 9781450356206. URL <a href="https://doi.org/10.1145/3173574.3174012">https://doi.org/10.1145/3173574.3174012</a>.
</div>
<div id="ref-pkg:latex2exp" class="csl-entry" role="listitem">
S. Meschiari. <em><span class="nocase">latex2exp</span>: Use <span>LaTeX</span> expressions in plots.</em> 2022. URL <a href="https://CRAN.R-project.org/package=latex2exp">https://CRAN.R-project.org/package=latex2exp</a>. R package version 0.9.6.
</div>
<div id="ref-pkg-gggrid" class="csl-entry" role="listitem">
P. Murrell. <em><span class="nocase">gggrid</span>: Draw with <span class="nocase">’grid’</span> in <span class="nocase">’ggplot2’</span>.</em> 2022. URL <a href="https://CRAN.R-project.org/package=gggrid">https://CRAN.R-project.org/package=gggrid</a>. R package version 0.2-0.
</div>
<div id="ref-anzjs2025" class="csl-entry" role="listitem">
P. Murrell. Text in <span>R</span> graphics. <em>Australian &amp; New Zealand Journal of Statistics</em>, in press. URL <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/anzs.12438">https://onlinelibrary.wiley.com/doi/abs/10.1111/anzs.12438</a>.
</div>
<div id="ref-RJ-2015-012" class="csl-entry" role="listitem">
P. Murrell. The gridGraphics package. <em>The <span>R</span> Journal</em>, 7: 151–162, 2015. URL <a href="https://rjournal.github.io/">https://rjournal.github.io/</a>.
</div>
<div id="ref-plotmath" class="csl-entry" role="listitem">
P. Murrell and R. Ihaka. An approach to providing mathematical annotation in plots. <em>Journal of Computational and Graphical Statistics</em>, 9(3): 582–599, 2000. URL <a href="https://www.tandfonline.com/doi/abs/10.1080/10618600.2000.10474900">https://www.tandfonline.com/doi/abs/10.1080/10618600.2000.10474900</a>.
</div>
<div id="ref-murrell-pedersen-urbanek-glyphs-2023" class="csl-entry" role="listitem">
P. Murrell, T. L. Pedersen and S. Urbanek. Rendering typeset glyphs in <span>R</span> graphics. 2023-01. Department of Statistics, The University of Auckland. 2023. URL <a href="https://stattech.blogs.auckland.ac.nz/2023/05/06/2023-01-rendering-typeset-glyphs-in-r-graphics">https://stattech.blogs.auckland.ac.nz/2023/05/06/2023-01-rendering-typeset-glyphs-in-r-graphics</a>. version 1.
</div>
<div id="ref-pkg-gridgraphics" class="csl-entry" role="listitem">
P. Murrell and Z. Wen. <em><span class="nocase">gridGraphics</span>: Redraw base graphics using <span class="nocase">’grid’</span> graphics.</em> 2020. URL <a href="https://CRAN.R-project.org/package=gridGraphics">https://CRAN.R-project.org/package=gridGraphics</a>. R package version 0.5-1.
</div>
<div id="ref-cairo" class="csl-entry" role="listitem">
K. Packard, C. Worth and B. Esfahbod. Cairo graphics library. 2025. URL <a href="https://www.cairographics.org/">https://www.cairographics.org/</a>. Accessed: 2025-01-20.
</div>
<div id="ref-pkg:ggforce" class="csl-entry" role="listitem">
T. L. Pedersen. <em><span class="nocase">ggforce</span>: Accelerating <span class="nocase">’ggplot2’</span>.</em> 2025. URL <a href="https://CRAN.R-project.org/package=ggforce">https://CRAN.R-project.org/package=ggforce</a>. R package version 0.5.0.
</div>
<div id="ref-pkg-marquee" class="csl-entry" role="listitem">
T. L. Pedersen and M. Mitáš. <em><span class="nocase">marquee</span>: Markdown parser and renderer for <span>R</span> graphics.</em> 2025. URL <a href="https://CRAN.R-project.org/package=marquee">https://CRAN.R-project.org/package=marquee</a>. R package version 1.0.0.
</div>
<div id="ref-pkg:ragg" class="csl-entry" role="listitem">
T. L. Pedersen and M. Shemanarev. <em><span class="nocase">ragg</span>: Graphic devices based on <span>AGG</span>.</em> 2025. URL <a href="https://CRAN.R-project.org/package=ragg">https://CRAN.R-project.org/package=ragg</a>. R package version 1.4.0.
</div>
<div id="ref-rahlf" class="csl-entry" role="listitem">
T. Rahlf. <em>Data visualisation with <span>R</span>: 100 examples.</em> 1st ed Springer Publishing Company, Incorporated, 2017. URL <a href="https://link.springer.com/book/10.1007/978-3-030-28444-2">https://link.springer.com/book/10.1007/978-3-030-28444-2</a>.
</div>
<div id="ref-pkg-lattice" class="csl-entry" role="listitem">
D. Sarkar. <em>Lattice: Multivariate data visualization with <span>R</span>.</em> New York: Springer, 2008. URL <a href="http://lmdvr.r-forge.r-project.org">http://lmdvr.r-forge.r-project.org</a>.
</div>
<div id="ref-schneider2023" class="csl-entry" role="listitem">
W. J. Schneider. Annotated Equations in <span>g</span>gplot2. 2023. URL <a href="https://wjschne.github.io/posts/2023-07-23-latex-equation-in-ggplot2/">https://wjschne.github.io/posts/2023-07-23-latex-equation-in-ggplot2/</a>.
</div>
<div id="ref-pkg:tikzDevice" class="csl-entry" role="listitem">
C. Sharpsteen and C. Bracken. <em><span class="nocase">tikzDevice</span>: <span>R</span> graphics output in <span>LaTeX</span> format.</em> 2023. URL <a href="https://CRAN.R-project.org/package=tikzDevice">https://CRAN.R-project.org/package=tikzDevice</a>. R package version 0.12.6.
</div>
<div id="ref-pkg:texPreview" class="csl-entry" role="listitem">
J. Sidi and D. Polhamus. <em>texPreview: Compile and preview snippets of <span>’LaTeX’</span>.</em> 2024. URL <a href="https://CRAN.R-project.org/package=texPreview">https://CRAN.R-project.org/package=texPreview</a>. R package version 2.1.0.
</div>
<div id="ref-pkg:ggtikz" class="csl-entry" role="listitem">
O. Thomas. <em>Ggtikz: Post-process <span class="nocase">’ggplot2’</span> plots with <span>’TikZ’</span> code using plot coordinates.</em> 2024. URL <a href="https://CRAN.R-project.org/package=ggtikz">https://CRAN.R-project.org/package=ggtikz</a>. R package version 0.1.3.
</div>
<div id="ref-pkg-ggplot2" class="csl-entry" role="listitem">
H. Wickham. <em><span class="nocase">ggplot2</span>: Elegant graphics for data analysis.</em> Springer-Verlag New York, 2016. URL <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-pkg-ggtext" class="csl-entry" role="listitem">
C. O. Wilke and B. M. Wiernik. <em><span class="nocase">ggtext</span>: Improved text rendering support for <span class="nocase">’ggplot2’</span>.</em> 2022a. URL <a href="https://CRAN.R-project.org/package=ggtext">https://CRAN.R-project.org/package=ggtext</a>. R package version 0.1.2.
</div>
<div id="ref-pkg-gridtext" class="csl-entry" role="listitem">
C. O. Wilke and B. M. Wiernik. <em><span class="nocase">gridtext</span>: Improved text rendering support for <span class="nocase">’grid’</span> graphics.</em> 2022b. URL <a href="https://CRAN.R-project.org/package=gridtext">https://CRAN.R-project.org/package=gridtext</a>. R package version 0.1.5.
</div>
<div id="ref-pkg:tinytex" class="csl-entry" role="listitem">
Y. Xie. <em><span class="nocase">tinytex</span>: Helper functions to install and maintain <span>TeX Live</span>, and compile <span>LaTeX</span> documents.</em> 2024. URL <a href="https://github.com/rstudio/tinytex">https://github.com/rstudio/tinytex</a>. R package version 0.54.
</div>
<div id="ref-pkg:rmarkdown" class="csl-entry" role="listitem">
Y. Xie, J. J. Allaire and G. Grolemund. <em>R markdown: The definitive guide.</em> Boca Raton, Florida: Chapman; Hall/CRC, 2018. URL <a href="https://bookdown.org/yihui/rmarkdown">https://bookdown.org/yihui/rmarkdown</a>.
</div>
</div>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>This process
mirrors one way of working with LaTeX documents:
LaTeX source (a <code>.tex</code> file) is processed by a TeX engine
to produce DVI output (a <code>.dvi</code> file) and then the DVI output is
processed to render PDF output (a <code>.pdf</code> file). The final processing
step is performed by a , for example <code>dvipdf</code> for PDF output
or <code>dvips</code> for PostScript output. Different TeX engines produce different
DVI output. For example, LuaTeX produces a <code>.dvi</code> file, but
XeTeX produces
a slightly different DVI output in the form of a <code>.xdv</code> file.
Consequently, there are different DVI drivers for different DVI output,
for example <code>xdvipdfmx</code> for processing a <code>.xdv</code> file to a <code>.pdf</code> file.
The <code>xdvir</code> package is essentially a DVI driver that works for both
<code>.dvi</code> files and <code>.xdv</code> files and produces R output, hence the name
<code>xdvir</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Murrell, "Rendering LaTeX in R", The R Journal, 2025</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2025-028,
  author = {Murrell, Paul},
  title = {Rendering LaTeX in R},
  journal = {The R Journal},
  year = {2025},
  note = {https://doi.org/10.32614/RJ-2025-028},
  doi = {10.32614/RJ-2025-028},
  volume = {17},
  issue = {3},
  issn = {2073-4859},
  pages = {162-187}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
