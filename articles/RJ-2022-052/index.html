<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>The R Journal: casebase: An Alternative Framework for Survival Analysis and Comparison of Event Rates</title>

<meta property="description" itemprop="description" content="In clinical studies of time-to-event data, a quantity of interest to the clinician is their patient&#39;s risk of an event. However, methods relying on time matching or risk-set sampling (including Cox regression) eliminate the baseline hazard from the estimating function. As a consequence, the focus has been on reporting hazard ratios instead of survival or cumulative incidence curves. Indeed, reporting patient risk or cumulative incidence requires a separate estimation of the baseline hazard. Using case-base sampling, Hanley &amp; Miettinen (2009) explained how parametric hazard functions can be estimated in continuous-time using logistic regression. Their approach naturally leads to estimates of the survival or risk function that are smooth-in-time. In this paper, we present the casebase R package, a comprehensive and flexible toolkit for parametric survival analysis. We describe how the case-base framework can also be used in more complex settings: non-linear functions of time and non-proportional hazards, competing risks, and variable selection. Our package also includes an extensive array of visualization tools to complement the analysis. We illustrate all these features through three different case studies. * SRB and MT contributed equally to this work."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2022-052/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2022-12-20"/>
<meta property="article:created" itemprop="dateCreated" content="2022-12-20"/>
<meta name="article:author" content="Sahir Rai Bhatnagar*"/>
<meta name="article:author" content="Maxime Turgeon*"/>
<meta name="article:author" content="Jesse Islam"/>
<meta name="article:author" content="James A. Hanley"/>
<meta name="article:author" content="Olli Saarela"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="The R Journal: casebase: An Alternative Framework for Survival Analysis and Comparison of Event Rates"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="In clinical studies of time-to-event data, a quantity of interest to the clinician is their patient&#39;s risk of an event. However, methods relying on time matching or risk-set sampling (including Cox regression) eliminate the baseline hazard from the estimating function. As a consequence, the focus has been on reporting hazard ratios instead of survival or cumulative incidence curves. Indeed, reporting patient risk or cumulative incidence requires a separate estimation of the baseline hazard. Using case-base sampling, Hanley &amp; Miettinen (2009) explained how parametric hazard functions can be estimated in continuous-time using logistic regression. Their approach naturally leads to estimates of the survival or risk function that are smooth-in-time. In this paper, we present the casebase R package, a comprehensive and flexible toolkit for parametric survival analysis. We describe how the case-base framework can also be used in more complex settings: non-linear functions of time and non-proportional hazards, competing risks, and variable selection. Our package also includes an extensive array of visualization tools to complement the analysis. We illustrate all these features through three different case studies. * SRB and MT contributed equally to this work."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2022-052/"/>
<meta property="og:image" content="https://journal.r-project.org/articles/RJ-2022-052/plot-erspc-data-1.png"/>
<meta property="og:image:width" content="1344"/>
<meta property="og:image:height" content="1008"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="The R Journal: casebase: An Alternative Framework for Survival Analysis and Comparison of Event Rates"/>
<meta property="twitter:description" content="In clinical studies of time-to-event data, a quantity of interest to the clinician is their patient&#39;s risk of an event. However, methods relying on time matching or risk-set sampling (including Cox regression) eliminate the baseline hazard from the estimating function. As a consequence, the focus has been on reporting hazard ratios instead of survival or cumulative incidence curves. Indeed, reporting patient risk or cumulative incidence requires a separate estimation of the baseline hazard. Using case-base sampling, Hanley &amp; Miettinen (2009) explained how parametric hazard functions can be estimated in continuous-time using logistic regression. Their approach naturally leads to estimates of the survival or risk function that are smooth-in-time. In this paper, we present the casebase R package, a comprehensive and flexible toolkit for parametric survival analysis. We describe how the case-base framework can also be used in more complex settings: non-linear functions of time and non-proportional hazards, competing risks, and variable selection. Our package also includes an extensive array of visualization tools to complement the analysis. We illustrate all these features through three different case studies. * SRB and MT contributed equally to this work."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2022-052/"/>
<meta property="twitter:image" content="https://journal.r-project.org/articles/RJ-2022-052/plot-erspc-data-1.png"/>
<meta property="twitter:image:width" content="1344"/>
<meta property="twitter:image:height" content="1008"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="The R Journal: casebase: An Alternative Framework for Survival Analysis and Comparison of Event Rates"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2022-052"/>
<meta name="citation_pdf_url" content="RJ-2022-052.pdf"/>
<meta name="citation_volume" content="14"/>
<meta name="citation_issue" content="3"/>
<meta name="citation_doi" content="10.32614/RJ-2022-052"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="59"/>
<meta name="citation_lastpage" content="79"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2022/12/20"/>
<meta name="citation_publication_date" content="2022/12/20"/>
<meta name="citation_author" content="Sahir Rai Bhatnagar*"/>
<meta name="citation_author_institution" content="McGill University"/>
<meta name="citation_author" content="Maxime Turgeon*"/>
<meta name="citation_author_institution" content="University of Manitoba"/>
<meta name="citation_author" content="Jesse Islam"/>
<meta name="citation_author_institution" content="McGill University"/>
<meta name="citation_author" content="James A. Hanley"/>
<meta name="citation_author_institution" content="McGill University"/>
<meta name="citation_author" content="Olli Saarela"/>
<meta name="citation_author_institution" content="University of Toronto"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Fitting smooth-in-time prognostic risk functions via logistic regression;citation_volume=5;citation_author=James A Hanley;citation_author=Olli S Miettinen"/>
  <meta name="citation_reference" content="citation_title=A case-base sampling method for estimating recurrent event intensities;citation_publisher=Springer;citation_volume=22;citation_author=Olli Saarela"/>
  <meta name="citation_reference" content="citation_title=ggplot2: Elegant graphics for data analysis;citation_publisher=Springer-Verlag New York;citation_author=Hadley Wickham"/>
  <meta name="citation_reference" content="citation_title=Screening and prostate-cancer mortality in a randomized European study;citation_publisher=Mass Medical Soc;citation_volume=360;citation_author=Fritz H Schröder;citation_author=Jonas Hugosson;citation_author=Monique J Roobol;citation_author=Teuvo LJ Tammela;citation_author=Stefano Ciatto;citation_author=Vera Nelen;citation_author=Maciej Kwiatkowski;citation_author=Marcos Lujan;citation_author=Hans Lilja;citation_author=Marco Zappa;citation_author=Screening and prostate-cancer mortality in a randomized European study"/>
  <meta name="citation_reference" content="citation_title=Recovering the raw data behind a non-parametric survival curve;citation_publisher=BioMed Central;citation_volume=3;citation_author=Zhihui Liu;citation_author=Benjamin Rich;citation_author=James A Hanley"/>
  <meta name="citation_reference" content="citation_title=Regularization and variable selection via the elastic net;citation_publisher=Wiley Online Library;citation_volume=67;citation_author=Hui Zou;citation_author=Trevor Hastie"/>
  <meta name="citation_reference" content="citation_title=Regularization paths for generalized linear models via coordinate descent;citation_volume=33;citation_doi=10.18637/jss.v033.i01;citation_issn=1548-7660;citation_author=Jerome Friedman;citation_author=Trevor Hastie;citation_author=Robert Tibshirani"/>
  <meta name="citation_reference" content="citation_title=Generalized additive models: Some applications;citation_publisher=Taylor &amp; Francis;citation_volume=82;citation_author=Trevor Hastie;citation_author=Robert Tibshirani"/>
  <meta name="citation_reference" content="citation_title=Mortality reductions produced by sustained prostate cancer screening have been underestimated;citation_publisher=SAGE Publications Sage UK: London, England;citation_volume=17;citation_author=James A Hanley"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["author","title","description","preamble","output","bibliography","fig_width","fig_height","fig_caption","editor_options","date","date_received","volume","issue","slug","draft","journal","pdf_url","citation_url","doi","creative_commons","packages","CTV","csl","canonical_url"]}},"value":[{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email","url"]}},"value":[{"type":"character","attributes":{},"value":["Sahir Rai Bhatnagar*"]},{"type":"character","attributes":{},"value":["McGill University"]},{"type":"character","attributes":{},"value":["2001 McGill College Avenue Montreal, QC, Canada H3A 1G1\n"]},{"type":"character","attributes":{},"value":["\\email{sahir.bhatnagar@mcgill.ca}"]},{"type":"character","attributes":{},"value":["http://sahirbhatnagar.com/"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email","url"]}},"value":[{"type":"character","attributes":{},"value":["Maxime Turgeon*"]},{"type":"character","attributes":{},"value":["University of Manitoba"]},{"type":"character","attributes":{},"value":["186 Dysart Road Winnipeg, MB, Canada R3T 2N2\n"]},{"type":"character","attributes":{},"value":["\\email{max.turgeon@umanitoba.ca}"]},{"type":"character","attributes":{},"value":["https://maxturgeon.ca/"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email"]}},"value":[{"type":"character","attributes":{},"value":["Jesse Islam"]},{"type":"character","attributes":{},"value":["McGill University"]},{"type":"character","attributes":{},"value":["2001 McGill College Avenue Montreal, QC, Canada H3A 1G1\n"]},{"type":"character","attributes":{},"value":["\\email{jesse.islam@mail.mcgill.ca}"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email","url"]}},"value":[{"type":"character","attributes":{},"value":["James A. Hanley"]},{"type":"character","attributes":{},"value":["McGill University"]},{"type":"character","attributes":{},"value":["2001 McGill College Avenue Montreal, QC, Canada H3A 1G1\n"]},{"type":"character","attributes":{},"value":["\\email{james.hanley@mcgill.ca}"]},{"type":"character","attributes":{},"value":["http://www.medicine.mcgill.ca/epidemiology/hanley/"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email","url"]}},"value":[{"type":"character","attributes":{},"value":["Olli Saarela"]},{"type":"character","attributes":{},"value":["University of Toronto"]},{"type":"character","attributes":{},"value":["Dalla Lana School of Public Health,  155 College Street, 6th floor,  Toronto, Ontario  M5T 3M7, Canada\n"]},{"type":"character","attributes":{},"value":["\\email{olli.saarela@utoronto.ca}"]},{"type":"character","attributes":{},"value":["http://individual.utoronto.ca/osaarela/"]}]}]},{"type":"character","attributes":{},"value":["casebase: An Alternative Framework for Survival Analysis and Comparison of Event Rates"]},{"type":"character","attributes":{},"value":["In clinical studies of time-to-event data, a quantity of interest to the clinician is their patient's risk of an event. However, methods relying on time matching or risk-set sampling (including Cox regression) eliminate the baseline hazard from the estimating function. As a consequence, the focus has been on reporting hazard ratios instead of survival or cumulative incidence curves. Indeed, reporting patient risk or cumulative incidence requires a separate estimation of the baseline hazard. Using case-base sampling, Hanley & Miettinen (2009) explained how parametric hazard functions can be estimated in continuous-time using logistic regression. Their approach naturally leads to estimates of the survival or risk function that are smooth-in-time. In this paper, we present the casebase R package, a comprehensive and flexible toolkit for parametric survival analysis. We describe how the case-base framework can also be used in more complex settings: non-linear functions of time and non-proportional hazards, competing risks, and variable selection. Our package also includes an extensive array of visualization tools to complement the analysis. We illustrate all these features through three different case studies. * SRB and MT contributed equally to this work."]},{"type":"character","attributes":{},"value":["\\usepackage{longtable} \\usepackage{graphicx} \\usepackage{tabularx} \\usepackage{float} \\usepackage{makecell} \\usepackage{tabu} \\usepackage[utf8]{inputenc}\n"]},{"type":"character","attributes":{},"value":["rjtools::rjournal_web_article"]},{"type":"character","attributes":{},"value":["bhatnagar-turgeon-islam-hanley-saarela.bib"]},{"type":"integer","attributes":{},"value":[12]},{"type":"integer","attributes":{},"value":[9]},{"type":"logical","attributes":{},"value":[true]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["chunk_output_type"]}},"value":[{"type":"character","attributes":{},"value":["console"]}]},{"type":"character","attributes":{},"value":["2022-12-20"]},{"type":"character","attributes":{},"value":["2021-02-15"]},{"type":"integer","attributes":{},"value":[14]},{"type":"integer","attributes":{},"value":[3]},{"type":"character","attributes":{},"value":["RJ-2022-052"]},{"type":"logical","attributes":{},"value":[false]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[59]},{"type":"integer","attributes":{},"value":[79]}]},{"type":"character","attributes":{},"value":["RJ-2022-052.pdf"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2022-052"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2022-052"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["casebase","CFC","flexsurv","SmoothHazard","rstpm2","mets","survival","glmnet","glmpath","penalized","riskRegression","cmprsk","ggplot2","mgcv","VGAM","timereg"]},{"type":"list","attributes":{},"value":[]}]},{"type":"character","attributes":{},"value":["Bayesian","CausalInference","ClinicalTrials","Distributions","Econometrics","Environmetrics","Epidemiology","ExtremeValue","MachineLearning","MixedModels","Phylogenetics","Psychometrics","Spatial","Survival","TeachingStatistics"]},{"type":"character","attributes":{},"value":["/Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/library/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2022-052/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["bhatnagar-turgeon-islam-hanley-saarela.bib","bhatnagar-turgeon-islam-hanley-saarela.tex","bmtcrr-risk-1.pdf","casebase_response_to_reviewers_v2.pdf","coefplots-1.pdf","compAbsrisk-1.pdf","compAbsrisk-1.png","compPop-1.pdf","compPop-1.png","cs1hazard-1.pdf","cs1hazard-1.png","cs3FinalBrier-1.pdf","cs3FinalBrier-1.png","cs3lolliPlot-1.pdf","cs3lolliPlot-1.png","erspc-cif-conf-1.pdf","erspc-cif-conf-1.png","interaction-ERSPC-1.pdf","interaction-ERSPC-1.png","plot-erspc-data-1.pdf","plot-erspc-data-1.png","riskregressionBrier-1.pdf","RJ-2022-052_files/anchor-4.2.2/anchor.min.js","RJ-2022-052_files/bowser-1.9.3/bowser.min.js","RJ-2022-052_files/distill-2.2.21/template.v2.js","RJ-2022-052_files/header-attrs-2.18/header-attrs.js","RJ-2022-052_files/jquery-3.6.0/jquery-3.6.0.js","RJ-2022-052_files/jquery-3.6.0/jquery-3.6.0.min.js","RJ-2022-052_files/jquery-3.6.0/jquery-3.6.0.min.map","RJ-2022-052_files/kePrint-0.0.1/kePrint.js","RJ-2022-052_files/lightable-0.0.1/lightable.css","RJ-2022-052_files/popper-2.6.0/popper.min.js","RJ-2022-052_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2022-052_files/tippy-6.2.7/tippy-light-border.css","RJ-2022-052_files/tippy-6.2.7/tippy.css","RJ-2022-052_files/tippy-6.2.7/tippy.umd.min.js","RJ-2022-052_files/webcomponents-2.0.0/webcomponents.js","RJ-2022-052.log","RJ-2022-052.pdf","RJ-2022-052.tex","RJ-2022-052.zip","RJwrapper.log","RJwrapper.tex"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.18/header-attrs.js"></script>
  <script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="https://twitter.com/intent/tweet?text='+title+'&url=' + cite_url + '" class="dt-tag"><i class="fab fa-twitter"></i> Tweet</a>')

      const abstract = $('<d-abstract>')
      abstract.append('<b>Abstract:</b><br>')
      abstract.append($("d-title p:not(:empty)").first()) // Move description to d-abstract
      $("d-title p:empty").remove() // Remove empty paragraphs after title
      abstract.append(buttons)
      abstract.insertAfter($('d-title')) // Add abstract section after title

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"casebase: An Alternative Framework for Survival Analysis and Comparison of Event Rates","description":"In clinical studies of time-to-event data, a quantity of interest to the clinician is their patient's risk of an event. However, methods relying on time matching or risk-set sampling (including Cox regression) eliminate the baseline hazard from the estimating function. As a consequence, the focus has been on reporting hazard ratios instead of survival or cumulative incidence curves. Indeed, reporting patient risk or cumulative incidence requires a separate estimation of the baseline hazard. Using case-base sampling, Hanley & Miettinen (2009) explained how parametric hazard functions can be estimated in continuous-time using logistic regression. Their approach naturally leads to estimates of the survival or risk function that are smooth-in-time. In this paper, we present the casebase R package, a comprehensive and flexible toolkit for parametric survival analysis. We describe how the case-base framework can also be used in more complex settings: non-linear functions of time and non-proportional hazards, competing risks, and variable selection. Our package also includes an extensive array of visualization tools to complement the analysis. We illustrate all these features through three different case studies. * SRB and MT contributed equally to this work.","doi":"10.32614/RJ-2022-052","authors":[{"author":"Sahir Rai Bhatnagar*","authorURL":"http://sahirbhatnagar.com/","affiliation":"McGill University","affiliationURL":"#","orcidID":""},{"author":"Maxime Turgeon*","authorURL":"https://maxturgeon.ca/","affiliation":"University of Manitoba","affiliationURL":"#","orcidID":""},{"author":"Jesse Islam","authorURL":"#","affiliation":"McGill University","affiliationURL":"#","orcidID":""},{"author":"James A. Hanley","authorURL":"http://www.medicine.mcgill.ca/epidemiology/hanley/","affiliation":"McGill University","affiliationURL":"#","orcidID":""},{"author":"Olli Saarela","authorURL":"http://individual.utoronto.ca/osaarela/","affiliation":"University of Toronto","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-12-20T00:00:00.000+00:00","citationText":"Bhatnagar*, et al., 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../issues/2023-1">Current</a>
<a href="../../submissions.html">Submit</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>casebase: An Alternative Framework for Survival Analysis and Comparison of Event Rates</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>In clinical studies of time-to-event data, a quantity of interest to the clinician is their patient’s risk of an event. However, methods relying on time matching or risk-set sampling (including Cox regression) eliminate the baseline hazard from the estimating function. As a consequence, the focus has been on reporting hazard ratios instead of survival or cumulative incidence curves. Indeed, reporting patient risk or cumulative incidence requires a separate estimation of the baseline hazard. Using case-base sampling, Hanley &amp; Miettinen (2009) explained how parametric hazard functions can be estimated in continuous-time using logistic regression. Their approach naturally leads to estimates of the survival or risk function that are smooth-in-time. In this paper, we present the casebase R package, a comprehensive and flexible toolkit for parametric survival analysis. We describe how the case-base framework can also be used in more complex settings: non-linear functions of time and non-proportional hazards, competing risks, and variable selection. Our package also includes an extensive array of visualization tools to complement the analysis. We illustrate all these features through three different case studies. * SRB and MT contributed equally to this work.</p></p>
</div>

<div class="d-byline">
  Sahir Rai Bhatnagar* <a href="http://sahirbhatnagar.com/" class="uri">http://sahirbhatnagar.com/</a> (McGill University)
  
,   Maxime Turgeon* <a href="https://maxturgeon.ca/" class="uri">https://maxturgeon.ca/</a> (University of Manitoba)
  
,   Jesse Islam  (McGill University)
  
,   James A. Hanley <a href="http://www.medicine.mcgill.ca/epidemiology/hanley/" class="uri">http://www.medicine.mcgill.ca/epidemiology/hanley/</a> (McGill University)
  
,   Olli Saarela <a href="http://individual.utoronto.ca/osaarela/" class="uri">http://individual.utoronto.ca/osaarela/</a> (University of Toronto)
  
<br/>2022-12-20
</div>

<div class="d-article">
<div class="layout-chunk" data-layout="l-body">

</div>
<h1 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h1>
<p>The semiparametric Cox model has become the default approach to survival analysis
even though Cox himself later suggested he would prefer to model the hazard function
directly. In a 1994 interview with Professor Nancy Reid, Sir David Cox was asked
how he would model a set of censored survival data, to which he responded: “I
think I would normally want to tackle problems parametrically … and if you want
to do things like predict the outcome for a particular patient, it’s much more
convenient to do that parametrically” <span class="citation" data-cites="reid1994conversation">(<a href="#ref-reid1994conversation" role="doc-biblioref">Reid 1994</a>)</span>. Indeed, the most
relevant quantity in a clinical setting is often the 5- or 10-year risk of
experiencing a certain event given the patient’s particular profile.
However, the most reported metric from a Cox model is the (potentially
time-dependent) hazard ratio (HR). The covariate-conditional
survival curve is arguably a more important
summary measure to report than the HR. While stepwise survival curves can be
computed with the Cox model, they require a second step to separately estimate
the baseline hazard <span class="citation" data-cites="breslow1972discussion">(<a href="#ref-breslow1972discussion" role="doc-biblioref">Breslow 1972</a>)</span>.</p>
<p>Several authors have since pursued fully parametric approaches that made the
fitting of smooth survival curves more transparent and intuitive through
generalized linear models. The key feature of these procedures is splitting the
time axis into discrete intervals. Whitehead <span class="citation" data-cites="whitehead1980fitting">(<a href="#ref-whitehead1980fitting" role="doc-biblioref">1980</a>)</span> showed the
equivalence between a Cox model and a Poisson regression with a parameter for
each event time; Carstensen <span class="citation" data-cites="copenhagen2012needs">(<a href="#ref-copenhagen2012needs" role="doc-biblioref">2019</a>)</span> provides an exposition of this
equivalence with a real data example and supporting R code for computing
standard errors. Arjas &amp; Haara <span class="citation" data-cites="arjas1987logistic">(<a href="#ref-arjas1987logistic" role="doc-biblioref">1987</a>)</span> and Efron <span class="citation" data-cites="efron1988logistic">(<a href="#ref-efron1988logistic" role="doc-biblioref">1988</a>)</span> treated each
patient-day as a Bernoulli random variable with probability equal to the
discrete hazard rate. A potential issue with these approaches is that the
number of time bins need to be chosen by the data analyst. On the one hand, a fine grouping
of times may result in few (or none) events per interval, which then leads
to instability in the Newton-Raphson procedure for estimation
<span class="citation" data-cites="kalbfleisch2011statistical">(<a href="#ref-kalbfleisch2011statistical" role="doc-biblioref">Kalbfleisch and Prentice 2011 4.8</a>)</span>, and large long-format datasets.
On the other hand, a coarse grouping could potentially mask
nonlinear trends in the hazard function.</p>
<p>Rather than discretizing time, Hanley &amp; Miettinen <span class="citation" data-cites="hanley2009fitting">(<a href="#ref-hanley2009fitting" role="doc-biblioref">2009</a>)</span>
selected a discrete set of person-time coordinates (“person-moments”) in
continuous time from all observed follow-up experience constituting the
study base. By doing so, they obtained a likelihood expression for the hazard
function that is equivalent to that of logistic regression with an offset term.
More specifically, all person-moments when the event of interest
occurred are selected as the case series, complemented by a randomly sampled
base series of person-moments serving as controls. This approach allows
flexible modeling of the hazard function by including functions of time as covariates
(e.g. using splines or generalized additive models). Furthermore, time-dependent
covariates can be modeled through interactions with time. In short, Hanley &amp;
Miettinen <span class="citation" data-cites="hanley2009fitting">(<a href="#ref-hanley2009fitting" role="doc-biblioref">2009</a>)</span> use the well-understood logistic regression
for directly modeling the hazard function, without requiring a discrete-time model.</p>
<p>In this article, we present the <a href="https://cran.r-project.org/package=casebase">casebase</a> R package <span class="citation" data-cites="casebase-package">(<a href="#ref-casebase-package" role="doc-biblioref">Bhatnagar et al. 2021</a>)</span>
which implements and extends the Hanley &amp; Miettinen <span class="citation" data-cites="hanley2009fitting">(<a href="#ref-hanley2009fitting" role="doc-biblioref">2009</a>)</span> approach for
fitting fully parametric hazard models and covariate-conditional survival curves
using the familiar interface of the <code>glm</code> function. Our implementation
includes extensions to other models such as penalized
regression for variable selection and competing risk analysis. In addition,
we provide functions for exploratory data analysis and visualizing the estimated
quantities such as the hazard function, survival curve, and their standard errors.
The ultimate goal of our package is to make fitting flexible hazards accessible
to end users who favor reporting absolute risks and survival curves
over hazard ratios.</p>
<p>In what follows, we first recap some theoretical details on case-base sampling
and its use for estimating parametric hazard functions. We then give a short
review of existing R packages that implement comparable features to <a href="#">casebase</a>.
Next, we provide some details about the implementation of case-base sampling in
our package, and we give a brief survey of its main functions. This is followed
by three case studies that illustrate the flexibility and capabilities of
<a href="#">casebase</a>. We show how the same framework can be used for non-linear
functions of time and non-proportional hazards, competing risks, and variable
selection via penalized regression. Finally, we end the article with a
discussion of the results and of future directions.</p>
<h1 data-number="2" id="theory"><span class="header-section-number">2</span> Theoretical details</h1>
<p>As discussed in Hanley &amp; Miettinen <span class="citation" data-cites="hanley2009fitting">(<a href="#ref-hanley2009fitting" role="doc-biblioref">2009</a>)</span>, the key idea behind case-base sampling is to consider the entire study base as an infinite collection of <em>person-moments</em>. These person-moments are indexed by both an individual in the study and a time point, and therefore each person-moment has a covariate profile and an outcome status (i.e. whether the event happened) attached to it. By estimating the probability of an event occurring at a particular person-moment, we can extract information about hazards and survival.</p>
<p>Therefore, we start by assembling all person-moments at which the event occurred; this collection of person-moments is what Hanley &amp; Miettinen call the <em>case series</em>. The incidence of the case series is dictated by the hazard function of interest. Next, we sample a finite number of person-moments (blinded to case moments); this second collection of person-moments is what Hanley &amp; Miettinen call the <em>base series</em>. The sampling mechanism for the base series is left at the discretion of the user, but in practice we find that sampling uniformly from the study base provides both simplicity and good performance. This is the default sampling mechanism in the package.</p>
<h2 class="unnumbered" id="likelihood-and-estimating-function">Likelihood and estimating function</h2>
<p>To describe the theoretical foundations of case-base sampling, we use the framework of counting processes. In what follows, we abuse notation slightly and omit any mention of <span class="math inline">\(\sigma\)</span>-algebras. Instead, following Aalen <span class="citation" data-cites="aalen2008survival">(<a href="#ref-aalen2008survival" role="doc-biblioref">2008</a>)</span>, we use the placeholder “past” to denote the past history of the corresponding process. The reader interested in more details can refer to Saarela &amp; Arjas <span class="citation" data-cites="saarela2015non">(<a href="#ref-saarela2015non" role="doc-biblioref">2015</a>)</span> and Saarela <span class="citation" data-cites="saarela2016case">(<a href="#ref-saarela2016case" role="doc-biblioref">2016</a>)</span>. First, let <span class="math inline">\(N_{i}(t) \in \{0, 1\}\)</span> be counting processes corresponding to the event of interest for individual <span class="math inline">\(i=1, \ldots,n\)</span>. For simplicity, we will consider Type I censoring due to the end of follow-up at time <span class="math inline">\(\tau\)</span> (the general case of independent censoring is treated in Saarela <span class="citation" data-cites="saarela2016case">(<a href="#ref-saarela2016case" role="doc-biblioref">2016</a>)</span>). We are interested in modeling the hazard functions <span class="math inline">\(\lambda_{i}(t)\)</span> of the processes <span class="math inline">\(N_i(t)\)</span>, and which satisfy
<span class="math display">\[\lambda_{i}(t)\,\textrm dt = E[\,\textrm dN_{i}(t)\mid \mathrm{past}].\]</span> The processes <span class="math inline">\(N_i(t)\)</span> count the person-moments from the <em>case series</em>.</p>
<p>To complement the case series, we sample person-moments for the base series. To do so, we specify the base series sampling mechanism as non-homogeneous Poisson processes <span class="math inline">\(R_i(t) \in \{0, 1, 2, \ldots\}\)</span>; the person-moments where <span class="math inline">\(\,\textrm dR_i(t) = 1\)</span> constitute the base series. We note that the same individual can contribute multiple person-moments to the base series. The process <span class="math inline">\(Q_{i}(t) = R_i(t) + N_{i}(t)\)</span> then counts both the case and base series person-moments contributed by individual <span class="math inline">\(i\)</span>. As mentioned above, the processes <span class="math inline">\(R_i(t)\)</span> are specified by the user via its intensity function <span class="math inline">\(\rho_i(t)\)</span>. The process <span class="math inline">\(Q_{i}(t)\)</span> is characterized by <span class="math inline">\(E[\,\textrm dQ_{i}(t)\mid\mathrm{past}] = \lambda_{i}(t)\,\textrm dt + \rho_i(t)\,\textrm dt\)</span>.</p>
<p>If the hazard function <span class="math inline">\(\lambda_{i}(t; \theta)\)</span> is parametrized in terms of <span class="math inline">\(\theta\)</span>, we can define an estimator <span class="math inline">\(\widehat{\theta}\)</span> by maximization of the likelihood expression
<span class="math display">\[L_0(\theta) = \prod_{i=1}^n \exp\left\{ -\int_0^{\min(t_i,\tau)} \lambda_i(t; \theta)\,\textrm dt \right\} \prod_{i=1}^{n} \prod_{t\in[0,\tau)} \lambda_{i}(t;\theta)^{\,\textrm dN_{i}(t)},\]</span>
where <span class="math inline">\(\prod_{t\in[0,u)}\)</span> represents a product integral from <span class="math inline">\(0\)</span> to <span class="math inline">\(u\)</span>, and where <span class="math inline">\(t_i\)</span> is the event time for individual <span class="math inline">\(i\)</span>. However, the integral over time makes the computation and maximization of <span class="math inline">\(L_0(\theta)\)</span> challenging using standard software.</p>
<p>Case-base sampling allows us to avoid this integral. By conditioning on a sampled person-moment, we get individual partial likelihood contributions of the form
<span class="math display">\[P(\,\textrm dN_{i}(t) \mid \,\textrm dQ_{i}(t) = 1,\mathrm{past}) \stackrel{\theta}{\propto} \frac{\lambda_{i}(t; \theta)^{\,\textrm dN_{i}(t)}}{\rho_i(t) + \lambda_{i}(t;\theta)}.\]</span>
By using the symbol <span class="math inline">\(\stackrel{\theta}{\propto}\)</span>, we mean that both sides of the expression are equal up to multiplicative factors that do not depend on <span class="math inline">\(\theta\)</span>. Therefore, an estimating function for <span class="math inline">\(\theta\)</span> can be composed of these contributions as:
<span class="math display" id="eq:lik-function">\[\begin{equation}
L(\theta) = \prod_{i=1}^{n} \prod_{t\in[0,\tau)} \left(\frac{\lambda_{i}(t; \theta)^{\,\textrm dN_{i}(t)}}{\rho_i(t) + \lambda_{i}(t;\theta)}\right)^{\,\textrm dQ_i(t)}. \tag{1}
\end{equation}\]</span>
When a logarithmic link function is used for modeling the hazard function, the above expression is of a logistic regression form with an offset term <span class="math inline">\(\log(1/\rho_i(t))\)</span>. Note that the sampling units selected in the case-base sampling mechanism are person-moments, rather than individuals, and the parameters to be estimated are hazards or hazard ratios rather than odds or odds ratios. Generally, an individual can contribute more than one person-moment, and thus the terms in the product integral are not independent. Nonetheless, Saarela <span class="citation" data-cites="saarela2016case">(<a href="#ref-saarela2016case" role="doc-biblioref">2016</a>)</span> showed that the corresponding partial likelihood score function has mean zero at the true value <span class="math inline">\(\theta=\theta_0\)</span>, and that the resulting estimator <span class="math inline">\(\widehat{\theta}\)</span> is asymptotically normally distributed.</p>
<p>In Hanley &amp; Miettinen <span class="citation" data-cites="hanley2009fitting">(<a href="#ref-hanley2009fitting" role="doc-biblioref">2009</a>)</span>, the authors suggest sampling the base series <em>uniformly</em> from the study base. In terms of Poisson processes, their sampling strategy corresponds to a time-homogeneous Poisson process with intensity equal to <span class="math inline">\(\rho_i(t) = b/B\)</span>, where <span class="math inline">\(b\)</span> is the number of sampled base series <em>person-moments</em>, and <span class="math inline">\(B\)</span> is the total population-time for the study base (e.g. the sum of all individual follow-up times). More complex examples are also possible; see for example Saarela &amp; Arjas <span class="citation" data-cites="saarela2015non">(<a href="#ref-saarela2015non" role="doc-biblioref">2015</a>)</span>, where the intensity functions for the sampling mechanism are proportional to the cardiovascular disease event rate given by the Framingham score. Non-uniform sampling mechanisms can increase the efficiency of the resulting maximum partial likelihood estimators.</p>
<h2 class="unnumbered" id="variance-estimates">Variance estimates</h2>
<p>The asymptotic normality of <span class="math inline">\(\widehat{\theta}\)</span> gives us an efficient way to estimate the variance of various estimators derived from the hazard function. For example, to construct confidence bands around risk functions and survival functions, we can use the following procedure:</p>
<ol type="1">
<li>Compute <span class="math inline">\(\widehat{\theta}\)</span> and its variance-covariance matrix <span class="math inline">\(V(\widehat \theta)\)</span> which is obtained as part of the logistic regression output.</li>
<li>Sample <span class="math inline">\(B\)</span> times from a multivariate normal <span class="math inline">\(N\left(\widehat{\theta}, V(\widehat\theta)\right)\)</span>.</li>
<li>For each sample, compute the survival function using Equation <a href="#eq:surv">(6)</a> below.</li>
<li>Use the pointwise quantiles of these survival function estimates to construct a pointwise confidence band for the survival function of interest.</li>
</ol>
<p>This procedure is similar to parametric bootstrap <span class="citation" data-cites="efron1994introduction">(<a href="#ref-efron1994introduction" role="doc-biblioref">Efron and Tibshirani 1994 6.5</a>)</span>, but it can be more accurately described as a form of approximate Bayesian computation. As such, the validity of the confidence bands relies on the Bernstein-von Mises theorem <span class="citation" data-cites="van2000asymptotic">(<a href="#ref-van2000asymptotic" role="doc-biblioref">Van der Vaart 2000 10</a>)</span>.</p>
<h2 class="unnumbered" id="common-parametric-models">Common parametric models</h2>
<p>Here we show that certain named distributions such as exponential, Weibull or Gompertz can be fit using our framework, though we are not restricted to such models. Let <span class="math inline">\(g(t; X)\)</span> be the linear predictor such that <span class="math inline">\(\log(\lambda(t;X)) = g(t; X)\)</span>. Different functions of <span class="math inline">\(t\)</span> lead to different parametric hazard models. The simplest of these models is the one-parameter exponential distribution which is obtained by taking the hazard function to be constant over the range of <span class="math inline">\(t\)</span>:</p>
<p><span class="math display" id="eq:exp">\[\begin{equation}
\log(\lambda(t; X)) = \beta_0 + \beta_1 X. \tag{2}
\end{equation}\]</span>
In this model, the instantaneous failure rate is independent of <span class="math inline">\(t\)</span>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>The Gompertz hazard model is given by including a linear term for time:</p>
<p><span class="math display" id="eq:gomp">\[\begin{equation}
\log(\lambda(t; X)) = \beta_0 + \beta_1 t + \beta_2 X. \tag{3}
\end{equation}\]</span></p>
<p>Use of <span class="math inline">\(\log(t)\)</span> yields the Weibull hazard which allows for a power dependence of the hazard on time <span class="citation" data-cites="kalbfleisch2011statistical">(<a href="#ref-kalbfleisch2011statistical" role="doc-biblioref">Kalbfleisch and Prentice 2011</a>)</span>:</p>
<p><span class="math display" id="eq:weibull">\[\begin{equation}
\log(\lambda(t; X)) = \beta_0 + \beta_1 \log(t) + \beta_2 X. \tag{4}
\end{equation}\]</span></p>
<h2 class="unnumbered" id="competing-risk-analysis">Competing risk analysis</h2>
<p>Case-base sampling can also be used in the context of competing risk analysis. Assuming there are <span class="math inline">\(J\)</span> competing events, we can show that each sampled person-moment’s contribution to the partial likelihood is of the form</p>
<p><span class="math display">\[\frac{\lambda_j(t)^{\,\textrm dN_j(t)}}{\rho(t) + \sum_{j=1}^J\lambda_j(t)},\]</span>
where <span class="math inline">\(N_j(t)\)</span> is the counting process associated with the event of type <span class="math inline">\(j\)</span> and <span class="math inline">\(\lambda_j(t)\)</span> is the corresponding cause-specific hazard function. As may be expected, this functional form is similar to the terms appearing in the likelihood function for multinomial regression with an offset term.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<h2 class="unnumbered" id="variable-selection">Variable selection</h2>
<p>To perform variable selection on the regression parameters <span class="math inline">\(\theta \in \mathbb{R}^p\)</span> of the hazard function, we can add a penalty to the likelihood and optimise the following equation:
<span class="math display" id="eq:penest">\[\begin{equation}
\min _{\theta \in \mathbb{R}^{p}}\,\,-\ell\left(\theta\right)+\sum_{j=1}^p w_j p_{\lambda,\alpha}(\theta_j) \tag{5}
\end{equation}\]</span>
where <span class="math inline">\(\ell\left(\theta\right) = \log L(\theta)\)</span> is the log of the likelihood function given in <a href="#eq:lik-function">(1)</a>, <span class="math inline">\(p_{\lambda,\alpha}(\theta_j)\)</span> is a penalty term controlled by the non-negative regularization parameters <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\alpha\)</span>, and <span class="math inline">\(w_j\)</span> is the penalty factor for the <span class="math inline">\(j\)</span>th covariate. These penalty factors serve as a way of allowing parameters to be penalized differently. For example, we could set the penalty factor for time to be 0 to ensure it is always included in the selected model.</p>
<h1 data-number="3" id="comparison-with-existing-packages"><span class="header-section-number">3</span> Comparison with existing packages</h1>
<p>Survival analysis is an important branch of applied statistics and epidemiology. Accordingly, there is already a vast ecosystem of R packages implementing different methodologies. In this section, we describe how the functionalities of <a href="https://cran.r-project.org/package=casebase">casebase</a> compare to these packages.</p>
<p>At the time of writing, a cursory examination of CRAN’s <a href="https://CRAN.R-project.org/view=Survival">Survival</a> Task View reveals that there are over 250 packages related to survival analysis <span class="citation" data-cites="survTaskView">(<a href="#ref-survTaskView" role="doc-biblioref">Allignol and Latouche 2019</a>)</span>. For the purposes of this article, we restricted our review to packages that implement at least one of the following features: parametric modeling, non-proportional hazard models, competing risk analysis, penalized estimation, and Cumulative Incidence (CI) estimation. By searching for appropriate keywords in the <code>DESCRIPTION</code> file of these packages, we found 60 relevant packages. These 60 packages were then manually examined to determine which ones are comparable to <a href="#">casebase</a>. In particular, we excluded packages that were focused on a different set of problems, such as frailty and multistate models. The remaining 14 packages appear in Table <a href="#tab:surv-pkgs">1</a>, along with some of the functionalities they offer.</p>
<p>Parametric survival models are implemented in several packages, each differing in the parametric distributions available: <a href="https://cran.r-project.org/package=CFC">CFC</a> <span class="citation" data-cites="mahani2015bayesian">(<a href="#ref-mahani2015bayesian" role="doc-biblioref">2019</a>)</span>, <a href="https://cran.r-project.org/package=flexsurv">flexsurv</a> <span class="citation" data-cites="flexsurv">(<a href="#ref-flexsurv" role="doc-biblioref">2016</a>)</span>, <a href="https://cran.r-project.org/package=SmoothHazard">SmoothHazard</a> <span class="citation" data-cites="smoothHazard">(<a href="#ref-smoothHazard" role="doc-biblioref">2017</a>)</span>, <a href="https://cran.r-project.org/package=rstpm2">rstpm2</a> <span class="citation" data-cites="clements_liu">(<a href="#ref-clements_liu" role="doc-biblioref">2019</a>)</span>, <a href="https://cran.r-project.org/package=mets">mets</a> <span class="citation" data-cites="scheike2014estimating">(<a href="#ref-scheike2014estimating" role="doc-biblioref">2014</a>)</span>, and <a href="https://cran.r-project.org/package=survival">survival</a> <span class="citation" data-cites="survival-package">(<a href="#ref-survival-package" role="doc-biblioref">2015</a>)</span>. For example, <a href="#">SmoothHazard</a> is limited to Weibull distributions <span class="citation" data-cites="smoothHazard">(<a href="#ref-smoothHazard" role="doc-biblioref">2017</a>)</span>, whereas both <a href="#">flexsurv</a> and <a href="#">survival</a> allow users to supply any distribution of their choice. <a href="#">flexsurv</a>, <a href="#">SmoothHazard</a>, <a href="#">mets</a> and <a href="#">rstpm2</a> can model the effect of time using splines, which allows flexible modeling of the hazard function. As discussed above, <a href="#">casebase</a> can model any parametric family whose log-hazard can be expressed as a linear combination of covariates (including time). Therefore, our package is more general in that it allows the user to model any linear or non-linear transformation of time including splines and higher order polynomials. Also, by including interaction terms between covariates and time, it also allows users to fit (non-proportional) time-varying coefficient models. However, unlike <a href="#">flexsurv</a>, we do not explicitly model any shape parameter.</p>
<p>Several packages implement penalized estimation for the Cox model: <a href="https://cran.r-project.org/package=glmnet">glmnet</a> <span class="citation" data-cites="regpathcox">(<a href="#ref-regpathcox" role="doc-biblioref">2011</a>)</span>, <a href="https://cran.r-project.org/package=glmpath">glmpath</a> <span class="citation" data-cites="park_hastie">(<a href="#ref-park_hastie" role="doc-biblioref">2018</a>)</span>, <a href="https://cran.r-project.org/package=penalized">penalized</a> <span class="citation" data-cites="l1penal">(<a href="#ref-l1penal" role="doc-biblioref">2010</a>)</span>, <a href="https://cran.r-project.org/package=riskRegression">riskRegression</a> <span class="citation" data-cites="gerds_blanche">(<a href="#ref-gerds_blanche" role="doc-biblioref">2020</a>)</span>. Moreover, some packages also include penalized estimation in the context of Cox models with time-varying coefficients: elastic-net penalization with <a href="#">rstpm2</a> <span class="citation" data-cites="clements_liu">(<a href="#ref-clements_liu" role="doc-biblioref">2019</a>)</span>, while <a href="#">survival</a> <span class="citation" data-cites="survival-package">(<a href="#ref-survival-package" role="doc-biblioref">2015</a>)</span> has an implementation of ridge-penalized estimation. On the other hand, our package <a href="#">casebase</a> provides penalized estimation of the hazard function. To our knowledge, <a href="#">casebase</a> and <a href="#">rstpm2</a> are the only packages to offer this functionality.</p>
<p>Next, several R packages implement methodologies for competing risk analysis; for a different perspective on this topic, see Mahani &amp; Sharabiani <span class="citation" data-cites="mahani2015bayesian">(<a href="#ref-mahani2015bayesian" role="doc-biblioref">2019</a>)</span>. The package <a href="#">survival</a> provides functionality for competing risk analysis and multistate modelling. The package <a href="https://cran.r-project.org/package=cmprsk">cmprsk</a> provides methods for cause-specific subdistribution hazards, such as in the Fine-Gray model <span class="citation" data-cites="fine1999proportional">(<a href="#ref-fine1999proportional" role="doc-biblioref">1999</a>)</span>. On the other hand, the package <a href="#">CFC</a> estimates cause-specific CIs from unadjusted, non-parametric survival functions. Our package <a href="#">casebase</a> also provides functionalities for competing risk analysis by estimating parametrically the cause-specific hazards. From these quantities, we can then estimate the cause-specific CIs.</p>
<p>Finally, several packages include functions to estimate the survival function and the CI. The corresponding methods generally fall into two categories: transformation of the estimated hazard function, and semi-parametric estimation of the baseline hazard. The first category broadly corresponds to parametric survival models, where the full hazard is explicitly modeled. Using this estimate, the survival function and the CI can be obtained using their functional relationships (see Equations <a href="#eq:surv">(6)</a> and <a href="#eq:CDF">(7)</a> below). Packages providing this functionality include <a href="#">CFC</a>, <a href="#">flexsurv</a>, <a href="#">mets</a>, and <a href="#">survival</a>. Our package <a href="#">casebase</a> also follows this approach for both single-event and competing risk analyses. The second category outlined above broadly corresponds to semi-parametric models. These models do not model the full hazard function, and therefore the baseline hazard needs to be estimated separately in order to estimate the survival function. This is achieved using semi-parametric estimators (e.g. Breslow’s estimator) or parametric estimators (e.g. spline functions). Packages that implement this approach include <a href="#">riskRegression</a>, <a href="#">rstpm2</a>, <a href="#">survival</a>, and <a href="#">glmnet</a>. As mentioned in the introduction, a key distinguishing factor between these two approaches is that the first category leads to smooth estimates of the survival function, whereas the second category often produces estimates in the form of stepwise functions.</p>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:surv-pkgs">Table 1: </span>Comparison of various R packages for survival analysis. <strong>Competing Risks</strong>: whether an implementation for competing risks is present. <strong>Allows Non PH</strong>: includes models for non-proportional hazards. <strong>Penalized Regression</strong>: allows for a penalty term on the regression coefficients when estimating hazards (e.g. lasso or ridge). <strong>Splines</strong>: allows a flexible fit on time through the use of splines. <strong>Parametric</strong>: implementation for parametric models. <strong>Semi-parametric</strong>: implementation for semi-parametric models. <strong>Interval/left censoring</strong>: models for interval and left-censoring. If this is not selected, the package only handles right-censoring. <strong>Risk estimates</strong>: estimation of survival curve and cumulative incidence is available.
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;">
Package
</th>
<th style="text-align:left;font-weight: bold;">
Competing Risks
</th>
<th style="text-align:left;font-weight: bold;">
Allows Non PH
</th>
<th style="text-align:left;font-weight: bold;">
Penalized Regression
</th>
<th style="text-align:left;font-weight: bold;">
Splines
</th>
<th style="text-align:left;font-weight: bold;">
Parametric
</th>
<th style="text-align:left;font-weight: bold;">
Semi Parametric
</th>
<th style="text-align:left;font-weight: bold;">
Interval/Left Censoring
</th>
<th style="text-align:left;font-weight: bold;">
Risk Estimates
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
casebase
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
</tr>
<tr>
<td style="text-align:left;">
CFC
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
</tr>
<tr>
<td style="text-align:left;">
cmprsk
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
</tr>
<tr>
<td style="text-align:left;">
crrp
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
fastcox
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
flexrsurv
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
</tr>
<tr>
<td style="text-align:left;">
flexsurv
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
</tr>
<tr>
<td style="text-align:left;">
glmnet
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
</tr>
<tr>
<td style="text-align:left;">
glmpath
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
mets
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
</tr>
<tr>
<td style="text-align:left;">
penalized
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
riskRegression
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
</tr>
<tr>
<td style="text-align:left;">
rstpm2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
</tr>
<tr>
<td style="text-align:left;">
SmoothHazard
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
survival
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
<td style="text-align:left;">
✓
</td>
</tr>
</tbody>
</table>
</div>
<h1 data-number="4" id="implementation-details"><span class="header-section-number">4</span> Implementation details</h1>
<p>The functions in the <a href="#">casebase</a> package can be divided into two categories: 1) exploratory data analysis, in the form of population-time plots; and 2) parametric modeling of the hazard function. We strove for compatibility with both <code>data.frame</code>s and <code>data.table</code>s; this can be seen in the coding choices we made and the unit tests we wrote.</p>
<h2 class="unnumbered" id="population-time-plots">Population-time plots</h2>
<p>Population-time plots are a descriptive visualization of incidence density, where the population time that constitutes the study base is represented by area, and events by points within the area. The case-base sampling approach described above can be visualized in the form of a population time plot. These plots are informative graphical displays of survival data and should be one of the first steps in an exploratory data analysis. The <code>popTime</code> function and <code>plot</code> method facilitate this task:</p>
<ol type="1">
<li>The <code>casebase::popTime</code> function takes as input the original dataset along with the column names corresponding to the timescale, the event status and an exposure group of interest (optional). This will create an object of class <code>popTime</code>.<br />
</li>
<li>The corresponding <code>plot</code> method for the object created in Step 1 can be called to create the population time plot with several options for customizing the aesthetics.</li>
</ol>
<p>By splitting these tasks, we give flexibility to the user. While the method call in Step 2 allows further customization by using the <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> <span class="citation" data-cites="ggplot2">(<a href="#ref-ggplot2" role="doc-biblioref">Wickham 2016</a>)</span> family of functions, users may choose the graphics system of their choice to create population-time plots from the object created in Step 1.</p>
<p>To illustrate these functions, we will use data from the European Randomized Study of Prostate Cancer Screening (ERSPC) <span class="citation" data-cites="schroder2009screening">(<a href="#ref-schroder2009screening" role="doc-biblioref">Schröder et al. 2009</a>)</span> which was extracted using the approach described in Liu <em>et al.</em> <span class="citation" data-cites="liu2014recovering">(<a href="#ref-liu2014recovering" role="doc-biblioref">2014</a>)</span>. This dataset is available through the <a href="#">casebase</a> package. It contains the recreated individual observations for 159,893 men from seven European countries, who were between the ages of 55 and 69 years when recruited for the trial.</p>
<p>We first create the necessary dataset for producing the population time plot using the <code>popTime</code> function. In this example, we stratify the plot by treatment group. The resulting object inherits from class <code>popTime</code> and stores the exposure variable as an attribute:</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>pt_object</span> <span class='op'>&lt;-</span> <span class='fu'>casebase</span><span class='fu'>::</span><span class='fu'><a href='http://sahirbhatnagar.com/casebase/reference/popTime.html'>popTime</a></span><span class='op'>(</span><span class='va'>ERSPC</span>, time <span class='op'>=</span> <span class='st'>"Follow.Up.Time"</span>,</span>
<span>                               event <span class='op'>=</span> <span class='st'>"DeadOfPrCa"</span>, exposure <span class='op'>=</span> <span class='st'>"ScrArm"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>pt_object</span>, <span class='st'>"popTime"</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>#&gt; [1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>pt_object</span>, <span class='st'>"exposure"</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>#&gt; [1] &quot;ScrArm&quot;</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:plot-erspc-data"></span>
<img src="plot-erspc-data-1.png" alt="Population time plot for the ERSPC dataset. A: The gray area can be thought of as N=159,893 infinitely thin horizontal rectangles ordered by length of follow-up. B: The red points correspond to when death has occurred for any one of those infinitely thin rectangles. C: To improve visibility, these red points are randomly redistributed along their respective x-coordinates, providing a visualization of incidence density. More events are observed at later follow-up times, motivating the use of non-constant hazard models. D: The base series, a representative sample of the entire grey area, is represented by the green points." width="\textwidth" keepaspectratio=true />
<p class="caption">
Figure 1: Population time plot for the ERSPC dataset. A: The gray area can be thought of as N=159,893 infinitely thin horizontal rectangles ordered by length of follow-up. B: The red points correspond to when death has occurred for any one of those infinitely thin rectangles. C: To improve visibility, these red points are randomly redistributed along their respective x-coordinates, providing a visualization of incidence density. More events are observed at later follow-up times, motivating the use of non-constant hazard models. D: The base series, a representative sample of the entire grey area, is represented by the green points.
</p>
</div>
</div>
<p>We then pass this object to the corresponding <code>plot</code> method:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>pt_object</span>, add.base.series <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Figure <a href="#fig:plot-erspc-data">1</a> depicts the process of creating a population-time plot. It is built sequentially by first adding a layer for the area representing the population time in gray (Figure <a href="#fig:plot-erspc-data">1</a>A), with subjects having the least amount of observation time plotted at the top of the y-axis. We immediately notice a distinctive <em>stepwise shape</em> in the population time area. This is due to the randomization of the Finnish cohorts which were carried out on January 1 of each of year from 1996 to 1999. Coupled with the uniform December 31 2006 censoring date, this led to large numbers of men with exactly 11, 10, 9 or 8 years of follow-up. Tracked backwards in time (i.e. from right to left), the population-time plot shows the recruitment pattern from its beginning in 1991, and the January 1 entries in successive years. Tracked forwards in time (i.e. from left to right), the plot for the first three years shows attrition due entirely to death (mainly from other causes). Since the Swedish and Belgian centres were the last to complete recruitment in December 2003, the minimum potential follow-up is three years. Tracked further forwards in time (i.e. after year 3) the attrition is a combination of deaths and staggered entries. As we can see, population-time plots summarise a wealth of information about the study into a simple graph.</p>
<p>Next, layers for the case series and base series are added. The y-axis location of each case moment is sampled at random vertically on the plot to avoid having all points along the upper edge of the gray area (Figure <a href="#fig:plot-erspc-data">1</a>B). By randomly distributing the cases, we can get a sense of the incidence density. In Figure <a href="#fig:plot-erspc-data">1</a>C, we see that more events are observed at later follow-up times. Therefore, a constant hazard model would not be appropriate in this instance as it would overestimate the incidence earlier on in time, and underestimate it later on. Finally, the base series is sampled uniformly from the study base (Figure <a href="#fig:plot-erspc-data">1</a>D). The reader should refer to the package vignettes for more examples and a detailed description of how to modify the aesthetics of a population-time plot.</p>
<h2 class="unnumbered" id="parametric-modeling">Parametric modeling</h2>
<p>The parametric modeling step was separated into three parts:</p>
<ol type="1">
<li>case-base sampling;</li>
<li>estimation of the smooth hazard function;</li>
<li>estimation of the survival function.</li>
</ol>
<p>By separating the sampling and estimation functions, we allow the possibility of users implementing more complex sampling scheme (as described in Saarela <span class="citation" data-cites="saarela2016case">(<a href="#ref-saarela2016case" role="doc-biblioref">2016</a>)</span>), or more complex study designs (e.g. time-varying exposure).</p>
<p>The sampling scheme selected for <code>sampleCaseBase</code> was described in Hanley &amp; Miettinen <span class="citation" data-cites="hanley2009fitting">(<a href="#ref-hanley2009fitting" role="doc-biblioref">2009</a>)</span>: we first sample along the “person” axis, proportional to each individual’s total follow-up time, and then we sample a moment uniformly over their follow-up time. This sampling scheme is equivalent to the following picture: imagine representing the total follow-up time of all individuals in the study along a single dimension, where the follow-up time of the next individual would start exactly when the follow-up time of the previous individual ends. Then the base series could be sampled uniformly from this one-dimensional representation of the overall follow-up time. In any case, the output is a dataset of the same class as the input, where each row corresponds to a person-moment. The covariate profile for each such person-moment is retained, and an offset term is added to the dataset. This output could then be used to fit a smooth hazard function, or for visualization of the base series.</p>
<p>Next, the fitting function <code>fitSmoothHazard</code> starts by looking at the class of the dataset: if it was generated from <code>sampleCaseBase</code>, it automatically inherited the class <code>cbData</code>. If the dataset supplied to <code>fitSmoothHazard</code> does not inherit from <code>cbData</code>, then the fitting function starts by calling <code>sampleCaseBase</code> to generate the base series. In other words, users can bypass <code>sampleCaseBase</code> altogether and only worry about the fitting function <code>fitSmoothHazard</code>.</p>
<p>The fitting function retains the familiar formula interface of <code>glm</code>. The left-hand side of the formula should be the name of the column corresponding to the event type. The right-hand side can be any combination of the covariates, along with an explicit functional form for the time variable. Note that non-proportional hazard models can be achieved at this stage by adding an interaction term involving time (cf. Case Study 1 below). The offset term does not need to be specified by the user, as it is automatically added to the formula before calling <code>glm</code>.</p>
<p>To fit the hazard function, we provide several approaches that are available via the <code>family</code> parameter. These approaches are:</p>
<ul>
<li><code>glm</code>: This is the familiar logistic regression.</li>
<li><code>glmnet</code>: This option allows for variable selection using the elastic-net <span class="citation" data-cites="zou2005regularization">(<a href="#ref-zou2005regularization" role="doc-biblioref">Zou and Hastie 2005</a>)</span> penalty (cf. Case Study 3). This functionality is provided through the <a href="#">glmnet</a> package <span class="citation" data-cites="friedman2010jss">(<a href="#ref-friedman2010jss" role="doc-biblioref">Friedman et al. 2010</a>)</span>.</li>
<li><code>gam</code>: This option provides support for <em>Generalized Additive Models</em> via the <a href="https://cran.r-project.org/package=mgcv">mgcv</a> package <span class="citation" data-cites="hastie1987generalized">(<a href="#ref-hastie1987generalized" role="doc-biblioref">Hastie and Tibshirani 1987</a>)</span>.</li>
</ul>
<p>In the case of multiple competing events, the hazard is fitted via multinomial regression as performed by the <a href="https://cran.r-project.org/package=VGAM">VGAM</a> package. We selected this package for its ability to fit multinomial regression models with an offset.</p>
<p>Once a model-fit object has been returned by <code>fitSmoothHazard</code>, all the familiar summary and diagnostic functions are available: <code>print</code>, <code>summary</code>, <code>predict</code>, <code>plot</code>, etc. Our package provides one more functionality: it computes risk functions from the model fit. For the case of a single event, it uses the familiar identity
<span class="math display" id="eq:surv">\[\begin{equation}
S(t) = \exp\left(-\int_0^t \lambda(u;X) du\right).
\tag{6}
\end{equation}\]</span>
The integral is computed using either the numerical or Monte-Carlo integration. The risk function (or cumulative distribution function) is then defined as
<span class="math display" id="eq:CDF">\[\begin{equation}
F(t) = 1 - S(t). \tag{7}
\end{equation}\]</span></p>
<p>For the case of a competing-event analysis, the event-specific risk is computed using the following procedure: first, we compute the overall survival function (i.e. for all event types):</p>
<p><span class="math display">\[ S(t) = \exp\left(-\int_0^t \lambda(u;X) du\right),\qquad \lambda(t;X) = \sum_{j=1}^J \lambda_j(t;X).\]</span>
From this, we can derive the cause-specific subdensities:</p>
<p><span class="math display">\[ f_j(t) = \lambda_j(t)S(t).\]</span></p>
<p>By integrating these subdensities, we obtain the cause-specific CI functions:</p>
<p><span class="math display">\[ CI_j(t) = \int_0^t f_j(u)du.\]</span>
Again, the integrals are computed using either numerical integration (via the trapezoidal rule) or Monte Carlo integration. This option is controlled by the argument <code>method</code> of the <code>absoluteRisk</code> function.</p>
<p>Finally, the output from <code>absoluteRisk</code> can be passed to a method <code>confint</code> to compute confidence bands around the survival function, as described in the Theoretical Details section. These bands are only valid when <code>family = "glm"</code> as it relies on the asymptotic normality of the estimator. Currently, this is only available for the single-event setting.</p>
<h1 data-number="5" id="illustration-of-package"><span class="header-section-number">5</span> Illustration of package</h1>
<p>In this section, we illustrate the main functions of the <a href="#">casebase</a> package through three case studies. Each one showcases a different type of analysis. First, we show how to model non-constant and non-proportional hazards through a flexible specification of time. Then we perform a competing risk analysis and compare our results with the Cox model and the Fine-Gray model. The third case study illustrates how to perform variable selection in high-dimensional datasets.</p>
<h2 class="unnumbered" id="case-study-1flexible-modeling-of-the-hazard-function">Case study 1—flexible modeling of the hazard function</h2>
<p>For our first case study, we return to the ERSPC study and investigate the
differences in risk between the control and screening arms. Previous re-analyses
of these data suggest that the 20% reduction in prostate cancer death due to
screening was an underestimate <span class="citation" data-cites="hanley2010mortality">(<a href="#ref-hanley2010mortality" role="doc-biblioref">Hanley 2010</a>)</span>.
The estimated 20% (from a proportional hazards model) did not account for
the delay between screening and the time the effect is expected to be observed.
As a result, the null effects in years 1–7 masked the substantial reductions
that began to appear from year 8 onward. This motivates the use of a
time-dependent hazard ratio which can easily be fit with the <a href="#">casebase</a>
package by including an interaction term with time in the model. We fit a
flexible hazard by using a smooth function of time modeled with a penalized
cubic spline basis with 2 degrees of freedom (implemented in the
<code>survival::pspline</code> function). The model is fit using <code>fitSmoothHazard</code>
with the familiar formula interface:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'>fitSmoothHazard</span><span class='op'>(</span><span class='va'>DeadOfPrCa</span> <span class='op'>~</span> <span class='fu'>pspline</span><span class='op'>(</span><span class='va'>Follow.Up.Time</span>, df <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>ScrArm</span>, </span>
<span>                       data <span class='op'>=</span> <span class='va'>ERSPC</span>, ratio <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<!--Note that we did not have to specify any cut points, as would be the case 
with the `survSplit` function in the \pkg{survival} package.-->
<p>The output object from <code>fitSmoothHazard</code> inherits from the <code>singleEventCB</code>
and <code>glm</code> classes. For this reason, we can leverage the <code>summary</code>
method for <code>glm</code> objects to output a familiar summary of the results:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span> </span></code></pre>
</div>
<pre><code>#&gt; Fitting smooth hazards with case-base sampling
#&gt; 
#&gt; Sample size: 159893 
#&gt; Number of events: 540 
#&gt; Number of base moments: 5400 
#&gt; ----
#&gt; 
#&gt; Call:
#&gt; fitSmoothHazard(formula = DeadOfPrCa ~ pspline(Follow.Up.Time, 
#&gt;     df = 2) * ScrArm, data = ERSPC, ratio = 10)
#&gt; 
#&gt; Deviance Residuals: 
#&gt;    Min      1Q  Median      3Q     Max  
#&gt; -1.168  -0.486  -0.414  -0.215   3.262  
#&gt; 
#&gt; Coefficients:
#&gt;                                                        Estimate
#&gt; (Intercept)                                              -13.81
#&gt; pspline(Follow.Up.Time, df = 2)1                           2.66
#&gt; pspline(Follow.Up.Time, df = 2)2                           6.43
#&gt; pspline(Follow.Up.Time, df = 2)3                           5.57
#&gt; pspline(Follow.Up.Time, df = 2)4                           7.27
#&gt; pspline(Follow.Up.Time, df = 2)5                           6.54
#&gt; pspline(Follow.Up.Time, df = 2)6                          10.82
#&gt; pspline(Follow.Up.Time, df = 2)7                         -11.74
#&gt; ScrArmScreening group                                      9.22
#&gt; pspline(Follow.Up.Time, df = 2)1:ScrArmScreening group    -9.25
#&gt; pspline(Follow.Up.Time, df = 2)2:ScrArmScreening group    -9.80
#&gt; pspline(Follow.Up.Time, df = 2)3:ScrArmScreening group    -9.04
#&gt; pspline(Follow.Up.Time, df = 2)4:ScrArmScreening group    -9.39
#&gt; pspline(Follow.Up.Time, df = 2)5:ScrArmScreening group   -10.65
#&gt; pspline(Follow.Up.Time, df = 2)6:ScrArmScreening group    -8.86
#&gt; pspline(Follow.Up.Time, df = 2)7:ScrArmScreening group   -11.58
#&gt;                                                        Std. Error
#&gt; (Intercept)                                                  9.98
#&gt; pspline(Follow.Up.Time, df = 2)1                            10.96
#&gt; pspline(Follow.Up.Time, df = 2)2                             9.73
#&gt; pspline(Follow.Up.Time, df = 2)3                            10.10
#&gt; pspline(Follow.Up.Time, df = 2)4                             9.90
#&gt; pspline(Follow.Up.Time, df = 2)5                            10.10
#&gt; pspline(Follow.Up.Time, df = 2)6                            10.03
#&gt; pspline(Follow.Up.Time, df = 2)7                            30.13
#&gt; ScrArmScreening group                                       13.35
#&gt; pspline(Follow.Up.Time, df = 2)1:ScrArmScreening group      14.85
#&gt; pspline(Follow.Up.Time, df = 2)2:ScrArmScreening group      12.97
#&gt; pspline(Follow.Up.Time, df = 2)3:ScrArmScreening group      13.54
#&gt; pspline(Follow.Up.Time, df = 2)4:ScrArmScreening group      13.23
#&gt; pspline(Follow.Up.Time, df = 2)5:ScrArmScreening group      13.55
#&gt; pspline(Follow.Up.Time, df = 2)6:ScrArmScreening group      13.46
#&gt; pspline(Follow.Up.Time, df = 2)7:ScrArmScreening group      36.92
#&gt;                                                        z value
#&gt; (Intercept)                                              -1.38
#&gt; pspline(Follow.Up.Time, df = 2)1                          0.24
#&gt; pspline(Follow.Up.Time, df = 2)2                          0.66
#&gt; pspline(Follow.Up.Time, df = 2)3                          0.55
#&gt; pspline(Follow.Up.Time, df = 2)4                          0.73
#&gt; pspline(Follow.Up.Time, df = 2)5                          0.65
#&gt; pspline(Follow.Up.Time, df = 2)6                          1.08
#&gt; pspline(Follow.Up.Time, df = 2)7                         -0.39
#&gt; ScrArmScreening group                                     0.69
#&gt; pspline(Follow.Up.Time, df = 2)1:ScrArmScreening group   -0.62
#&gt; pspline(Follow.Up.Time, df = 2)2:ScrArmScreening group   -0.76
#&gt; pspline(Follow.Up.Time, df = 2)3:ScrArmScreening group   -0.67
#&gt; pspline(Follow.Up.Time, df = 2)4:ScrArmScreening group   -0.71
#&gt; pspline(Follow.Up.Time, df = 2)5:ScrArmScreening group   -0.79
#&gt; pspline(Follow.Up.Time, df = 2)6:ScrArmScreening group   -0.66
#&gt; pspline(Follow.Up.Time, df = 2)7:ScrArmScreening group   -0.31
#&gt;                                                        Pr(&gt;|z|)
#&gt; (Intercept)                                                0.17
#&gt; pspline(Follow.Up.Time, df = 2)1                           0.81
#&gt; pspline(Follow.Up.Time, df = 2)2                           0.51
#&gt; pspline(Follow.Up.Time, df = 2)3                           0.58
#&gt; pspline(Follow.Up.Time, df = 2)4                           0.46
#&gt; pspline(Follow.Up.Time, df = 2)5                           0.52
#&gt; pspline(Follow.Up.Time, df = 2)6                           0.28
#&gt; pspline(Follow.Up.Time, df = 2)7                           0.70
#&gt; ScrArmScreening group                                      0.49
#&gt; pspline(Follow.Up.Time, df = 2)1:ScrArmScreening group     0.53
#&gt; pspline(Follow.Up.Time, df = 2)2:ScrArmScreening group     0.45
#&gt; pspline(Follow.Up.Time, df = 2)3:ScrArmScreening group     0.50
#&gt; pspline(Follow.Up.Time, df = 2)4:ScrArmScreening group     0.48
#&gt; pspline(Follow.Up.Time, df = 2)5:ScrArmScreening group     0.43
#&gt; pspline(Follow.Up.Time, df = 2)6:ScrArmScreening group     0.51
#&gt; pspline(Follow.Up.Time, df = 2)7:ScrArmScreening group     0.75
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 3619.1  on 5939  degrees of freedom
#&gt; Residual deviance: 3359.1  on 5924  degrees of freedom
#&gt; AIC: 3391
#&gt; 
#&gt; Number of Fisher Scoring iterations: 7</code></pre>
</div>
<p>As noted in the Theoretical Details section, the usual asymptotic results hold
for likelihood ratio tests built using case-base sampling models. Therefore, we
can easily test the significance of the spline term and its interaction with time:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/stats/anova.html'>anova</a></span><span class='op'>(</span><span class='va'>fit</span>, test <span class='op'>=</span> <span class='st'>"LRT"</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>#&gt; Analysis of Deviance Table
#&gt; 
#&gt; Model: binomial, link: logit
#&gt; 
#&gt; Response: DeadOfPrCa
#&gt; 
#&gt; Terms added sequentially (first to last)
#&gt; 
#&gt; 
#&gt;                                        Df Deviance Resid. Df
#&gt; NULL                                                    5939
#&gt; pspline(Follow.Up.Time, df = 2)         7    246.6      5932
#&gt; ScrArm                                  1      5.6      5931
#&gt; pspline(Follow.Up.Time, df = 2):ScrArm  7      7.9      5924
#&gt;                                        Resid. Dev Pr(&gt;Chi)    
#&gt; NULL                                         3619             
#&gt; pspline(Follow.Up.Time, df = 2)              3373   &lt;2e-16 ***
#&gt; ScrArm                                       3367    0.018 *  
#&gt; pspline(Follow.Up.Time, df = 2):ScrArm       3359    0.343    
#&gt; ---
#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<p>Similarly, to compare different models (e.g. time modeled linearly), we could
compute Akaike’s Information Criterion (AIC) for each model.</p>
<h3 class="unnumbered" id="time-dependent-hazard-ratios">Time-dependent hazard ratios</h3>
<p>In what follows, the hazard ratio for a variable <span class="math inline">\(X\)</span> is defined as</p>
<p><span class="math display">\[
\frac{\lambda\left(t | X=x_1, \mathbf{Z}=\mathbf{z} ; \widehat{\beta}\right)}{\lambda(t | X=x_0, \mathbf{Z}=\mathbf{z} ; \widehat{\beta})}
\]</span>
where <span class="math inline">\(\lambda(t|\cdot;\widehat{\beta})\)</span> is the hazard rate as a function of the
variable <span class="math inline">\(t\)</span> (which is usually time, but can be any other continuous variable),
<span class="math inline">\(x_1\)</span> is the value of <span class="math inline">\(X\)</span> for the exposed group, <span class="math inline">\(x_0\)</span> is the value of <span class="math inline">\(X\)</span> for
the unexposed group, <span class="math inline">\(\mathbf{Z}\)</span> are other covariates in the model which are
equal to <span class="math inline">\(\mathbf{z}\)</span> in both the exposed and unexposed group,
and <span class="math inline">\(\widehat{\beta}\)</span> are the estimated regression coefficients. As indicated by the
formula above, it is most instructive to plot the hazard ratio as a function of
a variable <span class="math inline">\(t\)</span> only if there is an interaction between <span class="math inline">\(t\)</span> and <span class="math inline">\(X\)</span>. Otherwise,
the resulting plot will simply be a horizontal line across time.</p>
<p>The <code>plot</code> method with <code>type="hr"</code> for objects of class
<code>singleEventCB</code> can be used to compute time-dependent hazard ratios and
confidence intervals. In Figure <a href="#fig:interaction-ERSPC">2</a>, we show the
estimated hazard ratio and 95% confidence interval for screening vs. control
group as a function of time. Note that we must specify the covariate profile for
the reference group and times for the predicted hazards.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>new_time</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>12</span>, by  <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span></span>
<span><span class='va'>new_data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>ScrArm <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='st'>"Control group"</span>,</span>
<span>                                         levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Control group"</span>,<span class='st'>"Screening group"</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>                      Follow.Up.Time <span class='op'>=</span> <span class='va'>new_time</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>fit</span>, type <span class='op'>=</span> <span class='st'>"hr"</span>, newdata <span class='op'>=</span> <span class='va'>new_data</span>,</span>
<span>     var <span class='op'>=</span> <span class='st'>"ScrArm"</span>, xvar <span class='op'>=</span> <span class='st'>"Follow.Up.Time"</span>, ci <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:interaction-ERSPC"></span>
<img src="interaction-ERSPC-1.png" alt="Estimated hazard ratio and 95\% confidence interval for screening vs. control group as a function of time in the ERSPC dataset. Hazard ratios are estimated from fitting a parametric hazard model as a function of the interaction between a cubic pspline basis (df=2) of follow-up time and treatment arm. 95\% confidence intervals are calculated using the delta method. The plot shows that the effect of screening only begins to become statistically apparent by year 7. The 25-60\% reductions seen in years 8-12 of the study suggests a much higher reduction in prostate cancer due to screening than the single overall 20\% reported in the original article." width="\textwidth" keepaspectratio=true />
<p class="caption">
Figure 2: Estimated hazard ratio and 95% confidence interval for screening vs. control group as a function of time in the ERSPC dataset. Hazard ratios are estimated from fitting a parametric hazard model as a function of the interaction between a cubic pspline basis (df=2) of follow-up time and treatment arm. 95% confidence intervals are calculated using the delta method. The plot shows that the effect of screening only begins to become statistically apparent by year 7. The 25-60% reductions seen in years 8-12 of the study suggests a much higher reduction in prostate cancer due to screening than the single overall 20% reported in the original article.
</p>
</div>
</div>
<p>The plot shows that the effect of screening only becomes statistically apparent by year 7 and later. The 25-60% reductions seen in years 8-12 of the study suggests a much higher reduction in prostate cancer due to screening than the single overall 20% reported in the original article.</p>
<p>A more parsimonious model based on these results could be constructed as follows:</p>
<p><span class="math display">\[ \log \lambda\left(t \mid \mathbf{Z}\right) = \begin{cases} \alpha, &amp;\quad t &lt; t_0\\
\alpha + \beta Z(t - t_0), &amp;\quad t \geq t_0\end{cases},\]</span>
where <span class="math inline">\(t_0 \approx 7\)</span> years. This model corresponds to a hazard ratio that is constant and equal to 1 until <span class="math inline">\(t = t_0\)</span>, after which it decreases exponentially. If we fix the value <span class="math inline">\(t_0\)</span>, we can easily implement this model using our package; for example:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'>fitSmoothHazard</span><span class='op'>(</span><span class='va'>DeadOfPrCa</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>Follow.Up.Time</span> <span class='op'>&gt;=</span> <span class='va'>t0</span><span class='op'>)</span> <span class='op'>:</span></span>
<span>                    <span class='va'>ScrArm</span> <span class='op'>:</span> <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span><span class='op'>(</span><span class='va'>Follow.Up.Time</span> <span class='op'>-</span> <span class='va'>t0</span><span class='op'>)</span>,</span>
<span>                data <span class='op'>=</span> <span class='va'>ERSPC</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Here, we use the binary variable <code>as.integer(Follow.Up.Time &gt;= t0)</code> in order to write the two cases of our formula above in a more compact way. We also use the function <code>I()</code>, which allows us to specify new variables within the formula using normal <code>R</code> code. This is required, as otherwise the symbol <code>-</code> would be interpreted as a formula operator. Finally, the term <code>ScrArm : I(Follow.Up.Time - t0)</code> represents the product <span class="math inline">\(Z (t - t_0)\)</span> in the equation above. We use the operator <code>:</code> instead of <code>*</code> in order to only include the interaction term, not the main effects.</p>
<p>Alternatively, the breakpoint <span class="math inline">\(t_0\)</span> could also be estimated by combining case-base sampling with segmented regression. However, this extension is beyond the current scope of <code>casebase</code>.</p>
<h3 class="unnumbered" id="hazard-functions">Hazard functions</h3>
<p>Modeling the hazard function directly allows us to easily visualize it with
the <code>plot</code> method and <code>type="hazard"</code> for objects of class <code>singleEventCB</code>.
We plot the hazard functions for both treatment arms in Figure <a href="#fig:cs1hazard">3</a>.
The pattern we see is consistent with the population-time plot shown in Figure <a href="#fig:plot-erspc-data">1</a>C, where more events are observed at later follow-up times.
The drop at the end can be explained by the fact that very few observations were followed for the entire 15 year period.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>fit</span>, type <span class='op'>=</span> <span class='st'>"hazard"</span>,</span>
<span>     hazard.params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>xvar <span class='op'>=</span> <span class='st'>"Follow.Up.Time"</span>,</span>
<span>                          by <span class='op'>=</span> <span class='st'>"ScrArm"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>#&gt; Conditions used in construction of plot
#&gt; ScrArm: Control group / Screening group
#&gt; offset: 0</code></pre>
<div class="figure"><span style="display:block;" id="fig:cs1hazard"></span>
<img src="cs1hazard-1.png" alt="Estimated hazard functions for control and screening groups in the ERSPC dataset. Hazards are estimated from fitting a parametric model with casebase sampling as a function of the interaction between a cubic pspline basis (df=2) of follow-up time and treatment arm. The package vignettes provide a detailed description of how to plot hazard functions for any combination of covariates along with confidence bands." width="\textwidth" keepaspectratio=true />
<p class="caption">
Figure 3: Estimated hazard functions for control and screening groups in the ERSPC dataset. Hazards are estimated from fitting a parametric model with casebase sampling as a function of the interaction between a cubic pspline basis (df=2) of follow-up time and treatment arm. The package vignettes provide a detailed description of how to plot hazard functions for any combination of covariates along with confidence bands.
</p>
</div>
</div>
<h3 class="unnumbered" id="absolute-risk">Absolute risk</h3>
<p>Next, the <code>absoluteRisk</code> function takes as input the <code>singleEventCB</code> object and returns a matrix where each column corresponds to the covariate profiles specified in the <code>newdata</code> argument, and each row corresponds to time points specified by the <code>time</code> argument:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>new_data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>ScrArm <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Control group"</span>, <span class='st'>"Screening group"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>new_time</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>14</span>,<span class='fl'>0.1</span><span class='op'>)</span></span>
<span><span class='va'>risk</span> <span class='op'>&lt;-</span> <span class='fu'>absoluteRisk</span><span class='op'>(</span><span class='va'>fit</span>, time <span class='op'>=</span> <span class='va'>new_time</span>, newdata <span class='op'>=</span> <span class='va'>new_data</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<!--In Figure \ref{fig:erspc-cox-cif}, we overlay the estimated risk function from \pkg{casebase} on the Cox model estimate. -->
<!--A common choice for this type of analysis is to use a Cox regression model and estimate the hazard ratio for the screening group (relative to the control group). In R, it can be done as follows:-->
<div class="layout-chunk" data-layout="l-body">

</div>
<p>We can subsequently compute confidence intervals for the risk function using
the method <code>confint.absRiskCB</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>conf_ints</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/confint.html'>confint</a></span><span class='op'>(</span><span class='va'>risk</span>, <span class='va'>fit</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>conf_ints</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>#&gt;   time estimate conf.low conf.high      cov_prof
#&gt; 1  0.0  0.0e+00  0.0e+00   0.0e+00 Control group
#&gt; 2  0.1  1.8e-06  1.9e-07   1.2e-05 Control group
#&gt; 3  0.2  3.9e-06  4.8e-07   2.2e-05 Control group
#&gt; 4  0.3  6.1e-06  9.0e-07   3.2e-05 Control group
#&gt; 5  0.4  8.7e-06  1.5e-06   4.1e-05 Control group
#&gt; 6  0.5  1.2e-05  2.3e-06   5.0e-05 Control group</code></pre>
</div>
<p>In Figure <a href="#fig:erspc-cif-conf">4</a>, we see the 95% confidence bands around the estimates.
We also overlay the Kaplan-Meier curves as a reference.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: h"><span style="display:block;" id="fig:erspc-cif-conf"></span>
<img src="erspc-cif-conf-1.png" alt="Risk function estimates for control and screening groups in the ERSPC data using case-base sampling and Kaplan-Meier, along with 95\% confidence bands. The smooth curve (case-base sampling) vs. step function (Cox model) highlight one of the main differences between the two approaches. The larger confidence bands in the later years is due to the relatively few number of individuals who were followed for more than 12 years." width="\textwidth" keepaspectratio=true />
<p class="caption">
Figure 4: Risk function estimates for control and screening groups in the ERSPC data using case-base sampling and Kaplan-Meier, along with 95% confidence bands. The smooth curve (case-base sampling) vs. step function (Cox model) highlight one of the main differences between the two approaches. The larger confidence bands in the later years is due to the relatively few number of individuals who were followed for more than 12 years.
</p>
</div>
</div>
<h2 class="unnumbered" id="case-study-2competing-risk-analysis">Case study 2—competing risk analysis</h2>
<p>In this case study, we show how case-base sampling can be used in the context of a competing risk analysis. For illustrative purposes, we use the same data that was used in Scrucca <em>et al</em> <span class="citation" data-cites="scrucca2010regression">(<a href="#ref-scrucca2010regression" role="doc-biblioref">2010</a>)</span>. The data was downloaded from the first author’s website, and it is now available as part of the <a href="#">casebase</a> package.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>The data contains information on 177 patients who received a stem-cell transplant for acute leukemia. The event of interest is relapse, but other competing causes (e.g. death, progression, graft failure, graft-versus-host disease) were also recorded. Several covariates were captured at baseline: sex, disease type (acute lymphoblastic or myeloblastic leukemia, abbreviated as ALL and AML, respectively), disease phase at transplant (Relapse, CR1, CR2, CR3), source of stem cells (bone marrow and peripheral blood, coded as BM+PB, or only peripheral blood, coded as PB), and age.</p>
<p>First, we look at a population-time plot to visualize the incidence density of both relapse and the competing events. In Figure <a href="#fig:compPop">5</a>, failure times are highlighted on the plot using red dots for the event of interest and blue dots for competing events. In this plot, we see evidence of a non-constant hazard function: the density of points is larger at the beginning of follow-up than at the end.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:compPop"></span>
<img src="compPop-1.png" alt="Population-time plot for the stem-cell transplant study with both relapse and competing events. The area representing the population time is shown in gray, with subjects having the least amount of observation time plotted at the top of the y-axis. The y-axis location of each case series and competing event moment is sampled at random vertically on the plot to avoid having all points along the upper edge of the gray area. The density of points at the beginning of follow-up relative to the end indicates a non-constant hazard function." width="\textwidth" keepaspectratio=true />
<p class="caption">
Figure 5: Population-time plot for the stem-cell transplant study with both relapse and competing events. The area representing the population time is shown in gray, with subjects having the least amount of observation time plotted at the top of the y-axis. The y-axis location of each case series and competing event moment is sampled at random vertically on the plot to avoid having all points along the upper edge of the gray area. The density of points at the beginning of follow-up relative to the end indicates a non-constant hazard function.
</p>
</div>
</div>
<p>Our main objective is to compute the cumulative incidence of relapse for a given set of covariates. We start by fitting a smooth hazard to the data using a linear term for time:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>model_cb</span> <span class='op'>&lt;-</span> <span class='fu'>fitSmoothHazard</span><span class='op'>(</span></span>
<span>  <span class='va'>Status</span> <span class='op'>~</span> <span class='va'>ftime</span> <span class='op'>+</span> <span class='va'>Sex</span> <span class='op'>+</span> <span class='va'>D</span> <span class='op'>+</span> <span class='va'>Phase</span> <span class='op'>+</span> <span class='va'>Source</span> <span class='op'>+</span> <span class='va'>Age</span>,</span>
<span>  data <span class='op'>=</span> <span class='va'>bmtcrr</span>,</span>
<span>  ratio <span class='op'>=</span> <span class='fl'>100</span>,</span>
<span>  time <span class='op'>=</span> <span class='st'>"ftime"</span></span>
<span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We want to compare our hazard ratio estimates to that obtained from a Cox regression (using the <a href="#">survival</a> package version 3.2-13).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/therneau/survival'>survival</a></span><span class='op'>)</span></span>
<span><span class='co'># Prepare data for coxph</span></span>
<span><span class='va'>bmtcrr_cox</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/transform.html'>transform</a></span><span class='op'>(</span><span class='va'>bmtcrr</span>, </span>
<span>                        id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>bmtcrr</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>                        Status <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Status</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>model_cox</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/coxph.html'>coxph</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>ftime</span>, <span class='va'>Status</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>Sex</span> <span class='op'>+</span> <span class='va'>D</span> <span class='op'>+</span> <span class='va'>Phase</span> <span class='op'>+</span> <span class='va'>Source</span> <span class='op'>+</span> <span class='va'>Age</span>,</span>
<span>                   data <span class='op'>=</span> <span class='va'>bmtcrr_cox</span>, id <span class='op'>=</span> <span class='va'>id</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:bmtcrr-cis">Table 2: </span>Estimates and confidence intervals for the hazard ratios for each coefficient. Both estimates from case-base sampling and Cox regression are presented.
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Case-Base
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Cox
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
Covariates
</th>
<th style="text-align:right;">
HR
</th>
<th style="text-align:left;">
95% Conf.
</th>
<th style="text-align:right;">
HR
</th>
<th style="text-align:left;">
95% Conf.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Sex
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:left;">
(0.42, 1.27)
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:left;">
(0.39, 1.21)
</td>
</tr>
<tr>
<td style="text-align:left;">
Disease
</td>
<td style="text-align:right;">
0.54
</td>
<td style="text-align:left;">
(0.3, 0.98)
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:left;">
(0.28, 0.94)
</td>
</tr>
<tr>
<td style="text-align:left;">
Phase (CR2 vs. CR1)
</td>
<td style="text-align:right;">
1.19
</td>
<td style="text-align:left;">
(0.48, 2.97)
</td>
<td style="text-align:right;">
1.21
</td>
<td style="text-align:left;">
(0.47, 3.09)
</td>
</tr>
<tr>
<td style="text-align:left;">
Phase (CR3 vs. CR1)
</td>
<td style="text-align:right;">
1.44
</td>
<td style="text-align:left;">
(0.37, 5.64)
</td>
<td style="text-align:right;">
1.67
</td>
<td style="text-align:left;">
(0.46, 6.08)
</td>
</tr>
<tr>
<td style="text-align:left;">
Phase (Relapse vs. CR1)
</td>
<td style="text-align:right;">
4.22
</td>
<td style="text-align:left;">
(1.95, 9.12)
</td>
<td style="text-align:right;">
4.55
</td>
<td style="text-align:left;">
(1.98, 10.46)
</td>
</tr>
<tr>
<td style="text-align:left;">
Source
</td>
<td style="text-align:right;">
1.46
</td>
<td style="text-align:left;">
(0.48, 4.46)
</td>
<td style="text-align:right;">
1.46
</td>
<td style="text-align:left;">
(0.47, 4.53)
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:left;">
(0.97, 1.02)
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:left;">
(0.97, 1.02)
</td>
</tr>
</tbody>
</table>
</div>
<p>From the fit object, we can extract both the hazard ratios and their corresponding confidence intervals. These quantities appear in Table <a href="#tab:bmtcrr-cis">2</a>. As we can see, the type of disease corresponds to a significant hazard ratio: the hazard for AML is about half that for ALL. Moreover, being in relapse at transplant is associated with a hazard ratio of 4.22 when compared to CR1.</p>
<p>Given the estimate of the hazard functions obtained using case-base sampling, we can compute the cumulative incidence curve for a fixed covariate profile. We perform this computation for a 35 year old woman who received a stem-cell transplant from peripheral blood at relapse. We compare the absolute risk curve for such a woman with ALL with that for a similar woman with AML.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Next, we compare our estimates to that obtained from a corresponding Fine-Gray model <span class="citation" data-cites="fine1999proportional">(<a href="#ref-fine1999proportional" role="doc-biblioref">1999</a>)</span>. The Fine-Gray model is a semiparametric model for the cause-specific <em>subdistribution hazard</em>, i.e. the function <span class="math inline">\(d_j(t)\)</span> such that
<span class="math display">\[CI_j(t) = 1 - \exp\left( - \int_0^t d_j(u) \textrm{d}u \right),\]</span>
where <span class="math inline">\(CI_j(t)\)</span> is the cause-specific CI. The Fine-Gray model allows to directly assess the effect of a covariate on the subdistribution hazard, as opposed to the cause-specific hazard. For the computation, we use the <a href="https://cran.r-project.org/package=timereg">timereg</a> package <span class="citation" data-cites="timereg">(<a href="#ref-timereg" role="doc-biblioref">Scheike and Zhang 2011</a>)</span>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/scheike/timereg'>timereg</a></span><span class='op'>)</span></span>
<span><span class='va'>model_fg</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/timereg/man/comp.risk.html'>comp.risk</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/timereg/man/Event.html'>Event</a></span><span class='op'>(</span><span class='va'>ftime</span>, <span class='va'>Status</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/pkg/timereg/man/const.html'>const</a></span><span class='op'>(</span><span class='va'>Sex</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/timereg/man/const.html'>const</a></span><span class='op'>(</span><span class='va'>D</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>                        <span class='fu'><a href='https://rdrr.io/pkg/timereg/man/const.html'>const</a></span><span class='op'>(</span><span class='va'>Phase</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/timereg/man/const.html'>const</a></span><span class='op'>(</span><span class='va'>Source</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/timereg/man/const.html'>const</a></span><span class='op'>(</span><span class='va'>Age</span><span class='op'>)</span>,</span>
<span>                      data <span class='op'>=</span> <span class='va'>bmtcrr</span>, cause <span class='op'>=</span> <span class='fl'>1</span>, model <span class='op'>=</span> <span class='st'>"fg"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Estimate CI curve</span></span>
<span><span class='va'>risk_fg</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>model_fg</span>, <span class='va'>newdata</span>, times <span class='op'>=</span> <span class='va'>time_points</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We can also estimate the CI for relapse using the Cox model and the Aalen-Johansen estimator:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Estimate absolute risk curve</span></span>
<span><span class='va'>risk_cox</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='va'>model_cox</span>, newdata <span class='op'>=</span> <span class='va'>newdata</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:compAbsrisk"></span>
<img src="compAbsrisk-1.png" alt="Cumulative Incidence curve for a fixed covariate profile and the two disease groups. The estimate obtained from case-base sampling is compared to the Fine-Gray and Aalen-Johansen estimates. In general, the three approaches agree quite well for AML, while there seems to be a difference of about 5\% between the Fine-Gray curve and the curves estimated using case-base sampling and Cox regression for ALL. However, this difference does not appear to be significant as the curve from case-base sampling is contained within a 95\% confidence band around the Fine-Gray absolute risk curve (figure not shown)." width="\textwidth" keepaspectratio=true />
<p class="caption">
Figure 6: Cumulative Incidence curve for a fixed covariate profile and the two disease groups. The estimate obtained from case-base sampling is compared to the Fine-Gray and Aalen-Johansen estimates. In general, the three approaches agree quite well for AML, while there seems to be a difference of about 5% between the Fine-Gray curve and the curves estimated using case-base sampling and Cox regression for ALL. However, this difference does not appear to be significant as the curve from case-base sampling is contained within a 95% confidence band around the Fine-Gray absolute risk curve (figure not shown).
</p>
</div>
</div>
<p>Figure <a href="#fig:compAbsrisk">6</a> shows the CI curves for all three models. As we can see, all three approaches agree quite well for AML; however, for ALL, there seems to be a difference of about 5% between the Fine-Gray curve and the curves estimated using case-base sampling and Cox regression. This difference does not appear to be significant: the curve from case-base sampling is contained within a 95% confidence band around the Fine-Gray absolute risk curve (figure not shown).</p>
<h2 class="unnumbered" id="case-study-3variable-selection">Case study 3—variable selection</h2>
<p>For the third case study, we show how <a href="#">casebase</a> can also be used for variable selection through regularized estimation of the hazard function as given by Equation <a href="#eq:penest">(5)</a>. We note that this is different than the semiparametric model Coxnet, which regularizes the Cox partial likelihood. To illustrate this functionality, we use the dataset from the Study to Understand Prognoses Preferences Outcomes and Risks of Treatment (SUPPORT) <span class="citation" data-cites="knaus1995support">(<a href="#ref-knaus1995support" role="doc-biblioref">Knaus et al. 1995</a>)</span>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> The SUPPORT dataset tracks death in five American hospitals within individuals who are considered seriously ill. The cleaned and imputed data consists of 9104 observations and 30 variables, and it is available as part of the <a href="#">casebase</a> package. In the comparisons below, all covariates except <code>sps</code> and <code>aps</code> were used. These two variables correspond to scores for predicting the outcome that were developed as part of the original study. For more information about this dataset, the reader is encouraged to look at the documentation in our package.</p>
<p>For our penalized case-base model, we opt for the natural log of time which corresponds to a Weibull distribution. For fitting the penalized hazard, we use <code>fitSmoothHazard.fit</code>, which is a matrix interface to the <code>fitSmoothHazard</code> function. The <code>fitSmoothHazard</code> and <code>fitSmoothHazard.fit</code> functions sample the case and base series, calculate the required offset, and transform the data to match the expected input of the <a href="#">glmnet</a> package. The penalized logistic regression is then fit for multiple values of the tuning parameter using the function <code>glmnet::cv.glmnet</code> and the binomial family. To <code>fitSmoothHazard.fit</code>, we supply both a matrix <code>y</code> containing the time and event variables, and a matrix <code>x</code> containing all other covariates. We apply the lasso penalty by setting <code>alpha = 1</code> and assign a <code>penalty.factor</code> (<span class="math inline">\(w_j\)</span>; cf. Equation <a href="#eq:penest">(5)</a>) of 0 to the time variable to ensure it is in the selected model. We compare our approach to both Cox regression, and lasso penalized Cox regression (fitted via the <a href="#">glmnet</a> package and using the Cox family).</p>
<p>To compare the performance of our models, we split the data into 95% training and 5% test sets. To assess both discrimination and calibration, we use a time-dependent version of the classical Brier score that is adjusted for censoring <span class="citation" data-cites="graf1999ass">(<a href="#ref-graf1999ass" role="doc-biblioref">Graf et al. 1999</a>)</span>. The Brier score can be used with both parametric and semi-parametric models. We use the <a href="#">riskRegression</a> package to compute these scores for all models.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Create matrices for inputs</span></span>
<span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/model.matrix.html'>model.matrix</a></span><span class='op'>(</span><span class='va'>death</span> <span class='op'>~</span> <span class='va'>.</span> <span class='op'>-</span> <span class='va'>d.time</span> <span class='op'>-</span> <span class='va'>aps</span> <span class='op'>-</span> <span class='va'>sps</span>, </span>
<span>                  data <span class='op'>=</span> <span class='va'>train</span><span class='op'>)</span><span class='op'>[</span>, <span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>]</span> <span class='co'># Remove intercept</span></span>
<span><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.matrix.html'>data.matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>train</span>, select <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>d.time</span>, <span class='va'>death</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Regularized logistic regression to estimate hazard</span></span>
<span><span class='va'>pen_cb</span> <span class='op'>&lt;-</span> <span class='fu'>casebase</span><span class='fu'>::</span><span class='fu'><a href='http://sahirbhatnagar.com/casebase/reference/fitSmoothHazard.html'>fitSmoothHazard.fit</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>,</span>
<span>  family <span class='op'>=</span> <span class='st'>"glmnet"</span>,</span>
<span>  time <span class='op'>=</span> <span class='st'>"d.time"</span>, event <span class='op'>=</span> <span class='st'>"death"</span>,</span>
<span>  formula_time <span class='op'>=</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>d.time</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>  ratio <span class='op'>=</span> <span class='fl'>10</span>, standardize <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>  penalty.factor <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>In Figure <a href="#fig:cs3lolliPlot">7</a>, we show the coefficient estimates for covariates that we selected by both penalized Cox and penalized case-base. We note that both penalized approaches produce similar results. We can also clearly see the shrinkage effect owing to the <span class="math inline">\(\ell_1\)</span> penalty.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:cs3lolliPlot"></span>
<img src="cs3lolliPlot-1.png" alt="Coefficient estimates from the Cox model (Cox), penalized Cox model using the glmnet package (Pen. Cox), and our approach using penalized case-base sampling (Pen. CB). Only the covariates that were selected by both penalized approaches are shown. The shrinkage of the coefficient estimates for Pen. Cox and Pen. CB occurs due to the $\ell_1$ penalty." width="\textwidth" keepaspectratio=true />
<p class="caption">
Figure 7: Coefficient estimates from the Cox model (Cox), penalized Cox model using the glmnet package (Pen. Cox), and our approach using penalized case-base sampling (Pen. CB). Only the covariates that were selected by both penalized approaches are shown. The shrinkage of the coefficient estimates for Pen. Cox and Pen. CB occurs due to the <span class="math inline">\(\ell_1\)</span> penalty.
</p>
</div>
</div>
<p>We then compare the risk estimation over the test set. The predicted probabilities for each test set observation are averaged, resulting in the absolute risk curves shown in Figure <a href="#fig:cs3FinalBrier">8</a>A. The Kaplan-Meier curve is calculated on the test set only. We see minimal differences between the four approaches across follow-up-time. Note that the apparent smoothness of the Cox and penalized Cox curves is due to the large number of observations in the training set, which is used to derive the Breslow estimate of the baseline hazard. As described above, we compare the performance between the models by computing the Brier scores over time. In Figure <a href="#fig:cs3FinalBrier">8</a>B, we see that the adjusted models all perform similarly, outperforming the Kaplan-Meier estimate.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:cs3FinalBrier"></span>
<img src="cs3FinalBrier-1.png" alt="Comparison of Cox regression (Cox), penalized Cox regression (Pen. Cox), penalized case-base sampling estimation (Pen. CB), and Kaplan-Meier (K-M). (A) Probability of death as a function of follow-up time which is the average of the predicted probabilities for each test set observation. The Kaplan-Meier curve is calculated on the test set only. We see minimal differences between the four approaches across follow-up-time for the absolute risk curves. Note that the apparent smoothness of the Cox and penalized Cox curves is due to the large number of observations in the training set, which is used to derive the Breslow estimate of the baseline hazard. (B) Brier score as a function of follow-up time, where a lower score corresponds to better performance. We see that the adjusted models all perform similarly, outperforming the Kaplan-Meier estimate." width="\textwidth" keepaspectratio=true />
<p class="caption">
Figure 8: Comparison of Cox regression (Cox), penalized Cox regression (Pen. Cox), penalized case-base sampling estimation (Pen. CB), and Kaplan-Meier (K-M). (A) Probability of death as a function of follow-up time which is the average of the predicted probabilities for each test set observation. The Kaplan-Meier curve is calculated on the test set only. We see minimal differences between the four approaches across follow-up-time for the absolute risk curves. Note that the apparent smoothness of the Cox and penalized Cox curves is due to the large number of observations in the training set, which is used to derive the Breslow estimate of the baseline hazard. (B) Brier score as a function of follow-up time, where a lower score corresponds to better performance. We see that the adjusted models all perform similarly, outperforming the Kaplan-Meier estimate.
</p>
</div>
</div>
<h1 data-number="6" id="discussion"><span class="header-section-number">6</span> Discussion</h1>
<p>In this article, we presented the R package <a href="#">casebase</a>, which provides functions for fitting smooth parametric hazards and estimating risk functions using case-base sampling. Our package also provides several functions to produce graphical summaries of the data and the results. We outlined the theoretical underpinnings of the approach, we provided details about our implementation, and we illustrated the merits of the case-base framework and the package through three case studies.</p>
<p>As a methodological framework, case-base sampling is very flexible. Some of this flexibility has been explored before in the literature: for example, Saarela and Hanley <span class="citation" data-cites="saarela2015case">(<a href="#ref-saarela2015case" role="doc-biblioref">2015</a>)</span> used case-base sampling to model a time-dependent exposure variable in a vaccine safety study. As another example, Saarela and Arjas <span class="citation" data-cites="saarela2015non">(<a href="#ref-saarela2015non" role="doc-biblioref">2015</a>)</span> combined case-base sampling and a Bayesian non-parametric framework to compute individualized risk assessments for chronic diseases. In the case studies above, we further explored this flexibility along two fronts. On the one hand, we showed how splines could be used as part of the linear predictor to model the effect of time on the hazard. This strategy yielded estimates of the survival function that were qualitatively similar to semiparametric estimates derived from Cox regression; however, case-base sampling led to estimates of the survival function that <em>vary smoothly in time</em> and are thus easier to interpret. On the other hand, we also displayed the flexibility of case-base sampling by showing how it could be combined with penalized logistic regression to perform variable selection. Furthermore, the second case study showed how case-base sampling can be applied to competing risks settings. It should be noted that the three case studies presented above only considered covariates that were fixed at baseline. In one of the package vignettes, we use the Stanford Heart Transplant data <span class="citation" data-cites="clark1971cardiac">Crowley and Hu (<a href="#ref-crowley1977covariance" role="doc-biblioref">1977</a>)</span> to show how case-base sampling can also be used in the context of time-dependent exposure. In this study, the exposure period was defined as the week following vaccination. Hence, the main covariate of interest, i.e. exposure to the vaccine, was changing over time. In this context, case-base sampling offers an efficient alternative to nested case-control designs or self-matching.</p>
<p>Even though we did not illustrate it in this article, case-base sampling can also be combined with the framework of <em>generalized additive models</em>. This functionality has already been implemented in the package. Similarly, case-base sampling can be combined with quasi-likelihood estimation to fit survival models that can account for the presence of over-dispersion. All of these examples illustrate how the case-base sampling framework in general, and the package <a href="#">casebase</a> in particular, allows the user to fit a broad and flexible family of survival functions.</p>
<p>Poisson regression can also be used to estimate the full hazard by discretizing time. However, this method requires user input on the number of intervals, or equivalently, on the cut points. This choice made by the user can have a significant impact on the model. Small intervals may result in many empty, non-informative bins. This may cause convergence issues for the Newton-Raphson procedure <span class="citation" data-cites="kalbfleisch2011statistical">(<a href="#ref-kalbfleisch2011statistical" role="doc-biblioref">Kalbfleisch and Prentice 2011</a>)</span>. If the intervals are too wide, the nonlinear trends that are present in the hazard may be masked. Rather than discretizing time like in Poisson regression, case-base sampling provides a continuous-time approach to using GLMs for estimating hazard functions.</p>
<p>As presented in Hanley &amp; Miettinen <span class="citation" data-cites="hanley2009fitting">(<a href="#ref-hanley2009fitting" role="doc-biblioref">2009</a>)</span>, case-base sampling is comprised of three steps: 1) sampling a case series and a base series from the study; 2) fit the log-hazard as a linear function of predictors (including time); and 3) use the fitted hazard to estimate the risk function. Accordingly, our package provides functions for each step. Moreover, the simple interface of the <code>fitSmoothHazard</code> function resembles the <code>glm</code> interface. This interface should look familiar to new users. Our modular approach also provides a convenient way to extend our package for new sampling or fitting strategies.</p>
<p>In the case studies above, we compared the performance of case-base sampling with that of Cox regression and Fine-Gray models. In terms of function interface, <a href="#">casebase</a> uses a formula interface that is closer to that of <code>glm</code>, in that the event variable is the only variable appearing on the left-hand side of the formula. By contrast, both <code>survival::coxph</code> and <code>timereg::comp.risk</code> use arrays that capture both the event type and time. Both approaches to modeling yield user-friendly code. However, in terms of output, both approaches differ significantly. Case-base sampling produces smooth hazards and smooth survival curves, whereas Cox regression and Fine-Gray models produce stepwise CIs and never explicitly model the hazard function. Qualitatively, we showed that by using splines in the linear predictor, all three models yielded similar curves.</p>
<!-- In Table \ref{tab:compCBvsCox}, we provide a side-by-side comparison between the Cox model and case-base sampling. -->
<!-- \begin{widetable} -->
<!-- \caption{\label{tab:compCBvsCox}Comparison between the Cox model and case-base sampling} -->
<!-- \centering -->
<!-- \begin{tabular}[t]{llp{5cm}} -->
<!-- \toprule -->
<!-- Feature & Cox model & Case-base sampling\\ -->
<!-- \toprule -->
<!-- Model type & Semi-parametric & Fully parametric\\\midrule -->
<!-- Time & Left hand side of the formula & Right hand side (allows flexible modeling of time)\\\midrule -->
<!-- Survival curve & Step function & Smooth-in-time curve\\\midrule -->
<!-- Non-proportional hazards & Interaction of covariates with time & Interaction of covariates with time\\\midrule -->
<!-- Model testing & Likelihood-ratio tests, score tests, & Use GLM framework\\ -->
<!--  & information criteria & (e.g.\ LRT, AIC, BIC)\\\midrule -->
<!-- \addlinespace -->
<!-- Competing risks & Aalen-Johansen & Cause-specific CIFs\\ -->
<!-- % Prediction & Kaplan-Meier-based & ROC, AUC, risk reclassification probabilities\\ -->
<!-- \bottomrule -->
<!-- \end{tabular} -->
<!-- \end{widetable} -->
<p>Our choice of modeling the log-hazard as a linear function of covariates allows us to develop a simple computational scheme for estimation. However, as a downside, it does not allow us to model location and scale parameters separately like the package <a href="#">flexsurv</a>. For example, if we look at the Weibull distribution as parametrised in <code>stats::pweibull</code>, the log-hazard function is given by
<span class="math display">\[ \log \lambda(t; \alpha, \beta) = \left[\log(\alpha/\beta) - (\alpha - 1)\log(\beta)\right] + (\alpha - 1)\log t,\]</span>
where <span class="math inline">\(\alpha,\beta\)</span> are shape and scale parameters, respectively. Unlike <a href="#">casebase</a>, the approach taken by <a href="#">flexsurv</a> also allows the user to model the scale parameter as a function of covariates. Of course, this added flexibility comes at the cost of interpretability: by modeling the log-hazard directly, the parameter estimates from <a href="#">casebase</a> can be interpreted as estimates of log-hazard ratios. To improve the flexibility of <a href="#">casebase</a> at capturing the scale of a parametric family, we could replace the logistic regression with its quasi-likelihood counterpart and therefore model over- and under-dispersion with respect to the logistic likelihood. We defer the study of the properties and performance of such a model to a future article.</p>
<p>Future work will look at some of the methodological extensions of case-base sampling. First, to assess the quality of the model fit, we would like to study the properties of the residuals (e.g. Cox-Snell, martingale). More work needs to be done to understand these residuals in the context of the partial likelihood underlying case-base sampling. The resulting diagnostic tools could then be integrated in this package. Also, we are interested in extending case-base sampling to account for interval censoring. This type of censoring is very common in longitudinal studies, and many packages (e.g. <a href="#">SmoothHazard</a>, <a href="#">survival</a> and <a href="#">rstpm2</a>) provide functions to account for it. Again, we hope to include any resulting methodology as part of this package.</p>
<p>In future versions of the package, we also want to increase the complement of diagnostic and inferential tools that are currently available. For example, we would like to include more functions to compute calibration and discrimination statistics (e.g. AUC) for our models. Saarela and Arjas <span class="citation" data-cites="saarela2015non">(<a href="#ref-saarela2015non" role="doc-biblioref">2015</a>)</span> also describe how to obtain a posterior distribution for the AUC from their model. Their approach could potentially be included in <a href="#">casebase</a>. Finally, we want to provide more flexibility in how the case-base sampling is performed. This could be achieved by adding a <code>hazard</code> argument to the function <code>sampleCaseBase</code>. In this way, users could specify their own sampling mechanism. For example, they could provide a hazard that gives sampling probabilities that are proportional to the cardiovascular disease event rate given by the Framingham score <span class="citation" data-cites="saarela2015non">(<a href="#ref-saarela2015non" role="doc-biblioref">Saarela and Arjas 2015</a>)</span>.</p>
<p>In conclusion, we presented the R package <a href="#">casebase</a> which implements case-base sampling for fitting parametric survival models and for estimating smooth survival functions using the framework of generalized linear models. We strongly believe that its flexibility and its foundation on the familiar logistic regression model will make it appealing to new and established practitioners. The <a href="#">casebase</a> package is freely available from the Comprehensive R Archive Network at <a href="https://cran.r-project.org/package=casebase" class="uri">https://cran.r-project.org/package=casebase</a>. Interested users can visit <a href="http://sahirbhatnagar.com/casebase/" class="uri">http://sahirbhatnagar.com/casebase/</a> for detailed package documentation and vignettes.</p>
<h1 data-number="7" id="acknowledgments"><span class="header-section-number">7</span> Acknowledgments</h1>
<p>We would like to thank the anonymous reviewers for their insightful comments and criticisms. We would also like to thank Yi Yang for helpful discussions on penalized regression models. Bhatnagar (RGPIN-2020-05133) and Turgeon (RGPIN-2021-04073) both gratefully acknowledge funding via a Discovery Grant from the Natural Sciences and Engineering Research Council of Canada (NSERC), RGPIN.</p>
<!-- # Environment Details -->
<!-- This report was generated on 2022-12-20 16:30:08 using the following computational environment and dependencies:  -->
<div class="layout-chunk" data-layout="l-body">

</div>
<!-- The current Git commit details are: -->
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h2 class="appendix unnumbered" id="supplementary-materials">Supplementary materials</h2>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2022-052.zip">RJ-2022-052.zip</a></p>
<h2 class="appendix unnumbered" id="cran-packages-used">CRAN packages used</h2>
<p><a href="https://cran.r-project.org/package=casebase">casebase</a>, <a href="https://cran.r-project.org/package=CFC">CFC</a>, <a href="https://cran.r-project.org/package=flexsurv">flexsurv</a>, <a href="https://cran.r-project.org/package=SmoothHazard">SmoothHazard</a>, <a href="https://cran.r-project.org/package=rstpm2">rstpm2</a>, <a href="https://cran.r-project.org/package=mets">mets</a>, <a href="https://cran.r-project.org/package=survival">survival</a>, <a href="https://cran.r-project.org/package=glmnet">glmnet</a>, <a href="https://cran.r-project.org/package=glmpath">glmpath</a>, <a href="https://cran.r-project.org/package=penalized">penalized</a>, <a href="https://cran.r-project.org/package=riskRegression">riskRegression</a>, <a href="https://cran.r-project.org/package=cmprsk">cmprsk</a>, <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>, <a href="https://cran.r-project.org/package=mgcv">mgcv</a>, <a href="https://cran.r-project.org/package=VGAM">VGAM</a>, <a href="https://cran.r-project.org/package=timereg">timereg</a></p>
<h2 class="appendix unnumbered" id="cran-task-views-implied-by-cited-packages">CRAN Task Views implied by cited packages</h2>
<p><a href="https://cran.r-project.org/view=Bayesian">Bayesian</a>, <a href="https://cran.r-project.org/view=CausalInference">CausalInference</a>, <a href="https://cran.r-project.org/view=ClinicalTrials">ClinicalTrials</a>, <a href="https://cran.r-project.org/view=Distributions">Distributions</a>, <a href="https://cran.r-project.org/view=Econometrics">Econometrics</a>, <a href="https://cran.r-project.org/view=Environmetrics">Environmetrics</a>, <a href="https://cran.r-project.org/view=Epidemiology">Epidemiology</a>, <a href="https://cran.r-project.org/view=ExtremeValue">ExtremeValue</a>, <a href="https://cran.r-project.org/view=MachineLearning">MachineLearning</a>, <a href="https://cran.r-project.org/view=MixedModels">MixedModels</a>, <a href="https://cran.r-project.org/view=Phylogenetics">Phylogenetics</a>, <a href="https://cran.r-project.org/view=Psychometrics">Psychometrics</a>, <a href="https://cran.r-project.org/view=Spatial">Spatial</a>, <a href="https://cran.r-project.org/view=Survival">Survival</a>, <a href="https://cran.r-project.org/view=TeachingStatistics">TeachingStatistics</a></p>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-aalen2008survival" class="csl-entry" role="doc-biblioentry">
O. Aalen, O. Borgan and H. Gjessing. <em>Survival and event history analysis: A process point of view.</em> Springer Science &amp; Business Media, 2008.
</div>
<div id="ref-survTaskView" class="csl-entry" role="doc-biblioentry">
A. Allignol and A. Latouche. CRAN task view: Survival analysis. <em>CRAN Task View: Survival Analysis</em>, 2019. URL <a href="https://cran.r-project.org/web/views/Survival.html">https://cran.r-project.org/web/views/Survival.html</a>.
</div>
<div id="ref-arjas1987logistic" class="csl-entry" role="doc-biblioentry">
E. Arjas and P. Haara. A logistic regression model for hazard: Asymptotic results. <em>Scandinavian Journal of Statistics</em>, 1–18, 1987.
</div>
<div id="ref-casebase-package" class="csl-entry" role="doc-biblioentry">
S. Bhatnagar, M. Turgeon, J. Islam, O. Saarela and J. Hanley. <em>Casebase: Fitting flexible smooth-in-time hazards and risk functions via logistic and multinomial regression.</em> 2021. URL <a href="https://CRAN.R-project.org/package=casebase">https://CRAN.R-project.org/package=casebase</a>. R package version 0.9.1.
</div>
<div id="ref-breslow1972discussion" class="csl-entry" role="doc-biblioentry">
N. Breslow. Discussion of the paper by <span>Dr Cox</span> cited below. <em>Journal of the Royal Statistical Society: Series B (Methodological)</em>, 34: 187–220, 1972.
</div>
<div id="ref-copenhagen2012needs" class="csl-entry" role="doc-biblioentry">
B. Carstensen. Who needs the cox model anyway. 2019. URL <a href="http://bendixcarstensen.com/WntCma.pdf">http://bendixcarstensen.com/WntCma.pdf</a>.
</div>
<div id="ref-clark1971cardiac" class="csl-entry" role="doc-biblioentry">
D. A. Clark, E. B. Stinson, R. B. Griepp, J. S. Schroeder, N. E. Shumway and D. Harrison. Cardiac transplantation in man. <em>Annals of Internal Medicine</em>, 75(1): 15–21, 1971.
</div>
<div id="ref-clements_liu" class="csl-entry" role="doc-biblioentry">
M. Clements and X.-R. Liu. <em>rstpm2: Smooth survival models, including generalized survival models.</em> 2019. URL <a href="https://CRAN.R-project.org/package=rstpm2">https://CRAN.R-project.org/package=rstpm2</a>. R package version 1.5.1.
</div>
<div id="ref-crowley1977covariance" class="csl-entry" role="doc-biblioentry">
J. Crowley and M. Hu. Covariance analysis of heart transplant survival data. <em>Journal of the American Statistical Association</em>, 72(357): 27–36, 1977.
</div>
<div id="ref-efron1988logistic" class="csl-entry" role="doc-biblioentry">
B. Efron. Logistic regression, survival analysis, and the kaplan-meier curve. <em>Journal of the American statistical Association</em>, 83(402): 414–425, 1988.
</div>
<div id="ref-efron1994introduction" class="csl-entry" role="doc-biblioentry">
B. Efron and R. J. Tibshirani. <em>An introduction to the bootstrap.</em> CRC press, 1994.
</div>
<div id="ref-fine1999proportional" class="csl-entry" role="doc-biblioentry">
J. P. Fine and R. J. Gray. A proportional hazards model for the subdistribution of a competing risk. <em>Journal of the American statistical association</em>, 94(446): 496–509, 1999.
</div>
<div id="ref-friedman2010jss" class="csl-entry" role="doc-biblioentry">
J. Friedman, T. Hastie and R. Tibshirani. Regularization paths for generalized linear models via coordinate descent. <em>Journal of Statistical Software</em>, 33(1): 2010. DOI <a href="https://doi.org/10.18637/jss.v033.i01">10.18637/jss.v033.i01</a>.
</div>
<div id="ref-gerds_blanche" class="csl-entry" role="doc-biblioentry">
T. A. Gerds and B. Ozenne. <em>riskRegression: Risk regression models and prediction scores for survival analysis with competing risks.</em> 2020. URL <a href="https://CRAN.R-project.org/package=riskRegression">https://CRAN.R-project.org/package=riskRegression</a>. R package version 2020.02.05.
</div>
<div id="ref-l1penal" class="csl-entry" role="doc-biblioentry">
J. J. Goeman. L1 penalized estimation in the cox proportional hazards model. <em>Biometrical Journal</em>, (52): –14, 2010.
</div>
<div id="ref-graf1999ass" class="csl-entry" role="doc-biblioentry">
E. Graf, C. Schmoor, W. Sauerbrei and M. Schumacher. Assessment and comparison of prognostic classification schemes for survival data. <em>Statistics in medicine</em>, 18(17-18): 2529–2545, 1999.
</div>
<div id="ref-hanley2010mortality" class="csl-entry" role="doc-biblioentry">
J. A. Hanley. Mortality reductions produced by sustained prostate cancer screening have been underestimated. <em>Journal of Medical Screening</em>, 17(3): 147–151, 2010.
</div>
<div id="ref-hanley2009fitting" class="csl-entry" role="doc-biblioentry">
J. A. Hanley and O. S. Miettinen. Fitting <span class="nocase">smooth-in-time</span> prognostic risk functions via logistic regression. <em>The International Journal of Biostatistics</em>, 5(1): 2009.
</div>
<div id="ref-hastie1987generalized" class="csl-entry" role="doc-biblioentry">
T. Hastie and R. Tibshirani. Generalized additive models: Some applications. <em>Journal of the American Statistical Association</em>, 82(398): 371–386, 1987.
</div>
<div id="ref-flexsurv" class="csl-entry" role="doc-biblioentry">
C. Jackson. <span class="nocase">flexsurv</span>: A platform for parametric survival modeling in <span>R</span>. <em>Journal of Statistical Software</em>, 70(8): 1–33, 2016. DOI <a href="https://doi.org/10.18637/jss.v070.i08">10.18637/jss.v070.i08</a>.
</div>
<div id="ref-kalbfleisch2011statistical" class="csl-entry" role="doc-biblioentry">
J. D. Kalbfleisch and R. L. Prentice. <em>The statistical analysis of failure time data.</em> John Wiley &amp; Sons, 2011.
</div>
<div id="ref-knaus1995support" class="csl-entry" role="doc-biblioentry">
W. A. Knaus, F. E. Harrell, J. Lynn, L. Goldman, R. S. Phillips, A. F. Connors, N. V. Dawson, W. J. Fulkerson, R. M. Califf, N. Desbiens, et al. The SUPPORT prognostic model: Objective estimates of survival for seriously ill hospitalized adults. <em>Annals of internal medicine</em>, 122(3): 191–203, 1995.
</div>
<div id="ref-liu2014recovering" class="csl-entry" role="doc-biblioentry">
Z. Liu, B. Rich and J. A. Hanley. Recovering the raw data behind a non-parametric survival curve. <em>Systematic reviews</em>, 3(1): 151, 2014.
</div>
<div id="ref-mahani2015bayesian" class="csl-entry" role="doc-biblioentry">
A. Mahani and M. Sharabiani. Bayesian, and non-<span>B</span>ayesian, cause-specific competing-risk analysis for parametric and nonparametric survival functions: The <span>R</span> package <span>CFC</span>. <em>Journal of Statistical Software</em>, 89(9): 1–29, 2019. DOI <a href="https://doi.org/10.18637/jss.v089.i09">10.18637/jss.v089.i09</a>.
</div>
<div id="ref-park_hastie" class="csl-entry" role="doc-biblioentry">
M. Y. Park and T. Hastie. <em>Glmpath: L1 regularization path for generalized linear models and cox proportional hazards model.</em> 2018. URL <a href="https://CRAN.R-project.org/package=glmpath">https://CRAN.R-project.org/package=glmpath</a>. R package version 0.98.
</div>
<div id="ref-reid1994conversation" class="csl-entry" role="doc-biblioentry">
N. Reid. A conversation with sir david cox. <em>Statistical Science</em>, 9(3): 439–455, 1994.
</div>
<div id="ref-saarela2016case" class="csl-entry" role="doc-biblioentry">
O. Saarela. A case-base sampling method for estimating recurrent event intensities. <em>Lifetime data analysis</em>, 22(4): 589–605, 2016.
</div>
<div id="ref-saarela2015non" class="csl-entry" role="doc-biblioentry">
O. Saarela and E. Arjas. Non-parametric <span>B</span>ayesian hazard regression for chronic disease risk assessment. <em>Scandinavian Journal of Statistics</em>, 42(2): 609–626, 2015.
</div>
<div id="ref-saarela2015case" class="csl-entry" role="doc-biblioentry">
O. Saarela and J. A. Hanley. Case-base methods for studying vaccination safety. <em>Biometrics</em>, 71(1): 42–52, 2015.
</div>
<div id="ref-scheike2014estimating" class="csl-entry" role="doc-biblioentry">
T. H. Scheike, K. K. Holst and J. B. Hjelmborg. Estimating twin concordance for bivariate competing risks twin data. <em>Statistics in medicine</em>, 33(7): 1193–1204, 2014.
</div>
<div id="ref-timereg" class="csl-entry" role="doc-biblioentry">
T. H. Scheike and M.-J. Zhang. Analyzing competing risk data using the <span>R</span> <span class="nocase">timereg</span> package. <em>Journal of Statistical Software</em>, 38(2): 1–15, 2011.
</div>
<div id="ref-schroder2009screening" class="csl-entry" role="doc-biblioentry">
F. H. Schröder, J. Hugosson, M. J. Roobol, T. L. Tammela, S. Ciatto, V. Nelen, M. Kwiatkowski, M. Lujan, H. Lilja, M. Zappa, et al. Screening and prostate-cancer mortality in a randomized <span>E</span>uropean study. <em>New England Journal of Medicine</em>, 360(13): 1320–1328, 2009.
</div>
<div id="ref-scrucca2010regression" class="csl-entry" role="doc-biblioentry">
L. Scrucca, A. Santucci and F. Aversa. Regression modeling of competing risk using <span>R</span>: An in depth guide for clinicians. <em>Bone marrow transplantation</em>, 45(9): 1388, 2010.
</div>
<div id="ref-regpathcox" class="csl-entry" role="doc-biblioentry">
N. Simon, J. Friedman, T. Hastie and R. Tibshirani. Regularization paths for <span>C</span>ox’s proportional hazards model via coordinate descent. <em>Journal of Statistical Software</em>, 39(5): 1–13, 2011.
</div>
<div id="ref-survival-package" class="csl-entry" role="doc-biblioentry">
T. M. Therneau. <em>A package for survival analysis in s.</em> 2015. URL <a href="https://CRAN.R-project.org/package=survival">https://CRAN.R-project.org/package=survival</a>. version 2.38.
</div>
<div id="ref-smoothHazard" class="csl-entry" role="doc-biblioentry">
C. Touraine, T. A. Gerds and P. Joly. <span>SmoothHazard</span>: An <span>R</span> package for fitting regression models to interval-censored observations of illness-death models. <em>Journal of Statistical Software</em>, 79(7): 1–22, 2017. DOI <a href="https://doi.org/10.18637/jss.v079.i07">10.18637/jss.v079.i07</a>.
</div>
<div id="ref-van2000asymptotic" class="csl-entry" role="doc-biblioentry">
A. W. Van der Vaart. <em>Asymptotic statistics.</em> Cambridge university press, 2000.
</div>
<div id="ref-whitehead1980fitting" class="csl-entry" role="doc-biblioentry">
J. Whitehead. Fitting cox’s regression model to survival data using GLIM. <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em>, 29(3): 268–275, 1980.
</div>
<div id="ref-ggplot2" class="csl-entry" role="doc-biblioentry">
H. Wickham. <em>ggplot2: Elegant graphics for data analysis.</em> Springer-Verlag New York, 2016. URL <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-zou2005regularization" class="csl-entry" role="doc-biblioentry">
H. Zou and T. Hastie. Regularization and variable selection via the elastic net. <em>Journal of the Royal Statistical Society: Series B (Methodological)</em>, 67(2): 301–320, 2005.
</div>
</div>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>The conditional chance of failure in a time interval of specified length is the same regardless of how long the individual has been in the study. This is also known as the <em>memoryless property</em> <span class="citation" data-cites="kalbfleisch2011statistical">(<a href="#ref-kalbfleisch2011statistical" role="doc-biblioref">Kalbfleisch and Prentice 2011</a>)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Specifically, it corresponds to the following parametrization for a multinomial random variable <span class="math inline">\(Y\)</span>: <span class="math display">\[\begin{align*} \log\left(\frac{P(Y=j \mid X)}{P(Y = J \mid X)}\right) = X^T\beta_j + log(1/\rho), \qquad j = 1,\ldots, J-1.\end{align*}\]</span><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The original data is available online from the Department of Biostatistics at Vanderbilt University: <a href="https://biostat.app.vumc.org/wiki/Main/SupportDesc" class="uri">https://biostat.app.vumc.org/wiki/Main/SupportDesc</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Bhatnagar*, et al., "The R Journal: casebase: An Alternative Framework for Survival Analysis and Comparison of Event Rates", The R Journal, 2022</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2022-052,
  author = {Bhatnagar*, Sahir Rai and Turgeon*, Maxime and Islam, Jesse and Hanley, James A. and Saarela, Olli},
  title = {The R Journal: casebase: An Alternative Framework for Survival Analysis and Comparison of Event Rates},
  journal = {The R Journal},
  year = {2022},
  note = {https://doi.org/10.32614/RJ-2022-052},
  doi = {10.32614/RJ-2022-052},
  volume = {14},
  issue = {3},
  issn = {2073-4859},
  pages = {59-79}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
