<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
      margin-bottom: 0em;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>pencal: an R Package for the Dynamic Prediction of Survival with Many Longitudinal Predictors</title>

<meta property="description" itemprop="description" content="In survival analysis, longitudinal information on the health status of&#10;a patient can be used to dynamically update the predicted probability&#10;that a patient will experience an event of interest. Traditional&#10;approaches to dynamic prediction such as joint models become&#10;computationally unfeasible with more than a handful of longitudinal&#10;covariates, warranting the development of methods that can handle a&#10;larger number of longitudinal covariates. We introduce the R package&#10;pencal, which implements a Penalized Regression Calibration (PRC)&#10;approach that makes it possible to handle many longitudinal covariates&#10;as predictors of survival. pencal uses mixed-effects models to&#10;summarize the trajectories of the longitudinal covariates up to a&#10;prespecified landmark time, and a penalized Cox model to predict&#10;survival based on both baseline covariates and summary measures of the&#10;longitudinal covariates. This article illustrates the structure of the&#10;R package, provides a step by step example showing how to estimate&#10;PRC, compute dynamic predictions of survival and validate performance,&#10;and shows how parallelization can be used to significantly reduce&#10;computing time."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2024-014/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2025-03-09"/>
<meta property="article:created" itemprop="dateCreated" content="2025-03-09"/>
<meta name="article:author" content="Mirko Signorelli"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="pencal: an R Package for the Dynamic Prediction of Survival with Many Longitudinal Predictors"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="In survival analysis, longitudinal information on the health status of&#10;a patient can be used to dynamically update the predicted probability&#10;that a patient will experience an event of interest. Traditional&#10;approaches to dynamic prediction such as joint models become&#10;computationally unfeasible with more than a handful of longitudinal&#10;covariates, warranting the development of methods that can handle a&#10;larger number of longitudinal covariates. We introduce the R package&#10;pencal, which implements a Penalized Regression Calibration (PRC)&#10;approach that makes it possible to handle many longitudinal covariates&#10;as predictors of survival. pencal uses mixed-effects models to&#10;summarize the trajectories of the longitudinal covariates up to a&#10;prespecified landmark time, and a penalized Cox model to predict&#10;survival based on both baseline covariates and summary measures of the&#10;longitudinal covariates. This article illustrates the structure of the&#10;R package, provides a step by step example showing how to estimate&#10;PRC, compute dynamic predictions of survival and validate performance,&#10;and shows how parallelization can be used to significantly reduce&#10;computing time."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2024-014/"/>
<meta property="og:image" content="https://journal.r-project.org/articles/RJ-2024-014/pencal-RJ_files/figure-latex/kaplan-1.png"/>
<meta property="og:image:width" content="1145"/>
<meta property="og:image:height" content="958"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="pencal: an R Package for the Dynamic Prediction of Survival with Many Longitudinal Predictors"/>
<meta property="twitter:description" content="In survival analysis, longitudinal information on the health status of&#10;a patient can be used to dynamically update the predicted probability&#10;that a patient will experience an event of interest. Traditional&#10;approaches to dynamic prediction such as joint models become&#10;computationally unfeasible with more than a handful of longitudinal&#10;covariates, warranting the development of methods that can handle a&#10;larger number of longitudinal covariates. We introduce the R package&#10;pencal, which implements a Penalized Regression Calibration (PRC)&#10;approach that makes it possible to handle many longitudinal covariates&#10;as predictors of survival. pencal uses mixed-effects models to&#10;summarize the trajectories of the longitudinal covariates up to a&#10;prespecified landmark time, and a penalized Cox model to predict&#10;survival based on both baseline covariates and summary measures of the&#10;longitudinal covariates. This article illustrates the structure of the&#10;R package, provides a step by step example showing how to estimate&#10;PRC, compute dynamic predictions of survival and validate performance,&#10;and shows how parallelization can be used to significantly reduce&#10;computing time."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2024-014/"/>
<meta property="twitter:image" content="https://journal.r-project.org/articles/RJ-2024-014/pencal-RJ_files/figure-latex/kaplan-1.png"/>
<meta property="twitter:image:width" content="1145"/>
<meta property="twitter:image:height" content="958"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="pencal: an R Package for the Dynamic Prediction of Survival with Many Longitudinal Predictors"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2024-014"/>
<meta name="citation_pdf_url" content="RJ-2024-014.pdf"/>
<meta name="citation_volume" content="16"/>
<meta name="citation_issue" content="2"/>
<meta name="citation_doi" content="10.32614/RJ-2024-014"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="134"/>
<meta name="citation_lastpage" content="153"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2025/03/09"/>
<meta name="citation_publication_date" content="2025/03/09"/>
<meta name="citation_author" content="Mirko Signorelli"/>
<meta name="citation_author_institution" content="Mathematical Institute, Leiden University"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Penalized regression calibration: A method for the prediction of survival outcomes using complex longitudinal and high-dimensional data;citation_volume=40;citation_author=M. Signorelli;citation_author=P. Spitali;citation_author=C. Al-Khalili Sgyziarto;citation_author=R. Tsonaka;citation_author=Penalized regression calibration: A method for the prediction of survival outcomes using complex longitudinal and high-dimensional data"/>
  <meta name="citation_reference" content="citation_title=Analysis of multivariate mixed longitudinal data: A flexible latent process approach;citation_publisher=Wiley Online Library;citation_volume=66;citation_author=Cécile Proust-Lima;citation_author=Hélène Amieva;citation_author=Hélène Jacqmin-Gadda"/>
  <meta name="citation_reference" content="citation_title=Generalized, Linear, and Mixed Models;citation_publisher=John Wiley &amp; Sons;citation_author=Charles E McCulloch;citation_author=Shayle R Searle"/>
  <meta name="citation_reference" content="citation_title=Estimation of extended mixed models using latent classes and latent processes: The R package cmm;citation_volume=78;citation_author=Cécile Proust-Lima;citation_author=Viviane Philipps;citation_author=Benoit Liquet"/>
  <meta name="citation_reference" content="citation_title=nlme: Linear and Nonlinear Mixed Effects Models;citation_author=José Pinheiro;citation_author=Douglas Bates;citation_author=nlme: Linear and Nonlinear Mixed Effects Models"/>
  <meta name="citation_reference" content="citation_title=Penalized likelihood in Cox regression;citation_publisher=Wiley Online Library;citation_volume=13;citation_author=Pierre JM Verweij;citation_author=Hans C Van Houwelingen"/>
  <meta name="citation_reference" content="citation_title=Time-dependent ROC curves for censored survival data and a diagnostic marker;citation_publisher=Wiley Online Library;citation_volume=56;citation_author=Patrick J Heagerty;citation_author=Thomas Lumley;citation_author=Margaret S Pepe"/>
  <meta name="citation_reference" content="citation_title=Overall C as a measure of discrimination in survival analysis: Model specific population value and confidence interval estimation;citation_publisher=Wiley Online Library;citation_volume=23;citation_author=Michael J Pencina;citation_author=Ralph B D’Agostino"/>
  <meta name="citation_reference" content="citation_title=Foreach: Provides foreach looping construct;citation_author=Steve Weston;citation_author=Foreach: Provides foreach looping construct"/>
  <meta name="citation_reference" content="citation_title=Linear mixed-effects model;citation_publisher=Springer;citation_author=Andrzej Gałecki;citation_author=Tomasz Burzykowski"/>
  <meta name="citation_reference" content="citation_title=Regularization and variable selection via the elastic net;citation_publisher=Wiley Online Library;citation_volume=67;citation_author=Hui Zou;citation_author=Trevor Hastie"/>
  <meta name="citation_reference" content="citation_title=Mixed-Effects Models in S and S-PLUS;citation_publisher=Springer;citation_author=José C. Pinheiro;citation_author=Douglas M. Bates"/>
  <meta name="citation_reference" content="citation_title=Assessment and comparison of prognostic classification schemes for survival data;citation_publisher=Wiley Online Library;citation_volume=18;citation_author=Erika Graf;citation_author=Claudia Schmoor;citation_author=Willi Sauerbrei;citation_author=Martin Schumacher"/>
  <meta name="citation_reference" content="citation_title=Random Forests for time-fixed and time-dependent predictors: The DynForest R package;citation_author=Anthony Devaux;citation_author=Cécile Proust-Lima;citation_author=Robin Genuer"/>
  <meta name="citation_reference" content="citation_title=The R package JMbayes for fitting joint models for longitudinal and time-to-event data using MCMC;citation_author=Dimitris Rizopoulos"/>
  <meta name="citation_reference" content="citation_title=joineRML: a joint model and software package for time-to-event and multivariate longitudinal outcomes;citation_publisher=Springer;citation_volume=18;citation_author=Graeme L Hickey;citation_author=Pete Philipson;citation_author=Andrea Jorgensen;citation_author=Ruwanthi Kolamunnage-Dona"/>
  <meta name="citation_reference" content="citation_title=JM: An R package for the joint modelling of longitudinal and time-to-event data;citation_volume=35;citation_author=Dimitris Rizopoulos"/>
  <meta name="citation_reference" content="citation_title=joineR: Joint Modelling of Repeated Measurements and Time-to-Event Data;citation_author=P Philipson;citation_author=I Sousa;citation_author=P Diggle;citation_author=P Williamson;citation_author=R Kolamunnage-Dona;citation_author=R Henderson;citation_author=G Hickey"/>
  <meta name="citation_reference" content="citation_title=Regularization paths for Cox’s proportional hazards model via coordinate descent;citation_publisher=NIH Public Access;citation_volume=39;citation_author=Noah Simon;citation_author=Jerome Friedman;citation_author=Trevor Hastie;citation_author=Rob Tibshirani"/>
  <meta name="citation_reference" content="citation_title=An empirical appraisal of methods for the dynamic prediction of survival with numerous longitudinal predictors;citation_author=Mirko Signorelli;citation_author=Sophie Retif"/>
  <meta name="citation_reference" content="citation_title=survivalROC: Time-Dependent ROC Curve Estimation from Censored Survival Data;citation_author=P J Heagerty;citation_author=P Saha-Chaudhuri"/>
  <meta name="citation_reference" content="citation_title=survcomp: an R/Bioconductor package for performance assessment and comparison of survival models;citation_publisher=Oxford University Press;citation_volume=27;citation_author=Markus S Schröder;citation_author=Aedı́n C Culhane;citation_author=John Quackenbush;citation_author=Benjamin Haibe-Kains"/>
  <meta name="citation_reference" content="citation_title=riskRegression: Risk Regression Models and Prediction Scores for Survival Analysis with Competing Risks;citation_author=Thomas Alexander Gerds;citation_author=Johan Sebastian Ohlendorff;citation_author=Brice Ozenne"/>
  <meta name="citation_reference" content="citation_title=Primary biliary cirrhosis: Prediction of short-term survival based on repeated patient visits;citation_publisher=Wiley Online Library;citation_volume=20;citation_author=Paul A Murtaugh;citation_author=E Rolland Dickson;citation_author=Gooitzen M Van Dam;citation_author=Michael Malinchoc;citation_author=Patricia M Grambsch;citation_author=Alice L Langworthy;citation_author=Chris H Gips"/>
  <meta name="citation_reference" content="citation_title=Clinical prediction models;citation_publisher=Springer;citation_author=E W Steyerberg"/>
  <meta name="citation_reference" content="citation_title=Modeling survival data: extending the Cox model;citation_publisher=Springer;citation_author=T M Therneau;citation_author=P M Grambsch"/>
  <meta name="citation_reference" content="citation_title=Joint modelling of longitudinal measurements and event time data;citation_publisher=Oxford University Press;citation_volume=1;citation_author=Robin Henderson;citation_author=Peter Diggle;citation_author=Angela Dobson"/>
  <meta name="citation_reference" content="citation_title=Dynamic prediction by landmarking in event history analysis;citation_publisher=Wiley Online Library;citation_volume=34;citation_author=Hans C Van Houwelingen"/>
  <meta name="citation_reference" content="citation_title=Landmarking 2.0: Bridging the gap between joint models and landmarking;citation_publisher=Wiley Online Library;citation_volume=41;citation_author=Hein Putter;citation_author=Hans C Houwelingen"/>
  <meta name="citation_reference" content="citation_title=pencal: Penalized Regression Calibration (PRC) for the Dynamic Prediction of Survival;citation_author=M. Signorelli"/>
  <meta name="citation_reference" content="citation_title=rbenchmark: Benchmarking routine for R;citation_author=Wacek Kusnierczyk"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","date_received","journal","volume","issue","slug","citation_url","packages","preview","bibliography","CTV","legacy_pdf","legacy_converted","output","draft","pdf_url","doi","creative_commons","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["pencal: an R Package for the Dynamic Prediction of Survival with Many Longitudinal Predictors"]},{"type":"character","attributes":{},"value":["In survival analysis, longitudinal information on the health status of\na patient can be used to dynamically update the predicted probability\nthat a patient will experience an event of interest. Traditional\napproaches to dynamic prediction such as joint models become\ncomputationally unfeasible with more than a handful of longitudinal\ncovariates, warranting the development of methods that can handle a\nlarger number of longitudinal covariates. We introduce the R package\npencal, which implements a Penalized Regression Calibration (PRC)\napproach that makes it possible to handle many longitudinal covariates\nas predictors of survival. pencal uses mixed-effects models to\nsummarize the trajectories of the longitudinal covariates up to a\nprespecified landmark time, and a penalized Cox model to predict\nsurvival based on both baseline covariates and summary measures of the\nlongitudinal covariates. This article illustrates the structure of the\nR package, provides a step by step example showing how to estimate\nPRC, compute dynamic predictions of survival and validate performance,\nand shows how parallelization can be used to significantly reduce\ncomputing time."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Mirko Signorelli"]},{"type":"character","attributes":{},"value":["Mathematical Institute, Leiden University"]},{"type":"character","attributes":{},"value":["Niels Bohrweg 1, 2333 CA Leiden (NL)","<https://mirkosignorelli.github.io>","*ORCiD: [0000-0002-8102-3356](https://orcid.org/0000-0002-8102-3356)*","[`msignorelli.papers@gmail.com`](mailto:msignorelli.papers@gmail.com)\n"]}]}]},{"type":"character","attributes":{},"value":["2025-03-09"]},{"type":"character","attributes":{},"value":["2023-11-20"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[134]},{"type":"integer","attributes":{},"value":[153]}]},{"type":"integer","attributes":{},"value":[16]},{"type":"integer","attributes":{},"value":[2]},{"type":"character","attributes":{},"value":["RJ-2024-014"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2024-014"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["survival","JM","JMbayes","joineR","joineRML","pencal","DynForest","nlme","lcmm","glmnet","survivalROC","riskRegression","foreach"]},{"type":"character","attributes":{},"value":["survcomp"]}]},{"type":"character","attributes":{},"value":["preview.png"]},{"type":"character","attributes":{},"value":["pencal-RJ.bib"]},{"type":"character","attributes":{},"value":["CausalInference","ChemPhys","ClinicalTrials","Cluster","Econometrics","Environmetrics","Finance","HighPerformanceComputing","MachineLearning","MixedModels","OfficialStatistics","Psychometrics","Spatial","SpatioTemporal","Survival"]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","mathjax","md_extension"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"]},{"type":"character","attributes":{},"value":["-tex_math_single_backslash"]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["RJ-2024-014.pdf"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2024-014"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["/home/mitchell/R/x86_64-pc-linux-gnu-library/4.4/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2024-014/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["comptime_sim4b.png","comptime_sims_123.png","pencal-RJ_files/figure-latex/kaplan-1.pdf","pencal-RJ_files/figure-latex/kaplan-1.png","pencal-RJ_files/figure-latex/spaghetti-1.pdf","pencal-RJ_files/figure-latex/spaghetti-1.png","pencal-RJ_files/figure-latex/survplot-1.pdf","pencal-RJ_files/figure-latex/survplot-1.png","pencal-RJ_files/figure-latex/unnamed-chunk-20-1.pdf","pencal-RJ.bib","pencal-RJ.tex","RJ-2024-014.zip","RJournal.sty","RJwrapper.log","RJwrapper.tex","table_data_1.csv"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.29/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Mathjax config (add automatic linebreaks when supported)
      // MathJax = {
      //    tex: {
      //        inlineMath: [['$', '$'], ['\\(', '\\)']],
      //        displayMath: [['$$', '$$'], ['\\[', '\\]']],
      //        tags: 'ams',
      //        multline: true,
      //    },
      //    options: {
      //        linebreaks: { automatic: true },
      //    },
      // };

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="' + slug + '.zip" class="dt-tag"><i class="fas fa-file-zipper"></i> Supplement</a>')

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").filter(function() {
        return !$(this).hasClass("subtitle");
      }).first();
      if (tpar) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append(tpar) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"pencal: an R Package for the Dynamic Prediction of Survival with Many Longitudinal Predictors","description":"In survival analysis, longitudinal information on the health status of\na patient can be used to dynamically update the predicted probability\nthat a patient will experience an event of interest. Traditional\napproaches to dynamic prediction such as joint models become\ncomputationally unfeasible with more than a handful of longitudinal\ncovariates, warranting the development of methods that can handle a\nlarger number of longitudinal covariates. We introduce the R package\npencal, which implements a Penalized Regression Calibration (PRC)\napproach that makes it possible to handle many longitudinal covariates\nas predictors of survival. pencal uses mixed-effects models to\nsummarize the trajectories of the longitudinal covariates up to a\nprespecified landmark time, and a penalized Cox model to predict\nsurvival based on both baseline covariates and summary measures of the\nlongitudinal covariates. This article illustrates the structure of the\nR package, provides a step by step example showing how to estimate\nPRC, compute dynamic predictions of survival and validate performance,\nand shows how parallelization can be used to significantly reduce\ncomputing time.","doi":"10.32614/RJ-2024-014","authors":[{"author":"Mirko Signorelli","authorURL":"#","affiliation":"Mathematical Institute, Leiden University","affiliationURL":"#","orcidID":""}],"publishedDate":"2025-03-09T00:00:00.000+00:00","citationText":"Signorelli, 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues/2024-4">Current</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../submissions.html">Submit</a>
<a href="../../editors.html">Editorial board</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>pencal: an R Package for the Dynamic Prediction of Survival with Many Longitudinal Predictors</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>In survival analysis, longitudinal information on the health status of
a patient can be used to dynamically update the predicted probability
that a patient will experience an event of interest. Traditional
approaches to dynamic prediction such as joint models become
computationally unfeasible with more than a handful of longitudinal
covariates, warranting the development of methods that can handle a
larger number of longitudinal covariates. We introduce the R package
pencal, which implements a Penalized Regression Calibration (PRC)
approach that makes it possible to handle many longitudinal covariates
as predictors of survival. pencal uses mixed-effects models to
summarize the trajectories of the longitudinal covariates up to a
prespecified landmark time, and a penalized Cox model to predict
survival based on both baseline covariates and summary measures of the
longitudinal covariates. This article illustrates the structure of the
R package, provides a step by step example showing how to estimate
PRC, compute dynamic predictions of survival and validate performance,
and shows how parallelization can be used to significantly reduce
computing time.</p></p>
</div>

<div class="d-byline">
  Mirko Signorelli  (Mathematical Institute, Leiden University)
  
<br/>2025-03-09
</div>

<div class="d-article">
<div class="article">
<h3 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h3>
<p>Risk prediction models <span class="citation" data-cites="steyerberg2009">(<a href="#ref-steyerberg2009" role="doc-biblioref">Steyerberg 2009</a>)</span> allow to estimate the
probability that an event of interest will occur in the future. Such
models are commonly employed in the biomedical field to estimate the
probability that an individual will experience an adverse event, and
their output can be used to inform patients, monitor their disease
progression, and guide treatment decisions.</p>
<p>Traditionally, risk prediction models only used covariate values
available at the beginning of the observation period to predict
survival. Thus, predictions based on such models could not exploit
information gathered at later time points. Because information about the
evolution of time-dependent covariates may influence the occurrence of
the survival outcome, it is desirable to be able to dynamically update
predictions of survival as more longitudinal information becomes
available.</p>
<p>Dynamic prediction models employ both baseline and follow-up information
to predict survival, and they can be used to update predictions each
time new follow-up data are gathered. Three commonly-used statistical
methods for dynamic prediction are the time-dependent Cox model, joint
modelling of longitudinal and survival data, and landmarking approaches.</p>
<p>The time-dependent Cox model <span class="citation" data-cites="therneau2000">(<a href="#ref-therneau2000" role="doc-biblioref">Therneau and Grambsch 2000</a>)</span> is an extension of the Cox
proportional hazards model that allows for the inclusion of
time-dependent covariates. It assumes the value of a time-dependent
covariate to be constant between two observation times, and it is only
suitable for exogenous time-dependent covariates. The model can be
estimated using the <code>R</code> package
<a href="https://CRAN.R-project.org/package=survival"><strong>survival</strong></a>
<span class="citation" data-cites="therneau2000">(<a href="#ref-therneau2000" role="doc-biblioref">Therneau and Grambsch 2000</a>)</span>.</p>
<p>Joint models for longitudinal and survival outcomes <span class="citation" data-cites="henderson2000">(<a href="#ref-henderson2000" role="doc-biblioref">Henderson et al. 2000</a>)</span> are
shared random effects models that combine a submodel for the
longitudinal covariates (typically linear mixed models) and one for the
survival outcome (usually a Cox model or a parametric survival model).
Thanks to the shared random effects formulation, such models are capable
to account for a possible interdependence between the longitudinal
covariates and the survival outcome. However, the estimation of the
shared random effects model is a computationally intensive task that has
so far restricted the application of joint models to problems with one
or few longitudinal covariates. Over the years, several alternative
approaches to the estimation of joint models have been proposed, among
which are the <code>R</code> packages
<a href="https://CRAN.R-project.org/package=JM"><strong>JM</strong></a> <span class="citation" data-cites="rizopoulos2010">(<a href="#ref-rizopoulos2010" role="doc-biblioref">Rizopoulos 2010</a>)</span>,
<a href="https://CRAN.R-project.org/package=JMbayes"><strong>JMbayes</strong></a>
<span class="citation" data-cites="rizopoulos2014">(<a href="#ref-rizopoulos2014" role="doc-biblioref">Rizopoulos 2014</a>)</span>,
<a href="https://CRAN.R-project.org/package=joineR"><strong>joineR</strong></a> <span class="citation" data-cites="philipson2018">(<a href="#ref-philipson2018" role="doc-biblioref">Philipson et al. 2018</a>)</span>
and <a href="https://CRAN.R-project.org/package=joineRML"><strong>joineRML</strong></a>
<span class="citation" data-cites="hickey2018">(<a href="#ref-hickey2018" role="doc-biblioref">Hickey et al. 2018</a>)</span>.</p>
<p>Lastly, landmarking <span class="citation" data-cites="vanhouwelingen2007">(<a href="#ref-vanhouwelingen2007" role="doc-biblioref">Van Houwelingen 2007</a>)</span> is an approach that
dynamically adjusts predictions by refitting the prediction model using
all subjects that are still at risk at a given landmark time.
Landmarking typically involves two modelling steps. In the first step,
repeated measurements of the time-dependent covariates up to the
landmark time are summarized using either a summary measure or a
suitable statistical model. In the second step, the summaries thus
computed are used as predictors of survival alongside with the
time-independent covariates. The simplest form of landmarking is the
last observation carried forward (LOCF) method, which uses the last
available measurement of each longitudinal covariate taken up to the
landmark time as summary. The main advantage of this approach is that it
is easy to implement, it is computationally straightforward and, thus,
it does not require the development of dedicated software. Limitations
of LOCF landmarking include the fact that it discards all previous
repeated measurements, failing to make efficient use of the available
longitudinal information, and it does not perform any measurement error
correction on the longitudinal covariates (this may be particularly
desirable for biomarkers and diagnostic tests that are typically subject
to measurement error). To overcome these limitations, mixed-effects
models can be used to model the trajectories of the longitudinal
covariates <span class="citation" data-cites="signorelli2021 putter2022 devaux2023">(<a href="#ref-signorelli2021" role="doc-biblioref">Signorelli et al. 2021</a>; <a href="#ref-putter2022" role="doc-biblioref">Putter and Houwelingen 2022</a>; <a href="#ref-devaux2023" role="doc-biblioref">Devaux et al. 2023</a>)</span>. While
<span class="citation" data-cites="putter2022">Putter and Houwelingen (<a href="#ref-putter2022" role="doc-biblioref">2022</a>)</span> focused on situations with a single longitudinal marker,
<span class="citation" data-cites="signorelli2021">Signorelli et al. (<a href="#ref-signorelli2021" role="doc-biblioref">2021</a>)</span> and <span class="citation" data-cites="devaux2023">Devaux et al. (<a href="#ref-devaux2023" role="doc-biblioref">2023</a>)</span> proposed two methods, respectively
called Penalized Regression Calibration (PRC) and DynForest, that can
deal with a large number of longitudinal covariates. Notably, the
estimation of PRC and DynForest is much more complex than that of LOCF
landmarking, warranting dedicated software that can facilitate the
implementation of such methods. PRC is implemented in the <code>R</code> package
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a>
<span class="citation" data-cites="signorelli2023">(<a href="#ref-signorelli2023" role="doc-biblioref">Signorelli 2023</a>)</span>, whereas DynForest in the <code>R</code> package
<a href="https://CRAN.R-project.org/package=DynForest"><strong>DynForest</strong></a>
<span class="citation" data-cites="devaux2023">(<a href="#ref-devaux2023" role="doc-biblioref">Devaux et al. 2023</a>)</span>.</p>
<p>In this article we introduce the <code>R</code> package
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a>, which
implements the PRC approach. PRC uses mixed-effects models to describe
and summarize the longitudinal biomarker trajectories; the summaries
thus obtained are used as predictors of survival in a Cox model
alongside with any relevant time-independent covariate. To account for
the possible availability of a large (potentially high-dimensional)
number of time-independent and longitudinal covariates and to reduce the
risk of overfitting the training data, PRC uses penalized maximum
likelihood to estimate the aforementioned Cox model.</p>
<p>The remainder of the article is organized as follow. In the next section
we describe the dynamic prediction problem, the PRC statistical
methodology <span class="citation" data-cites="signorelli2021">(<a href="#ref-signorelli2021" role="doc-biblioref">Signorelli et al. 2021</a>)</span> behind
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a>, and the problem
of evaluating the model’s predictive performance. Next we provide a
general overview of the <code>R</code> package, discussing the implementation
details of its functions for model estimation, prediction and
performance validation. Furthermore, we provide a step by step example
that shows how to use
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> to implement
dynamic prediction on a real-world dataset that comprises several
longitudinal covariates. We present the results of 4 simulations that
assess the relationship between computing time and sample size, number
of covariates and number of bootstrap samples used to validate model
performance, showing how parallelization may reduce computing time
significantly. Lastly, we provide some final remarks, and discuss
limitations and possible extensions of the current approach.</p>
<h3 data-number="2" id="statistical-methods"><span class="header-section-number">2</span> Statistical methods</h3>
<h4 class="unnumbered" data-number="2.1" id="input-data-and-notation">Input data and notation</h4>
<p>We consider a setting where <span class="math inline">\(n\)</span> subjects are followed from time <span class="math inline">\(t = 0\)</span>
until an event of interest occurs. For each subject
<span class="math inline">\(i \in \{1, ..., n\}\)</span> we observe the pair <span class="math inline">\((t_i, \delta_i)\)</span>, where
<span class="math inline">\(\delta_i\)</span> is a dummy variable that indicates whether the event is
observed at time <span class="math inline">\(t = t_i\)</span> (<span class="math inline">\(\delta_i = 1\)</span>), or the observation of the
event is right-censored at <span class="math inline">\(t = t_i\)</span> (<span class="math inline">\(\delta_i = 0\)</span>). Thus, <span class="math inline">\(t_i\)</span>
corresponds to the survival time if <span class="math inline">\(\delta_i = 1\)</span>, and to the censoring
time if <span class="math inline">\(\delta_i = 0\)</span>.</p>
<p>In addition to <span class="math inline">\((t_i, \delta_i)\)</span>, we assume that both baseline and
follow-up information is collected from the same subjects, and that the
number of variables gathered may be large. We consider a flexible
unbalanced study design where the number and timing of the follow-up
times can differ across subjects. We denote by <span class="math inline">\(m_i \geq 1\)</span> the number
of repeated measurements available for subject <span class="math inline">\(i\)</span>, and by
<span class="math inline">\(t_{i1}, ..., t_{i m_i} \:\: (t_{ij} \geq 0 \:\: \forall j)\)</span> the
corresponding follow-up times. For each subject <span class="math inline">\(i\)</span> we observe:</p>
<ol type="1">
<li><p>a vector of <span class="math inline">\(k\)</span> baseline (time-fixed) predictors
<span class="math inline">\(x_i = \left( x_{1i}, ..., x_{ki} \right)\)</span>;</p></li>
<li><p><span class="math inline">\(m_i\)</span> vectors of <span class="math inline">\(p\)</span> longitudinal (time-varying) predictors
<span class="math inline">\(y_{ij} = \left( y_{1ij}, ..., y_{pij} \right), \:\: j = 1,..., m_i\)</span>
measured at times <span class="math inline">\(t_{i1}, ..., t_{im_i}\)</span>. Note that not all
longitudinal predictors ought to be measured at every follow-up time
<span class="math inline">\(t_{ij}\)</span>, and the number of available measurements is thus allowed
to differ across longitudinal predictors.</p></li>
</ol>
<h4 class="unnumbered" data-number="2.2" id="dynamic-prediction-of-survival">Dynamic prediction of survival</h4>
<p>Let <span class="math inline">\(S_i(t) = P(T_i &gt; t)\)</span> denote the survival function, i.e., the
probability that subject <span class="math inline">\(i\)</span> has not experienced the event up to time
<span class="math inline">\(t\)</span>, and let
<span class="math inline">\(S_i(t_B | t_A) = P(T_i &gt; t_B | T_i &gt; t_A), \: t_B \geq t_A\)</span> denote the
conditional probability that subject <span class="math inline">\(i\)</span> survives up until <span class="math inline">\(t_B\)</span>, given
that they survived up until <span class="math inline">\(t_A\)</span>. Our goal is to predict the
probability of survival of subject <span class="math inline">\(i\)</span> given all the available
information up until a given landmark time <span class="math inline">\(t_L &gt; 0\)</span>, namely:</p>
<p><span class="math display" id="eq:cond-surv">\[S_i(t | t_L, x_i, \mathcal{Y}_i(t_L)) =  P(T_i &gt; t | T_i &gt; t_L, x_i, \mathcal{Y}_i(t_L)),
\label{eq:cond_surv}   \tag{1}\]</span></p>
<p>where <span class="math inline">\(\mathcal{Y}_i(t_L) = \{ y_{i1}, ..., y_{ir}: t_{ir} \leq t_L \}\)</span>
denotes all repeated measurements available up to the landmark time for
subject <span class="math inline">\(i\)</span>.</p>
<p>In practice, often one may be interested in computing the predictions of
survival in <a href="#eq:cond-surv">(1)</a> over a range of <span class="math inline">\(q\)</span> landmark times
<span class="math inline">\(t_{L1}, t_{L2}, ..., t_{Lq}\)</span>. By doing so, information from more and
more repeated measurements can be incorporated in the prediction model
as time passes, and predictions can be updated based on the latest
available information. This approach is referred to as <em>dynamic
prediction</em>, as it involves dynamic updates of model estimates and
predictions over time. In this article we illustrate how to use
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> to compute
predictions of the conditional survival probabilities in
<a href="#eq:cond-surv">(1)</a> for a single landmark time <span class="math inline">\(t_L\)</span>. Note that
implementing a dynamic prediction approach with
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> is
straightforward, as for each landmark time <span class="math inline">\(t_{Ls}\)</span> one simply needs to
refit PRC over a dataset that comprises all repeated measurements
available up until <span class="math inline">\(t = t_{Ls}\)</span> for the subjects that survived up until
the landmark time <span class="math inline">\(t_{Ls}\)</span> (i.e., including subject <span class="math inline">\(i\)</span> if and only if
<span class="math inline">\(t_i \geq t_{Ls}\)</span>).</p>
<h4 class="unnumbered" data-number="2.3" id="penalized-regression-calibration">Penalized regression calibration</h4>
<p>PRC <span class="citation" data-cites="signorelli2021">(<a href="#ref-signorelli2021" role="doc-biblioref">Signorelli et al. 2021</a>)</span> is a statistical method that makes it possible to
estimate the conditional survival probabilities in <a href="#eq:cond-surv">(1)</a>
using <span class="math inline">\(x_i\)</span> and <span class="math inline">\(\mathcal{Y}_i(t_L)\)</span> as inputs. The estimation of PRC
requires a multi-step procedure that comprises the 3 following steps:</p>
<ol type="1">
<li><p>model the evolution over time of the longitudinal predictors in
<span class="math inline">\(\mathcal{Y}_i(t_L)\)</span> using linear mixed models (LMM, <span class="citation" data-cites="mcculloch2004">McCulloch and Searle (<a href="#ref-mcculloch2004" role="doc-biblioref">2004</a>)</span>)
or multivariate latent process mixed models (MLPMM, <span class="citation" data-cites="proust2013">Proust-Lima et al. (<a href="#ref-proust2013" role="doc-biblioref">2013</a>)</span>);</p></li>
<li><p>use the model(s) fitted at step 1 to compute summaries of the
trajectories described by the longitudinal predictors (i.e., the
predicted random effects);</p></li>
<li><p>estimate a penalized Cox model for the survival outcome
<span class="math inline">\((t_i, \delta_i)\)</span> using as covariates both the baseline predictors
<span class="math inline">\(x_i\)</span> and the predicted random effects computed in step (2).</p></li>
</ol>
<p>For simplicity, in this section we describe the version of PRC where in
step 1 each longitudinal covariate is modelled using a separate LMM.
This version of the model is referred to as PRC LMM in <span class="citation" data-cites="signorelli2021">Signorelli et al. (<a href="#ref-signorelli2021" role="doc-biblioref">2021</a>)</span>.
Note that alongside with the PRC LMM approach, <span class="citation" data-cites="signorelli2021">Signorelli et al. (<a href="#ref-signorelli2021" role="doc-biblioref">2021</a>)</span> also
proposed a second approach called PRC MLPMM, where groups of
longitudinal covariates are modelled jointly using the MLPMM. This
alternative approach can be of interest when multiple longitudinal items
are employed to measure the same underlying quantity (for example,
multiple antibodies that target the same protein). For the formulation
of the PRC MLPMM approach, we refer readers to Sections 2.1-2.3 of
<span class="citation" data-cites="signorelli2021">Signorelli et al. (<a href="#ref-signorelli2021" role="doc-biblioref">2021</a>)</span> as the notation for steps 1 and 2 using the MLPMM is
significantly more involved.</p>
<p>Denote by <span class="math inline">\(\mathcal{I}(t_L) = \{ i: t_i &gt; t_L \}\)</span> the set of subjects
that survived up until the landmark time <span class="math inline">\(t_L\)</span>. Let
<span class="math inline">\(y_{si} = (y_{si1}, ..., y_{sir})\)</span>, where <span class="math inline">\(t_{ir} \leq t_L\)</span> denotes the
last follow-up time before <span class="math inline">\(t_L\)</span> for subject <span class="math inline">\(i\)</span>, be the vector that
comprises all the measurements of the <span class="math inline">\(s\)</span>-th longitudinal variable <span class="math inline">\(Y_s\)</span>
available up to the landmark time. In the first step of PRC, we model
the evolution over time of each longitudinal covariate <span class="math inline">\(Y_s\)</span> through a
linear regression model</p>
<p><span class="math display" id="eq:lmm">\[y_{si} = W_{si} \beta_s + Z_{si} u_{si} + \varepsilon_{si}, \: i \in \mathcal{I}(t_L),
\label{eq:lmm}   \tag{2}\]</span></p>
<p>where <span class="math inline">\(\beta_s\)</span> is a vector of fixed effect parameters,
<span class="math inline">\(u_{si} \sim N(0, D_s)\)</span> is a vector of random effects,
<span class="math inline">\(\varepsilon_{si} \sim N(0, \sigma^2_s I_{m_i})\)</span> is the error term
vector, and <span class="math inline">\(W_{si}\)</span> and <span class="math inline">\(Z_{si}\)</span> are design matrices associated to
<span class="math inline">\(\beta_s\)</span> and <span class="math inline">\(u_{si}\)</span>. As an example, later in this article we will
consider an example where we let <span class="math inline">\(y_{si}\)</span> depend on the age <span class="math inline">\(a_{ij}\)</span> of
subject <span class="math inline">\(i\)</span> at each visit, and include a random intercept and random
slope in the LMM:</p>
<p><span class="math display" id="eq:lmmwithslope">\[y_{sij} = \beta_{s0} + u_{si0} + \beta_{s1} a_{ij} + u_{si1} a_{ij} + \varepsilon_{sij},
\label{eq:lmmwithslope}   \tag{3}\]</span></p>
<p>where <span class="math inline">\((u_{s0}, u_{s1})^T \sim N(0, D_s)\)</span> is a vector of random effects
that follows a bivariate normal distribution. We employ maximum
likelihood (ML) estimation to estimate <span class="math inline">\(\beta_s\)</span>, <span class="math inline">\(D_s\)</span> and <span class="math inline">\(\sigma^2_s\)</span>
in model <a href="#eq:lmm">(2)</a>.</p>
<p>In the second step of PRC, we use the ML estimates from step 1 to derive
summaries of the individual longitudinal trajectories for each
biomarker. These are the predicted random effects, which can be computed
as</p>
<p><span class="math display" id="eq:predranef">\[\hat{u}_{si} =E(u_{si} | Y_{si} = y_{si}) =
\hat{D}_s Z_{si}^T \hat{V}_{si}^{-1} (y_{si} - X_{si} \hat{\beta}_s),
\label{eq:predranef}   \tag{4}\]</span></p>
<p>where <span class="math inline">\(\hat{V}_{si} = Z_{si} \hat{D}_s Z_{si}^T + \hat{\sigma}^2_s I\)</span>.</p>
<p>In the third step of PRC, we model the relationship between the survival
outcome and the baseline and longitudinal predictors. This is achieved
through the specification of a Cox model where we include the baseline
predictors <span class="math inline">\(x_i\)</span> and the summaries of the longitudinal predictors
<span class="math inline">\(\hat{u}_i = (\hat{u}_{1i}, ..., \hat{u}_{pi})\)</span> as covariates:</p>
<p><span class="math display" id="eq:cox">\[h(t_i | x_i, \hat{u}_i) = h_0(t_i) \exp \left( \gamma x_i + \delta \hat{u}_i \right),
\label{eq:cox}   \tag{5}\]</span></p>
<p>where <span class="math inline">\(h_0(t_i)\)</span> is the baseline hazard function, and <span class="math inline">\(\gamma\)</span> and
<span class="math inline">\(\delta\)</span> are vectors of regression coefficients. Since our approach
allows for the inclusion of a potentially large number of baseline and
longitudinal covariates, we estimate model <a href="#eq:cox">(5)</a> using penalized
maximum likelihood (PML, <span class="citation" data-cites="verweij1994">Verweij and Van Houwelingen (<a href="#ref-verweij1994" role="doc-biblioref">1994</a>)</span>). As penalties we consider the
ridge (<span class="math inline">\(L_2\)</span>), lasso (<span class="math inline">\(L_1\)</span>) and elasticnet penalties. The elasticnet
penalty for model <a href="#eq:cox">(5)</a> is given by</p>
<p><span class="math display" id="eq:elasticnet">\[\lambda  \left[
\alpha \left( \sum_{s=1}^p |\gamma_s| + \sum_{s=1}^p |\delta_s| \right)
+ (1 - \alpha) \left( \sum_{s=1}^p \gamma_s^2 + \sum_{s=1}^p \delta_s^2 \right)
\right],
\label{eq:elasticnet}   \tag{6}\]</span></p>
<p>where <span class="math inline">\(\lambda \geq 0\)</span> and <span class="math inline">\(\alpha \in [0, 1]\)</span>. The ridge penalty is
obtained by setting <span class="math inline">\(\alpha = 0\)</span>, and the lasso penalty by fixing
<span class="math inline">\(\alpha = 1\)</span>.</p>
<h4 class="unnumbered" data-number="2.4" id="computation-of-the-predicted-survival-probabilities">Computation of the predicted survival probabilities</h4>
<p>Once models <a href="#eq:lmm">(2)</a> and <a href="#eq:cox">(5)</a> have been estimated, the
predicted survival probabilities <span class="math inline">\(S_i(t | t_L, x_i, \mathcal{Y}_i(t_L))\)</span>
are computed using</p>
<p><span class="math display" id="eq:predsurv">\[\hat{S}_i(t | t_L, x_i, \mathcal{Y}_i(t_L)) =
\exp \left(
- \int_0^t \hat{h}_0(s) \exp( \hat{\gamma} x_i + \hat{\delta} \hat{u}_i )
\right),
\label{eq:predsurv}   \tag{7}\]</span></p>
<p>where <span class="math inline">\(\hat{h}_0(s)\)</span> is the estimated baseline hazard function,
<span class="math inline">\(\hat{\gamma}\)</span> and <span class="math inline">\(\hat{\delta}\)</span> are the PML estimates of <span class="math inline">\(\gamma\)</span> and
<span class="math inline">\(\delta\)</span> obtained in step 3, and <span class="math inline">\(\hat{u}_i\)</span> contains the predicted
random effects computed in step 2.</p>
<p>For subjects <span class="math inline">\(i \in \mathcal{I}(t_L)\)</span>, who are included in the training
set and survived up until <span class="math inline">\(t_L\)</span>, computation of <a href="#eq:predsurv">(7)</a> is
straightforward, since the predicted random effects <span class="math inline">\(\hat{u}_i\)</span> for such
subjects have already been computed in step 2. Predictions of
<span class="math inline">\(S_i(t | t_L, x_i, \mathcal{Y}_i(t_L))\)</span> for a new subject <span class="math inline">\(i = n + 1\)</span>
who survived up until <span class="math inline">\(t_L\)</span>, but was not part of the training set is a
bit more complex: before computing <a href="#eq:predsurv">(7)</a>, one first needs
to compute the predicted random effects for this new subject using
<a href="#eq:predranef">(4)</a>. Note that such computation is feasible if and only
if measurements of both baseline and longitudinal covariates (up to
<span class="math inline">\(t_L\)</span>) are available for this new subject.</p>
<h4 class="unnumbered" data-number="2.5" id="evaluation-of-the-predictive-performance">Evaluation of the predictive performance</h4>
<p>We consider the time-dependent area under the ROC curve (tdAUC,
<span class="citation" data-cites="heagerty2000">Heagerty et al. (<a href="#ref-heagerty2000" role="doc-biblioref">2000</a>)</span>), the concordance index or C index <span class="citation" data-cites="pencina2004">(<a href="#ref-pencina2004" role="doc-biblioref">Pencina and D’Agostino 2004</a>)</span> and the
Brier score <span class="citation" data-cites="graf1999">(<a href="#ref-graf1999" role="doc-biblioref">Graf et al. 1999</a>)</span> as measures of predictive performance. To obtain
unbiased estimates of these performance measures, <span class="citation" data-cites="signorelli2021">Signorelli et al. (<a href="#ref-signorelli2021" role="doc-biblioref">2021</a>)</span>
proposed a cluster bootstrap optimism correction procedure (CBOCP) that
generalizes the use of the bootstrap as internal validation method to
problems involving repeated measurement data. As an alternative to the
CBOCP, one may choose to implement a cross-validation approach instead.
Should the user opt for such an alternative, we recommend the use of
repeated cross-validation over simple cross-validation to achieve a
level of accuracy comparable to that of the CBOCP.</p>
<h3 data-number="3" id="the-r-package-pencal"><span class="header-section-number">3</span> The <code>R</code> package <code>pencal</code></h3>
<p>In this Section we introduce the functions for the estimation of PRC,
the computation of the predicted survival probabilities and the
validation of predictive performance, providing an overview of the
relevant estimation approaches and some important implementation
details.</p>
<p>Table <a href="#tab:functions">1</a> provides a side-by-side overview of the
functions that can be used to implement the PRC LMM and PRC MLPMM
approaches. Note that while two different functions (one for each
approach) are needed for the three estimation steps and the computation
of the survival probabilities, the evaluation of the predictive
performance is implemented in a single function that works with inputs
from both approaches.</p>
<table>
<caption><span id="tab:functions">Table 1: </span> Overview of the pencal functions that implement the different modelling steps for the PRC LMM and PRC MLPMM approaches.</caption>
<colgroup>
<col style="width: 57%" />
<col style="width: 21%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Task</strong></th>
<th><strong>PRC LMM</strong></th>
<th><strong>PRC MLPMM</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Step 1: estimate the mixed-effects models</td>
<td>fit_lmms</td>
<td>fit_mlpmms</td>
</tr>
<tr class="even">
<td>Step 2: compute the predicted random effects</td>
<td>summarize_lmms</td>
<td>summarize_mlpmms</td>
</tr>
<tr class="odd">
<td>Step 3: estimate the penalized Cox model</td>
<td>fit_prclmm</td>
<td>fit_prcmlpmm</td>
</tr>
<tr class="even">
<td>Computation of predicted survival probabilities</td>
<td>survpred_prclmm</td>
<td>survpred_prcmlpmm</td>
</tr>
<tr class="odd">
<td>Evaluation of predictive performance</td>
<td>performance_prc</td>
<td>performance_prc</td>
</tr>
</tbody>
</table>
<h4 class="unnumbered" data-number="3.1" id="model-estimation-and-prediction">Model estimation and prediction</h4>
<p>The first step of PRC involves the estimation of mixed-effects models
for the longitudinal outcomes. For the PRC LMM approach, this can be
done through the <code>fit_lmms</code> function, that proceeds to estimate <span class="math inline">\(p\)</span> LMMs
(one LMM for each of the longitudinal outcomes). Estimation of the LMMs
is performed by maximum likelihood through the <code>lme</code> function from the
<code>R</code> package <a href="https://CRAN.R-project.org/package=nlme"><strong>nlme</strong></a>
<span class="citation" data-cites="pinheiro2000">(<a href="#ref-pinheiro2000" role="doc-biblioref">Pinheiro and Bates 2000</a>)</span>. For the PRC MLPMM approach, the first step involves
estimating one MLPMM for each group of longitudinal covariates.
Estimation of the MLPMMs is done by maximum likelihood using the
modified Marquardt algorithm described in <span class="citation" data-cites="proust2013">Proust-Lima et al. (<a href="#ref-proust2013" role="doc-biblioref">2013</a>)</span>, as implemented in
the <code>multlcmm</code> from the <code>R</code> package
<a href="https://CRAN.R-project.org/package=lcmm"><strong>lcmm</strong></a> <span class="citation" data-cites="proust2017">(<a href="#ref-proust2017" role="doc-biblioref">Proust-Lima et al. 2017</a>)</span>.</p>
<p>The second step of PRC requires the computation of the predicted random
effects. The function <code>summarize_lmms</code> implements this for the PRC LMM
approach. The function takes the output of <code>fit_lmms</code> as input, and
proceeds to the computation of the predicted random effects using
equation <a href="#eq:predranef">(4)</a>. Similarly, the function <code>summarize_mlpmms</code>
does the same for the PRC MLPMM approach by taking the output of
<code>fit_mlpmms</code> as input and computing the predicted random effects using
the formula given in equation (4) of <span class="citation" data-cites="signorelli2021">Signorelli et al. (<a href="#ref-signorelli2021" role="doc-biblioref">2021</a>)</span>.</p>
<p>The third step of PRC requires the estimation of a Cox model where the
baseline covariates and the predicted random effects are used as
covariates.Estimation of such model can be performed using the function
<code>fit_prclmm</code> for the PRC LMM approach and <code>fit_prcmlpmm</code> for the PRC
MLPMM approach. These functions proceed to the estimation of the
aforementioned Cox model by penalized maximum likelihood through the
function <code>cv.glmnet</code> from the <code>R</code> package
<a href="https://CRAN.R-project.org/package=glmnet"><strong>glmnet</strong></a> <span class="citation" data-cites="simon2011">(<a href="#ref-simon2011" role="doc-biblioref">Simon et al. 2011</a>)</span>. If
the user chooses the ridge or lasso penalty, then the selection of the
value of the tuning parameter <span class="math inline">\(\lambda\)</span> is performed through
cross-validation as implemented in
<a href="https://CRAN.R-project.org/package=glmnet"><strong>glmnet</strong></a>. If, instead,
the elasticnet penalty is used, <code>fit_prclmm</code> and <code>fit_prcmlpmm</code> proceed
to perform a nested cross-validation procedure to jointly select the
optimal values of the tuning parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\lambda\)</span>.</p>
<p>Lastly, the function <code>survpred_prclmm</code> can be used to compute the
predicted survival probabilities as described in equation
<a href="#eq:predsurv">(7)</a> for the PRC LMM approach. The corresponding function
for the PRC MLPMM approach is <code>survpred_prcmlpmm</code>.</p>
<h4 class="unnumbered" data-number="3.2" id="computation-of-the-cbocp">Computation of the CBOCP</h4>
<p>In <code>pencal</code>, the evaluation of the predictive performance of the fitted
model is done by estimating the tdAUC, C index and Brier score through
the CBOCP described in <span class="citation" data-cites="signorelli2021">Signorelli et al. (<a href="#ref-signorelli2021" role="doc-biblioref">2021</a>)</span>. For both the PRC LMM and PRC
MLPMM approaches, this can be done through the function
<code>performance_prc</code>. The estimates of the tDAUC, C index and Brier score
are computed using functions from the packages
<a href="https://CRAN.R-project.org/package=survivalROC"><strong>survivalROC</strong></a>
<span class="citation" data-cites="heagerty2022">(<a href="#ref-heagerty2022" role="doc-biblioref">Heagerty and Saha-Chaudhuri 2022</a>)</span>,
<a href="https://www.bioconductor.org/packages/release/bioc/html/survcomp.html"><strong>survcomp</strong></a>
<span class="citation" data-cites="schroder2011">(<a href="#ref-schroder2011" role="doc-biblioref">Schröder et al. 2011</a>)</span> and
<a href="https://CRAN.R-project.org/package=riskRegression"><strong>riskRegression</strong></a>
<span class="citation" data-cites="gerds2022">(<a href="#ref-gerds2022" role="doc-biblioref">Gerds et al. 2023</a>)</span>, respectively.</p>
<p>The computation of the CBOCP requires the choice of the number of
bootstrap replicates <span class="math inline">\(B\)</span> over which the model should be refitted. This
can be done by specifying the argument <code>n.boots</code> inside the functions
that implement the first step of PRC, namely <code>fit_lmms</code> for the PRC LMM
approach and <code>fit_mlpmms</code> for the PRC MLPMM one. The supplied value of
<code>n.boots</code> is stored in the output of such functions, and all subsequent
functions inherit this value, automatically performing the computations
necessary for the CBOCP.</p>
<p>If <code>n.boots = 0</code> (default), the CBOCP is not computed, and
<code>performance_prc</code> only returns the naïve estimates of predictive
performance. Values of <code>n.boots</code> <span class="math inline">\(\geq 1\)</span> will trigger the computation
of the CBOCP, and the output of <code>performance_prc</code> will additionally
include the estimates of the optimism and the optimism-corrected
performance measures. A typical value for <span class="math inline">\(B\)</span> is 100, but in general we
recommend setting <span class="math inline">\(B\)</span> to a value between 50 and 200 (depending on
computing time and the desired level of accuracy, one may also consider
larger values of <span class="math inline">\(B\)</span>).</p>
<h4 class="unnumbered" data-number="3.3" id="user-friendly-parallelization">User-friendly parallelization</h4>
<p>The computation of the CBOCP is by nature repetitive, as it requires to
repeat steps 1, 2 and 3 over <span class="math inline">\(B\)</span> bootstrap samples, and to compute
predictions and performance measures both on the bootstrap sample and on
the original dataset to estimate the optimism. Due to this
repetitiveness, such computations can be easily parallelized to reduce
computing time. Moreover, also the estimation of the <span class="math inline">\(p\)</span> LMMs / MLPMMs
in step 1 can be trivially parallelized.</p>
<p>With the goal of making it as easy as possible for users to parallelize
such computations, the functions in Table <a href="#tab:functions">1</a>
automatically parallelize the aforementioned computations using the
<code>%dopar%</code> operator from the <code>R</code> package
<a href="https://CRAN.R-project.org/package=foreach"><strong>foreach</strong></a>
<span class="citation" data-cites="foreach2022">(<a href="#ref-foreach2022" role="doc-biblioref">Microsoft and Weston 2022</a>)</span>. The user only needs to specify the number of cores they
want to use for the computation using the argument <code>n.cores</code>;
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> will
automatically take care of the parallelization.</p>
<h4 class="unnumbered" data-number="3.4" id="classes-methods-and-further-functionalities">Classes, methods and further functionalities</h4>
<p>Besides the core functions introduced in Table <a href="#tab:functions">1</a>,
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> comprises
additional functions that are shortly described hereafter.</p>
<p>Three functions are used to simulate the data that are used in the
package documentation to illustrate typical usage of
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a>’s functions. The
function <code>simulate_t_weibull</code> is used to generate survival times from a
Weibull distribution using the inverse transformation method. The
functions <code>simulate_prclmm_data</code> and <code>simulate_prcmlpmm_data</code> are used
to generate data for the estimation of PRC LMM and PRC MLPMM,
respectively.</p>
<p>S3 classes and methods are implemented for the outputs of each modelling
step:</p>
<ul>
<li><p>step 1: <code>fit_lmms</code> and <code>fit_mlpmms</code> return objects of class <code>lmmfit</code>
and <code>mplmmfit</code>, respectively. As the number of longitudinal
covariates increases, step 1 of PRC will involve the estimation of
many mixed-effects models: to simplify the extraction of the
estimates of each mixed model, we provide two summary functions,
<code>summary.lmmfit</code> and <code>summary.mlpmmfit</code>;</p></li>
<li><p>step 2: <code>summarize_lmms</code> and <code>summarize_mlpmms</code> return objects of
class <code>ranefs</code>, for which a <code>summary.ranefs</code> function is available;</p></li>
<li><p>step 3: <code>fit_prclmm</code> outputs an object of class <code>prclmm</code>, and
<code>fit_prcmlpmm</code> one of class <code>prcmlpmm</code>. For both classes, <code>summary</code>
methods (<code>summary.prclmm</code> and <code>summary.mlpmmfit</code>, respectively) are
implemented.</p></li>
</ul>
<p>Lastly, it may be sometimes of interest to compare the performance of
PRC to that of either a penalized Cox model that only uses baseline
values of all covariates, or a penalized Cox model with LOFC
landmarking. The <code>pencox_baseline</code> function provides an interface to
estimate these two models and to compute the associated CBOCP. Its
output can be fed to the function <code>performance_pencox_baseline</code> to
obtain the naïve and optimism-corrected estimates of the tdAUC, C index
and Brier score for these two models.</p>
<h3 data-number="4" id="dynamic-prediction-with-pencal-a-step-by-step-example"><span class="header-section-number">4</span> Dynamic prediction with <code>pencal</code>: a step by step example</h3>
<h4 class="unnumbered" data-number="4.1" id="loading-pbc2data">Loading <code>pbc2data</code></h4>
<p>To illustrate how to use
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> in practice, we
employ data from a study from a clinical trial on primary biliary
cholangitis (PBC) conducted by the Mayo Clinic from 1974 to 1984
<span class="citation" data-cites="murtaugh1994">(<a href="#ref-murtaugh1994" role="doc-biblioref">Murtaugh et al. 1994</a>)</span>. The trial recorded the first of two survival outcomes,
namely liver transplantation or death. In this example we focus our
attention on the prediction of deaths, treating patients who underwent
liver transplantation as right-censored. The data are available in
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> in a list called
<code>pbc2data</code> that can be loaded as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pencal)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(pbc2data)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(pbc2data)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;baselineInfo&quot;     &quot;longitudinalInfo&quot;</span></span></code></pre></div>
<p><code>pbc2data</code> contains two data frames: <code>baselineInfo</code> records the survival
information <span class="math inline">\((t_i, \delta_i)\)</span> and baseline covariates <span class="math inline">\(x_i\)</span>, whereas
<code>longitudinalInfo</code> contains repeated measurements of the longitudinal
predictors <span class="math inline">\(y_i\)</span>. For simplicity, we rename the two data frames as
<code>sdata</code> and <code>ldata</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sdata <span class="ot">=</span> pbc2data<span class="sc">$</span>baselineInfo</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ldata <span class="ot">=</span> pbc2data<span class="sc">$</span>longitudinalInfo</span></code></pre></div>
<h4 class="unnumbered" data-number="4.2" id="input-data-format">Input data format</h4>
<p>As detailed in the Statistical Methods section, estimation of PRC
requires the following input data for each subject <span class="math inline">\(i = 1, ..., n\)</span>:</p>
<ul>
<li><p>a pair <span class="math inline">\((t_i, \delta_i)\)</span> providing the survival outcome for subject
<span class="math inline">\(i = 1\)</span>;</p></li>
<li><p>a vector of <span class="math inline">\(k\)</span> baseline covariates <span class="math inline">\(x_i\)</span>;</p></li>
<li><p>an <span class="math inline">\(m_i \times p\)</span> matrix containing all repeated measurements of the
<span class="math inline">\(p\)</span> longitudinal predictors. Within this matrix each column
corresponds to a predictor, and each row to the measurements
<span class="math inline">\(y_{ij}\)</span> collected at time <span class="math inline">\(t_{ij}, \: j \in \{1, ..., m_i \}\)</span> for
subject <span class="math inline">\(i\)</span>;</p></li>
<li><p>any longitudinal covariate needed to construct the design matrices
<span class="math inline">\(W_{si}\)</span> and <span class="math inline">\(Z_{si}\)</span> that will be used to estimate the LMMs of
equation <a href="#eq:lmm">(2)</a>.</p></li>
</ul>
<p>Such data should be provided to
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> using two data
frames. The first data frame is a data frame that contains information
on the survival outcomes <span class="math inline">\((t_i, \delta_i)\)</span> and the baseline covariates
<span class="math inline">\(x_i\)</span>. For the PBC2 example, this is the <code>sdata</code> data frame created
above:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sdata)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id      time event baselineAge    sex treatment</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   1  1.095170     1    58.76684 female D-penicil</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   2 14.152338     0    56.44782 female D-penicil</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12  3  2.770781     1    70.07447   male D-penicil</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16  4  5.270507     1    54.74209 female D-penicil</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 23  5  4.120578     0    38.10645 female   placebo</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 29  6  6.853028     1    66.26054 female   placebo</span></span></code></pre></div>
<p>This data frame should comprise at least 3 variables: a variable named
<code>id</code> that contains subject identifiers, a variable named <code>time</code>
containing the values of <span class="math inline">\(t_i\)</span>, and a dummy variable named <code>event</code> that
corresponds to <span class="math inline">\(\delta_i\)</span> (<code>event = 1</code> for subjects who experience the
event at <span class="math inline">\(t_i\)</span>, and event = 0 for right-censored observations).
Additionally, it can also contain the baseline covariates <span class="math inline">\(x_i\)</span> (if
any); in the example we have <span class="math inline">\(k = 3\)</span> baseline covariates: <code>baselineAge</code>,
<code>sex</code> and <code>treatment</code>.</p>
<p>The second data frame is a dataset in long format that contains the
repeated measurements of the longitudinal predictors <span class="math inline">\(y_{ij}\)</span> and of any
covariate needed to create the design matrices <span class="math inline">\(W_{si}\)</span> and <span class="math inline">\(Z_{si}\)</span>. In
our example application, such information is stored in <code>ldata</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ldata)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id      age   fuptime serBilir serChol albumin alkaline  SGOT platelets</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1 58.76684 0.0000000     14.5     261    2.60     1718 138.0       190</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  1 59.29252 0.5256817     21.3      NA    2.94     1612   6.2       183</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  2 56.44782 0.0000000      1.1     302    4.14     7395 113.5       221</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  2 56.94612 0.4983025      0.8      NA    3.60     2107 139.5       188</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  2 57.44716 0.9993429      1.0      NA    3.55     1711 144.2       161</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  2 58.55054 2.1027270      1.9      NA    3.92     1365 144.2       122</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   prothrombin</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1        12.2</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2        11.2</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3        10.6</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4        11.0</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5        11.6</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6        10.6</span></span></code></pre></div>
<p>This “longitudinal” data frame should contain the following information:</p>
<ul>
<li><p>a variable named <code>id</code> that contains subject identifiers;</p></li>
<li><p>a variable containing the time from baseline <span class="math inline">\(t_{ij}\)</span> at which the
measurement was collected. In <code>ldata</code>, we called this variable
<code>fuptime</code> (short for: follow-up time). Notice that if the
longitudinal covariates are measured at <span class="math inline">\(t_{ij} = 0\)</span>, a row with
<code>fuptime = 0</code> must be included in <code>ldata</code>;</p></li>
<li><p>the <span class="math inline">\(p\)</span> longitudinal predictors (<code>serBilir</code>, <code>serChol</code>, <code>albumin</code>,
<code>alkaline</code>, <code>SGOT</code>, <code>platelets</code> and <code>prothrombin</code> in the example);</p></li>
<li><p>the covariates needed to construct <span class="math inline">\(W_{si}\)</span> and <span class="math inline">\(Z_{si}\)</span> (<code>age</code> in
the example).</p></li>
</ul>
<h4 class="unnumbered" data-number="4.3" id="choice-of-the-landmark-time-and-data-preparation">Choice of the landmark time and data preparation</h4>
<p>Before proceeding with the estimation of PRC and the computation of the
predicted survival probabilities
<span class="math inline">\(S_i(t | t_L, x_i, \mathcal{Y}_i(t_L))\)</span>, three preliminary steps are
needed. The first involves the choice of the landmark time <span class="math inline">\(t_L\)</span>.
Hereafter we choose <span class="math inline">\(t_L = 2\)</span> years, meaning that we want to predict the
survival probability <span class="math inline">\(S(t | t_L = 2, x_i, \mathcal{Y}_i(2))\)</span> for a
subject with baseline covariates <span class="math inline">\(x_i\)</span> and longitudinal covariates
measured up until two years from baseline <span class="math inline">\(\mathcal{Y}_i(2)\)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the landmark time</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lmark <span class="ot">=</span> <span class="dv">2</span></span></code></pre></div>
<p>Once <span class="math inline">\(t_L\)</span> has been chosen, the second step is to retain for analysis
only those subjects that survived up until the landmark time, i.e. all
<span class="math inline">\(i: t_i \geq t_L\)</span>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove subjects who had event / were censored before landmark</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sdata <span class="ot">=</span> <span class="fu">subset</span>(sdata, time <span class="sc">&gt;</span> lmark)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ldata <span class="ot">=</span> <span class="fu">subset</span>(ldata, id <span class="sc">%in%</span> sdata<span class="sc">$</span>id)</span></code></pre></div>
<p>Lastly, only repeated measurements taken up to the landmark time
(<span class="math inline">\(t_{ij} \leq t_L\)</span>) should be retained for modelling, whereas
measurements taken after the landmark time (<span class="math inline">\(t_{ij} &gt; t_L\)</span>) should be
discarded:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove measurements taken after landmark:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ldata <span class="ot">=</span> <span class="fu">subset</span>(ldata, fuptime <span class="sc">&lt;=</span> lmark)</span></code></pre></div>
<h4 class="unnumbered" data-number="4.4" id="descriptive-statistics-data-visualization-and-transformation">Descriptive statistics, data visualization and transformation</h4>
<p>After choosing <span class="math inline">\(t_L = 2\)</span> as landmark time, the number of subjects
retained for model estimation is 278, of which 107 experience the event
of interest, whereas the remaining 171 are right-censored:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of subjects retained in the analysis:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(sdata)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 278</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of events (1s) and censored observations (0s):</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(sdata<span class="sc">$</span>event)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   0   1 </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 171 107</span></span></code></pre></div>
<p>The estimated survival probability can be visualized through the
Kaplan-Meier estimator in Figure <a href="#fig:figkaplan">1</a> as shown below:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>surv.obj <span class="ot">=</span> <span class="fu">Surv</span>(<span class="at">time =</span> sdata<span class="sc">$</span>time, <span class="at">event =</span> sdata<span class="sc">$</span>event)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>KM <span class="ot">=</span> <span class="fu">survfit</span>(surv.obj <span class="sc">~</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">&quot;kaplan-meier&quot;</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(KM, <span class="at">data =</span> sdata, <span class="at">risk.table =</span> <span class="cn">TRUE</span>, <span class="at">cumevents =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">&#39;none&#39;</span>)</span></code></pre></div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:figkaplan"></span>
<img src="pencal-RJ_files/figure-latex/kaplan-1.png" alt="graphic without alt text" width="100%" />
<p class="caption">
Figure 1: Chart displaying the Kaplan-Meier estimates of the conditional survival probability S(t | 2).
</p>
</div>
</div>
<p>Spaghetti plots displaying the trajectory described by a longitudinal
covariate, as well as density plots to visualize its marginal
distribution, can be created in <code>ggplot2</code> style using:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>traj1 <span class="ot">=</span> <span class="fu">ggplot</span>(ldata, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> serBilir, <span class="at">group =</span> id)) <span class="sc">+</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&#39;darkgreen&#39;</span>) <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&#39;Trajectories of serBilir&#39;</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>dens1 <span class="ot">=</span> <span class="fu">ggplot</span>(ldata, <span class="fu">aes</span>(<span class="at">x =</span> serBilir)) <span class="sc">+</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust=</span><span class="fl">1.5</span>, <span class="at">alpha=</span>.<span class="dv">4</span>, <span class="at">fill =</span> <span class="st">&#39;orange&#39;</span>) <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Density of serBilir&#39;</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(traj1, dens1, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:figspaghetti"></span>
<img src="pencal-RJ_files/figure-latex/spaghetti-1.png" alt="graphic without alt text" width="100%" />
<p class="caption">
Figure 2: Spaghetti and density charts for the variable serBilir.
</p>
</div>
</div>
<p>The two charts thus created are shown in Figure <a href="#fig:figspaghetti">2</a>.</p>
<p>We can observe that some longitudinal covariates exhibit strong
skewness, as in the case of <code>serBilir</code>. Although in principle the LMM
can be used to model variables with skewed distributions, this may
sometimes lead to converge problems or poor model fit. It can thus be
advisable to transform such covariates to prevent these problems (but
note that this is not a required modelling choice, and one may
alternatively choose to avoid such transformation). For this reason, we
log-transform those longitudinal covariates with skewed distribution
before modelling them with LMMs:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ldata<span class="sc">$</span>logSerBilir <span class="ot">=</span> <span class="fu">log</span>(ldata<span class="sc">$</span>serBilir)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ldata<span class="sc">$</span>logSerChol <span class="ot">=</span> <span class="fu">log</span>(ldata<span class="sc">$</span>serChol)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>ldata<span class="sc">$</span>logAlkaline <span class="ot">=</span> <span class="fu">log</span>(ldata<span class="sc">$</span>alkaline)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>ldata<span class="sc">$</span>logSGOT <span class="ot">=</span> <span class="fu">log</span>(ldata<span class="sc">$</span>SGOT)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>ldata<span class="sc">$</span>logProthrombin <span class="ot">=</span> <span class="fu">log</span>(ldata<span class="sc">$</span>prothrombin)</span></code></pre></div>
<h4 class="unnumbered" data-number="4.5" id="model-estimation">Model estimation</h4>
<h5 class="unnumbered" data-number="4.5.1" id="step-1-estimation-of-the-mixed-effects-models">Step 1: estimation of the mixed-effects models</h5>
<p>The first step in the estimation of PRC involves modelling the evolution
over time of the longitudinal predictors through mixed-effects models.
Hereafter we model each of the longitudinal predictors using the LMM
given in equation <a href="#eq:lmmwithslope">(3)</a>, which comprises a random
intercept and a random slope for age. Estimation of this model for each
longitudinal predictor can be done using the function <code>fit_lmms</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lmms <span class="ot">=</span> <span class="fu">fit_lmms</span>(<span class="at">y.names =</span> <span class="fu">c</span>(<span class="st">&#39;logSerBilir&#39;</span>, <span class="st">&#39;logSerChol&#39;</span>, <span class="st">&#39;albumin&#39;</span>, <span class="st">&#39;logAlkaline&#39;</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&#39;logSGOT&#39;</span>, <span class="st">&#39;platelets&#39;</span>, <span class="st">&#39;logProthrombin&#39;</span>), </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">fixefs =</span> <span class="sc">~</span> age, <span class="at">ranefs =</span> <span class="sc">~</span> age <span class="sc">|</span> id, <span class="at">t.from.base =</span> fuptime,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">long.data =</span> ldata, <span class="at">surv.data =</span> sdata, <span class="at">n.boots =</span> <span class="dv">0</span>, <span class="at">n.cores =</span> <span class="dv">8</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The argument <code>y.names</code> is a character vector used to specify the names
of the longitudinal predictors in <code>ldata</code>. <code>fixefs</code> and <code>ranefs</code> are
formulas used to specify the fixed and random effects part of the LMM
using the <code>nlme</code> formula notation <span class="citation" data-cites="pinheiro2022 galecki2013">(<a href="#ref-galecki2013" role="doc-biblioref">Gałecki and Burzykowski 2013</a>; <a href="#ref-pinheiro2022" role="doc-biblioref">Pinheiro et al. 2022</a>)</span>. In the
example, <code>fixefs = ~ age</code> determines the inclusion of the fixed effects
part <span class="math inline">\(\beta_{s0} + \beta_{s1} a_{ij}\)</span> of model <a href="#eq:lmmwithslope">(3)</a>,
and <code>ranefs = ~ age  id</code> the inclusion of the random effects part
<span class="math inline">\(u_{si0} + u_{si1} a_{ij}\)</span> (allowing the random intercept and random
slopes to be correlated).</p>
<p>The arguments <code>long.data</code> and <code>surv.data</code> are used to provide the names
of the data frames containing the longitudinal variables (<code>long.data</code>)
and the survival data and baseline covariates (<code>surv.data</code>) in the data
formats described previously. The argument <code>t.from.base</code> is used to
specify the name of the variable in <code>long.data</code> that contains the values
of time from baseline; this argument is used internally to check that
the data have been landmarked properly.</p>
<p>The <code>n.boots</code> argument is used to specify the number of bootstrap
samples to use for the CBOCP. For the time being we focus on model
estimation and on the prediction of the conditional probabilities,
setting <code>n.boots = 0</code>; later we will show how to compute the CBOCP by
setting <code>n.boots = 50</code>. Lastly, <code>n.cores</code> allows to specify the number
of cores to use to parallelize computations (the default is
<code>n.cores = 1</code>, i.e. no parallelization), and <code>verbose</code> is a logical
value that indicates whether information messages should be printed in
the console (<code>TRUE</code>, default) or not (<code>FALSE</code>). Additional arguments are
described in the help page, see <code>?fit_lmms</code>.</p>
<p>The parameter estimates from the mixed models can be obtained from the
output of step 1 using <code>summary</code>. For example, to obtain the parameters
of the LMM for <code>albumin</code> we can use:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmms, <span class="at">yname =</span> <span class="st">&#39;albumin&#39;</span>, <span class="at">what =</span> <span class="st">&#39;betas&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  (Intercept)          age </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3.822741450 -0.005710811</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmms, <span class="at">yname =</span> <span class="st">&#39;albumin&#39;</span>, <span class="at">what =</span> <span class="st">&#39;variances&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; id = pdLogChol(age) </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             Variance     StdDev       Corr  </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept) 8.864945e-02 0.2977405761 (Intr)</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; age         3.447614e-07 0.0005871639 -0.103</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residual    1.257161e-01 0.3545646671</span></span></code></pre></div>
<p>From the output we can deduce that the ML estimates for the LMM
involving <code>albumin</code> are <span class="math inline">\(\hat{\beta} = (3.823, -0.0057)\)</span>,
<span class="math inline">\(\hat{\sigma}_{u0} = 0.2977\)</span>, <span class="math inline">\(\hat{\sigma}_{u1} = 0.00059\)</span>, and
<span class="math inline">\(\hat{\sigma}_{u0, u1} = -0.103 \cdot 0.2977 \cdot 0.00059\)</span>. The usual
table with parameter estimates, standard errors and p-values can be
obtained with</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmms, <span class="at">yname =</span> <span class="st">&#39;albumin&#39;</span>, <span class="at">what =</span> <span class="st">&#39;tTable&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                    Value   Std.Error  DF   t-value       p-value</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)  3.822741450 0.106163343 566 36.008111 1.614057e-148</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; age         -0.005710811 0.002085903 566 -2.737812  6.379534e-03</span></span></code></pre></div>
<h5 class="unnumbered" data-number="4.5.2" id="step-2-computation-of-the-predicted-random-effects">Step 2: computation of the predicted random effects</h5>
<p>After the ML estimates from the LMM have been computed, the second step
of PRC involves the computation of the predicted random effects
<span class="math inline">\(\hat{u}_{si}\)</span>. Such computation can be performed using the function
<code>summarize_lmms</code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>pred_ranefs <span class="ot">=</span> <span class="fu">summarize_lmms</span>(<span class="at">object =</span> lmms, <span class="at">n.cores =</span> <span class="dv">8</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pred_ranefs)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of predicted random effect variables: 14</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample size: 278</span></span></code></pre></div>
<p>Here, the <code>object</code> argument is used to pass the output of <code>fit_lmms</code> to
<code>summarize_lmms</code>; <code>n.cores</code> and <code>verbose</code> are the same as in <code>fit_lmms</code>.
The output of <code>summarize_lmms</code> is a list that contains, among other
elements, a matrix with the predicted random effects called
<code>ranef.orig</code>, where the row names display the subject identifiers:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(pred_ranefs<span class="sc">$</span>ranef.orig[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   logSerBilir_b_int logSerBilir_b_age logSerChol_b_int logSerChol_b_age</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2           -0.3830           -0.0017          -0.0712           0.0007</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3           -0.1171           -0.0006          -0.5985           0.0049</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4            0.1686            0.0009          -0.3704           0.0035</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5            0.3800            0.0012          -0.2910           0.0029</span></span></code></pre></div>
<p>From the output we can deduce, for example, that the predicted random
intercept and random slope for <code>logSerBilir</code> and subject <span class="math inline">\(4\)</span> are
<span class="math inline">\(\hat{u}_{1,0,4} = 0.1686\)</span> and <span class="math inline">\(\hat{u}_{1,1,4} = 0.0009\)</span>.</p>
<h5 class="unnumbered" data-number="4.5.3" id="step-3-estimation-of-the-penalized-cox-model">Step 3: estimation of the penalized Cox model</h5>
<p>The last step in the estimation of PRC involves the estimation of model
<a href="#eq:cox">(5)</a> through PML. This can be achieved with the <code>fit_prclmm</code>
function:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pencox <span class="ot">=</span> <span class="fu">fit_prclmm</span>(<span class="at">object =</span> pred_ranefs, <span class="at">surv.data =</span> sdata,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">baseline.covs =</span> <span class="sc">~</span> baselineAge <span class="sc">+</span> sex <span class="sc">+</span> treatment, <span class="at">penalty =</span> <span class="st">&#39;ridge&#39;</span>, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">standardize =</span> <span class="cn">TRUE</span>, <span class="at">n.cores =</span> <span class="dv">8</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The <code>object</code> argument is used to pass the output of <code>summarize_lmms</code> to
<code>fit_prclmm</code>; <code>surv.data</code> is the data frame that contains the
information about survival data and baseline covariates; <code>baseline.covs</code>
is a formula used to define which baseline covariates <span class="math inline">\(x_i\)</span> should be
included in model <a href="#eq:cox">(5)</a> (with associated regression coefficient
<span class="math inline">\(\gamma\)</span>). The <code>penalty</code> argument is a character that can take one of
the following values:</p>
<ol type="1">
<li><p><code>penalty = ridge</code> to estimate model <a href="#eq:cox">(5)</a> using the ridge or
L2 penalty within the PML estimation;</p></li>
<li><p><code>penalty = lasso</code> to estimate model <a href="#eq:cox">(5)</a> using the lasso or
L1 penalty;</p></li>
<li><p><code>penalty = elnet</code> to estimate model <a href="#eq:cox">(5)</a> using the
elasticnet penalty <span class="citation" data-cites="zou2005">(<a href="#ref-zou2005" role="doc-biblioref">Zou and Hastie 2005</a>)</span>. If this penalty is chosen, additional
arguments such as <code>n.alpha.elnet</code> and <code>n.folds.elnet</code> can be
specified to determine how to select the additional tuning parameter
(<span class="math inline">\(\alpha\)</span>) used by this penalty through nested cross-validation.</p></li>
</ol>
<p>The <code>standardize</code> argument is used to determine whether the predicted
random effects should be standardized prior to inclusion in the Cox
model (default is <code>TRUE</code>). By default, <code>fit_prclmm</code> does not penalize
baseline covariates, but this default behaviour can be changed using the
argument <code>pfac.base.covs</code> argument (not shown here).</p>
<p>The <code>n.cores</code> and <code>verbose</code> arguments are the same as in <code>fit_lmms</code>. See
<code>?fit_prclmm</code> for a description of further arguments.</p>
<p>The output of <code>fit_prclmm</code> can be summarized through <code>summary</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pencox)</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Fitted model: PRC-LMM</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalty function used: ridge</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Tuning parameters:</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      lambda alpha</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.2126761     0</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample size: 278</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of events: 107</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bootstrap optimism correction: not computed</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Penalized likelihood estimates (rounded to 4 digits):</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   baselineAge sexfemale treatmentD-penicil logSerBilir_b_int logSerBilir_b_age</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      0.0476   -0.2872            -0.0157            0.4341          111.3935</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   logSerChol_b_int logSerChol_b_age albumin_b_int albumin_b_age</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1           0.0986         -10.5311       -1.1361      23070.92</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   logAlkaline_b_int logAlkaline_b_age logSGOT_b_int logSGOT_b_age</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1            0.0874          -12.5617         0.238       272.246</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   platelets_b_int platelets_b_age logProthrombin_b_int logProthrombin_b_age</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1         -0.0011         -0.2046               2.8114            -573.3093</span></span></code></pre></div>
<p>The PML estimates of <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\delta\)</span> can be obtained through</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>step3summary <span class="ot">=</span> <span class="fu">summary</span>(pencox)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(step3summary)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;coefficients&quot; &quot;data_info&quot;    &quot;model_info&quot;   &quot;tuning&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>step3summary<span class="sc">$</span>coefficients</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   baselineAge sexfemale treatmentD-penicil logSerBilir_b_int logSerBilir_b_age</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   0.0475985 -0.287243        -0.01567369         0.4340672          111.3935</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   logSerChol_b_int logSerChol_b_age albumin_b_int albumin_b_age</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1        0.0986092        -10.53106      -1.13607      23070.92</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   logAlkaline_b_int logAlkaline_b_age logSGOT_b_int logSGOT_b_age</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1        0.08741668         -12.56169     0.2379553       272.246</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   platelets_b_int platelets_b_age logProthrombin_b_int logProthrombin_b_age</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    -0.001122804      -0.2046088             2.811446            -573.3093</span></span></code></pre></div>
<h4 class="unnumbered" data-number="4.6" id="computing-predictions">Computing predictions</h4>
<p>The function <code>survpred_prclmm</code> can be used to compute the conditional
survival probabilities <span class="math inline">\(\hat{S}_i(t | t_L, x_i, \mathcal{Y}_i(t_L)),\)</span>
<span class="math inline">\(t \geq t_L\)</span> in <a href="#eq:predsurv">(7)</a>. For the subjects that have been used
to estimate PRC, such computation can be performed using
<code>survpred_prclmm</code> as follows:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">survpred_prclmm</span>(<span class="at">step1 =</span> lmms, <span class="at">step2 =</span> pred_ranefs, <span class="at">step3 =</span> pencox, <span class="at">times =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)</span></code></pre></div>
<p>The <code>step1</code>, <code>step2</code> and <code>step3</code> arguments are used to pass the outputs
of the 3 estimation steps to the function; the <code>times</code> argument is a
vector with the prediction times at which one wishes to evaluate the
conditional survival probabilities. The predicted survival probabilities
are stored in the <code>predicted_survival</code> element of the function output:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(preds)</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;call&quot;               &quot;predicted_survival&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(preds<span class="sc">$</span>predicted_survival)</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id      S(3)      S(4)      S(5)      S(6)      S(7)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2 0.9398512 0.8867592 0.8329966 0.7813647 0.7008304</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  3 0.8555809 0.7392053 0.6316391 0.5377700 0.4090876</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  4 0.8138498 0.6709525 0.5451302 0.4407852 0.3071611</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  5 0.9460431 0.8981124 0.8492655 0.8020394 0.7277052</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  6 0.9383339 0.8839878 0.8290416 0.7763599 0.6943714</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7  7 0.9718724 0.9462254 0.9193945 0.8927316 0.8491681</span></span></code></pre></div>
<p>The function <code>survplot_prc</code> allows to visualize predictions for a sample
of individuals:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survplot_prc</span>(<span class="at">step1 =</span> lmms, <span class="at">step2 =</span> pred_ranefs, <span class="at">step3 =</span> pencox, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">ids =</span> <span class="fu">c</span>(<span class="dv">54</span>, <span class="dv">111</span>, <span class="dv">173</span>, <span class="dv">271</span>), <span class="at">tmax =</span> <span class="dv">12</span>)</span></code></pre></div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:figsurvplot"></span>
<img src="pencal-RJ_files/figure-latex/survplot-1.png" alt="graphic without alt text" width="100%" />
<p class="caption">
Figure 3: Predicted survival probabilities <span class="math inline">\(\hat{S}_i(t | 2), \:t \in [2, 12]\)</span> for subjects <span class="math inline">\(i \in \{54, 111, 173, 271\}\)</span>.
</p>
</div>
</div>
<p>The <code>ids</code> argument is used to indicate the subjects for whom the curve
should be displayed, and <code>tmax</code> sets the upper limit for the <span class="math inline">\(x\)</span> axis.
The chart, displayed in Figure <a href="#fig:figsurvplot">3</a>, shows the
predicted survival probability <span class="math inline">\(\hat{S}_i(t | 2)\)</span> for subjects 54, 111,
173, and 271. Notice that the survival probability up to the 2 year
landmark is 1 because our modelling approach conditions on being still
at risk at the landmark time.</p>
<p>Prediction for new subjects that have not been used for model estimation
is a bit more involved, as it additionally requires to compute the
predicted random effects for the new subjects using equation
<a href="#eq:predranef">(4)</a> based on the parameter estimates obtained in the
first step of PRC. For illustration purposes, suppose that we have data
from 3 subjects stored in two data frames called <code>new_ldata</code> and
<code>new_sdata</code>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>new_ldata <span class="ot">=</span> <span class="fu">subset</span>(ldata, id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">54</span>, <span class="dv">110</span>))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>new_sdata <span class="ot">=</span> <span class="fu">subset</span>(sdata, id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">54</span>, <span class="dv">110</span>), <span class="fu">c</span>(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;baselineAge&#39;</span>, <span class="st">&#39;sex&#39;</span>, <span class="st">&#39;treatment&#39;</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new_ldata)</span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     id      age   fuptime serBilir serChol albumin alkaline  SGOT platelets</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 23   5 38.10645 0.0000000      3.4     279    3.53      671 113.2       136</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 24   5 38.65130 0.5448472      1.9      NA    3.28      689 103.9       114</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 25   5 39.17698 1.0705290      2.5      NA    3.34      652 117.8        99</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 419 54 39.19888 0.0000000      1.3     288    3.40     5487  73.5       254</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 420 54 39.69171 0.4928266      1.5      NA    3.22     1580  71.3       112</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 421 54 40.19001 0.9911291      2.6      NA    3.48     2127  86.8       207</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     prothrombin logSerBilir logSerChol logAlkaline  logSGOT logProthrombin</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 23         10.9   1.2237754   5.631212    6.508769 4.729156       2.388763</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 24         10.7   0.6418539         NA    6.535241 4.643429       2.370244</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 25         10.5   0.9162907         NA    6.480045 4.768988       2.351375</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 419        11.0   0.2623643   5.662960    8.610137 4.297285       2.397895</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 420        18.0   0.4054651         NA    7.365180 4.266896       2.890372</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 421        10.9   0.9555114         NA    7.662468 4.463607       2.388763</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new_sdata)</span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      id baselineAge    sex treatment</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 23    5    38.10645 female   placebo</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 419  54    39.19888 female D-penicil</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 859 110    38.91140 female D-penicil</span></span></code></pre></div>
<p>Note that the variables and their variable type in <code>new_ldata</code> and
<code>new_sdata</code> should be the same as in the <code>ldata</code> and <code>sdata</code>; the only
exception to this is that <code>new_sdata</code> does not need to contain
information about survival, so unlike <code>sdata</code> it does not comprise the
<code>time</code> and <code>event</code> variables.</p>
<p>To compute predicted probabilities for new subjects, it is once again
possible to resort to <code>survpred_prclmm</code>; now, it is necessary to specify
the arguments <code>new.longdata</code> and <code>new.basecovs</code> to supply the data about
the new subjects to <code>survpred_prclmm</code>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>pred_new <span class="ot">=</span> <span class="fu">survpred_prclmm</span>(<span class="at">step1 =</span> lmms, <span class="at">step2 =</span> pred_ranefs, <span class="at">step3 =</span> pencox, <span class="at">times =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">new.longdata =</span> new_ldata, <span class="at">new.basecovs =</span> new_sdata)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>pred_new<span class="sc">$</span>predicted_survival</span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      id      S(3)      S(4)      S(5)      S(6)      S(7)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 0.9460431 0.8981124 0.8492655 0.8020394 0.7277052</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 54   54 0.9115188 0.8357020 0.7611779 0.6918065 0.5880763</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 110 110 0.9505706 0.9064581 0.8612933 0.8174139 0.7478898</span></span></code></pre></div>
<h4 class="unnumbered" data-number="4.7" id="evaluation-of-the-predictive-performance-1">Evaluation of the predictive performance</h4>
<p>As explained in the Statistical Methods Section, estimation of the
predictive performance in
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> is done through
a CBOCP that allows to obtain unbiased estimates of predictive
performance as measured by the tdAUC, C index and Brier score.</p>
<p>Before computing the (potentially time-consuming) CBOCP, one may want to
first have a look at the naïve (biased) estimates of predictive
performance. This can be done using the function <code>performance_prc</code>:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># naive performance (biased, optimistic estimate)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>naive_perf <span class="ot">=</span> <span class="fu">performance_prc</span>(<span class="at">step2 =</span> pred_ranefs, <span class="at">step3 =</span> pencox, <span class="at">metric =</span> <span class="st">&#39;tdauc&#39;</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">times =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">n.cores =</span> <span class="dv">8</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in performance_prc(step2 = pred_ranefs, step3 = pencox, metric =</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &quot;tdauc&quot;, : The cluster bootstrap optimism correction has not been performed</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (n.boots = 0). Therefore, only the apparent values of the performance values</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; will be returned.</span></span></code></pre></div>
<p>Here <code>pred_ranefs</code> is the output of step2 of PRC and <code>pencox</code> the output
of step 3. The <code>metric</code> argument can be used to specify the performance
measures to be computed (possible values are <code>tdauc</code>, <code>c</code> and <code>brier</code>),
whereas the <code>times</code> argument is used to specify the time points at which
the tdAUC and Brier score should be evaluated (<span class="math inline">\(t = 3, 4, 5, 6, 7\)</span> in
this example). Notice that when <code>fit_lmms</code> has been run with
<code>n.boots = 0</code>, <code>performance_prc</code> returns a warning to inform users that
the CBOCP has not been performed; for now, we can ignore this warning
(which we will address soon by refitting PRC with <code>n.boots = 50</code>).</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>naive_perf</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; performance_prc(step2 = pred_ranefs, step3 = pencox, metric = &quot;tdauc&quot;, </span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     times = 3:7, n.cores = 8, verbose = FALSE)</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $tdAUC</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   pred.time tdAUC.naive optimism.correction tdAUC.adjusted</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1         3      0.9439                  NA             NA</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         4      0.9351                  NA             NA</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3         5      0.9266                  NA             NA</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4         6      0.8981                  NA             NA</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5         7      0.8831                  NA             NA</span></span></code></pre></div>
<p>From the output we can observe that the naïve estimate of the tdAUC
ranges from 0.9439 for predictions of survival at <span class="math inline">\(t = 3\)</span> up to 0.8831
for predictions at <span class="math inline">\(t = 7\)</span>. These naïve (in-sample) measurements of
predictive performance may be optimistically biased due to overfitting,
i.e., the fact that they are evaluated using the same data on which PRC
was estimated. To correct for this potential source of bias, below we
show how to implement the CBOCP to obtain unbiased estimates of the
tdAUC and C index.</p>
<p>Computation of the CBOCP requires to repeat the 3 estimation steps of
PRC for each bootstrap samples; this can be done by rerunning the
functions <code>fit_lmms</code>, <code>summarize_lmms</code> and <code>fit_prclmm</code> with the same
arguments used previously, but setting <code>n.boots</code> within <code>fit_lmms</code> to an
integer value larger than 0. <code>n.boots</code> specifies the number of bootstrap
samples to use to compute the CBOCP. In the example below we set
<code>n.boots = 50</code> (note that larger values of <code>n.boots</code> can increase the
accuracy of the CBOCP estimates, but at the same time they increase
computing time).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>step1 <span class="ot">=</span> <span class="fu">fit_lmms</span>(<span class="at">y.names =</span> <span class="fu">c</span>(<span class="st">&#39;logSerBilir&#39;</span>, <span class="st">&#39;logSerChol&#39;</span>, <span class="st">&#39;albumin&#39;</span>, <span class="st">&#39;logAlkaline&#39;</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&#39;logSGOT&#39;</span>, <span class="st">&#39;platelets&#39;</span>, <span class="st">&#39;logProthrombin&#39;</span>), </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">fixefs =</span> <span class="sc">~</span> age, <span class="at">ranefs =</span> <span class="sc">~</span> age <span class="sc">|</span> id, <span class="at">t.from.base =</span> fuptime,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">long.data =</span> ldata, <span class="at">surv.data =</span> sdata, <span class="at">n.boots =</span> <span class="dv">50</span>, <span class="at">n.cores =</span> <span class="dv">8</span>, </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>step2 <span class="ot">=</span> <span class="fu">summarize_lmms</span>(<span class="at">object =</span> step1, <span class="at">n.cores =</span> <span class="dv">8</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>step3 <span class="ot">=</span> <span class="fu">fit_prclmm</span>(<span class="at">object =</span> step2, <span class="at">surv.data =</span> sdata,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">baseline.covs =</span> <span class="sc">~</span> baselineAge <span class="sc">+</span> sex <span class="sc">+</span> treatment,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">penalty =</span> <span class="st">&#39;ridge&#39;</span>, <span class="at">n.cores =</span> <span class="dv">8</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Once all computations are finished, it suffices to supply the refitted
outputs of step 2 and step 3 to <code>performance_prc</code>:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap-corrected performance (unbiased estimate)</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>cbocp <span class="ot">=</span> <span class="fu">performance_prc</span>(<span class="at">step2 =</span> step2, <span class="at">step3 =</span>  step3, <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;tdauc&#39;</span>, <span class="st">&#39;brier&#39;</span>), </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">times =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">n.cores =</span> <span class="dv">8</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>cbocp</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $call</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; performance_prc(step2 = step2, step3 = step3, metric = c(&quot;tdauc&quot;, </span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &quot;brier&quot;), times = 3:7, n.cores = 8, verbose = FALSE)</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $tdAUC</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   pred.time tdAUC.naive optimism.correction tdAUC.adjusted</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1         3      0.9439             -0.0061         0.9378</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         4      0.9351             -0.0150         0.9201</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3         5      0.9266             -0.0132         0.9134</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4         6      0.8981             -0.0086         0.8895</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5         7      0.8831             -0.0118         0.8713</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $Brier</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   pred.time Brier.naive optimism.correction Brier.adjusted</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1         3      0.0571              0.0147         0.0718</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         4      0.0699              0.0271         0.0970</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3         5      0.0844              0.0328         0.1172</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4         6      0.0953              0.0348         0.1301</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5         7      0.1007              0.0416         0.1423</span></span></code></pre></div>
<p>In the outputs above, the columns <code>tdAUC.naive</code> and <code>Brier.naive</code>
contain the naïve estimates of the tdAUC and Brier score;
<code>optimism.correction</code> reports the values of the estimated optimism
correction from the CBOCP for the two metrics; finally, <code>tdAUC.adjusted</code>
and <code>Brier.adjusted</code> contain the unbiased estimates of the tdAUC and
Brier score.</p>
<p>As expected, the unbiased estimates of predictive performance are
somewhat worse than the naïve ones. For example, the tdAUC estimate for
predictions at <span class="math inline">\(t = 3\)</span> is 0.9378 instead of the naïve estimate 0.9439.
Similarly, the Brier score estimate for predictions at <span class="math inline">\(t = 3\)</span> is 0.0718
instead of the naïve estimate 0.0571.</p>
<h3 data-number="5" id="evaluation-of-computing-time"><span class="header-section-number">5</span> Evaluation of computing time</h3>
<p>We now turn our attention to the relationship between the sample size
<span class="math inline">\(n\)</span>, number of longitudinal covariates <span class="math inline">\(p\)</span> and number of bootstrap
replicates <span class="math inline">\(B\)</span> on computing time. Furthermore, we look into how parallel
computing may be used to reduce computing time for the CBOCP. To gain
insight into these relationships, we simulate data from the PRC LMM
model using the function <code>simulate_prclmm_data</code> according to four
simulation scenarios:</p>
<ul>
<li><p>in simulation 1 we study the effect of <span class="math inline">\(n\)</span> on the estimation of PRC.
To this aim, we let <span class="math inline">\(n \in \{100, 200, 400, 600, 800, 1000\}\)</span> and
fix <span class="math inline">\(p = 10\)</span>;</p></li>
<li><p>in simulation 2 we study the effect of <span class="math inline">\(p\)</span> on the estimation of PRC
by taking <span class="math inline">\(p \in \{5, 10, 20, 30, 40, 50\}\)</span> and fixing <span class="math inline">\(n = 200\)</span>;</p></li>
<li><p>in simulation 3 we shift our attention to the effect of <span class="math inline">\(B\)</span> on the
computing time of the CBOCP. We let
<span class="math inline">\(B \in \{50, 100, 200, 300, 400, 500\}\)</span>, fixing <span class="math inline">\(n = 200\)</span> and
<span class="math inline">\(p = 10\)</span>;</p></li>
<li><p>finally, in simulation 4 we compute PRC and the CBOCP on a dataset
where <span class="math inline">\(n = 200\)</span>, <span class="math inline">\(p = 50\)</span> and <span class="math inline">\(B = 50\)</span> using an increasing number of
cores, namely <span class="math inline">\(\{1, 2, 3, 4, 8, 16\}\)</span>.</p></li>
</ul>
<p>Computations were performed on an AMD EPYC 7662 processor with 2 GHz
CPU, using a single core for simulations 1, 2 and 3, and a number of
cores ranging from 1 to 16 in simulation 4. Computing time was measured
using the <code>rbenchmark</code> package <span class="citation" data-cites="kusnierczyk2012">(<a href="#ref-kusnierczyk2012" role="doc-biblioref">Kusnierczyk 2012</a>)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:figctime1"></span>
<img src="comptime_sims_123.png" alt="graphic without alt text" width="100%" />
<p class="caption">
Figure 4: Left and center: average computing time (in seconds) of the estimation of the PRC LMM model as a function of the sample size n (simulation 1, left) and of the number of longitudinal predictors p (simulation 2, center). Right: average computing time (in minutes) for the computation of the CBOCP as a function of B (simulation 3).
</p>
</div>
</div>
<p>The charts in Figure <a href="#fig:figctime1">4</a> display the average computing
time over 10 replications of simulations 1, 2 and 3. In simulation 1,
the average computing time increases from 5.80 seconds when <span class="math inline">\(n = 100\)</span> to
14.01 seconds when <span class="math inline">\(n = 1000\)</span>, so we observe a 2.4-fold increase in
computing time as <span class="math inline">\(n\)</span> increases by a factor of 10. In simulation 2, the
average computing time increases from 5.37 seconds when <span class="math inline">\(p = 5\)</span> to 19.26
seconds when <span class="math inline">\(p = 50\)</span>, yielding a 3.6-fold increase in computing time as
<span class="math inline">\(p\)</span> increases by a factor of 10. Lastly, in simulation 3 the average
computing time increases from 3.38 minutes when <span class="math inline">\(B = 50\)</span> to 32.32
minutes when <span class="math inline">\(B = 500\)</span>, with a 9.6-fold time increase corresponding to a
10-fold increase in <span class="math inline">\(B\)</span>.</p>
<p>Overall, the results of simulations 1 and 2 indicate that computing time
for the estimation of PRC increases linearly with, but less than
proportionally to, <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span> (meaning that a <span class="math inline">\(k\)</span>-fold increase in <span class="math inline">\(n\)</span>
or <span class="math inline">\(p\)</span> will typically increase computing time by a factor smaller than
<span class="math inline">\(k\)</span>). Instead, from simulation 3 we can observe that the computing time
of the CBOCP increases proportionally to <span class="math inline">\(B\)</span>.</p>
<p>The results of simulations 1, 2 and 3 show that whereas the estimation
of the PRC model itself typically requires only a few seconds, the
computation of the CBOCP is more intensive and can require several
minutes. This is due to the fact that the CBOCP requires the PRC
modelling steps to be repeated on each bootstrap sample, effectively
requiring to compute PRC <span class="math inline">\(B + 1\)</span> times (once on the original dataset +
<span class="math inline">\(B\)</span> times on the <span class="math inline">\(B\)</span> bootstrap datasets). To reduce the computing time
needed to compute the CBOCP, <code>pencal</code> enables users to easily
parallelize computations through the argument <code>n.cores</code> within
<code>fit_lmms</code>, <code>summarize_lmms</code> and <code>fit_prclmm</code>. In simulation 4, we show
the effect that increasing the number of cores has on the computing time
of the CBOCP.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:figctime4"></span>
<img src="comptime_sim4b.png" alt="graphic without alt text" width="100%" />
<p class="caption">
Figure 5: Average computing time (in seconds) for the estimation of the PRC LMM model and the computation of the CBOCP as a function of the number of cores.
</p>
</div>
</div>
<p>Figure <a href="#fig:figctime4">5</a> shows the average computing time of the
CBOCP over 10 replications of simulation 4. When looking at the total
computing time, we can see that increasing the number of cores from 1 to
8 progressively decreases computing time, reducing it from 863.8 seconds
without parallelization up to 235.7 seconds when using 8 cores (-68%).
The most significant time gains are from 1 to 2 cores (-407.2 seconds)
and then from 2 to 3 (-124.4 seconds). Interestingly, further doubling
the number of cores from 8 to 16 proves to be detrimental, increasing
computing time from 235.7 to 684.5 seconds.</p>
<p>To understand this initially decreasing, but later increasing pattern,
it is useful to consider the computing time of each of the modelling
steps separately. By looking at Figure <a href="#fig:figctime4">5</a> we notice
that step 1, which involves the estimation of <span class="math inline">\(p \cdot (B+1)\)</span> LMMs, is
the most time-consuming step; its computing time consistently decreases
as the number of cores decreases (from 636.1 to 60.8 seconds).</p>
<p>The same does not apply to step 2, where computing time decreases from 1
to 4 cores (from 192.3 to 93.6 seconds), but then increases considerably
when going from 8 (130.4 seconds) to 16 cores (613.2 seconds). This
pattern is primarily due to the fact that step 2 mostly involves simple
linear algebra: parallelizing this step on a large number of cores may
be detrimental, as the (limited) time gain that can be achieved by doing
these simple computations in parallel may be more than compensated by
the time cost of dispatching the necessary matrices and vectors to many
cores and recombining the results at the end of the parallelization.</p>
<p>As concerns step 3, we can see that it is the lightest step in terms of
computing time. The pattern is consistently decreasing from 1 (35.4
seconds) to 8 cores (8.8 seconds), with a slight increase when using 16
cores (10.6 seconds).</p>
<p>In conclusion, the results of simulation 4 show how it may be advisable
to parallelize computations to compute the CBOCP, but without using an
excessive number of cores (specially for step 2). Our general advice is
to use between 3 and 8 cores for optimal performance, nevertheless we
emphasize how the effect of the number of cores on computing time may
differ from the patterns in Figure <a href="#fig:figctime4">5</a> depending on a
combination of factors such as <span class="math inline">\(n\)</span>, <span class="math inline">\(p\)</span>, number of repeated measurements
per subject, and <span class="math inline">\(B\)</span>. Furthermore, we notice that within <code>pencal</code>, a
different number of cores can be chosen for each modelling step; in the
example of simulation 4, the optimal performance would be achieved using
16 cores for step 1, 4 cores for step 2, and 8 cores for step 3 (but
using 8 cores for all 3 steps isn’t much less efficient).</p>
<h3 data-number="6" id="summary-and-discussion"><span class="header-section-number">6</span> Summary and discussion</h3>
<p>The <code>R</code> package <a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a>
provides a user-friendly implementation of Penalized Regression
Calibration (PRC, <span class="citation" data-cites="signorelli2021">Signorelli et al. (<a href="#ref-signorelli2021" role="doc-biblioref">2021</a>)</span>), a statistical method that can be
used to implement dynamic prediction of time-to-event outcomes in
longitudinal studies where both time-independent and longitudinal (i.e.,
time-dependent) covariates are available as possible predictors of
survival. The package comprises functions for the estimation of PRC and
the prediction of survival, as well as functions to compute unbiased
estimates of predictive performance through a cluster bootstrap
procedure. Because computing such bootstrap procedure may be
time-consuming, the package automatically parallelizes repetitive
computations using the <code>%dopar%</code> operator from the
<a href="https://CRAN.R-project.org/package=foreach"><strong>foreach</strong></a> package
<span class="citation" data-cites="foreach2022">(<a href="#ref-foreach2022" role="doc-biblioref">Microsoft and Weston 2022</a>)</span>.</p>
<p><a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> focuses on
problems where a single survival outcome is measured with
right-censoring. As such, it is not designed to handle interval
censoring or competing risks. The modelling of the longitudinal
covariates is performed using either the LMM or the MLPMM, which are
linear models that are mostly suitable for the analysis of continuous
outcomes. Implementing generalized linear mixed models (GLMMs) would
make it possible to properly deal with binary and discrete longitudinal
covariates, however the estimation of GLMMs and the computation of the
predicted random effects are more time-consuming and more prone to
convergence problems, two aspects that would particularly complicate the
computation of the CBOCP. For this reason we did not pursue GLMMs
further, but leave them as a topic of future research. Users dealing
with discrete longitudinal covariates may consider log-transforming them
before modelling with a LMM within
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> (specially if
such covariates are right-skewed and/or exhibit overdispersion). Despite
this latter limitation, a recent benchmarking study showed that PRC
outperformed several alternative modelling approaches when applied to
multiple real-world datasets <span class="citation" data-cites="signorelli2024">(<a href="#ref-signorelli2024" role="doc-biblioref">Signorelli and Retif 2024</a>)</span>.</p>
<p>Two modelling choices deserve particular attention when implementing PRC
in specific application contexts. The first refers to the choice of the
covariates to include in the fixed and random effects parts of the LMM
of Equation <a href="#eq:lmm">(2)</a>. In principle, one may want to model the
response variable as flexibly as possible, including several fixed
effect covariates and multiple random effects in the LMM. However, when
doing this one should consider that the purpose of the LMM is to provide
subject-specific summaries of the individual trajectories. Thus, <em>the
primary goal of the LMM in step 1 is that of obtaining predicted random
effects that are good summaries of how the trajectory of a given subject
differs from the population average</em>. In practice, such purpose may be
more easily achieved using a simple mixed model that allows for a clear
interpretation of its random effects, rather than using a complex one
where the interpretation of each random effect may be unclear /
complicated. The LMM of equation <a href="#eq:lmmwithslope">(3)</a> (or,
alternatively, the same model with follow-up time included as covariate
instead of age) is a good example of simple LMM with clearly
interpretable random effects, as the random intercept allows to
distinguish subjects with high and low initial levels of the covariate,
and the random slope to identify subjects with faster and slower
progression rates. Therefore, even though <code>fit_lmms</code> makes it possible
to consider complex fixed and random effects formulas, we still advise
users to consider simpler mixed models in step 1 (and to compare the
predictive performance of PRC using either approach, eventually choosing
the approach that delivers more accurate predictions if there is a
substantial difference).</p>
<p>A second important modelling choice when using
<a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a> is which penalty
function should be used in step 3. In general, this is a modelling
choice that may dependent on the specific application and its features
(sample size, number of predictors and number of available repeated
measurements per subject). <span class="citation" data-cites="signorelli2021">Signorelli et al. (<a href="#ref-signorelli2021" role="doc-biblioref">2021</a>)</span> performed several simulation
studies focused on situations with small sample sizes (<span class="math inline">\(n = 100\)</span> and
<span class="math inline">\(n = 300\)</span>) and sparse data generating processes for the survival
outcome, whose results showed that the ridge and elasticnet penalty
yielded better performance than the lasso penalty. Our experience is
that in general the ridge penalty may be preferable both to elasticnet
and the lasso in scenarios with small or moderate sample sizes, where
little information is available to estimate the <span class="math inline">\(\alpha\)</span> tuning
parameter of elasticnet or to reliably perform variable selection with
the lasso. Beyond this, it is always possible to use a data-driven
approach to choose which penalty to use by estimating PRC using the 3
different penalties and comparing how this affects predictive
performance.</p>
<h4 class="unnumbered" data-number="6.1" id="software-and-code-availability">Software and code availability</h4>
<p>The <code>R</code> package <a href="https://CRAN.R-project.org/package=pencal"><strong>pencal</strong></a>
can be downloaded from CRAN at
<a href="https://cran.r-project.org/package=pencal">cran.r-project.org/package=pencal</a>.
The development version of the package is available on Github at
<a href="https://github.com/mirkosignorelli/pencal_devel">github.com/mirkosignorelli/pencal_devel</a>.
The code used in the simulations for the evaluation of computing time is
available at<br />
<a href="https://github.com/mirkosignorelli/pencal_sims/">github.com/mirkosignorelli/pencal_sims/</a>.</p>
<h4 class="unnumbered" data-number="6.2" id="acknowledgements">Acknowledgements</h4>
<p>The author kindly acknowledges funding from the Netherlands eScience
Center Fellowship Programme.</p>
</div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h3 class="appendix" data-number="7" id="supplementary-materials"><span class="header-section-number">7</span> Supplementary materials</h3>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2024-014.zip">RJ-2024-014.zip</a></p>
<h3 class="appendix" data-number="8" id="cran-packages-used"><span class="header-section-number">8</span> CRAN packages used</h3>
<p><a href="https://cran.r-project.org/package=survival">survival</a>, <a href="https://cran.r-project.org/package=JM">JM</a>, <a href="https://cran.r-project.org/package=JMbayes">JMbayes</a>, <a href="https://cran.r-project.org/package=joineR">joineR</a>, <a href="https://cran.r-project.org/package=joineRML">joineRML</a>, <a href="https://cran.r-project.org/package=pencal">pencal</a>, <a href="https://cran.r-project.org/package=DynForest">DynForest</a>, <a href="https://cran.r-project.org/package=nlme">nlme</a>, <a href="https://cran.r-project.org/package=lcmm">lcmm</a>, <a href="https://cran.r-project.org/package=glmnet">glmnet</a>, <a href="https://cran.r-project.org/package=survivalROC">survivalROC</a>, <a href="https://cran.r-project.org/package=riskRegression">riskRegression</a>, <a href="https://cran.r-project.org/package=foreach">foreach</a></p>
<h3 class="appendix" data-number="9" id="cran-task-views-implied-by-cited-packages"><span class="header-section-number">9</span> CRAN Task Views implied by cited packages</h3>
<p><a href="https://cran.r-project.org/view=CausalInference">CausalInference</a>, <a href="https://cran.r-project.org/view=ChemPhys">ChemPhys</a>, <a href="https://cran.r-project.org/view=ClinicalTrials">ClinicalTrials</a>, <a href="https://cran.r-project.org/view=Cluster">Cluster</a>, <a href="https://cran.r-project.org/view=Econometrics">Econometrics</a>, <a href="https://cran.r-project.org/view=Environmetrics">Environmetrics</a>, <a href="https://cran.r-project.org/view=Finance">Finance</a>, <a href="https://cran.r-project.org/view=HighPerformanceComputing">HighPerformanceComputing</a>, <a href="https://cran.r-project.org/view=MachineLearning">MachineLearning</a>, <a href="https://cran.r-project.org/view=MixedModels">MixedModels</a>, <a href="https://cran.r-project.org/view=OfficialStatistics">OfficialStatistics</a>, <a href="https://cran.r-project.org/view=Psychometrics">Psychometrics</a>, <a href="https://cran.r-project.org/view=Spatial">Spatial</a>, <a href="https://cran.r-project.org/view=SpatioTemporal">SpatioTemporal</a>, <a href="https://cran.r-project.org/view=Survival">Survival</a></p>
<h3 class="appendix" data-number="10" id="bioconductor-packages-used"><span class="header-section-number">10</span> Bioconductor packages used</h3>
<p><a href="https://www.bioconductor.org/packages/survcomp">survcomp</a></p>
<h3 class="appendix" data-number="11" id="note"><span class="header-section-number">11</span> Note</h3>
<p>This article is converted from a Legacy LaTeX article using the
<a href="https://cran.r-project.org/package=texor">texor</a> package.
The pdf version is the official version. To report a problem with the html,
refer to CONTRIBUTE on the R Journal homepage.</p>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-devaux2023" class="csl-entry" role="listitem">
A. Devaux, C. Proust-Lima and R. Genuer. <span class="nocase">Random Forests for time-fixed and time-dependent predictors: The DynForest R package</span>. <em>arXiv preprint arXiv:2302.02670</em>, 2023.
</div>
<div id="ref-galecki2013" class="csl-entry" role="listitem">
A. Gałecki and T. Burzykowski. Linear mixed-effects model. In <em>Linear <span>M</span>ixed-<span>E</span>ffects <span>M</span>odels <span>U</span>sing <span>R</span></em>, pages. 245–273 2013. Springer.
</div>
<div id="ref-gerds2022" class="csl-entry" role="listitem">
T. A. Gerds, J. S. Ohlendorff and B. Ozenne. <span class="nocase">riskRegression: Risk Regression Models and Prediction Scores for Survival Analysis with Competing Risks</span>., 2023. URL <a href="https://CRAN.R-project.org/package=riskRegression">https://CRAN.R-project.org/package=riskRegression</a>. R package version 2023.03.22.
</div>
<div id="ref-graf1999" class="csl-entry" role="listitem">
E. Graf, C. Schmoor, W. Sauerbrei and M. Schumacher. Assessment and comparison of prognostic classification schemes for survival data. <em>Statistics in Medicine</em>, 18(17-18): 2529–2545, 1999.
</div>
<div id="ref-heagerty2000" class="csl-entry" role="listitem">
P. J. Heagerty, T. Lumley and M. S. Pepe. Time-dependent <span>ROC</span> curves for censored survival data and a diagnostic marker. <em>Biometrics</em>, 56(2): 337–344, 2000.
</div>
<div id="ref-heagerty2022" class="csl-entry" role="listitem">
P. J. Heagerty and P. Saha-Chaudhuri. <span class="nocase">survivalROC: Time-Dependent ROC Curve Estimation from Censored Survival Data</span>., 2022. URL <a href="https://CRAN.R-project.org/package=survivalROC">https://CRAN.R-project.org/package=survivalROC</a>. R package version 1.0.3.1.
</div>
<div id="ref-henderson2000" class="csl-entry" role="listitem">
R. Henderson, P. Diggle and A. Dobson. Joint modelling of longitudinal measurements and event time data. <em>Biostatistics</em>, 1(4): 465–480, 2000.
</div>
<div id="ref-hickey2018" class="csl-entry" role="listitem">
G. L. Hickey, P. Philipson, A. Jorgensen and R. Kolamunnage-Dona. <span class="nocase">joineRML: a joint model and software package for time-to-event and multivariate longitudinal outcomes</span>. <em>BMC Medical Research Methodology</em>, 18: 1–14, 2018.
</div>
<div id="ref-kusnierczyk2012" class="csl-entry" role="listitem">
W. Kusnierczyk. <span class="nocase">rbenchmark: Benchmarking routine for R</span>., 2012. URL <a href="https://CRAN.R-project.org/package=rbenchmark">https://CRAN.R-project.org/package=rbenchmark</a>. R package version 1.0.0.
</div>
<div id="ref-mcculloch2004" class="csl-entry" role="listitem">
C. E. McCulloch and S. R. Searle. <em>Generalized, <span>L</span>inear, and <span>M</span>ixed <span>M</span>odels.</em> John Wiley &amp; Sons, 2004.
</div>
<div id="ref-foreach2022" class="csl-entry" role="listitem">
Microsoft and S. Weston. <em>Foreach: Provides foreach looping construct.</em> 2022. URL <a href="https://CRAN.R-project.org/package=foreach">https://CRAN.R-project.org/package=foreach</a>. R package version 1.5.2.
</div>
<div id="ref-murtaugh1994" class="csl-entry" role="listitem">
P. A. Murtaugh, E. R. Dickson, G. M. Van Dam, M. Malinchoc, P. M. Grambsch, A. L. Langworthy and C. H. Gips. Primary biliary cirrhosis: Prediction of short-term survival based on repeated patient visits. <em>Hepatology</em>, 20(1): 126–134, 1994.
</div>
<div id="ref-pencina2004" class="csl-entry" role="listitem">
M. J. Pencina and R. B. D’Agostino. Overall <span>C</span> as a measure of discrimination in survival analysis: Model specific population value and confidence interval estimation. <em>Statistics in Medicine</em>, 23(13): 2109–2123, 2004.
</div>
<div id="ref-philipson2018" class="csl-entry" role="listitem">
P. Philipson, I. Sousa, P. Diggle, P. Williamson, R. Kolamunnage-Dona, R. Henderson and G. Hickey. <span class="nocase">joineR: Joint Modelling of Repeated Measurements and Time-to-Event Data</span>., 2018. URL <a href="https://cran.r-project.org/package=joineR">https://cran.r-project.org/package=joineR</a>. R package version 1.2.8.
</div>
<div id="ref-pinheiro2000" class="csl-entry" role="listitem">
J. C. Pinheiro and D. M. Bates. <em><span class="nocase">Mixed-Effects Models in S and S-PLUS</span>.</em> Springer, 2000.
</div>
<div id="ref-pinheiro2022" class="csl-entry" role="listitem">
J. Pinheiro, D. Bates and R Core Team. <em><span class="nocase">nlme: Linear and Nonlinear Mixed Effects Models</span>.</em> 2022. URL <a href="https://CRAN.R-project.org/package=nlme">https://CRAN.R-project.org/package=nlme</a>. R package version 3.1-160.
</div>
<div id="ref-proust2013" class="csl-entry" role="listitem">
C. Proust-Lima, H. Amieva and H. Jacqmin-Gadda. Analysis of multivariate mixed longitudinal data: A flexible latent process approach. <em>British Journal of Mathematical and Statistical Psychology</em>, 66(3): 470–487, 2013.
</div>
<div id="ref-proust2017" class="csl-entry" role="listitem">
C. Proust-Lima, V. Philipps and B. Liquet. Estimation of extended mixed models using latent classes and latent processes: The <span>R</span> package cmm. <em>Journal of Statistical Software</em>, 78(2): 1–56, 2017.
</div>
<div id="ref-putter2022" class="csl-entry" role="listitem">
H. Putter and H. C. van Houwelingen. Landmarking 2.0: Bridging the gap between joint models and landmarking. <em>Statistics in Medicine</em>, 41(11): 1901–1917, 2022.
</div>
<div id="ref-rizopoulos2010" class="csl-entry" role="listitem">
D. Rizopoulos. <span class="nocase">JM: An R package for the joint modelling of longitudinal and time-to-event data</span>. <em>Journal of Statistical Software</em>, 35: 1–33, 2010.
</div>
<div id="ref-rizopoulos2014" class="csl-entry" role="listitem">
D. Rizopoulos. <span class="nocase">The R package JMbayes for fitting joint models for longitudinal and time-to-event data using MCMC</span>. <em>arXiv preprint arXiv:1404.7625</em>, 2014.
</div>
<div id="ref-schroder2011" class="csl-entry" role="listitem">
M. S. Schröder, A. C. Culhane, J. Quackenbush and B. Haibe-Kains. <span class="nocase">survcomp: an R/Bioconductor package for performance assessment and comparison of survival models</span>. <em>Bioinformatics</em>, 27(22): 3206–3208, 2011.
</div>
<div id="ref-signorelli2023" class="csl-entry" role="listitem">
M. Signorelli. <span class="nocase">pencal: Penalized Regression Calibration (PRC) for the Dynamic Prediction of Survival</span>., 2023. URL <a href="https://cran.r-project.org/package=pencal">https://cran.r-project.org/package=pencal</a>. R package version 2.1.0.
</div>
<div id="ref-signorelli2024" class="csl-entry" role="listitem">
M. Signorelli and S. Retif. An empirical appraisal of methods for the dynamic prediction of survival with numerous longitudinal predictors. <em>arXiv preprint arXiv:2403.14336</em>, 2024.
</div>
<div id="ref-signorelli2021" class="csl-entry" role="listitem">
M. Signorelli, P. Spitali, C. Al-Khalili Sgyziarto, The Mark-MD Consortium and R. Tsonaka. Penalized regression calibration: A method for the prediction of survival outcomes using complex longitudinal and high-dimensional data. <em>Statistics in Medicine</em>, 40(27): 6178–6196, 2021.
</div>
<div id="ref-simon2011" class="csl-entry" role="listitem">
N. Simon, J. Friedman, T. Hastie and R. Tibshirani. <span class="nocase">Regularization paths for Cox’s proportional hazards model via coordinate descent</span>. <em>Journal of statistical software</em>, 39(5): 1, 2011.
</div>
<div id="ref-steyerberg2009" class="csl-entry" role="listitem">
E. W. Steyerberg. <em>Clinical prediction models.</em> Springer, 2009.
</div>
<div id="ref-therneau2000" class="csl-entry" role="listitem">
T. M. Therneau and P. M. Grambsch. <span class="nocase">Modeling survival data: extending the Cox model</span>. 2000.
</div>
<div id="ref-vanhouwelingen2007" class="csl-entry" role="listitem">
H. C. Van Houwelingen. Dynamic prediction by landmarking in event history analysis. <em>Scandinavian Journal of Statistics</em>, 34(1): 70–85, 2007.
</div>
<div id="ref-verweij1994" class="csl-entry" role="listitem">
P. J. Verweij and H. C. Van Houwelingen. Penalized likelihood in <span>C</span>ox regression. <em>Statistics in Medicine</em>, 13(23-24): 2427–2436, 1994.
</div>
<div id="ref-zou2005" class="csl-entry" role="listitem">
H. Zou and T. Hastie. Regularization and variable selection via the elastic net. <em>Journal of the Royal Statistical Society: Series B</em>, 67(2): 301–320, 2005.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Signorelli, "pencal: an R Package for the Dynamic Prediction of Survival with Many Longitudinal Predictors", The R Journal, 2025</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2024-014,
  author = {Signorelli, Mirko},
  title = {pencal: an R Package for the Dynamic Prediction of Survival with Many Longitudinal Predictors},
  journal = {The R Journal},
  year = {2025},
  note = {https://doi.org/10.32614/RJ-2024-014},
  doi = {10.32614/RJ-2024-014},
  volume = {16},
  issue = {2},
  issn = {2073-4859},
  pages = {134-153}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
