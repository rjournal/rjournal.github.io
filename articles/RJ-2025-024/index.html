<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
      margin-bottom: 0em;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>QTE.RD: An R Package for Quantile Treatment Effects in Regression-Discontinuity Designs</title>

<meta property="description" itemprop="description" content="The QTE.RD package provides methods to test, estimate, and conduct&#10;uniform inference on quantile treatment effects in sharp regression&#10;discontinuity designs, allowing for covariates, and implementing&#10;robust bias correction. The package offers four main functions for&#10;estimating quantile treatment effects and uniform confidence bands,&#10;testing hypotheses related to treatment effects, selecting bandwidths&#10;using cross-validation or mean squared error criteria, and visualizing&#10;the estimated effects and confidence bands. This note includes an&#10;empirical illustration of the package&#39;s functionality using data on&#10;the impact of tracking on student achievement."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2025-024/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2025-10-21"/>
<meta property="article:created" itemprop="dateCreated" content="2025-10-21"/>
<meta name="article:author" content="Zhongjun Qu"/>
<meta name="article:author" content="Jungmo Yoon"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="QTE.RD: An R Package for Quantile Treatment Effects in Regression-Discontinuity Designs"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="The QTE.RD package provides methods to test, estimate, and conduct&#10;uniform inference on quantile treatment effects in sharp regression&#10;discontinuity designs, allowing for covariates, and implementing&#10;robust bias correction. The package offers four main functions for&#10;estimating quantile treatment effects and uniform confidence bands,&#10;testing hypotheses related to treatment effects, selecting bandwidths&#10;using cross-validation or mean squared error criteria, and visualizing&#10;the estimated effects and confidence bands. This note includes an&#10;empirical illustration of the package&#39;s functionality using data on&#10;the impact of tracking on student achievement."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2025-024/"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="QTE.RD: An R Package for Quantile Treatment Effects in Regression-Discontinuity Designs"/>
<meta property="twitter:description" content="The QTE.RD package provides methods to test, estimate, and conduct&#10;uniform inference on quantile treatment effects in sharp regression&#10;discontinuity designs, allowing for covariates, and implementing&#10;robust bias correction. The package offers four main functions for&#10;estimating quantile treatment effects and uniform confidence bands,&#10;testing hypotheses related to treatment effects, selecting bandwidths&#10;using cross-validation or mean squared error criteria, and visualizing&#10;the estimated effects and confidence bands. This note includes an&#10;empirical illustration of the package&#39;s functionality using data on&#10;the impact of tracking on student achievement."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2025-024/"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="QTE.RD: An R Package for Quantile Treatment Effects in Regression-Discontinuity Designs"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2025-024"/>
<meta name="citation_pdf_url" content="RJ-2025-024.pdf"/>
<meta name="citation_volume" content="17"/>
<meta name="citation_issue" content="3"/>
<meta name="citation_doi" content="10.32614/RJ-2025-024"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="69"/>
<meta name="citation_lastpage" content="88"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2025/10/21"/>
<meta name="citation_publication_date" content="2025/10/21"/>
<meta name="citation_author" content="Zhongjun Qu"/>
<meta name="citation_author_institution" content="Department of Economics"/>
<meta name="citation_author" content="Jungmo Yoon"/>
<meta name="citation_author_institution" content="College of Economics and Finance"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Regression-discontinuity analysis: An alternative to the ex post facto experiment;citation_publisher=American Psychological Association;citation_volume=51;citation_author=Donald L Thistlethwaite;citation_author=Donald T Campbell"/>
  <meta name="citation_reference" content="citation_title=Local linear quantile regression;citation_publisher=American Statistical Association;citation_volume=93;citation_issn=01621459;citation_author=Keming Yu;citation_author=M. C. Jones"/>
  <meta name="citation_reference" content="citation_title=Uniform inference on quantile effects under sharp regression discontinuity designs;citation_volume=37;citation_author=Zhongjun Qu;citation_author=Jungmo Yoon"/>
  <meta name="citation_reference" content="citation_title=Inference on conditional quantile processes in partially linear models with applications to the impact of unemployment benefits;citation_author=Zhongjun Qu;citation_author=Jungmo Yoon;citation_author=Pierre Perron"/>
  <meta name="citation_reference" content="citation_title=Robust uniform inference for quantile treatment effects in regression discontinuity designs;citation_volume=211;citation_author=Harold D. Chiang;citation_author=Yu-Chin Hsu;citation_author=Yuya Sasaki"/>
  <meta name="citation_reference" content="citation_title=Peer effects, teacher incentives, and the impact of tracking: Evidence from a randomized evaluation in Kenya;citation_volume=101;citation_author=Esther Duflo;citation_author=Pascaline Dupas;citation_author=Michael Kremer"/>
  <meta name="citation_reference" content="citation_title=Nonparametrics: Statistical methods based on ranks;citation_publisher=Holden-Day, San Francisco.;citation_author=E. L. Lehmann"/>
  <meta name="citation_reference" content="citation_title=Empirical probability plots and statistical inference for nonlinear models in the two-sample case;citation_publisher=Institute of Mathematical Statistics;citation_volume=2;citation_issn=00905364;citation_author=Kjell Doksum"/>
  <meta name="citation_reference" content="citation_title=Quantile treatment effects in the regression discontinuity design;citation_volume=168;citation_issn=0304-4076;citation_author=Brigham R. Frandsen;citation_author=Markus Frölich;citation_author=Blaise Melly"/>
  <meta name="citation_reference" content="citation_title=Robust nonparametric confidence intervals for regression-discontinuity designs;citation_publisher=Wiley Online Library;citation_volume=82;citation_author=Sebastian Calonico;citation_author=Matias D Cattaneo;citation_author=Rocio Titiunik"/>
  <meta name="citation_reference" content="citation_title=Regression discontinuity designs using covariates;citation_volume=101;citation_author=Sebastian Calonico;citation_author=Matias D. Cattaneo;citation_author=Max H. Farrell;citation_author=Rocío Titiunik"/>
  <meta name="citation_reference" content="citation_title=Regression discontinuity designs: A guide to practice;citation_volume=142;citation_issn=0304-4076;citation_author=Guido W. Imbens;citation_author=Thomas Lemieux"/>
  <meta name="citation_reference" content="citation_title=Regression discontinuity in time: Considerations for empirical applications;citation_volume=10;citation_doi=10.1146/annurev-resource-121517-033306;citation_author=Catherine Hausman;citation_author=David S. Rapson"/>
  <meta name="citation_reference" content="citation_title=Quantile regression;citation_publisher=Cambridge University Press;citation_author=Roger Koenker"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","date_received","journal","volume","issue","slug","citation_url","packages","preview","bibliography","CTV","legacy_pdf","legacy_converted","output","draft","pdf_url","doi","creative_commons","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["QTE.RD: An R Package for Quantile Treatment Effects in Regression-Discontinuity Designs"]},{"type":"character","attributes":{},"value":["The QTE.RD package provides methods to test, estimate, and conduct\nuniform inference on quantile treatment effects in sharp regression\ndiscontinuity designs, allowing for covariates, and implementing\nrobust bias correction. The package offers four main functions for\nestimating quantile treatment effects and uniform confidence bands,\ntesting hypotheses related to treatment effects, selecting bandwidths\nusing cross-validation or mean squared error criteria, and visualizing\nthe estimated effects and confidence bands. This note includes an\nempirical illustration of the package's functionality using data on\nthe impact of tracking on student achievement."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Zhongjun Qu"]},{"type":"character","attributes":{},"value":["Department of Economics"]},{"type":"character","attributes":{},"value":["Boston University","USA","[qu@bu.edu](qu@bu.edu){.uri}\n"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Jungmo Yoon"]},{"type":"character","attributes":{},"value":["College of Economics and Finance"]},{"type":"character","attributes":{},"value":["Hanyang University","Korea, South","ORCID: 0000-0002-6686-4739","[jmyoon@hanyang.ac.kr](jmyoon@hanyang.ac.kr){.uri}\n"]}]}]},{"type":"character","attributes":{},"value":["2025-10-21"]},{"type":"character","attributes":{},"value":["2024-10-01"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[69]},{"type":"integer","attributes":{},"value":[88]}]},{"type":"integer","attributes":{},"value":[17]},{"type":"integer","attributes":{},"value":[3]},{"type":"character","attributes":{},"value":["RJ-2025-024"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2025-024"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["QTE.RD","qte","quantreg.nonpar"]},{"type":"list","attributes":{},"value":[]}]},{"type":"character","attributes":{},"value":["preview.png"]},{"type":"character","attributes":{},"value":["qu_yoon.bib"]},{"type":"character","attributes":{},"value":["CausalInference"]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","mathjax","md_extension"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"]},{"type":"character","attributes":{},"value":["-tex_math_single_backslash"]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["RJ-2025-024.pdf"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2025-024"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["/home/mitchell/R/x86_64-pc-linux-gnu-library/4.5/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2025-024/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["figures/rct_qte_age_new.pdf","figures/rct_qte_age_new.png","figures/rct_qte_four_groups_new.pdf","figures/rct_qte_four_groups_new.png","figures/rdd_condQ_uncond_v2_new.pdf","figures/rdd_condQ_uncond_v2_new.png","figures/rdd_qte_gender_new.pdf","figures/rdd_qte_gender_new.png","figures/rdd_qte_unconditional_new.pdf","figures/rdd_qte_unconditional_new.png","figures.zip","qu_yoon.bib","qu_yoon.tex","RJ-2025-024_files/anchor-4.2.2/anchor.min.js","RJ-2025-024_files/bowser-1.9.3/bowser.min.js","RJ-2025-024_files/distill-2.2.21/template.v2.js","RJ-2025-024_files/header-attrs-2.30/header-attrs.js","RJ-2025-024_files/jquery-3.6.0/jquery-3.6.0.js","RJ-2025-024_files/jquery-3.6.0/jquery-3.6.0.min.js","RJ-2025-024_files/jquery-3.6.0/jquery-3.6.0.min.map","RJ-2025-024_files/popper-2.6.0/popper.min.js","RJ-2025-024_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2025-024_files/tippy-6.2.7/tippy-light-border.css","RJ-2025-024_files/tippy-6.2.7/tippy.css","RJ-2025-024_files/tippy-6.2.7/tippy.umd.min.js","RJ-2025-024_files/webcomponents-2.0.0/webcomponents.js","RJournal.sty","RJwrapper.log","RJwrapper.tex"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.30/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Mathjax config (add automatic linebreaks when supported)
      // MathJax = {
      //    tex: {
      //        inlineMath: [['$', '$'], ['\\(', '\\)']],
      //        displayMath: [['$$', '$$'], ['\\[', '\\]']],
      //        tags: 'ams',
      //        multline: true,
      //    },
      //    options: {
      //        linebreaks: { automatic: true },
      //    },
      // };

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      
      // Conditionally add supplementary files button
      if (document.getElementById('supplementary-materials')) {
        // create element safely
        const btn_suppl = document.createElement('a');
        btn_suppl.href = slug + '.zip';
        btn_suppl.className = 'dt-tag';
        btn_suppl.innerHTML = '<i class="fas fa-file-zipper"></i> Supplement';
        buttons.append(btn_suppl);
      }

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").filter(function() {
        return !$(this).hasClass("subtitle");
      }).first();
      if (tpar) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append(tpar) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"QTE.RD: An R Package for Quantile Treatment Effects in Regression-Discontinuity Designs","description":"The QTE.RD package provides methods to test, estimate, and conduct\nuniform inference on quantile treatment effects in sharp regression\ndiscontinuity designs, allowing for covariates, and implementing\nrobust bias correction. The package offers four main functions for\nestimating quantile treatment effects and uniform confidence bands,\ntesting hypotheses related to treatment effects, selecting bandwidths\nusing cross-validation or mean squared error criteria, and visualizing\nthe estimated effects and confidence bands. This note includes an\nempirical illustration of the package's functionality using data on\nthe impact of tracking on student achievement.","doi":"10.32614/RJ-2025-024","authors":[{"author":"Zhongjun Qu","authorURL":"#","affiliation":"Department of Economics","affiliationURL":"#","orcidID":""},{"author":"Jungmo Yoon","authorURL":"#","affiliation":"College of Economics and Finance","affiliationURL":"#","orcidID":""}],"publishedDate":"2025-10-21T00:00:00.000+00:00","citationText":"Qu & Yoon, 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues/2025-4">Current</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../submissions.html">Submit</a>
<a href="../../contribute.html">Contribute</a>
<a href="../../editors.html">Editorial board</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>QTE.RD: An R Package for Quantile Treatment Effects in Regression-Discontinuity Designs</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>The QTE.RD package provides methods to test, estimate, and conduct
uniform inference on quantile treatment effects in sharp regression
discontinuity designs, allowing for covariates, and implementing
robust bias correction. The package offers four main functions for
estimating quantile treatment effects and uniform confidence bands,
testing hypotheses related to treatment effects, selecting bandwidths
using cross-validation or mean squared error criteria, and visualizing
the estimated effects and confidence bands. This note includes an
empirical illustration of the package’s functionality using data on
the impact of tracking on student achievement.</p></p>
</div>

<div class="d-byline">
  Zhongjun Qu  (Department of Economics)
  
,   Jungmo Yoon  (College of Economics and Finance)
  
<br/>2025-10-21
</div>

<div class="d-article">
<div class="article">
<h3 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h3>
<p>The regression discontinuity (RD) design <span class="citation" data-cites="1960.Thistlethwaite.Campbell">(<a href="#ref-1960.Thistlethwaite.Campbell" role="doc-biblioref">Thistlethwaite and Campbell 1960</a>)</span>
has become an important methodology for identifying and estimating
causal effects from observational data. Under a sharp RD design, the
assignment to a treatment is fully determined by whether the value of a
covariate, known as the running variable, surpasses a fixed cutoff. The
randomization near the cutoff allows for the estimation of treatment
effects by comparing individuals above the threshold with those below
it. To date, the majority of studies in the RD literature have focused
on the average treatment effect (ATE).</p>
<p>Treatment effects are often heterogeneous, and the concept of quantile
treatment effects (QTE; <span class="citation" data-cites="1975.Lehmann">Lehmann (<a href="#ref-1975.Lehmann" role="doc-biblioref">1975</a>)</span>, and <span class="citation" data-cites="1974.Doksum">Doksum (<a href="#ref-1974.Doksum" role="doc-biblioref">1974</a>)</span>) offers a
flexible framework for documenting the heterogeneity. Four key issues
often arise in such contexts: 1) Constructing a uniform confidence band
that covers the quantile treatment effects at a given confidence level;
2) Testing the statistical significance of the treatment effect within a
given quantile range (Treatment Significance); 3) Assessing whether the
treatment effects are equal across all quantiles (Treatment
Homogeneity); 4) Determining if the effects are uniformly positive or
uniformly negative within this quantile range (Treatment Unambiguity).</p>
<p>Furthermore, if heterogeneity is detected by examining the above issues,
utilizing covariates can help pinpoint the source of the heterogeneity.
For instance, consider a sample comprising both males and females. If
the quantile treatment effects are equal within each gender group but
differ between groups, introducing a gender dummy into the model will
reveal homogeneous quantile treatment effects for both groups. In this
context, QTE estimates plotted as a function of the quantile index
should show that the effects are identical within each group but differ
between them. However, if the QTE demonstrates a non-zero slope in
quantile for any subgroup, it indicates that treatment heterogeneity
persists even after accounting for initial covariates. This then
indicates the need for further analysis with additional explanatory
variables to fully understand the underlying heterogeneity.</p>
<p>These considerations motivated the study of <span class="citation" data-cites="2019.Qu.Yoon">Qu and Yoon (<a href="#ref-2019.Qu.Yoon" role="doc-biblioref">2019</a>)</span> and
<span class="citation" data-cites="2024.Qu.Yoon.Perron">Qu et al. (<a href="#ref-2024.Qu.Yoon.Perron" role="doc-biblioref">2024</a>)</span>. The former study develops methods for conducting
uniform inference on QTEs for sharp RD designs without covariates, while
the latter paper extends the methods to allow for covariates. The
proposed package implements their methods in an easy-to-use fashion.
Four functions are provided:</p>
<ol type="1">
<li><p><code>rd.qte()</code>. This function provides point estimates of QTEs over a
range of quantiles and a uniform confidence band that covers these
effects at a given confidence level. The estimation is based on
local-linear regressions. The user can specify whether or not to
include any covariates and how many of them to include in the
regression. The function provides results either without any bias
correction or with robust bias corrections (<span class="citation" data-cites="2024.Qu.Yoon.Perron">Qu et al. (<a href="#ref-2024.Qu.Yoon.Perron" role="doc-biblioref">2024</a>)</span>).</p></li>
<li><p><code>rdq.test()</code>. This function provides testing results for three
hypotheses on the treatment effects outlined above: Treatment
Significance, Homogeneity, and Unambiguity. The user can choose
whether to allow for covariates, and whether to conduct robust bias
correction. The critical values are obtained via simulations when
implementing these tests.</p></li>
<li><p><code>rdq.bandwidth()</code>. This function implements two bandwidth selection
rules: the cross-validation bandwidth and the MSE optimal bandwidth.
In practice, one can apply both methods to examine result
sensitivity.</p></li>
<li><p><code>plot.qte()</code>. This function generates figures summarizing the QTE
estimates and their uniform confidence bands, helping users
visualize the results from testing and estimation.</p></li>
</ol>
<p>For the validity of these methods, the covariates must be balanced at
the cutoff, meaning that their distribution does not change
discontinuously at the RD threshold. Correlations with the running
variable are permitted. Bias correction is applied to ensure that the
tests and confidence intervals achieve correct asymptotic coverage. This
is necessary because the underlying nonparametric functions are
approximated using local linear methods, and omitted terms can distort
inference if not properly accounted for—a well-known issue in the
nonparametric estimation literature. Our proposed procedure not only
estimates the bias but also accounts for the uncertainty in that
estimation, which is why we refer to it as robust bias correction.</p>
<p>When implementing these methods, users need to supply the following
input: the outcome variable in <code>y</code>, treatment status in <code>d</code> (0 or 1),
independent variables in <code>x</code>, and a quantile range <span class="math inline">\(\mathcal{T}\)</span>. The
first column of <code>x</code> is a scalar running variable, and the remaining
columns in <code>x</code> include additional covariates, which can be discrete or
continuous. When there are no covariates, <code>x</code> is just a column vector of
the running variable.</p>
<p>Let <span class="math inline">\(x_0\)</span> denote the cutoff and <span class="math inline">\(z_0\)</span> the value of the remaining
covariates at which to evaluate the effects (e.g., if a female dummy is
included, <span class="math inline">\(z_0=1\)</span> indicates the female subgroup). The main objects of
the analysis are the conditional quantile functions on the right and
left sides of the cutoff: <span class="math inline">\(Q(\tau|x^{+}_0,z_0)\)</span> and
<span class="math inline">\(Q(\tau|x^{-}_0,z_0)\)</span>, and the <span class="math inline">\(\text{QTE}\)</span> at this cutoff:
<span class="math inline">\(Q(\tau|x_{0}^{+},z_{0}) - Q(\tau|x_{0}^{-},z_{0})\)</span>.</p>
<p>The above functions can also be used to analyze data from a randomized
controlled trial (RCT). In this case, the two sides of the cutoff are
replaced by observations from the control and treatment groups,
respectively. Let <span class="math inline">\(Q_{1}(\tau|x,z)\)</span> be the conditional quantile function
of the treatment (<span class="math inline">\(d=1\)</span>) group and <span class="math inline">\(Q_{0}(\tau|x,z)\)</span> be that of the
control (<span class="math inline">\(d=0\)</span>) group, then the QTE at <span class="math inline">\((x,z)\)</span> is defined as
<span class="math inline">\(Q_{1}(\tau|x,z) - Q_{0}(\tau|x,z)\)</span>. If we have <span class="math inline">\(x=x_0\)</span> for some <span class="math inline">\(x_0\)</span>,
the estimate we provide will correspond to the local treatment effect
near the chosen <span class="math inline">\(x_0\)</span>, placing no restriction on the effects away from
<span class="math inline">\(x_0\)</span>.</p>
<p>Unlike in the RD setting, the choice of <span class="math inline">\(x\)</span> in the RCT setting involves
making a modeling decision: <span class="math inline">\(x\)</span> typically represents a baseline variable
that is highly predictive of the outcome, while <span class="math inline">\(z\)</span> is used to examine
additional treatment heterogeneity. This approach allows quantile
treatment effects to vary nonparametrically with the baseline variable
and linearly with additional covariates. In our empirical example, we
use the baseline test score as <span class="math inline">\(x\)</span>. Because it is highly predictive of
the outcome (the endline test score), it is natural to examine the
effects of tracking separately for students at different points in the
initial performance distribution. To capture further heterogeneity, we
use student and teacher characteristics as covariates <span class="math inline">\(z\)</span>, which enables
us to examine how treatment effects vary linearly with observable
student and classroom factors.</p>
<p>There are several <em>R</em> and <em>Stata</em> packages available for estimating QTE.
Table 1 provides a comparison of these packages with
<a href="https://CRAN.R-project.org/package=QTE.RD"><strong>QTE.RD</strong></a>. As indicated in
the table, to our knowledge, there is currently no <em>R</em> package for
estimating QTEs under RD designs, even for the simplest setting without
covariates. There are, however, <em>Stata</em> functions <strong>rddqte</strong> and
<strong>rdqte</strong> that can be used in RD designs by applying methods in
<span class="citation" data-cites="2012.Frandsen.Frolich.Melly">Frandsen et al. (<a href="#ref-2012.Frandsen.Frolich.Melly" role="doc-biblioref">2012</a>)</span> and <span class="citation" data-cites="Chiang.Hsu.sasaki.2019">Chiang et al. (<a href="#ref-Chiang.Hsu.sasaki.2019" role="doc-biblioref">2019</a>)</span>. These <em>Stata</em>
functions are particularly useful for fuzzy designs. But they do not
offer methods allowing heterogeneous effects by groups or continuous
covariates. So if the goal is to explore the heterogeneity in full
generality for sharp RD designs, it is suitable to use
<a href="https://CRAN.R-project.org/package=QTE.RD"><strong>QTE.RD</strong></a>.</p>
<p>Additionally, some <em>R</em> and <em>Stata</em> packages are available for estimating
QTE under alternative identification strategies. The R packages
<a href="https://CRAN.R-project.org/package=qte"><strong>qte</strong></a> and
<a href="https://CRAN.R-project.org/package=quantreg.nonpar"><strong>quantreg.nonpar</strong></a>
rely on the conditional independence (or unconfoundedness) assumption
between the potential outcomes and the selection variable. The Stata
package <strong>ivqte</strong> is based on the availability of instrumental
variables. While they are useful for these alternative research designs,
they are not directly applicable to RD designs.</p>
<div id="tab:T1">
<table>
<caption>Table 1: Comparisons of R/Stata packages and functions</caption>
<colgroup>
<col style="width: 16%" />
<col style="width: 14%" />
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 8%" />
<col style="width: 11%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th>Package Name</th>
<th>Statistical Platform</th>
<th>Research Design</th>
<th>Hetero. Effects</th>
<th style="text-align: right;">Conf. Band</th>
<th style="text-align: right;">Bias Correction</th>
<th>Regression Model</th>
<th>Estimation Method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>qte</td>
<td>R</td>
<td>CI</td>
<td>✗</td>
<td style="text-align: right;">pointw</td>
<td style="text-align: right;">✗</td>
<td>QR</td>
<td>Linear</td>
</tr>
<tr class="even">
<td>ivqte</td>
<td>Stata</td>
<td>IV</td>
<td>✗</td>
<td style="text-align: right;">pointw</td>
<td style="text-align: right;">✗</td>
<td>DR</td>
<td>Linear</td>
</tr>
<tr class="odd">
<td>quantreg.nonpar</td>
<td>R</td>
<td>CI</td>
<td>✗</td>
<td style="text-align: right;">uniform</td>
<td style="text-align: right;">✓</td>
<td>QR</td>
<td>Series</td>
</tr>
<tr class="even">
<td>rddqte</td>
<td>Stata</td>
<td>RDD</td>
<td>✗</td>
<td style="text-align: right;">pointw</td>
<td style="text-align: right;">✗</td>
<td>DR</td>
<td>Local</td>
</tr>
<tr class="odd">
<td>rdqte</td>
<td>Stata</td>
<td>RDD</td>
<td>✗</td>
<td style="text-align: right;">uniform</td>
<td style="text-align: right;">✓</td>
<td>DR</td>
<td>Local</td>
</tr>
<tr class="even">
<td>QTE.RD</td>
<td>R</td>
<td>RDD</td>
<td>✓</td>
<td style="text-align: right;">uniform</td>
<td style="text-align: right;">✓</td>
<td>QR</td>
<td>Local</td>
</tr>
</tbody>
</table>
<p>Note: ‘CI’ = conditional independence (unconfoundedness); ‘IV’ =
instrumental variable; ‘RDD’ = regression discontinuity design; ‘pointw’
= confidence band is pointwise w.r.t. the quantile level <span class="math inline">\(\tau\)</span>;
‘uniform’ = confidence band is uniform in <span class="math inline">\(\tau\)</span>. ‘QR’ = quantile
regression; ‘DR’ = distributional regression; ‘Linear’ = linear
regression; ‘Series’ = series estimation; ‘Local’ = local polynomial
regression. The symbol <span class="math inline">\(\checkmark\)</span> means that the indicated feature is
available.</p>
</div>
<p>We apply the functions of this package to study the impact of tracking
(assigning students into separate classes by prior achievement) on
student achievement using the dataset of <span class="citation" data-cites="Duflo.Dupas.Kremer.2011">Duflo et al. (<a href="#ref-Duflo.Dupas.Kremer.2011" role="doc-biblioref">2011</a>)</span>. Their
experimental data includes 121 primary schools in Kenya which received
funds in 2005 to hire a new teacher and split their single first-grade
class into two sections. The schools were randomly divided into the
treated group, 61 tracking schools, and the control group, 60
non-tracking schools. In tracking schools, students were assigned to
sections based on baseline test scores. In non-tracking schools,
students were randomly assigned.</p>
<p>The experimental design has rich random variations, featuring elements
of both randomized controlled trials (RCT) and RD. By comparing tracking
and non-tracking schools, that is, by exploiting the RCT structure, one
can study the effect of tracking on all students. Additionally, by
analyzing median students within tracking schools, that is, by
exploiting the RD structure, one can study the effect of tracking on
marginal students who barely made or missed the opportunity of being
assigned to a high ability section. Both structures were exploited in
<span class="citation" data-cites="Duflo.Dupas.Kremer.2011">Duflo et al. (<a href="#ref-Duflo.Dupas.Kremer.2011" role="doc-biblioref">2011</a>)</span>, though they focused on average effects instead
of quantile effects.</p>
<p>The experiment lasted for 18 months. The main outcome variable is the
sum of math and language scores on the endline tests administered in all
schools at the end of the program. <span class="citation" data-cites="Duflo.Dupas.Kremer.2011">Duflo et al. (<a href="#ref-Duflo.Dupas.Kremer.2011" role="doc-biblioref">2011</a>)</span> also
examined the long-run effect using a follow-up test which was given one
year after the tracking ended. We analyze the short-term effect by
focusing on the endline test. To study the heterogeneity in effects, we
use as covariates the baseline test score, students’ gender and age (at
the endline test), and whether teachers are civil servants or contract
teachers.</p>
<p>From the RD design, we find no evidence that marginal students assigned
to the lower section (i.e., those falling just below the median of the
initial achievement distribution) performed any worse than those
assigned to the upper section, despite the fact that the latter group
had higher achieving peers. This finding, while confirming
<span class="citation" data-cites="Duflo.Dupas.Kremer.2011">Duflo et al. (<a href="#ref-Duflo.Dupas.Kremer.2011" role="doc-biblioref">2011</a>)</span>, is more definitive in that it documents the
lack of effect, not only on average, but also at any points of the
outcome distribution. Examining heterogeneity across groups by
covariates, we find that the effects of assigning to an upper section
are negative for girls but positive for boys across quantiles. In
particular, female students who were at the bottom of the endline scores
may fare worse if they were assigned to the upper section. However,
these effects are mostly statistically insignificant, suggesting that a
larger dataset is needed to draw more precise conclusions regarding this
heterogeneity.</p>
<p>From the RCT design, we find uniformly positive effects of tracking.
Test scores were higher in tracking schools than in non-tracking schools
up to 0.351 standard deviations. The null hypothesis of no effect is
firmly rejected. The biggest effects can be found for students who were
at the middle of the baseline test distribution, male and younger
students, and those taught by contract teachers. Our findings from the
RCT support that tracking may be beneficial to all students, not just to
those assigned to high achievement sections. If the peer effect is the
dominant factor in the effect of tracking, the marginal students who are
assigned to the lower section may have much to lose. But our findings
from the RDD indicate that even this group did not suffer at all. This
can be explained if, as <span class="citation" data-cites="Duflo.Dupas.Kremer.2011">Duflo et al. (<a href="#ref-Duflo.Dupas.Kremer.2011" role="doc-biblioref">2011</a>)</span> argued, tracking allows
teachers to closely match their instruction to the need of students and
benefits all students.</p>
<p>Below, we first review the statistical methods implemented in the
package, and after that we will provide details on the implementation in
the context of the empirical application.</p>
<h3 data-number="2" id="methods-for-quantile-treatment-effects-with-and-without-covariates"><span class="header-section-number">2</span> Methods for quantile treatment effects with and without covariates</h3>
<p>This section presents materials in the following order: the model and
the issues of interest, the main estimation steps along with the
bandwidth selection methods, the uniform confidence bands with and
without bias correction, and finally, the computation of tests related
to treatment significance, homogeneity, and unambiguity. We also
highlight that the methods can be used to estimate local effects in RCTs
in addition to RD designs.</p>
<h4 class="unnumbered" data-number="2.1" id="model">Model</h4>
<p>Let <span class="math inline">\(y\)</span> represent the outcome variable, <span class="math inline">\(x\)</span> be the running variable, and
<span class="math inline">\(z\)</span> (<span class="math inline">\(q\times
1\)</span>) be a set of covariates. We focus on the sharp RD design in which the
treatment status shifts at <span class="math inline">\(x=x_0\)</span>: no one below <span class="math inline">\(x_0\)</span> is treated, and
everyone above <span class="math inline">\(x_0\)</span> is treated. For theoretical analysis, define two
local neighborhoods of <span class="math inline">\(x_0\)</span>: the left neighborhood
<span class="math inline">\(\mathbb{B}^{-}(x_{0})=[x_{0}-\delta ,x_{0})\)</span> and the right neighborhood
<span class="math inline">\(\mathbb{B}%
^{+}(x_{0})=[x_{0},x_{0}+\delta ]\)</span> with <span class="math inline">\(\delta\)</span> a small positive
constant. With <span class="math inline">\(Q(\tau |x,z)\)</span> denoting the <span class="math inline">\(\tau\)</span>-th conditional
quantile of <span class="math inline">\(y\)</span> given <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span>, the model we assume to hold is given
by:
<span class="math display">\[\begin{aligned}
Q(\tau |x,z) &amp;=&amp;g_{1}(x,\tau )+z^{\prime }\beta _{1}(\tau )+xz^{\prime
}\gamma _{1}(\tau )\text{ over }\tau \in \mathcal{T}\text{ \ for any }x\in
\mathbb{B}^{-}(x_{0}), \\
Q(\tau |x,z) &amp;=&amp;g_{2}(x,\tau )+z^{\prime }\beta _{2}(\tau )+xz^{\prime
}\gamma _{2}(\tau )\text{ over }\tau \in \mathcal{T}\text{ \ for any }x\in
\mathbb{B}^{+}(x_{0}),
\end{aligned}\]</span>
where <span class="math inline">\(g_{1}(x,\tau )\)</span> and <span class="math inline">\(g_{2}(x,\tau )\)</span> are continuous nonparametric
functions of <span class="math inline">\(x\)</span> and <span class="math inline">\(\tau\)</span>. For a given <span class="math inline">\(z\)</span>, the QTE at the <span class="math inline">\(\tau\)</span>-th
quantile is defined as
<span class="math display">\[\begin{aligned}
\delta (\tau|z )=\delta (\tau|x_0,z )=\lim_{x\downarrow x_{0}}Q(\tau |x,z)-\lim_{x\uparrow
x_{0}}Q(\tau |x,z),
\end{aligned}\]</span>
where <span class="math inline">\(\lim_{x\downarrow x_{0}}\)</span> denotes the value of the function as
<span class="math inline">\(x\)</span> approaches the limit from the right side of the cutoff, and
<span class="math inline">\(\lim_{x\uparrow x_{0}}\)</span> from the left side of the cutoff. Explicit
conditions on the model are stated in Assumptions 1–4 of
<span class="citation" data-cites="2024.Qu.Yoon.Perron">Qu et al. (<a href="#ref-2024.Qu.Yoon.Perron" role="doc-biblioref">2024</a>)</span>. These allow for correlations between the running
variable and the covariates.</p>
<p>We will denote the two right hand side limiting expressions by
<span class="math inline">\(Q(\tau|x_{0}^{+},z)\)</span> and <span class="math inline">\(Q(\tau|x_{0}^{-},z)\)</span>, respectively. The
methods in this package primarily address the following issues:</p>
<ol type="1">
<li><p>Uniform Confidence Band. For any given <span class="math inline">\(z\)</span> and coverage level <span class="math inline">\(p\)</span>,
obtain a band <span class="math inline">\([L_{p}(\tau |z)\)</span>, <span class="math inline">\(U_{p}(\tau |z)]\)</span> such that
<span class="math inline">\(\Pr \{\delta (\tau|z )\in \lbrack L_{p}(\tau |z),U_{p}(\tau|z)]\)</span>
for all <span class="math inline">\(\tau \in \mathcal{T}\}\geq p\)</span> holds asymptotically.</p></li>
<li><p>Treatment Significance. Test <span class="math inline">\(H_{0}:\delta (\tau|z )=0\)</span> for all
<span class="math inline">\(\tau \in \mathcal{T}\)</span> against <span class="math inline">\(H_{1}:\delta (\tau|z )\neq 0\)</span> for
some <span class="math inline">\(\tau \in \mathcal{T}\)</span>.</p></li>
<li><p>Treatment Homogeneity. Test <span class="math inline">\(H_{0}:\delta (\tau|z )\)</span> is constant
over <span class="math inline">\(\mathcal{T}\)</span> against
<span class="math inline">\(H_{1}:\delta (\tau|z )\neq \delta (s|z )\)</span> for some
<span class="math inline">\(\tau ,s\in \mathcal{T}\)</span>.</p></li>
<li><p>Treatment Unambiguity. Test <span class="math inline">\(H_{0}:\delta (\tau|z )\geq 0\)</span> over
<span class="math inline">\(\mathcal{T}\)</span> against <span class="math inline">\(H_{1}:\delta (\tau|z )&lt;0\)</span> for some
<span class="math inline">\(\tau \in \mathcal{T}\)</span>. Alternatively, test <span class="math inline">\(\delta (\tau|z )\leq 0\)</span>
over <span class="math inline">\(\mathcal{T}\)</span> against <span class="math inline">\(\delta (\tau|z )&gt;0\)</span> for some
<span class="math inline">\(\tau \in \mathcal{T}\)</span>.</p></li>
</ol>
<h4 class="unnumbered" data-number="2.2" id="estimation">Estimation</h4>
<p>The estimation is based on local linear quantile regressions, in which
the conditional quantile functions on the two sides of the cutoff are
approximated by:
<span class="math display">\[\begin{aligned}
Q(\tau |x,z) &amp;\approx &amp;\alpha _{0}^{-}(\tau)+\alpha
_{1}^{-}(\tau)(x-x_{0})+z^{\prime }\beta ^{-}(\tau)+(x-x_{0})z^{\prime
}\gamma ^{-}(\tau)\ \  \text{(for x below the cutoff)},\\
Q(\tau |x,z) &amp;\approx &amp;\alpha _{0}^{+}(\tau)+\alpha
_{1}^{+}(\tau)(x-x_{0})+z^{\prime }\beta ^{+}(\tau)+(x-x_{0})z^{\prime
}\gamma ^{+}(\tau)\ \  \text{(for x above the cutoff)}.
\end{aligned}\]</span>
The interactive terms <span class="math inline">\((x-x_{0})z^{\prime}\gamma ^{-}(\tau)\)</span> and
<span class="math inline">\((x-x_{0})z^{\prime}\gamma ^{+}(\tau)\)</span> are important and they are
discussed below in Remark 1. The estimation solves the following two
minimization problems separately:
<span class="math display" id="eq:linear">\[\begin{aligned}
&amp; \min_{\alpha _{0}^{-},\alpha _{1}^{-},\beta ^{-},\gamma
^{-}}\sum_{i=1}^{n}\rho _{\tau }\left( y_{i}-\alpha _{0}^{-}-\alpha
_{1}^{-}(x_{i}-x_{0})-z_{i}^{\prime }\beta ^{-}-(x_{i}-x_{0})z_{i}^{\prime
}\gamma ^{-}\right) (1-d_{i})K\left( (x_{i}-x_{0})/b_{n,\tau }\right) ,\notag
\\
&amp; \min_{\alpha _{0}^{+},\alpha _{1}^{+},\beta ^{+},\gamma
^{+}}\sum_{i=1}^{n}\rho _{\tau }\left( y_{i}-\alpha _{0}^{+}-\alpha
_{1}^{+}(x_{i}-x_{0})-z_{i}^{\prime }\beta ^{+}-(x_{i}-x_{0})z_{i}^{\prime
}\gamma ^{+}\right) d_{i}K\left( (x_{i}-x_{0})/b_{n,\tau }\right) ,%\label{linear}
\end{aligned}   \tag{1}\]</span>
where <span class="math inline">\(n\)</span> is the sample size, <span class="math inline">\(x_{i}\)</span> is the running variable value for
individual <span class="math inline">\(i\)</span>, <span class="math inline">\(%
d_{i}=1(x_{i}\geq x_{0})\)</span> is the treatment indicator, <span class="math inline">\(z_{i}\)</span> is a set
of covariates, <span class="math inline">\(\rho _\tau\)</span> is the check function:
<span class="math inline">\(\rho_\tau(u)=u(\tau -1\{u&lt;0\})\)</span>, <span class="math inline">\(K(\cdot)\)</span> is a kernel function, and
<span class="math inline">\(b_{n,\tau }\)</span> is a quantile-dependent bandwidth discussed later. See
<span class="citation" data-cites="2005.Koenker">Koenker (<a href="#ref-2005.Koenker" role="doc-biblioref">2005</a>)</span> for a comprehensive treatment of quantile regressions and
<span class="citation" data-cites="1998.Yu.Jones">Yu and Jones (<a href="#ref-1998.Yu.Jones" role="doc-biblioref">1998</a>)</span> for local linear quantile regressions.</p>
<p>In the implementation, we solve the above two optimization problems for
an equidistant grid of quantiles over <span class="math inline">\(\mathcal{T}\)</span> and then apply
linear interpolation between adjacent quantiles to obtain continuous
functions over quantiles. This gives us the estimated conditional
quantile curves on the two sides of the cutoff:
<span class="math inline">\(\hat{Q}(\tau |x_0^{-},z)=\hat{\alpha}^{-}_{0}(x,\tau )+z^{\prime }\hat{\beta}^{-}(\tau ),\)</span>
and
<span class="math inline">\(\hat{Q}(\tau |x_0^{+},z)=\hat{\alpha}^{+}_{0}(x,\tau )+z^{\prime }\hat{\beta}^{+}(\tau ).\)</span>
The QTE estimate, prior to any bias correction, is given by
<span class="math display" id="eq:final">\[\hat{\delta}(\tau |z)=\hat{Q}(\tau |x_0^{+},z)-\hat{Q}(\tau |x_0^{-},z)%
\text{ \ for any }\tau \in \mathcal{T}.  \label{final}   \tag{2}\]</span></p>
<p>This QTE estimate is affected by a bias term that depends on the
second-order derivative of the conditional quantile function; its
expression is given in Corollary 2 of <span class="citation" data-cites="2024.Qu.Yoon.Perron">Qu et al. (<a href="#ref-2024.Qu.Yoon.Perron" role="doc-biblioref">2024</a>)</span>. The main
effect of this bias is to distort the coverage level of the confidence
band and the rejection frequency of the hypothesis tests under the null
hypothesis. This motivates the usage of bias-corrected estimates at the
cost of estimation efficiency. To estimate the bias, we first run two
local quadratic regressions for the two sides of the cutoff for each
<span class="math inline">\(\tau\)</span>. To that end, we solve the same minimization problem as the local
linear regression case, except the local linear approximation is
replaced by quadratic regression with the same bandwidth <span class="math inline">\(b_{n,\tau }\)</span>.
Then, the bias-corrected estimator is computed as (<span class="math inline">\(x\)</span> can be either
<span class="math inline">\(x_0^{+}\)</span> or <span class="math inline">\(x_0^{-}\)</span>): <span class="math inline">\(\hat{Q}(\tau |x,z)-\hat{%
B}_{v}(x,z,\tau )b_{n,\tau }^{2}\)</span>. The bias correction affects the
distribution of the QTE estimator, and our methods incorporate an extra
term into the distribution to account for this additional estimation
uncertainty motivated by <span class="citation" data-cites="2014.Calonico.Cattaneo.Titiunik">Calonico et al. (<a href="#ref-2014.Calonico.Cattaneo.Titiunik" role="doc-biblioref">2014</a>)</span>; see the
discussions in Subsection 2.4.</p>
<div class="remark">
<p><strong>Remark 1</strong>. <em>We now discuss how to interpret the estimates to ease the
application. If <span class="math inline">\(z_{i}\)</span> is a dummy variable, e.g., equal to one for
females, then the QTEs for men and women are given by
<span class="math inline">\(\alpha _{0}^{+}(\tau )-\alpha _{0}^{-}(\tau )\)</span> and <span class="math inline">\(%
\alpha _{0}^{+}(\tau )-\alpha _{0}^{-}(\tau )+\beta ^{+}(\tau )-\beta
^{-}(\tau )\)</span>. If <span class="math inline">\(z_{i}\)</span> is a continuous variable, then the QTE at
<span class="math inline">\(x=x_{0}\)</span> for <span class="math inline">\(z=z_{0}\)</span> is given by
<span class="math inline">\(\alpha _{0}^{+}(\tau )-\alpha _{0}^{-}(\tau
)+z_{0}^{\prime }(\beta ^{+}(\tau )-\beta ^{-}(\tau ))\)</span>. The interactive
term <span class="math inline">\((x_{i}-x_{0})z_{i}^{\prime }\)</span> makes
<span class="math inline">\(\partial Q(\tau |x,z)/\partial x\)</span> vary with <span class="math inline">\(z\)</span>. If <span class="math inline">\(z_{i}\)</span> is a binary
variable, then this slope is equal to <span class="math inline">\(%
\alpha _{1}^{+}\)</span> and <span class="math inline">\(\alpha _{1}^{+}+\gamma ^{+}\)</span> for <span class="math inline">\(z_{i}=0\)</span> and <span class="math inline">\(%
z_{i}=1\)</span>, respectively. It is essential to allow the coefficients of
<span class="math inline">\(z_{i}\)</span> to change at the cutoff, otherwise, the QTE estimate will be
biased if the treatment effects are heterogeneous across <span class="math inline">\(z\)</span> values.</em></p>
</div>
<div class="remark">
<p><strong>Remark 2</strong>. <em>Including covariates does not appear to improve
estimation efficiency in the quantile RD setting, because their role
differs from the mean RD case. To see this, consider two scenarios. In
both cases, suppose the running variable is <span class="math inline">\(x\)</span>, the cutoff is at <span class="math inline">\(x_0\)</span>,
and the covariate <span class="math inline">\(z\)</span> is binary (<span class="math inline">\(z = 0, 1\)</span>), representing two groups.
In the first scenario, the treatment effect is heterogeneous in <span class="math inline">\(z\)</span>. If
the model does not contain any covariates (i.e., <span class="math inline">\(z\)</span> is not included),
the RD estimator identifies the unconditional quantile treatment effect
over the groups. Once <span class="math inline">\(z\)</span> is included, the estimator recovers quantile
treatment effects separately for groups 0 and 1. That is, when
heterogeneity is present, including covariates leads to different
estimands. The resulting estimates are not directly comparable, and the
issue is therefore not efficiency. This contrasts with the RD-in-mean
setting, where including covariates does not change the estimand: the
intercept still identifies the average treatment effect, as shown in
<span class="citation" data-cites="Calonico2019">Calonico et al. (<a href="#ref-Calonico2019" role="doc-biblioref">2019</a>)</span>. In the second scenario, the treatment effect is
homogeneous across <span class="math inline">\(z\)</span>. Then, the true coefficient on the <span class="math inline">\(z = 1\)</span>
indicator is equal to zero, and including <span class="math inline">\(z\)</span> may actually reduce
efficiency, as it increases the number of estimated parameters without
reducing residual variation. For additional discussion and details, see
Section 3.1 in <span class="citation" data-cites="2024.Qu.Yoon.Perron">Qu et al. (<a href="#ref-2024.Qu.Yoon.Perron" role="doc-biblioref">2024</a>)</span>.</em></p>
</div>
<h4 class="unnumbered" data-number="2.3" id="bandwidth-selection">Bandwidth selection</h4>
<p>The package offers two methods to choose bandwidth parameters:
cross-validation and minimizing the MSE. In both cases, the bandwidth at
the median <span class="math inline">\(b_{n,0.5}\)</span> is determined first. This value is then used to
determine bandwidths at other quantiles, using the formula of
<span class="citation" data-cites="1998.Yu.Jones">Yu and Jones (<a href="#ref-1998.Yu.Jones" role="doc-biblioref">1998</a>)</span>:
<span class="math display" id="eq:relation">\[(b_{n,\tau }/b_{n,0.5})^{4+d}=2\tau \left( 1-\tau \right)
/[\pi \phi (\Phi ^{-1}(\tau ))^{2}]\text{ \ for }\tau \in \mathcal{T},
\label{relation}   \tag{3}\]</span>
where <span class="math inline">\(\phi\)</span> and <span class="math inline">\(\Phi\)</span> are the standard normal density and cumulative
distribution functions.</p>
<p><strong>Cross validation bandwidth:</strong> For a given candidate bandwidth,
estimate the conditional median at <span class="math inline">\((x_{i},z_{i})\)</span> by a local linear or
quadratic regression, treating <span class="math inline">\(x\)</span> as an interior or a boundary point,
leaving out <span class="math inline">\((y_{i},x_{i},z_{i})\)</span>. The goodness of fit is measured by
the difference between <span class="math inline">\(y_{i}\)</span> and the estimated conditional median.
Repeat the estimation and compute the mean absolute deviation over 50%
of the observations closest to <span class="math inline">\(x\)</span>. The cross-validation bandwidth
minimizes this mean absolute deviation.</p>
<p><strong>MSE-optimal bandwidth:</strong> First obtain a pilot bandwidth for the median
using leave-one-out cross validation. Then construct the MSE-optimal
bandwidth for the median by applying this pilot bandwidth to calculate
the necessary quantities in the bandwidth formula from Corollary 3 of
<span class="citation" data-cites="2024.Qu.Yoon.Perron">Qu et al. (<a href="#ref-2024.Qu.Yoon.Perron" role="doc-biblioref">2024</a>)</span>.</p>
<p>Providing two selection rules (the cross-validation bandwidth selection
rule and the MSE-optimal rule) allows users to assess the sensitivity of
their results to different choices. However, we note that, although the
cross-validation bandwidth is intuitive, its theoretical properties in
the current setting have not been formally studied. The package also
allows users to directly specify bandwidth values without using these
two methods, providing an additional channel for robustness analysis.</p>
<h4 class="unnumbered" data-number="2.4" id="uniform-confidence-band-withwithout-robust-bias-correction">Uniform confidence band with/without robust bias correction</h4>
<p>The confidence band we compute relies on the following asymptotic
approximation in Corollary 2 of <span class="citation" data-cites="2024.Qu.Yoon.Perron">Qu et al. (<a href="#ref-2024.Qu.Yoon.Perron" role="doc-biblioref">2024</a>)</span>:
<span class="math display">\[(nb_{n,\tau })^{1/2}(\hat{Q}(\tau |x,z)-Q(\tau |x,z)-b_{n,\tau
}^{2}B_{v}(x,z,\tau ))=D_{1,v}\left( x,z,\tau \right) +o_{p}\left( 1\right),\]</span>
where <span class="math inline">\(x\)</span> can be either <span class="math inline">\(x_0^{+}\)</span> or <span class="math inline">\(x_0^{-}\)</span>, <span class="math inline">\(B_{v}(x,z,\tau )\)</span> is a
bias term, and <span class="math inline">\(D_{1,v}\left( x,z,\tau \right)\)</span> converges to a Gaussian
process over <span class="math inline">\(\tau\)</span> with mean zero with a pivotal distribution
conditioning on the data, making it readily simulatable.</p>
<p>Using this approximation, the uniform confidence band without bias
correction (e.g., ignoring the bias) is computed as follows: Define
<span class="math inline">\(\sigma _{n,\tau}\)</span> to be an estimate of
<span class="math inline">\((nb_{n,\tau }^{d})^{-1/2}[\text{E}D_{1,v}\left( x,z,\tau \right) ^{2}]^{1/2}\)</span>,
obtained via simulations. Compute the band as
<span class="math inline">\([\hat{Q}(\tau |x,z)-\sigma
_{n,\tau }C_{p},\)</span> <span class="math inline">\(\hat{Q}(\tau |x,z)+\sigma _{n,\tau }C_{p}]\)</span>, where
<span class="math inline">\(C_{p}\)</span> is the <span class="math inline">\(p\)</span>-th percentile of <span class="math inline">\(%
\sup_{\tau \in \mathcal{T}}|D_{1,v}\left( x,z,\tau \right) /\sqrt{%
\text{E}D_{1,v}\left( x,z,\tau \right) ^{2}}|\)</span>. This band is wider at
quantiles with sparse data.</p>
<p>To obtain a confidence band with robust bias correction, we implement
the following steps: First, run a local quadratic regression for each
quantile to estimate the bias <span class="math inline">\(B_{v}(x,z,\tau )\)</span>, denoted as
<span class="math inline">\(\hat{B_{v}}(x,z,\tau )\)</span>, and compute the bias corrected estimator
<span class="math inline">\((nb_{n,\tau }^{d})^{1/2}(\hat{Q}(\tau |x,z)-\hat{%
B}_{v}(x,z,\tau )b_{n,\tau }^{2})\)</span>. This estimator admits the following
approximation by Lemma 2 in <span class="citation" data-cites="2024.Qu.Yoon.Perron">Qu et al. (<a href="#ref-2024.Qu.Yoon.Perron" role="doc-biblioref">2024</a>)</span>:
<span class="math inline">\((nb_{n,\tau }^{d})^{1/2}(\hat{Q}(\tau |x,z)-\hat{B}%
_{v}(x,z,\tau )b_{n,\tau }^{2}-Q(\tau |x,z))=D_{1,v}\left( x,z,\tau \right)
-D_{2,v}\left( x,z,\tau \right) +o_{p}\left( 1\right)\)</span> over
<span class="math inline">\(\mathcal{T}\)</span>, where <span class="math inline">\(D_{1,v}\left( x,z,\tau \right)\)</span> is as stated
above, and the new term <span class="math inline">\(D_{2,v}\left( x,z,\tau \right)\)</span>, is due to bias
estimation. The terms <span class="math inline">\(D_{1,v}\left( x,z,\tau \right)\)</span> and
<span class="math inline">\(D_{2,v}\left( x,z,\tau
\right)\)</span> capture the estimation uncertainty of <span class="math inline">\(\hat{Q}(\tau |x,z)\)</span> and
<span class="math inline">\(%
\hat{B}_{v}(x,z,\tau )\)</span>, respectively. The resulting uniform confidence
band is <span class="math inline">\([\hat{Q}(\tau |x,z)-\hat{B}_{v}(x,z,\tau )-\sigma
_{n,\tau }C_{p},\)</span> <span class="math inline">\(\hat{Q}(\tau |x,z)-\hat{B}_{v}(x,z,\tau )+\sigma _{n,\tau }C_{p}]\)</span>,
where <span class="math inline">\(\sigma _{n,\tau }\)</span> and <span class="math inline">\(C_{p}\)</span> are as before, with
<span class="math inline">\(D_{1,v}\left( x,z,\tau \right)\)</span> replaced by
<span class="math inline">\(D_{1,v}\left( x,z,\tau \right)-D_{2,v}\left( x,z,\tau \right)\)</span>. This
band is centered at the bias corrected estimate and is wider than the
band without bias correction due to the presence of
<span class="math inline">\(D_{2,v}\left( x,z,\tau \right)\)</span>. More details on computing this
confidence band can be found in PROC-A on p.528 of <span class="citation" data-cites="2024.Qu.Yoon.Perron">Qu et al. (<a href="#ref-2024.Qu.Yoon.Perron" role="doc-biblioref">2024</a>)</span>.</p>
<h4 class="unnumbered" data-number="2.5" id="hypothesis-testing">Hypothesis testing</h4>
<p>To compute the tests, as before, let <span class="math inline">\(\hat{\delta}(\tau|z )=\hat{Q}(\tau
|x_{0}^{+},z)-\hat{Q}(\tau |x_{0}^{-},z)\)</span>. Let <span class="math inline">\(\hat{w}(\tau
)\geq 0\)</span> be a user-chosen weight function, satisfying
<span class="math inline">\(\hat{w}(\tau )\overset%
{p}{\rightarrow }w(\tau )\)</span>, a smooth function over <span class="math inline">\(\mathcal{T}\)</span>. Define
<span class="math inline">\(W(\tau )=(nb_{n,\tau }^{d})^{1/2}%
\hat{w}(\tau )(\hat{\delta}(\tau|z )-b_{n,\tau }^{2}(\hat{B}_{v}(x_{0}^+,z,\tau
)-\hat{B}_{v}(x_{0}^-,z,\tau )))\)</span>, where <span class="math inline">\(\hat{B}_{v}\)</span> represents the
bias estimate. The hypotheses of treatment significance, homogeneity,
and unambiguity are tested using the following statistics, respectively:
<span class="math display">\[\begin{array}{l}
WS\left( \mathcal{T}\right) =\sup_{\tau \in \mathcal{T}}\left\vert W(\tau
)\right\vert , \\
WH\left( \mathcal{T}\right) =\sup_{\tau \in \mathcal{T}}\left\vert W(\tau )-%
\frac{\sqrt{nb_{n,\tau }^{d}}\hat{w}(\tau )}{\int_{s\in \mathcal{T}}\sqrt{%
nb_{n,s}^{d}}\hat{w}(s)ds}\int_{\tau \in \mathcal{T}}W(\tau )d\tau
\right\vert , \\
WA\left( \mathcal{T}\right) =\sup_{\tau \in \mathcal{T}}\left\vert 1\left(
W(\tau )\leq 0\right) W(\tau )\right\vert .%
\end{array}%\]</span>
In the case of non-positive effects under the null hypothesis, replace
<span class="math inline">\(1\left(W(\tau )\leq 0\right)\)</span> by <span class="math inline">\(1\left(W(\tau )\geq 0\right)\)</span>. The
tests have built-in bias corrections. No restrictions on biases are
imposed across quantiles. To implement tests without bias correction,
simply omit the term <span class="math inline">\((\hat{B}_{v}(x_{0}^+,z,\tau
)-\hat{B}_{v}(x_{0}^-,z,\tau ))\)</span> when computing the test, and the
critical values are adjusted automatically.</p>
<p>Sometimes it is desirable to set <span class="math inline">\(\hat{w}(\tau)\)</span> such that the standard
deviation of
<span class="math inline">\((nb_{n,\tau }^{d})^{1/2}(\hat{\delta}(\tau|z )-b_{n,\tau }^{2}(\hat{B}_{v}(x_{0}^+,z,\tau
)-\hat{B}_{v}(x_{0}^-,z,\tau )))\)</span> is equalized across quantiles under
the null hypothesis. Or, one might assign equal weight to all quantiles.
The package provides both options. The asymptotic distributions of the
tests, under a general <span class="math inline">\(\hat{w}(\tau)\)</span>, are given in Corollary 5 of
<span class="citation" data-cites="2024.Qu.Yoon.Perron">Qu et al. (<a href="#ref-2024.Qu.Yoon.Perron" role="doc-biblioref">2024</a>)</span>.</p>
<h4 class="unnumbered" data-number="2.6" id="local-qte-in-rct">Local QTE in RCT</h4>
<p>As highlighted in the introduction, the functions in <strong>QTE.RD</strong> are
flexibly designed to accommodate more than the RD design. For example,
they can be used to analyze data from a randomized controlled trial. In
this case, the two sides of the cutoff are replaced by observations from
the control and treatment groups, respectively. The nonparametric
component of the model <span class="math inline">\(x\)</span> will be a variable that is highly predictive
of the outcome of the experiment. The linear component of the model
includes other covariates <span class="math inline">\(z\)</span>, which explores the heterogeneity in the
treatment effect.</p>
<p>Specifically, let <span class="math inline">\(Q_{1}(\tau|x,z)\)</span> be the conditional quantile function
of the treatment (<span class="math inline">\(d=1\)</span>) group and <span class="math inline">\(Q_{0}(\tau|x,z)\)</span> be that of the
control (<span class="math inline">\(d=0\)</span>) group, then the QTE at <span class="math inline">\((x,z)\)</span> is defined as
<span class="math inline">\(Q_{1}(\tau|x,z) - Q_{0}(\tau|x,z)\)</span>. If <span class="math inline">\(x=x_0\)</span> for some <span class="math inline">\(x_0\)</span>, the
estimate gives the local effect near a chosen covariate value <span class="math inline">\(x_0\)</span>,
placing no restriction on the effects away from <span class="math inline">\(x_0\)</span>. The main
difference from the RD case is that here <span class="math inline">\(x_0\)</span> typically represents an
interior point instead of a boundary point for the purpose of estimation
and inference. The next section will focus on the RD setting only, while
the empirical application section shows how to use the functions in the
package to analyze data from the RCT as well as from the RDD.</p>
<h3 data-number="3" id="r-functions"><span class="header-section-number">3</span> R functions</h3>
<p>This section explains the main R functions in the package.</p>
<p><code>QTE and Uniform confidence band</code></p>
<p>The function <code>rd.qte()</code> provides the QTE and <span class="math inline">\(100 \cdot (1-\alpha)\)</span>%
uniform confidence band. Save data in <code>y</code>, <code>x</code>, <code>d</code>, specify appropriate
values for <code>x0</code>, <code>z0</code>, <code>tau</code>, and run</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rd.qte</span>(y,x,d,x0,z0,tau,<span class="at">bdw=</span><span class="dv">8</span>,<span class="at">bias=</span><span class="dv">1</span>)</span></code></pre></div>
<p>This line of code estimates the conditional QTE with bias correction.
When no covariates are included, <code>x</code> is simply a vector of the running
variable and <code>z0</code> can be left unspecified. When covariates are included,
<code>x</code> should be a matrix with the running variable in the first column and
the covariates in the remaining columns. In this case, <code>z0</code>, which
specifies the covariate subgroups to be evaluated, must be explicitly
provided, as illustrated in Remark 1. The option <code>bias=1</code> means that the
QTE estimate is bias corrected. When <code>bias=0</code>, the above command
estimates the QTE without bias correction. Additional arguments have the
following meanings. The quantile indexes to estimate, <span class="math inline">\(\mathcal{T}\)</span>, are
denoted by <code>tau</code>. For example, when <span class="math inline">\(\mathcal{T}\)</span> = <span class="math display">\[0.1, 0.9\]</span>, one
may set <code>tau = seq(0.1,0.9,by=0.05)</code>. It will generate an evenly spaced
grid with increment 0.05. If <code>bdw</code> is set to a scalar, then it is
interpreted as the bandwidth for the median, and the bandwidth values
for other quantiles are determined within the code using Yu and Jones’s
(1998) formula. If <code>bdw</code> is a vector with the same dimension as <code>tau</code>,
then the program will use these values for the respective quantiles
accordingly.</p>
<p>If a user saves outputs of <code>rd.qte()</code> in an object <code>A</code>, the QTE estimate
is saved in <code>A$qte</code>. <code>A</code> also has a few extra outcomes. <code>A$qm.est</code> is
<span class="math inline">\(\hat{Q}(\tau|x_{0}^{-},z)\)</span> and <code>A$qp.est</code> is
<span class="math inline">\(\hat{Q}(\tau|x_{0}^{+},z)\)</span>. To obtain a uniform band, one can use
<code>summary.qte()</code>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> This can be done by</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(A,<span class="at">alpha=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p>Because <code>bias=1</code> when running <code>rd.qte()</code>, the uniform band that will be
produced is the robust confidence band. If <code>bias=0</code>, the uniform band
would not incorporate bias adjustments. Because <code>alpha=0.1</code>, one will
get a 90% uniform band.</p>
<p>If a user saves outputs of the summary function in an object <code>A2</code>, the
uniform confidence band will be saved in <code>A2$uband</code>. If <code>bias=1</code>,
<code>A$qte</code> and <code>A2$uband</code> are the bias-corrected QTE and uniform bands, and
if <code>bias=0</code>, they are not bias corrected. In addition, the uniform
confidence bands for <span class="math inline">\(\hat{Q}(\tau|x_{0}^{-},z)\)</span> and
<span class="math inline">\(\hat{Q}(\tau|x_{0}^{+},z)\)</span> are saved in <code>A2$uband.m</code> and <code>A2$uband.p</code>,
respectively. These conditional quantile functions will be bias
corrected if <code>bias=1</code>. For all results, the values are ordered as in
<code>tau</code>. For example, if <code>tau= seq(0.1,0.9,by=0.05)</code>, then the first value
is for the <span class="math inline">\(10\)</span>-th percentile, and so forth.</p>
<p><code>Testing Hypotheses on QTE</code></p>
<p>The function <code>rdq.test()</code> tests the hypotheses on QTE. To test the
treatment significance hypothesis, run</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdq.test</span>(y,x,d,x0,z0,tau,bdw,bias,<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">type=</span><span class="dv">1</span>,std.opt)</span></code></pre></div>
<p>The option <code>alpha</code> sets the desired confidence level <span class="math inline">\(1-\alpha\)</span>. When
<code>alpha=0.1</code>, one will get a critical value at the 10% level. When
<code>alpha=c(0.1,0.05)</code>, critical values at the 10% and 5% levels will be
reported. The bandwidth value <code>bdw</code> can be either a scalar (setting the
bandwidth at the median) or a vector with the same length as <code>tau</code>. If
<code>bias=1</code>, the test statistic is bias corrected and critical values are
robust to the bias correction. When <code>std.opt=1</code>, the test statistic is
standardized by the pointwise standard deviations of the limiting
process. As a result, the quantiles that are estimated imprecisely
receive less weight in the construction. When <code>std.opt=0</code>, the tests are
not standardized, i.e., setting <span class="math inline">\(\hat{w}(\tau)=1\)</span>, as explained in
Section 2.5. The default is <code>std.opt=1</code>.</p>
<p>To test the treatment homogeneity hypothesis, just change the <code>type</code>
option to <code>type=2</code>. For the unambiguity hypothesis with the effects
unambiguously positive under the null hypothesis<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, run</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdq.test</span>(y,x,d,x0,z0,tau,bdw,<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">type=</span><span class="dv">3</span>)</span></code></pre></div>
<p>Conversely, if the effects are unambiguously negative under the null
hypothesis, set <code>type=4</code>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> One can set multiple values for <code>type</code>.
For example, when <code>type=c(1,2,3,4)</code>, all four hypotheses (significance,
homogeneity, positive and negative unambiguity) will be tested.</p>
<p>If a user saves outputs of <code>rdq.test()</code> in an object <code>B</code>, test
statistics, critical values, and p-values are saved in <code>B$test.stat</code>,
<code>B$cr.value</code>, and <code>B$p.value</code>, respectively.</p>
<p><code>Bandwidth selection</code></p>
<p>To obtain a bandwidth (at the median), run</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdq.bandwidth</span>(y,x,d,x0,z0,<span class="at">cv=</span><span class="dv">1</span>,<span class="at">val=</span><span class="dv">5</span><span class="sc">:</span><span class="dv">20</span>)</span></code></pre></div>
<p>The function <code>rdq.bandwidth()</code> can provide two types of bandwidth: the
cross-validation (CV) bandwidth and the (MSE) optimal bandwidth. When
<code>cv=1</code>, the function produces both. When <code>cv=0</code>, the MSE optimal
bandwidth is obtained. The CV bandwidth is global with respect to the
model. Even when QTEs are conditional on covariates, a single CV
bandwidth will be obtained. In contrast, the MSE optimal bandwidth is
local to <span class="math inline">\(z_0\)</span>, meaning that the optimal bandwidth values will be
different across covariate subgroups.</p>
<p>The CV bandwidth requires a series of candidate values. When <code>val=5:20</code>
as in the example above, the CV procedures tries each of
<span class="math inline">\(\{5,6,\ldots,20\}\)</span> to select the optimal CV bandwidth value.</p>
<p>The optimal bandwidth requires a pilot bandwidth in order to estimate
nuisance parameters in the asymptotic MSE expression. When <code>cv=1</code>, the
CV bandwidth is used for the pilot bandwidth at <span class="math inline">\(\tau=0.5\)</span>. When <code>cv=0</code>,
the value provided by the argument <code>hp</code> will be used for the pilot
bandwidth. See the command below for this case. If <code>cv=1</code>, <code>hp</code> can be
ignored.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdq.bandwidth</span>(y,x,d,x0,z0,<span class="at">cv=</span><span class="dv">0</span>,<span class="at">hp=</span><span class="dv">10</span>)</span></code></pre></div>
<p><code>rdq.bandwidth()</code> has some additional arguments as shown below.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdq.bandwidth</span>(y,x,d,x0,z0,<span class="at">cv=</span><span class="dv">1</span>,<span class="at">val=</span><span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">pm.each=</span><span class="dv">1</span>,<span class="at">bdy=</span><span class="dv">1</span>,<span class="at">p.order=</span><span class="dv">1</span>,<span class="at">xl=</span><span class="fl">0.5</span>)</span></code></pre></div>
<p>In the case the additional arguments are not specified, reasonable
default values will be used. These additional arguments have the
following meanings.</p>
<p>The option <code>pm.each</code> concerns the CV bandwidth. When <code>pm.each=1</code>, it
calculates the CV bandwidth on each side of the cutoff <code>x0</code>. When
<code>pm.each=0</code>, it will treat <code>x0</code> as an interior point (assume that there
is no jump at <span class="math inline">\(x_0\)</span>) and obtains a single CV bandwidth. The default is
<code>pm.each=0</code>.</p>
<p>The option <code>p.order</code> determines how the CV bandwidth is calculated. When
<code>p.order=1</code>, a local linear regression is used, when <code>p.order=2</code>, a
local quadratic regression is used. The default is the local linear
regression.</p>
<p>When the option <code>bdy=1</code>, the CV procedure treats each evaluation point
as a boundary value, as suggested in <span class="citation" data-cites="2008.Imbens.Lemieux">Imbens and Lemieux (<a href="#ref-2008.Imbens.Lemieux" role="doc-biblioref">2008</a>)</span>. This is the
default option. When <code>bdy=0</code>, the CV procedure treats each evaluation
point as an interior value. If <code>xl=0.5</code>, then the CV bandwidth uses the
50% of observations closest to <span class="math inline">\(x_0\)</span>. The default value is <span class="math inline">\(0.5\)</span>. The
MSE-optimal bandwidth uses the boundary value formula. Note that it is
valid for an interior point as well.</p>
<p>If a user saves outputs of <code>rdq.bandwidth()</code> in an object <code>C</code>, and if
<code>cv=1</code>, <code>C$cv</code> is the CV bandwidth. For the MSE optimal bandwidth,
values for each side of the cutoff are calculated separately. <code>C$opt.m</code>
(and <code>C$opt.p</code>) is the optimal bandwidth from the left (right) side of
the cutoff. All the reported bandwidth values are for the median where
<span class="math inline">\(\tau=0.5\)</span>.</p>
<p><code>Plot QTE</code></p>
<p>The function <code>plot.qte()</code> makes QTE plot with uniform confidence bands.
It has the syntax<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A2)</span></code></pre></div>
<p>where <code>A2</code> is an object produced by <code>summary.qte()</code> fitting. The
required inputs are the quantile index (saved in <code>A2$tau</code>), the QTE
estimate (<code>A2$qte</code>), and the uniform band (<code>A2$uband</code>). The function has
an option <code>ptype</code>. Set <code>ptype=1</code> to obtain QTE plots and <code>ptype=2</code> for
conditional quantile plots. The default value is <span class="math inline">\(1\)</span>.</p>
<p>Section 4 offers step-by-step guides for these functions using an
empirical example, which features RCT as well as RDD.</p>
<h3 data-number="4" id="impact-of-tracking"><span class="header-section-number">4</span> Impact of tracking</h3>
<p>As explained in the introduction, in this randomized experiment
conducted in Kenya, schools were randomly assigned to tracking and
non-tracking schools. This variation from the RCT allows one to test
whether tracking is beneficial to all students, including low achieving
students. Within tracking schools, students above the median of the
baseline test were assigned to the upper section. This variation from
the RDD allows one to ask whether a student at the median would be
better off if she is assigned to the upper section. We will consider
both types of variations in this empirical illustration.</p>
<h4 class="unnumbered" data-number="4.1" id="data-and-variables">Data and Variables</h4>
<p>First we read the data set of <span class="citation" data-cites="Duflo.Dupas.Kremer.2011">Duflo et al. (<a href="#ref-Duflo.Dupas.Kremer.2011" role="doc-biblioref">2011</a>)</span><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> and define
some key variables.</p>
<div class="small">
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ddk_2011&quot;</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>trk <span class="ot">&lt;-</span> ddk_2011<span class="sc">$</span>tracking</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> ddk_2011<span class="sc">$</span>etpteacher</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>hgh <span class="ot">&lt;-</span> ddk_2011<span class="sc">$</span>highstream</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>yy  <span class="ot">&lt;-</span> ddk_2011<span class="sc">$</span>ts_std</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>xx  <span class="ot">&lt;-</span> ddk_2011<span class="sc">$</span>percentile</span></code></pre></div>
</div>
<p>There are three indicator variables; <code>trk</code> takes <span class="math inline">\(1\)</span> for tracking
schools, <code>con</code> takes <span class="math inline">\(1\)</span> for students assigned to a contract teacher,
<code>hgh</code> takes <span class="math inline">\(1\)</span> for students assigned to high-achieving sections (if in
tracking schools). The variable <code>yy</code> is the endline test scores
normalized by the mean and standard deviation of non-tracking schools
and <code>xx</code> is student’s percentile rank from the baseline test. Because
the outcome variable is normalized, the unit of the effect is a standard
deviation of the endline test score (of non-tracking schools).</p>
<h4 class="unnumbered" data-number="4.2" id="rdd">RDD</h4>
<p>This section focuses on tracking schools and presents results from the
RD design. We examine students near the median of the baseline test, and
compare marginal students who just made the upper section to those who
narrowly missed it. The dependent variable and the running variable
(<code>yc</code> and <code>xc</code> below) include students in tracking schools only. The
cutoff point is the median of the baseline percentile distribution
(<span class="math inline">\(x_0 = 50\)</span>), and the treatment indicator (<code>dc</code> below) takes <span class="math inline">\(1\)</span> if
students are in high achieving sections.</p>
<div class="small">
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>yc <span class="ot">&lt;-</span> yy[trk<span class="sc">==</span><span class="dv">1</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>xc <span class="ot">&lt;-</span> xx[trk<span class="sc">==</span><span class="dv">1</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> hgh[trk<span class="sc">==</span><span class="dv">1</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>tlevel <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span><span class="sc">/</span><span class="dv">10</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>hh <span class="ot">&lt;-</span> <span class="dv">20</span></span></code></pre></div>
</div>
<p>The last two lines set the values of two parameters; <code>tlevel</code> defines
the quantile range <span class="math inline">\(\mathcal{T} = [0.1,0.9]\)</span> and <code>hh</code> is the bandwidth
at the median. More details on bandwidth selection will be discussed
later.</p>
<p><strong>QTE from RDD without covariates</strong></p>
<p>In <code>rd.qte()</code>, when <code>x</code> includes the running variable only and <code>z0</code> is
unspecified, one can estimate quantile effects at <code>x0</code> without
covariate.</p>
<div class="small">
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rd.qte</span>(<span class="at">y=</span>yc,<span class="at">x=</span>xc,<span class="at">d=</span>dc,x0,<span class="at">z0=</span><span class="cn">NULL</span>,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,<span class="at">bias=</span><span class="dv">1</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(A,<span class="at">alpha=</span><span class="fl">0.1</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>A2</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                 QTE                                   </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="sc">----------------------------------------------------------------------</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>             Bias cor.    Pointwise         Uniform      </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    Tau         Est.     Robust S.E.    <span class="dv">90</span>% Conf. Band  </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.1</span>      <span class="sc">-</span><span class="fl">0.104</span>       <span class="fl">0.137</span>      <span class="sc">-</span><span class="fl">0.427</span>       <span class="fl">0.218</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.2</span>      <span class="sc">-</span><span class="fl">0.001</span>       <span class="fl">0.139</span>      <span class="sc">-</span><span class="fl">0.327</span>       <span class="fl">0.324</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.3</span>      <span class="sc">-</span><span class="fl">0.068</span>       <span class="fl">0.146</span>      <span class="sc">-</span><span class="fl">0.410</span>       <span class="fl">0.274</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.4</span>      <span class="sc">-</span><span class="fl">0.074</span>       <span class="fl">0.148</span>      <span class="sc">-</span><span class="fl">0.423</span>       <span class="fl">0.274</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.5</span>      <span class="sc">-</span><span class="fl">0.157</span>       <span class="fl">0.173</span>      <span class="sc">-</span><span class="fl">0.564</span>       <span class="fl">0.250</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.6</span>      <span class="sc">-</span><span class="fl">0.069</span>       <span class="fl">0.211</span>      <span class="sc">-</span><span class="fl">0.565</span>       <span class="fl">0.426</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.7</span>      <span class="sc">-</span><span class="fl">0.020</span>       <span class="fl">0.262</span>      <span class="sc">-</span><span class="fl">0.636</span>       <span class="fl">0.597</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.8</span>      <span class="sc">-</span><span class="fl">0.023</span>       <span class="fl">0.309</span>      <span class="sc">-</span><span class="fl">0.749</span>       <span class="fl">0.702</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.9</span>      <span class="sc">-</span><span class="fl">0.003</span>       <span class="fl">0.252</span>      <span class="sc">-</span><span class="fl">0.595</span>       <span class="fl">0.590</span>     </span></code></pre></div>
</div>
<p>The outcome table shows some essential elements of the analysis
including point estimates, standard errors, and uniform confidence
bands. Because the bias option is activated, <code>bias=1</code>, the table reports
the bias corrected point estimate and the robust standard error and
robust uniform band. If <code>bias=0</code>, one would obtain QTE estimates and
uniform bands without the bias correction. Because <code>alpha=0.1</code>, a 90%
uniform confidence band is reported. If <code>alpha=0.05</code>, one would get a
95% uniform confidence band.</p>
<p>The estimated quantile effects are small in magnitude (the maximum
effect is <span class="math inline">\(-0.157\)</span> standard deviation when <span class="math inline">\(\tau=0.5\)</span>) and the uniform
confidence band includes zero throughout the quantile range. This
confirms a finding in <span class="citation" data-cites="Duflo.Dupas.Kremer.2011">Duflo et al. (<a href="#ref-Duflo.Dupas.Kremer.2011" role="doc-biblioref">2011</a>)</span> who concluded that “the
median student in tracking schools scores similarly whether assigned to
the upper or lower section.” The QTE estimate provides even stronger
evidence that not only on average but also on the entire endline score
distribution, students near the median of the initial test scores fare
similarly regardless of whether they were assigned to the upper or lower
ability section.</p>
<p>To examine the shape of the effect graphically, <code>plot.qte()</code> function
can be used to produce QTE plots along with uniform confidence bands as
in Figure <a href="#fig:rdd_no_covariate" data-reference-type="ref" data-reference="fig:rdd_no_covariate">1</a>.</p>
<div class="small">
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>y.text <span class="ot">&lt;-</span> <span class="st">&quot;test scores&quot;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>m.text <span class="ot">&lt;-</span> <span class="st">&quot;Effects of Assignment to Lower vs. Upper sections&quot;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A2,<span class="at">ytext=</span>y.text,<span class="at">mtext=</span>m.text)</span></code></pre></div>
</div>
<figure id="fig:rdd_no_covariate">
<img src="figures/rdd_qte_unconditional_new.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 1: QTE Estimates from
RDD</figcaption>
</figure>
<p>It is of interest to examine the conditional quantile functions from two
sides of the cutoff. The function <code>plot.qte()</code> can make such plots with
the option <code>ptype=2</code>. The inputs for conditional quantile plots include
estimates for two conditional quantile functions, <code>qp</code> and <code>qm</code>, and
their uniform bands, <code>bandp</code> and <code>bandm</code>. These outputs are produced by
<code>summary.qte()</code> and already saved in <code>A2</code> as the next example shows. In
Figure <a href="#fig:rdd_condQ_uncond_v2" data-reference-type="ref" data-reference="fig:rdd_condQ_uncond_v2">2</a>, we put two figures on top of each
other. To produce separate figures, simply apply the command twice, once
for each side of the cutoff.</p>
<div class="small">
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>y.text <span class="ot">&lt;-</span> <span class="st">&quot;test scores&quot;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>m.text <span class="ot">&lt;-</span> <span class="st">&quot;Conditional quantile functions&quot;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>sub.text <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Upper section&quot;</span>,<span class="st">&quot;Lower section&quot;</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A2,<span class="at">ptype=</span><span class="dv">2</span>,<span class="at">ytext=</span>y.text,<span class="at">mtext=</span>m.text,<span class="at">subtext=</span>sub.text)</span></code></pre></div>
</div>
<figure id="fig:rdd_condQ_uncond_v2">
<img src="figures/rdd_condQ_uncond_v2_new.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 2: Conditional Quantile
Functions</figcaption>
</figure>
<p>To test the (lack of) effect, one can use the <code>rdq.test()</code> function.
When <code>alpha=c(0.1,0.05)</code>, it provides critical values at the 10% and 5%
levels. The <code>type</code> option determines the type of tests to be conducted.
The lines below set <code>type=c(1,2,3,4)</code>, leading to tests for all four
hypotheses including significance, homogeneity, and positive and
negative dominance.</p>
<div class="small">
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">rdq.test</span>(<span class="at">y=</span>yc,<span class="at">x=</span>xc,<span class="at">d=</span>dc,x0,<span class="at">z0=</span><span class="cn">NULL</span>,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,<span class="at">bias=</span><span class="dv">1</span>,<span class="at">alpha=</span><span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.05</span>),</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="at">type=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                     Testing hypotheses on quantile process                      </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="sc">--------------------------------------------------------------------------------</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span> Hypthoesis                            test stat.  critical value   p value    </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                                        <span class="dv">10</span><span class="sc">%       5%</span>        </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="er">================================================================================</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>Significance<span class="sc">:</span> <span class="fu">QTE</span>(tau<span class="sc">|</span>x,z)<span class="ot">=</span><span class="dv">0</span> <span class="cf">for</span> all taus      <span class="fl">0.86</span>     <span class="fl">2.36</span>     <span class="fl">2.64</span>     <span class="fl">0.94</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>Homogeneity<span class="sc">:</span> <span class="fu">QTE</span>(tau<span class="sc">|</span>x,z) is constant          <span class="fl">0.52</span>     <span class="fl">1.90</span>     <span class="fl">2.13</span>     <span class="fl">0.98</span> </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>Dominance<span class="sc">:</span> <span class="fu">QTE</span>(tau<span class="sc">|</span>x,z)<span class="sc">&gt;=</span><span class="dv">0</span> <span class="cf">for</span> all taus        <span class="fl">0.86</span>     <span class="fl">2.10</span>     <span class="fl">2.41</span>     <span class="fl">0.57</span> </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>Dominance<span class="sc">:</span> <span class="fu">QTE</span>(tau<span class="sc">|</span>x,z)<span class="sc">&lt;=</span><span class="dv">0</span> <span class="cf">for</span> all taus        <span class="fl">0.00</span>     <span class="fl">2.06</span>     <span class="fl">2.29</span>     <span class="fl">1.00</span> </span></code></pre></div>
</div>
<p>The outcome table displays the null hypotheses to be tested, test
statistics, critical values, and p-values. All four tests indicate that
QTEs are likely to be zero over the entire quantile range.</p>
<p>The empirical evidence from the RDD indicates that there is no
difference in endline achievement between marginal students regardless
of whether they were assigned to the upper or lower section. Because
students in the upper section had much higher achieving peers, this
implies that there may be a factor that offsets the positive peer
effect. One possibility is that tracking may allow teachers to adjust
their instruction to students’ needs. Exploring this potential channel,
<span class="citation" data-cites="Duflo.Dupas.Kremer.2011">Duflo et al. (<a href="#ref-Duflo.Dupas.Kremer.2011" role="doc-biblioref">2011</a>)</span> documented evidence that teachers had
incentives to focus on the students at the top of the distribution. If
this is the case, the median students from the bottom section may get
benefits from the instruction that better matches their need.</p>
<p>The bandwidth (at the median) can be estimated as follows.</p>
<div class="small">
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">rdq.bandwidth</span>(<span class="at">y=</span>yc,<span class="at">x=</span>xc,<span class="at">d=</span>dc,x0,<span class="at">z0=</span><span class="cn">NULL</span>,<span class="at">cv=</span><span class="dv">1</span>,<span class="at">val=</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">20</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>C</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                    Selected Bandwidths                      </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="sc">------------------------------------------------------------</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>Method                              Values        </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">==========================================================</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>Cross Validation                       <span class="dv">20</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>MSE Optimal                          <span class="fl">16.3</span>         <span class="fl">16.3</span> </span></code></pre></div>
</div>
<p>Because the cross-validation option is on, <code>cv=1</code>, the table reports
both CV and MSE optimal bandwidths. The candidate values are
<span class="math inline">\(\{5,6,\ldots,20\}\)</span> for cross-validation, as given by <code>val=(5:20)</code>. We
have used the bandwidth <span class="math inline">\(20\)</span> because it was selected by the cross
validation method. If the sample is very large, computing the CV
bandwidth may take a long time. In such a case, set <code>cv=0</code> and use the
MSE optimal bandwidth at least for the initial stage of data
exploration.</p>
<p><strong>QTE from RDD with covariates</strong></p>
<p>To see heterogeneity in the effect of tracking, one can include
additional covariates. This section compares effects of tracking for
boys and girls. The covariate <code>zc</code> is a female dummy and the evaluation
point <span class="math inline">\(z_0\)</span> is set by <code>z.eval = c(0,1)</code>. The order of display in the
outcome table is the same as the order of the group in <span class="math inline">\(z_0\)</span>.</p>
<div class="small">
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>zc <span class="ot">&lt;-</span> ddk_2011<span class="sc">$</span>girl[trk<span class="sc">==</span><span class="dv">1</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>z.eval <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rd.qte</span>(<span class="at">y=</span>yc,<span class="at">x=</span><span class="fu">cbind</span>(xc,zc),<span class="at">d=</span>dc,x0,<span class="at">z0=</span>z.eval,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,<span class="at">bias=</span><span class="dv">1</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(A,<span class="at">alpha=</span><span class="fl">0.1</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                                 QTE                                   </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="sc">----------------------------------------------------------------------</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>             Bias cor.    Pointwise         Uniform      </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    Tau         Est.     Robust S.E.    <span class="dv">90</span>% Conf. Band  </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="sc">----------------------------------------------------------------------</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a> Group<span class="dv">-1</span>   (boys)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.1</span>       <span class="fl">0.295</span>       <span class="fl">0.187</span>      <span class="sc">-</span><span class="fl">0.154</span>       <span class="fl">0.743</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.2</span>       <span class="fl">0.090</span>       <span class="fl">0.224</span>      <span class="sc">-</span><span class="fl">0.445</span>       <span class="fl">0.625</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.3</span>       <span class="fl">0.063</span>       <span class="fl">0.207</span>      <span class="sc">-</span><span class="fl">0.432</span>       <span class="fl">0.559</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.4</span>      <span class="sc">-</span><span class="fl">0.026</span>       <span class="fl">0.232</span>      <span class="sc">-</span><span class="fl">0.581</span>       <span class="fl">0.528</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.5</span>       <span class="fl">0.031</span>       <span class="fl">0.275</span>      <span class="sc">-</span><span class="fl">0.628</span>       <span class="fl">0.689</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.6</span>       <span class="fl">0.353</span>       <span class="fl">0.333</span>      <span class="sc">-</span><span class="fl">0.443</span>       <span class="fl">1.150</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.7</span>       <span class="fl">0.597</span>       <span class="fl">0.369</span>      <span class="sc">-</span><span class="fl">0.286</span>       <span class="fl">1.481</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.8</span>       <span class="fl">0.160</span>       <span class="fl">0.466</span>      <span class="sc">-</span><span class="fl">0.955</span>       <span class="fl">1.275</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.9</span>       <span class="fl">0.159</span>       <span class="fl">0.416</span>      <span class="sc">-</span><span class="fl">0.835</span>       <span class="fl">1.154</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="sc">----------------------------------------------------------------------</span> </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a> Group<span class="dv">-2</span>   (girls)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.1</span>      <span class="sc">-</span><span class="fl">0.406</span>       <span class="fl">0.141</span>      <span class="sc">-</span><span class="fl">0.737</span>      <span class="sc">-</span><span class="fl">0.074</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.2</span>      <span class="sc">-</span><span class="fl">0.161</span>       <span class="fl">0.195</span>      <span class="sc">-</span><span class="fl">0.620</span>       <span class="fl">0.297</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.3</span>      <span class="sc">-</span><span class="fl">0.100</span>       <span class="fl">0.224</span>      <span class="sc">-</span><span class="fl">0.626</span>       <span class="fl">0.426</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.4</span>      <span class="sc">-</span><span class="fl">0.233</span>       <span class="fl">0.241</span>      <span class="sc">-</span><span class="fl">0.798</span>       <span class="fl">0.332</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.5</span>      <span class="sc">-</span><span class="fl">0.475</span>       <span class="fl">0.270</span>      <span class="sc">-</span><span class="fl">1.108</span>       <span class="fl">0.158</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.6</span>      <span class="sc">-</span><span class="fl">0.291</span>       <span class="fl">0.291</span>      <span class="sc">-</span><span class="fl">0.976</span>       <span class="fl">0.393</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.7</span>      <span class="sc">-</span><span class="fl">0.158</span>       <span class="fl">0.363</span>      <span class="sc">-</span><span class="fl">1.010</span>       <span class="fl">0.695</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.8</span>      <span class="sc">-</span><span class="fl">0.236</span>       <span class="fl">0.433</span>      <span class="sc">-</span><span class="fl">1.253</span>       <span class="fl">0.781</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.9</span>       <span class="fl">0.000</span>       <span class="fl">0.322</span>      <span class="sc">-</span><span class="fl">0.756</span>       <span class="fl">0.756</span></span></code></pre></div>
</div>
<p>Because <code>z.eval &lt;- c(0,1)</code> and <span class="math inline">\(z_0 = 0\)</span> means boys, the outcome table
shows results for boys first (shown as Group-1) and girls later
(Group-2). For boys, the quantile effects of being in the upper ability
section is positive but insignificant. For girls, the effects are mostly
negative and insignificant. But at the bottom of the outcome
distribution, when <span class="math inline">\(\tau = 0.1\)</span>, the negative effect turns to be
significant. To see the group-wise difference graphically, one can draw
QTE plots as follows.</p>
<div class="small">
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>y.text <span class="ot">&lt;-</span> <span class="st">&quot;test scores&quot;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>m.text <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Boys&quot;</span>,<span class="st">&quot;Girls&quot;</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A2,<span class="at">ytext=</span>y.text,<span class="at">mtext=</span>m.text)</span></code></pre></div>
</div>
<figure id="fig:rdd_gender">
<img src="figures/rdd_qte_gender_new.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 3: QTE Estimates from RDD by Student
Gender</figcaption>
</figure>
<p>The plot clearly shows that tracking has a positive but insignificant
effect for marginal male students, but the effect is negative for
marginal female students and significantly so at the left tail. To
explore further, it will be useful to draw plots for the conditional
quantile functions separately for each group.</p>
<div class="small">
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>y.text <span class="ot">&lt;-</span> <span class="st">&quot;test scores&quot;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>m.text <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Boys&quot;</span>,<span class="st">&quot;Girls&quot;</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>sub.text <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Upper section&quot;</span>,<span class="st">&quot;Lower section&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A2,<span class="at">ptype=</span><span class="dv">2</span>,<span class="at">ytext=</span>y.text,<span class="at">mtext=</span>m.text,<span class="at">subtext=</span>sub.text)</span></code></pre></div>
</div>
<p>The plot is omitted to save space, but it shows that for girls, the
conditional quantile function of endline test scores for the upper
section is consistently below that of the lower section, and the
difference is largest at the left tail.</p>
<p>Tests for hypotheses for each group can be done as well.</p>
<div class="small">
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">rdq.test</span>(<span class="at">y=</span>yc,<span class="at">x=</span><span class="fu">cbind</span>(xc,zc),<span class="at">d=</span>dc,x0,<span class="at">z0=</span>z.eval,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,<span class="at">bias=</span><span class="dv">1</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                <span class="at">alpha=</span><span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.05</span>),<span class="at">type=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>))</span></code></pre></div>
</div>
<p>The results indicate that it is not possible to reject hypotheses that
the QTE is consistently zero for boys, but there is evidence that the
effects can be negative for girls. For female students the null
hypothesis of no effect (significance) and positive uniform effect
(dominance) are rejected at the 5% confidence level. The bandwidth can
be selected as well.</p>
<div class="small">
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">rdq.bandwidth</span>(<span class="at">y=</span>yc,<span class="at">x=</span><span class="fu">cbind</span>(xc,zc),<span class="at">d=</span>dc,x0,<span class="at">z0=</span>z.eval,<span class="at">cv=</span><span class="dv">1</span>,<span class="at">val=</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">20</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                    Selected Bandwidths                      </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="sc">------------------------------------------------------------</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>Method                              Values        </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">==========================================================</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>Cross Validation                       <span class="dv">19</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>MSE Optimal,Group<span class="dv">-1</span>                  <span class="fl">14.3</span>         <span class="fl">14.2</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>MSE Optimal,Group<span class="dv">-2</span>                  <span class="fl">17.9</span>         <span class="fl">20.0</span> </span></code></pre></div>
</div>
<p>When users would like to see the effect of the bias correction on point
estimates and uniform bands, it will be convenient to use the function
<code>rdq.band()</code>. Its options are the same as those in <code>rd.qte()</code>. The
difference is that it implements estimation with and without bias
correction and presents results side by side.</p>
<div class="small">
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">rdq.band</span>(<span class="at">y=</span>yc,<span class="at">x=</span><span class="fu">cbind</span>(xc,zc),<span class="at">d=</span>dc,x0,<span class="at">z0=</span>z.eval,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,<span class="at">alpha=</span><span class="fl">0.1</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                        QTE and Uniform Bands                          </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="sc">----------------------------------------------------------------------</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                     Bias cor.         <span class="dv">90</span>% Uniform Conf. Band         </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>   Tau        Est.      Est.       Non<span class="sc">-</span>robust            Robust        </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="sc">----------------------------------------------------------------------</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a> Group<span class="dv">-1</span>  (boys)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.1</span>     <span class="fl">0.118</span>     <span class="fl">0.295</span>    <span class="sc">-</span><span class="fl">0.194</span>     <span class="fl">0.430</span>    <span class="sc">-</span><span class="fl">0.123</span>     <span class="fl">0.712</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.2</span>     <span class="fl">0.014</span>     <span class="fl">0.090</span>    <span class="sc">-</span><span class="fl">0.366</span>     <span class="fl">0.394</span>    <span class="sc">-</span><span class="fl">0.415</span>     <span class="fl">0.596</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.3</span>     <span class="fl">0.022</span>     <span class="fl">0.063</span>    <span class="sc">-</span><span class="fl">0.326</span>     <span class="fl">0.370</span>    <span class="sc">-</span><span class="fl">0.415</span>     <span class="fl">0.542</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.4</span>    <span class="sc">-</span><span class="fl">0.023</span>    <span class="sc">-</span><span class="fl">0.026</span>    <span class="sc">-</span><span class="fl">0.425</span>     <span class="fl">0.379</span>    <span class="sc">-</span><span class="fl">0.595</span>     <span class="fl">0.542</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.5</span>     <span class="fl">0.044</span>     <span class="fl">0.031</span>    <span class="sc">-</span><span class="fl">0.433</span>     <span class="fl">0.522</span>    <span class="sc">-</span><span class="fl">0.645</span>     <span class="fl">0.706</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.6</span>     <span class="fl">0.093</span>     <span class="fl">0.353</span>    <span class="sc">-</span><span class="fl">0.484</span>     <span class="fl">0.670</span>    <span class="sc">-</span><span class="fl">0.469</span>     <span class="fl">1.176</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.7</span>     <span class="fl">0.194</span>     <span class="fl">0.597</span>    <span class="sc">-</span><span class="fl">0.451</span>     <span class="fl">0.839</span>    <span class="sc">-</span><span class="fl">0.288</span>     <span class="fl">1.482</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.8</span>     <span class="fl">0.096</span>     <span class="fl">0.160</span>    <span class="sc">-</span><span class="fl">0.684</span>     <span class="fl">0.876</span>    <span class="sc">-</span><span class="fl">0.923</span>     <span class="fl">1.243</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.9</span>     <span class="fl">0.267</span>     <span class="fl">0.159</span>    <span class="sc">-</span><span class="fl">0.431</span>     <span class="fl">0.965</span>    <span class="sc">-</span><span class="fl">0.800</span>     <span class="fl">1.118</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="sc">----------------------------------------------------------------------</span> </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a> Group<span class="dv">-2</span>  (girls)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.1</span>    <span class="sc">-</span><span class="fl">0.204</span>    <span class="sc">-</span><span class="fl">0.406</span>    <span class="sc">-</span><span class="fl">0.464</span>     <span class="fl">0.056</span>    <span class="sc">-</span><span class="fl">0.736</span>    <span class="sc">-</span><span class="fl">0.075</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.2</span>    <span class="sc">-</span><span class="fl">0.111</span>    <span class="sc">-</span><span class="fl">0.161</span>    <span class="sc">-</span><span class="fl">0.460</span>     <span class="fl">0.238</span>    <span class="sc">-</span><span class="fl">0.619</span>     <span class="fl">0.296</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.3</span>    <span class="sc">-</span><span class="fl">0.128</span>    <span class="sc">-</span><span class="fl">0.100</span>    <span class="sc">-</span><span class="fl">0.542</span>     <span class="fl">0.286</span>    <span class="sc">-</span><span class="fl">0.639</span>     <span class="fl">0.439</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.4</span>    <span class="sc">-</span><span class="fl">0.186</span>    <span class="sc">-</span><span class="fl">0.233</span>    <span class="sc">-</span><span class="fl">0.652</span>     <span class="fl">0.281</span>    <span class="sc">-</span><span class="fl">0.823</span>     <span class="fl">0.358</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.5</span>    <span class="sc">-</span><span class="fl">0.335</span>    <span class="sc">-</span><span class="fl">0.475</span>    <span class="sc">-</span><span class="fl">0.839</span>     <span class="fl">0.170</span>    <span class="sc">-</span><span class="fl">1.117</span>     <span class="fl">0.167</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.6</span>    <span class="sc">-</span><span class="fl">0.136</span>    <span class="sc">-</span><span class="fl">0.291</span>    <span class="sc">-</span><span class="fl">0.685</span>     <span class="fl">0.413</span>    <span class="sc">-</span><span class="fl">0.988</span>     <span class="fl">0.406</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.7</span>    <span class="sc">-</span><span class="fl">0.142</span>    <span class="sc">-</span><span class="fl">0.158</span>    <span class="sc">-</span><span class="fl">0.814</span>     <span class="fl">0.530</span>    <span class="sc">-</span><span class="fl">1.029</span>     <span class="fl">0.714</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.8</span>    <span class="sc">-</span><span class="fl">0.148</span>    <span class="sc">-</span><span class="fl">0.236</span>    <span class="sc">-</span><span class="fl">0.938</span>     <span class="fl">0.642</span>    <span class="sc">-</span><span class="fl">1.275</span>     <span class="fl">0.803</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.9</span>     <span class="fl">0.085</span>     <span class="fl">0.000</span>    <span class="sc">-</span><span class="fl">0.522</span>     <span class="fl">0.692</span>    <span class="sc">-</span><span class="fl">0.783</span>     <span class="fl">0.783</span></span></code></pre></div>
</div>
<p>Without bias correction, the effect for girls at the 10th percentile is
no longer statistically significant, as the estimate is smaller.
Otherwise, the conclusion does not change.</p>
<h4 class="unnumbered" data-number="4.3" id="rct">RCT</h4>
<p>The schools in the sample were randomly assigned to tracking and
non-tracking schools. Using this random variation, one can compare
students between tracking and non-tracking schools to examine the impact
of tracking on the entire student population. The tracking variable
<code>trk</code> is the treatment assignment <span class="math inline">\(d\)</span> for the RCT. We use the baseline
test score as the nonparametric component <span class="math inline">\(x\)</span>. Because it is highly
predictive of the endline test score, it is natural to examine the
effects of tracking separately for groups at various points of the
initial performance distribution. To examine the heterogeneity in
effects, we use student and teacher characteristics as covariates <span class="math inline">\(z\)</span>.
We continue to use <code>hh=20</code> for the bandwidth at the median. Users can
change the bandwidth value and examine the robustness of results.</p>
<p><strong>QTE from RCT without covariates</strong></p>
<div class="small">
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dr <span class="ot">&lt;-</span> trk</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rd.qte</span>(<span class="at">y=</span>yy,<span class="at">x=</span>xx,<span class="at">d=</span>dr,<span class="at">x0=</span><span class="dv">50</span>,<span class="at">z0=</span><span class="cn">NULL</span>,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,<span class="at">bias=</span><span class="dv">1</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(A,<span class="at">alpha=</span><span class="fl">0.1</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                                 QTE                                   </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="sc">----------------------------------------------------------------------</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>             Bias cor.    Pointwise         Uniform      </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    Tau         Est.     Robust S.E.    <span class="dv">90</span>% Conf. Band  </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.1</span>       <span class="fl">0.234</span>       <span class="fl">0.051</span>       <span class="fl">0.115</span>       <span class="fl">0.354</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.2</span>       <span class="fl">0.227</span>       <span class="fl">0.063</span>       <span class="fl">0.079</span>       <span class="fl">0.374</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.3</span>       <span class="fl">0.293</span>       <span class="fl">0.064</span>       <span class="fl">0.143</span>       <span class="fl">0.443</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.4</span>       <span class="fl">0.278</span>       <span class="fl">0.068</span>       <span class="fl">0.119</span>       <span class="fl">0.437</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.5</span>       <span class="fl">0.304</span>       <span class="fl">0.075</span>       <span class="fl">0.128</span>       <span class="fl">0.480</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.6</span>       <span class="fl">0.308</span>       <span class="fl">0.086</span>       <span class="fl">0.106</span>       <span class="fl">0.509</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.7</span>       <span class="fl">0.308</span>       <span class="fl">0.106</span>       <span class="fl">0.060</span>       <span class="fl">0.556</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.8</span>       <span class="fl">0.351</span>       <span class="fl">0.135</span>       <span class="fl">0.034</span>       <span class="fl">0.668</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>     <span class="fl">0.9</span>       <span class="fl">0.280</span>       <span class="fl">0.139</span>      <span class="sc">-</span><span class="fl">0.044</span>       <span class="fl">0.605</span></span></code></pre></div>
</div>
<p>To estimate the QTE without a covariate, set <code>z0=NULL</code>. By letting
<code>x0=50</code>, we focus on the median students from the initial achievement
distribution and estimate the effect of assigning them to tracking or
non-tracking schools. For this group, test scores were between 0.227
(<span class="math inline">\(\tau=0.2\)</span>) and 0.351 (<span class="math inline">\(\tau=0.8\)</span>) standard deviations higher in
tracking schools than in non-tracking schools when measured by quantile
effects. The size of the effect is notably higher than the average
unconditional effect, 0.14 standard deviations higher in tracking
schools, as reported in <span class="citation" data-cites="Duflo.Dupas.Kremer.2011">Duflo et al. (<a href="#ref-Duflo.Dupas.Kremer.2011" role="doc-biblioref">2011</a>)</span>. This difference
suggests that the effect of tracking may be quite different for high and
low-achieving students.</p>
<p>To check this, one can change the value of <span class="math inline">\(x_0\)</span>. Set <code>x0 = 20</code>, then
one can study the effect of tracking for the initially low achieving
students.</p>
<div class="small">
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rd.qte</span>(<span class="at">y=</span>yy,<span class="at">x=</span>xx,<span class="at">d=</span>dr,<span class="at">x0=</span><span class="dv">20</span>,<span class="at">z0=</span><span class="cn">NULL</span>,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,<span class="at">bias=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<p>The quantile effects for this group of low achieving students from the
baseline test are indeed much smaller. Test scores were up to 0.179
standard deviation higher in tracking schools than in non-tracking
schools. Next, set <code>x0 = 80</code> and examine the initially high achieving
students.</p>
<div class="small">
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rd.qte</span>(<span class="at">y=</span>yy,<span class="at">x=</span>xx,<span class="at">d=</span>dr,<span class="at">x0=</span><span class="dv">80</span>,<span class="at">z0=</span><span class="cn">NULL</span>,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,<span class="at">bias=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<p>The estimated effects are larger than those for <span class="math inline">\(x_0 = 20\)</span> but still
smaller than those for <span class="math inline">\(x_0 = 50\)</span>. The results so far suggest that the
impact of tracking from the RCT is the strongest around the median of
the initial achievement distribution. This finding is in harmony with
Figure 3 in <span class="citation" data-cites="Duflo.Dupas.Kremer.2011">Duflo et al. (<a href="#ref-Duflo.Dupas.Kremer.2011" role="doc-biblioref">2011</a>)</span>.</p>
<p><strong>By student’s gender &amp; teacher’s type</strong></p>
<p>There are two types of teachers: regular teachers who are civil-servants
and contract teachers who are hired on short-term contracts by local
school committees. The contract teachers have much stronger incentives
to teach well because a good record of performance may lead them to a
regular teaching job. To examine heterogeneous effects across groups
defined by student’s gender and teacher’s type, define the resulting
four groups as follows. The covariates <span class="math inline">\(z\)</span> include indicators for
student’s gender and for contract teacher, and
<span class="math inline">\(z_0 = \left((0,0),(1,0),(0,1),(1,1)\right)^{\prime}\)</span>. This
specification means that Group-1 consists of boys taught by regular
teachers, while the remaining three groups are defined accordingly</p>
<div class="small">
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>zw <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ddk_2011<span class="sc">$</span>girl,con)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>z.eval <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dv">2</span>),<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">each=</span><span class="dv">2</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rd.qte</span>(<span class="at">y=</span>yy,<span class="at">x=</span><span class="fu">cbind</span>(xx,zw),<span class="at">d=</span>dr,<span class="at">x0=</span><span class="dv">50</span>,<span class="at">z0=</span>z.eval,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,<span class="at">bias=</span><span class="dv">1</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(A,<span class="at">alpha=</span><span class="fl">0.1</span>)</span></code></pre></div>
</div>
<p>An outcome table with four groups is not easy to read. It will be easier
to examine results visually by QTE plots as in
Figure <a href="#fig:rct_four_groups" data-reference-type="ref" data-reference="fig:rct_four_groups">4</a>.</p>
<div class="small">
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>y.text <span class="ot">&lt;-</span> <span class="st">&quot;test scores&quot;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>m.text <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;boys &amp; regular teachers&quot;</span>,<span class="st">&quot;girls &amp; regular teachers&quot;</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>              <span class="st">&quot;boys &amp; contract teachers&quot;</span>,<span class="st">&quot;girls &amp; contract teachers&quot;</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A2,<span class="at">ytext=</span>y.text,<span class="at">mtext=</span>m.text)  </span></code></pre></div>
</div>
<figure id="fig:rct_four_groups">
<img src="figures/rct_qte_four_groups_new.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 4: QTE Estimates from RCT by Student Gender and Teacher
Type</figcaption>
</figure>
<p>The biggest effect can be found for boys taught by contract teachers.</p>
<p><strong>By age of students</strong></p>
<p>Students in the sample differ greatly in age. The average student at the
endline test is 9.3 years old. But the age of the middle ninety percent
of students ranges from 7 to 12 years at the time of the test. Below we
compare the effects across four age groups.</p>
<div class="small">
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>zw <span class="ot">&lt;-</span> ddk_2011<span class="sc">$</span>agetest</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>z.eval <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rd.qte</span>(<span class="at">y=</span>yy,<span class="at">x=</span><span class="fu">cbind</span>(xx,zw),<span class="at">d=</span>dr,<span class="at">x0=</span><span class="dv">50</span>,<span class="at">z0=</span>z.eval,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,<span class="at">bias=</span><span class="dv">1</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(A,<span class="at">alpha=</span><span class="fl">0.1</span>)</span></code></pre></div>
</div>
<p>The effects by age groups are displayed in
Figure <a href="#fig:rct_age" data-reference-type="ref" data-reference="fig:rct_age">5</a>.
The bigger effects can be found for younger students. The maximum
quantile effect of tracking at age seven is <span class="math inline">\(0.602\)</span> standard deviation,
while at age twelve it is <span class="math inline">\(0.285\)</span> standard deviation.</p>
<div class="small">
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>y.text <span class="ot">&lt;-</span> <span class="st">&quot;test scores&quot;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>m.text <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;age 7&quot;</span>,<span class="st">&quot;age 9&quot;</span>,<span class="st">&quot;age 10&quot;</span>,<span class="st">&quot;age 12&quot;</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A2,<span class="at">ytext=</span>y.text,<span class="at">mtext=</span>m.text)</span></code></pre></div>
</div>
<figure id="fig:rct_age">
<img src="figures/rct_qte_age_new.png" style="width:100.0%" alt="graphic without alt text" />
<figcaption>Figure 5: QTE Estimates from RCT, by Student
Age</figcaption>
</figure>
<p>Testing hypotheses for each age group can also be conducted as follows.</p>
<div class="small">
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">rdq.test</span>(<span class="at">y=</span>yy,<span class="at">x=</span><span class="fu">cbind</span>(xx,zw),<span class="at">d=</span>dr,<span class="at">x0=</span><span class="dv">50</span>,<span class="at">z0=</span>z.eval,<span class="at">tau=</span>tlevel,<span class="at">bdw=</span>hh,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                <span class="at">bias=</span><span class="dv">1</span>,<span class="at">alpha=</span><span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.05</span>),<span class="at">type=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>))</span></code></pre></div>
</div>
<p>Test results indicate that QTEs are significant and uniformly positive
for all four age groups.</p>
<h3 data-number="5" id="conclusion"><span class="header-section-number">5</span> Conclusion</h3>
<p><strong>QTE.RD</strong> is a comprehensive R package designed for analyzing quantile
treatment effects under sharp RD designs. The package enables
researchers to test, estimate, and conduct uniform inference on quantile
treatment effects (QTEs), incorporating covariates, implementing robust
bias correction, selecting the bandwidth, and plotting the estimation
results, all in the same place. To our knowledge, this is the first
comprehensive R package for estimating quantile effects under RD
designs.</p>
<p>The package can be expanded in two directions to encompass a greater
range of empirical applications. The first is to accommodate time-series
RD designs <span class="citation" data-cites="2018.Hausman">(<a href="#ref-2018.Hausman" role="doc-biblioref">Hausman and Rapson 2018</a>)</span>. Developing valid inference results for
time-series data would be the first step in achieving this goal. The
second is to allow for more than a few covariates in the model, which
might require incorporating penalization or some covariate selection
methods to guide model specification. We intend to pursue these
directions and expand the capacity of this package accordingly.</p>
<h3 class="unnumbered" id="acknowledgments">Acknowledgments</h3>
<p>Jungmo Yoon acknowledges financial support from the National Research
Foundation of Korea (NRF-2020S1A5A8042547).</p>
</div>
<h3 class="appendix" data-number="6" id="cran-packages-used"><span class="header-section-number">6</span> CRAN packages used</h3>
<p><a href="https://cran.r-project.org/package=QTE.RD">QTE.RD</a>, <a href="https://cran.r-project.org/package=qte">qte</a>, <a href="https://cran.r-project.org/package=quantreg.nonpar">quantreg.nonpar</a></p>
<h3 class="appendix" data-number="7" id="cran-task-views-implied-by-cited-packages"><span class="header-section-number">7</span> CRAN Task Views implied by cited packages</h3>
<p><a href="https://cran.r-project.org/view=CausalInference">CausalInference</a></p>
<h3 class="appendix" data-number="8" id="note"><span class="header-section-number">8</span> Note</h3>
<p>This article is converted from a Legacy LaTeX article using the
<a href="https://cran.r-project.org/package=texor">texor</a> package.
The pdf version is the official version. To report a problem with the html,
refer to CONTRIBUTE on the R Journal homepage.</p>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Calonico2019" class="csl-entry" role="listitem">
S. Calonico, M. D. Cattaneo, M. H. Farrell and R. Titiunik. Regression discontinuity designs using covariates. <em>The Review of Economics and Statistics</em>, 101(3): 442–451, 2019. URL <a href="https://doi.org/10.1162/rest_a_00760">https://doi.org/10.1162/rest_a_00760</a>.
</div>
<div id="ref-2014.Calonico.Cattaneo.Titiunik" class="csl-entry" role="listitem">
S. Calonico, M. D. Cattaneo and R. Titiunik. Robust nonparametric confidence intervals for regression-discontinuity designs. <em>Econometrica</em>, 82(6): 2295–2326, 2014. URL <a href="https://doi.org/10.3982/ECTA11757">https://doi.org/10.3982/ECTA11757</a>.
</div>
<div id="ref-Chiang.Hsu.sasaki.2019" class="csl-entry" role="listitem">
H. D. Chiang, Y.-C. Hsu and Y. Sasaki. Robust uniform inference for quantile treatment effects in regression discontinuity designs. <em>Journal of Econometrics</em>, 211(2): 589–618, 2019. URL <a href="https://doi.org/10.1016/j.jeconom.2019.03.006">https://doi.org/10.1016/j.jeconom.2019.03.006</a>.
</div>
<div id="ref-1974.Doksum" class="csl-entry" role="listitem">
K. Doksum. Empirical probability plots and statistical inference for nonlinear models in the two-sample case. <em>The Annals of Statistics</em>, 2(2): 267–277, 1974. URL <a href="https://doi.org/10.1214/aos/1176342662">https://doi.org/10.1214/aos/1176342662</a>.
</div>
<div id="ref-Duflo.Dupas.Kremer.2011" class="csl-entry" role="listitem">
E. Duflo, P. Dupas and M. Kremer. Peer effects, teacher incentives, and the impact of tracking: Evidence from a randomized evaluation in <span>Kenya</span>. <em>American Economic Review</em>, 101(5): 1739–74, 2011. URL <a href="https://doi.org/10.1257/aer.101.5.1739">https://doi.org/10.1257/aer.101.5.1739</a>.
</div>
<div id="ref-2012.Frandsen.Frolich.Melly" class="csl-entry" role="listitem">
B. R. Frandsen, M. Frölich and B. Melly. Quantile treatment effects in the regression discontinuity design. <em>Journal of Econometrics</em>, 168(2): 382–395, 2012. URL <a href="http://dx.doi.org/10.1016/j.jeconom.2012.02.004">http://dx.doi.org/10.1016/j.jeconom.2012.02.004</a>.
</div>
<div id="ref-2018.Hausman" class="csl-entry" role="listitem">
C. Hausman and D. S. Rapson. Regression discontinuity in time: Considerations for empirical applications. <em>Annual Review of Resource Economics</em>, 10(1): 533–552, 2018. URL <a href="https://doi.org/10.1146/annurev-resource-121517-033306">https://doi.org/10.1146/annurev-resource-121517-033306</a>.
</div>
<div id="ref-2008.Imbens.Lemieux" class="csl-entry" role="listitem">
G. W. Imbens and T. Lemieux. Regression discontinuity designs: A guide to practice. <em>Journal of Econometrics</em>, 142(2): 615–635, 2008. URL <a href="http://dx.doi.org/10.1016/j.jeconom.2007.05.001">http://dx.doi.org/10.1016/j.jeconom.2007.05.001</a>.
</div>
<div id="ref-2005.Koenker" class="csl-entry" role="listitem">
R. Koenker. <em>Quantile regression.</em> Cambridge University Press, 2005. URL <a href="https://doi.org/10.1017/CBO9780511754098">https://doi.org/10.1017/CBO9780511754098</a>.
</div>
<div id="ref-1975.Lehmann" class="csl-entry" role="listitem">
E. L. Lehmann. <em>Nonparametrics: Statistical methods based on ranks.</em> Holden-Day, San Francisco., 1975. URL <a href="https://doi.org/10.2307/2344536">https://doi.org/10.2307/2344536</a>.
</div>
<div id="ref-2019.Qu.Yoon" class="csl-entry" role="listitem">
Z. Qu and J. Yoon. Uniform inference on quantile effects under sharp regression discontinuity designs. <em>Journal of Business and Economic Statistics</em>, 37(4): 625–647, 2019. URL <a href="https://doi.org/10.1080/07350015.2017.1407323">https://doi.org/10.1080/07350015.2017.1407323</a>.
</div>
<div id="ref-2024.Qu.Yoon.Perron" class="csl-entry" role="listitem">
Z. Qu, J. Yoon and P. Perron. Inference on conditional quantile processes in partially linear models with applications to the impact of unemployment benefits. <em>The Review of Economics and Statistics</em>, 521–541, 2024. URL <a href="https://doi.org/10.1162/rest\_a\_01168">https://doi.org/10.1162/rest\_a\_01168</a>.
</div>
<div id="ref-1960.Thistlethwaite.Campbell" class="csl-entry" role="listitem">
D. L. Thistlethwaite and D. T. Campbell. Regression-discontinuity analysis: An alternative to the ex post facto experiment. <em>Journal of Educational psychology</em>, 51(6): 309–317, 1960. URL <a href="https://doi.org/10.1037/h0044319">https://doi.org/10.1037/h0044319</a>.
</div>
<div id="ref-1998.Yu.Jones" class="csl-entry" role="listitem">
K. Yu and M. C. Jones. Local linear quantile regression. <em>Journal of the American Statistical Association</em>, 93(441): 228–237, 1998. URL <a href="https://doi.org/10.2307/2669619">https://doi.org/10.2307/2669619</a>.
</div>
</div>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>This function is a S3 method for class <code>qte</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This hypothesis is sometimes referred to as the positive dominance
hypothesis.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This type of unambiguity hypothesis is referred to as the negative
dominance hypothesis.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>This function is a S3 method for class <code>qte</code>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>The dataset is included in the package. For additional details,
please refer to the package manual.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Qu &amp; Yoon, "QTE.RD: An R Package for Quantile Treatment Effects in Regression-Discontinuity Designs", The R Journal, 2025</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2025-024,
  author = {Qu, Zhongjun and Yoon, Jungmo},
  title = {QTE.RD: An R Package for Quantile Treatment Effects in Regression-Discontinuity Designs},
  journal = {The R Journal},
  year = {2025},
  note = {https://doi.org/10.32614/RJ-2025-024},
  doi = {10.32614/RJ-2025-024},
  volume = {17},
  issue = {3},
  issn = {2073-4859},
  pages = {69-88}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
