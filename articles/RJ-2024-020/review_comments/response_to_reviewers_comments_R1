We would like to thank the editor and the reviewers for their helpful comments and feedback. These constructive comments have improved the package and the paper overall. We have revised the manuscript in response to the comments. The main changes relate to the clarity of the explanations in the paper and the removal of unnecessary `next` clauses from the code.

In what follows, points and comments from the reviewers are indented with the '>' symbol and our responses are not indented. The line numbers for the updated sections are listed in brackets. For example, an update that is found on line 1 to line 3 of the main document is indicated by (lines 1-3). Lines in the appendix are prefixed with an A (e.g. A.1 is line 1 of the appendix).


(a) Editors comments

> 1. Please include in the introduction the novelty of the R package. Is the discussed method (partially) available in any other package?

No this method is not available in any other packages. To the best of our knowledge, this package and model is the first of its kind to estimate and project modern contraceptive method supply shares at the national and subnational administration levels using Demographic and Health survey data.

I have updated the introduction to clarify the novelty of this R package. The introductory section on line 49 now reads:

'...In this paper, we extend the model to estimate supply shares using input data from a single-country and to also include estimation at the subnational administrative division. At the time of writing, this package and models are the first of their kind to estimate and project modern contraceptive method supply shares at the national and subnational administration levels using Demographic and Health survey data.'


> 2. Also, discuss the design of the package interface: is there any workflow in mind? Does the design of the exported functions mimic certain standards or practices? (like base R or tidyverse, or otherwise)?

The package uses tidyverse throughout. The graphics are produced using ggplot2, dplyr is used for any data manipulation procedures. The workflow of the package is intended to mimic the Bayesian workflow  [@Gelman2020]. The users are encouraged to explore the data, the model inputs, and the model output. The individual elements of the workflow are made as accessible as possible through the built-in functions, such as the 'get_data' and 'plot_estimates' functions, and the code provided  in the vignettes to test the convergence of the model parameters using numerical and visual summaries.

I have updated the introduction to include this point. On line 62, it now reads:

'This paper introduces the R package \CRANpkg{mcmsupply} for estimating and projecting the contraceptive supply share at the national and subnational administration divisions using multi-country or single-country datasets. The package uses \CRANpkg{tidyverse} throughout to carry out data manipulation and visualisation tasks. The graphics are produced using \CRANpkg{ggplot2} and \CRANpkg{dplyr} is used for any data manipulation procedures. The workflow of the package aims to follow a Bayesian workflow  [@Gelman2020]. The users are encouraged to explore the data, the model inputs, and the model outputs using diagnostics and visualisations. The individual elements of the workflow are made as accessible as possible through the built-in functions, such as the 'get_data' and 'plot_estimates' functions, and the code provided  in the vignettes to test the convergence of the model parameters using numerical and visual summaries.'


(b) Reviewer 1

> The article is generally well-written and is important to R community. The technology and methods are up-to-date with some > exceptions (listed below). Although some of the functions (e.g., those based on `run_jags_model` shown in Figure 2 on page > 8) are slow, most of them run and work without any issues.

We would like to thank Reviewer 1 for their kind words. We have addressed their comments below.

> 1. In the Abstract section, the authors used acronym `IPUMS` without first spelling it. Also, in the second last sentence > of the Abstract section, the authors typed `mcmcsupply` [instead of `mcmsupply`, the package name].

We thank the reviewer for spotting these typos. We have added the full name for IPUMS and addressed the typo in the mcmsupply R package name. The abstract now reads:

...generated by Integrated Public Use Microdata Series (IPUMS) and Demographic and Health Survey (DHS) microdata.

> 2. In the second paragraph within Introduction section, authors mention “The single-country mcmsupply model…” Is this a
> single-country study?

The mcmsupply R package paper contains case studies for both single-country and multi-country model estimation approaches at both the national and subnational administration levels. We have updated this second paragraph to include a clarification of this point. This now reads:

.... The mcmsupply package contains vignettes that consider case studies of both single-country and multi-country model estimation approaches at the national and subnational administration levels.


> 3. Two citations “(Plummer 2015) (Lunn et al. 2009)” in the second paragraph within Introduction section are not clear.
> Is one of them the secondary source? Should they be inserted within the same pair of parentheses?

Yes, we have updated this reference to now read on line 51:

([@Lunn2009] as cited in [@Plummer2015]).


> 4. In the second paragraph of page 2 (within the Introduction section), these citations: “(New et al. 2017), (Mercer, Lu, and Proctor 2019), (Li at al. 2019)” are not clear.

We used these citations to give examples of national and subnational estimation of family planning indicators.


> 5. In the third paragraph of page 2 (within Introduction section), the citation “(Herger Boyle, King, and Sobek 2022)” is not clear.

This citation is used to name the source of the IPUMS datasets. It is required as part of the data-sharing agreement.


> 6. In the third paragraph of page 2 (within Introduction section), the acronym JAGS should be spelled out before the
> acronym, like Just Another Gibbs Sampler (JAGS).

We have addressed this issue. This sentence now reads on line 67:
The model fitting process described uses Just Another Gibbs Sampler (JAGS).

> 7. In the sentence “The mcmsupply package …” on page 3, the name `mcmsupply` should be typed as a package name is usually > typed.

We have addressed this issue.

> 8. In the second bullet point on page 3 (and also on page 5), the citation “Comiskey et al., 2003” does not appear to be
> in an acceptable format. Should it be written as “Comiskey et al. (2003)”?

We have addressed this issue throughout the paper.

> 9. There are 68 countries in the dataset `national_FPsource_data` whereas the authors reported 67 countries in their
> manuscript. Which one is correct? Authors should check all functions for the accuracy of their reporting.

Following the updates made to the model estimation process, we now only contain Family Planning source data and their associated variance-covariance matrices for 33 countries at the national level. We have updated this sentence (lines 73-78) to correctly reflect the latest datasets. This sentence now reads:

'The \CRANpkg{mcmsupply}  package contains the following input data sources:

- Survey data for the national and subnational modern contraceptive supply shares between 1990 and 2022 for a selection of countries participating in the FP2030 initiative.
- Variance-covariance data on the logit scale corresponding to the observed public and commercial medical modern contraceptive supply shares at the national level between 1990 and 2022 for a selection of countries participating in the FP2030 initiative.
- Estimated correlations between the rates of change in method supply shares in the public and private sectors at both the national and subnational administrative divisions. These are derived based on the method outlined in Comiskey et al. (2023).
- Global and subcontinental parameter estimates obtained from the multi-country model run at the national and subnational level.'

And line 81 now reads:

'The national contraceptive supply source data has data for 33 countries (including participants and non-participants of FP2030) between 1990 and 2022.'

> 10. In the last sentence of Table 2 title (page 4), the word “it’s” is not clear. Is it its [without an apostrophe]?

We have updated for this grammatical error. We now use 'its'.

> 11. Titles of Tables 3-4 and 5-7 (pages 5 and 7-8) are shown below the Tables. Shouldn’t titles be shown above the body of Tables?

This has been updated to use captions over the top of the tables.

> 12. Also, in the title of Table 5, the second sentence does not have correct syntax. For example:
> “The four types of model…” should be written as “The four types of models…”

This typo is fixed.

> 13. Two citations in the last paragraph on page 6 appear to be in an inconsistent format. Why to use
> in-text and parenthetical citations at the same time? Please check if they are in correct format.

This typo has been fixed and the sentence (line 206) now reads:
...described in Azose and Raftery, (2018) and adapted for method supply shares in Comiskey et al. (2023).

> 14. In the body of Table 5 (first row, third column) on page 7, why is the symbol delta with subscripts c, m, s, k enclosed within double parentheses?

This typo has been addressed. The (($\delta_{c,m,s,k}$)) has been removed and replaced with ($\delta_{c,m,s,k}$).


> 15. The parameter `P` in the second column of Table 5 (on page 7) has the same definition for the two models (Multi-country national and Single-country national). Is it correct?

This typo has been addressed. The table now reads for the multi-country national model estimates:
P | The method supply share proportions across all countries, methods and sectors.

and for the single-country national model estimates:
P | The method supply share proportions for a given country, across all methods and sectors.

> 16. In the titles of Table 5 and 6, the function names (e.g., `run_jags_model` and `plot_estimates`) and the package name > `mcmsupply` are written without the use of distinct font style of R Journal.

I had issues with compiling when these names are in the style of the R journal.


> 17. Figure 3 and Figure 4 captions appear to have incorrect descriptions. If Figure 3 is for multicountry
> model and Figure 4 is for single-country model, the respective Figure captions should
> reflect this information accurately.

As a demonstration of the models, we use Nepal as an example in both cases. Therefore, we have two sets of model estimates for Nepal. Figure 3 shows the model estimates for Nepal when estimated using a multi-country dataset and the multi-country national level model. While, Figure 4 shows the model estimates for Nepal when estimated using a single-country dataset and the single-country national level model.

>  Some of the ways in which the manuscript can be improved are:

> 1. In the examples of use cases (e.g., those shown in Figure 2), authors can use relatively smaller
> values of arguments (e.g., `n_iter`, `nburn` in the `run_jags_model` function) and mention about
> the time such codes will take with different values of these arguments. This is important
> because a user will find these functions unusable if they have to wait for 12 hours (as the
> authors mention in the first paragraph of page 9) to run these codes.

We have updated the paper to reflect this recommendation. On page 10 line 355, it now reads:

...For demonstration purposes in the code below, these arguments are set to low values. However, for optimal model convergence we recommend increasing the iterations to 80,0000, the burn-in period to 10,000, and the thinning to 35. Please note that for these increased values of arguments, the model run time is approximately 12 hours.


> 2. By avoiding typos or other sentence syntax issues. For example: The word “and” is typed as “nd”
> on page 10 (below Figure 3).

This typo has been addressed and we have carefully re-proofed the paper for other typos.

> 3. By using consistency in their presentations. For example: Inserting spaced before and after the
> equal to (=) sign in their codes.

We have updated all code to reflect this recommendation.

(c) Reviwer 2

> Authors provided a new R package "mcmsupply" for estimating contraceptive method market supply shares. The package is built on top of the model described in Paper: Estimating the proportion of modern contraceptives supplied by the public and private sectors using a Bayesian hierarchical penalized spline model, on arXiv, and Population Association of America's 2022 annual meeting.

> The package is written carefully, with examples for different use cases described both in paper and the docs of the package itself.   It combines the raw data, data cleaning, and model estimation processes, and it is easy to use to a new user without strong background in this topic.


'The package is written carefully, with examples..... and it is easy to use to a new user without strong background in this topic.', We would like to thank Reviewer 2 for their kind words. It is much appreciated.

> 1. The first comment, and I believe it should be the most vital one, is the importance of the work. The whole work is based on the model described in the 2022 paper above on PAA and arXiv, and the main contribution of the model is to provide an estimation on the proportion of different sources of modern contraceptive supplies from different sectors, with limited number of survey data. However, even in the case that we could get an exact estimate of the proportions of different sectors, it would not be able to describe a bigger picture on the accessibility of the model contraceptive supplies for women living in low income countries. It is much more important to understand the prevalence of these supplies, instead of the suppliers of those supplies. Indeed, we may be able to infer from the proportion changes of these supplies sources, but the relationship might be obscure, and is not discussed in both papers, especially for this one.

> In my opinion, this paper will be more important if the 2022 paper on arXiv is published by some journals with a careful peer-reviewing process. With that, it could show that the model is important to the scientific society, and the development of a package for that model will be important then.

With respect to the publication of the models and methodology included in the mcmsupply R package, the associated methodological paper entitled 'Estimating the proportion of modern contraceptives supplied by the public and private sectors using a Bayesian hierarchical penalized spline model' is under the second round of revisions with the Journal of Royal Statistical Society, Series A: Statistics in Society. The revisions recommednded by these reviewers have been incorporated into the mcmsupply R package. We believe that this answers the questions of the reviewer with respect to the importance of this work to the scientific community and the appeal of the work to both Demographic and non-subject experts alike.


> 2. I would like to discuss a bit more about the use of models. In the 2022 paper, authors provided out of sample analysis to prove the superiority of the models over the linear models. The results was not very surprising to me, as the data doesn't look to be linear, and the OOS results show significantly worse performance in RMSE, while the MAE was not that bad in the linear model. This is likely due to the cases when the trend reverses for the last observes, the linear model will be off much more than the spline model, and results in huge errors.

> However, I am not very excited about comparing with 0 correlation results. From the validation results, I can't see the superiority of the main model over zero-correlation model. Most of the metrics: nominal coverages, MAE, RMSE, Mean errors and PI width are all similar. Authors explained in several paragraphs without showing why the full model is more suitable to this problem. This usually means that we should choose the simple over the complex ones. Authors need to explain the selection of the model with at least one convincing point.

This point is examined in the methodological paper in more detail. In summary, we argue that including the cross-method correlations acknowledges that in reality the supply shares of different methods within the public and private sectors do not act independently of one another. While the inclusion of the cross-method correlations may not make significant improvements they provide a more realistic description of the underlying processes at play.


> Lastly, another weaker comment is: Using splines have its limitation as well. Splines is not very reliable for its extrapolation performances, and most likely the extrapolation will be done by following the last pieces trend, and smoothing the curve. That's shown in the case studies of the paper. It might not be appropriate to ask for some more validation studies (such as leave more data out) due to the limitation of the data, but the reasoning of using splines models over some parametric models is not strong enough for me.

We thank the reviewer for their comment. We have now included a discussion on the use of splines for estimation on line 142. It now reads:

'...The use of splines for the estimation of demographic indicators is growing in popularity. Previous studies used small-area estimation models with splines to capture complex shapes of demographic spatio-temporal data [@Ugarte2010] [@Ugarte2009]. In recent years, many international health organisations have also used splines for the estimation of key demographic indicators. These include the estimation and projection of under-5 mortality for United Nations Children's Fund (UNICEF) [@Sharrow2019] and the estimation of excess morality due to Covid-19 for the World Health Organisation (WHO) [@Knutson2023]. We build on these previous studies to use penalised regression splines in the mcmsupply R package.'

[1] M. D. Ugarte, T. Goicoa, and A. F. Militino. Spatio-temporal modeling of mortality risks using penalized splines. Environmetrics, 21(3-4):270-289, 5 2010.

[2] M. D. Ugarte, T. Goicoa, A. F. Militino, and M. Durban. Spline smoothing in small
area trend estimation and forecasting. Computational Statistics and Data Analysis,
53:3616-3629, 2009.

[3] D. Sharrow, L. Hug, D. You, L. Alkema, R. Black, S. Cousens, T. Croft, V. Gaigbe-
Togbe, P. Gerland, M. Guillot, K. Hill, B. Masquelier, C. Mathers, J. Pedersen, K. L. Strong, E. Suzuki, J. Wakefield, and N. Walker. Global, regional, and national trends in under-5 mortality between 1990 and 2019 with scenario-based projections until 2030: a systematic analysis by the UN Inter-agency Group for Child Mortality Estimation. Lancet Global Health, 10:195-206, 2022. Accessed: 2022-08-31.

[4] V. Knutson, S. Aleshin-Guendel, A. Karlinsky, W. Msemburi, and J. Wakefield. Estimating global and country-specific excess mortality during the Covid-19 pandemic.
Annals of Applied Statistics, 17(2):1353{1374, 6 2023. Accessed: 2022-08-31.


> 3. Back to this package. In general the package was written well. I not only tried to play with the package, but also went through carefully about the internal codes of the package. Authors drafted those codes carefully, and the users are not hard to re-use them by following the manual and this paper. There are some parts of design I would like to raise to improve the package as well as this paper:

'...In general the package was written well'. We thank the reviewer for their kind comments.

> - For data: Authors need to explain better about the required format of the user-input data, if a new researcher wants to do the estimate with his own data. Indeed, authors provided some samples, but a better exercise should also include a section in the paper describing the required columns, formatting, and other information to this data;

We have expanded on the discussion of custom data to clarify the required formatting. We use a table where each column is explained in detail (lines 479- 537). In addition, we would like to highlight that we have included a `get_data` function that runs a series of internal checks to evaluate whether or not custom data is suitable for inclusion. This is discussed at the top of page 13 (line 476), where it says:

'...The `get_data` function will carry out a series of internal checks to ensure the custom data matches the stored data layout. If the custom data is not suitable, the `get_data` function will return an error and a message to the user describing the issue with the custom data.'


> - The model specification: The authors set the number of knots to 12 by default. However, there were no clear reasoning of this selection. It's good that researchers could change those easily in the function get_modelinputs, but justification of these selections are necessary.

We have added in an explanation of this choice. On line 141, it now reads:
'....This equates to a knot approximately every 3.5 years. Through validation, it was found that having fewer knots dis-improved model fit, while more knots did not significantly improve model fit.'

> - For all estimation processes, authors should provide seed so that users could reproduce the results under the same seed. This is important for many cases, including but not limited to debugging, model development etc.

This is added to the beginning of each vignette and the article.


> - Data cleaning process should be explained better. Authors should add at least two parts. The first is to explain what steps authors have taken in get_data function to change from the original data to the data ready for get inputs. This includes dropping NaN, renaming, data filtering (dplyr::filter(n_Commercial_medical>=10 | n_Public>=10 | n_Other>=10)), etc. This should be important for users to test their own data and should be described at least in the Appendix. The second is that: the users should provide some examples in the paper that could clearly shows different output of running some codes in case study. For example, in case study 1, after the code snippet cleaned_natdata <- get_data(national=TRUE), authors should print the cleanedd_natdata (include/exclude the args could both work). In this way, this paper will be more self-sufficient, as currently readers of that need to set up the R environment and run these code snippets to understand the story from the authors.

We have updated this explanation to clarify the role of the `get_data` function (line 110). The following has been added to the Data pre-processing section:

'....The `get_data` function carries out several data pre-processing tasks. For example, it will remove observations where two or more sectors are missing. It also checks to see if observations across all three sectors sum to one and will replace missing observations with 0 when the total does sum to one. The function transforms the raw data away from the (0,1) boundary as parameter estimates that lie on the distribution limits cause issues with convergence during the model estimation process. Finally, the `get_data` function imputes any missing standard errors using a binomial approximation.'


> - For the model estimation, some summary functions to the jags output should be provided. This could be used to diagnose the convergence evaluation, initial value dependency, acceptance rate and thinning etcs. Also some tests (such as raftery.test) should be conducted and it is better to embed them in this package. Right now, we could only use the plot to evaluate that without any statistical testing. It is thus not clear why we need to choose the certain number of iterations, burnin and thinning. Also, some trace plots or some other plotting to diagnose the results should be provided.

We have added in a reference to assessing model convergence. To assess convergence, we consider the R-hat values of the model parameters using the plot function of \CRANpkg{rjags}, as well as the individual parameter trace plots [@Vehtari2021]. We have updated the vignettes to include code to plot the model output and review individual parameter traceplots. In future work, we will add in the Raftery and Lewis's diagnostic into the package.

To clarify this point, line 62 now reads:

'....The individual elements of the workflow are made as accessible as possible through the built-in functions, such as the 'get_data' and 'plot_estimates' functions, and the code provided in the vignettes to test the convergence of the model parameters. To assess convergence, we consider the R-hat values of the model parameters using the plot function of \CRANpkg{rjags}, as well as the individual parameter trace plots [@Vehtari2021].'


> - Lastly some coding logics could be improved. For example, in the internal_functions.R, we see multiple times of else {next}. This seems to be useless (as the if-statement finishes without else, it will automatically go to the next loop.) Also, for some functions such as region_index_fun, authors should use which function in R to generate more readable code. (Such as for function sector_index_fun, we could write something like my_data$index_sector[j] <- which(my_sectors == my_data$sector_category[j]) to get same results with one single for-loop).

We thank the reviewer for their helpful comments and suggestions to improve the coding logics. These have been implemented within the code. For example, within the indexing functions, the code now uses one for loop with a 'which' function:

superregion_index_fun <- function(my_data, n_region) {
  for (j in 1:nrow(my_data)) {
    my_data$index_superregion[j] <- which(n_region == my_data$Super_region[j])
  }
  return(my_data)
}


