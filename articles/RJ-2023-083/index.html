<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>Accessible Computation of Tight Symbolic Bounds on Causal Effects using an Intuitive Graphical Interface</title>

<meta property="description" itemprop="description" content="Strong untestable assumptions are almost universal in causal point estimation. In particular settings, bounds can be derived to narrow the possible range of a causal effect. Symbolic bounds apply to all settings that can be depicted using the same directed acyclic graph and for the same effect of interest. Although the core of the methodology for deriving symbolic bounds has been previously developed, the means of implementation and computation have been lacking. Our R-package causaloptim aims to solve this usability problem by providing the user with a graphical interface through Shiny. This interface takes input in a form that most researchers with an interest in causal inference will be familiar: a graph drawn in the user&#39;s web browser and a causal query written in text using common counterfactual notation."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2023-083/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2024-04-11"/>
<meta property="article:created" itemprop="dateCreated" content="2024-04-11"/>
<meta name="article:author" content="Gustav Jonzon"/>
<meta name="article:author" content="Michael C Sachs"/>
<meta name="article:author" content="Erin E Gabriel"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Accessible Computation of Tight Symbolic Bounds on Causal Effects using an Intuitive Graphical Interface"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Strong untestable assumptions are almost universal in causal point estimation. In particular settings, bounds can be derived to narrow the possible range of a causal effect. Symbolic bounds apply to all settings that can be depicted using the same directed acyclic graph and for the same effect of interest. Although the core of the methodology for deriving symbolic bounds has been previously developed, the means of implementation and computation have been lacking. Our R-package causaloptim aims to solve this usability problem by providing the user with a graphical interface through Shiny. This interface takes input in a form that most researchers with an interest in causal inference will be familiar: a graph drawn in the user&#39;s web browser and a causal query written in text using common counterfactual notation."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2023-083/"/>
<meta property="og:image" content="https://journal.r-project.org/articles/RJ-2023-083/figures/InterfaceStart2.png"/>
<meta property="og:image:width" content="2880"/>
<meta property="og:image:height" content="1656"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Accessible Computation of Tight Symbolic Bounds on Causal Effects using an Intuitive Graphical Interface"/>
<meta property="twitter:description" content="Strong untestable assumptions are almost universal in causal point estimation. In particular settings, bounds can be derived to narrow the possible range of a causal effect. Symbolic bounds apply to all settings that can be depicted using the same directed acyclic graph and for the same effect of interest. Although the core of the methodology for deriving symbolic bounds has been previously developed, the means of implementation and computation have been lacking. Our R-package causaloptim aims to solve this usability problem by providing the user with a graphical interface through Shiny. This interface takes input in a form that most researchers with an interest in causal inference will be familiar: a graph drawn in the user&#39;s web browser and a causal query written in text using common counterfactual notation."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2023-083/"/>
<meta property="twitter:image" content="https://journal.r-project.org/articles/RJ-2023-083/figures/InterfaceStart2.png"/>
<meta property="twitter:image:width" content="2880"/>
<meta property="twitter:image:height" content="1656"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Accessible Computation of Tight Symbolic Bounds on Causal Effects using an Intuitive Graphical Interface"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2023-083"/>
<meta name="citation_pdf_url" content="RJ-2023-083.pdf"/>
<meta name="citation_volume" content="15"/>
<meta name="citation_issue" content="4"/>
<meta name="citation_doi" content="10.32614/RJ-2023-083"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="53"/>
<meta name="citation_lastpage" content="68"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2024/04/11"/>
<meta name="citation_publication_date" content="2024/04/11"/>
<meta name="citation_author" content="Gustav Jonzon"/>
<meta name="citation_author_institution" content="Department of Medical Epidemiology and Biostatistics, Karolinska Institutet, Sweden"/>
<meta name="citation_author" content="Michael C Sachs"/>
<meta name="citation_author_institution" content="Department of Public Health, University of Copenhagen, Denmark"/>
<meta name="citation_author" content="Erin E Gabriel"/>
<meta name="citation_author_institution" content="Department of Public Health, University of Copenhagen, Denmark"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Bounds on natural direct effects in the presence of confounded intermediate variables;citation_publisher=Wiley Online Library;citation_volume=28;citation_author=Arvid Sjölander"/>
  <meta name="citation_reference" content="citation_title=Direct and indirect effects;citation_publisher=Morgan Kaufman;citation_author=J Pearl"/>
  <meta name="citation_reference" content="citation_title=An algorithm for determining irrelevant constraints and all vertices in systems of linear inequalities;citation_publisher=INFORMS;citation_volume=21;citation_author=Theodore H Mattheiss"/>
  <meta name="citation_reference" content="citation_title=A general method for deriving tight symbolic bounds on causal effects;citation_publisher=Taylor &amp; Francis;citation_volume=0;citation_doi=10.1080/10618600.2022.2071905;citation_author=Michael C. Sachs;citation_author=Gustav Jonzon;citation_author=Arvid Sjölander;citation_author=Erin E. Gabriel"/>
  <meta name="citation_reference" content="citation_title=The igraph software package for complex network research;citation_volume=Complex Systems;citation_author=Gabor Csardi;citation_author=Tamas Nepusz"/>
  <meta name="citation_reference" content="citation_title=“Mendelian randomization”: can genetic epidemiology contribute to understanding environmental determinants of disease?;citation_volume=32;citation_doi=10.1093/ije/dyg070;citation_issn=0300-5771;citation_author=George Davey Smith;citation_author=Shah Ebrahim"/>
  <meta name="citation_reference" content="citation_title=Thermolabile methylenetetrahydrofolate reductase, homocysteine, and cardiovascular disease risk: The European Concerted Action Project.;citation_volume=77;citation_doi=10.1093/ajcn/77.1.63;citation_issn=0002-9165;citation_author=Raymond Meleady;citation_author=Per M. Ueland;citation_author=Henk Blom;citation_author=Alexander S. Whitehead;citation_author=Helga Refsum;citation_author=Leslie E. Daly;citation_author=Stein Emil Vollset;citation_author=Cait Donohue;citation_author=Belinda Giesendorf;citation_author=Ian M. Graham;citation_author=Arve Ulvik;citation_author=Ying Zhang;citation_author=Anne-Lise Bjorke Monsen"/>
  <meta name="citation_reference" content="citation_title=Nonparametric bounds for the causal effect in a binary instrumental-variable model;citation_publisher=Stata Press;citation_volume=11;citation_author=N. A. Sheehan"/>
  <meta name="citation_reference" content="citation_title=Rcdd: Computational geometry;citation_author=Charles J. Geyer;citation_author=Glen D. Meeden;citation_author= Komei Fukuda"/>
  <meta name="citation_reference" content="citation_title=ACE bounds; SEMs with equilibrium conditions;citation_publisher=JSTOR;citation_volume=29;citation_author=Thomas S Richardson;citation_author=James M Robins"/>
  <meta name="citation_reference" content="citation_title=Bounds on natural direct effects in the presence of confounded intermediate variables;citation_volume=28;citation_doi=https://doi.org/10.1002/sim.3493;citation_author=Arvid Sjölander"/>
  <meta name="citation_reference" content="citation_title=Statistical validation of intermediate endpoints for chronic diseases;citation_volume=11;citation_doi=https://doi.org/10.1002/sim.4780110204;citation_author=Laurence S. Freedman;citation_author=Barry I. Graubard;citation_author=Arthur Schatzkin"/>
  <meta name="citation_reference" content="citation_title=A semiparametric instrumental variable approach to optimal treatment regimes under endogeneity;citation_publisher=Taylor &amp; Francis;citation_volume=116;citation_doi=10.1080/01621459.2020.1783272;citation_author=Yifan Cui;citation_author=Eric Tchetgen Tchetgen"/>
  <meta name="citation_reference" content="citation_title=Non-parametric bounds on treatment effects with non-compliance by covariate adjustment;citation_volume=26;citation_doi=https://doi.org/10.1002/sim.2766;citation_author=Zhihong Cai;citation_author=Manabu Kuroki;citation_author=Tosiya Sato"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","draft","date","author","type","output","bibliography","header-includes","always_allow_html","date_received","volume","issue","slug","journal","pdf_url","citation_url","doi","creative_commons","packages","CTV","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Accessible Computation of Tight Symbolic Bounds on Causal Effects using an Intuitive Graphical Interface"]},{"type":"character","attributes":{},"value":["Strong untestable assumptions are almost universal in causal point estimation. In particular settings, bounds can be derived to narrow the possible range of a causal effect. Symbolic bounds apply to all settings that can be depicted using the same directed acyclic graph and for the same effect of interest. Although the core of the methodology for deriving symbolic bounds has been previously developed, the means of implementation and computation have been lacking. Our R-package causaloptim aims to solve this usability problem by providing the user with a graphical interface through Shiny. This interface takes input in a form that most researchers with an interest in causal inference will be familiar: a graph drawn in the user's web browser and a causal query written in text using common counterfactual notation."]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["2024-04-11"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","url","email"]}},"value":[{"type":"character","attributes":{},"value":["Gustav Jonzon"]},{"type":"character","attributes":{},"value":["Department of Medical Epidemiology and Biostatistics, Karolinska Institutet, Sweden"]},{"type":"character","attributes":{},"value":["https://ki.se/meb"]},{"type":"character","attributes":{},"value":["gustav.jonzon@ki.se"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","email","orcid_id","affiliation","affiliation2"]}},"value":[{"type":"character","attributes":{},"value":["Michael C Sachs"]},{"type":"character","attributes":{},"value":["https://biostat.ku.dk/"]},{"type":"character","attributes":{},"value":["michael.sachs@sund.ku.dk"]},{"type":"character","attributes":{},"value":["0000-0002-1279-8676"]},{"type":"character","attributes":{},"value":["Department of Public Health, University of Copenhagen, Denmark"]},{"type":"character","attributes":{},"value":["Supported in part by Novo Nordisk Fonden Grant NNF22OC0076595"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","email","orcid_id","affiliation","affiliation2"]}},"value":[{"type":"character","attributes":{},"value":["Erin E Gabriel"]},{"type":"character","attributes":{},"value":["https://biostat.ku.dk/"]},{"type":"character","attributes":{},"value":["erin.gabriel@sund.ku.dk"]},{"type":"character","attributes":{},"value":["0000-0002-0504-8404"]},{"type":"character","attributes":{},"value":["Department of Public Health, University of Copenhagen, Denmark"]},{"type":"character","attributes":{},"value":["Supported in part by Novo Nordisk Fonden Grant NNF22OC0076595"]}]}]},{"type":"character","attributes":{},"value":["package"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["rjtools::rjournal_pdf_article","distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["citation_package"]}},"value":[{"type":"character","attributes":{},"value":["natbib"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","css"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["graph-creator.css"]}]}]},{"type":"character","attributes":{},"value":["causaloptim-paper.bib"]},{"type":"character","attributes":{},"value":["\\usepackage{subfig}"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2022-08-22"]},{"type":"integer","attributes":{},"value":[15]},{"type":"integer","attributes":{},"value":[4]},{"type":"character","attributes":{},"value":["RJ-2023-083"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[53]},{"type":"integer","attributes":{},"value":[68]}]},{"type":"character","attributes":{},"value":["RJ-2023-083.pdf"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2023-083"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2023-083"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["causaloptim","bpbounds","shiny","igraph","rcdd"]},{"type":"list","attributes":{},"value":[]}]},{"type":"character","attributes":{},"value":["CausalInference","GraphicalModels","Optimization","WebTechnologies"]},{"type":"character","attributes":{},"value":["/Library/Frameworks/R.framework/Versions/sitelib-4.4-arm64/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2023-083/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["causaloptim-paper_files/figure-html5/iv-fig-1.pdf","causaloptim-paper_files/figure-html5/iv-fig-1.png","causaloptim-paper_files/figure-html5/mediation-fig-1.pdf","causaloptim-paper_files/figure-html5/mediation-fig-1.png","causaloptim-paper_files/figure-latex/iv-fig-1.pdf","causaloptim-paper_files/figure-latex/mediation-fig-1.pdf","causaloptim-paper.bib","causaloptim-paper.log","causaloptim-paper.tex","d3.v3.min.js","distill-preview.png","figures/causaloptimDiagram.drawio.png","figures/causaloptimDiagramTall.drawio.png","figures/InterfaceAddedArcs2.png","figures/InterfaceAddNode2.png","figures/InterfaceAttribSet2.png","figures/InterfaceBounds2a.png","figures/InterfaceCardSet2.png","figures/InterfaceQuery2a.png","figures/InterfaceSetCard2.png","figures/InterfaceStart2.png","figures/Rlogo-5.png","graph-creator.css","graph-creator.js","jquery.js","RJ-2023-083_files/anchor-4.2.2/anchor.min.js","RJ-2023-083_files/bootstrap-3.4.1/accessibility/css/bootstrap-accessibility.min.css","RJ-2023-083_files/bootstrap-3.4.1/accessibility/js/bootstrap-accessibility.min.js","RJ-2023-083_files/bootstrap-3.4.1/css/bootstrap-theme.css","RJ-2023-083_files/bootstrap-3.4.1/css/bootstrap-theme.css.map","RJ-2023-083_files/bootstrap-3.4.1/css/bootstrap-theme.min.css","RJ-2023-083_files/bootstrap-3.4.1/css/bootstrap-theme.min.css.map","RJ-2023-083_files/bootstrap-3.4.1/css/bootstrap.css","RJ-2023-083_files/bootstrap-3.4.1/css/bootstrap.css.map","RJ-2023-083_files/bootstrap-3.4.1/css/bootstrap.min.css","RJ-2023-083_files/bootstrap-3.4.1/css/bootstrap.min.css.map","RJ-2023-083_files/bootstrap-3.4.1/fonts/glyphicons-halflings-regular.eot","RJ-2023-083_files/bootstrap-3.4.1/fonts/glyphicons-halflings-regular.svg","RJ-2023-083_files/bootstrap-3.4.1/fonts/glyphicons-halflings-regular.ttf","RJ-2023-083_files/bootstrap-3.4.1/fonts/glyphicons-halflings-regular.woff","RJ-2023-083_files/bootstrap-3.4.1/fonts/glyphicons-halflings-regular.woff2","RJ-2023-083_files/bootstrap-3.4.1/js/bootstrap.js","RJ-2023-083_files/bootstrap-3.4.1/js/bootstrap.min.js","RJ-2023-083_files/bootstrap-3.4.1/js/npm.js","RJ-2023-083_files/bowser-1.9.3/bowser.min.js","RJ-2023-083_files/distill-2.2.21/template.v2.js","RJ-2023-083_files/figure-html5/iv-fig-1.pdf","RJ-2023-083_files/figure-html5/iv-fig-1.png","RJ-2023-083_files/figure-html5/mediation-fig-1.pdf","RJ-2023-083_files/figure-html5/mediation-fig-1.png","RJ-2023-083_files/header-attrs-2.25/header-attrs.js","RJ-2023-083_files/jquery-3.6.0/jquery.min.js","RJ-2023-083_files/popper-2.6.0/popper.min.js","RJ-2023-083_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2023-083_files/tippy-6.2.7/tippy-light-border.css","RJ-2023-083_files/tippy-6.2.7/tippy.css","RJ-2023-083_files/tippy-6.2.7/tippy.umd.min.js","RJ-2023-083_files/webcomponents-2.0.0/webcomponents.js","RJ-2023-083.log","RJ-2023-083.pdf","RJ-2023-083.tex","RJ-2023-083.zip","RJournal.sty","RJwrapper.aux","RJwrapper.bbl","RJwrapper.blg","RJwrapper.brf","RJwrapper.log","RJwrapper.out","RJwrapper.tex","Rlogo-5.png","shiny.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.25/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="../../site_libs/bootstrap-3.4.1/css/bootstrap.min.css" rel="stylesheet" />
  <link href="../../site_libs/bootstrap-3.4.1/accessibility/css/bootstrap-accessibility.min.css" rel="stylesheet" />
  <script src="../../site_libs/bootstrap-3.4.1/js/bootstrap.min.js"></script>
  <script src="../../site_libs/bootstrap-3.4.1/accessibility/js/bootstrap-accessibility.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="' + slug + '.zip" class="dt-tag"><i class="fas fa-file-zipper"></i> Supplement</a>')

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").first();
      if (tpar && ! tpar.hasClass("subtitle")) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append($("d-title p:not(:empty)").first()) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Accessible Computation of Tight Symbolic Bounds on Causal Effects using an Intuitive Graphical Interface","description":"Strong untestable assumptions are almost universal in causal point estimation. In particular settings, bounds can be derived to narrow the possible range of a causal effect. Symbolic bounds apply to all settings that can be depicted using the same directed acyclic graph and for the same effect of interest. Although the core of the methodology for deriving symbolic bounds has been previously developed, the means of implementation and computation have been lacking. Our R-package causaloptim aims to solve this usability problem by providing the user with a graphical interface through Shiny. This interface takes input in a form that most researchers with an interest in causal inference will be familiar: a graph drawn in the user's web browser and a causal query written in text using common counterfactual notation.","doi":"10.32614/RJ-2023-083","authors":[{"author":"Gustav Jonzon","authorURL":"https://ki.se/meb","affiliation":"Department of Medical Epidemiology and Biostatistics, Karolinska Institutet, Sweden","affiliationURL":"#","orcidID":""},{"author":"Michael C Sachs","authorURL":"https://biostat.ku.dk/","affiliation":"Department of Public Health, University of Copenhagen, Denmark","affiliationURL":"#","orcidID":"0000-0002-1279-8676"},{"author":"Erin E Gabriel","authorURL":"https://biostat.ku.dk/","affiliation":"Department of Public Health, University of Copenhagen, Denmark","affiliationURL":"#","orcidID":"0000-0002-0504-8404"}],"publishedDate":"2024-04-11T00:00:00.000+00:00","citationText":"Jonzon, et al., 2024"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues/2025-4">Current</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../submissions.html">Submit</a>
<a href="../../contribute.html">Contribute</a>
<a href="../../editors.html">Editorial board</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Accessible Computation of Tight Symbolic Bounds on Causal Effects using an Intuitive Graphical Interface</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Strong untestable assumptions are almost universal in causal point estimation. In particular settings, bounds can be derived to narrow the possible range of a causal effect. Symbolic bounds apply to all settings that can be depicted using the same directed acyclic graph and for the same effect of interest. Although the core of the methodology for deriving symbolic bounds has been previously developed, the means of implementation and computation have been lacking. Our R-package causaloptim aims to solve this usability problem by providing the user with a graphical interface through Shiny. This interface takes input in a form that most researchers with an interest in causal inference will be familiar: a graph drawn in the user’s web browser and a causal query written in text using common counterfactual notation.</p></p>
</div>

<div class="d-byline">
  Gustav Jonzon <a href="https://ki.se/meb" class="uri">https://ki.se/meb</a> (Department of Medical Epidemiology and Biostatistics, Karolinska Institutet, Sweden)
  
,   Michael C Sachs <a href="https://biostat.ku.dk/" class="uri">https://biostat.ku.dk/</a> (Department of Public Health, University of Copenhagen, Denmark)
  
,   Erin E Gabriel <a href="https://biostat.ku.dk/" class="uri">https://biostat.ku.dk/</a> (Department of Public Health, University of Copenhagen, Denmark)
  
<br/>2024-04-11
</div>

<div class="d-article">
<h2 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>A common goal in many different areas of scientific research is to determine causal relationships between one or more exposure variables and an outcome. Prior to any computation or inference, we must clearly state all assumptions made, i.e., all subject matter knowledge available, regarding the causal relationships between the involved variables as well as any additional variables, called confounders, that may not be measured but influence at least two other variables of interest. A popular tool in applied research for encoding these causal assumptions is a directed acyclic graph (DAG), in which directed edges represent direct causal influences <span class="citation" data-cites="greenland1999causal">(<a href="#ref-greenland1999causal" role="doc-biblioref">Greenland et al. 1999</a>)</span>. Such a DAG not only clearly states the assumptions made by the researcher, but also comes with a sound methodology for causal inference, in the form of identification results (theorems on when an estimand is estimable) as well as derivation of expressions of causal estimands in terms of observable quantities <span class="citation" data-cites="pearl2009causality">(<a href="#ref-pearl2009causality" role="doc-biblioref">Pearl 2009</a>)</span>.</p>
<p>Unfortunately, point identification of a desired causal effect typically requires an assumption of no unmeasured confounders, in some form. When there are unmeasured confounders, it is sometimes still possible to derive bounds on the effect, i.e., a range of possible values for the causal effect in terms of the observed data distribution. Symbolic bounds are algebraic expressions for the bounds on the causal effect written in terms of probabilities that can be estimated using observed data. Alexander Balke and Judea Pearl first used linear programming to derive tight symbolic bounds in a simple binary instrumental variable (IV) setting <span class="citation" data-cites="balke1997bounds">(<a href="#ref-balke1997bounds" role="doc-biblioref">Balke and Pearl 1997</a>)</span>. Balke wrote a program in <code>C++</code> to take a linear programming problem as text file input, perform variable reduction, conversion of equality constraints into inequality constraints, and perform the vertex enumeration algorithm of <span class="citation" data-cites="mattheiss1973algorithm">Mattheiss (<a href="#ref-mattheiss1973algorithm" role="doc-biblioref">1973</a>)</span>. This program has since been used by researchers in the field of causal inference <span class="citation" data-cites="balke1997bounds cai2008bounds sjolander2009bounds sjolander2014bounds">(<a href="#ref-balke1997bounds" role="doc-biblioref">Balke and Pearl 1997</a>; <a href="#ref-cai2008bounds" role="doc-biblioref">Cai et al. 2008</a>; <a href="#ref-sjolander2009bounds" role="doc-biblioref">Sjölander 2009a</a>; <a href="#ref-sjolander2014bounds" role="doc-biblioref">Sjölander et al. 2014</a>)</span> but it is not particularly accessible because of the technical challenge of translating the DAG plus causal query into the constrained optimization problem and determining whether it is linear. Moreover, the program is not optimized and hence does not scale well to more complex problems. Since they only cover a simple instrumental variable setting, it has also not been clear to what extent their techniques extend to more general settings, nor how to apply them to more complex queries. Thus, applications of this approach have been limited to a small number of settings and few attempts to generalize the method to more widely applicable settings have been made.</p>
<p>Recent developments have expanded the applicability by generalizing the techniques and the causal DAGs and effects to which they apply <span class="citation" data-cites="generalcausalbounds">(<a href="#ref-generalcausalbounds" role="doc-biblioref">Sachs et al. 2022</a>)</span>. These new methods have been applied in novel observational and experimental settings <span class="citation" data-cites="gabriel2020causal gabriel2021nonparametric gabriel2022sharp">(<a href="#ref-gabriel2020causal" role="doc-biblioref">Gabriel et al. 2022a</a>,<a href="#ref-gabriel2022sharp" role="doc-biblioref">b</a>; <a href="#ref-gabriel2021nonparametric" role="doc-biblioref">2023</a>)</span>. Moreover, through the <code>R</code> package <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> <span class="citation" data-cites="causaloptim">(<a href="#ref-causaloptim" role="doc-biblioref">Sachs et al. 2023</a>)</span>, these computations are now accessible. With <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a>, the user needs only to give input in a way they would usually express their causal assumptions and state their target causal estimand; through a DAG and counterfactual expression. Providing DAGs through textual input is an awkward experience for most users, as DAGs are generally communicated pictorially. Our package <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> provides a user-friendly graphical interface (GUI) through a web browser, where the user can draw their DAG in a way that is familiar to them. The methodology that underpins <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> is not universal however; some restrictions on the DAG and query are imposed. These are validated and communicated to the user through the graphical interface, which guides the user through providing the DAG and query, adding any extra conditions beyond those encoded in the DAG, computing, interpreting and exporting the bounds for various further analyses.</p>
<p>There exist few other <code>R</code>-packages related to causal bounds and none to our knowledge for computation of symbolic bounds. <a href="https://cran.r-project.org/package=bpbounds">bpbounds</a> <span class="citation" data-cites="bpbounds-package">(<a href="#ref-bpbounds-package" role="doc-biblioref">Palmer et al. 2018</a>)</span> provides a text-based interface to compute numeric bounds for the original single instrumental variable example of Balke and Pearl and extends this by being able to compute bounds given different types of data input including a ternary rather than binary instrument. There is also a standalone program written in <code>Java</code> by the <code>TETRAD Project</code> (<a href="https://github.com/cmu-phil/tetrad" class="uri">https://github.com/cmu-phil/tetrad</a>) that includes a GUI and has a wrapper for <code>R</code>. Its focus, however, is on causal discovery in a given sample data set, and although it can also compute bounds, it can do so only numerically for the given data set.</p>
<p>In this paper we describe our <code>R</code> package <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a>, first focusing on the graphical and programmatic user interfaces in the next 2 sections. Then we highlight some of our interesting functions and data structures that may be useful in other contexts. We provide a summary of the theoretical background and methods, while referring to the companion paper <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span> for the details. We illustrate the use of the package with some numeric examples and close with a discussion and summary.</p>
<h2 data-number="2" id="graphical-user-interface"><span class="header-section-number">2</span> Graphical user interface</h2>
<p>In the following, we will work through the binary instrumental variable example, where we have 3 observed binary variables <span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span>, <span class="math inline">\(Z\)</span>, and we want to determine the average causal effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> given by the total causal risk difference, in the presence of unmeasured confounding by <span class="math inline">\(U_R\)</span> and an instrumental variable <span class="math inline">\(Z\)</span>. Our causal DAG is given by <span class="math inline">\(Z\to X\to Y\)</span> and <span class="math inline">\(X\leftarrow U_R\to Y\)</span> and our causal query is <span class="math inline">\(P(Y(X=1)=1)-P(Y(X=0)=1)\)</span>, where we use <span class="math inline">\(Y(X = x)\)</span> to denote the counterfactual outcome <span class="math inline">\(Y\)</span> if <span class="math inline">\(X\)</span> were intervened upon to have value <span class="math inline">\(x\)</span>. The package can handle more variables and complex settings including multiple exposures, outcomes and nested counterfactuals (although only a single exposure and outcome may be set by clicking vertices in the GUI, the query may easily be modified to a more complex one), but this classic example will serve to showcase its functionality.</p>
<p><a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> includes a GUI implemented in <a href="https://cran.r-project.org/package=shiny">shiny</a> <span class="citation" data-cites="shiny">(<a href="#ref-shiny" role="doc-biblioref">Chang et al. 2022</a>)</span>. The interface is launched in the user’s default web browser by calling <code>specify_graph()</code>.
Once the <a href="https://cran.r-project.org/package=shiny">shiny</a> app is launched, the user is presented with an interactive display as shown in Figure <a href="#fig:InterfaceStart">1</a>, in which they can draw their causal DAG. This display is divided into a left side <span class="math inline">\(\mathcal{L}\)</span> and right side <span class="math inline">\(\mathcal{R}\)</span> to classify the vertices according to the class of DAGs that the method covers. This division signifies the following: Existence of unmeasured confounding is assumed <em>within each</em> of these sides, but <em>not between</em> them, and any causal influence between the two sides <em>must originate</em> in <span class="math inline">\(\mathcal{L}\)</span>. Generally speaking, the outcome variables of interest will typically be on the right side, things like instruments or randomized treatments will be on the left side, and confounded exposures of interest on the right side. Thus, for the example, we would want to put the instrumental variable on the left side, but the exposure and outcome on the right side. In the web version of this article an interactive version of this interface is shown at the end of this section.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:InterfaceStart"></span>
<img src="figures/InterfaceStart2.png" alt="A picture of the causaloptim Shiny app web interface." width="100%" />
<p class="caption">
Figure 1: The Shiny web interface at launch
</p>
</div>
</div>
<p>The DAG that we aim to construct is depicted in Figure <a href="#fig:iv-fig">2</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:iv-fig"></span>
<img src="RJ-2023-083_files/figure-html5/iv-fig-1.png" alt="A picture of the instrumental variable DAG" width="100%" />
<p class="caption">
Figure 2: Causal DAG for the IV example.
</p>
</div>
</div>
<h3 data-number="2.1" id="specifying-the-setting-by-drawing-a-causal-diagram-and-adding-attributes"><span class="header-section-number">2.1</span> Specifying the setting by drawing a causal diagram and adding attributes</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:DAG"></span>
<img src="figures/InterfaceAddNode2.png" alt="Constructing the DAG" width="50%" /><img src="figures/InterfaceAddedArcs2.png" alt="Constructing the DAG" width="50%" />
<p class="caption">
Figure 3: Constructing the DAG
</p>
</div>
</div>
<p>The DAG is drawn using a point-and-click device (e.g., a mouse) to add vertices representing variables (by Shift-click) and name them (using any valid variable name in <code>R</code> without underscores), and to draw edges representing direct causal influences (Shift+drag) between them. The vertices may also be moved around, renamed and deleted (as can the edges) as also described in an instruction text preceding the DAG interface. As shown in Figure <a href="#fig:DAG">3</a>, for the example we add a vertex <span class="math inline">\(Z\)</span> on the left side, and vertices <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> on the right side. Then the <span class="math inline">\(Z \to X\)</span> and <span class="math inline">\(X \to Y\)</span> edges are added by Shift+clicking on a parent vertex and dragging to the child vertex. There is no need to add the unmeasured confounder variable <span class="math inline">\(U_R\)</span> as it is assumed and added automatically. The same would have applied to <span class="math inline">\(U_L\)</span>, but a confounder is added to a side only if it contains at least two variables.</p>
<p>Importantly, the nodes may be selected and assigned additional information. In <span class="math inline">\(\mathcal{R}\)</span>, a variable may be assigned as unobserved (click+‘u’). All observed variables are assumed categorical and their cardinality (i.e., number of levels) may be set (click+‘c’ brings up a prompt for this this number; alternatively a short-cut click+‘any digit’ is provided), with the default being binary. Although the causal query (i.e., the causal effect of interest) is entered subsequently, the DAG interface provides a convenient short-cut; a node <span class="math inline">\(X\)</span> may be assigned as an exposure (click+‘e’) and another <span class="math inline">\(Y\)</span> as outcome (click+‘y’), whereupon the default query is the total causal risk difference <span class="math inline">\(P(Y(X=1)=1)-P(Y(X=0)=1)\)</span>. Finally, an edge may be assigned as representing an assumed monotonic influence (click+‘m’), i.e., that increasing the value of the exposure can not decrease the value of the outcome, e.g, <span class="math inline">\(X(Z=0)\le X(Z=1)\)</span>. The nodes and edges change appearance according to their assigned characteristics (Figure <a href="#fig:Cardinality">4</a>) and violations to the restrictions characterizing the class of DAGs are detected and communicated to the user.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:Cardinality"></span>
<img src="figures/InterfaceSetCard2.png" alt="Setting attributes" width="33%" /><img src="figures/InterfaceCardSet2.png" alt="Setting attributes" width="33%" /><img src="figures/InterfaceAttribSet2.png" alt="Setting attributes" width="33%" />
<p class="caption">
Figure 4: Setting attributes
</p>
</div>
</div>
<p>Once the DAG has been drawn, the user may click the button “Analyze the graph”, upon which the DAG is interpreted and converted into an annotated <a href="https://cran.r-project.org/package=igraph">igraph</a>-object <span class="citation" data-cites="igraph">(<a href="#ref-igraph" role="doc-biblioref">Csardi and Nepusz 2006</a>)</span> as described in the implementation details below, and the results are displayed in graphical form to the user (Figure <a href="#fig:causalDAG">5</a>). The addition of <span class="math inline">\(U_R\)</span>, the common unmeasured cause of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, is added and displayed in this static plot.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:causalDAG"></span>
<img src="figures/InterfaceQuery2a.png" alt="The causal DAG and bounds" width="50%" /><img src="figures/InterfaceBounds2a.png" alt="The causal DAG and bounds" width="50%" />
<p class="caption">
Figure 5: The causal DAG and bounds
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="container-fluid">
<div class="col-sm-12">
<h1>Interactive content: Drawing the DAG</h1>
</div>
<div class="row" id="helptext">
<div class="col-sm-12">
<span class="help-block">The graph is divided into a left side and a right side. There is no confounding allowed between the left and right sides. All variables on the right side are confounded. Connections between the left and right sides must originate from the left. I.e, no connections from the right to left are allowed. On the left side, arbitrary connections are allowed and the model assumes that all nodes are observed and connected. On the right side, unmeasured variables are allowed, and the procedure assumes unmeasured confounding between all nodes. Once you press 'Analyze the graph', the algorithm will automatically add common causes to each side. </span>
</div>
<div class="col-sm-12">
<span class="help-block">Shift+click to add nodes. Shift+drag to connect nodes. Click to select nodes/edges and press 'd' to remove. Click a node to select and then press 'u' to mark it as unobserved/latent or press 'y' to mark it as the outcome of interest, or press 'e' to mark it as the exposure of interest. Select a node and press a digit to set that number of possible categorical values (all variables default to binary), or press 'c' and enter a number into the prompt. Click an edge and press 'm' to enforce monotonicity for that connection. Other constraints can be specified later. </span>
</div>
</div>
<div class="row" id="graphrow">
<div class="col-sm-12">
<div id="nvalsModal" class="modal fade" role="dialog">
<div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content shadow">
<div class="modal-header">
<h5 class="modal-title">Enter number of values: </h5>
</div>
<div class="modal-body">
<input id="nvalsInput" type="number" class="form-control" value="2" min="2"/>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
<button id="nvalsSubmit" type="button" class="btn btn-primary" data-toggle="modal" data-target="#nvalsModal">Ok</button>
</div>
</div>
</div>
</div>
<div id="toast"></div>
<div id="graph" style="height:480px"></div>
<br/>
</div>
</div>
<button id="endbtn" type="button" class="btn btn-default action-button" style="background-color: #fb6970">Exit and return graph object</button>
<button id="analyze" type="button" class="btn btn-default action-button" style="background-color: #69fb82">Analyze the graph</button>
<script src="d3.v3.min.js"></script>
<script src="jquery.js"></script>
<script src="shiny.js"></script>
<script src="graph-creator.js"></script>
</div>
</div>
<h3 data-number="2.2" id="specifying-the-causal-query"><span class="header-section-number">2.2</span> Specifying the causal query</h3>
<p>Next, the user is asked to specify the causal query, i.e., causal effect of interest.
If no outcome variable has been assigned in the DAG then the input field for the causal query is left blank and a query needs to be specified. In our example, since we have assigned an exposure and outcome using the DAG interface, the total causal risk difference <span class="math inline">\(P(Y(X=1)=1)-P(Y(X=0)=1)\)</span> is suggested.</p>
<h3 data-number="2.3" id="specifying-optional-additional-constraints"><span class="header-section-number">2.3</span> Specifying optional additional constraints</h3>
<p>The user is also given the option to provide additional constraints besides those imposed by the DAG. This may be considered an optional advanced feature where, e.g., monotonicity of a certain direct influence of <span class="math inline">\(Z\)</span> on <span class="math inline">\(X\)</span> may be assumed by entering <span class="math inline">\(X(Z=1)\ge X(Z=0)\)</span>, with any such extra constraints separated by line breaks. If this feature is used, the input is followed by clicking the button “Parse”, which identifies and fixes them.</p>
<h3 data-number="2.4" id="computing-the-symbolic-tight-bounds-on-the-query-under-the-given-constraints"><span class="header-section-number">2.4</span> Computing the symbolic tight bounds on the query under the given constraints</h3>
<p>As the final step, the button “Compute the bounds” is clicked, whereupon the constraints and objective are compiled into an optimization problem which is then solved for tight causal bounds on the query symbolically in terms of observational quantities (conditional probabilities of the observed variables in the DAG) and the expressions are displayed alongside information on how the parameters are to be interpreted in terms of the given variable names (Figure <a href="#fig:causalDAG">5</a>). During computation, a progress indicator is shown, and the user should be aware that complex and/or high-dimensional problems may take significant time. The interface also provides a feature to subsequently convert the bounds to LaTeX-code using standard probabilistic notation for publication purposes.</p>
<p>Once done, clicking “Exit and return objects to R” stops the <a href="https://cran.r-project.org/package=shiny">shiny</a> app and returns all information about the DAG, query and computed bounds to the <code>R</code>-session.
This information is bundled in a list containing the graph, query, parameters and their interpretation, the symbolic tight bounds as expressions as well as implementations as <code>R</code>-functions and further log information about the formulation and optimization procedures.</p>
<h2 data-number="3" id="programmatic-user-interface"><span class="header-section-number">3</span> Programmatic user interface</h2>
<p>Interaction may also be done entirely programmatically as we illustrate with the same binary instrumental variable example. First we create the <code>igraph</code> object using the <code>graph_from_literal</code> function. Once the basic graph is created, the necessary vertex and edge attributes are added. The risk difference is defined as a character object. The <code>analyze_graph</code> function is the workhorse of <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a>; it translates the causal graph, constraints, and causal effect of interest into a linear programming problem. This linear programming object, stored in <code>obj</code> in the code below, gets passed to <code>optimize_effect_2</code> which performs vertex enumeration to obtain the bounds as symbolic expressions in terms of observable probabilities. Note that when we textually enter the DAG, we also manually add the unmeasured confounding. Although the unmeasured confounder is designated as binary in the code, this is <em>not</em> assumed in the the computations where it is treated as possibly continuous, e.g.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>graph</span> <span class='op'>&lt;-</span> <span class='fu'>igraph</span><span class='fu'>::</span><span class='fu'><a href='https://r.igraph.org/reference/graph_from_literal.html'>graph_from_literal</a></span><span class='op'>(</span><span class='va'>Z</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>X</span>, <span class='va'>X</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>Y</span>, </span>
<span>                                    <span class='va'>Ur</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>X</span>, <span class='va'>Ur</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>Y</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/V.html'>V</a></span><span class='op'>(</span><span class='va'>graph</span><span class='op'>)</span><span class='op'>$</span><span class='va'>leftside</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/V.html'>V</a></span><span class='op'>(</span><span class='va'>graph</span><span class='op'>)</span><span class='op'>$</span><span class='va'>latent</span>   <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/V.html'>V</a></span><span class='op'>(</span><span class='va'>graph</span><span class='op'>)</span><span class='op'>$</span><span class='va'>nvals</span>    <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/E.html'>E</a></span><span class='op'>(</span><span class='va'>graph</span><span class='op'>)</span><span class='op'>$</span><span class='va'>rlconnect</span>     <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/E.html'>E</a></span><span class='op'>(</span><span class='va'>graph</span><span class='op'>)</span><span class='op'>$</span><span class='va'>edge.monotone</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>riskdiff</span> <span class='op'>&lt;-</span> <span class='st'>"p{Y(X = 1) = 1} - p{Y(X = 0) = 1}"</span></span>
<span><span class='va'>obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/analyze_graph.html'>analyze_graph</a></span><span class='op'>(</span><span class='va'>graph</span>, constraints <span class='op'>=</span> <span class='cn'>NULL</span>, effectt <span class='op'>=</span> <span class='va'>riskdiff</span><span class='op'>)</span></span>
<span><span class='va'>bounds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/optimize_effect_2.html'>optimize_effect_2</a></span><span class='op'>(</span><span class='va'>obj</span><span class='op'>)</span></span>
<span><span class='va'>bounds</span></span></code></pre>
</div>
<pre><code>lower bound =  
MAX {
  p00_0 - p00_1 - p10_1 - p01_1,
  p00_0 - p00_1 - p10_0 - p10_1 - p01_0,
  p00_0 - p00_1 + p10_0 - 2p10_1 - 2p01_1,
  -p10_1 - p01_1,
  -p10_0 - p01_0,
  -p00_0 + p00_1 - 2p10_0 + p10_1 - 2p01_0,
  -p00_0 + p00_1 - p10_0 - p10_1 - p01_1,
  -p00_0 + p00_1 - p10_0 - p01_0
}
----------------------------------------
upper bound =  
MIN {
  1 - p10_1 - p01_0,
  1 + p00_0 + p10_0 - 2p10_1 - p01_1,
  2 - p00_1 - p10_0 - p10_1 - 2p01_0,
  1 - p10_1 - p01_1,
  1 - p10_0 - p01_0,
  1 + p00_1 - 2p10_0 + p10_1 - p01_0,
  2 - p00_0 - p10_0 - p10_1 - 2p01_1,
  1 - p10_0 - p01_1
}</code></pre>
</div>
<p>The resulting <code>bounds</code> object contains character strings representing the bounds and logs containing detailed information from the vertex enumeration algorithm. The bounds are printed to the console but more features are available to facilitate their use. The <code>interpret_bounds</code> function takes the bounds and parameter names as input and returns an <code>R</code> function implementing vectorized forms of the symbolic expressions for the bounds.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>bounds_function</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/interpret_bounds.html'>interpret_bounds</a></span><span class='op'>(</span><span class='va'>bounds</span><span class='op'>$</span><span class='va'>bounds</span>, <span class='va'>obj</span><span class='op'>$</span><span class='va'>parameters</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>bounds_function</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>function (p00_0 = NULL, p00_1 = NULL, p10_0 = NULL, p10_1 = NULL, 
    p01_0 = NULL, p01_1 = NULL, p11_0 = NULL, p11_1 = NULL)  </code></pre>
</div>
<p>The results can also be used for numerical simulation using <code>simulate_bounds</code>. This function randomly generates counterfactuals and probability distributions that satisfy the constraints implied by the DAG and optional constraints. It then computes and returns the bounds as well as the true causal effect.</p>
<p>If one wants to bound a different effect using the same causal graph, the <code>update_effect</code> function can be used to save some computation time. It takes the object returned by <code>analyze_graph</code> and the new effect string and returns an object of class <code>linearcausalproblem</code> that can be optimized:<br />
<code>obj2 &lt;- update_effect(obj, "p{Y(X = 1) = 1}")</code>.</p>
<p>Finally, LaTeX-code may also be generated using the function <code>latex_bounds</code> as in<br />
<code>latex_bounds(bounds$bounds, obj$parameters)</code> yielding
<span class="math display">\[\begin{align*}
\mbox{Lower bound} &amp;= \mbox{max} \left. \begin{cases}   P(X = 0, Y = 0 | Z = 0) - P(X = 0, Y = 0 | Z = 1) - P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 1),\\
   P(X = 0, Y = 0 | Z = 0) - P(X = 0, Y = 0 | Z = 1) - P(X = 1, Y = 0 | Z = 0) - P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 0),\\
   P(X = 0, Y = 0 | Z = 0) - P(X = 0, Y = 0 | Z = 1) + P(X = 1, Y = 0 | Z = 0) - 2P(X = 1, Y = 0 | Z = 1) - 2P(X = 0, Y = 1 | Z = 1),\\
   -P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 1),\\
   -P(X = 1, Y = 0 | Z = 0) - P(X = 0, Y = 1 | Z = 0),\\
   -P(X = 0, Y = 0 | Z = 0) + P(X = 0, Y = 0 | Z = 1) - 2P(X = 1, Y = 0 | Z = 0) + P(X = 1, Y = 0 | Z = 1) - 2P(X = 0, Y = 1 | Z = 0),\\
   -P(X = 0, Y = 0 | Z = 0) + P(X = 0, Y = 0 | Z = 1) - P(X = 1, Y = 0 | Z = 0) - P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 1),\\
   -P(X = 0, Y = 0 | Z = 0) + P(X = 0, Y = 0 | Z = 1) - P(X = 1, Y = 0 | Z = 0) - P(X = 0, Y = 1 | Z = 0) \end{cases} \right\} \\
\mbox{Upper bound} &amp;= \mbox{min} \left. \begin{cases}   1 - P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 0),\\
   1 + P(X = 0, Y = 0 | Z = 0) + P(X = 1, Y = 0 | Z = 0) - 2P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 1),\\
   2 - P(X = 0, Y = 0 | Z = 1) - P(X = 1, Y = 0 | Z = 0) - P(X = 1, Y = 0 | Z = 1) - 2P(X = 0, Y = 1 | Z = 0),\\
   1 - P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 1),\\
   1 - P(X = 1, Y = 0 | Z = 0) - P(X = 0, Y = 1 | Z = 0),\\
   1 + P(X = 0, Y = 0 | Z = 1) - 2P(X = 1, Y = 0 | Z = 0) + P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 0),\\
   2 - P(X = 0, Y = 0 | Z = 0) - P(X = 1, Y = 0 | Z = 0) - P(X = 1, Y = 0 | Z = 1) - 2P(X = 0, Y = 1 | Z = 1),\\
   1 - P(X = 1, Y = 0 | Z = 0) - P(X = 0, Y = 1 | Z = 1) \end{cases} \right\}.
\end{align*}\]</span>
</p>
<h2 data-number="4" id="implementation-and-program-overview"><span class="header-section-number">4</span> Implementation and program overview</h2>
<p>An overview of the main functions and their relations is depicted as a flow chart in Figure <a href="#fig:Overview">6</a>. All functions may be called individually by the user in the <code>R</code>-console and all input, output and interaction available through the <a href="https://cran.r-project.org/package=shiny">shiny</a> app is available through the <code>R</code>-console as well.</p>
<p><span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span> define the following class of problems for which the query in general is not identifiable, but for which a methodology to derive symbolic tight bounds on the query is provided.
The causal DAG consists of a finite set <span class="math inline">\(\mathcal{W}=\{W_1,\dots,W_n\}=\mathcal{W}_\mathcal{L}\cup\mathcal{W}_\mathcal{R}\)</span> of categorical variables with <span class="math inline">\(\mathcal{W}_\mathcal{L}\cap\mathcal{W}_\mathcal{R}=\varnothing\)</span>, no edges going from <span class="math inline">\(\mathcal{W}_\mathcal{R}\)</span> to <span class="math inline">\(\mathcal{W}_\mathcal{L}\)</span> and no external common parent between <span class="math inline">\(\mathcal{W}_\mathcal{L}\)</span> and <span class="math inline">\(\mathcal{W}_\mathcal{R}\)</span>, but <em>importantly</em> external common parents <span class="math inline">\(\mathcal{U}_\mathcal{L}\)</span> and <span class="math inline">\(\mathcal{U}_\mathcal{R}\)</span> of variables within <span class="math inline">\(\mathcal{W}_\mathcal{R}\)</span> and <span class="math inline">\(\mathcal{W}_\mathcal{R}\)</span> may not be ruled out. Nothing is assumed about any characteristics of these confounding variables <span class="math inline">\(\mathcal{U}_\mathcal{L}\)</span> and <span class="math inline">\(\mathcal{U}_\mathcal{R}\)</span>.</p>
<p>The causal query may in principle be any linear combination (although <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> version 0.9.8 implements contrasts with unit coefficients only) of joint probabilities of factual and counterfactual outcomes expressed in terms of the variables in <span class="math inline">\(\mathcal{W}\)</span> and may always be expressed as a sum of probabilities of response function variables of the DAG. It is subject to the restriction that each outcome variable is in <span class="math inline">\(\mathcal{W}_\mathcal{R}\)</span> and if <span class="math inline">\(\mathcal{W}_\mathcal{L}\ne\varnothing\)</span> it is also subject to a few regularity conditions as detailed in <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span>. Tight bounds on the query may then be derived symbolically in terms of conditional probabilities of the observable variables <span class="math inline">\(\mathcal{W}\)</span>.</p>
<p>Algorithms 1 and 2 in <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span> construct the constraint space and causal query in terms of the joint probabilities of the response function variables and in <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> are implemented in the functions <code>create_R_matrix</code> and <code>create_effect_vector</code> respectively. Both are called as sub-procedures of the function <code>analyze_graph</code> to translate the causal problem to that of optimizing an objective function over a constraint space. The implementation of Algorithm 1 involves constructing the response functions themselves as actual <code>R</code>-functions. Evaluating these correspond to evaluating the structural equations of the causal DAG.</p>
<p>The conditions on the DAG suffice to ensure that the causal query will depend only on the response functions corresponding to the variables in <span class="math inline">\(\mathcal{W}_\mathcal{R}\)</span> and that the exhaustive set of constraints on their probabilities are linear in a subset of conditional probabilities of observable variables (Proposition 2 in <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span>), and the conditions on the query in turn ensure that it may be expressed as a linear combination of joint probabilities of the response functions of the variables in <span class="math inline">\(\mathcal{W}_\mathcal{R}\)</span> (Proposition 3 in <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span>).
Once this formulation of the causal problem as a linear program has been set up, a vertex enumeration method is employed to compute the extrema symbolically in terms of conditional probabilities of the observable variables.</p>
<p>The main and interesting functions will be described in some detail below. We begin however with an overview of how they are tied together by the <a href="https://cran.r-project.org/package=shiny">shiny</a> app.</p>

<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:Overview"></span>
<img src="figures/causaloptimDiagramTall.drawio.png" alt="A function overview flow chart, listing user input, program output and overall structure. The function specify_graph launches the GUI. Undirected edges correspond to function calls and arrow heads to direct input. Objects are color coded according to their sources of information, with red corresponding to the DAG, blue to the query and purple to a mixture of them, as in the optimization problem of class linearcausalproblem. Finally, green corresponds to the subsequent optimization process producing the bounds of class balkebound." width="100%" />
<p class="caption">
Figure 6: A function overview flow chart, listing user input, program output and overall structure. The function <code>specify_graph</code> launches the GUI. Undirected edges correspond to function calls and arrow heads to direct input. Objects are color coded according to their sources of information, with <span style="color: #CC0000;">red</span> corresponding to the <span style="color: #CC0000;">DAG</span>, <span style="color: #0000FF;">blue</span> to the <span style="color: #0000FF;">query</span> and <span style="color: #6600CC;">purple</span> to a mixture of them, as in the optimization <span style="color: #6600CC;">problem</span> of class <code>linearcausalproblem</code>. Finally, <span style="color: #009900;">green</span> corresponds to the subsequent optimization process producing the <span style="color: #009900;">bounds</span> of class <code>balkebound</code>.
</p>
</div>
</div>
<h4 class="unnumbered" data-number="4.0.1" id="specify_graph"><code>specify_graph</code></h4>
<p>The graphical interface is launched by <code>specify_graph()</code>, or preferably<br />
<code>results &lt;- specify_graph()</code>. Once the <a href="https://cran.r-project.org/package=shiny">shiny</a> app is stopped, the input, output and other useful information is returned by the function, so we recommend assigning it to a variable so they are saved in the <code>R</code>-session and may easily be further analyzed and processed. All further function calls will take place automatically as the user interacts with the web interface. Thus, from a basic user perspective, <code>specify_graph</code> is the main function. The core functionality however is implemented in the functions <code>analyze_graph</code>, <code>optimize_effect_2</code> and their subroutines.</p>
<p>The <code>JavaScript</code> that handles the communication between the <a href="https://cran.r-project.org/package=shiny">shiny</a> server and the input as the user draws a DAG through the web interface uses on the project<br />
<code>directed-graph-creator</code>, an interactive tool for creating directed graphs, created using <code>d3.js</code> and hosted at <a href="https://github.com/cjrd/directed-graph-creator" class="uri">https://github.com/cjrd/directed-graph-creator</a>, which has been modified for the purpose of causal diagrams. The modification binds the user inputs as they interact with the graph to <a href="https://cran.r-project.org/package=shiny">shiny</a> so that the directed graph and its attributes set by the user are reactively converted into an <code>igraph</code>-object for further processing. Since directed graphs are common in many computational and statistical problems, this <a href="https://cran.r-project.org/package=shiny">shiny</a> interface may also be valuable to many other <code>R</code>-package authors and maintainers who may wish to provide their users with an accessible and intuitive way to interact with their software.</p>
<p>The server listens to a reactive function that, as the user draws the DAG, collects information about the current edges, collects and annotates vertices, adds left- and right-side confounding, and returns an annotated <code>igraph</code>-object, comprising information about the connectivity along with some additional attributes; for each variable, its name, cardinality, latency-indicator and side-indicator, and for each edge, a monotonicity-indicator and (to detect and communicate violations on direction) a right-to-left-indicator. The server meanwhile also monitors the DAG for any violation of the restriction that each edge between <span class="math inline">\(\mathcal{L}\)</span> and <span class="math inline">\(\mathcal{R}\)</span> must go <em>from</em> <span class="math inline">\(\mathcal{L}\)</span> <em>to</em> <span class="math inline">\(\mathcal{R}\)</span>, and if detected directly communicates this to the user through a text message in the <a href="https://cran.r-project.org/package=shiny">shiny</a> app. The app makes use <a href="https://cran.r-project.org/package=shiny">shiny</a> modules which makes testing the interface easier, and <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> includes many automated tests to make sure that the GUI functionality works as intended.</p>
<h4 class="unnumbered" data-number="4.0.2" id="analyze_graph"><code>analyze_graph</code></h4>
<p>The function <code>analyze_graph</code> takes a DAG (in the form of an <code>igraph</code> object), optional constraints, and a string representing the causal effect of interest and proceeds to construct and return a linear optimization problem (a <code>linearcausalproblem</code>-object) from these inputs.</p>
<p>First, some basic data structures are created to keep track of the observed variables, their possible values, the latent variables, and whether they are in <span class="math inline">\(\mathcal{L}\)</span> or <span class="math inline">\(\mathcal{R}\)</span>. Once these basic data-structures have been created, the first task of the algorithm is to create the response function variables (for each variable, observed or not, except <span class="math inline">\(U_\mathcal{L}\)</span> and <span class="math inline">\(U_\mathcal{R}\)</span>). Probabilities of these will be the entities <span class="math inline">\(\mathbf{q}\)</span> in which the objective function (representing the target causal effect) is expressed and will constitute the points in the space it is optimized over, where this space itself is constrained by the the relationships between them and observed conditional probabilities <span class="math inline">\(\mathbf{p}\)</span>.</p>
<h4 class="unnumbered" data-number="4.0.3" id="create_response_function"><code>create_response_function</code></h4>
<p>The function <code>create_response_function</code> returns a list <code>respvars</code> that has a named entry for each observed variable, containing its response function variable and response function. If <span class="math inline">\(X\)</span> is an observed variable with <span class="math inline">\(n\)</span> response functions, then they are enumerated by <span class="math inline">\(\{0,\dots,n-1\}\)</span>. Its entry <code>respvars$X</code> contains the response function variable <span class="math inline">\(R_X\)</span> of <span class="math inline">\(X\)</span>, and is a list with two entries. The first, <code>respvars$X$index</code>, is a vector containing all the possible values of <span class="math inline">\(R_X\)</span>, i.e., the integers <span class="math inline">\((0,\dots,n-1)\)</span>. The second, <code>respvars$X$values</code> is itself a list with <span class="math inline">\(n\)</span> entries; each containing the particular response function of <span class="math inline">\(X\)</span> corresponding to its index. Each such response function is an actual <code>R</code>-function and may be evaluated by passing it any possible values of the parents of <span class="math inline">\(X\)</span> as arguments.</p>
<p>Next, the response function variables are used in the creation of a matrix of unobserved probabilities. Specifically the joint probabilities <span class="math inline">\(P(\mathbf{R}_\mathcal{R}=\mathbf{r}_\mathcal{R})\)</span> for each possible value-combination <span class="math inline">\(\mathbf{r}_\mathcal{R}\)</span> of the response function variables <span class="math inline">\(\mathbf{R}_\mathcal{R}\)</span> of the right-side-variables <span class="math inline">\(\mathbf{W}_\mathcal{R}\)</span>. In <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span>, the possible value-combinations <span class="math inline">\(\mathbf{r}_\mathcal{R}\)</span> are enumerated by <span class="math inline">\(\gamma\in\{1,\dots,\aleph_\mathcal{R}\}\)</span> with corresponding probabilities <span class="math inline">\(q_\gamma:=P(\mathbf{R}_\mathcal{R}=\mathbf{r}_\gamma)\)</span> being components of the vector <span class="math inline">\(\mathbf{q}\in[0,1]^{\aleph_\mathcal{R}}\)</span>.</p>
<h4 class="unnumbered" data-number="4.0.4" id="create_r_matrix"><code>create_R_matrix</code></h4>
<p>The constraints that the DAG and observed conditional probabilities <span class="math inline">\(\mathbf{p}\)</span> (in <code>p.vals</code>) impose on the unobserved probabilities <span class="math inline">\(\mathbf{q}\)</span> (represented by <code>variables</code>) are linear.
Specifically, there exists a matrix whose entries are the coefficients relating <code>p.vals</code> to <code>variables</code>. This matrix is called <span class="math inline">\(P\)</span> in <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span>, where its existence is guaranteed by Proposition 2 and its construction is detailed in Algorithm 1, which is implemented in the function <code>create_R_matrix</code>. This function returns back a list with two entries; a vector of strings representing the linear constraints on the unobserved <span class="math inline">\(\mathbf{q}\in[0,1]^{\aleph_\mathcal{R}}\)</span> imposed by and in terms of the observed <span class="math inline">\(\mathbf{p}\in[0,1]^B\)</span> and the numeric matrix <span class="math inline">\(R\in\{0,1\}^{(B+1)\times\aleph_\mathcal{R}}\)</span> of coefficients corresponding to these constraints as well as the probabilistic ones and given by <span class="math inline">\(R=\begin{pmatrix}\mathbf{1}\\P\end{pmatrix}\)</span> where <span class="math inline">\(P\in\{0,1\}^{B\times\aleph_\mathcal{R}}:\mathbf{p}=P\mathbf{q}\)</span>, so <span class="math inline">\(R\mathbf{q}=\begin{pmatrix}1\\\mathbf{p}\end{pmatrix}\)</span>.</p>
<p>This determines the constraint space as a compact convex polytope in <span class="math inline">\(\mathbf{q}\)</span>-space, i.e., in <span class="math inline">\(\mathbb{R}^{\aleph_\mathcal{R}}\)</span>. To create the matrix, we define a recursive function <code>gee_r</code> that takes two arguments; a positive integer <code>i</code> being the index <span class="math inline">\(i\in\{1,\dots,n\}\)</span> of a variable <span class="math inline">\(W_i\in\mathcal{W}\)</span> (i.e. the <span class="math inline">\(i^{th}\)</span> component of <span class="math inline">\(\mathbf{W}\)</span> or, equivalently, the <code>i</code>th entry of <code>obsvars</code>) and a vector <code>r</code> being a value <span class="math inline">\(\mathbf{r}\in\nu(\mathbf{R})\)</span> in the set <span class="math inline">\(\nu(\mathbf{R})\)</span> of all possible value-vectors of the joint response function variable <span class="math inline">\(\mathbf{R}\)</span>.
This recursive function is called for each variable in <code>obsvars</code> and for each possible value of the response function variable vector.
The base case is reached if the variable has no parents, in which case the list corresponding to the response function variable <span class="math inline">\(R_{W_i}\)</span> of <span class="math inline">\(W_i\)</span> is extracted from <code>respvars</code>. From this list, the entry whose index matches the <code>i</code>th index of <code>r</code> (i.e. the one corresponding to the response function variable value <span class="math inline">\(r_i=\)</span><code>r[i]</code>) is extracted and finally its value, i.e., the corresponding response function itself, is extracted and is evaluated on an empty list of arguments, since it is a constant function and determined only by the value <span class="math inline">\(r_i\)</span>.</p>
<p>The recursive case is encountered when <code>parents</code> is non-empty. If so, then for each parent in <code>parents</code>, its index in <code>obsvars</code> is determined and <code>gee_r</code> is recursively called with the same vector <code>r</code> as first argument but now with this particular index (i.e. that of the current parent) as second argument. The numeric values returned by these recursive calls are then sequentially stored in a vector <code>lookin</code>, whose entries are named by those in <code>parents</code>. Just as in the base case, the response function corresponding to the particular value <span class="math inline">\(r_i\)</span> of the response function variable <span class="math inline">\(R_{W_i}\)</span> (i.e. the response function of the variable <code>obsvars[i]</code> that has the index <code>r[i]</code>) is extracted from <code>respvars</code> and is now evaluated with arguments given by the list <code>lookin</code>.
Note that <code>gee_r(r, i)</code> corresponds to the value <span class="math inline">\(w_i=g^*_{W_i}(\mathbf{r})\)</span> in <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span>.</p>
<p>Then the values that match the observed probabilities are recorded, the corresponding entries in the current row of the matrix <code>R</code> are set to 1 and a string representing the corresponding equation is constructed and added to the vector of constraints.</p>
<h4 class="unnumbered" data-number="4.0.5" id="parse_effect"><code>parse_effect</code></h4>
<p>Now that the constraint space has been determined, the objective function representing the causal query needs to be specified as a linear function of the components of <span class="math inline">\(\mathbf{q}\)</span>, i.e., <code>variables</code>. First, the causal query that has been provided by the user as a text-string in <code>effectt</code> is passed to the function <code>parse_effect</code>, which identifies its components including nested counterfactuals and creates a data structure representing the causal query. This structure includes nested lists which represent all interventional paths to each outcome variable in the query.</p>
<p>Once the nested list <code>effect</code> is returned back to <code>analyze_graph</code>, it checks that the requirements (see Proposition 3 in <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span>) on the query are fulfilled before creating the linear objective function. Despite these regularity conditions, a large set of possible queries may be entered using standard counterfactual notation, using syntax described in the accompanying instruction text along with examples such as <span class="math inline">\(P(Y(M(X = 0), X = 1) = 1) - P(Y(M(X = 0), X = 0) = 1)\)</span>; the natural direct effect <span class="citation" data-cites="pearl2001direct">(<a href="#ref-pearl2001direct" role="doc-biblioref">Pearl 2001</a>)</span> of a binary exposure <span class="math inline">\(X\)</span> at level <span class="math inline">\(M=0\)</span> on a binary outcome <span class="math inline">\(Y\)</span> <em>not</em> going through the mediator <span class="math inline">\(M\)</span>, in the presence of unmeasured confounding between <span class="math inline">\(M\)</span> and <span class="math inline">\(Y\)</span> <span class="citation" data-cites="sjolander2009bounds">(<a href="#ref-sjolander2009bounds" role="doc-biblioref">Sjölander 2009a</a>)</span>.</p>
<h4 class="unnumbered" data-number="4.0.6" id="create_effect_vector"><code>create_effect_vector</code></h4>
<p>Now that the required characteristics of the query have been established, the corresponding objective function will be constructed by the function <code>create_effect_vector</code> which returns a list <code>var.eff</code> of string-vectors; one for each term in the query. Each such vector contains the names (strings in <code>variables</code>) of the response function variables of the right-side (i.e. the components of <span class="math inline">\(\mathbf{q}\)</span>) whose sum corresponds the that particular term.
The function <code>create_effect_vector</code> implements Algorithm 2 of <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span> with the additional feature that
if the user has entered a query that is incomplete in the sense that there are omitted mediating variables on paths from base/intervention variables to the outcome variable, then this is interpreted as the user intending the effects of the base/intervention variables to be propagated through the mediators, so that they are set to their “natural” values under this intervention. These mediators are detected and their values are set accordingly.</p>
<p>We define a recursive function <code>gee_rA</code> that takes three arguments; a positive integer <code>i</code> (the index <span class="math inline">\(i\)</span> of a variable <span class="math inline">\(W_i\in\mathcal{W}=\)</span><code>obsvars</code>), a vector <code>r</code> (a value <span class="math inline">\(\mathbf{r}\in\nu(\mathbf{R})\)</span> in the set <span class="math inline">\(\nu(\mathbf{R})\)</span> of all possible value-vectors of the joint response function variable <span class="math inline">\(\mathbf{R}\)</span>) and a string <code>path</code> that represents an interventional path and is of the form “X -&gt; … -&gt; Y” if not <code>NULL</code>. The base case is reached either if <code>path</code> is non-<code>NULL</code> and corresponds to a path to the intervention set or if <code>parents</code> is empty.
In the former case, the corresponding numeric intervention-value is returned, and in the latter case, the value of the corresponding response function called on the empty list of arguments is returned just as in the base case of <code>gee_r</code>.
The recursive case is encountered when <code>path</code> is <code>NULL</code> and <code>parents</code> is non-empty.
This recursion proceeds just as in <code>gee_r</code>, but now rather with a recursive call to <code>gee_rA</code>, whose third argument is now <code>path = paste(gu, "-&gt;", path)</code> where the string in <code>gu</code> is the name of the parent variable in <code>parents</code> whose index <code>i</code> in <code>obsvars</code> is the second argument of this recursive call. This construction traces the full path taken from the outcome of interest to the variable being intervened upon. Note that <code>gee_rA(r, i, path)</code> corresponds to the value <span class="math inline">\(w_i=h^{A_i}_{W_i}(\mathbf{r},W_i)\)</span> in <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span>.
A matrix is now created just as in the observational case, but this time using <code>gee_rA</code> instead of <code>gee_r</code> .</p>
<h4 class="unnumbered" data-number="4.0.7" id="optimize_effect_2"><code>optimize_effect_2</code></h4>
<p>Once the constraints on <span class="math inline">\(\mathbf{q}\)</span> as well as the effect of interest in terms of <span class="math inline">\(\mathbf{q}\)</span> have been established, it remains only to optimize this expression over the constraint space. Here, <span class="math inline">\(\mathbf{c}\)</span> denotes the constant gradient vector of the linear objective function and <span class="math inline">\(P\)</span> denotes the coefficient matrix of the linear restrictions on <span class="math inline">\(\mathbf{q}\)</span> in terms of <span class="math inline">\(\mathbf{p}\)</span> imposed by the causal DAG. By adding the probabilistic constraints on <span class="math inline">\(\mathbf{q}\)</span> we have arrived at e.g. the following linear program giving a tight lower bound on the average causal effect <span class="math inline">\(\theta_\mathbf{q} = P\{Y(X = 1) = 1\} - P\{Y(X = 0) = 1\}\)</span> in the simple instrumental variable problem of the introductory section:</p>
<p><span class="math display">\[\begin{align*}
\min_\mathbf{q} \theta_\mathbf{q}
&amp;=\min\{\mathbf{c}^\top\mathbf{q}\mid \mathbf{q}\in\mathbb{R}^{16},\mathbf{q}\geq\mathbf{0}_{16\times1},\mathbf{1}_{1\times 16} \mathbf{q}=1,P\mathbf{q}=\mathbf{q}\}\\
&amp;=\max\{\begin{pmatrix}1&amp;\mathbf{q}^\top\end{pmatrix}\mathbf{y}\mid\mathbf{y}\in\mathbb{R}^{9},\mathbf{y}\geq \mathbf{0}_{9\times 1},\begin{pmatrix}\mathbf{1}_{16\times 1}&amp;P^\top\end{pmatrix}\leq\mathbf{c}\}\\
&amp;=\max\{\begin{pmatrix}1&amp;\mathbf{q}^\top\end{pmatrix}\bar{\mathbf{y}}\mid\bar{\mathbf{y}}\text{ is a vertex of }\{\mathbf{y}\in\mathbb{R}^{9}\mid \mathbf{y}\geq\mathbf{0}_{9\times 1},R^\top\leq\mathbf{c}\}\}
\end{align*}\]</span></p>
<p>Since we allow the user to provide additional linear inequality constraints (e.g. it may be quite reasonable to assume the proportion of “defiers” in the study population of our example to be quite low), the actual primal and dual linear programs may look slightly more complicated, but this small example still captures the essentials.<br />
In general, given the matrix of linear constraints on the observable probabilities implied by the DAG and an optional user-provided matrix inequality, we construct the coefficient matrix and right hand side vector of the dual polytope.</p>
<p>The optimization via vertex enumeration step in <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> is implemented in the function <code>optimize_effect_2</code> which uses the double description method for vertex enumeration, as implemented in the <a href="https://cran.r-project.org/package=rcdd">rcdd</a> package <span class="citation" data-cites="rcdd">(<a href="#ref-rcdd" role="doc-biblioref">Geyer et al. 2021</a>)</span>. This step of vertex enumeration has previously been the major computational bottleneck. The approach is now based on <code>cddlib</code> (<a href="https://people.inf.ethz.ch/fukudak/cdd_home/" class="uri">https://people.inf.ethz.ch/fukudak/cdd_home/</a>), which has an implementation of the Double Description Method (dd).
Any convex polytope can be dually described as either an intersection of half-planes (which is the form we get our dual constraint space in) or as a minimal set of vertices of which it is the convex hull (which is the form we want it in) and the dd algorithm efficiently converts between these two descriptions. <code>cddlib</code> also uses exact rational arithmetic, so there is no need to worry about any numerical instability issues.
The vertices of the dual polytope are obtained and stored as rows of a matrix with <code>hrep &lt;- rcdd::makeH(a1, b1);</code> <code>vrep &lt;- rcdd::scdd(hrep);</code> <code>vertices &lt;- vrep$output[vrep$output[, 1] == 0 &amp; vrep$output[, 2] == 1, -c(1, 2), drop=FALSE]</code>.</p>
<p>The rest is simply a matter of plugging them into the dual objective function, evaluating the expression and presenting the results. The first part of this is done by <code>apply(vertices, 1, function(y) evaluate_objective(c1_num, p, y))</code> (here <code>(c1_num,p)</code><span class="math inline">\(=(\begin{pmatrix}b_{\ell}^\top&amp;1\end{pmatrix},p)\)</span> separates the dual objective gradient into its numeric and symbolic parts).</p>
<p><a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> also contains a precursor to to <code>optimize_effect_2</code>, called <code>optimize_effect</code>. This legacy function uses the original optimization procedure written in <code>C++</code> by Alexander Balke and involves linear program formulation followed by the vertex enumeration algorithm of <span class="citation" data-cites="mattheiss1973algorithm">Mattheiss (<a href="#ref-mattheiss1973algorithm" role="doc-biblioref">1973</a>)</span>. This has worked well for very simple settings but has been found to struggle on more complex problems and thus been insufficient for the ambitions of <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a>. The efficiency gains of <code>optimize_effect_2</code> over the legacy code have reduced the computation time for several setting from hours to milliseconds.</p>
<h2 data-number="5" id="numeric-examples"><span class="header-section-number">5</span> Numeric examples</h2>
<p>We illustrate with a couple of applications. Although the problem formulations are entered via the textual interface below, they may of course just as well be entered via the graphical interface prior to numeric evaluation. This is done by launching the GUI and assigning its results to a variable as in <code>results &lt;- specify_graph()</code>, following steps similar to the initial example in the section “Graphical User Interface” and clicking “Exit and return objects to R”, whereupon all information about the DAG, query and bounds are accessible via <code>results</code>. Regardless if drawn via the GUI or entered via code, the DAG may be subsequently visualized using the <code>plot</code> function.</p>
<h3 data-number="5.1" id="a-mediation-analysis"><span class="header-section-number">5.1</span> A Mediation Analysis</h3>
<p>In <span class="citation" data-cites="sjolandernaturaldirecteffects">Sjölander (<a href="#ref-sjolandernaturaldirecteffects" role="doc-biblioref">2009b</a>)</span>, the author derives bounds on natural direct effects in the presence of confounded intermediate variables and applies them to data from the Lipid Research Clinics Coronary Primary Prevention Trial <span class="citation" data-cites="freedmandata">(<a href="#ref-freedmandata" role="doc-biblioref">Freedman et al. 1992</a>)</span>, where subjects were randomized to cholestyramine treatment and presence of coronary heart disease events as well as levels of cholesterol were recorded after a 1-year follow-up period.
We let <span class="math inline">\(X\)</span> be a binary treatment indicator, with <span class="math inline">\(X=0\)</span> indicating actual cholestyramine treatment and <span class="math inline">\(X=1\)</span> indicating placebo. We further let <span class="math inline">\(Y\)</span> be an indicator of the occurrence of coronary heart disease events within follow-up, with <span class="math inline">\(Y=0\)</span> indicating event-free follow-up and <span class="math inline">\(Y=1\)</span> indicating an event. We finally let <span class="math inline">\(M\)</span> be a dichotomized (cut-off at <span class="math inline">\(280\ mg/dl\)</span>) cholesterol level indicator, with <span class="math inline">\(M=0\)</span> indicating levels <span class="math inline">\(&lt;280\ mg/dl\)</span> and <span class="math inline">\(M=1\)</span> indicating levels <span class="math inline">\(\ge280\ mg/dl\)</span>.
The causal assumptions are summarized in the DAG shown in Figure <a href="#fig:mediation-fig">7</a>, where <span class="math inline">\(U_r\)</span> is unmeasured and confounds the effect of <span class="math inline">\(M\)</span> on <span class="math inline">\(Y\)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mediation-fig"></span>
<img src="RJ-2023-083_files/figure-html5/mediation-fig-1.png" alt="A picture of the mediation DAG" width="100%" />
<p class="caption">
Figure 7: Causal DAG for mediation example
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'>igraph</span><span class='fu'>::</span><span class='fu'><a href='https://r.igraph.org/reference/graph_from_literal.html'>graph_from_literal</a></span><span class='op'>(</span><span class='va'>X</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>Y</span>, <span class='va'>X</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>M</span>, <span class='va'>M</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>Y</span>, </span>
<span>                                <span class='va'>Ur</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>Y</span>, <span class='va'>Ur</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>M</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/V.html'>V</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>$</span><span class='va'>leftside</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/V.html'>V</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>$</span><span class='va'>latent</span>   <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/V.html'>V</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>$</span><span class='va'>nvals</span>    <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/E.html'>E</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>$</span><span class='va'>rlconnect</span>     <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/E.html'>E</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>$</span><span class='va'>edge.monotone</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Note that although the unmeasured confounder <code>Ur</code> appears to be designated as binary in this code, this is <em>not</em> assumed in the the computations, where nothing is assumed about its distribution.</p>
<p>Using the data from Table IV of <span class="citation" data-cites="sjolandernaturaldirecteffects">Sjölander (<a href="#ref-sjolandernaturaldirecteffects" role="doc-biblioref">2009b</a>)</span>, we compute the observed conditional probabilities.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># parameters of the form pab_c, which represents </span></span>
<span><span class='co'># the probability P(Y = a, M = b | X = c)</span></span>
<span><span class='va'>p00_0</span> <span class='op'>&lt;-</span> <span class='fl'>1426</span><span class='op'>/</span><span class='fl'>1888</span> <span class='co'># P(Y=0,M=0|X=0)</span></span>
<span><span class='va'>p10_0</span> <span class='op'>&lt;-</span> <span class='fl'>97</span><span class='op'>/</span><span class='fl'>1888</span> <span class='co'># P(Y=1,M=0|X=0)</span></span>
<span><span class='va'>p01_0</span> <span class='op'>&lt;-</span> <span class='fl'>332</span><span class='op'>/</span><span class='fl'>1888</span> <span class='co'># P(Y=0,M=1|X=0)</span></span>
<span><span class='va'>p11_0</span> <span class='op'>&lt;-</span> <span class='fl'>33</span><span class='op'>/</span><span class='fl'>1888</span> <span class='co'># P(Y=1,M=1|X=0)</span></span>
<span><span class='va'>p00_1</span> <span class='op'>&lt;-</span> <span class='fl'>1081</span><span class='op'>/</span><span class='fl'>1918</span> <span class='co'># P(Y=0,M=0|X=1)</span></span>
<span><span class='va'>p10_1</span> <span class='op'>&lt;-</span> <span class='fl'>86</span><span class='op'>/</span><span class='fl'>1918</span> <span class='co'># P(Y=1,M=0|X=1)</span></span>
<span><span class='va'>p01_1</span> <span class='op'>&lt;-</span> <span class='fl'>669</span><span class='op'>/</span><span class='fl'>1918</span> <span class='co'># P(Y=0,M=1|X=1)</span></span>
<span><span class='va'>p11_1</span> <span class='op'>&lt;-</span> <span class='fl'>82</span><span class='op'>/</span><span class='fl'>1918</span> <span class='co'># P(Y=1,M=1|X=1)</span></span></code></pre>
</div>
</div>
<p>We proceed to compute bounds on the controlled direct effect <span class="math inline">\(CDE(0) = P(Y(M = 0, X = 1) = 1) - P(Y(M = 0, X = 0) = 1)\)</span> of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> not passing through <span class="math inline">\(M\)</span> at level <span class="math inline">\(M=0\)</span>, the controlled direct effect <span class="math inline">\(CDE(1) = P(Y(M = 1, X = 1) = 1) - P(Y(M = 1, X = 0) = 1)\)</span> at level <span class="math inline">\(M=1\)</span>, the natural direct effect <span class="math inline">\(NDE(0) = P(Y(M(X = 0), X = 1) = 1) - P(Y(M(X = 0), X = 0) = 1)\)</span> of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> at level <span class="math inline">\(X=0\)</span> and the natural direct effect <span class="math inline">\(NDE(1) = P(Y(M(X = 1), X = 1) = 1) - P(Y(M(X = 1), X = 0) = 1)\)</span> at level <span class="math inline">\(X=1\)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>CDE0_query</span> <span class='op'>&lt;-</span> <span class='st'>"p{Y(M = 0, X = 1) = 1} - p{Y(M = 0, X = 0) = 1}"</span></span>
<span><span class='va'>CDE0_obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/analyze_graph.html'>analyze_graph</a></span><span class='op'>(</span><span class='va'>b</span>, constraints <span class='op'>=</span> <span class='cn'>NULL</span>, effectt <span class='op'>=</span> <span class='va'>CDE0_query</span><span class='op'>)</span></span>
<span><span class='va'>CDE0_bounds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/optimize_effect_2.html'>optimize_effect_2</a></span><span class='op'>(</span><span class='va'>CDE0_obj</span><span class='op'>)</span></span>
<span><span class='va'>CDE0_boundsfunction</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/interpret_bounds.html'>interpret_bounds</a></span><span class='op'>(</span>bounds <span class='op'>=</span> <span class='va'>CDE0_bounds</span><span class='op'>$</span><span class='va'>bounds</span>, </span>
<span>                                        parameters <span class='op'>=</span> <span class='va'>CDE0_obj</span><span class='op'>$</span><span class='va'>parameters</span><span class='op'>)</span></span>
<span><span class='va'>CDE0_numericbounds</span> <span class='op'>&lt;-</span> <span class='fu'>CDE0_boundsfunction</span><span class='op'>(</span>p00_0 <span class='op'>=</span> <span class='va'>p00_0</span>, p00_1 <span class='op'>=</span> <span class='va'>p00_1</span>, </span>
<span>                                          p10_0 <span class='op'>=</span> <span class='va'>p10_0</span>, p10_1 <span class='op'>=</span> <span class='va'>p10_1</span>, </span>
<span>                                          p01_0 <span class='op'>=</span> <span class='va'>p01_0</span>, p01_1 <span class='op'>=</span> <span class='va'>p01_1</span>, </span>
<span>                                          p11_0 <span class='op'>=</span> <span class='va'>p11_0</span>, p11_1 <span class='op'>=</span> <span class='va'>p11_1</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>CDE1_query</span> <span class='op'>&lt;-</span> <span class='st'>"p{Y(M = 1, X = 1) = 1} - p{Y(M = 1, X = 0) = 1}"</span></span>
<span><span class='va'>CDE1_obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/update_effect.html'>update_effect</a></span><span class='op'>(</span><span class='va'>CDE0_obj</span>, effectt <span class='op'>=</span> <span class='va'>CDE1_query</span><span class='op'>)</span></span>
<span><span class='va'>CDE1_bounds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/optimize_effect_2.html'>optimize_effect_2</a></span><span class='op'>(</span><span class='va'>CDE1_obj</span><span class='op'>)</span></span>
<span><span class='va'>CDE1_boundsfunction</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/interpret_bounds.html'>interpret_bounds</a></span><span class='op'>(</span>bounds <span class='op'>=</span> <span class='va'>CDE1_bounds</span><span class='op'>$</span><span class='va'>bounds</span>, </span>
<span>                                        parameters <span class='op'>=</span> <span class='va'>CDE1_obj</span><span class='op'>$</span><span class='va'>parameters</span><span class='op'>)</span></span>
<span><span class='va'>CDE1_numericbounds</span> <span class='op'>&lt;-</span> <span class='fu'>CDE1_boundsfunction</span><span class='op'>(</span>p00_0 <span class='op'>=</span> <span class='va'>p00_0</span>, p00_1 <span class='op'>=</span> <span class='va'>p00_1</span>, </span>
<span>                                          p10_0 <span class='op'>=</span> <span class='va'>p10_0</span>, p10_1 <span class='op'>=</span> <span class='va'>p10_1</span>, </span>
<span>                                          p01_0 <span class='op'>=</span> <span class='va'>p01_0</span>, p01_1 <span class='op'>=</span> <span class='va'>p01_1</span>, </span>
<span>                                          p11_0 <span class='op'>=</span> <span class='va'>p11_0</span>, p11_1 <span class='op'>=</span> <span class='va'>p11_1</span><span class='op'>)</span></span>
<span><span class='va'>NDE0_query</span> <span class='op'>&lt;-</span> <span class='st'>"p{Y(M(X = 0), X = 1) = 1} - p{Y(M(X = 0), X = 0) = 1}"</span></span>
<span><span class='va'>NDE0_obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/update_effect.html'>update_effect</a></span><span class='op'>(</span><span class='va'>CDE0_obj</span>, effectt <span class='op'>=</span> <span class='va'>NDE0_query</span><span class='op'>)</span></span>
<span><span class='va'>NDE0_bounds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/optimize_effect_2.html'>optimize_effect_2</a></span><span class='op'>(</span><span class='va'>NDE0_obj</span><span class='op'>)</span></span>
<span><span class='va'>NDE0_boundsfunction</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/interpret_bounds.html'>interpret_bounds</a></span><span class='op'>(</span>bounds <span class='op'>=</span> <span class='va'>NDE0_bounds</span><span class='op'>$</span><span class='va'>bounds</span>, </span>
<span>                                        parameters <span class='op'>=</span> <span class='va'>NDE0_obj</span><span class='op'>$</span><span class='va'>parameters</span><span class='op'>)</span></span>
<span><span class='va'>NDE0_numericbounds</span> <span class='op'>&lt;-</span> <span class='fu'>NDE0_boundsfunction</span><span class='op'>(</span>p00_0 <span class='op'>=</span> <span class='va'>p00_0</span>, p00_1 <span class='op'>=</span> <span class='va'>p00_1</span>, </span>
<span>                                          p10_0 <span class='op'>=</span> <span class='va'>p10_0</span>, p10_1 <span class='op'>=</span> <span class='va'>p10_1</span>, </span>
<span>                                          p01_0 <span class='op'>=</span> <span class='va'>p01_0</span>, p01_1 <span class='op'>=</span> <span class='va'>p01_1</span>, </span>
<span>                                          p11_0 <span class='op'>=</span> <span class='va'>p11_0</span>, p11_1 <span class='op'>=</span> <span class='va'>p11_1</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>NDE1_query</span> <span class='op'>&lt;-</span> <span class='st'>"p{Y(M(X = 1), X = 1) = 1} - p{Y(M(X = 1), X = 0) = 1}"</span></span>
<span><span class='va'>NDE1_obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/update_effect.html'>update_effect</a></span><span class='op'>(</span><span class='va'>CDE0_obj</span>, effectt <span class='op'>=</span> <span class='va'>NDE1_query</span><span class='op'>)</span></span>
<span><span class='va'>NDE1_bounds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/optimize_effect_2.html'>optimize_effect_2</a></span><span class='op'>(</span><span class='va'>NDE1_obj</span><span class='op'>)</span></span>
<span><span class='va'>NDE1_boundsfunction</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/interpret_bounds.html'>interpret_bounds</a></span><span class='op'>(</span>bounds <span class='op'>=</span> <span class='va'>NDE1_bounds</span><span class='op'>$</span><span class='va'>bounds</span>, </span>
<span>                                        parameters <span class='op'>=</span> <span class='va'>NDE1_obj</span><span class='op'>$</span><span class='va'>parameters</span><span class='op'>)</span></span>
<span><span class='va'>NDE1_numericbounds</span> <span class='op'>&lt;-</span> <span class='fu'>NDE1_boundsfunction</span><span class='op'>(</span>p00_0 <span class='op'>=</span> <span class='va'>p00_0</span>, p00_1 <span class='op'>=</span> <span class='va'>p00_1</span>, </span>
<span>                                          p10_0 <span class='op'>=</span> <span class='va'>p10_0</span>, p10_1 <span class='op'>=</span> <span class='va'>p10_1</span>, </span>
<span>                                          p01_0 <span class='op'>=</span> <span class='va'>p01_0</span>, p01_1 <span class='op'>=</span> <span class='va'>p01_1</span>, </span>
<span>                                          p11_0 <span class='op'>=</span> <span class='va'>p11_0</span>, p11_1 <span class='op'>=</span> <span class='va'>p11_1</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We obtain the same symbolic bounds as <span class="citation" data-cites="sjolandernaturaldirecteffects">Sjölander (<a href="#ref-sjolandernaturaldirecteffects" role="doc-biblioref">2009b</a>)</span> and the resulting numeric bounds are given in Table <a href="#tab:mediation-bounds">1</a> which of course agree with those of Table V in <span class="citation" data-cites="sjolandernaturaldirecteffects">Sjölander (<a href="#ref-sjolandernaturaldirecteffects" role="doc-biblioref">2009b</a>)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<table>
<caption><span id="tab:mediation-bounds">Table 1: </span>Bounds on the controlled and natural direct effects.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">lower</th>
<th style="text-align: right;">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CDE(0)</td>
<td style="text-align: right;">-0.20</td>
<td style="text-align: right;">0.39</td>
</tr>
<tr class="even">
<td style="text-align: left;">CDE(1)</td>
<td style="text-align: right;">-0.78</td>
<td style="text-align: right;">0.63</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NDE(0)</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.56</td>
</tr>
<tr class="even">
<td style="text-align: left;">NDE(1)</td>
<td style="text-align: right;">-0.55</td>
<td style="text-align: right;">0.09</td>
</tr>
</tbody>
</table>
</div>
<h3 data-number="5.2" id="a-mendelian-randomization-study-of-the-effect-of-homocysteine-on-cardiovascular-disease"><span class="header-section-number">5.2</span> A Mendelian Randomization Study of the Effect of Homocysteine on Cardiovascular Disease</h3>
<p>Mendelian randomization <span class="citation" data-cites="mendelian">(<a href="#ref-mendelian" role="doc-biblioref">Davey Smith and Ebrahim 2003</a>)</span> assumes certain genotypes may serve as suitable instrumental variables for investigating the causal effect of an associated phenotype on some disease outcome.</p>
<p>In <span class="citation" data-cites="st0232">Sheehan (<a href="#ref-st0232" role="doc-biblioref">2011</a>)</span>, the authors investigate the effect of homocysteine on cardiovascular disease using the 677CT polymorphism (rs1801133) in the Methylenetetrahydrofolate Reductase gene as an instrument. They use observational data from <span class="citation" data-cites="meleady_thermolabile_2003">Meleady et al. (<a href="#ref-meleady_thermolabile_2003" role="doc-biblioref">2003</a>)</span> in which the outcome is binary, the treatment has been made binary by a suitably chosen cut-off at <span class="math inline">\(15\mu mol/L\)</span>, and the instrument is ternary (this polymorphism can take three possible genotype values).</p>
<p>With <span class="math inline">\(X\)</span> denoting the treatment, <span class="math inline">\(Y\)</span> the outcome and <span class="math inline">\(Z\)</span> the instrument, the DAG is the one in Figure <a href="#fig:iv-fig">2</a> (although now with a ternary instrument) and the conditional probabilities are given as follows.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>params</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>p00_0 <span class='op'>=</span> <span class='fl'>0.83</span>, p00_1 <span class='op'>=</span> <span class='fl'>0.88</span>, p00_2 <span class='op'>=</span> <span class='fl'>0.72</span>, </span>
<span>               p10_0 <span class='op'>=</span> <span class='fl'>0.11</span>, p10_1 <span class='op'>=</span> <span class='fl'>0.05</span>, p10_2 <span class='op'>=</span> <span class='fl'>0.20</span>, </span>
<span>               p01_0 <span class='op'>=</span> <span class='fl'>0.05</span>, p01_1 <span class='op'>=</span> <span class='fl'>0.06</span>, p01_2 <span class='op'>=</span> <span class='fl'>0.05</span>, </span>
<span>               p11_0 <span class='op'>=</span> <span class='fl'>0.01</span>, p11_1 <span class='op'>=</span> <span class='fl'>0.01</span>, p11_2 <span class='op'>=</span> <span class='fl'>0.03</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The computation using <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> is done using the following code.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Input causal DAG</span></span>
<span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r.igraph.org/reference/graph_from_literal.html'>graph_from_literal</a></span><span class='op'>(</span><span class='va'>Z</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>X</span>, <span class='va'>X</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>Y</span>, <span class='va'>Ur</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>X</span>, <span class='va'>Ur</span> <span class='op'>-</span><span class='op'>+</span> <span class='va'>Y</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/V.html'>V</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>$</span><span class='va'>leftside</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/V.html'>V</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>$</span><span class='va'>latent</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/V.html'>V</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>$</span><span class='va'>nvals</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/E.html'>E</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>$</span><span class='va'>rlconnect</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>,  <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r.igraph.org/reference/E.html'>E</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>$</span><span class='va'>edge.monotone</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span>
<span><span class='co'># Construct causal problem</span></span>
<span><span class='va'>obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/analyze_graph.html'>analyze_graph</a></span><span class='op'>(</span><span class='va'>b</span>, constraints <span class='op'>=</span> <span class='cn'>NULL</span>, </span>
<span>                     effectt <span class='op'>=</span> <span class='st'>"p{Y(X = 1) = 1} - p{Y(X = 0) = 1}"</span><span class='op'>)</span></span>
<span><span class='co'># Compute bounds on query</span></span>
<span><span class='va'>bounds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/optimize_effect_2.html'>optimize_effect_2</a></span><span class='op'>(</span><span class='va'>obj</span><span class='op'>)</span></span>
<span><span class='co'># Construct bounds as function of parameters</span></span>
<span><span class='va'>boundsfunction</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/causaloptim/man/interpret_bounds.html'>interpret_bounds</a></span><span class='op'>(</span>bounds <span class='op'>=</span> <span class='va'>bounds</span><span class='op'>$</span><span class='va'>bounds</span>, </span>
<span>                                   parameters <span class='op'>=</span> <span class='va'>obj</span><span class='op'>$</span><span class='va'>parameters</span><span class='op'>)</span></span>
<span><span class='co'># Insert observed conditional probabilities</span></span>
<span><span class='va'>numericbounds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span><span class='op'>(</span><span class='va'>boundsfunction</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>as.list</a></span><span class='op'>(</span><span class='va'>params</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>numericbounds</span>, <span class='fl'>2</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  lower upper
1 -0.09  0.74</code></pre>
</div>
<p>Our computed bounds agree with those computed using <a href="https://cran.r-project.org/package=bpbounds">bpbounds</a> as well as those estimated using Theorem 2 of <span class="citation" data-cites="richardson2014ace">Richardson and Robins (<a href="#ref-richardson2014ace" role="doc-biblioref">2014</a>)</span>, who independently derived expressions for tight bounds that are applicable to this setting.</p>
<h2 data-number="6" id="summary-and-discussion"><span class="header-section-number">6</span> Summary and discussion</h2>
<p>The methods and algorithms described in <span class="citation" data-cites="generalcausalbounds">Sachs et al. (<a href="#ref-generalcausalbounds" role="doc-biblioref">2022</a>)</span> to compute symbolic expressions for bounds on non-identifiable causal effects are implemented in the package <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a>. Our aim was to provide a user-friendly interface to these methods with a graphical interface to draw DAGs, specify causal effects with commonly used notation for counterfactuals, and take advantage of an efficient implementation of vertex enumeration to reduce computation times. These methods are applicable to a wide variety of causal inference problems which appear in biomedical research, economics, social sciences and more. Aside from the graphical interface, programming with the package is encouraged to promote reproducibility and advanced use. Our package includes automated unit tests and also tests for correctness by comparing the symbolic bounds derived using our program to independently derived bounds in particular settings.</p>
<p>Our implementation uses a novel approach to draw DAGs using <code>JavaScript</code> in a web browser that can then be passed to <code>R</code> using <a href="https://cran.r-project.org/package=shiny">shiny</a>. This graphical approach can be adapted and used in other settings where graphs need to be specified and computed on, such as other causal inference settings, networks, and multi-state models. Other algorithms and data structures that could be more broadly useful include the representation of structural equations as <code>R</code> functions, recursive evaluation of response functions, and parsing of string equations for causal effects and constraints.</p>
<p>Note that <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> computes bounds only in settings with tightness guarantees. Although the set of available causal queries is quite large, the set of admissible DAGs can appear restrictive. The usefulness of the methodology and implementation extends to a much larger class of problems however. Tight bounds for restricted settings can be used to derive potentially not tight but narrow valid bounds in less restrictive settings. In <span class="citation" data-cites="kurokicai">Cai et al. (<a href="#ref-kurokicai" role="doc-biblioref">2007</a>)</span> and <span class="citation" data-cites="semipariv">Cui and Tchetgen (<a href="#ref-semipariv" role="doc-biblioref">2021</a>)</span> the authors make use of the tight Balke-Pearl bounds to derive narrow (but not necessarily tight) valid bounds on causal effects subject to causal DAGs that fall outside the scope for tightness guarantees using this methodology. We believe the tight bounds computed by <a href="https://cran.r-project.org/package=causaloptim">causaloptim</a> hold great potential for such applications.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h3 class="appendix" data-number="6.1" id="supplementary-materials"><span class="header-section-number">6.1</span> Supplementary materials</h3>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2023-083.zip">RJ-2023-083.zip</a></p>
<h3 class="appendix" data-number="6.2" id="cran-packages-used"><span class="header-section-number">6.2</span> CRAN packages used</h3>
<p><a href="https://cran.r-project.org/package=causaloptim">causaloptim</a>, <a href="https://cran.r-project.org/package=bpbounds">bpbounds</a>, <a href="https://cran.r-project.org/package=shiny">shiny</a>, <a href="https://cran.r-project.org/package=igraph">igraph</a>, <a href="https://cran.r-project.org/package=rcdd">rcdd</a></p>
<h3 class="appendix" data-number="6.3" id="cran-task-views-implied-by-cited-packages"><span class="header-section-number">6.3</span> CRAN Task Views implied by cited packages</h3>
<p><a href="https://cran.r-project.org/view=CausalInference">CausalInference</a>, <a href="https://cran.r-project.org/view=GraphicalModels">GraphicalModels</a>, <a href="https://cran.r-project.org/view=Optimization">Optimization</a>, <a href="https://cran.r-project.org/view=WebTechnologies">WebTechnologies</a></p>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-balke1997bounds" class="csl-entry" role="listitem">
A. Balke and J. Pearl. Bounds on treatment effects from studies with imperfect compliance. <em>Journal of the American Statistical Association</em>, 92(439): 1171–1176, 1997.
</div>
<div id="ref-cai2008bounds" class="csl-entry" role="listitem">
Z. Cai, M. Kuroki, J. Pearl and J. Tian. Bounds on direct effects in the presence of confounded intermediate variables. <em>Biometrics</em>, 64(3): 695–701, 2008.
</div>
<div id="ref-kurokicai" class="csl-entry" role="listitem">
Z. Cai, M. Kuroki and T. Sato. Non-parametric bounds on treatment effects with non-compliance by covariate adjustment. <em>Statistics in Medicine</em>, 26(16): 3188–3204, 2007. URL <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.2766">https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.2766</a>.
</div>
<div id="ref-shiny" class="csl-entry" role="listitem">
W. Chang, J. Cheng, J. Allaire, C. Sievert, B. Schloerke, Y. Xie, J. Allen, J. McPherson, A. Dipert and B. Borges. <em>Shiny: Web application framework for r.</em> 2022. URL <a href="https://CRAN.R-project.org/package=shiny">https://CRAN.R-project.org/package=shiny</a>. R package version 1.7.4.
</div>
<div id="ref-igraph" class="csl-entry" role="listitem">
G. Csardi and T. Nepusz. The igraph software package for complex network research. <em>InterJournal</em>, Complex Systems: 1695, 2006. URL <a href="https://igraph.org">https://igraph.org</a>.
</div>
<div id="ref-semipariv" class="csl-entry" role="listitem">
Y. Cui and E. T. Tchetgen. A semiparametric instrumental variable approach to optimal treatment regimes under endogeneity. <em>Journal of the American Statistical Association</em>, 116(533): 162–173, 2021. URL<a href=" https://doi.org/10.1080/01621459.2020.1783272"> https://doi.org/10.1080/01621459.2020.1783272</a>. PMID: 33994604.
</div>
<div id="ref-mendelian" class="csl-entry" role="listitem">
G. Davey Smith and S. Ebrahim. <span class="nocase"><span>“Mendelian randomization”</span>: can genetic epidemiology contribute to understanding environmental determinants of disease?</span> <em>International Journal of Epidemiology</em>, 32(1): 1–22, 2003. URL <a href="https://doi.org/10.1093/ije/dyg070">https://doi.org/10.1093/ije/dyg070</a>.
</div>
<div id="ref-freedmandata" class="csl-entry" role="listitem">
L. S. Freedman, B. I. Graubard and A. Schatzkin. Statistical validation of intermediate endpoints for chronic diseases. <em>Statistics in Medicine</em>, 11(2): 167–178, 1992. URL <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.4780110204">https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.4780110204</a>.
</div>
<div id="ref-gabriel2020causal" class="csl-entry" role="listitem">
E. E. Gabriel, M. C. Sachs and A. Sjölander. Causal bounds for outcome-dependent sampling in observational studies. <em>Journal of the American Statistical Association</em>, 117(538): 939–950, 2022a.
</div>
<div id="ref-gabriel2022sharp" class="csl-entry" role="listitem">
E. E. Gabriel, M. C. Sachs and A. Sjölander. Sharp nonparametric bounds for decomposition effects with two binary mediators. <em>Journal of the American Statistical Association</em>, In press, 2022b.
</div>
<div id="ref-gabriel2021nonparametric" class="csl-entry" role="listitem">
E. E. Gabriel, A. Sjölander and M. C. Sachs. Nonparametric bounds for causal effects in imperfect randomized experiments. <em>Journal of the American Statistical Association</em>, 118(541): 684–692, 2023.
</div>
<div id="ref-rcdd" class="csl-entry" role="listitem">
C. J. Geyer, G. D. Meeden and incorporates code from cddlib written by Komei Fukuda. <em>Rcdd: Computational geometry.</em> 2021. URL <a href="https://CRAN.R-project.org/package=rcdd">https://CRAN.R-project.org/package=rcdd</a>. R package version 1.5.
</div>
<div id="ref-greenland1999causal" class="csl-entry" role="listitem">
S. Greenland, J. Pearl and J. M. Robins. Causal diagrams for epidemiologic research. <em>Epidemiology</em>, 37–48, 1999.
</div>
<div id="ref-mattheiss1973algorithm" class="csl-entry" role="listitem">
T. H. Mattheiss. An algorithm for determining irrelevant constraints and all vertices in systems of linear inequalities. <em>Operations Research</em>, 21(1): 247–260, 1973.
</div>
<div id="ref-meleady_thermolabile_2003" class="csl-entry" role="listitem">
R. Meleady, P. M. Ueland, H. Blom, A. S. Whitehead, H. Refsum, L. E. Daly, S. E. Vollset, C. Donohue, B. Giesendorf, I. M. Graham, et al. Thermolabile methylenetetrahydrofolate reductase, homocysteine, and cardiovascular disease risk: The <span>European</span> <span>Concerted</span> <span>Action</span> <span>Project</span>. <em>The American journal of clinical nutrition</em>, 77(1): 63–70, 2003. DOI <a href="https://doi.org/10.1093/ajcn/77.1.63">10.1093/ajcn/77.1.63</a>. Place: United States.
</div>
<div id="ref-bpbounds-package" class="csl-entry" role="listitem">
T. M. Palmer, R. Ramsahai, V. Didelez and N. A. Sheehan. <em>Bpbounds: R package implementing balke-pearl bounds for the average causal effect.</em> 2018. URL <a href="https://github.com/remlapmot/bpbounds">https://github.com/remlapmot/bpbounds</a>.
</div>
<div id="ref-pearl2009causality" class="csl-entry" role="listitem">
J. Pearl. <em>Causality.</em> Cambridge university press, 2009.
</div>
<div id="ref-pearl2001direct" class="csl-entry" role="listitem">
J. Pearl. Direct and indirect effects. In <em>Proceedings of the seventeenth conference on uncertainty and artificial intelligence, 2001</em>, pages. 411–420 2001. Morgan Kaufman.
</div>
<div id="ref-richardson2014ace" class="csl-entry" role="listitem">
T. S. Richardson and J. M. Robins. ACE bounds; SEMs with equilibrium conditions. <em>Statistical Science</em>, 29(3): 363–366, 2014.
</div>
<div id="ref-generalcausalbounds" class="csl-entry" role="listitem">
M. C. Sachs, G. Jonzon, A. Sjölander and E. E. Gabriel. A general method for deriving tight symbolic bounds on causal effects. <em>Journal of Computational and Graphical Statistics</em>, 0(0): 1–10, 2022. URL<a href=" 
        https://doi.org/10.1080/10618600.2022.2071905
    
">
https://doi.org/10.1080/10618600.2022.2071905
</a>.
</div>
<div id="ref-causaloptim" class="csl-entry" role="listitem">
M. C. Sachs, G. Jonzon, A. Sjölander and E. E. Gabriel. <em>Causaloptim: An interface to specify causal graphs and compute bounds on causal effects.</em> 2023. URL <a href="https://github.com/sachsmc/causaloptim">https://github.com/sachsmc/causaloptim</a>. R package version 0.9.8.
</div>
<div id="ref-st0232" class="csl-entry" role="listitem">
N. A. Sheehan. Nonparametric bounds for the causal effect in a binary instrumental-variable model. <em>Stata Journal</em>, 11(3): 345–367(23), 2011. URL <a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1101100302">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1101100302</a>.
</div>
<div id="ref-sjolander2009bounds" class="csl-entry" role="listitem">
A. Sjölander. Bounds on natural direct effects in the presence of confounded intermediate variables. <em>Statistics in Medicine</em>, 28(4): 558–571, 2009a.
</div>
<div id="ref-sjolandernaturaldirecteffects" class="csl-entry" role="listitem">
A. Sjölander. Bounds on natural direct effects in the presence of confounded intermediate variables. <em>Statistics in Medicine</em>, 28(4): 558–571, 2009b. URL <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.3493">https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.3493</a>.
</div>
<div id="ref-sjolander2014bounds" class="csl-entry" role="listitem">
A. Sjölander, W. Lee, H. Källberg and Y. Pawitan. Bounds on causal interactions for binary outcomes. <em>Biometrics</em>, 70(3): 500–505, 2014.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Jonzon, et al., "Accessible Computation of Tight Symbolic Bounds on Causal Effects using an Intuitive Graphical Interface", The R Journal, 2024</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2023-083,
  author = {Jonzon, Gustav and Sachs, Michael C and Gabriel, Erin E},
  title = {Accessible Computation of Tight Symbolic Bounds on Causal Effects using an Intuitive Graphical Interface},
  journal = {The R Journal},
  year = {2024},
  note = {https://doi.org/10.32614/RJ-2023-083},
  doi = {10.32614/RJ-2023-083},
  volume = {15},
  issue = {4},
  issn = {2073-4859},
  pages = {53-68}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
