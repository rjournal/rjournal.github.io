<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
      margin-bottom: 0em;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>Space-Time Smoothing of Survey Outcomes using the R Package SUMMER</title>

<meta property="description" itemprop="description" content="The increasing availability of complex survey data, and the continued need for estimates of demographic and health indicators at a fine spatial and temporal scale, has led to the need for spatio-temporal smoothing methods that acknowledge the manner in which the data were collected. The open source R package SUMMER implements a variety of methods for spatial or spatio-temporal smoothing of survey outcomes. In this paper, we focus primarily on demographic and health indicators. Our methods are particularly useful for data from Demographic Health Surveys (DHS) and Multiple Indicator Cluster Surveys (MICS). We build upon functions within the survey package, and use INLA for fast Bayesian computation. This paper includes a brief overview of these methods and illustrates the workflow of processing surveys, fitting space-time smoothing models for both binary and composite indicators, and visualizing results with both simulated data and DHS surveys."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2025-005/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2025-08-07"/>
<meta property="article:created" itemprop="dateCreated" content="2025-08-07"/>
<meta name="article:author" content="Zehang Richard Li"/>
<meta name="article:author" content="Bryan D Martin"/>
<meta name="article:author" content="Tracy Qi Dong"/>
<meta name="article:author" content="Geir-Arne Fuglstad"/>
<meta name="article:author" content="Jessica Godwin"/>
<meta name="article:author" content="John Paige"/>
<meta name="article:author" content="Andrea Riebler"/>
<meta name="article:author" content="Samuel J Clark"/>
<meta name="article:author" content="Jon Wakefield"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Space-Time Smoothing of Survey Outcomes using the R Package SUMMER"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="The increasing availability of complex survey data, and the continued need for estimates of demographic and health indicators at a fine spatial and temporal scale, has led to the need for spatio-temporal smoothing methods that acknowledge the manner in which the data were collected. The open source R package SUMMER implements a variety of methods for spatial or spatio-temporal smoothing of survey outcomes. In this paper, we focus primarily on demographic and health indicators. Our methods are particularly useful for data from Demographic Health Surveys (DHS) and Multiple Indicator Cluster Surveys (MICS). We build upon functions within the survey package, and use INLA for fast Bayesian computation. This paper includes a brief overview of these methods and illustrates the workflow of processing surveys, fitting space-time smoothing models for both binary and composite indicators, and visualizing results with both simulated data and DHS surveys."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2025-005/"/>
<meta property="og:image" content="https://journal.r-project.org/articles/RJ-2025-005/Figures/Workflow.png"/>
<meta property="og:image:width" content="2999"/>
<meta property="og:image:height" content="2454"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Space-Time Smoothing of Survey Outcomes using the R Package SUMMER"/>
<meta property="twitter:description" content="The increasing availability of complex survey data, and the continued need for estimates of demographic and health indicators at a fine spatial and temporal scale, has led to the need for spatio-temporal smoothing methods that acknowledge the manner in which the data were collected. The open source R package SUMMER implements a variety of methods for spatial or spatio-temporal smoothing of survey outcomes. In this paper, we focus primarily on demographic and health indicators. Our methods are particularly useful for data from Demographic Health Surveys (DHS) and Multiple Indicator Cluster Surveys (MICS). We build upon functions within the survey package, and use INLA for fast Bayesian computation. This paper includes a brief overview of these methods and illustrates the workflow of processing surveys, fitting space-time smoothing models for both binary and composite indicators, and visualizing results with both simulated data and DHS surveys."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2025-005/"/>
<meta property="twitter:image" content="https://journal.r-project.org/articles/RJ-2025-005/Figures/Workflow.png"/>
<meta property="twitter:image:width" content="2999"/>
<meta property="twitter:image:height" content="2454"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Space-Time Smoothing of Survey Outcomes using the R Package SUMMER"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2025-005"/>
<meta name="citation_pdf_url" content="RJ-2025-005.pdf"/>
<meta name="citation_volume" content="17"/>
<meta name="citation_issue" content="1"/>
<meta name="citation_doi" content="10.32614/RJ-2025-005"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="88"/>
<meta name="citation_lastpage" content="107"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2025/08/07"/>
<meta name="citation_publication_date" content="2025/08/07"/>
<meta name="citation_author" content="Zehang Richard Li"/>
<meta name="citation_author_institution" content="University of California, Santa Cruz"/>
<meta name="citation_author" content="Bryan D Martin"/>
<meta name="citation_author_institution" content="University of Washington"/>
<meta name="citation_author" content="Tracy Qi Dong"/>
<meta name="citation_author_institution" content="Fred Hutchinson Cancer Research Center"/>
<meta name="citation_author" content="Geir-Arne Fuglstad"/>
<meta name="citation_author_institution" content="Norwegian University of Science and Technology"/>
<meta name="citation_author" content="Jessica Godwin"/>
<meta name="citation_author_institution" content="University of Washington"/>
<meta name="citation_author" content="John Paige"/>
<meta name="citation_author_institution" content="Norwegian Computing Center"/>
<meta name="citation_author" content="Andrea Riebler"/>
<meta name="citation_author_institution" content="Norwegian University of Science and Technology"/>
<meta name="citation_author" content="Samuel J Clark"/>
<meta name="citation_author_institution" content="The Ohio State University"/>
<meta name="citation_author" content="Jon Wakefield"/>
<meta name="citation_author_institution" content="University of Washington"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Child mortality estimation incorporating summary birth history data;citation_publisher=Oxford University Press;citation_volume=77;citation_author=Katie Wilson;citation_author=Jon Wakefield"/>
  <meta name="citation_reference" content="citation_title=surveyPrev: Mapping the prevalence of binary indicators using survey data in small areas;citation_author=Qianyu Dong;citation_author=Zehang R. Li;citation_author=Yunhan Wu;citation_author=Andrea Boskovic;citation_author=Jon Wakefield"/>
  <meta name="citation_reference" content="citation_title=survey: Analysis of complex survey samples;citation_author=Thomas Lumley"/>
  <meta name="citation_reference" content="citation_title=The two cultures for prevalence mapping: Small area estimation and spatial statistics;citation_author=Geir-Arne Fuglstad;citation_author=Zehang Richard Li;citation_author=Jon Wakefield"/>
  <meta name="citation_reference" content="citation_title=Spatial modeling for subnational administrative level 2 small-area estimation;citation_publisher=ICF;citation_author=Yunhan Wu;citation_author=Zehang Richard Li;citation_author=Benjamin K. Mayala;citation_author=Houjie Wang;citation_author=Peter Gao;citation_author=Johnny Paige;citation_author=Geir-Arne Fuglstad;citation_author=Caitlin Moe;citation_author=Jessica Godwin;citation_author=Rose E. Donohue;citation_author=Trevor N. Croft;citation_author=Jon Wakefield"/>
  <meta name="citation_reference" content="citation_title=Patchwork: The composer of plots;citation_author=Thomas Lin Pedersen"/>
  <meta name="citation_reference" content="citation_title=ggplot2: Elegant graphics for data analysis;citation_publisher=Springer-Verlag New York;citation_author=Hadley Wickham"/>
  <meta name="citation_reference" content="citation_title=Rdhs: API client and dataset management for the Demographic and Health Survey (DHS) data;citation_author=OJ Watson;citation_author=Jeff Eaton"/>
  <meta name="citation_reference" content="citation_title=Analysis of complex survey samples;citation_volume=9;citation_author=Thomas Lumley"/>
  <meta name="citation_reference" content="citation_title=Small area estimation of health outcomes;citation_author=Jon Wakefield;citation_author=Taylor Okonek;citation_author=Jon Pedersen"/>
  <meta name="citation_reference" content="citation_title=Monitoring change in child mortality through household surveys;citation_publisher=Public Library of Science;citation_volume=10;citation_author=Kenneth Hill;citation_author=Eoghan Brady;citation_author=Linnea Zimmerman;citation_author=Livia Montana;citation_author=Romesh Silva;citation_author=Agbessi Amouzou"/>
  <meta name="citation_reference" content="citation_title=Changes in the spatial distribution of the under five mortality rate: Small-area analysis of 122 DHS surveys in 262 subregions of 35 countries in Africa;citation_author=Zehang R. Li;citation_author=Yuan Hsiao;citation_author=Jessica Godwin;citation_author=Bryan D. Martin;citation_author=Jon Wakefield;citation_author=Samuel J. Clark"/>
  <meta name="citation_reference" content="citation_title=Approximate Bayesian inference for latent Gaussian models using integrated nested Laplace approximations (with discussion);citation_volume=71;citation_author=H. Rue;citation_author=S. Martino;citation_author=N. Chopin"/>
  <meta name="citation_reference" content="citation_title=Spatial data repository;citation_author=Spatial data repository"/>
  <meta name="citation_reference" content="citation_title=GADM database of global administrative areas;citation_author=GADM database of global administrative areas"/>
  <meta name="citation_reference" content="citation_title=Child mortality estimation: Methods used to adjust for bias due to AIDS in estimating trends in under-five mortality;citation_publisher=Public Library of Science;citation_volume=9;citation_author=Neff Walker;citation_author=Kenneth Hill;citation_author=Fengmin Zhao"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","author","date","draft","description","type","preamble","bibliography","output","date_received","volume","issue","slug","journal","pdf_url","citation_url","doi","creative_commons","packages","CTV","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Space-Time Smoothing of Survey Outcomes using the R Package SUMMER"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","orcid_id","email"]}},"value":[{"type":"character","attributes":{},"value":["Zehang Richard Li"]},{"type":"character","attributes":{},"value":["University of California, Santa Cruz"]},{"type":"character","attributes":{},"value":["Santa Cruz CA, USA"]},{"type":"character","attributes":{},"value":["0000-0002-9079-593X"]},{"type":"character","attributes":{},"value":["lizehang@ucsc.edu"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","email","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Bryan D Martin"]},{"type":"character","attributes":{},"value":["bmartin6@uw.edu"]},{"type":"character","attributes":{},"value":["University of Washington"]},{"type":"character","attributes":{},"value":["Seattle, WA, USA"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","email","affiliation","address","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Tracy Qi Dong"]},{"type":"character","attributes":{},"value":["qdong@fredhutch.org"]},{"type":"character","attributes":{},"value":["Fred Hutchinson Cancer Research Center"]},{"type":"character","attributes":{},"value":["Seattle, WA, USA"]},{"type":"character","attributes":{},"value":["0000-0001-6769-608X"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","email","affiliation","address","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Geir-Arne Fuglstad"]},{"type":"character","attributes":{},"value":["geir-arne.fuglstad@ntnu.no"]},{"type":"character","attributes":{},"value":["Norwegian University of Science and Technology"]},{"type":"character","attributes":{},"value":["Trondheim, Norway"]},{"type":"character","attributes":{},"value":["0000-0003-4995-2152"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","email","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Jessica Godwin"]},{"type":"character","attributes":{},"value":["jlg0003@uw.edu"]},{"type":"character","attributes":{},"value":["University of Washington"]},{"type":"character","attributes":{},"value":["Seattle, WA, USA"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","email","affiliation","address","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["John Paige"]},{"type":"character","attributes":{},"value":["paigejo@gmail.com"]},{"type":"character","attributes":{},"value":["Norwegian Computing Center"]},{"type":"character","attributes":{},"value":["Oslo, Norway"]},{"type":"character","attributes":{},"value":["0000-0003-2683-2596"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","email","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Andrea Riebler"]},{"type":"character","attributes":{},"value":["andrea.riebler@ntnu.no"]},{"type":"character","attributes":{},"value":["Norwegian University of Science and Technology"]},{"type":"character","attributes":{},"value":["Trondheim, Norway"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","email","affiliation","address","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Samuel J Clark"]},{"type":"character","attributes":{},"value":["work@samclark.net"]},{"type":"character","attributes":{},"value":["The Ohio State University"]},{"type":"character","attributes":{},"value":["Columbus, OH, USA"]},{"type":"character","attributes":{},"value":["0000-0002-4929-6231"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","email","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Jon Wakefield"]},{"type":"character","attributes":{},"value":["jonno@uw.edu"]},{"type":"character","attributes":{},"value":["University of Washington"]},{"type":"character","attributes":{},"value":["Seattle, WA, USA"]}]}]},{"type":"character","attributes":{},"value":["2025-08-07"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["The increasing availability of complex survey data, and the continued need for estimates of demographic and health indicators at a fine spatial and temporal scale, has led to the need for spatio-temporal smoothing methods that acknowledge the manner in which the data were collected. The open source R package SUMMER implements a variety of methods for spatial or spatio-temporal smoothing of survey outcomes. In this paper, we focus primarily on demographic and health indicators. Our methods are particularly useful for data from Demographic Health Surveys (DHS) and Multiple Indicator Cluster Surveys (MICS). We build upon functions within the survey package, and use INLA for fast Bayesian computation. This paper includes a brief overview of these methods and illustrates the workflow of processing surveys, fitting space-time smoothing models for both binary and composite indicators, and visualizing results with both simulated data and DHS surveys."]},{"type":"character","attributes":{},"value":["package"]},{"type":"character","attributes":{},"value":["\\usepackage{amsmath, amsthm, amsfonts, amssymb, bm, natbib}\n\\newcommand{\\red}[1]{\\textcolor{red}{#1}}\n\\newcommand{\\proglang}[1]{\\text{#1}}\n"]},{"type":"character","attributes":{},"value":["SUMMER-RJ.bib"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["2024-05-24"]},{"type":"integer","attributes":{},"value":[17]},{"type":"integer","attributes":{},"value":[1]},{"type":"character","attributes":{},"value":["RJ-2025-005"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[88]},{"type":"integer","attributes":{},"value":[107]}]},{"type":"character","attributes":{},"value":["RJ-2025-005.pdf"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2025-005"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2025-005"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["sae","rsae","hbsae","BayesSAE","msae","SUMMER","survey","ggplot2","patchwork","rdhs","surveyPrev"]},{"type":"list","attributes":{},"value":[]}]},{"type":"character","attributes":{},"value":["Bayesian","ChemPhys","NetworkAnalysis","OfficialStatistics","Phylogenetics","Spatial","Survival","TeachingStatistics"]},{"type":"character","attributes":{},"value":["/home/mitchell/R/x86_64-pc-linux-gnu-library/4.5/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2025-005/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["Data/DHS_counts.rda","Data/DHS_direct_hiv_adj.rda","Figures/Workflow.png","RJ-2025-005_files/figure-html5/brfss-4-1.png","RJ-2025-005_files/figure-html5/check-2-1.png","RJ-2025-005_files/figure-html5/smooth-direct-estimate-2-1.png","RJ-2025-005_files/figure-html5/vis-1-1.png","RJ-2025-005_files/figure-html5/vis-1b-1.png","RJ-2025-005_files/figure-html5/vis-2-1.png","RJ-2025-005_files/figure-html5/vis-3-1.png","RJ-2025-005_files/figure-html5/vis-4-1.png","RJ-2025-005_files/figure-latex/brfss-4-1.png","RJ-2025-005_files/figure-latex/check-2-1.png","RJ-2025-005_files/figure-latex/smooth-direct-estimate-2-1.png","RJ-2025-005_files/figure-latex/vis-1-1.png","RJ-2025-005_files/figure-latex/vis-1b-1.png","RJ-2025-005_files/figure-latex/vis-2-1.png","RJ-2025-005_files/figure-latex/vis-3-1.png","RJ-2025-005_files/figure-latex/vis-4-1.png","RJ-2025-005.log","RJ-2025-005.pdf","RJ-2025-005.tex","RJ-2025-005.zip","RJournal.sty","RJwrapper.log","RJwrapper.tex","SUMMER-RJ.bib","SUMMER-RJ.tex","Summer.zip"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.30/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Mathjax config (add automatic linebreaks when supported)
      // MathJax = {
      //    tex: {
      //        inlineMath: [['$', '$'], ['\\(', '\\)']],
      //        displayMath: [['$$', '$$'], ['\\[', '\\]']],
      //        tags: 'ams',
      //        multline: true,
      //    },
      //    options: {
      //        linebreaks: { automatic: true },
      //    },
      // };

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      
      // Conditionally add supplementary files button
      if (document.getElementById('supplementary-materials')) {
        // create element safely
        const btn_suppl = document.createElement('a');
        btn_suppl.href = slug + '.zip';
        btn_suppl.className = 'dt-tag';
        btn_suppl.innerHTML = '<i class="fas fa-file-zipper"></i> Supplement';
        buttons.append(btn_suppl);
      }

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").filter(function() {
        return !$(this).hasClass("subtitle");
      }).first();
      if (tpar) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append(tpar) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Space-Time Smoothing of Survey Outcomes using the R Package SUMMER","description":"The increasing availability of complex survey data, and the continued need for estimates of demographic and health indicators at a fine spatial and temporal scale, has led to the need for spatio-temporal smoothing methods that acknowledge the manner in which the data were collected. The open source R package SUMMER implements a variety of methods for spatial or spatio-temporal smoothing of survey outcomes. In this paper, we focus primarily on demographic and health indicators. Our methods are particularly useful for data from Demographic Health Surveys (DHS) and Multiple Indicator Cluster Surveys (MICS). We build upon functions within the survey package, and use INLA for fast Bayesian computation. This paper includes a brief overview of these methods and illustrates the workflow of processing surveys, fitting space-time smoothing models for both binary and composite indicators, and visualizing results with both simulated data and DHS surveys.","doi":"10.32614/RJ-2025-005","authors":[{"author":"Zehang Richard Li","authorURL":"#","affiliation":"University of California, Santa Cruz","affiliationURL":"#","orcidID":"0000-0002-9079-593X"},{"author":"Bryan D Martin","authorURL":"#","affiliation":"University of Washington","affiliationURL":"#","orcidID":""},{"author":"Tracy Qi Dong","authorURL":"#","affiliation":"Fred Hutchinson Cancer Research Center","affiliationURL":"#","orcidID":"0000-0001-6769-608X"},{"author":"Geir-Arne Fuglstad","authorURL":"#","affiliation":"Norwegian University of Science and Technology","affiliationURL":"#","orcidID":"0000-0003-4995-2152"},{"author":"Jessica Godwin","authorURL":"#","affiliation":"University of Washington","affiliationURL":"#","orcidID":""},{"author":"John Paige","authorURL":"#","affiliation":"Norwegian Computing Center","affiliationURL":"#","orcidID":"0000-0003-2683-2596"},{"author":"Andrea Riebler","authorURL":"#","affiliation":"Norwegian University of Science and Technology","affiliationURL":"#","orcidID":""},{"author":"Samuel J Clark","authorURL":"#","affiliation":"The Ohio State University","affiliationURL":"#","orcidID":"0000-0002-4929-6231"},{"author":"Jon Wakefield","authorURL":"#","affiliation":"University of Washington","affiliationURL":"#","orcidID":""}],"publishedDate":"2025-08-07T00:00:00.000+00:00","citationText":"Li, et al., 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues/2025-4">Current</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../submissions.html">Submit</a>
<a href="../../contribute.html">Contribute</a>
<a href="../../editors.html">Editorial board</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Space-Time Smoothing of Survey Outcomes using the R Package SUMMER</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>The increasing availability of complex survey data, and the continued need for estimates of demographic and health indicators at a fine spatial and temporal scale, has led to the need for spatio-temporal smoothing methods that acknowledge the manner in which the data were collected. The open source R package SUMMER implements a variety of methods for spatial or spatio-temporal smoothing of survey outcomes. In this paper, we focus primarily on demographic and health indicators. Our methods are particularly useful for data from Demographic Health Surveys (DHS) and Multiple Indicator Cluster Surveys (MICS). We build upon functions within the survey package, and use INLA for fast Bayesian computation. This paper includes a brief overview of these methods and illustrates the workflow of processing surveys, fitting space-time smoothing models for both binary and composite indicators, and visualizing results with both simulated data and DHS surveys.</p></p>
</div>

<div class="d-byline">
  Zehang Richard Li  (University of California, Santa Cruz)
  
,   Bryan D Martin  (University of Washington)
  
,   Tracy Qi Dong  (Fred Hutchinson Cancer Research Center)
  
,   Geir-Arne Fuglstad  (Norwegian University of Science and Technology)
  
,   Jessica Godwin  (University of Washington)
  
,   John Paige  (Norwegian Computing Center)
  
,   Andrea Riebler  (Norwegian University of Science and Technology)
  
,   Samuel J Clark  (The Ohio State University)
  
,   Jon Wakefield  (University of Washington)
  
<br/>2025-08-07
</div>

<div class="d-article">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
<div class="layout-chunk" data-layout="l-body">

</div>
<!----------------------------------------------------------------->
<!----------------------------------------------------------------->
<h2 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<!----------------------------------------------------------------->
<!----------------------------------------------------------------->
<p>A wealth of health and demographic indicators are now collected across the world, and interest often focuses on patterns in space and time. Spatial patterns indicate potential disparities, while temporal trends are important for determining the impact of interventions and to assess whether targets, such as the sustainable development goals (SDGs), are being met <span class="citation" data-cites="macfeely20">(<a href="#ref-macfeely20" role="doc-biblioref">MacFeely 2020</a>)</span>. In low- and middle-income countries (LMIC), the most reliable data with sufficient spatial resolution are often collected under complex sampling designs. Common sources of data include the Demographic Health Surveys (DHS) and Multiple Indicator Cluster Surveys (MICS), both of which use multi-stage cluster sampling. A two-stage cluster design is most common for these surveys. A sampling frame of <em>clusters</em> (for example, enumeration areas) is constructed, often from a census, and then strata are formed. The strata consist of some administrative geographical partition crossed with urban/rural (with countries having their own definitions of this dichotomy). Then a pre-specified number of clusters are sampled from these strata under some probabilistic scheme, for example, with probability proportional to size (PPS). Different surveys are powered to different geographical levels. Then, within the selected clusters, households are randomly sampled and individuals are sampled within these households, and asked questions on a range of health and demographic variables. This data collection process must be acknowledged in the analysis to reduce bias and obtain proper uncertainty measures in the prevalence estimates.</p>
<p>Various packages are available within R for small area estimation (SAE) of prevalence, including the <a href="https://cran.r-project.org/package=sae">sae</a> package <span class="citation" data-cites="molina_marhuenda_15">(<a href="#ref-molina_marhuenda_15" role="doc-biblioref">Molina and Marhuenda 2015</a>)</span> that supports the popular book of <span class="citation" data-cites="rao_molina_15">Rao and Molina (<a href="#ref-rao_molina_15" role="doc-biblioref">2015</a>)</span> and includes the famous <span class="citation" data-cites="fay_herriot_79">Fay and Herriot (<a href="#ref-fay_herriot_79" role="doc-biblioref">1979</a>)</span> model and spatial smoothing options. Other packages include <a href="https://cran.r-project.org/package=rsae">rsae</a> <span class="citation" data-cites="rsae">(<a href="#ref-rsae" role="doc-biblioref">Schoch 2014</a>)</span>, <a href="https://cran.r-project.org/package=hbsae">hbsae</a> <span class="citation" data-cites="hbsae">(<a href="#ref-hbsae" role="doc-biblioref">Boonstra 2012</a>)</span>, <a href="https://cran.r-project.org/package=BayesSAE">BayesSAE</a> <span class="citation" data-cites="BayesSAE">(<a href="#ref-BayesSAE" role="doc-biblioref">Shi 2018</a>)</span> and <a href="https://cran.r-project.org/package=msae">msae</a> <span class="citation" data-cites="permatasari2021msae">(<a href="#ref-permatasari2021msae" role="doc-biblioref">Permatasari and Ubaidillah 2021</a>)</span>.
A more comprehensive list of related packages is described at <a href="https://cran.r-project.org/web/views/OfficialStatistics.html">OfficialStatistics</a>. Most of the existing packages focus on classical SAE models and provide very limited options for fitting spatial and space-time smoothing models.</p>
<p>In this paper we introduce the R package, <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. This package and its details are available on CRAN. <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> provides a computational framework and a collection of tools for smoothing and mapping the prevalence of indicators with complex survey data over space and time, with a special focus on estimating mortality rates. Smoothing is important to avoid unstable estimates and combine information from multiple surveys over time. Originally developed for small area estimation of the under-5 child mortality rate (U5MR), the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package has been extended to broader mortality rate estimation and more general tasks in SAE. The implemented methods have already been successfully applied to a range of data, e.g., subnational estimates of mortality rates <span class="citation" data-cites="mercer_etal_15 li_etal_19 schluter2021space fuglstad2021two">(<a href="#ref-mercer_etal_15" role="doc-biblioref">Mercer et al. 2015</a>; <a href="#ref-li_etal_19" role="doc-biblioref">Li et al. 2019</a>; <a href="#ref-fuglstad2021two" role="doc-biblioref">Fuglstad et al. 2021</a>; <a href="#ref-schluter2021space" role="doc-biblioref">Schlter and Masquelier 2021</a>)</span>, HIV prevalence <span class="citation" data-cites="wakefield_okonek_pedersen_20">(<a href="#ref-wakefield_okonek_pedersen_20" role="doc-biblioref">Wakefield et al. 2020</a>)</span> and vaccination coverage <span class="citation" data-cites="dong_wakefield_20">(<a href="#ref-dong_wakefield_20" role="doc-biblioref">Dong and Wakefield 2021</a>)</span>. Recently, the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package was used to obtain the official United Nations Inter-Agency Group for Mortality Estimation (UN IGME) yearly estimates (19902021) of U5MR at administrative level <span class="math inline">\(2\)</span> below the national level (admin-2 estimates) for <span class="math inline">\(31\)</span> countries in Africa and Asia <span class="citation" data-cites="un2023">(<a href="#ref-un2023" role="doc-biblioref">United Nations Inter-agency Group for Child Mortality Estimation 2023</a>)</span>. Previously, the UN IGME only produced national estimates using the <em>B3 model</em> <span class="citation" data-cites="alkema_new_14">(<a href="#ref-alkema_new_14" role="doc-biblioref">Alkema and New 2014</a>)</span>. The results of these endeavors are available online at .</p>
<p>The main focus of this paper is to provide an overview of the different prevalence models using survey data and how they can be implemented in <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a>. The rest of the paper is organized as follows. We first briefly describe different methods to estimate prevalence using survey data. We start with a generic binary indicator and proceed with estimating mortality rates. We then provide an overview of the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package and the workflows of using <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> for prevalence mapping. We then discuss three examples for spatial and space-time smoothing of binary and composite indicators with increasing complexity. The first two examples use simulated data that are included in the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package. The last example uses the most recent DHS survey from Malawi. Then we illustrate various visualization and model checking tools in the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package. Finally, we conclude with future work.</p>
<!----------------------------------------------------------------->
<!----------------------------------------------------------------->
<h2 data-number="2" id="space-time-smoothing-using-complex-survey-data"><span class="header-section-number">2</span> Space-time smoothing using complex survey data</h2>
<p>In this section we review different methods to estimate the prevalence of a health outcome from complex survey data. We begin by discussing design-based, <em>direct</em> estimates <span class="citation" data-cites="rao_molina_15">(<a href="#ref-rao_molina_15" role="doc-biblioref">Rao and Molina 2015</a>)</span> which are based on response data from that area only. Next, we describe space-time smoothing of the direct estimates using a Fay-Herriot model <span class="citation" data-cites="fay_herriot_79">(<a href="#ref-fay_herriot_79" role="doc-biblioref">Fay and Herriot 1979</a>)</span>. We discuss both estimating the prevalence of a single binary indicator and the composite indicators such as U5MR. We then describe a cluster-level model to estimate prevalence at finer spatial and temporal resolutions.</p>
<h3 data-number="2.1" id="estimating-the-prevalence-of-a-generic-binary-indicator"><span class="header-section-number">2.1</span> Estimating the prevalence of a generic binary indicator</h3>
<p>Consider a study region that is partitioned into <span class="math inline">\(n\)</span> areas, with interest focusing on estimating the prevalence of a binary indicator in each area, possibly over time. The data are collected via some complex survey design. For each individual <span class="math inline">\(j\)</span>, let <span class="math inline">\(y_j\)</span> denote the individuals outcome, and <span class="math inline">\(w_j\)</span> denote the design weight associated with this individual. Further, let <span class="math inline">\(s_{it}\)</span> represent the indexes of individuals sampled in area <span class="math inline">\(i\)</span> and in time period <span class="math inline">\(t\)</span>. The design-based estimator <span class="citation" data-cites="horvitz_thompson_52 hajek_71">(<a href="#ref-horvitz_thompson_52" role="doc-biblioref">Horvitz and Thompson 1952</a>; <a href="#ref-hajek_71" role="doc-biblioref">Hjek 1971</a>)</span> is
<span class="math display">\[\begin{equation}
\hat p_{it}^{\texttt{HT}} = \frac{\sum_{j \in s_{it}} w_{j}y_j}{\sum_{j \in s_{it}} w_{j}}.
\end{equation}\]</span>
This is an example of a direct estimate.
The variance of <span class="math inline">\(\hat p_{it}^{\texttt{HT}}\)</span> can be calculated using standard methods <span class="citation" data-cites="wolter_07">(<a href="#ref-wolter_07" role="doc-biblioref">Wolter 2007</a>)</span> and can be easily computed using the <a href="https://cran.r-project.org/package=survey">survey</a> package. Let <span class="math inline">\(V^{\texttt{HT}}_{it}\)</span> denote the design-based variance of <span class="math inline">\(\mbox{logit}(p_{it}^{\texttt{HT}})\)</span>, obtained from the design-based variance of <span class="math inline">\(p_{it}^{\texttt{HT}}\)</span> via linearization (the delta method). We take the logit transformed direct estimates as input data and estimate the true prevalence with the random effects model,
<span class="math display">\[\begin{align}
\label{eq:smooth-direct}
\mbox{logit}(\hat p_{it}^{\texttt{HT}}) | \lambda_{it} &amp;\sim \mbox{Normal}(\lambda_{it}, V^{\texttt{HT}}_{it}),\\
\label{eq:smooth-direct2}
\lambda_{it} &amp;= x_{it}^\intercal\beta + \alpha_t + \epsilon_t + S_i + e_i + \delta_{it}.
\end{align}\]</span>
In this model, which is a space-time smoothing extension of the <span class="citation" data-cites="fay_herriot_79">Fay and Herriot (<a href="#ref-fay_herriot_79" role="doc-biblioref">1979</a>)</span> model, <span class="math inline">\(\mbox{expit}(\lambda_{it})\)</span> is the true prevalence we aim to estimate, and <span class="math inline">\(x_{it}\)</span> are area-level covariates. The rest of the terms are normally distributed random effects including structured time trends <span class="math inline">\(\alpha_t\)</span>, unstructured, independent and identically distributed (iid), temporal terms <span class="math inline">\(\epsilon_t\)</span>, structured spatial trends <span class="math inline">\(S_i\)</span>, unstructured spatial terms <span class="math inline">\(e_i\)</span>, and space-time interaction terms <span class="math inline">\(\delta_{it}\)</span>. The terms <span class="math inline">\(e_i+S_i\)</span> are implemented via the BYM2 parameterization <span class="citation" data-cites="riebler_etal_16">(<a href="#ref-riebler_etal_16" role="doc-biblioref">Riebler et al. 2016</a>)</span>, a reparameterization of the classical BYM model <span class="citation" data-cites="besagbayesian">(<a href="#ref-besagbayesian" role="doc-biblioref">Besag et al. 1991</a>)</span> that combines iid error terms with intrinsic conditional autoregressive (ICAR) random effects. Several different temporal models are implemented in <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> for the structured temporal trends and space-time interaction effects, including random walks of order 1 and 2, and autoregressive models <span class="citation" data-cites="rue_knorrheld_05">(<a href="#ref-rue_knorrheld_05" role="doc-biblioref">Rue and Held 2005</a>)</span> with additional linear trends. The interaction term <span class="math inline">\(\delta_{it}\)</span> can be one of the type I to IV interactions of the chosen temporal model and the ICAR model in space, as described in <span class="citation" data-cites="knorrheld_00">Knorr-Held (<a href="#ref-knorrheld_00" role="doc-biblioref">2000</a>)</span>.
In order for the model to be identifiable, we impose sum-to-zero constraints on each group of random effects. More details on the prior choices are provided in the supplementary materials.</p>
<h3 data-number="2.2" id="estimating-mortality-rates-using-area-level-models"><span class="header-section-number">2.2</span> Estimating mortality rates using area-level models</h3>
<p>For composite indicators such as mortality rates, the direct estimates require additional modeling. Here we focus on the estimation of the U5MR, one of the most critical and widely available population health indicators. The methodology and the functions in <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> are readily applicable to mortality rates of other age groups as well, but we note that modeling mortality beyond age 5 is usually more challenging in practice because death becomes rarer, and survey data alone are not sufficient for reliable inference.</p>
<p>The <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package implements the discrete hazards model described in <span class="citation" data-cites="mercer_etal_15">Mercer et al. (<a href="#ref-mercer_etal_15" role="doc-biblioref">2015</a>)</span>. We use discrete time survival analysis to estimate age-specific monthly probabilities of dying in user-defined age groups. We assume constant hazards within the age bands. The default choice uses the monthly age bands
<span class="math display">\[[0, 1), [1, 12), [12, 24), [24, 36), [36, 48), [48, 60)\]</span>
for U5MR and they can be easily specified by the user. The U5MR for area <span class="math inline">\(i\)</span> and time <span class="math inline">\(t\)</span> can be calculated as,
<span class="math display">\[\begin{equation}
\hat p_{it}^{\texttt{HT}} = {}_{60}{\hat q}^{it}_{0} = 1 - \prod_{a = 1}^6 \left( 1 -  {}_{n_a}{\hat q}^{it}_{x_a}\right),
\end{equation}\]</span>
where <span class="math inline">\(x_a\)</span> and <span class="math inline">\(n_a\)</span> are the start and end of the <span class="math inline">\(a\)</span>-th age group, and <span class="math inline">\({}_{n_a}{q}^{it}_{x_a}\)</span> is the probability of death in age group <span class="math inline">\([x_a, x_a + n_a)\)</span> in area <span class="math inline">\(i\)</span> and time <span class="math inline">\(t\)</span>, with <span class="math inline">\({}_{n_a}{\hat q}^{it}_{x_a}\)</span> the estimate of this quantity. This calculation follows the synthetic cohort life table approach in which mortality probabilities for each age segment based on real cohort mortality experience are combined. This allows the full use of the most recent data, which is especially useful when survey data are sparse and is the default approach that <span class="citation" data-cites="dhsspatial">The DHS Program (<a href="#ref-dhsspatial" role="doc-biblioref">2020</a>)</span> uses.</p>
<p>The constant one-month hazards in each age band can be estimated by a weighted logistic regression model <span class="citation" data-cites="binder_83">(<a href="#ref-binder_83" role="doc-biblioref">Binder 1983</a>)</span>:
<span class="math display">\[\begin{equation}
\mbox{logit}\left(
{}_{1}{q}^{it}_{m}
\right) = \beta_{a[m]}^{it},
\end{equation}\]</span>
where <span class="math inline">\(a[m]\)</span> is the age band indicator for the <span class="math inline">\(m\)</span>-th month, i.e.
<span class="math display">\[\begin{equation}
a[m] = \left\{
\begin{array}{ll}
1 &amp; \mbox{if }m=0,\\
2 &amp; \mbox{if }m=1,\dots,11,\\
3 &amp; \mbox{if }m=12,\dots,23,\\
4 &amp; \mbox{if }m=24,\dots,35,\\
5 &amp; \mbox{if }m=36,\dots,47,\\
6 &amp; \mbox{if }m=48,\dots,59.
\end{array}
\right.
\label{eq:am}
\end{equation}\]</span>
The design-based variance of <span class="math inline">\(\mbox{logit}(\hat p_{it}^{\texttt{HT}})\)</span> may then be estimated using the delta method or resampling methods such as the jackknife <span class="citation" data-cites="pedersenandliu_2012">(<a href="#ref-pedersenandliu_2012" role="doc-biblioref">Pedersen and Liu 2012</a>)</span>. The smoothing of the direct estimates can then proceed using the model described in equations (<span class="math inline">\(\ref{eq:smooth-direct}\)</span>)  (<span class="math inline">\(\ref{eq:smooth-direct2}\)</span>). When multiple surveys exist, one may choose to either model the survey-specific effects as fixed or random <span class="citation" data-cites="mercer_etal_15">(<a href="#ref-mercer_etal_15" role="doc-biblioref">Mercer et al. 2015</a>)</span> or first aggregate the direct estimates from multiple surveys to obtain a meta-analysis estimate in each area and time period <span class="citation" data-cites="li_etal_19">(<a href="#ref-li_etal_19" role="doc-biblioref">Li et al. 2019</a>)</span>, i.e., at each time <span class="math inline">\(t\)</span>, we combine the <span class="math inline">\(K_t\)</span> available direct estimates from multiple surveys to form the estimate
<span class="math display">\[
  \hat p_{it}^{\texttt{meta}} = \mbox{expit}\Big(\sum_{k = 1}^{K_t} \frac{(\hat V_{it, k}^{\texttt{HT}})^{-1}}{\sum_{k&#39;=1}^{K_t} (\hat V_{it, k&#39;}^{\texttt{HT}})^{-1}} \mbox{logit}(\hat p_{it}^{\texttt{HT}}) \Big),
\]</span>
and the associated design-based variance on the logit scale is <span class="math inline">\(\Big(\sum_{k&#39;=1}^{K_t} (\hat V_{it, k&#39;}^{\texttt{HT}})^{-1}\Big)^{-1}\)</span>.
To mitigate the sparsity of available data in each year, <span class="citation" data-cites="li_etal_19">Li et al. (<a href="#ref-li_etal_19" role="doc-biblioref">2019</a>)</span> also considers a temporal model defined at the yearly level while the direct estimates are calculated at multi-year periods. All these variations can be fit using the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package.</p>
<h3 data-number="2.3" id="sec:model-cluster"><span class="header-section-number">2.3</span> Estimating mortality rates with cluster-level models</h3>
<p>The space-time Fay-Herriot estimates are useful when there are enough observations at the spatial and temporal unit of the analysis. When the target of inference is at finer resolution, e.g., on a yearly time scale with admin-2 areas and surveys stratified at admin-1 levels, the direct estimates may contain many <span class="math inline">\(0\)</span>s or <span class="math inline">\(1\)</span>s and the design-based variance cannot be calculated reliably. In this case, we can consider unit-level models where the individual survey responses are modeled. In the rest of this section, we describe a model for the cluster-level risk, where we account for the additional within-cluster variation by allowing overdispersion in the likelihood. More detailed comparisons of this modeling choice were examined in <span class="citation" data-cites="dong_wakefield_20">(<a href="#ref-dong_wakefield_20" role="doc-biblioref">Dong and Wakefield 2021</a>)</span>. In a two-stage cluster design, the clusters are referred to as primary sampling units (PSUs) and the households are referred to as secondary sampling units (SSUs). Thus we refer to such models as <code>cluster-level model</code> to avoid confusion. We describe the model for the mortality estimation problem below, while the same formulation applies to the case of any generic binary indicators as well.</p>
<p>In the most general setting, we consider multiple surveys over time, indexed by <span class="math inline">\(k\)</span>. The sampling frame that was used for survey <span class="math inline">\(k\)</span>, will be denoted by <span class="math inline">\(r[k]\)</span>. We assume a discrete hazards model as before. We consider a beta-binomial model for the probability (hazard) of death from month <span class="math inline">\(m\)</span> to <span class="math inline">\(m+1\)</span> in survey <span class="math inline">\(k\)</span> and at cluster <span class="math inline">\(c\)</span> in year <span class="math inline">\(t\)</span>. This model allows for overdispersion relative to the binomial model. Assuming constant hazards within age bands, we assume the number of deaths occurring within age band <span class="math inline">\(a[m]\)</span>, in cluster <span class="math inline">\(c\)</span>, time <span class="math inline">\(t\)</span>, and survey <span class="math inline">\(k\)</span> follow the beta-binomial distribution,
<span class="math display">\[\begin{equation}\label{eq:BB1-age}
Y_{a[m],k,c,t} ~|~  p_{a[m],k,c,t} \sim \mbox{BetaBinomial}\left(~ n_{a[m],k,c,t}~,~ p_{m,k,c,t}~,d~
\right),
\end{equation}\]</span>
where <span class="math inline">\(p_{m,k,c,t}\)</span> is the monthly hazard at <span class="math inline">\(m\)</span>-th month of age, in cluster <span class="math inline">\(c\)</span>, time <span class="math inline">\(t\)</span>, and survey <span class="math inline">\(k\)</span> and <span class="math inline">\(d\)</span> is the overdispersion parameter.
The latent logistic model we use is,
<span class="math display">\[\begin{align}
p_{m,k,c,t} =&amp; \mbox{expit}( \alpha_{m,c,k,t} +   \epsilon_t + b_k),\\ \nonumber
\alpha_{m,k,c,t} =&amp;
\beta_{a[m],r[k],t}I(s_c \in \mbox{ rural }) +
\gamma_{a[m],r[k],t} I(s_c \in \mbox{ urban }) \\
&amp;\;+
S_{i[s_c]} + e_{i[s_c]}  +\delta_{i[s_c],t} + \mbox{BIAS}_{k,t}.
\label{eq:pred}
\end{align}\]</span></p>
<p>This form consists of a collection of terms that are used for prediction and a number that are not, as we now describe. We include a survey fixed effect <span class="math inline">\(b_k\)</span> with the constraint <span class="math inline">\(\sum_{k} b_k \mathbf{1}_{r[k] = r} = 0\)</span> for each sampling frame <span class="math inline">\(r\)</span>, so that the main temporal trends are identifiable for each sampling frame. The <span class="math inline">\(b_k\)</span> terms are not included in the prediction, i.e., they are set to zero. The <span class="math inline">\(\epsilon_t\)</span> are unstructured temporal effects that allow for perturbations over time. It is a contextual choice whether they are used in predictions. We include terms in (<span class="math inline">\(\ref{eq:pred}\)</span>) that are analogous to those in equations (<span class="math inline">\(\ref{eq:smooth-direct}\)</span>)(<span class="math inline">\(\ref{eq:smooth-direct2}\)</span>), in particular the spatial main effects <span class="math inline">\(S_i\)</span> and <span class="math inline">\(e_i\)</span> and the space-time interactions <span class="math inline">\(\delta_{it}\)</span>.</p>
<p>For the temporal main effects <span class="math inline">\(\beta_{a[m],r[k],t}\)</span> and <span class="math inline">\(\gamma_{a[m],r[k],t}\)</span>, we have stratum-specific distinct trends for each age group <span class="math inline">\(a[m]\)</span> in surveys from each sampling frame. We include separate urban and rural temporal terms to acknowledge the sampling design; often urban clusters are oversampled and have different risk from rural clusters, and so it is important to acknowledge this aspect in the model <span class="citation" data-cites="paige_etal_20">(<a href="#ref-paige_etal_20" role="doc-biblioref">Paige et al. 2020</a>)</span>. The urban-rural stratification effects may also be parameterized as time-invariant fixed effects, i.e., restricting <span class="math inline">\(\beta_{a[m],r[k],t} = \gamma_{a[m],r[k],t} + \Delta_{a[m],r[k]}\)</span>. For a detailed discussion of the parameterization of stratification effects, we refer readers to <span class="citation" data-cites="wu2021spatial">Wu et al. (<a href="#ref-wu2021spatial" role="doc-biblioref">2021</a>)</span>. In addition, it is usually reasonable to assume shared temporal trends up to a constant shift across some age groups. For example, we may let
<span class="math display">\[
    \beta_{a[m],r[k],t} = \beta_{a[m],r[k], 0} + \beta^\star_{a^\star[m], r[k], t}
\]</span>
where <span class="math inline">\(\beta^\star_{a^\star[m], r[k], t}\)</span> is a collection of temporal random effects with sum-to-zero constraint <span class="math inline">\(\sum_{t} \beta^\star_{a^\star[m], r[k], t} = 0\)</span>, and <span class="math inline">\(a^\star[m]\)</span> is a reduced set of age bands. The default choice for U5MR in the package is
<span class="math display">\[\begin{equation}
a^\star[m] = \left\{
\begin{array}{ll}
1 &amp; \mbox{if }m=0,\\
2 &amp; \mbox{if }m=1,\dots,11, \\
3 &amp; \mbox{if }m=12,\dots,59.
\end{array}
\right.
\label{eq:astar}
\end{equation}\]</span>
That is, we assume the temporal trends for logit hazards in the last four age groups are parallel and only differ by the intercept term <span class="math inline">\(\beta_{a[m],r[k], 0}\)</span>.</p>
<p>In situations where biases are known for particular surveys and/or years, we can adjust for bias following <span class="citation" data-cites="wakefield_etal_19">Wakefield et al. (<a href="#ref-wakefield_etal_19" role="doc-biblioref">2019</a>)</span> by including the bias ratio term, <span class="math inline">\(\mbox{BIAS}_{k,t} = \mbox{U5MR}^\star_{t} / \widehat{\mbox{U5MR}}_{k, t}\)</span>, where <span class="math inline">\(\mbox{U5MR}^\star_{t}\)</span> is the expected U5MR in year <span class="math inline">\(t\)</span> and <span class="math inline">\(\widehat{\mbox{U5MR}}_{k, t}\)</span> is the biased version.
This approach has been used to adjust for mothers who have died from AIDS <span class="citation" data-cites="walker_etal_12">(<a href="#ref-walker_etal_12" role="doc-biblioref">Walker et al. 2012</a>)</span>; such mothers cannot be surveyed, and their children are more likely to have died, so the missingness is informative.</p>
<p>The predicted U5MRs in urban and rural regions of area <span class="math inline">\(i\)</span> and at time <span class="math inline">\(t\)</span> according to sampling frame <span class="math inline">\(r\)</span> are,
<span class="math display">\[\begin{eqnarray}\label{eq:U5MR}
\mbox{U5MR}_{i,t,U,r} &amp;=&amp;
1- \prod_{a=1}^6
\left[ \frac{1}{1+\exp(
\beta_{a,r,t}  + S_{i} + e_{i}  +\delta_{i,t}) }\right]^{z[a]}\\
\mbox{U5MR}_{i,t,R,r} &amp;=&amp;
1- \prod_{a=1}^6
\left[ \frac{1}{1+\exp(
\gamma_{a,r,t} + S_{i} + e_{i}  +\delta_{i,t}) }\right]^{z[a]},
\end{eqnarray}\]</span>
where <span class="math inline">\(z[a]=1,11,12,12,12,12\)</span>, for the default choice of age bands.
The aggregate risk in area <span class="math inline">\(i\)</span> and in year <span class="math inline">\(t\)</span> according to sampling frame <span class="math inline">\(r\)</span> is
<span class="math display">\[\begin{equation}\label{eq:agg2}
p_{itr} = q_{itr}\times \mbox{U5MR}_{i,t,U,r} + (1-q_{itr})\times  \mbox{U5MR}_{i,t,R,r},
\end{equation}\]</span>
where <span class="math inline">\(q_{itr}\)</span> and <span class="math inline">\(1-q_{itr}\)</span> are the proportions of the under-5 population in area <span class="math inline">\(i\)</span> that are urban and rural in year <span class="math inline">\(t\)</span> according to the classification of sampling frame <span class="math inline">\(r\)</span>. The final aggregation over different sampling frames can be done using meta-analysis combination, so that,
<span class="math display">\[
\widehat{\mbox{U5MR}}_{it} = \mbox{expit}\left(\sum_r w_{itr} \times \mbox{logit}(p_{itr})\right),
\]</span>
where <span class="math inline">\(w_{itr}=U_{itr}^{-1}/\sum_{r&#39;} U_{itr&#39;}^{-1}\)</span> is the scaled inverse of <span class="math inline">\(U_{itr}\)</span>, which is the posterior variance of <span class="math inline">\(\mbox{logit}(\widehat{\mbox{U5MR}}_{it}^{(r)})\)</span>. Beyond point estimates, we obtain the full posterior of <span class="math inline">\(\mbox{U5MR}_{it}\)</span>, and various summaries can be reported or mapped. The estimate constructed for U5MR is not relevant to any child, because that child would have to experience the hazards for each age group simultaneously in time period <span class="math inline">\(t\)</span>, rather than moving through age groups over multiple time periods. Nevertheless, the resultant U5MR is a useful summary and the conventional measure that is used to inform on child mortality.</p>
<!------------------------------------------------------------------>
<!------------------------------------------------------------------>
<h2 data-number="3" id="sec:summer-overview"><span class="header-section-number">3</span> Overview of SUMMER</h2>
<p>The <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package provides a collection of functions for SAE with complex survey data. The package can be installed in R directly by</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/utils/install.packages.html'>install.packages</a></span><span class='op'>(</span><span class='st'>"SUMMER"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package requires the <a href="#">INLA</a> package <span class="citation" data-cites="rue_etal_09">(<a href="#ref-rue_etal_09" role="doc-biblioref">Rue et al. 2009</a>)</span> to be installed. All analyses in this package are conducted with <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package version <span class="math inline">\(1.4.0\)</span> and <a href="#">INLA</a> version <span class="math inline">\(24.03.09\)</span>. <a href="#">INLA</a> can be installed with</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span>  <span class='fu'><a href='https://rdrr.io/r/utils/install.packages.html'>install.packages</a></span><span class='op'>(</span><span class='st'>"INLA"</span>, repos<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"repos"</span><span class='op'>)</span>,</span>
<span>                    INLA<span class='op'>=</span><span class='st'>"https://inla.r-inla-download.org/R/stable"</span><span class='op'>)</span>, dep<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package implements a variety of space-time smoothing models using survey data. There are three main functions to implement these models, discussed below and in the three examples in the following sections.</p>
<ul>
<li><code>smoothSurvey()</code> produces direct and Fay-Herriot estimates for a generic binary indicator from raw survey data.</li>
<li><code>smoothDirect()</code> takes direct estimates as input and produces the Fay-Herriot estimates for mortality estimation discussed in <span class="citation" data-cites="li_etal_19">Li et al. (<a href="#ref-li_etal_19" role="doc-biblioref">2019</a>)</span>.</li>
<li><code>smoothCluster()</code> performs cluster-level smoothing using the Beta-Binomial model discussed in the previous section, and with more details discussed in <span class="citation" data-cites="wu2021spatial">Wu et al. (<a href="#ref-wu2021spatial" role="doc-biblioref">2021</a>)</span> and <span class="citation" data-cites="fuglstad2021two">Fuglstad et al. (<a href="#ref-fuglstad2021two" role="doc-biblioref">2021</a>)</span>.</li>
</ul>
<p>We note that <code>smoothDirect()</code> and <code>smoothCluster()</code> include many more features in modeling composite indicators such as child mortality. In comparison, <code>smoothSurvey()</code> can only model generic binary indicators, but it has a simpler interface and workflow, which is appealing for broader communities of practitioners.</p>
<p>The main sources of data required for these methods are the survey data and the corresponding spatial adjacency matrix, which can be derived from spatial polygons data describing region boundaries. For cluster-level modeling, we also need to know which region each cluster belongs to. In the context of modeling DHS data, the survey data and cluster locations are usually recorded in separate files. Figure [<a href="#fig:workflow">1</a>] shows schematically the workflow of data processing and smoothing for generic binary indicators and mortality estimates using the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package. In this paper, our workflow starts with the birth records and GPS files in .dta files as an example. Such files can be directly downloaded from the DHS data portal. It is also straightforward to load data in other formats and supply the R objects into the functions. The entire pipeline of analysis can be carried out using functions in <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a>. The analysis of the main paper can be reproduced without registering for data access. We include a more extensive analysis of DHS data in the supplementary materials, which requires registration with DHS program for data access.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:workflow"></span>
<img src="Figures/Workflow.png" alt="Workflow of the SUMMER package. Rounded blocks represent data types and rectangular blocks represent functions in the SUMMER package. Output estimates are highlighted in the boxes with red borders. The dotted yellow arrows represent the workflow using \texttt{smoothSurvey()} to estimate the prevalence of a generic binary indicator. The black solid arrows represent the workflow using \texttt{smoothDirect()} to perform area-level smoothing of mortality rates. The blue solid arrows represent the workflow using \texttt{smoothCluster()} to perform cluster-level smoothing of mortality rates." width="100%"  />
<p class="caption">
Figure 1: Workflow of the SUMMER package. Rounded blocks represent data types and rectangular blocks represent functions in the SUMMER package. Output estimates are highlighted in the boxes with red borders. The dotted yellow arrows represent the workflow using to estimate the prevalence of a generic binary indicator. The black solid arrows represent the workflow using to perform area-level smoothing of mortality rates. The blue solid arrows represent the workflow using to perform cluster-level smoothing of mortality rates.
</p>
</div>
</div>
<p>Before demonstrating the utilities of these functions in the following examples, we first load the packages for the analysis, data processing and visualization. For the analysis presented in this paper, we use the <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> package <span class="citation" data-cites="wickham_ggplot2">(<a href="#ref-wickham_ggplot2" role="doc-biblioref">Wickham 2016</a>)</span> and <a href="https://cran.r-project.org/package=patchwork">patchwork</a> package <span class="citation" data-cites="patchwork">(<a href="#ref-patchwork" role="doc-biblioref">Pedersen 2019</a>)</span> to make further customizations to the visualization produced by <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/richardli/SUMMER'>SUMMER</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 data-number="4" id="example-1-prevalence-estimation-for-a-binary-indicator"><span class="header-section-number">4</span> Example 1: prevalence estimation for a binary indicator</h2>
<p>We start by considering the simplest scenario of estimating the prevalence of a binary indicator using a dataset from the Behavioral Risk Factor Surveillance System (BRFSS) survey. BRFSS is an annual telephone health survey conducted by the Centers for Disease Control and Prevention (CDC) that tracks health conditions and risk behaviors in the United States and its territories since 1984. The BRFSS sampling scheme is complex, with high variability in the sampling weights. In this example, we estimate the prevalence of Type II diabetes in health reporting areas (HRAs) in the King County of Washington using BRFSS data. We will compare the direct estimates and the Fay-Herriot estimates.</p>
<p>The <code>BRFSS</code> dataset in <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> contains the full BRFSS dataset with <span class="math inline">\(16,283\)</span> observations. The <code>diab2</code> variable is the binary indicator of Type II diabetes, <code>strata</code> is the strata indicator, and <code>rwt_llcp</code> is the final design weight. For the purpose of this analysis, we first remove records with missing HRA codes or diabetes status from this dataset.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>BRFSS</span><span class='op'>)</span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>BRFSS</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>diab2</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hracode</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The <code>KingCounty</code> dataset in <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> contains the map of the HRAs in the King County. We first extract the spatial adjacency matrix for the HRAs using the <code>getAmat()</code> function.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>KingCounty</span><span class='op'>)</span></span>
<span><span class='va'>KingGraph</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://richardli.github.io/SUMMER/reference/getAmat.html'>getAmat</a></span><span class='op'>(</span><span class='va'>KingCounty</span>, <span class='va'>KingCounty</span><span class='op'>$</span><span class='va'>HRA2010v2_</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We then use the <code>smoothSurvey()</code> function to obtain both the direct and Fay-Herriot estimates by HRA. The function requires specifications of the variables that determine the survey design, including sampling weights (<code>weightVar</code>), strata indicator (<code>strataVar</code>), and cluster identifiers (<code>clusterVar</code>). In this dataset, there are no clusters so we use the formula <code>~1</code> in this situation <span class="citation" data-cites="lumley2004analysis">(<a href="#ref-lumley2004analysis" role="doc-biblioref">Lumley 2004</a>)</span>. We also need to specify region indicators (<code>regionVar</code>) in the data frame that match the column and row names of the spatial adjacency matrix.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>fit.BRFSS</span> <span class='op'>&lt;-</span> <span class='fu'>smoothSurvey</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>data</span>, Amat <span class='op'>=</span> <span class='va'>KingGraph</span>, </span>
<span>              response.type <span class='op'>=</span> <span class='st'>"binary"</span>, responseVar <span class='op'>=</span> <span class='st'>"diab2"</span>, </span>
<span>              strataVar<span class='op'>=</span><span class='st'>"strata"</span>, weightVar<span class='op'>=</span><span class='st'>"rwt_llcp"</span>, </span>
<span>              regionVar<span class='op'>=</span><span class='st'>"hracode"</span>, clusterVar <span class='op'>=</span> <span class='st'>"~1"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>fit.BRFSS</span><span class='op'>$</span><span class='va'>direct</span>, n <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>        region direct.est direct.var direct.logit.est
1 Auburn-North       0.10    0.00046             -2.2
2 Auburn-South       0.23    0.00240             -1.2
3      Ballard       0.07    0.00050             -2.6
  direct.logit.var direct.logit.prec
1            0.053              18.8
2            0.075              13.3
3            0.115               8.7</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>fit.BRFSS</span><span class='op'>$</span><span class='va'>smooth</span>, n <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>        region  mean     var median lower upper logit.mean logit.var
1 Auburn-North 0.102 0.00026  0.101 0.074 0.137       -2.2     0.031
2 Auburn-South 0.160 0.00092  0.157 0.109 0.227       -1.7     0.051
3      Ballard 0.059 0.00018  0.057 0.037 0.089       -2.8     0.057
  logit.median logit.lower logit.upper
1         -2.2        -2.5        -2.5
2         -1.7        -2.1        -2.1
3         -2.8        -3.3        -3.3</code></pre>
</div>
<p>The fitted object is of class <code>SUMMERmodel.svy</code>, and the direct (<code>$direct</code>) and Fay-Herriot estimates (<code>$smooth</code>) are saved as data frames in the fitted objects. Notice that since the analysis is performed on the logit of the prevalence, estimates on both the logit and the probability scales are returned in the output. We use the <code>mapPlot()</code> function in <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> to show the estimates on a map. In essence, the <code>mapPlot()</code> function takes a data frame, a <code>SpatialPolygonsDataFrame</code> object, the column names indexing regions in both the data frame and the polygons, and returns a <code>ggplot</code> object. Additional function arguments are available to more easily customize the visualizations. Figure [<a href="#fig:brfss-4">2</a>] compares the point estimates on the map and the effect of spatial smoothing can be easily seen.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>g1</span> <span class='op'>&lt;-</span> <span class='fu'>mapPlot</span><span class='op'>(</span><span class='va'>fit.BRFSS</span><span class='op'>$</span><span class='va'>direct</span>, geo <span class='op'>=</span> <span class='va'>KingCounty</span>, </span>
<span>        by.data <span class='op'>=</span> <span class='st'>"region"</span>, by.geo <span class='op'>=</span> <span class='st'>"HRA2010v2_"</span>, </span>
<span>        variables <span class='op'>=</span> <span class='st'>"direct.est"</span>, label <span class='op'>=</span> <span class='st'>"Direct Estimates"</span>, </span>
<span>        legend.label <span class='op'>=</span> <span class='st'>"Prevalence"</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.24</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>g2</span> <span class='op'>&lt;-</span> <span class='fu'>mapPlot</span><span class='op'>(</span><span class='va'>fit.BRFSS</span><span class='op'>$</span><span class='va'>smooth</span>, geo <span class='op'>=</span> <span class='va'>KingCounty</span>, </span>
<span>          by.data <span class='op'>=</span> <span class='st'>"region"</span>, by.geo <span class='op'>=</span> <span class='st'>"HRA2010v2_"</span>, </span>
<span>          variables <span class='op'>=</span> <span class='st'>"median"</span>, label <span class='op'>=</span> <span class='st'>"Fay Herriot Estimates"</span>, </span>
<span>          legend.label <span class='op'>=</span> <span class='st'>"Prevalence"</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.24</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>g1</span> <span class='op'>+</span> <span class='va'>g2</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:brfss-4"></span>
<img src="RJ-2025-005_files/figure-html5/brfss-4-1.png" alt="Direct and Fay-Herriot estimates of the prevalence of Type II diabetes in King county HRAs." width="100%"  />
<p class="caption">
Figure 2: Direct and Fay-Herriot estimates of the prevalence of Type II diabetes in King county HRAs.
</p>
</div>
</div>
<p>Similar analysis can be implemented for Gaussian observations, and can include temporal smoothing or covariates in the smoothing model. The hyperpriors can also be further customized. For more details and examples, we refer the readers to the package documentation under the <code>smoothSurvey()</code> section.</p>
<!----------------------------------------------------------------->
<!----------------------------------------------------------------->
<h2 data-number="5" id="example-2-area-level-model-of-nmr-and-u5mr-using-simulated-data"><span class="header-section-number">5</span> Example 2: area-level model of NMR and U5MR using simulated data</h2>
<p>In the second example, we consider estimating mortality rates using multiple surveys. We use the NMR and U5MR as two examples, but the implementation in the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package allows straightforward extensions to other age groups. We use a simulated survey dataset in this example. A more detailed case study using cluster-level models is provided in the supplementary materials.</p>
<p>We load the <code>DemoData</code> dataset from the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package. The <code>DemoData</code> is a list that contains full birth history data from simulated surveys with stratified cluster sampling design, similar to most of the DHS surveys. It has been pre-processed into the person-month format, where for each list entry, each row represents one person-month record. Each record contains columns for the cluster ID (<code>clustid</code>), household ID (<code>id</code>), strata membership (<code>strata</code>) and survey weights (<code>weights</code>). The region and time period associated with each person-month record has also been pre-computed. The age variable in this data frame is in the form of <span class="math inline">\(a_1\)</span>-<span class="math inline">\(a_2\)</span>, i.e., <span class="math inline">\(1\)</span>-<span class="math inline">\(11\)</span> corresponds to age group with 1 to 11 completed months, whereas age groups with only one month are stored using a single number representation, e.g., age group <span class="math inline">\(0\)</span>. This is also the data structure in the output of the function in the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package. In all the analyses of this paper, we use the default age bands as described before. If a different set of age bands is desired, they can be specified by the <code>month.cut</code> argument in the function.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>DemoData</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>DemoData</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  clustid id  region  time  age weights        strata died
1       1  1 eastern 00-04    0     1.1 eastern.rural    0
2       1  1 eastern 00-04 1-11     1.1 eastern.rural    0
3       1  1 eastern 00-04 1-11     1.1 eastern.rural    0
4       1  1 eastern 00-04 1-11     1.1 eastern.rural    0
5       1  1 eastern 00-04 1-11     1.1 eastern.rural    0
6       1  1 eastern 00-04 1-11     1.1 eastern.rural    0</code></pre>
</div>
<p>In order to compute NMR, we create a new list of surveys with only deaths within age group <span class="math inline">\(0\)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>DemoDataNMR</span> <span class='op'>&lt;-</span> <span class='va'>DemoData</span></span>
<span><span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>DemoData</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>  <span class='va'>DemoDataNMR</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>DemoData</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>, <span class='va'>age</span> <span class='op'>==</span> <span class='st'>"0"</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<p>We now turn to the estimation of NMR and U5MR using four simulated surveys in <code>DemoData</code>. For multiple surveys, we combine the person-month records into a list and use the <code>getDirectList()</code> function to obtain the survey-specific direct estimates. When there are no deaths in a given area and time period, or when more than half of the age groups do not exist in the person-month data, the direct estimates cannot be reliably computed and are set to NA. When only a small fraction of the age groups are not observed, they will be combined with the previous age groups when fitting the discrete hazard model.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>periods</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"85-89"</span>, <span class='st'>"90-94"</span>, <span class='st'>"95-99"</span>, <span class='st'>"00-04"</span>, <span class='st'>"05-09"</span>, <span class='st'>"10-14"</span><span class='op'>)</span></span>
<span><span class='va'>directNMR</span> <span class='op'>&lt;-</span> <span class='fu'>getDirectList</span><span class='op'>(</span>births <span class='op'>=</span> <span class='va'>DemoDataNMR</span>, years <span class='op'>=</span> <span class='va'>periods</span>, </span>
<span>                  regionVar <span class='op'>=</span> <span class='st'>"region"</span>, timeVar <span class='op'>=</span> <span class='st'>"time"</span>, </span>
<span>                  clusterVar <span class='op'>=</span> <span class='st'>"~clustid + id"</span>, ageVar <span class='op'>=</span> <span class='st'>"age"</span>, </span>
<span>                  weightsVar <span class='op'>=</span> <span class='st'>"weights"</span><span class='op'>)</span></span>
<span><span class='va'>directU5</span> <span class='op'>&lt;-</span> <span class='fu'>getDirectList</span><span class='op'>(</span>births <span class='op'>=</span> <span class='va'>DemoData</span>, years <span class='op'>=</span> <span class='va'>periods</span>, </span>
<span>              regionVar <span class='op'>=</span> <span class='st'>"region"</span>, timeVar <span class='op'>=</span> <span class='st'>"time"</span>, </span>
<span>              clusterVar <span class='op'>=</span> <span class='st'>"~clustid + id"</span>, ageVar <span class='op'>=</span> <span class='st'>"age"</span>, </span>
<span>              weightsVar <span class='op'>=</span> <span class='st'>"weights"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The direct estimates from multiple surveys can be combined to produce a meta-analysis estimator using the <code>aggregateSurvey()</code> function.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>directNMR.comb</span> <span class='op'>&lt;-</span> <span class='fu'>aggregateSurvey</span><span class='op'>(</span><span class='va'>directNMR</span><span class='op'>)</span></span>
<span><span class='va'>directU5.comb</span> <span class='op'>&lt;-</span> <span class='fu'>aggregateSurvey</span><span class='op'>(</span><span class='va'>directU5</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Once the direct estimates are calculated, we fit the space-time Fay-Herriot model in the same fashion as in the previous example. The argument <code>year.label</code> specifies the order of the years column in the direct estimates, so that it does not have to be integer valued, and can easily allow extensions to future and past time periods not in the data. We can also fit the temporal model at the yearly level even though the direct estimates are in five year periods <span class="citation" data-cites="li_etal_19">(<a href="#ref-li_etal_19" role="doc-biblioref">Li et al. 2019</a>)</span>. In this case, we need to specify the proper range of the time periods (<code>year_range</code>) encoded by the time periods in <code>year.label</code>, and the number of years in each period (<code>m</code>). Unequal periods are not supported at this time. The <code>smoothDirect()</code> function returns a fitted object of class <code>SUMMERmodel</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>fhNMR</span> <span class='op'>&lt;-</span> <span class='fu'>smoothDirect</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>directNMR.comb</span>, Amat <span class='op'>=</span> <span class='va'>DemoMap</span><span class='op'>$</span><span class='va'>Amat</span>, </span>
<span>              year.label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>periods</span>, <span class='st'>"15-19"</span><span class='op'>)</span>, year.range <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1985</span>, <span class='fl'>2019</span><span class='op'>)</span>, </span>
<span>              time.model <span class='op'>=</span> <span class='st'>"rw2"</span>, type.st <span class='op'>=</span> <span class='fl'>4</span>, is.yearly <span class='op'>=</span> <span class='cn'>TRUE</span>, m <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span><span class='va'>fhU5</span> <span class='op'>&lt;-</span> <span class='fu'>smoothDirect</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>directU5.comb</span>, Amat <span class='op'>=</span> <span class='va'>DemoMap</span><span class='op'>$</span><span class='va'>Amat</span>, </span>
<span>              year.label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>periods</span>, <span class='st'>"15-19"</span><span class='op'>)</span>, year.range <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1985</span>, <span class='fl'>2019</span><span class='op'>)</span>, </span>
<span>              time.model <span class='op'>=</span> <span class='st'>"rw2"</span>, type.st <span class='op'>=</span> <span class='fl'>4</span>, is.yearly <span class='op'>=</span> <span class='cn'>TRUE</span>, m <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The Fay-Herriot estimates can be summarized by the <code>getSmoothed()</code> function. The desired posterior credible intervals are specified by the <code>CI</code> argument. It organizes the estimates into a data frame of class <code>SUMMERproj</code>, which can be directly viewed or plotted using the <code>plot</code> method. Additional customization can be added using the syntax of <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>, as shown in Figure [<a href="#fig:smooth-direct-estimate-2">3</a>].</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>est.NMR</span> <span class='op'>&lt;-</span> <span class='fu'>getSmoothed</span><span class='op'>(</span><span class='va'>fhNMR</span>, CI <span class='op'>=</span> <span class='fl'>0.95</span><span class='op'>)</span></span>
<span><span class='va'>est.U5</span> <span class='op'>&lt;-</span> <span class='fu'>getSmoothed</span><span class='op'>(</span><span class='va'>fhU5</span>, CI <span class='op'>=</span> <span class='fl'>0.95</span><span class='op'>)</span></span>
<span><span class='va'>g3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>est.NMR</span>, per1000 <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"NMR"</span><span class='op'>)</span></span>
<span><span class='va'>g4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>est.NMR</span>, per1000 <span class='op'>=</span> <span class='cn'>TRUE</span>, plot.CI<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span><span class='va'>region</span><span class='op'>)</span></span>
<span><span class='va'>g5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>est.U5</span>, per1000 <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>  <span class='op'>+</span> <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"U5MR"</span><span class='op'>)</span></span>
<span><span class='va'>g6</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>est.U5</span>, per1000 <span class='op'>=</span> <span class='cn'>TRUE</span>, plot.CI<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span><span class='va'>region</span><span class='op'>)</span></span>
<span><span class='op'>(</span><span class='va'>g3</span> <span class='op'>+</span> <span class='va'>g4</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>g5</span> <span class='op'>+</span> <span class='va'>g6</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:smooth-direct-estimate-2"></span>
<img src="RJ-2025-005_files/figure-html5/smooth-direct-estimate-2-1.png" alt="Smoothed direct estimates of NMR (top row) and U5MR (bottom row) on the yearly scale (dots) and 5-year period scale (triangles) in the simulated dataset. The vertical error bars correspond to 95% credible interval of the 5-year estimates. The plots on the left are from the default plot function. The plots on the right show simple customization of the default plots." width="100%"  />
<p class="caption">
Figure 3: Smoothed direct estimates of NMR (top row) and U5MR (bottom row) on the yearly scale (dots) and 5-year period scale (triangles) in the simulated dataset. The vertical error bars correspond to 95% credible interval of the 5-year estimates. The plots on the left are from the default plot function. The plots on the right show simple customization of the default plots.
</p>
</div>
</div>
<h2 data-number="6" id="example-3-cluster-level-model-of-u5mr-using-malawi-dhs-data"><span class="header-section-number">6</span> Example 3: cluster-level model of U5MR using Malawi DHS data</h2>
<p>We now consider a more realistic example of estimating U5MR at the admin-2 level using the 20152016 Malawi DHS survey. The full dataset is available on the DHS website at <a href="https://dhsprogram.com/data/available-datasets.cfm?ctryid=24">https://dhsprogram.com/data/available-datasets.cfm?ctryid=24</a>. Access to the full micro-level data requires registration with the DHS. Once access is approved, the <a href="https://cran.r-project.org/package=rdhs">rdhs</a> <span class="citation" data-cites="rdhs">(<a href="#ref-rdhs" role="doc-biblioref">Watson and Eaton 2019</a>)</span> package can be used to load data directly from the DHS API in R. We document the process to read the raw DHS files and process the birth records in the supplementary materials.</p>
<p>For reproducibility of the examples in this paper, we start with the aggregated count data from the 2015 Malawi DHS. The pre-processed count data is available in the supplementary materials. This aggregated dataset consists of the counts of deaths occurring within each age band and the total number of person-months by cluster and year. This aggregated dataset and the full data acquisition and cleaning steps to obtain this dataset are described in the supplementary materials. The processing steps involve primarily the <code>getBirths()</code> and <code>getCounts()</code> functions and some data cleaning in region names. The supplementary materials also include workflows and results on fitting several other smoothing models on the Malawi DHS data.</p>
<p>Subnational spatial polygon files can usually be found on the DHS spatial data repository <span class="citation" data-cites="dhsspatial">(<a href="#ref-dhsspatial" role="doc-biblioref">The DHS Program 2020</a>)</span> or the GADM database of global administrative areas <span class="citation" data-cites="areas2012gadm">(<a href="#ref-areas2012gadm" role="doc-biblioref">Global Administrative Areas 2012</a>)</span>. The admin-2 region polygon of Malawi is included in the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package already and can be directly loaded.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>MalawiMap</span><span class='op'>)</span></span>
<span><span class='va'>MalawiGraph</span> <span class='op'>=</span> <span class='fu'>getAmat</span><span class='op'>(</span><span class='va'>MalawiMap</span>, names<span class='op'>=</span><span class='va'>MalawiMap</span><span class='op'>$</span><span class='va'>ADM2_EN</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We then load the pre-processed count data and fit the cluster-level model using the <code>smoothCluster()</code> function. We consider the observations from 2007 to 2015 and project the mortality rates to 2019. To simplify results, we fit the unstratified model in this example by removing the <code>strata</code> variable from the data frame or setting it to <code>NA</code>. The supplementary materials contain additional details to fit stratified cluster-level models.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/load.html'>load</a></span><span class='op'>(</span><span class='st'>"Data/DHS_counts.rda"</span><span class='op'>)</span></span>
<span><span class='va'>agg.counts</span><span class='op'>$</span><span class='va'>strata</span> <span class='op'>&lt;-</span> <span class='cn'>NA</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>agg.counts</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>      v001  v025 admin2 time age  v005 died total  survey cluster
55427  696 urban Likoma 2000   0 12778    0     3 DHS2015     696
55428  696 urban Likoma 2001   0 12778    0     4 DHS2015     696
55429  696 urban Likoma 2002   0 12778    0     2 DHS2015     696
55430  696 urban Likoma 2003   0 12778    0     4 DHS2015     696
55431  696 urban Likoma 2004   0 12778    0     3 DHS2015     696
55432  696 urban Likoma 2005   0 12778    0     2 DHS2015     696
      strata region years Y
55427     NA Likoma  2000 0
55428     NA Likoma  2001 0
55429     NA Likoma  2002 0
55430     NA Likoma  2003 0
55431     NA Likoma  2004 0
55432     NA Likoma  2005 0</code></pre>
</div>
<p>Sometimes, additional information is available to adjust the estimates from the surveys. For example, in countries with high prevalence of HIV, estimates of U5MR can be biased, particularly before ART treatment became widely available. Pre-treatment, HIV positive women had a high risk of dying, and such women who had given birth were therefore less likely to appear in surveys. The children of HIV positive women are also more likely to have a higher probability of dying compared to those born to HIV negative women. Hence, we expect that the U5MR is underestimated if we do not adjust for the missing women. For the two surveys in Malawi, the calculated HIV adjustment ratios as described in <span class="citation" data-cites="walker_etal_12">Walker et al. (<a href="#ref-walker_etal_12" role="doc-biblioref">2012</a>)</span> are stored in the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> as <code>MalawiData$HIV.yearly</code>. The unstratified cluster-level model can be fitted using the <code>smoothCluster()</code> function.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>fit.bb</span> <span class='op'>&lt;-</span> <span class='fu'>smoothCluster</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>agg.counts</span>, Amat <span class='op'>=</span> <span class='va'>MalawiGraph</span>, </span>
<span>            family <span class='op'>=</span> <span class='st'>"betabinomial"</span>, year.label <span class='op'>=</span> <span class='fl'>2000</span><span class='op'>:</span><span class='fl'>2019</span>, </span>
<span>            time.model <span class='op'>=</span> <span class='st'>"rw2"</span>, st.time.model <span class='op'>=</span> <span class='st'>"ar1"</span>,</span>
<span>            age.group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"0"</span>, <span class='st'>"1-11"</span>, <span class='st'>"12-23"</span>, <span class='st'>"24-35"</span>, <span class='st'>"36-47"</span>, <span class='st'>"48-59"</span><span class='op'>)</span>,</span>
<span>            age.n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>11</span>, <span class='fl'>12</span>, <span class='fl'>12</span>, <span class='fl'>12</span>, <span class='fl'>12</span><span class='op'>)</span>, </span>
<span>            age.time.group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span>,</span>
<span>            pc.st.slope.u <span class='op'>=</span> <span class='fl'>2</span>, pc.st.slope.alpha <span class='op'>=</span> <span class='fl'>0.1</span>,</span>
<span>            bias.adj <span class='op'>=</span> <span class='va'>MalawiData</span><span class='op'>$</span><span class='va'>HIV.yearly</span>, </span>
<span>            bias.adj.by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"years"</span>, <span class='st'>"survey"</span><span class='op'>)</span>,</span>
<span>            survey.effect <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>When not specified explicitly, the space-time interaction term inherits the same temporal dependency structure defined by <code>time.model</code>. We can use different models for the interaction term by specifying the <code>st.time.model</code> argument. For example, in the model above, we can model the main temporal trends using random walks of order 2, and model the space-time interaction using the interaction of a temporal AR(1) process and an ICAR process in space. To allow each region to have more flexible temporal trends, we add region-specific random slopes to the interaction terms by specifying the priors <code>pc.st.slope.u</code> and <code>pc.st.slope.alpha</code>. These arguments specify that the probability of the absolute temporal change from the shared temporal trend (on the logit scale) over the entire time period exceeding <code>pc.st.slope.u</code> is <code>pc.st.slope.alpha</code>. The <code>age.group</code>, <code>age.n</code> and <code>age.time.group</code> specify the age groups, their corresponding length (in months), and how they are grouped when modeling the temporal trends, i.e., the <span class="math inline">\(\alpha^\star[m]\)</span> term defined before.</p>
<p>After we fit the model, we use the <code>getSmoothed()</code> function to obtain the posterior summaries of the prevalence by taking <code>nsim</code> draws from the posterior distribution. Since for the cluster-level models, the estimates may not be a linear combination of the random effect terms in the case of a composite indicator, the posterior summaries are obtained via posterior samples. For the cluster-level model, the <code>getSmoothed()</code> function returns an object of class <code>SUMMERprojlist</code>, which includes potentially multiple projections for each stratum (<code>$stratified</code>), sampling frame (<code>$overall</code>), and aggregated over different sampling frames (<code>$final</code>) if applicable. In this example, since we fit an unstratified model with only one sampling frame, the estimates stored in <code>est.bb$stratified</code> and <code>est.bb$overall</code> are the same. In addition, by specifying <code>save.draws = TRUE</code>, the full posterior draws are stored, which can be re-used to speed up other functions that require access to posterior samples of internal model parameters.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>est.bb</span> <span class='op'>&lt;-</span>  <span class='fu'>getSmoothed</span><span class='op'>(</span><span class='va'>fit.bb</span>, nsim <span class='op'>=</span> <span class='fl'>1000</span>, save.draws <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> </span></code></pre>
</div>
</div>
<h2 data-number="7" id="visualization-and-model-checking"><span class="header-section-number">7</span> Visualization and model checking</h2>
<p>In addition to the plots shown in the previous sections, the <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package provides a collection of visualization tools to assess model fit and uncertainty in the estimates. Assessment of uncertainty is a key step in analysis as maps of point estimates can be intoxicating, but often hide huge uncertainty, which should temper initial enthusiasm. Most of the visualization options return a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> object, which can be further customized. In this section, we use the fitted models for Malawi 2015  2016 DHS as an example.</p>
<p>The first set of visualizations are the line plots that we have shown before. Figure [<a href="#fig:vis-1">4</a>] shows subnational posterior median U5MR estimates over time for the five northern regions. We also scale the estimates to be deaths per <span class="math inline">\(1,000\)</span> live births using the <code>per1000</code> argument.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>select</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Chitipa"</span>, <span class='st'>"Karonga"</span>, <span class='st'>"Rumphi"</span>, <span class='st'>"Mzimba"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>est.bb</span><span class='op'>$</span><span class='va'>overall</span>, <span class='va'>region</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>select</span><span class='op'>)</span>, per1000 <span class='op'>=</span> <span class='cn'>TRUE</span>, year.proj <span class='op'>=</span> <span class='fl'>2016</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:vis-1"></span>
<img src="RJ-2025-005_files/figure-html5/vis-1-1.png" alt="Subnational temporal trends of U5MR using the 2015--2016 DHS in Malawi in four regions." width="50%"  />
<p class="caption">
Figure 4: Subnational temporal trends of U5MR using the 20152016 DHS in Malawi in four regions.
</p>
</div>
</div>
<p>By default, subnational estimates do not show the intervals to avoid many overlapping vertical bars, but they can be added back with the <code>plot.CI</code> option as illustrated in previous examples. We also compare the smoothed estimates with the pre-computed direct estimates in Figure [<a href="#fig:vis-1b">5</a>], where the shrinkage in point estimates and the reduction in uncertainty intervals can be easily seen. The direct estimate computation is detailed in the supplementary materials.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/load.html'>load</a></span><span class='op'>(</span><span class='st'>"Data/DHS_direct_hiv_adj.rda"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>est.bb</span><span class='op'>$</span><span class='va'>overall</span>, <span class='va'>region</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>select</span><span class='op'>)</span>, per1000 <span class='op'>=</span> <span class='cn'>TRUE</span>, </span>
<span>   year.proj <span class='op'>=</span> <span class='fl'>2016</span>, plot.CI <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>   data.add <span class='op'>=</span> <span class='va'>direct.2015.hiv</span>, label.add <span class='op'>=</span> <span class='st'>"Direct Estimates"</span>, </span>
<span>   option.add <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>point <span class='op'>=</span> <span class='st'>"mean"</span>, lower <span class='op'>=</span> <span class='st'>"lower"</span>, upper <span class='op'>=</span> <span class='st'>"upper"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span><span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span><span class='va'>region</span>, ncol <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:vis-1b"></span>
<img src="RJ-2025-005_files/figure-html5/vis-1b-1.png" alt="Comparing subnational temporal trends of U5MR under cluster-level model and direct estimates, using the 2015--2016 DHS in Malawi in four regions." width="100%"  />
<p class="caption">
Figure 5: Comparing subnational temporal trends of U5MR under cluster-level model and direct estimates, using the 20152016 DHS in Malawi in four regions.
</p>
</div>
</div>
<p>The <code>mapPlot()</code> function visualizes the estimates on a map. The estimates, <code>est.bb$overall</code>, are in the long format where estimates of each year and period are stacked. This is specified with the <code>is.long</code> argument. Figure [<a href="#fig:vis-2">6</a>] maps the changes over time. The drops in U5MR in all regions are apparent, though there is great spatial heterogeneity.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>year.plot</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"2007"</span>, <span class='st'>"2010"</span>, <span class='st'>"2013"</span>, <span class='st'>"2016"</span>, <span class='st'>"2019"</span><span class='op'>)</span></span>
<span><span class='fu'>mapPlot</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>est.bb</span><span class='op'>$</span><span class='va'>overall</span>, <span class='va'>years</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>year.plot</span><span class='op'>)</span>, </span>
<span>    geo <span class='op'>=</span> <span class='va'>MalawiMap</span>, by.data <span class='op'>=</span> <span class='st'>"region"</span>, by.geo <span class='op'>=</span> <span class='st'>"ADM2_EN"</span>, </span>
<span>    is.long <span class='op'>=</span> <span class='cn'>TRUE</span>, variables <span class='op'>=</span> <span class='st'>"years"</span>, values <span class='op'>=</span> <span class='st'>"median"</span>, </span>
<span>    ncol <span class='op'>=</span> <span class='fl'>5</span>, direction <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>, per1000 <span class='op'>=</span> <span class='cn'>TRUE</span>, legend.label <span class='op'>=</span> <span class='st'>"U5MR"</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:vis-2"></span>
<img src="RJ-2025-005_files/figure-html5/vis-2-1.png" alt="Spatial distribution of U5MR using the 2015--2016 DHS in Malawi over selected years." width="100%"  />
<p class="caption">
Figure 6: Spatial distribution of U5MR using the 20152016 DHS in Malawi over selected years.
</p>
</div>
</div>
<p>The <code>hatchPlot()</code> function plots additional hatching lines on the map indicating the width of the uncertainty intervals. Denser hatching lines represent higher uncertainty. Usually, estimates of the early years have higher uncertainty, as shown in Figure [<a href="#fig:vis-3">7</a>]. It also clearly shows the increase in uncertainty in the projections. We also note that both <code>mapPlot()</code> and <code>hatchPlot()</code> functions can be used in broader cases as they provide a general tool to visualize rectangular data on a map.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'>hatchPlot</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>est.bb</span><span class='op'>$</span><span class='va'>overall</span>, <span class='va'>years</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>year.plot</span><span class='op'>)</span>, </span>
<span>      geo <span class='op'>=</span> <span class='va'>MalawiMap</span>, by.data <span class='op'>=</span> <span class='st'>"region"</span>, by.geo <span class='op'>=</span> <span class='st'>"ADM2_EN"</span>, </span>
<span>      is.long <span class='op'>=</span> <span class='cn'>TRUE</span>, variables <span class='op'>=</span> <span class='st'>"years"</span>, values <span class='op'>=</span> <span class='st'>"median"</span>, </span>
<span>      lower <span class='op'>=</span> <span class='st'>"lower"</span>, upper <span class='op'>=</span> <span class='st'>"upper"</span>, hatch <span class='op'>=</span> <span class='st'>"red"</span>,</span>
<span>      ncol <span class='op'>=</span> <span class='fl'>5</span>, direction <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>, per1000 <span class='op'>=</span> <span class='cn'>TRUE</span>, legend.label <span class='op'>=</span> <span class='st'>"U5MR"</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:vis-3"></span>
<img src="RJ-2025-005_files/figure-html5/vis-3-1.png" alt="Subnational estimates of U5MR using the 2015--2016 DHS in Malawi over selected years, with hatching lines indicating the width of the 95\% credible intervals of the estimates. Denser hatching correspond to higher uncertainty. Estimates for 2019 in the last column are from the model projection and thus have higher uncertainty." width="100%"  />
<p class="caption">
Figure 7: Subnational estimates of U5MR using the 20152016 DHS in Malawi over selected years, with hatching lines indicating the width of the 95% credible intervals of the estimates. Denser hatching correspond to higher uncertainty. Estimates for 2019 in the last column are from the model projection and thus have higher uncertainty.
</p>
</div>
</div>
<p>The <code>ridgePlot()</code> function provides another visual comparison of the estimates and their associated uncertainty. Figure [<a href="#fig:vis-4">8</a>] shows one such example where the marginal posterior densities of the estimates in the selected years are plotted with regions sorted by their posterior medians in the last plotted period. The posterior densities can also be grouped with all estimates in each region plotted in the same panel using the <code>by.year = FALSE</code> argument in the <code>ridgePlot()</code> function. These plots are particularly useful to quickly identify regions with high and low estimates, while also showing the uncertainties associated with the rankings as well. The ranking of areas is often an important endeavor, since it can inform interventions in areas that are performing poorly or, more optimistically, allow areas with better outcomes to be examined to see if covariates (for example) are explaining their more positive performance.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'>ridgePlot</span><span class='op'>(</span>draws <span class='op'>=</span> <span class='va'>est.bb</span>, Amat <span class='op'>=</span> <span class='va'>MalawiGraph</span>, year.plot <span class='op'>=</span> <span class='va'>year.plot</span>,</span>
<span>      ncol <span class='op'>=</span> <span class='fl'>5</span>, per1000 <span class='op'>=</span> <span class='cn'>TRUE</span>, order <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>, direction <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>xlim</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>200</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:vis-4"></span>
<img src="RJ-2025-005_files/figure-html5/vis-4-1.png" alt="Posterior densities of the subnational estimates of U5MR using the 2015--2016 DHS in Malawi over selected years. Admin-2 regions are ordered by their median estimates in 2019. Estimates for 2019 in the last column are from the model projection and thus have higher uncertainty." width="100%"  />
<p class="caption">
Figure 8: Posterior densities of the subnational estimates of U5MR using the 20152016 DHS in Malawi over selected years. Admin-2 regions are ordered by their median estimates in 2019. Estimates for 2019 in the last column are from the model projection and thus have higher uncertainty.
</p>
</div>
</div>
<p>Finally, as models get more complicated, it becomes increasingly important to examine the estimated random effects for idiosyncratic behavior that may be evidence of model misspecification. The <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package provides tools to easily extract and plot posterior marginal distributions for each of the random effect components. We can use the <code>getDiag()</code> function to extract the posterior marginal distributions of the spatial, temporal, and space-time interaction terms from the fitted models, which can then be plotted in a similar fashion as the estimates. The space-time interaction term in the fitted model contains a sum of a region-specific linear trend and an AR(1) random effect. Thus, we need posterior samples to compute their marginal distributions. We can feed the saved posterior draws from the <code>est.bb</code> here to speed up the computation.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>r.time</span> <span class='op'>&lt;-</span> <span class='fu'>getDiag</span><span class='op'>(</span><span class='va'>fit.bb</span>, field <span class='op'>=</span> <span class='st'>"time"</span><span class='op'>)</span></span>
<span><span class='va'>r.space</span> <span class='op'>&lt;-</span> <span class='fu'>getDiag</span><span class='op'>(</span><span class='va'>fit.bb</span>, field <span class='op'>=</span> <span class='st'>"space"</span><span class='op'>)</span></span>
<span><span class='va'>r.interact</span> <span class='op'>&lt;-</span> <span class='fu'>getDiag</span><span class='op'>(</span><span class='va'>fit.bb</span>, field <span class='op'>=</span> <span class='st'>"spacetime"</span>, draws <span class='op'>=</span> <span class='va'>est.bb</span><span class='op'>$</span><span class='va'>draws</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The extracted posterior summaries of the random effects can then be examined and visualized. Figure [<a href="#fig:check-2">9</a>] shows the posterior summaries of the temporal, spatial, and interaction terms in the model.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>g.time</span> <span class='op'>&lt;-</span> <span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>r.time</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>years</span>, y <span class='op'>=</span> <span class='va'>median</span>, ymin<span class='op'>=</span><span class='va'>lower</span>, ymax<span class='op'>=</span><span class='va'>upper</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>         <span class='fu'>geom_line</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>         <span class='fu'>geom_ribbon</span><span class='op'>(</span>color<span class='op'>=</span><span class='cn'>NA</span>, <span class='fu'>aes</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>         <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span><span class='va'>group</span>, ncol <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>         <span class='fu'>theme_bw</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>         <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Age-specific Temporal effects"</span><span class='op'>)</span></span>
<span><span class='va'>g.space</span> <span class='op'>&lt;-</span> <span class='fu'>mapPlot</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>r.space</span>, label <span class='op'>=</span> <span class='st'>"Total"</span><span class='op'>)</span>, </span>
<span>           geo<span class='op'>=</span><span class='va'>MalawiMap</span>, by.data<span class='op'>=</span><span class='st'>"region"</span>, by.geo <span class='op'>=</span> <span class='st'>"ADM2_EN"</span>, </span>
<span>           direction <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>, variables<span class='op'>=</span><span class='st'>"median"</span>, </span>
<span>           removetab<span class='op'>=</span><span class='cn'>TRUE</span>, legend.label <span class='op'>=</span> <span class='st'>"Effect"</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>       <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Spatial effects"</span><span class='op'>)</span> </span>
<span><span class='va'>g.interact</span> <span class='op'>&lt;-</span> <span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>r.interact</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>years</span>, y <span class='op'>=</span> <span class='va'>median</span>, group<span class='op'>=</span><span class='va'>region</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>           <span class='fu'>geom_line</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>  <span class='fu'>ggtitle</span><span class='op'>(</span><span class='st'>"Interaction effects"</span><span class='op'>)</span> </span>
<span><span class='va'>g.time</span> <span class='op'>+</span> <span class='va'>g.space</span> <span class='op'>+</span> <span class='va'>g.interact</span> <span class='op'>+</span> <span class='fu'>plot_layout</span><span class='op'>(</span>widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> </span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:check-2"></span>
<img src="RJ-2025-005_files/figure-html5/check-2-1.png" alt="Posterior medians for the random effect terms in the cluster-level model using Malawi 2015--2016 DHS. Left: posterior medians and 95\% credible intervals of the age-specific temporal effects and the IID temporal shocks. Middle: posterior medians of the spatial effects. Right: posterior medians of the space-time interaction effects." width="100%"  />
<p class="caption">
Figure 9: Posterior medians for the random effect terms in the cluster-level model using Malawi 20152016 DHS. Left: posterior medians and 95% credible intervals of the age-specific temporal effects and the IID temporal shocks. Middle: posterior medians of the spatial effects. Right: posterior medians of the space-time interaction effects.
</p>
</div>
</div>
<h2 data-number="8" id="discussion"><span class="header-section-number">8</span> Discussion</h2>
<p>The present paper aims to provide a general overview of the R package <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> for space-time smoothing of demographic and health indicators. The particular focus of this paper is on mortality estimation and the demonstration of the workflow for practitioners to fit flexible Bayesian smoothing models with DHS data. The implementation using <a href="#">INLA</a> allows fast computation of these smoothing models. The Fay-Herriot estimates can usually be fit within seconds to minutes depending on the number of regions and time period. The cluster-level model may require longer computation time, especially with surveys containing many samples. We leave the fitting of more time-consuming models in the supplementary materials.</p>
<p>The <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> package is in constant development. This paper introduces the core functionalities of the package. There are many more functionalities to tackle application-specific issues, such as different age-time interactions, aggregation over urban/rural strata, benchmarking to external national estimates, etc. We are also expanding the package to include more options for the traditional SAE models with fast implementations built on our current computational framework. Recent extensions built on <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a> functionalities include the recent addition of SAE methods in the <a href="https://cran.r-project.org/package=survey">survey</a> package <span class="citation" data-cites="survey44">(<a href="#ref-survey44" role="doc-biblioref">Lumley 2024</a>)</span> and the <a href="https://cran.r-project.org/package=surveyPrev">surveyPrev</a> package <span class="citation" data-cites="surveyPrev">(<a href="#ref-surveyPrev" role="doc-biblioref">Dong et al. 2024</a>)</span> which provides a general pipeline to download, process, and map a broad variety of DHS indicators.</p>
<p>In the future, we have several plans to improve the functionality of <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a>. In the cluster-level model, we would like to allow different overdispersion parameters for different age groups. We plan to incorporate methods for child mortality estimation using summary birth history data <span class="citation" data-cites="hill_etal_15 wilson2021child">(<a href="#ref-hill_etal_15" role="doc-biblioref">Hill et al. 2015</a>; <a href="#ref-wilson2021child" role="doc-biblioref">Wilson and Wakefield 2021</a>)</span> in which women provide only information on the number of children born, and number died, without the dates of these events. We also expect to extend the core functionalities to model other demographic and health indicators such as fertility. In our examples in this paper, we did not include covariates. In both the area-level and the cluster-level models, covariates can be included; see <span class="citation" data-cites="wakefield_okonek_pedersen_20">Wakefield et al. (<a href="#ref-wakefield_okonek_pedersen_20" role="doc-biblioref">2020</a>)</span> for an example in the context of HIV prevalence mapping in Malawi. Finally, in the long term, we would like to incorporate continuous spatial models as well.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h3 class="appendix" data-number="8.1" id="supplementary-materials"><span class="header-section-number">8.1</span> Supplementary materials</h3>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2025-005.zip">RJ-2025-005.zip</a></p>
<h3 class="appendix" data-number="8.2" id="cran-packages-used"><span class="header-section-number">8.2</span> CRAN packages used</h3>
<p><a href="https://cran.r-project.org/package=sae">sae</a>, <a href="https://cran.r-project.org/package=rsae">rsae</a>, <a href="https://cran.r-project.org/package=hbsae">hbsae</a>, <a href="https://cran.r-project.org/package=BayesSAE">BayesSAE</a>, <a href="https://cran.r-project.org/package=msae">msae</a>, <a href="https://cran.r-project.org/package=SUMMER">SUMMER</a>, <a href="https://cran.r-project.org/package=survey">survey</a>, <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>, <a href="https://cran.r-project.org/package=patchwork">patchwork</a>, <a href="https://cran.r-project.org/package=rdhs">rdhs</a>, <a href="https://cran.r-project.org/package=surveyPrev">surveyPrev</a></p>
<h3 class="appendix" data-number="8.3" id="cran-task-views-implied-by-cited-packages"><span class="header-section-number">8.3</span> CRAN Task Views implied by cited packages</h3>
<p><a href="https://cran.r-project.org/view=Bayesian">Bayesian</a>, <a href="https://cran.r-project.org/view=ChemPhys">ChemPhys</a>, <a href="https://cran.r-project.org/view=NetworkAnalysis">NetworkAnalysis</a>, <a href="https://cran.r-project.org/view=OfficialStatistics">OfficialStatistics</a>, <a href="https://cran.r-project.org/view=Phylogenetics">Phylogenetics</a>, <a href="https://cran.r-project.org/view=Spatial">Spatial</a>, <a href="https://cran.r-project.org/view=Survival">Survival</a>, <a href="https://cran.r-project.org/view=TeachingStatistics">TeachingStatistics</a></p>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-alkema_new_14" class="csl-entry" role="listitem">
L. Alkema and J. R. New. Global estimation of child mortality using a <span>Bayesian</span> <span>B</span>-spline bias-reduction model. <em>The Annals of Applied Statistics</em>, 8: 21222149, 2014.
</div>
<div id="ref-besagbayesian" class="csl-entry" role="listitem">
J. Besag, J. York and A. Molli. <span>Bayesian</span> image restoration, with two applications in spatial statistics (with discussion). <em>Annals of the Institute of Statistical Mathematics</em>, 43: 159, 1991.
</div>
<div id="ref-binder_83" class="csl-entry" role="listitem">
D. A. Binder. On the variances of asymptotically normal estimators from complex surveys. <em>International Statistical Review</em>, 51: 279292, 1983.
</div>
<div id="ref-hbsae" class="csl-entry" role="listitem">
H. J. Boonstra. <em>Hbsae: Hierarchical <span>Bayesian</span> small area estimation.</em> 2012. R package version 1.0.
</div>
<div id="ref-surveyPrev" class="csl-entry" role="listitem">
Q. Dong, Z. R. Li, Y. Wu, A. Boskovic and J. Wakefield. <em><span class="nocase">surveyPrev</span>: Mapping the prevalence of binary indicators using survey data in small areas.</em> 2024. URL <a href="https://CRAN.R-project.org/package=surveyPrev">https://CRAN.R-project.org/package=surveyPrev</a>. R package version 1.0.0.
</div>
<div id="ref-dong_wakefield_20" class="csl-entry" role="listitem">
T. Q. Dong and J. Wakefield. Modeling and presentation of vaccination coverage estimates using data from household surveys. <em>Vaccine</em>, 39(18): 25842594, 2021.
</div>
<div id="ref-fay_herriot_79" class="csl-entry" role="listitem">
R. E. Fay and R. A. Herriot. Estimates of income for small places: An application of <span>JamesStein</span> procedure to census data. <em>Journal of the American Statistical Association</em>, 74: 269277, 1979.
</div>
<div id="ref-fuglstad2021two" class="csl-entry" role="listitem">
G.-A. Fuglstad, Z. R. Li and J. Wakefield. The two cultures for prevalence mapping: Small area estimation and spatial statistics. <em>arXiv preprint arXiv:2110.09576</em>, 2021.
</div>
<div id="ref-areas2012gadm" class="csl-entry" role="listitem">
Global Administrative Areas. GADM database of global administrative areas. 2012.
</div>
<div id="ref-hajek_71" class="csl-entry" role="listitem">
J. Hjek. Discussion of, <span><span>A</span>n essay on the logical foundations of survey sampling, part <span>I</span>,</span> by <span>D</span>. <span>B</span>asu. In <em>Foundations of statistical inference</em>, Eds V. P. Godambe and D. A. Sprott 1971. Toronto: Holt, Rinehart; Winston.
</div>
<div id="ref-hill_etal_15" class="csl-entry" role="listitem">
K. Hill, E. Brady, L. Zimmerman, L. Montana, R. Silva and A. Amouzou. Monitoring change in child mortality through household surveys. <em>PloS One</em>, 10: e0137713, 2015.
</div>
<div id="ref-horvitz_thompson_52" class="csl-entry" role="listitem">
D. G. Horvitz and D. J. Thompson. A generalization of sampling without replacement from a finite universe. <em>Journal of the American Statistical Association</em>, 47: 663685, 1952.
</div>
<div id="ref-knorrheld_00" class="csl-entry" role="listitem">
L. Knorr-Held. <span>Bayesian</span> modelling of inseparable space-time variation in disease risk. <em>Statistics in Medicine</em>, 19: 25552567, 2000.
</div>
<div id="ref-li_etal_19" class="csl-entry" role="listitem">
Z. R. Li, Y. Hsiao, J. Godwin, B. D. Martin, J. Wakefield and S. J. Clark. Changes in the spatial distribution of the under five mortality rate: Small-area analysis of 122 <span>DHS</span> surveys in 262 subregions of 35 countries in <span>Africa</span>. <em>PLoS One</em>, 2019. Published January 22, 2019.
</div>
<div id="ref-lumley2004analysis" class="csl-entry" role="listitem">
T. Lumley. Analysis of complex survey samples. <em>Journal of Statistical Software</em>, 9(1): 119, 2004.
</div>
<div id="ref-survey44" class="csl-entry" role="listitem">
T. Lumley. <em><span class="nocase">survey</span>: Analysis of complex survey samples.</em> 2024. R package version 4.4.
</div>
<div id="ref-macfeely20" class="csl-entry" role="listitem">
S. MacFeely. Measuring the <span>Sustainable Development Goal</span> indicators: An unprecedented statistical challenge. <em>Journal of Official Statistics</em>, 36(2): 361378, 2020.
</div>
<div id="ref-mercer_etal_15" class="csl-entry" role="listitem">
L. D. Mercer, J. Wakefield, A. Pantazis, A. M. Lutambi, H. Masanja and S. Clark. Small area estimation of childhood mortality in the absence of vital registration. <em>Annals of Applied Statistics</em>, 9: 18891905, 2015.
</div>
<div id="ref-molina_marhuenda_15" class="csl-entry" role="listitem">
I. Molina and Y. Marhuenda. Sae: An <span>R</span> package for small area estimation. <em>The R Journal</em>, 7: 8198, 2015.
</div>
<div id="ref-paige_etal_20" class="csl-entry" role="listitem">
J. Paige, G.-A. Fuglstad, A. Riebler and J. Wakefield. Model-based approaches to analysing spatial data from complex surveys. <em>Journal of Survey Statistics and Methodology</em>, 2020. To appear.
</div>
<div id="ref-pedersenandliu_2012" class="csl-entry" role="listitem">
J. Pedersen and J. Liu. Child mortality estimation: Appropriate time periods for child mortality estimates from full birth histories. <em>PLoS Med</em>, 9(8): e1001289, 2012.
</div>
<div id="ref-patchwork" class="csl-entry" role="listitem">
T. L. Pedersen. <em>Patchwork: The composer of plots.</em> 2019. URL <a href="https://CRAN.R-project.org/package=patchwork">https://CRAN.R-project.org/package=patchwork</a>. R package version 1.0.0.
</div>
<div id="ref-permatasari2021msae" class="csl-entry" role="listitem">
N. Permatasari and A. Ubaidillah. <span class="nocase">msae</span>: An <span>R</span> package of multivariate <span>Fay Herriot</span> models for small area estimation. <em>The R Journal</em>, 2021.
</div>
<div id="ref-rao_molina_15" class="csl-entry" role="listitem">
J. N. Rao and I. Molina. <em>Small area estimation, second edition.</em> New York: John Wiley, 2015.
</div>
<div id="ref-riebler_etal_16" class="csl-entry" role="listitem">
A. Riebler, S. H. Srbye, D. Simpson and H. Rue. An intuitive <span>Bayesian</span> spatial model for disease mapping that accounts for scaling. <em>Statistical Methods in Medical Research</em>, 25: 11451165, 2016.
</div>
<div id="ref-rue_knorrheld_05" class="csl-entry" role="listitem">
H. Rue and L. Held. <em><span>G</span>aussian <span>M</span>arkov <span>R</span>andom <span>F</span>ields: Theory and application.</em> Boca Raton: Chapman; Hall/CRC Press, 2005.
</div>
<div id="ref-rue_etal_09" class="csl-entry" role="listitem">
H. Rue, S. Martino and N. Chopin. Approximate <span>Bayesian</span> inference for latent <span>Gaussian</span> models using integrated nested <span>Laplace</span> approximations (with discussion). <em>Journal of the Royal Statistical Society, Series B</em>, 71: 319392, 2009.
</div>
<div id="ref-schluter2021space" class="csl-entry" role="listitem">
B.-S. Schlter and B. Masquelier. Space-time smoothing of mortality estimates in children aged 5-14 in <span>Sub-Saharan Africa</span>. <em>PloS One</em>, 16(1): e0245596, 2021.
</div>
<div id="ref-rsae" class="csl-entry" role="listitem">
T. Schoch. <em>Rsae: Robust small area estimation.</em> 2014. R package version 0.1-5.
</div>
<div id="ref-BayesSAE" class="csl-entry" role="listitem">
C. Shi. <em><span>BayesSAE</span>: <span>Bayesian</span> analysis of small area estimation.</em> 2018. R package version 1.0-2.
</div>
<div id="ref-dhsspatial" class="csl-entry" role="listitem">
The DHS Program. Spatial data repository. 2020. URL <a href="https://spatialdata.dhsprogram.com/home/">https://spatialdata.dhsprogram.com/home/</a>.
</div>
<div id="ref-un2023" class="csl-entry" role="listitem">
United Nations Inter-agency Group for Child Mortality Estimation. Subnational under-five and neonatal mortality estimates, 20002021 estimates developed by the <span class="nocase">United Nations Inter-agency Group for Child Mortality Estimation</span>. 2023. United Nations Childrens Fund, New York.
</div>
<div id="ref-wakefield_etal_19" class="csl-entry" role="listitem">
J. Wakefield, G.-A. Fuglstad, A. Riebler, J. Godwin, K. Wilson and S. Clark. Estimating under five mortality in space and time in a developing world context. <em>Statistical Methods in Medical Research</em>, 28: 26142634, 2019.
</div>
<div id="ref-wakefield_okonek_pedersen_20" class="csl-entry" role="listitem">
J. Wakefield, T. Okonek and J. Pedersen. Small area estimation of health outcomes. <em>International Statistical Review</em>, 2020. To appear.
</div>
<div id="ref-walker_etal_12" class="csl-entry" role="listitem">
N. Walker, K. Hill and F. Zhao. Child mortality estimation: Methods used to adjust for bias due to <span>AIDS</span> in estimating trends in under-five mortality. <em>PLoS Med</em>, 9: e1001298, 2012.
</div>
<div id="ref-rdhs" class="csl-entry" role="listitem">
O. Watson and J. Eaton. <em>Rdhs: <span>API</span> client and dataset management for the <span class="nocase">Demographic and Health Survey (DHS)</span> data.</em> 2019. URL <a href="https://CRAN.R-project.org/package=rdhs">https://CRAN.R-project.org/package=rdhs</a>. R package version 0.6.3.
</div>
<div id="ref-wickham_ggplot2" class="csl-entry" role="listitem">
H. Wickham. <em>ggplot2: Elegant graphics for data analysis.</em> Springer-Verlag New York, 2016. URL <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-wilson2021child" class="csl-entry" role="listitem">
K. Wilson and J. Wakefield. Child mortality estimation incorporating summary birth history data. <em>Biometrics</em>, 77(4): 14561466, 2021.
</div>
<div id="ref-wolter_07" class="csl-entry" role="listitem">
K. Wolter. <em>Introduction to variance estimation.</em> Springer Science &amp; Business Media, 2007.
</div>
<div id="ref-wu2021spatial" class="csl-entry" role="listitem">
Y. Wu, Z. R. Li, B. K. Mayala, H. Wang, P. Gao, J. Paige, G.-A. Fuglstad, C. Moe, J. Godwin, R. E. Donohue, et al. Spatial modeling for subnational administrative level 2 small-area estimation. <em>DHS spatial analysis reports no. 21</em>. Rockville, Maryland, <span>USA</span>: ICF. 2021.
</div>
</div>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>The name originally arises from Spatio-temporal Under-five Mortality Methods for Estimation in R. As the package becomes a more general toolkit, it now stands for Sae Unit/area Models and Methods for Estimation in R<a href="#fnref1" class="footnote-back" role="doc-backlink"></a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Li, et al., "Space-Time Smoothing of Survey Outcomes using the R Package SUMMER", The R Journal, 2025</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2025-005,
  author = {Li, Zehang Richard and Martin, Bryan D and Dong, Tracy Qi and Fuglstad, Geir-Arne and Godwin, Jessica and Paige, John and Riebler, Andrea and Clark, Samuel J and Wakefield, Jon},
  title = {Space-Time Smoothing of Survey Outcomes using the R Package SUMMER},
  journal = {The R Journal},
  year = {2025},
  note = {https://doi.org/10.32614/RJ-2025-005},
  doi = {10.32614/RJ-2025-005},
  volume = {17},
  issue = {1},
  issn = {2073-4859},
  pages = {88-107}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p> The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
