<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>Updates to the R Graphics Engine:  One Person's Chart Junk is Another's Chart Treasure</title>

<meta property="description" itemprop="description" content="Starting from R version 4.1.0, the R graphics engine has gained support for gradient fills, pattern fills, clipping paths, masks, compositing operators, and stroked and filled paths. This document provides a basic introduction to each of these new features and demonstrates how to use the new features in R."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2023-072/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2023-12-18"/>
<meta property="article:created" itemprop="dateCreated" content="2023-12-18"/>
<meta name="article:author" content="Paul Murrell"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Updates to the R Graphics Engine:  One Person&#39;s Chart Junk is Another&#39;s Chart Treasure"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Starting from R version 4.1.0, the R graphics engine has gained support for gradient fills, pattern fills, clipping paths, masks, compositing operators, and stroked and filled paths. This document provides a basic introduction to each of these new features and demonstrates how to use the new features in R."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2023-072/"/>
<meta property="og:image" content="https://journal.r-project.org/articles/RJ-2023-072/RJ-2023-072_files/figure-html5/diagram-1.png"/>
<meta property="og:image:width" content="2200"/>
<meta property="og:image:height" content="600"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Updates to the R Graphics Engine:  One Person&#39;s Chart Junk is Another&#39;s Chart Treasure"/>
<meta property="twitter:description" content="Starting from R version 4.1.0, the R graphics engine has gained support for gradient fills, pattern fills, clipping paths, masks, compositing operators, and stroked and filled paths. This document provides a basic introduction to each of these new features and demonstrates how to use the new features in R."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2023-072/"/>
<meta property="twitter:image" content="https://journal.r-project.org/articles/RJ-2023-072/RJ-2023-072_files/figure-html5/diagram-1.png"/>
<meta property="twitter:image:width" content="2200"/>
<meta property="twitter:image:height" content="600"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Updates to the R Graphics Engine:  One Person&#39;s Chart Junk is Another&#39;s Chart Treasure"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2023-072"/>
<meta name="citation_pdf_url" content="RJ-2023-072.pdf"/>
<meta name="citation_volume" content="15"/>
<meta name="citation_issue" content="3"/>
<meta name="citation_doi" content="10.32614/RJ-2023-072"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="257"/>
<meta name="citation_lastpage" content="276"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2023/12/18"/>
<meta name="citation_publication_date" content="2023/12/18"/>
<meta name="citation_author" content="Paul Murrell"/>
<meta name="citation_author_institution" content="The University of Auckland"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=ggplot2: Elegant graphics for data analysis;citation_publisher=Springer-Verlag New York;citation_author=Hadley Wickham"/>
  <meta name="citation_reference" content="citation_title=Catching up with R graphics;citation_publisher=Department of Statistics, The University of Auckland;citation_number=2020-04;citation_doi=10.17608/k6.auckland.12649751;citation_author=Paul Murrell"/>
  <meta name="citation_reference" content="citation_title=Groups, compositing operators, and affine transformations in R graphics;citation_publisher=Department of Statistics, The University of Auckland;citation_number=2021-02;citation_doi=10.17608/k6.auckland.17009120;citation_author=Paul Murrell"/>
  <meta name="citation_reference" content="citation_title=Stroking and filling paths in R graphics;citation_publisher=Department of Statistics, The University of Auckland;citation_number=2021-03;citation_doi=10.17608/k6.auckland.17019272;citation_author=Paul Murrell"/>
  <meta name="citation_reference" content="citation_title=Luminance masks in R graphics;citation_publisher=Department of Statistics, The University of Auckland;citation_number=2021-04;citation_doi=10.17608/k6.auckland.17102657;citation_author=Paul Murrell"/>
  <meta name="citation_reference" content="citation_title=Vectorised pattern fills in R graphics;citation_publisher=Department of Statistics, The University of Auckland;citation_number=2022-01;citation_doi=10.17608/k6.auckland.19945787;citation_author=Paul Murrell"/>
  <meta name="citation_reference" content="citation_title=ggdist: Visualizations of distributions and uncertainty;citation_doi=10.5281/zenodo.3879620;citation_author=Matthew Kay"/>
  <meta name="citation_reference" content="citation_title=gggrid: Draw with ’grid’ in ’ggplot2’;citation_author=Paul Murrell"/>
  <meta name="citation_reference" content="citation_title=ragg: Graphic devices based on AGG;citation_author=Thomas Lin Pedersen;citation_author=Maxim Shemanarev"/>
  <meta name="citation_reference" content="citation_title=svglite: An SVG graphics device;citation_author=Hadley Wickham;citation_author=Lionel Henry;citation_author=Thomas Lin Pedersen;citation_author=T Jake Luciani;citation_author=Matthieu Decorde;citation_author=Vaudor Lise"/>
  <meta name="citation_reference" content="citation_title=gridSVG: Export ’grid’ graphics as SVG;citation_author=Paul Murrell;citation_author=Simon Potter"/>
  <meta name="citation_reference" content="citation_title=gridGraphics: Redraw base graphics using ’grid’ graphics;citation_author=Paul Murrell;citation_author=Zhijian Wen"/>
  <meta name="citation_reference" content="citation_title=ggfx: Pixel filters for ’ggplot2’ and ’grid’;citation_author=Thomas Lin Pedersen"/>
  <meta name="citation_reference" content="citation_title=gridGeometry: Polygon geometry in ’grid’;citation_author=Paul Murrell;citation_author=Jack Wong"/>
  <meta name="citation_reference" content="citation_title=magick: Advanced graphics and image-processing in R;citation_author=Jeroen Ooms"/>
  <meta name="citation_reference" content="citation_title=rasterize: Rasterize graphical output;citation_author=Paul Murrell"/>
  <meta name="citation_reference" content="citation_title=shadowtext: Shadow text grob and layer;citation_author=Guangchuang Yu"/>
  <meta name="citation_reference" content="citation_title=Lattice: Multivariate data visualization with R;citation_publisher=Springer;citation_author=Deepayan Sarkar"/>
  <meta name="citation_reference" content="citation_title=Compositing digital images;citation_publisher=Association for Computing Machinery;citation_volume=18;citation_doi=10.1145/964965.808606;citation_issn=0097-8930;citation_author=Thomas Porter;citation_author=Tom Duff"/>
  <meta name="citation_reference" content="citation_title=PDF reference: Adobe portable document format version 1.4;citation_author=PDF reference: Adobe portable document format version 1.4"/>
  <meta name="citation_reference" content="citation_title=Porter-duff compositing operators in R graphics;citation_publisher=Department of Statistics, The University of Auckland;citation_number=2023-02;citation_doi=10.17608/k6.auckland.23034641;citation_author=Paul Murrell;citation_author=Thomas Lin Pedersen;citation_author=Panagiotis Skintzos"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","type","date","date_received","journal","volume","issue","subid","slug","packages","draft","output","bibliography","pdf_url","citation_url","doi","creative_commons","CTV","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Updates to the R Graphics Engine:  One Person's Chart Junk is Another's Chart Treasure"]},{"type":"character","attributes":{},"value":["Starting from R version 4.1.0, the R graphics engine has gained support for gradient fills, pattern fills, clipping paths, masks, compositing operators, and stroked and filled paths. This document provides a basic introduction to each of these new features and demonstrates how to use the new features in R."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","url","orcid_id","email"]}},"value":[{"type":"character","attributes":{},"value":["Paul Murrell"]},{"type":"character","attributes":{},"value":["The University of Auckland"]},{"type":"character","attributes":{},"value":["Department of Statistics","38 Princes Street","Auckland","New Zealand"]},{"type":"character","attributes":{},"value":["https://www.stat.auckland.ac.nz/~paul/"]},{"type":"character","attributes":{},"value":["0000-0002-3224-8858"]},{"type":"character","attributes":{},"value":["paul@stat.auckland.ac.nz"]}]}]},{"type":"character","attributes":{},"value":["package"]},{"type":"character","attributes":{},"value":["2023-12-18"]},{"type":"character","attributes":{},"value":["2023-04-20"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[257]},{"type":"integer","attributes":{},"value":[276]}]},{"type":"integer","attributes":{},"value":[15]},{"type":"integer","attributes":{},"value":[3]},{"type":"character","attributes":{},"value":["2023-33"]},{"type":"character","attributes":{},"value":["RJ-2023-072"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"NULL"},{"type":"NULL"}]},{"type":"logical","attributes":{},"value":[false]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["murrell-definitions-2023.bib"]},{"type":"character","attributes":{},"value":["RJ-2023-072.pdf"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2023-072"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2023-072"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"list","attributes":{},"value":[]},{"type":"character","attributes":{},"value":["/Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/library/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2023-072/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["distill-preview.png","figures/rgraphics.dot","figures/rgraphics.png","murrell-definitions-2023_files/anchor-4.2.2/anchor.min.js","murrell-definitions-2023_files/bowser-1.9.3/bowser.min.js","murrell-definitions-2023_files/distill-2.2.21/template.v2.js","murrell-definitions-2023_files/figure-html5/diagram-1.png","murrell-definitions-2023_files/figure-html5/ggdist-1.png","murrell-definitions-2023_files/figure-html5/gggrid-1.png","murrell-definitions-2023_files/figure-html5/ggplot2bg-1.png","murrell-definitions-2023_files/figure-html5/ggplot2clip-1.png","murrell-definitions-2023_files/figure-html5/gridfig-1.png","murrell-definitions-2023_files/figure-html5/lattice-1.png","murrell-definitions-2023_files/figure-html5/legend-1.png","murrell-definitions-2023_files/figure-html5/map-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-11-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-12-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-13-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-14-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-15-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-16-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-17-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-18-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-19-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-20-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-21-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-22-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-23-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-24-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-25-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-26-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-27-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-28-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-29-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-3-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-30-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-31-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-32-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-33-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-4-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-45-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-47-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-6-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-7-1.png","murrell-definitions-2023_files/figure-html5/unnamed-chunk-9-1.png","murrell-definitions-2023_files/figure-latex/diagram-1.png","murrell-definitions-2023_files/figure-latex/ggdist-1.png","murrell-definitions-2023_files/figure-latex/gggrid-1.png","murrell-definitions-2023_files/figure-latex/ggplot2bg-1.png","murrell-definitions-2023_files/figure-latex/ggplot2clip-1.png","murrell-definitions-2023_files/figure-latex/gridfig-1.png","murrell-definitions-2023_files/figure-latex/lattice-1.png","murrell-definitions-2023_files/figure-latex/legend-1.png","murrell-definitions-2023_files/figure-latex/map-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-11-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-12-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-13-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-14-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-15-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-16-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-17-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-18-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-19-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-20-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-21-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-22-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-23-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-24-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-25-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-26-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-27-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-28-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-29-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-3-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-30-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-31-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-32-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-33-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-4-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-45-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-47-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-6-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-7-1.png","murrell-definitions-2023_files/figure-latex/unnamed-chunk-9-1.png","murrell-definitions-2023_files/header-attrs-2.25/header-attrs.js","murrell-definitions-2023_files/jquery-3.6.0/jquery-3.6.0.js","murrell-definitions-2023_files/jquery-3.6.0/jquery-3.6.0.min.js","murrell-definitions-2023_files/jquery-3.6.0/jquery-3.6.0.min.map","murrell-definitions-2023_files/popper-2.6.0/popper.min.js","murrell-definitions-2023_files/tippy-6.2.7/tippy-bundle.umd.min.js","murrell-definitions-2023_files/tippy-6.2.7/tippy-light-border.css","murrell-definitions-2023_files/tippy-6.2.7/tippy.css","murrell-definitions-2023_files/tippy-6.2.7/tippy.umd.min.js","murrell-definitions-2023_files/webcomponents-2.0.0/webcomponents.js","murrell-definitions-2023.bib","murrell-definitions-2023.pdf","murrell-definitions-2023.tex","preamble.tex","quakes-mod.csv","rgraphics.dot","rgraphics.png","RJ-2023-072_files/figure-html5/diagram-1.png","RJ-2023-072_files/figure-html5/ggdist-1.png","RJ-2023-072_files/figure-html5/gggrid-1.png","RJ-2023-072_files/figure-html5/ggplot2bg-1.png","RJ-2023-072_files/figure-html5/ggplot2clip-1.png","RJ-2023-072_files/figure-html5/gridfig-1.png","RJ-2023-072_files/figure-html5/lattice-1.png","RJ-2023-072_files/figure-html5/legend-1.png","RJ-2023-072_files/figure-html5/map-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-11-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-12-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-13-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-14-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-15-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-16-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-17-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-18-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-19-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-20-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-21-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-22-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-23-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-24-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-25-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-26-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-27-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-28-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-29-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-3-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-30-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-31-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-32-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-33-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-4-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-45-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-47-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-6-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-7-1.png","RJ-2023-072_files/figure-html5/unnamed-chunk-9-1.png","RJ-2023-072.pdf","RJ-2023-072.tex","RJ-2023-072.zip","RJournal.sty","RJwrapper.aux","RJwrapper.tex","Rlogo-5.png","scripts/diagram.R"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.25/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="' + slug + '.zip" class="dt-tag"><i class="fas fa-file-zipper"></i> Supplement</a>')

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").first();
      if (tpar && ! tpar.hasClass("subtitle")) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append($("d-title p:not(:empty)").first()) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Updates to the R Graphics Engine:  One Person's Chart Junk is Another's Chart Treasure","description":"Starting from R version 4.1.0, the R graphics engine has gained support for gradient fills, pattern fills, clipping paths, masks, compositing operators, and stroked and filled paths. This document provides a basic introduction to each of these new features and demonstrates how to use the new features in R.","doi":"10.32614/RJ-2023-072","authors":[{"author":"Paul Murrell","authorURL":"https://www.stat.auckland.ac.nz/~paul/","affiliation":"The University of Auckland","affiliationURL":"#","orcidID":"0000-0002-3224-8858"}],"publishedDate":"2023-12-18T00:00:00.000+00:00","citationText":"Murrell, 2023"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../issues/2024-1">Current</a>
<a href="../../submissions.html">Submit</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Updates to the R Graphics Engine: One Person’s Chart Junk is Another’s Chart Treasure</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Starting from R version 4.1.0, the R graphics engine has gained support for gradient fills, pattern fills, clipping paths, masks, compositing operators, and stroked and filled paths. This document provides a basic introduction to each of these new features and demonstrates how to use the new features in R.</p></p>
</div>

<div class="d-byline">
  Paul Murrell <a href="https://www.stat.auckland.ac.nz/~paul/" class="uri">https://www.stat.auckland.ac.nz/~paul/</a> (The University of Auckland)
  
<br/>2023-12-18
</div>

<div class="d-article">
<h2 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>Figure <a href="#fig:diagram">1</a> shows a data visualization
with a subtle feature on each
circle.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>
The border of each circle in the visualization is
semi-transparent and the border of each circle becomes
more transparent from left to right. We could argue about whether
circles are the best representation of these values and whether the
semi-transparent gradient is particularly helpful, but for the
purposes of this paper, this image
represents a specific example of a general problem: does R graphics
allow us to produce the exact final image that we desire, or
do the limitations of the R graphics engine
force us to use external, manual software
like Adobe Illustrator to perform additional
modifications? Over the past few years, a number of capabilities
have been added to the R graphics engine with the aim of being
able to produce the exact final image that we desire entirely within
R code.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:diagram"></span>
<img src="RJ-2023-072_files/figure-html5/diagram-1.png" alt="A diagram with a horizontal row of circles that slowly decrease in size.  There is a semi-transparent linear gradient on each circle border." width="100%" />
<p class="caption">
Figure 1: A diagram with a semi-transparent linear gradient on each circle border.
</p>
</div>
</div>
<p>For example, it is now possible to define a linear gradient in R.
The following code defines a horizontal linear gradient from a light gray
on the left
to a very light gray on the right.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>grid</span><span class='op'>)</span></span>
<span><span class='va'>linearbg</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/patterns.html'>linearGradient</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grDevices/gray.html'>grey</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.8</span>, <span class='fl'>.99</span><span class='op'>)</span><span class='op'>)</span>, </span>
<span>                           x1<span class='op'>=</span><span class='fl'>0</span>, x2<span class='op'>=</span><span class='fl'>1</span>, y1<span class='op'>=</span><span class='fl'>.5</span>, y2<span class='op'>=</span><span class='fl'>.5</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The following code uses the <code>linearbg</code> gradient defined above to
add a subtle linear gradient background to a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot
<span class="citation" data-cites="book:ggplot2">(<a href="#ref-book:ggplot2" role="doc-biblioref">Wickham 2016</a>)</span> by setting
the <code>fill</code> in the <code>plot.background</code>
(see Figure <a href="#fig:ggplot2bg">2</a>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>disp</span>, <span class='va'>mpg</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.background<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='va'>linearbg</span>, colour<span class='op'>=</span><span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>          plot.margin<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>.25</span>, <span class='fl'>.25</span><span class='op'>)</span>, <span class='st'>"cm"</span><span class='op'>)</span>,</span>
<span>          panel.background<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='cn'>NA</span>, colour<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span>,</span>
<span>          panel.grid<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:ggplot2bg"></span>
<img src="RJ-2023-072_files/figure-html5/ggplot2bg-1.png" alt="A scatter plot with a subtle linear gradient background." width="100%" />
<p class="caption">
Figure 2: A ggplot2 plot with a subtle linear gradient background.
</p>
</div>
</div>
<p>Only some of the new graphics features are available at this stage
via high-level interfaces
like <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>, as in the example above, so <a href="#new-features">Section 2</a>
will introduce the new features via a number of lower-level
examples using the <a href="#">grid</a> package.
Section 2 will serve two purposes: to explain what the new features
are and to show how they can be used (at least with <a href="#">grid</a>).
<a href="#integration">Section 3</a> will provide some examples of how to
integrate the lower-level <a href="#">grid</a> usage with higher-level packages
like <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>, <a href="https://cran.r-project.org/package=lattice">lattice</a>, and base <a href="#">graphics</a> plots.
<a href="#discussion">Section 4</a> provides a discussion of important limitations
of the new features, how the new features relate to the capabilities
of existing R packages, and pointers to further readings.
For readers unfamiliar with the organization of R graphics systems,
for example, the relationship between <a href="#">grid</a> and <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>,
<a href="#rgraphics">the Appendix</a> provides a brief overview.</p>
<h2 data-number="2" id="new-features"><span class="header-section-number">2</span> The new graphics features</h2>
<p>In this section, we introduce the new graphics features one by one.
The aim is to explain each feature, show what it can do, and show
how to use the feature with the <a href="#">grid</a> package.
Since <a href="#">grid</a> will not be familiar for many R users,
the examples will be kept as simple as possible and will involve only drawing
basic shapes; <a href="#integration">Section 3</a> will provide some more
complicated examples involving complete plots.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h3 data-number="2.1" id="gradient-fills"><span class="header-section-number">2.1</span> Gradient fills</h3>
<p>There are new functions in the <code>grid</code> package for
defining gradient fills. For example,
we can use the <code>linearGradient()</code> function to
define a linear gradient based on a start point, an end point,
and a set of colors to transition between (along the straight
line between the start and end point).</p>
<p>In the following code, we use the <code>rgb()</code> function to
define two R colors, both blue, but one
almost opaque and one almost completely transparent.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>blues</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, alpha<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.8</span>, <span class='fl'>.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>blues</span></span></code></pre>
</div>
<pre><code>[1] &quot;#0000FFCC&quot; &quot;#0000FF1A&quot;</code></pre>
</div>
<p>Next we define a linear gradient that
transitions horizontally, left-to-right, between these two colors.
In <a href="#">grid</a>, we can specify positions relative to a variety of
coordinate systems, but the default is a “normalized” system
where <code>0</code> means left/bottom and <code>1</code> means right/top (and <code>.5</code>
means the center).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>gradient</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/patterns.html'>linearGradient</a></span><span class='op'>(</span><span class='va'>blues</span>, x1<span class='op'>=</span><span class='fl'>0</span>, x2<span class='op'>=</span><span class='fl'>1</span>, y1<span class='op'>=</span><span class='fl'>.5</span>, y2<span class='op'>=</span><span class='fl'>.5</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The code above does not draw anything; it just defines a linear gradient.
In order to draw the gradient, we provide this object as the “fill color”
to a function that does draw something.
For example,
as we saw in the introduction, we can pass that linear
gradient object as the <code>fill</code> argument to the <code>element_rect()</code> function so that
<a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> will fill a rectangle with the gradient.</p>
<p>In <a href="#">grid</a>, we can draw a shape with a fill color by calling
a function like <code>grid.circle()</code> and specifying
the <code>fill</code> argument to the <code>gpar()</code> function.
For example, the following code draws a circle with a <code>"blue"</code> fill.
By default, the circle is drawn in the center of the image and
<code>r=.3</code> means that the radius of the circle is 30% of the width
of the image.
All of the images in this section will
have a light gray checkerboard pattern in the background
so that we can properly see any semi-transparency
in what we draw.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>grid.circle</a></span><span class='op'>(</span>r<span class='op'>=</span><span class='fl'>.3</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='st'>"blue"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-3-1.png" width="100" /></p>
</div>
<p>The following code draws a circle and uses the linear gradient that we
defined at the start of this section as the <code>fill</code>.
Notice that the location <code>x1=0</code> in the linear gradient definition
refers to the “left” <em>of the circle</em> and
<code>x2=1</code> refers to the “right” <em>of the circle</em>. In other
words, the gradient is relative to the bounding box of the shape
that is being filled. There are many other possibilities, including
using the <code>unit()</code> function to specify the locations of the start
and end points of the gradient in absolute units like inches
(though still relative to the shape’s bounding box) and we can also set
the <code>fill</code> on a <code>grid</code> viewport rather than on individual shapes.
The <a href="#further-reading">Further reading</a> Section provides links
to several technical reports that demonstrate a wider range of
examples.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>grid.circle</a></span><span class='op'>(</span>r<span class='op'>=</span><span class='fl'>.3</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='va'>gradient</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-4-1.png" width="100" /></p>
</div>
<p>There is also a <code>radialGradient()</code> function for defining a gradient
that is based on a start circle and an end circle and a set of colors
to transition between. For example, the following code
defines a radial gradient that starts with radius <code>r1=.5</code> and ends with
radius <code>r2=0</code>, transitioning from an almost opaque blue
to almost
fully transparent blue.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>radial</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/patterns.html'>radialGradient</a></span><span class='op'>(</span><span class='va'>blues</span>, r1<span class='op'>=</span><span class='fl'>.5</span>, r2<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>In the following code, the radial gradient is used to fill a circle.
The radii of the start and end circles of the gradient
are relative to the bounding box of the circle that is being filled,
so <code>r1=.5</code> corresponds to the circumference of the circle being filled
and <code>r2=0</code> corresponds to the center of the circle being filled.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>grid.circle</a></span><span class='op'>(</span>r<span class='op'>=</span><span class='fl'>.3</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='va'>radial</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-6-1.png" width="100" /></p>
</div>
<p>Any shape can be filled with either a linear or radial gradient.
For example, the following code fills a rectangle with the
radial gradient defined above.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.rect.html'>grid.rect</a></span><span class='op'>(</span>width<span class='op'>=</span><span class='fl'>.6</span>, height<span class='op'>=</span><span class='fl'>.6</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='va'>radial</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-7-1.png" width="100" /></p>
</div>
<h3 data-number="2.2" id="pattern-fills"><span class="header-section-number">2.2</span> Pattern fills</h3>
<p>It is now also possible to
fill a shape with a pattern fill with the help of the
<code>pattern()</code> function from the <a href="#">grid</a> package.
The first argument to this function describes what to draw for the
pattern and subsequent arguments describe the size of the pattern - the
extent of the pattern <em>tile</em> - along with what happens outside of the
pattern tile.
As an example, we will look at the construction of the checkerboard pattern
that is being used as the background for the
images in this section.</p>
<p>The first step is to describe the shape for the pattern.
In this case, we use a call to <code>rectGrob()</code> to describe
two rectangles, both .1 inches square and filled with light gray,
with one rectangle just above and to the right
of center and one just below and to the left of center.
The <a href="#">grid</a> function <code>unit()</code> is used to associate a value with
a coordinate system. In the <code>"npc"</code> coordinate system, <code>0</code>
means left/bottom, <code>1</code> means right/top, and <code>.5</code> means the
center, and in the <code>"in"</code> coordinate system, values are in inches.
The image below the code shows what this shape looks like
drawn on its own.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>bgRect</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.rect.html'>rectGrob</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='st'>"npc"</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='op'>-</span><span class='fl'>.1</span><span class='op'>)</span>, <span class='st'>"in"</span><span class='op'>)</span>,</span>
<span>                   y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='st'>"npc"</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='op'>-</span><span class='fl'>.1</span><span class='op'>)</span>, <span class='st'>"in"</span><span class='op'>)</span>,</span>
<span>                   just<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"left"</span>, <span class='st'>"bottom"</span><span class='op'>)</span>,</span>
<span>                   width<span class='op'>=</span><span class='fl'>.1</span>, height<span class='op'>=</span><span class='fl'>.1</span>, default.units<span class='op'>=</span><span class='st'>"in"</span>,</span>
<span>                   gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='st'>"gray80"</span>, fill<span class='op'>=</span><span class='st'>"gray80"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-9-1.png" width="100" /></p>
</div>
<p>The following code creates a pattern based on this shape.
The size of the tile is .2” square and the tile will be repeated
to fill a region
(<code>extend="repeat"</code>).
The image below the code shows the pattern tile (without repetition);
the extent of the tile is indicated by a red rectangle.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>bg</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/patterns.html'>pattern</a></span><span class='op'>(</span><span class='va'>bgRect</span>,</span>
<span>              width<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>.2</span>, <span class='st'>"in"</span><span class='op'>)</span>,</span>
<span>              height<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>.2</span>, <span class='st'>"in"</span><span class='op'>)</span>,</span>
<span>              extend<span class='op'>=</span><span class='st'>"repeat"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-11-1.png" width="100" /></p>
</div>
<p>As with the <code>linearGradient()</code> and <code>radialGradient()</code> functions,
the result of a call to <code>pattern()</code> is just an object that describes a pattern;
nothing is drawn. We supply this pattern object as the <code>fill</code> for a shape
that is to be drawn.</p>
<p>For example, the object that we created with a call
to <code>pattern()</code> can be used as the <code>fill</code> graphical parameter
in <code>grid</code> functions. The following code draws a rectangle that is
the size of the entire image and fills it with the <code>bg</code> pattern.
The pattern tile is drawn in the center of the rectangle and
then repeated to fill the entire rectangle.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.rect.html'>grid.rect</a></span><span class='op'>(</span>gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='va'>bg</span><span class='op'>)</span><span class='op'>)</span>  </span></code></pre>
</div>
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-12-1.png" width="100" /></p>
</div>
<p>As with gradient fills, we can use the pattern to fill any shape.
For example, the following code fills a circle with the checkerboard
pattern.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>grid.circle</a></span><span class='op'>(</span>gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='va'>bg</span><span class='op'>)</span><span class='op'>)</span>  </span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-13-1.png" width="100" /></p>
</div>
<h3 data-number="2.3" id="clipping-paths"><span class="header-section-number">2.3</span> Clipping paths</h3>
<p>A clipping region describes an area within which drawing will be visible.
By default, everything that we draw within the limits of an image is
visible, but we can set a clipping region to limit what gets drawn.
<em>Rectangular</em> clipping regions have been available in R graphics
for a very long time.
For example, in scatter plots, the data symbols are usually
clipped to the (rectangular) plot region. The code below
produces a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot with
the x-axis scale set to
exactly the range of the <code>disp</code> variable so that the left-most and right-most
data symbols are centered on the left and right edge of the plot region.
The <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> package clips the drawing of the data symbols to the
plot region so only
half of the left-most and right-most data symbols are drawn
(see Figure <a href="#fig:ggplot2clip">3</a>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>disp</span>, <span class='va'>mpg</span><span class='op'>)</span>, size<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>expand<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.margin<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>.25</span>, <span class='fl'>.25</span><span class='op'>)</span>, <span class='st'>"cm"</span><span class='op'>)</span>,</span>
<span>          panel.background<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='cn'>NA</span>, colour<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span>,</span>
<span>          panel.grid<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:ggplot2clip"></span>
<img src="RJ-2023-072_files/figure-html5/ggplot2clip-1.png" alt="A scatter plot with the left-most and right-most data symbols clipped to the edges of the plot region." width="100%" />
<p class="caption">
Figure 3: A ggplot2 plot with the left-most and right-most data symbols clipped to the edges of the plot region.
</p>
</div>
</div>
<p>In <a href="#">grid</a>, a clipping region can be defined when we push a <em>viewport</em>.
A viewport is a rectangular region that defines a temporary coordinate
system for drawing, plus some other parameters like the clipping region.
For example, the plot region on a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot is a <a href="#">grid</a>
viewport that provides coordinates for drawing data symbols, with
clipping turned on so that nothing is drawn outside the plot region.</p>
<p>The following code provides a simple demonstration of a viewport.
First, we describe two circles, one centered on the left edge of
the image and one centered on the right edge of the image.
The <code>circleGrob()</code> function is similar
to the <code>grid.circle()</code> function, except that it just creates a
description of a circle and does not draw anything.
The <code>grid.draw()</code> function draws the circles.
Because the circles are centered on the edges of the image,
we can only see half of each circle.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>gradient2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/patterns.html'>linearGradient</a></span><span class='op'>(</span><span class='va'>blues</span>, x1<span class='op'>=</span><span class='fl'>0</span>, x2<span class='op'>=</span><span class='fl'>1</span>, y1<span class='op'>=</span><span class='fl'>.5</span>, y2<span class='op'>=</span><span class='fl'>.5</span>,</span>
<span>                            group<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span></span>
<span><span class='va'>circles</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>circleGrob</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span>, r<span class='op'>=</span><span class='fl'>.5</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='st'>"blue"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>circles</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-14-1.png" width="100" /></p>
</div>
<p>In the following code,
the <code>viewport()</code> function describes a viewport that is only 50%
of the width and 50% of the height of the image. The
<code>pushViewport()</code> function creates that viewport on the image.
We then call the <code>grid.draw()</code> function to draw the circles again,
but now we are within the viewport,
so the circles are drawn centered on the left and right edges
<em>of the viewport</em>. Furthermore,
the radius of the circles (<code>.5</code>)
now means 50% of the width <em>of the viewport</em>, so the circles
are also drawn smaller than before. Notice that the circles
extend beyond the edges of the viewport because, by default,
there is no clipping region.
The <code>popViewport()</code> function removes the viewport from the image
(so further drawing would be at full size).
In the image below, a red rectangle has been drawn just to show
the extent of the viewport, but normally nothing is drawn when
a viewport is created.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>pushViewport</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/viewport.html'>viewport</a></span><span class='op'>(</span>width<span class='op'>=</span><span class='fl'>.5</span>, height<span class='op'>=</span><span class='fl'>.5</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>circles</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>popViewport</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-15-1.png" width="100" /></p>
</div>
<p>The following code demonstrates the idea of clipping to a viewport.
We push a viewport again, but this time the viewport has clipping
turned on (<code>clip=TRUE</code>). A purple rectangle
shows the extent of this viewport. When we draw the circles within
this viewport, drawing
is limited to the extent of the viewport, so half of the
left circle and half of the right circle are clipped.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>pushViewport</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/viewport.html'>viewport</a></span><span class='op'>(</span>width<span class='op'>=</span><span class='fl'>.5</span>, height<span class='op'>=</span><span class='fl'>.5</span>, clip<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>circles</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>popViewport</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-16-1.png" width="100" /></p>
</div>
<p>This idea of a clipping region has now been extended to a clipping <em>path</em>
so that we can limit drawing to a region that is any shape at all,
not just a rectangle.
For example, the following code describes a diamond shape
that we will use as a clipping path. This code does not draw anything,
but the shape is shown below the code anyway just so that we know what it looks
like.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>diamondPath</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.polygon.html'>polygonGrob</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>.5</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>.5</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-17-1.png" width="100" /></p>
</div>
<p>The following code pushes a viewport again,
but this time sets the clipping region for the viewport
to be the diamond shape that we defined above.
Now, when we draw the two circles within this viewport,
only the parts of the circles that lie within the diamond-shaped
clipping path are visible.
Just as a guide, a red rectangle has been drawn to show the extent
of the viewport that we have pushed, and a purple diamond has been
drawn to show the extent of the clipping path. Notice that the
location and size of the diamond path is relative to the viewport,
so <code>0</code> is the left/bottom <em>of the viewport</em> and <code>1</code> is the right/top <em>of
the viewport</em>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>pushViewport</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/viewport.html'>viewport</a></span><span class='op'>(</span>width<span class='op'>=</span><span class='fl'>.5</span>, height<span class='op'>=</span><span class='fl'>.5</span>, clip<span class='op'>=</span><span class='va'>diamondPath</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>circles</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>popViewport</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-18-1.png" width="100" /></p>
</div>
<h3 data-number="2.4" id="masks"><span class="header-section-number">2.4</span> Masks</h3>
<p>Masks are similar to clipping paths in that they constrain what parts
of a shape are visible. However, a mask provides greater flexibility
because it allows intermediate levels of semi-transparency;
a clipping path effectively only allows either fully opaque or
fully semi-transparent masking.</p>
<p>A mask, like a clipping path, can be based on any shape.
For example, the following code describes a diamond shape
(that is filled black).
This code does not draw anything, but the diamond is shown below
the code anyway so that we know what it looks like.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>diamondMask</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.polygon.html'>polygonGrob</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>.5</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>.5</span>, <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>                           gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-19-1.png" width="100" /></p>
</div>
<p>Also like clipping paths, we can enforce a mask when we push a viewport.
The following code pushes a viewport that is half the width and half the height
of the total image
and enforces the mask defined above and then draws the two blue circles.
The mask works by transferring its opacity to the circles.
Where the mask is opaque, the circles are drawn normally and
where the mask is transparent, the circles are not drawn at all.
The effect of this mask is exactly the same as the clipping path
example from the previous section.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>pushViewport</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/viewport.html'>viewport</a></span><span class='op'>(</span>width<span class='op'>=</span><span class='fl'>.5</span>, height<span class='op'>=</span><span class='fl'>.5</span>, mask<span class='op'>=</span><span class='va'>diamondMask</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>circles</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>popViewport</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-20-1.png" width="100" /></p>
</div>
<p>The additional flexibility that is available with masks comes from
the fact that the mask may have fully opaque areas and fully
transparent areas <em>and</em> areas of <em>semi-transparency</em>.
For example, the following code defines a more complex shape.
This shape is a square with opaque corners and a semitransparent
diamond in the middle (again, the shape is shown below the code
just for reference; the code does no actual drawing).
In this code, the <code>grobTree()</code> function is used to describe a mask
that is made up from two shapes:
a <code>polygonGrob()</code> that describes the semitransparent diamond and
a <code>pathGrob()</code> that describes the opaque corners.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>alphaMask</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.grob.html'>grobTree</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.polygon.html'>polygonGrob</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>.5</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>.5</span>, <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>                                  gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>.5</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>                      <span class='fu'><a href='https://rdrr.io/r/grid/grid.path.html'>pathGrob</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>.5</span><span class='op'>)</span>,</span>
<span>                               <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>.5</span>, <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>                               id<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>, each<span class='op'>=</span><span class='fl'>4</span><span class='op'>)</span>,</span>
<span>                               rule<span class='op'>=</span><span class='st'>"evenodd"</span>,</span>
<span>                               gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-21-1.png" width="100" /></p>
</div>
<p>When we push a viewport with this mask, and draw the two circles,
the result is the original circles where the mask is opaque
and a semitransparent version of the circles where the mask is
semitransparent.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>pushViewport</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/viewport.html'>viewport</a></span><span class='op'>(</span>width<span class='op'>=</span><span class='fl'>.5</span>, height<span class='op'>=</span><span class='fl'>.5</span>, mask<span class='op'>=</span><span class='va'>alphaMask</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>circles</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>popViewport</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-22-1.png" width="100" /></p>
</div>
<p>The masks used above are examples of <em>alpha</em> masks. They work by
transferring the “alpha channel”, or opacity, of the mask to the
shape that is being drawn.
It is also possible to define <em>luminance</em> masks.
With a luminance mask, areas of the mask that are white mean that
drawing will occur normally, areas that are black mean that
no drawing will occur, and areas that are gray produce semi-transparent
drawing.</p>
<h3 data-number="2.5" id="stroked-and-filled-paths"><span class="header-section-number">2.5</span> Stroked and filled paths</h3>
<p>Another new feature in R graphics is the ability to stroke and/or fill
a <em>path</em>, where the path is defined by one or more other shapes.
As an example, we will look at producing the “square with opaque corners”
from the previous section on masks.</p>
<p>The code below is similar to the code used in the previous section
(and the shape that it draws is shown below the code).
This code uses the <code>grid.path()</code> function and it is relatively complex
because it has explicit <code>x</code> and <code>y</code> locations to describe the corners of
a square followed by the corners of a diamond and an <code>id</code> argument
to divide the <code>x</code> and <code>y</code> locations into separate shapes (square and diamond).
The <code>rule="evenodd"</code> argument means that the interior of the path
(that is filled with black) is inside the square, but not inside the diamond.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.path.html'>grid.path</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>.5</span><span class='op'>)</span>,</span>
<span>          <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>.5</span>, <span class='fl'>1</span>, <span class='fl'>.5</span>, <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>          id<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>, each<span class='op'>=</span><span class='fl'>4</span><span class='op'>)</span>,</span>
<span>          rule<span class='op'>=</span><span class='st'>"evenodd"</span>,</span>
<span>          gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-23-1.png" width="100" /></p>
</div>
<p>The idea with stroked and filled paths is that we can describe more
complex shapes like this by combining simpler shapes instead
of having to specify explicit <code>x</code> and <code>y</code> locations.
For example, the following code draws the same shape using
<code>grid.fillStroke()</code>, which allows us to describe the shape as a
combination of a simple rectangle, with <code>rectGrob()</code>,
and the <code>diamondPath</code> that we defined
earlier.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.stroke.html'>grid.fillStroke</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.grob.html'>grobTree</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.rect.html'>rectGrob</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='va'>diamondPath</span><span class='op'>)</span>,</span>
<span>                rule<span class='op'>=</span><span class='st'>"evenodd"</span>,</span>
<span>                gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-24-1.png" width="100" /></p>
</div>
<p>The following code shows a similar example, this time creating a
square with rounded corners by combining a rectangle with a circle.
This shape would be much harder to describe using <code>pathGrob()</code> and
explicit <code>x</code> and <code>y</code> locations.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.stroke.html'>grid.fillStroke</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.grob.html'>grobTree</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.rect.html'>rectGrob</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>circleGrob</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>                rule<span class='op'>=</span><span class='st'>"evenodd"</span>,</span>
<span>                gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-25-1.png" width="100" /></p>
</div>
<p>We can also use stroked and filled paths to stroke the outline
of text. Normally, we can only draw filled text in R, but the new
<code>grid.stroke()</code> function treats its first argument as just a path
to draw the outline of. For example, the following code strokes the
outline of the text “path”.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.stroke.html'>grid.stroke</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.text.html'>textGrob</a></span><span class='op'>(</span><span class='st'>"path"</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>cex<span class='op'>=</span><span class='fl'>2.5</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-26-1.png" width="100" /></p>
</div>
<h3 data-number="2.6" id="compositing-operators"><span class="header-section-number">2.6</span> Compositing operators</h3>
<p>Normally when we draw two shapes in R, the second shape is drawn on
top of the first shape; if the two shapes overlap, the second shape
will obscure the first shape.
For example, the following code defines two concentric circles,
a larger one with a blue fill and a smaller one with a black fill.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>circle1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>circleGrob</a></span><span class='op'>(</span>r<span class='op'>=</span><span class='fl'>.35</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='st'>"blue"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-27-1.png" width="100" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>circle2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>circleGrob</a></span><span class='op'>(</span>r<span class='op'>=</span><span class='fl'>.25</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-28-1.png" width="100" /></p>
</div>
<p>If we draw these circles, one after the other, the black circle
partially obscures the blue circle.
In technical terms, the black circle is <em>composited</em> with the
blue circle using an “over” operator.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>circle1</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>circle2</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-29-1.png" width="100" /></p>
</div>
<p>The <code>grid.group()</code> function in R allows us to select a different
compositing operator. For example, the following code
draws the two circles again, but this time using a “dest.out”
operator, which means that, instead of drawing the black circle
on top of the blue circle, the blue circle is removed where it
is overlapped by the black circle (and the black circle is not
drawn at all).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.group.html'>grid.group</a></span><span class='op'>(</span><span class='va'>circle2</span>, <span class='st'>"dest.out"</span>, <span class='va'>circle1</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-30-1.png" width="100" /></p>
</div>
<p>The ability to control the compositing operator provides us with
one way to draw a circle with a semi-transparent gradient border
that we saw in the very first example in the Introduction.
First, we define two circles, one with a semi-transparent gradient fill
and one with a black fill.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>dst</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>circleGrob</a></span><span class='op'>(</span>r<span class='op'>=</span><span class='fl'>.35</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='va'>gradient</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-31-1.png" width="100" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>src</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>circleGrob</a></span><span class='op'>(</span>r<span class='op'>=</span><span class='fl'>.25</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-32-1.png" width="100" /></p>
</div>
<p>Then we composite the black circle with the semi-transparent circle,
using <code>"dest.out"</code>, which creates a hole in the semi-transparent circle.
The result is a circle with a semi-transparent
gradient border.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.group.html'>grid.group</a></span><span class='op'>(</span><span class='va'>src</span>, <span class='st'>"dest.out"</span>, <span class='va'>dst</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-33-1.png" width="100" /></p>
</div>
<p>The full set of Porter-Duff compositing operators <span class="citation" data-cites="PorterDuff">(<a href="#ref-PorterDuff" role="doc-biblioref">Porter and Duff 1984</a>)</span>
are available along with a set of “blend modes” from
the PDF language specification <span class="citation" data-cites="PDF">(<a href="#ref-PDF" role="doc-biblioref">Adobe Systems Incorporated 2001</a>)</span>.</p>
<h2 data-number="3" id="integration"><span class="header-section-number">3</span> Integrating with higher-level interfaces</h2>
<p>In this section we look at several more complex
examples to show how the new graphics features might be
used as part of a high-level plot.</p>
<p>Some features are already accessible via high-level interfaces like
<a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> and its extension packages. We saw one example of
adding a background linear gradient to a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot
in Figure <a href="#fig:ggplot2bg">2</a>.
Furthermore, the following code demonstrates that some <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> extension
packages also already make use of the new graphics features. In this case,
we are using the <code>stat_gradientinterval()</code> function from the
<a href="https://cran.r-project.org/package=ggdist">ggdist</a> package <span class="citation" data-cites="pkg:ggdist">(<a href="#ref-pkg:ggdist" role="doc-biblioref">Kay 2023</a>)</span>
to draw linear gradients that represent within-group variability
(see Figure <a href="#fig:ggdist">4</a>).
<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>
In theory, any package that extends <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> can potentially
make use of the
new features because extending <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> involves writing
<a href="#">grid</a> code.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mjskay.github.io/ggdist/'>ggdist</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://pkg.mitchelloharawild.com/distributional/'>distributional</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>TGsummary</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='http://mjskay.github.io/ggdist/reference/stat_gradientinterval.html'>stat_gradientinterval</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>dose</span>, ydist<span class='op'>=</span><span class='fu'><a href='https://pkg.mitchelloharawild.com/distributional/reference/dist_normal.html'>dist_normal</a></span><span class='op'>(</span><span class='va'>len.mean</span>, <span class='va'>len.sd</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='st'>"supp"</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:ggdist"></span>
<img src="RJ-2023-072_files/figure-html5/ggdist-1.png" alt="A plot with two panels and three groups in each panel.  Each group is represented by a dot at the centre of a vertical line.  There is also a vertical linear gradient for each vertical line that fades from darker at the middle to lighter at the ends of the line." width="100%" />
<p class="caption">
Figure 4: A ggdist plot that uses linear gradients to represent variability within groups.
</p>
</div>
</div>
<h3 data-number="3.1" id="integrating-with-ggplot2"><span class="header-section-number">3.1</span> Integrating with ggplot2</h3>
<p>Where there is no interface yet for new graphics features
in <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> or its extension packages,
it is possible to access the new graphics features using the
<a href="https://cran.r-project.org/package=gggrid">gggrid</a> package <span class="citation" data-cites="pkg:gggrid">(<a href="#ref-pkg:gggrid" role="doc-biblioref">Murrell 2022a</a>)</span>.
For example, the following example uses <a href="https://cran.r-project.org/package=gggrid">gggrid</a> to access
the new feature for drawing stroked paths in order to draw outlined text
within a <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot.</p>
<p>The first step is to write a function that generates a description of
something to draw. The following code first creates a <code>textGrob()</code>
and then creates a <code>strokeGrob()</code> that will draw the outline of the text
with a thick white line.
The function returns a <code>grobTree()</code> that will draw the original
text on top of the thick white outline.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/pmur002/gggrid'>gggrid</a></span><span class='op'>)</span></span>
<span><span class='va'>outlineLabel</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>coords</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>text</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.text.html'>textGrob</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>$</span><span class='va'>percent</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='st'>"%"</span><span class='op'>)</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>cex<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/grid/grid.grob.html'>grobTree</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.stroke.html'>strokeGrob</a></span><span class='op'>(</span><span class='va'>text</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='st'>"white"</span>, lwd<span class='op'>=</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>             <span class='va'>text</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<p>The following code draws a faceted <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> plot, where each panel
consists of an array
of yellow and gray tiles.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>
The call to <code>grid_panel()</code> means that the <code>outlineLabel()</code>
function that we defined above
is called for each panel of the plot, which
adds the outlined text to each panel (see Figure <a href="#fig:gggrid">5</a>).</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>judges</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_tile</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, fill<span class='op'>=</span><span class='va'>race</span><span class='op'>)</span>, color<span class='op'>=</span><span class='st'>"white"</span>, lwd<span class='op'>=</span><span class='fl'>.7</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/gggrid/man/grid_panel.html'>grid_panel</a></span><span class='op'>(</span><span class='va'>outlineLabel</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>percent<span class='op'>=</span><span class='va'>Freq</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>judgeCounts</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='st'>"president"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>white<span class='op'>=</span><span class='st'>"#F8C216"</span>, other<span class='op'>=</span><span class='st'>"grey80"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>aspect.ratio<span class='op'>=</span><span class='fl'>1</span>,</span>
<span>          legend.position<span class='op'>=</span><span class='st'>"none"</span><span class='op'>)</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:gggrid"></span>
<img src="RJ-2023-072_files/figure-html5/gggrid-1.png" alt="A plot with two matrices of 100 squares, some of which are filled yellow and the rest grey.  On top of each matrix there is a text annotation that has a thick white outline." width="400" />
<p class="caption">
Figure 5: Outlined text on a ggplot2 plot produced with the gggrid package and stroked paths.
</p>
</div>
</div>
<p>This particular result (outlined text) can also be produced using
the <a href="https://cran.r-project.org/package=shadowtext">shadowtext</a> package <span class="citation" data-cites="pkg:shadowtext">(<a href="#ref-pkg:shadowtext" role="doc-biblioref">Yu 2022</a>)</span>. However, that
package currently produces outlined text by drawing
17 different copies of the text (slightly offset from each other)
to get the final result. This is an example
where an existing package may be able to gain some efficiencies by
adopting some of the new graphics features.</p>
<h3 data-number="3.2" id="integrating-with-lattice"><span class="header-section-number">3.2</span> Integrating with lattice</h3>
<p>The <a href="https://cran.r-project.org/package=lattice">lattice</a> package <span class="citation" data-cites="pkg:lattice">(<a href="#ref-pkg:lattice" role="doc-biblioref">Sarkar 2008</a>)</span> provides an alternative
high-level plotting system. For example, the following code
uses <a href="https://cran.r-project.org/package=lattice">lattice</a> to draw a line plot representing two mathematical functions.
The plot has a transparent background and heavy grid lines, which
creates a problem where the legend overlaps with the grid lines
(see Figure <a href="#fig:lattice">6</a>).</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://lattice.r-forge.r-project.org/'>lattice</a></span><span class='op'>)</span></span>
<span><span class='va'>key</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>text<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='va'>y1</span> <span class='op'>==</span> <span class='va'>x</span><span class='op'>^</span><span class='fl'>2</span>, <span class='va'>y2</span> <span class='op'>==</span> <span class='va'>x</span><span class='op'>^</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>                      lines<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='fl'>2</span><span class='op'>:</span><span class='fl'>3</span>, lwd<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>,</span>
<span>                      padding.text<span class='op'>=</span><span class='fl'>3</span>,</span>
<span>                      border<span class='op'>=</span><span class='cn'>TRUE</span>,</span>
<span>                      x<span class='op'>=</span><span class='fl'>.5</span>, y<span class='op'>=</span><span class='fl'>.75</span>, corner<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='fl'>.5</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/lattice/man/xyplot.html'>xyplot</a></span><span class='op'>(</span><span class='va'>y1</span> <span class='op'>+</span> <span class='va'>y2</span> <span class='op'>~</span> <span class='va'>x</span>, type<span class='op'>=</span><span class='st'>"l"</span>, lwd<span class='op'>=</span><span class='fl'>3</span>, col<span class='op'>=</span><span class='fl'>2</span><span class='op'>:</span><span class='fl'>3</span>,</span>
<span>       panel<span class='op'>=</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span> </span>
<span>                 <span class='fu'><a href='https://rdrr.io/pkg/lattice/man/panel.functions.html'>panel.grid</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='op'>-</span><span class='fl'>1</span>, v<span class='op'>=</span><span class='op'>-</span><span class='fl'>1</span>, col<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span></span>
<span>                 <span class='fu'><a href='https://rdrr.io/pkg/lattice/man/panel.xyplot.html'>panel.xyplot</a></span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span></span>
<span>       <span class='op'>}</span>,</span>
<span>       key<span class='op'>=</span><span class='va'>key</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:lattice"></span>
<img src="RJ-2023-072_files/figure-html5/lattice-1.png" alt="A plot of two mathematical functions represented by smooth coloured lines.  There are reference grid lines and a legend that overlaps two of the grid lines." width="100%" />
<p class="caption">
Figure 6: A plot of two mathematical functions drawn with the lattice package. The checkerboard pattern is there to show that the plot itself has a transparent background.
</p>
</div>
</div>
<p>The <a href="https://cran.r-project.org/package=lattice">lattice</a> package, like <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>,
is based on <a href="#">grid</a>, and we can easily access the <a href="#">grid</a>
interface to new graphics features by calling <a href="#">grid</a> functions
from within the <code>panel</code> function in the <code>xyplot()</code> call.
We will use this to access the new masking feature so that the
drawing of the grid lines
does not overlap with the legend.</p>
<p>The first step is to use the <code>draw.key()</code> function from <a href="https://cran.r-project.org/package=lattice">lattice</a>,
which gives us a <a href="#">grid</a> object that describes the legend that <a href="https://cran.r-project.org/package=lattice">lattice</a>
will draw.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>keygrob</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/lattice/man/draw.key.html'>draw.key</a></span><span class='op'>(</span>key<span class='op'>=</span><span class='va'>key</span>, vp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/viewport.html'>viewport</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>.5</span>, y<span class='op'>=</span><span class='fl'>.75</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The following code defines a mask, based on that <code>keygrob</code>,
that is a black rectangle with a hole
where the legend will be drawn. This uses a filled path that is
based on a much larger rectangle with the <code>keygrob</code> inside it to create
the hole.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>keyMask</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.stroke.html'>fillGrob</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.stroke.html'>as.path</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.grob.html'>grobTree</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.rect.html'>rectGrob</a></span><span class='op'>(</span>width<span class='op'>=</span><span class='fl'>2</span>, height<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>,</span>
<span>                                     <span class='va'>keygrob</span><span class='op'>)</span>,</span>
<span>                            rule<span class='op'>=</span><span class='st'>"evenodd"</span>,</span>
<span>                            gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Now we can draw the <a href="https://cran.r-project.org/package=lattice">lattice</a> plot again, but this time we push
a <a href="#">grid</a> viewport that enforces the <code>keyMask</code> and draw
the grid lines within that viewport. This means that
the grid lines are not drawn where they overlap with the legend
(see Figure <a href="#fig:legend">7</a>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/lattice/man/xyplot.html'>xyplot</a></span><span class='op'>(</span><span class='va'>y1</span> <span class='op'>+</span> <span class='va'>y2</span> <span class='op'>~</span> <span class='va'>x</span>, type<span class='op'>=</span><span class='st'>"l"</span>, lwd<span class='op'>=</span><span class='fl'>3</span>, col<span class='op'>=</span><span class='fl'>2</span><span class='op'>:</span><span class='fl'>3</span>,</span>
<span>       panel<span class='op'>=</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span> </span>
<span>                 <span class='va'>limits</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/lattice/man/panel.axis.html'>current.panel.limits</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>                 <span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>pushViewport</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/viewport.html'>viewport</a></span><span class='op'>(</span>mask<span class='op'>=</span><span class='va'>keyMask</span>, </span>
<span>                                       xscale<span class='op'>=</span><span class='va'>limits</span><span class='op'>$</span><span class='va'>xlim</span>, </span>
<span>                                       yscale<span class='op'>=</span><span class='va'>limits</span><span class='op'>$</span><span class='va'>ylim</span><span class='op'>)</span><span class='op'>)</span></span>
<span>                 <span class='fu'><a href='https://rdrr.io/pkg/lattice/man/panel.functions.html'>panel.grid</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='op'>-</span><span class='fl'>1</span>, v<span class='op'>=</span><span class='op'>-</span><span class='fl'>1</span>, col<span class='op'>=</span><span class='st'>"black"</span><span class='op'>)</span></span>
<span>                 <span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>popViewport</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>                 <span class='fu'><a href='https://rdrr.io/pkg/lattice/man/panel.xyplot.html'>panel.xyplot</a></span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span></span>
<span>       <span class='op'>}</span>,</span>
<span>       key<span class='op'>=</span><span class='va'>key</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:legend"></span>
<img src="RJ-2023-072_files/figure-html5/legend-1.png" alt="A plot of two mathematical functions with grid lines and a legend, like the previous figure, except that the grid lines are not drawn where they would overlap with the legend." width="100%" />
<p class="caption">
Figure 7: A lattice plot with a mask used to only draw the grid lines where they do not overlap with the legend. The checkerboard pattern is there to show that the plot itself has a transparent background.
</p>
</div>
</div>
<h3 data-number="3.3" id="integrating-with-base-graphics"><span class="header-section-number">3.3</span> Integrating with base graphics</h3>
<p>There is no interface to the new graphics features for
the base graphics system (the <a href="#">graphics</a> package) or packages
that build on it. However, the
<a href="https://cran.r-project.org/package=gridGraphics">gridGraphics</a> package <span class="citation" data-cites="pkg:gridGraphics">(<a href="#ref-pkg:gridGraphics" role="doc-biblioref">Murrell and Wen 2020</a>)</span>
can be used to convert base graphics to <a href="#">grid</a>
and then the <a href="#">grid</a> interface can be used to access the
new graphics features.</p>
<p>For example, the following code uses base graphics to draw a map
with a set of contour regions overlaid
(see the map on the left in Figure <a href="#fig:map">8</a>).</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>maps</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mar<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/maps/man/map.html'>map</a></span><span class='op'>(</span><span class='st'>"nz"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/invisible.html'>invisible</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mapply.html'>mapply</a></span><span class='op'>(</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>c</span>, <span class='va'>col</span>, <span class='va'>fill</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>                     <span class='fu'><a href='https://rdrr.io/r/graphics/polygon.html'>polygon</a></span><span class='op'>(</span><span class='va'>c</span><span class='op'>$</span><span class='va'>x</span>, <span class='va'>c</span><span class='op'>$</span><span class='va'>y</span>, default.units<span class='op'>=</span><span class='st'>"native"</span>, </span>
<span>                             border<span class='op'>=</span><span class='va'>col</span>, col<span class='op'>=</span><span class='va'>fill</span><span class='op'>)</span></span>
<span>                 <span class='op'>}</span>,</span>
<span>                 <span class='va'>contours</span>, <span class='va'>colours</span>, <span class='va'>fills</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:map"></span>
<img src="RJ-2023-072_files/figure-html5/map-1.png" alt="Two maps of New Zealand with contour regions overlaid.  On the left, the contour regions extend beyond the map boundaries.  On the right, the contour regions are clipped to the map boundaries." width="100%" />
<p class="caption">
Figure 8: Left: A set of contours drawn on top of a map using base graphics; Right: The same map, converted to grid graphics using the gridGraphics package, with the contours clipped by using the boundary of the map as the clipping path.
</p>
</div>
</div>
<p>The following code redraws the map, but
uses the new clipping paths feature to clip the
contour regions with the map boundary as the clipping path.
The first step is to draw the map as before, but this time we also
record the coordinates of the map outline and use them to create
a clipping path.
Next, we use the <code>grid.echo()</code> function from the <a href="https://cran.r-project.org/package=gridGraphics">gridGraphics</a> package
to convert the map into a <a href="#">grid</a> drawing, which includes a set
of <a href="#">grid</a> viewports.
We navigate to the viewport where the map was drawn
(<code>"graphics-window-1-0A"</code>) so that we have the correct coordinate
system and then we push a viewport with the clipping path.
Finally, we draw the contour regions, which are clipped
to the outline of the map (see the map on the right of
Figure <a href="#fig:map">8</a>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mar<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>outline</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/maps/man/map.html'>map</a></span><span class='op'>(</span><span class='st'>"nz"</span><span class='op'>)</span></span>
<span><span class='va'>clipPath</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.lines.html'>polylineGrob</a></span><span class='op'>(</span><span class='va'>outline</span><span class='op'>$</span><span class='va'>x</span>, <span class='va'>outline</span><span class='op'>$</span><span class='va'>y</span>, default.units<span class='op'>=</span><span class='st'>"native"</span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/pmur002/gridgraphics'>gridGraphics</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/gridGraphics/man/grid.echo.html'>grid.echo</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>downViewport</a></span><span class='op'>(</span><span class='st'>"graphics-window-1-0A"</span><span class='op'>)</span></span>
<span><span class='va'>cvp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/current.viewport.html'>current.viewport</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>pushViewport</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/viewport.html'>viewport</a></span><span class='op'>(</span>xscale<span class='op'>=</span><span class='va'>cvp</span><span class='op'>$</span><span class='va'>xscale</span>, yscale<span class='op'>=</span><span class='va'>cvp</span><span class='op'>$</span><span class='va'>yscale</span>,</span>
<span>                      clip<span class='op'>=</span><span class='va'>clipPath</span><span class='op'>)</span><span class='op'>)</span>                      </span>
<span><span class='fu'><a href='https://rdrr.io/r/base/invisible.html'>invisible</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mapply.html'>mapply</a></span><span class='op'>(</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>c</span>, <span class='va'>col</span>, <span class='va'>fill</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>                     <span class='fu'><a href='https://rdrr.io/r/grid/grid.polygon.html'>grid.polygon</a></span><span class='op'>(</span><span class='va'>c</span><span class='op'>$</span><span class='va'>x</span>, <span class='va'>c</span><span class='op'>$</span><span class='va'>y</span>, default.units<span class='op'>=</span><span class='st'>"native"</span>, </span>
<span>                                  gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='va'>col</span>, fill<span class='op'>=</span><span class='va'>fill</span><span class='op'>)</span><span class='op'>)</span></span>
<span>                 <span class='op'>}</span>,</span>
<span>                 <span class='va'>contours</span>, <span class='va'>colours</span>, <span class='va'>fills</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>clipPath</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>popViewport</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 data-number="3.4" id="drawing-with-grid"><span class="header-section-number">3.4</span> Drawing with grid</h3>
<p>In some cases, it can be easier to produce a complete plot
just using <a href="#">grid</a>, rather than using a high-level system
like <a href="https://cran.r-project.org/package=lattice">lattice</a> or <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>.
With this approach, all of the new graphics features
are available. For example, the following code draws the original example
from Figure <a href="#fig:diagram">1</a> (reproduced again in
Figure <a href="#fig:gridfig">9</a>).</p>
<p>First, we define a linear gradient (gray that becomes more transparent from
left to right) and then we define a function that draws a circle
with that linear gradient as its border (as described in the section
on compositing operators).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>grid</span><span class='op'>)</span></span>
<span><span class='va'>grad</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/patterns.html'>linearGradient</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='fl'>.1</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>                       y1<span class='op'>=</span><span class='fl'>.5</span>, y2<span class='op'>=</span><span class='fl'>.5</span><span class='op'>)</span></span>
<span><span class='va'>gradientCircle</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>r</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>circle1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>circleGrob</a></span><span class='op'>(</span>y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='va'>y</span>, <span class='st'>"native"</span><span class='op'>)</span>,</span>
<span>                          r<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='va'>r</span>, <span class='st'>"native"</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>1.5</span>, <span class='st'>"mm"</span><span class='op'>)</span>, </span>
<span>                          gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='va'>grad</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='va'>circle2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>circleGrob</a></span><span class='op'>(</span>y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='va'>y</span>, <span class='st'>"native"</span><span class='op'>)</span>,</span>
<span>                          r<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='va'>r</span>, <span class='st'>"native"</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>1.5</span>, <span class='st'>"mm"</span><span class='op'>)</span>, </span>
<span>                          gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fill<span class='op'>=</span><span class='st'>"white"</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/grid/grid.group.html'>grid.group</a></span><span class='op'>(</span><span class='va'>circle2</span>, <span class='st'>"dest.out"</span>, <span class='va'>circle1</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<p>The main plot is drawn by dividing up the image into columns, using
a <code>grid.layout()</code>, with each
column the correct width for one of the circles.
We then run a loop and, for each circle, we push a viewport into
one of the layout columns, call the <code>gradientCircle()</code> function to
draw a circle, add a text label at the
center of the circle, add another label above the circle, and
draw a line segment that starts just above the first label and ends just below
the second label (see Figure <a href="#fig:gridfig">9</a>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.rect.html'>grid.rect</a></span><span class='op'>(</span>gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='cn'>NA</span>, fill<span class='op'>=</span><span class='st'>"grey95"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>pushViewport</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/viewport.html'>viewport</a></span><span class='op'>(</span>width<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"npc"</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='st'>"mm"</span><span class='op'>)</span>,</span>
<span>                      y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>1.5</span>, <span class='st'>"mm"</span><span class='op'>)</span>, just<span class='op'>=</span><span class='st'>"bottom"</span>,</span>
<span>                      layout<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/grid.layout.html'>grid.layout</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>numCircles</span>,</span>
<span>                                         widths<span class='op'>=</span><span class='va'>circleWidths</span>, heights<span class='op'>=</span><span class='va'>h</span>, </span>
<span>                                         respect<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>numCircles</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>pushViewport</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grid/viewport.html'>viewport</a></span><span class='op'>(</span>layout.pos.col<span class='op'>=</span><span class='va'>i</span>, yscale<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>h</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='fu'>gradientCircle</span><span class='op'>(</span><span class='va'>circleRadii</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, <span class='va'>circleRadii</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span></span>
<span>    <span class='va'>amountGrob</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.text.html'>textGrob</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>amount</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, <span class='st'>"%"</span><span class='op'>)</span>,</span>
<span>                           <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>.5</span>, <span class='st'>"npc"</span><span class='op'>)</span>, </span>
<span>                           <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='va'>circleRadii</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, <span class='st'>"native"</span><span class='op'>)</span>,</span>
<span>                           gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='va'>purple</span>,</span>
<span>                                   fontface<span class='op'>=</span><span class='st'>"bold"</span>,</span>
<span>                                   cex<span class='op'>=</span><span class='fl'>1</span> <span class='op'>+</span> <span class='va'>amount</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>amount</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='va'>labelGrob</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grid/grid.text.html'>textGrob</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/chartr.html'>toupper</a></span><span class='op'>(</span><span class='va'>label</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>,</span>
<span>                          <span class='fl'>.5</span>, <span class='fl'>.7</span>,</span>
<span>                          just<span class='op'>=</span><span class='st'>"bottom"</span>,</span>
<span>                          gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>fontface<span class='op'>=</span><span class='st'>"bold"</span>, cex<span class='op'>=</span><span class='fl'>.7</span>, lineheight<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>amountGrob</span><span class='op'>)</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/grid/grid.draw.html'>grid.draw</a></span><span class='op'>(</span><span class='va'>labelGrob</span><span class='op'>)</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/grid/grid.segments.html'>grid.segments</a></span><span class='op'>(</span><span class='fl'>.5</span>,</span>
<span>                  <span class='fu'><a href='https://rdrr.io/r/grid/grobX.html'>grobY</a></span><span class='op'>(</span><span class='va'>amountGrob</span>, <span class='fl'>90</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"mm"</span><span class='op'>)</span>,</span>
<span>                  <span class='fl'>.5</span>,</span>
<span>                  <span class='fu'><a href='https://rdrr.io/r/grid/grobX.html'>grobY</a></span><span class='op'>(</span><span class='va'>labelGrob</span>, <span class='fl'>270</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"mm"</span><span class='op'>)</span>,</span>
<span>                  gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='va'>purple</span>, lwd<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/grid/viewports.html'>popViewport</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:gridfig"></span>
<img src="RJ-2023-072_files/figure-html5/gridfig-1.png" alt="A reproduction of the original image from the Introduction." width="100%" />
<p class="caption">
Figure 9: A diagram with a semi-transparent linear gradient on each circle border. This is a reproduction of the original image from the Introduction.
</p>
</div>
</div>
<h2 data-number="4" id="discussion"><span class="header-section-number">4</span> Discussion</h2>
<p>Since R 4.1.0, support for a number of new graphics features has been
added to the R graphics engine. These features are available via
functions in the <a href="#">grid</a> package, with some higher-level interfaces
also appearing, for example in the <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> package and its
extensions.</p>
<p>A small number of
examples have been provided to show how the new graphics features
might be useful within the context of a statistical plot, but
it is hopefully clear that a very large
range of other graphical images could be generated with gradients,
patterns, clipping paths, masks, compositing operators,
and stroked/filled paths.</p>
<p>The trick to solving a particular graphical problem
is being able to express the problem in terms of the graphical
tools at our disposal.
If we just want to draw a blue circle,
we only have to know how to draw a circle
and how to specify the color blue.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.circle.html'>grid.circle</a></span><span class='op'>(</span>r<span class='op'>=</span><span class='fl'>.3</span>, gp<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grid/gpar.html'>gpar</a></span><span class='op'>(</span>col<span class='op'>=</span><span class='st'>"blue"</span>, fill<span class='op'>=</span><span class='st'>"blue"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-45-1.png" width="100" /></p>
</div>
<p>However, if we want to draw a circle with a thick semi-transparent gradient
border, we cannot express a solution in terms of circles and the color
blue. We need additional tools, like knowing how to describe a
linear gradient and knowing what the <code>"dest.out"</code> compositing operator does,
and how to define a group with a specific compositing operator.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/grid/grid.group.html'>grid.group</a></span><span class='op'>(</span><span class='va'>src</span>, <span class='st'>"dest.out"</span>, <span class='va'>dst</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="RJ-2023-072_files/figure-html5/unnamed-chunk-47-1.png" width="100" /></p>
</div>
<p>By adding more graphical tools, we increase our ability to express
problems in terms of our graphical tools and we
give ourselves a better chance of finding solutions to
graphical problems.
As argued at the very beginning of this document, the ability to produce more
complex and fine-detailed images, entirely in code, means that we can
avoid costly and inefficient manual
fine-tuning of our final images.</p>
<h3 data-number="4.1" id="limitations"><span class="header-section-number">4.1</span> Limitations</h3>
<p>It is important to note that not all of the new features
in the R graphics engine are supported
on all graphics devices.
Most features are fully supported on Cairo-based graphics devices, e.g.,
<code>png(type="cairo")</code> and <code>svg()</code>, though these devices do not support
luminance masks.
Most features are also supported on the
<code>pdf()</code> device, including luminance masks, but
the Porter-Duff compositing operators are not supported.
Most features are supported by the <code>quartz()</code> device (on macOS)
from R version 4.3.0, though not alpha masks and not paths based on text.
The <code>grDevices::dev.capabilities()</code> function can be used to report on
the level of support in the current graphics device.</p>
<p>Several R packages that provide graphics devices have also added at least
some support for these features. For example, the <a href="https://cran.r-project.org/package=ragg">ragg</a> package
<span class="citation" data-cites="pkg:ragg">(<a href="#ref-pkg:ragg" role="doc-biblioref">Pedersen and Shemanarev 2022</a>)</span>
and the <a href="https://cran.r-project.org/package=svglite">svglite</a> package <span class="citation" data-cites="pkg:svglite">(<a href="#ref-pkg:svglite" role="doc-biblioref">Wickham et al. 2022</a>)</span>
have support for gradients, patterns, clipping paths, and masks at least.</p>
<p>It is also important to note that
some PDF viewers do not render features like masks correctly,
so it may appear that the <code>pdf()</code> device is not working when in fact
it is a problem with the viewing software.</p>
<h3 data-number="4.2" id="related-and-prior-work"><span class="header-section-number">4.2</span> Related and prior work</h3>
<p>Although support for gradients, patterns, clipping paths, and masks
has only been added to the R graphics engine (and supported
in some graphics devices, with a user interface in <code>grid</code>) since
R version 4.1.0,
at least some of these capabilities have been available in
some form via CRAN packages, in some cases for many years.
This section, acknowledges some of these packages and discusses
the advantages and disadvantages of having the capabilities
available in the R graphics engine.</p>
<p>The <a href="https://cran.r-project.org/package=gridSVG">gridSVG</a> package <span class="citation" data-cites="pkg:gridSVG">(<a href="#ref-pkg:gridSVG" role="doc-biblioref">Murrell and Potter 2022</a>)</span> has
provided an interface to many graphical features of the SVG language
(including gradients, patterns, clipping paths, and masks)
since 2011.
Some advantages of this package are that it provides access to
features that are still not available in the R graphics engine,
including filter effects (such as “blur”) and animation.
The downsides to this package include the fact that
it can only generate SVG output and it
can only work with graphics drawn by <code>grid</code>, although the
<a href="https://cran.r-project.org/package=gridGraphics">gridGraphics</a> package can help with that.</p>
<p>The <a href="https://cran.r-project.org/package=gridpattern">gridpattern</a> and
the <a href="https://cran.r-project.org/package=ggpattern">ggpattern</a> packages both provide ways to fill regions
with a pattern. These packages make use of the
new features in the R graphics engine, e.g., to limit a pattern fill
to a region by setting a clipping path or mask. In other words, they
build upon the new features that are available in R itself.
Some of the advantages of these packages include:
a set of predefined patterns and, in the case of <a href="https://cran.r-project.org/package=ggpattern">ggpattern</a>,
a higher-level interface to pattern fills that is compatible with
<code>ggplot2</code>.</p>
<p>The <a href="https://cran.r-project.org/package=ggfx">ggfx</a> package <span class="citation" data-cites="pkg:ggfx">(<a href="#ref-pkg:ggfx" role="doc-biblioref">Pedersen 2022</a>)</span> provides filter effects
at both the <code>grid</code> and <code>ggplot2</code> level.
On one hand, this package complements the new features in the R graphics
engine by adding filter effects.
However, there is also a considerable overlap because several filters
provide results similar or identical to the graphics engine features.
For example,
<code>ggfx::with_mask()</code> provides masking and <code>ggfx::with_blend()</code> provides
compositing operators.
The advantages of this package include filter effects that are
not available in R itself (such as “blur”) and a high-level interface
that is integrated with <code>ggplot2</code>.
On the other hand, this package works only with raster images,
whereas the graphics engine is vector-based
so it can produce better quality scalable images, at least on
some devices.</p>
<p>The <a href="https://cran.r-project.org/package=magick">magick</a> package <span class="citation" data-cites="pkg:magick">(<a href="#ref-pkg:magick" role="doc-biblioref">Ooms 2021</a>)</span> is not entirely unlike
<a href="https://cran.r-project.org/package=ggfx">ggfx</a> in that it provides access to raster-based image
operations that include, for example,
<code>magick::image_flatten()</code> for compositing
operators, <code>magick::image_composite()</code>, which can perform masking,
and <code>magick::image_blur()</code> for a blur filter effect.
A major difference is that <code>magick</code> works on entire
images whereas <code>ggfx</code> can isolate its effects to only specific
elements of an image. A combination of <code>magick</code>
and the <a href="https://cran.r-project.org/package=rasterize">rasterize</a> package <span class="citation" data-cites="pkg:rasterize">(<a href="#ref-pkg:rasterize" role="doc-biblioref">Murrell 2019</a>)</span> could be used
to limit the effects to just elements of an image, but <code>ggfx</code>
provides a more convenient and higher-level interface.</p>
<p>The <a href="https://cran.r-project.org/package=gridGeometry">gridGeometry</a> package <span class="citation" data-cites="pkg:gridGeometry">(<a href="#ref-pkg:gridGeometry" role="doc-biblioref">Murrell and Wong 2022</a>)</span> overlaps
with some of the new masking, compositing, and path-drawing features
of the new graphics engine because
it can combine several paths to produce a single new path.
For example, <code>gridGeometry::grid.polyclip()</code> can be used to
punch a hole in one shape using another shape.
The advantage of this package is that, for the features that it
supports, it works entirely with
vector images, including returning vector results.</p>
<h3 data-number="4.3" id="further-reading"><span class="header-section-number">4.3</span> Further reading</h3>
<p>The graphical features introduced in this document are explained in much greater
detail in the series of technical reports listed below.
Maintainers of R packages that provide third-party graphics devices
will find information about the graphics device interface to the new
graphics features in these reports.</p>
<ul>
<li><p><a href="https://stattech.blogs.auckland.ac.nz/2020/07/14/2020-04-catching-up-with-r-graphics/">“Catching Up with R Graphics: Gradients, Patterns, Clipping Paths, and Masks”</a> <span class="citation" data-cites="murrell-definitions-2020">(<a href="#ref-murrell-definitions-2020" role="doc-biblioref">Murrell 2020</a>)</span></p></li>
<li><p><a href="https://stattech.blogs.auckland.ac.nz/2021/11/15/2021-02-groups-compositing-operators-and-affine-transformations-in-r-graphics">“Becoming an R Graphics Groupie: Groups, Compositing Operators, and Affine Transformations in R Graphics”</a> <span class="citation" data-cites="murrell-groups-2021">(<a href="#ref-murrell-groups-2021" role="doc-biblioref">Murrell 2021a</a>)</span></p></li>
<li><p><a href="https://stattech.blogs.auckland.ac.nz/2021/11/16/2021-03-stroking-and-filling-paths-in-r-graphics">“The Path to Path Enlightenment: Stroking and Filling Paths in R Graphics”</a> <span class="citation" data-cites="murrell-paths-2021">(<a href="#ref-murrell-paths-2021" role="doc-biblioref">Murrell 2021c</a>)</span></p></li>
<li><p><a href="https://stattech.blogs.auckland.ac.nz/2021/12/01/2021-04-luminance-masks-in-r-graphics">“Luminance Masks in R Graphics”</a> <span class="citation" data-cites="murrell-masks-2021">(<a href="#ref-murrell-masks-2021" role="doc-biblioref">Murrell 2021b</a>)</span></p></li>
<li><p><a href="https://stattech.wordpress.fos.auckland.ac.nz/2022/06/01/2022-01-vectorised-pattern-fills-in-r-graphics/">“Vectorised Pattern Fills in R Graphics”</a> <span class="citation" data-cites="murrell-vecpat-2022">(<a href="#ref-murrell-vecpat-2022" role="doc-biblioref">Murrell 2022b</a>)</span></p></li>
<li><p><a href="https://stattech.wordpress.fos.auckland.ac.nz/2023/05/22/2023-02-porter-duff-compositing-operators-in-r-graphics/">“Porter-Duff Compositing Operators in R Graphics”</a> <span class="citation" data-cites="murrell-pedersen-skintzos-compositing-2023">(<a href="#ref-murrell-pedersen-skintzos-compositing-2023" role="doc-biblioref">Murrell et al. 2023</a>)</span></p></li>
</ul>
<h2 data-number="5" id="rgraphics"><span class="header-section-number">5</span> Appendix: The structure of R graphics</h2>
<p>This appendix gives a brief introduction to how the (static, 2D)
graphics systems
in R are organized (see Figure <a href="#fig:structure">10</a>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:structure"></span>
<img src="figures/rgraphics.png" alt="A node-and-edge graph: the ggplot2 node and the lattice node are connected to the grid node;  the maps node is connected to the graphics node;  the grid node and the graphics node are connected to the grDevices node;  the grDevices node is connected to the pdf node, the png node, and the ragg node." width="70%" />
<p class="caption">
Figure 10: The structure of R graphics. The features described in this paper involved changes to the grid and grDevices packages, plus some of the graphics devices that are provided with R. Some of the features are becoming available via higher-level packages like ggplot2 and some of the features are supported in external graphics devices like those provided by the ragg package.
</p>
</div>
</div>
<p>R has two low-level graphics systems, which are provided by the
<a href="#">graphics</a> (“base graphics”) and <a href="#">grid</a> packages.
These provide functions for drawing basic shapes and text.
They both rely on a “graphics engine”, roughly corresponding to
the <a href="#">grDevices</a> package, which provides facilities for specifying
things like colors and fonts.</p>
<p>The <a href="#">graphics</a> package can also draw some high-level plots,
such as scatter plots and bar plots, and many other packages build
on it to offer a much wider range of high-level plots.
Similarly, several packages build on top of <a href="#">grid</a> to provide
high-level plots, notably, <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> and <a href="https://cran.r-project.org/package=lattice">lattice</a>.</p>
<p>Graphical output is generated by a set of “graphics devices”,
some of which are provided with R, with others provided by
packages like <a href="https://cran.r-project.org/package=ragg">ragg</a>.</p>
<p>Typically, an R user will call functions from a package like <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>
or <a href="#">graphics</a>
to draw a high-level plot.<br />
Those packages will call lower-level functions, in <a href="#">graphics</a>
or <a href="#">grid</a>, which in turn call functions in the graphics engine.
Finally, the graphics engine send instructions to a graphics device to
do the actual drawing.</p>
<p>The new graphics features described in this document have mostly involved
changes to the graphics engine and <a href="#">grid</a> and some
graphics devices, which means that users may have to call <a href="#">grid</a>
functions to access the new features and the new features will only
work on some graphics devices
(as indicated by the gray nodes in Figure <a href="#fig:structure">10</a>).
However, some of the new features are accessible from <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>
and its extensions and some packages that provide graphics devices
have added support (as indicated by the nodes with gray gradients
in Figure <a href="#fig:structure">10</a>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h3 class="appendix" data-number="5.1" id="supplementary-materials"><span class="header-section-number">5.1</span> Supplementary materials</h3>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2023-072.zip">RJ-2023-072.zip</a></p>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-PDF" class="csl-entry" role="listitem">
Adobe Systems Incorporated. <em>PDF reference: Adobe portable document format version 1.4.</em> 3rd ed 2001. URL <a href="https://www.adobe.com/content/dam/acom/en/devnet/pdf/pdfs/pdf_reference_archives/PDFReference.pdf">https://www.adobe.com/content/dam/acom/en/devnet/pdf/pdfs/pdf_reference_archives/PDFReference.pdf</a>.
</div>
<div id="ref-pkg:ggdist" class="csl-entry" role="listitem">
M. Kay. <em><span class="nocase">ggdist</span>: Visualizations of distributions and uncertainty.</em> 2023. URL <a href="https://mjskay.github.io/ggdist/">https://mjskay.github.io/ggdist/</a>. R package version 3.2.1.
</div>
<div id="ref-murrell-definitions-2020" class="csl-entry" role="listitem">
P. Murrell. Catching up with <span>R</span> graphics. 2020-04. Department of Statistics, The University of Auckland. 2020. DOI <a href="https://doi.org/10.17608/k6.auckland.12649751">10.17608/k6.auckland.12649751</a>. version 1.
</div>
<div id="ref-pkg:gggrid" class="csl-entry" role="listitem">
P. Murrell. <em><span class="nocase">gggrid</span>: Draw with <span class="nocase">’grid’</span> in <span class="nocase">’ggplot2’</span>.</em> 2022a. URL <a href="https://CRAN.R-project.org/package=gggrid">https://CRAN.R-project.org/package=gggrid</a>. R package version 0.2-0.
</div>
<div id="ref-murrell-groups-2021" class="csl-entry" role="listitem">
P. Murrell. Groups, compositing operators, and affine transformations in <span>R</span> graphics. 2021-02. Department of Statistics, The University of Auckland. 2021a. DOI <a href="https://doi.org/10.17608/k6.auckland.17009120">10.17608/k6.auckland.17009120</a>. version 2.
</div>
<div id="ref-murrell-masks-2021" class="csl-entry" role="listitem">
P. Murrell. Luminance masks in <span>R</span> graphics. 2021-04. Department of Statistics, The University of Auckland. 2021b. DOI <a href="https://doi.org/10.17608/k6.auckland.17102657">10.17608/k6.auckland.17102657</a>. version 1.
</div>
<div id="ref-pkg:rasterize" class="csl-entry" role="listitem">
P. Murrell. <em><span class="nocase">rasterize</span>: Rasterize graphical output.</em> 2019. URL <a href="https://CRAN.R-project.org/package=rasterize">https://CRAN.R-project.org/package=rasterize</a>. R package version 0.1.
</div>
<div id="ref-murrell-paths-2021" class="csl-entry" role="listitem">
P. Murrell. Stroking and filling paths in <span>R</span> graphics. 2021-03. Department of Statistics, The University of Auckland. 2021c. DOI <a href="https://doi.org/10.17608/k6.auckland.17019272">10.17608/k6.auckland.17019272</a>. version 1.
</div>
<div id="ref-murrell-vecpat-2022" class="csl-entry" role="listitem">
P. Murrell. Vectorised pattern fills in <span>R</span> graphics. 2022-01. Department of Statistics, The University of Auckland. 2022b. DOI <a href="https://doi.org/10.17608/k6.auckland.19945787">10.17608/k6.auckland.19945787</a>. version 1.
</div>
<div id="ref-murrell-pedersen-skintzos-compositing-2023" class="csl-entry" role="listitem">
P. Murrell, T. L. Pedersen and P. Skintzos. Porter-duff compositing operators in <span>R</span> graphics. 2023-02. Department of Statistics, The University of Auckland. 2023. DOI <a href="https://doi.org/10.17608/k6.auckland.23034641">10.17608/k6.auckland.23034641</a>. version 1.
</div>
<div id="ref-pkg:gridSVG" class="csl-entry" role="listitem">
P. Murrell and S. Potter. <em><span class="nocase">gridSVG</span>: Export <span class="nocase">’grid’</span> graphics as <span>SVG</span>.</em> 2022. URL <a href="https://r-forge.r-project.org/projects/gridsvg/">https://r-forge.r-project.org/projects/gridsvg/</a>. R package version 1.7-5.
</div>
<div id="ref-pkg:gridGraphics" class="csl-entry" role="listitem">
P. Murrell and Z. Wen. <em><span class="nocase">gridGraphics</span>: Redraw base graphics using <span class="nocase">’grid’</span> graphics.</em> 2020. URL <a href="https://CRAN.R-project.org/package=gridGraphics">https://CRAN.R-project.org/package=gridGraphics</a>. R package version 0.5-1.
</div>
<div id="ref-pkg:gridGeometry" class="csl-entry" role="listitem">
P. Murrell and J. Wong. <em><span class="nocase">gridGeometry</span>: Polygon geometry in <span class="nocase">’grid’</span>.</em> 2022. URL <a href="https://CRAN.R-project.org/package=gridGeometry">https://CRAN.R-project.org/package=gridGeometry</a>. R package version 0.3-0.
</div>
<div id="ref-pkg:magick" class="csl-entry" role="listitem">
J. Ooms. <em><span class="nocase">magick</span>: Advanced graphics and image-processing in <span>R</span>.</em> 2021. URL <a href="https://CRAN.R-project.org/package=magick">https://CRAN.R-project.org/package=magick</a>. R package version 2.7.3.
</div>
<div id="ref-pkg:ggfx" class="csl-entry" role="listitem">
T. L. Pedersen. <em><span class="nocase">ggfx</span>: Pixel filters for <span class="nocase">’ggplot2’</span> and <span class="nocase">’grid’</span>.</em> 2022. URL <a href="https://CRAN.R-project.org/package=ggfx">https://CRAN.R-project.org/package=ggfx</a>. R package version 1.0.1.
</div>
<div id="ref-pkg:ragg" class="csl-entry" role="listitem">
T. L. Pedersen and M. Shemanarev. <em><span class="nocase">ragg</span>: Graphic devices based on <span>AGG</span>.</em> 2022. URL <a href="https://CRAN.R-project.org/package=ragg">https://CRAN.R-project.org/package=ragg</a>. R package version 1.2.2.
</div>
<div id="ref-PorterDuff" class="csl-entry" role="listitem">
T. Porter and T. Duff. Compositing digital images. <em>SIGGRAPH Comput. Graph.</em>, 18(3): 253–259, 1984. DOI <a href="https://doi.org/10.1145/964965.808606">10.1145/964965.808606</a>.
</div>
<div id="ref-pkg:lattice" class="csl-entry" role="listitem">
D. Sarkar. <em>Lattice: Multivariate data visualization with <span>R</span>.</em> New York: Springer, 2008. URL <a href="http://lmdvr.r-forge.r-project.org">http://lmdvr.r-forge.r-project.org</a>.
</div>
<div id="ref-book:ggplot2" class="csl-entry" role="listitem">
H. Wickham. <em><span class="nocase">ggplot2</span>: Elegant graphics for data analysis.</em> Springer-Verlag New York, 2016. URL <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-pkg:svglite" class="csl-entry" role="listitem">
H. Wickham, L. Henry, T. L. Pedersen, T. J. Luciani, M. Decorde and V. Lise. <em><span class="nocase">svglite</span>: An <span>SVG</span> graphics device.</em> 2022. URL <a href="https://CRAN.R-project.org/package=svglite">https://CRAN.R-project.org/package=svglite</a>. R package version 2.1.0.
</div>
<div id="ref-pkg:shadowtext" class="csl-entry" role="listitem">
G. Yu. <em><span class="nocase">shadowtext</span>: Shadow text grob and layer.</em> 2022. URL <a href="https://CRAN.R-project.org/package=shadowtext">https://CRAN.R-project.org/package=shadowtext</a>. R package version 0.1.2.
</div>
</div>
<aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>This image was inspired by a <a href="https://stackoverflow.com/questions/69755844/is-it-possible-to-draw-the-following-diagram-in-r">post on stack overflow</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Code that generates the data, in this case <code>TGsummary</code>, will not be
shown in this section, but it is available as part of the supplementary
materials for this article.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This example is based on a
<a href="https://stackoverflow.com/questions/70529987/outlined-letters-in-text-ggplot2-538-style">stackoverflow post</a>, which itself is based on a
<a href="https://fivethirtyeight.com/features/trump-made-the-federal-courts-whiter-and-more-conservative-and-that-will-be-tough-for-biden-to-reverse/">post on fivethirtyeight.com</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Murrell, "Updates to the R Graphics Engine:  One Person's Chart Junk is Another's Chart Treasure", The R Journal, 2023</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2023-072,
  author = {Murrell, Paul},
  title = {Updates to the R Graphics Engine:  One Person's Chart Junk is Another's Chart Treasure},
  journal = {The R Journal},
  year = {2023},
  note = {https://doi.org/10.32614/RJ-2023-072},
  doi = {10.32614/RJ-2023-072},
  volume = {15},
  issue = {3},
  issn = {2073-4859},
  pages = {257-276}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
