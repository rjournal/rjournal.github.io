<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
      margin-bottom: 0em;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>SimEngine: A Modular Framework for Statistical Simulations in R</title>

<meta property="description" itemprop="description" content="This article describes&#10;[**SimEngine**](https://CRAN.R-project.org/package=SimEngine), an&#10;open-source R package for structuring, maintaining, running, and&#10;debugging statistical simulations on both local and cluster-based&#10;computing environments. Several R packages exist for facilitating&#10;simulations, but&#10;[**SimEngine**](https://CRAN.R-project.org/package=SimEngine) is the&#10;only package specifically designed for running simulations in parallel&#10;via job schedulers on high-performance cluster computing systems. The&#10;package provides structure and functionality for common simulation&#10;tasks, such as setting simulation levels, managing seeds for random&#10;number generation, and calculating summary metrics (such as bias and&#10;confidence interval coverage).&#10;[**SimEngine**](https://CRAN.R-project.org/package=SimEngine) also&#10;brings several unique features, such as automatic calculation of Monte&#10;Carlo error and information sharing across simulation replicates. We&#10;provide an overview of the package and demonstrate some of its&#10;advanced functionality."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2025-010/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2025-08-12"/>
<meta property="article:created" itemprop="dateCreated" content="2025-08-12"/>
<meta name="article:author" content="Avi Kenny"/>
<meta name="article:author" content="Charles J. Wolock"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="SimEngine: A Modular Framework for Statistical Simulations in R"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="This article describes&#10;[**SimEngine**](https://CRAN.R-project.org/package=SimEngine), an&#10;open-source R package for structuring, maintaining, running, and&#10;debugging statistical simulations on both local and cluster-based&#10;computing environments. Several R packages exist for facilitating&#10;simulations, but&#10;[**SimEngine**](https://CRAN.R-project.org/package=SimEngine) is the&#10;only package specifically designed for running simulations in parallel&#10;via job schedulers on high-performance cluster computing systems. The&#10;package provides structure and functionality for common simulation&#10;tasks, such as setting simulation levels, managing seeds for random&#10;number generation, and calculating summary metrics (such as bias and&#10;confidence interval coverage).&#10;[**SimEngine**](https://CRAN.R-project.org/package=SimEngine) also&#10;brings several unique features, such as automatic calculation of Monte&#10;Carlo error and information sharing across simulation replicates. We&#10;provide an overview of the package and demonstrate some of its&#10;advanced functionality."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2025-010/"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="SimEngine: A Modular Framework for Statistical Simulations in R"/>
<meta property="twitter:description" content="This article describes&#10;[**SimEngine**](https://CRAN.R-project.org/package=SimEngine), an&#10;open-source R package for structuring, maintaining, running, and&#10;debugging statistical simulations on both local and cluster-based&#10;computing environments. Several R packages exist for facilitating&#10;simulations, but&#10;[**SimEngine**](https://CRAN.R-project.org/package=SimEngine) is the&#10;only package specifically designed for running simulations in parallel&#10;via job schedulers on high-performance cluster computing systems. The&#10;package provides structure and functionality for common simulation&#10;tasks, such as setting simulation levels, managing seeds for random&#10;number generation, and calculating summary metrics (such as bias and&#10;confidence interval coverage).&#10;[**SimEngine**](https://CRAN.R-project.org/package=SimEngine) also&#10;brings several unique features, such as automatic calculation of Monte&#10;Carlo error and information sharing across simulation replicates. We&#10;provide an overview of the package and demonstrate some of its&#10;advanced functionality."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2025-010/"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="SimEngine: A Modular Framework for Statistical Simulations in R"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2025-010"/>
<meta name="citation_pdf_url" content="RJ-2025-010.pdf"/>
<meta name="citation_volume" content="17"/>
<meta name="citation_issue" content="1"/>
<meta name="citation_doi" content="10.32614/RJ-2025-010"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="200"/>
<meta name="citation_lastpage" content="220"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2025/08/12"/>
<meta name="citation_publication_date" content="2025/08/12"/>
<meta name="citation_author" content="Avi Kenny"/>
<meta name="citation_author_institution" content="Department of Biostatistics and Bioinformatics, Duke University"/>
<meta name="citation_author" content="Charles J. Wolock"/>
<meta name="citation_author_institution" content="Department of Biostatistics and Computational Biology, University of Rochester"/>
<!--/radix_placeholder_meta_tags-->
  
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","date_received","journal","volume","issue","slug","citation_url","packages","preview","bibliography","CTV","legacy_pdf","legacy_converted","output","draft","pdf_url","doi","creative_commons","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["SimEngine: A Modular Framework for Statistical Simulations in R"]},{"type":"character","attributes":{},"value":["This article describes\n[**SimEngine**](https://CRAN.R-project.org/package=SimEngine), an\nopen-source R package for structuring, maintaining, running, and\ndebugging statistical simulations on both local and cluster-based\ncomputing environments. Several R packages exist for facilitating\nsimulations, but\n[**SimEngine**](https://CRAN.R-project.org/package=SimEngine) is the\nonly package specifically designed for running simulations in parallel\nvia job schedulers on high-performance cluster computing systems. The\npackage provides structure and functionality for common simulation\ntasks, such as setting simulation levels, managing seeds for random\nnumber generation, and calculating summary metrics (such as bias and\nconfidence interval coverage).\n[**SimEngine**](https://CRAN.R-project.org/package=SimEngine) also\nbrings several unique features, such as automatic calculation of Monte\nCarlo error and information sharing across simulation replicates. We\nprovide an overview of the package and demonstrate some of its\nadvanced functionality."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","orcid_id","address"]}},"value":[{"type":"character","attributes":{},"value":["Avi Kenny"]},{"type":"character","attributes":{},"value":["Department of Biostatistics and Bioinformatics, Duke University"]},{"type":"character","attributes":{},"value":["0000-0002-9465-7307"]},{"type":"character","attributes":{},"value":["Global Health Institute, Duke University","2424 Erwin Rd","Durham, NC 27710, USA","[avi.kenny@duke.edu](avi.kenny@duke.edu){.uri}\n"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","orcid_id","address"]}},"value":[{"type":"character","attributes":{},"value":["Charles J. Wolock"]},{"type":"character","attributes":{},"value":["Department of Biostatistics and Computational Biology, University of Rochester"]},{"type":"character","attributes":{},"value":["0000-0003-3527-1102"]},{"type":"character","attributes":{},"value":["University of Rochester","265 Crittenden Boulevard, CU 420630","Rochester, New York 14642-0630","[c.wolock@rochester.edu](c.wolock@rochester.edu){.uri}\n"]}]}]},{"type":"character","attributes":{},"value":["2025-08-12"]},{"type":"character","attributes":{},"value":["2025-02-06"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[200]},{"type":"integer","attributes":{},"value":[220]}]},{"type":"integer","attributes":{},"value":[17]},{"type":"integer","attributes":{},"value":[1]},{"type":"character","attributes":{},"value":["RJ-2025-010"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2025-010"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["SimEngine","magrittr","parallel","simulator","simpr","simFrame","SimDesign","simsalapar","simChef","riskSimul","GlmSimulatoR","PhenotypeSimulator","future","rslurm"]},{"type":"list","attributes":{},"value":[]}]},{"type":"character","attributes":{},"value":["preview.png"]},{"type":"character","attributes":{},"value":["article.bib"]},{"type":"character","attributes":{},"value":["Finance","HighPerformanceComputing","MissingData"]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","mathjax","md_extension"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"]},{"type":"character","attributes":{},"value":["-tex_math_single_backslash"]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["RJ-2025-010.pdf"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2025-010"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["/home/hyndman/R/x86_64-pc-linux-gnu-library/4.5/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2025-010/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["article.bib","article.pdf","article.tex","RJ-2025-010_files/anchor-4.2.2/anchor.min.js","RJ-2025-010_files/bowser-1.9.3/bowser.min.js","RJ-2025-010_files/distill-2.2.21/template.v2.js","RJ-2025-010_files/header-attrs-2.29/header-attrs.js","RJ-2025-010_files/jquery-3.6.0/jquery-3.6.0.js","RJ-2025-010_files/jquery-3.6.0/jquery-3.6.0.min.js","RJ-2025-010_files/jquery-3.6.0/jquery-3.6.0.min.map","RJ-2025-010_files/popper-2.6.0/popper.min.js","RJ-2025-010_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2025-010_files/tippy-6.2.7/tippy-light-border.css","RJ-2025-010_files/tippy-6.2.7/tippy.css","RJ-2025-010_files/tippy-6.2.7/tippy.umd.min.js","RJ-2025-010_files/webcomponents-2.0.0/webcomponents.js","RJ-2025-010.pdf","RJ-2025-010.zip","RJournal.sty","RJwrapper.aux","RJwrapper.bbl","RJwrapper.blg","RJwrapper.brf","RJwrapper.fdb_latexmk","RJwrapper.fls","RJwrapper.log","RJwrapper.out","RJwrapper.tex","supp.zip"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.29/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Mathjax config (add automatic linebreaks when supported)
      // MathJax = {
      //    tex: {
      //        inlineMath: [['$', '$'], ['\\(', '\\)']],
      //        displayMath: [['$$', '$$'], ['\\[', '\\]']],
      //        tags: 'ams',
      //        multline: true,
      //    },
      //    options: {
      //        linebreaks: { automatic: true },
      //    },
      // };

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="' + slug + '.zip" class="dt-tag"><i class="fas fa-file-zipper"></i> Supplement</a>')

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").filter(function() {
        return !$(this).hasClass("subtitle");
      }).first();
      if (tpar) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append(tpar) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"SimEngine: A Modular Framework for Statistical Simulations in R","description":"This article describes\n[**SimEngine**](https://CRAN.R-project.org/package=SimEngine), an\nopen-source R package for structuring, maintaining, running, and\ndebugging statistical simulations on both local and cluster-based\ncomputing environments. Several R packages exist for facilitating\nsimulations, but\n[**SimEngine**](https://CRAN.R-project.org/package=SimEngine) is the\nonly package specifically designed for running simulations in parallel\nvia job schedulers on high-performance cluster computing systems. The\npackage provides structure and functionality for common simulation\ntasks, such as setting simulation levels, managing seeds for random\nnumber generation, and calculating summary metrics (such as bias and\nconfidence interval coverage).\n[**SimEngine**](https://CRAN.R-project.org/package=SimEngine) also\nbrings several unique features, such as automatic calculation of Monte\nCarlo error and information sharing across simulation replicates. We\nprovide an overview of the package and demonstrate some of its\nadvanced functionality.","doi":"10.32614/RJ-2025-010","authors":[{"author":"Avi Kenny","authorURL":"#","affiliation":"Department of Biostatistics and Bioinformatics, Duke University","affiliationURL":"#","orcidID":"0000-0002-9465-7307"},{"author":"Charles J. Wolock","authorURL":"#","affiliation":"Department of Biostatistics and Computational Biology, University of Rochester","affiliationURL":"#","orcidID":"0000-0003-3527-1102"}],"publishedDate":"2025-08-12T00:00:00.000+00:00","citationText":"Kenny & Wolock, 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues/2024-4">Current</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../submissions.html">Submit</a>
<a href="../../editors.html">Editorial board</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>SimEngine: A Modular Framework for Statistical Simulations in R</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>This article describes
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>, an
open-source R package for structuring, maintaining, running, and
debugging statistical simulations on both local and cluster-based
computing environments. Several R packages exist for facilitating
simulations, but
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> is the
only package specifically designed for running simulations in parallel
via job schedulers on high-performance cluster computing systems. The
package provides structure and functionality for common simulation
tasks, such as setting simulation levels, managing seeds for random
number generation, and calculating summary metrics (such as bias and
confidence interval coverage).
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> also
brings several unique features, such as automatic calculation of Monte
Carlo error and information sharing across simulation replicates. We
provide an overview of the package and demonstrate some of its
advanced functionality.</p></p>
</div>

<div class="d-byline">
  Avi Kenny  (Department of Biostatistics and Bioinformatics, Duke University)
  
,   Charles J. Wolock  (Department of Biostatistics and Computational Biology, University of Rochester)
  
<br/>2025-08-12
</div>

<div class="d-article">
<div class="article">
<h3 data-number="1" id="sec:intro"><span class="header-section-number">1</span> Introduction</h3>
<p>For the past several decades, the design and execution of simulation
studies has been a pillar of methodological research in statistics
(Hauck and Anderson 1984). Simulations are commonly used to evaluate
finite sample performance of proposed statistical procedures, but can
also be used to identify problems with existing methods, ensure that
statistical code functions as designed, and test out new ideas in an
exploratory manner. Additionally, simulation can be a statistical method
in itself; two common examples are study power calculation (Arnold et
al. 2011) and sampling from a complex distribution (Wakefield 2013).</p>
<p>Although the power of personal computers has increased exponentially
over the last four decades, many simulation studies require far more
computing power than what is available on even a high-end laptop.
Accordingly, many academic (bio)statistics departments and research
institutions have invested in so-called cluster computing systems (CCS),
which are essentially networks of servers available for high-throughput
parallel computation. A single CCS typically serves many researchers,
can be securely accessed remotely, and operates job scheduling software
(e.g., Slurm) designed to coordinate the submission and management of
computing tasks between multiple groups of users.</p>
<p>Thankfully, the majority of statistical simulations can be easily
parallelized, since they typically involve running the same (or nearly
the same) code many times and then performing an analysis of the results
of these replicates. This allows for a simulation study to be done
hundreds or thousands of times faster than if the user ran the same code
on their laptop. Despite this, many potential users never leverage an
available CCS; a major reason for this is that it can be difficult to
get R and the CCS to “work together,” even for an experienced
programmer.</p>
<p>To address this gap, we created
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>, an
open-source R package (R Core Team 2021) for structuring, maintaining,
running, and debugging statistical simulations on both local and
cluster-based computing environments. Several R packages exist for
structuring simulations (see Section
<a href="#sec:discussion" data-reference-type="ref" data-reference="sec:discussion">6</a>);
however, <a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>
is the only package specifically designed for running simulations both
locally and in parallel on a high-performance CCS. The package provides
structure and functionality for common simulation tasks, such as setting
simulation levels, managing random number generator (RNG) seeds, and
calculating summary metrics (such as bias and confidence interval
coverage). In addition,
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> offers a
number of unique features, such as automatic calculation of Monte Carlo
error (Koehler, Brown, and Haneuse 2009) and information sharing across
simulation replicates.</p>
<p>This article is organized as follows. In Section
<a href="#sec:design" data-reference-type="ref" data-reference="sec:design">2</a>, we
outline the overarching design principles of the package. In Section
<a href="#sec:overview" data-reference-type="ref" data-reference="sec:overview">3</a>, we
give a broad overview of the
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> simulation
workflow. In Section <a href="#sec:parallel" data-reference-type="ref" data-reference="sec:parallel">4</a>, we describe how simulations can be
parallelized both locally and on a CCS. Section
<a href="#sec:advanced" data-reference-type="ref" data-reference="sec:advanced">5</a>
contains details on advanced functionality of the package. The Appendix
includes two example simulation studies carried out using
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>.</p>
<h3 data-number="2" id="sec:design"><span class="header-section-number">2</span> Design principles</h3>
<p>There are four main principles that guided the design of
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>, which we
refer to as (1) generality, (2) modularity, (3) parallelizability, and
(4) appropriate scope. We discuss each in turn.</p>
<p>The first principle is <em>generality</em>. Many simulation frameworks assume
that users will have a particular type of workflow that involves a data
generation step, an analysis step, and an evaluation step. This
three-step workflow is common — in fact, we use it to illustrate the
use of the package in the introductory documentation — but we also do
not want to impose this workflow on the user and disallow other possible
workflows. In
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>, instead
of providing facilities for the user to specify a data-generating step,
an analysis step, and an evaluation step, the user writes R code
representing a single simulation replicate within a special function
called the <em>simulation script</em>. This imposes virtually no constraints on
what the user is able to do within their simulations, and allows for
workflows that cannot be shoehorned into this three-step process, such
as simulations involving resampling from existing datasets, complex data
transformations, saving intermediate objects or plots, and so on. The
only requirement of the simulation script is that it returns data in a
specific format (to facilitate processing of results), but this format
is completely general and allows for arbitrarily complex objects
(matrices, dataframes, model objects, etc.) to be returned in addition
to simple numeric values.</p>
<p>The second principle is <em>modularity</em>. In short, it should be simple and
straightforward to change one component of a simulation without breaking
other components, such as adding a new estimator or changing a sample
size. Additionally, it should be easy to run additional simulation
replicates, possibly with certain elements changed, without having to
rerun the entire simulation. Finally, the step of evaluating the results
of a simulation should be completely separated from the step of actually
running the simulation replicates. This implies that a user does not
need to decide in advance how they are going to summarize or visualize
their results, and that they can calculate new summary statistics,
produce new visualizations, and otherwise process their simulation
results in an exploratory manner, possibly long after the simulation
itself has been run. In short, we designed
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> to mirror
the real-world workflow of statistical simulations, in which researchers
often make small changes in response to new ideas or results.</p>
<p>The third principle is <em>parallelizability</em>. As mentioned in Section
<a href="#sec:intro" data-reference-type="ref" data-reference="sec:intro">1</a>, a primary
reason for creating
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> was to
build a package that encapsulated the repetitive tasks related to both
local and CCS parallelization. We have seen firsthand that many
statistical researchers run time-consuming simulations serially on their
laptops because the barrier to entry for parallelizing code,
particularly on a CCS, is daunting. It is our hope that making
parallelization as easy as possible will allow researchers to easily
leverage parallelization hardware and boost productivity.</p>
<p>The fourth principle is <em>appropriate scope</em>. We designed
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> to <em>only</em>
provide functionality related to simulations. While some other packages
provide functionality to plot results, for example, we intentionally
choose to not do so, since all analysts have their own preferences when
it comes to displaying data. Similarly, unlike many packages, we do not
provide functionality to generate certain data structures, since this
would bloat the package and still only satisfy the needs of a small
handful of users.</p>
<p>Finally, although not a software design principle per se, an additional
goal of <a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>
was to create documentation that assumes as little statistical knowledge
as possible. Different statisticians have different areas of background
knowledge, and we wanted to avoid having potential users sidetracked by
trying to understand the statistics of a particular example rather than
understand the functions and workflow of
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>.
Accordingly, we strove to create the simplest possible illustrations and
examples in the package documentation. In general, we aimed to make the
documentation as comprehensive and accessible as possible, while
remaining concise and minimizing the barriers to entry.</p>
<h3 data-number="3" id="sec:overview"><span class="header-section-number">3</span> Overview of simulation workflow and primary functions</h3>
<p>The latest stable version of
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> can be
installed from CRAN using <code>install.packages</code>. The current development
version can be installed using <code>devtools::install_github</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">&quot;SimEngine&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="at">repo=</span><span class="st">&quot;Avi-Kenny/SimEngine&quot;</span>)</span></code></pre></div>
<p>The goal of many statistical simulations is to compare the behavior of
two or more statistical methods; we use this framework to demonstrate
the <a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>
workflow. Most statistical simulations of this type include three basic
phases: (1) generate data, (2) run one or more methods using the
generated data, and (3) compare the performance of the methods.</p>
<p>To briefly illustrate how these phases are implemented using
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>, we use a
simple example of estimating the rate parameter <span class="math inline">\(\lambda\)</span> of a
<span class="math inline">\(\text{Poisson}(\lambda)\)</span> distribution. To anchor the simulation in a
real-world situation, one can imagine that a sample of size <span class="math inline">\(n\)</span> from
this Poisson distribution models the number of patients admitted daily
to a hospital over the course of <span class="math inline">\(n\)</span> consecutive days. Suppose that the
data consist of <span class="math inline">\(n\)</span> independent and identically distributed observations
<span class="math inline">\(X_1, X_2, \ldots, X_n\)</span> drawn from a Poisson(<span class="math inline">\(\lambda\)</span>) distribution.
Since the <span class="math inline">\(\lambda\)</span> parameter of the Poisson distribution is equal to
both the mean and the variance, one may ask whether the sample mean
<span class="math inline">\(\hat{\lambda}_{M,n}:= \frac{1}{n}\sum_{i=1}^{n}X_i\)</span> or the sample
variance
<span class="math inline">\(\hat{\lambda}_{V,n} := \frac{1}{n-1}\sum_{i=1}^{n}(X_i - \hat{\lambda}_{M,n})^2\)</span>
is a better estimator of <span class="math inline">\(\lambda\)</span>.</p>
<h4 class="unnumbered" data-number="3.1" id="load-the-package-and-create-a-simulation-object">Load the package and create a simulation object</h4>
<p>After loading the package, the first step is to create a simulation
object (an R object of class <code>sim_obj</code>) using the <code>new_sim</code> function.
The simulation object contains all data, functions, and results related
to the simulation.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">library</span>(SimEngine)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span></code></pre></div>
<h4 class="unnumbered" data-number="3.2" id="code-a-function-to-generate-data">Code a function to generate data</h4>
<p>Many simulations involve a function that creates a dataset designed to
mimic a real-world data-generating mechanism. Here, we write and test a
simple function to generate a sample of <code>n</code> observations from a Poisson
distribution with <span class="math inline">\(\lambda = 20\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> create_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span>(<span class="fu">rpois</span>(<span class="at">n=</span>n, <span class="at">lambda=</span><span class="dv">20</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  }</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">create_data</span>(<span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="dv">18</span> <span class="dv">25</span> <span class="dv">25</span> <span class="dv">21</span> <span class="dv">13</span> <span class="dv">22</span> <span class="dv">23</span> <span class="dv">22</span> <span class="dv">18</span> <span class="dv">26</span></span></code></pre></div>
<h4 class="unnumbered" data-number="3.3" id="code-the-methods-or-other-functions">Code the methods (or other functions)</h4>
<p>With <a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>, any
functions declared (or loaded via <code>source</code>) are automatically stored in
the simulation object when the simulation runs. In this example, we test
the sample mean and sample variance estimators of the <span class="math inline">\(\lambda\)</span>
parameter. For simplicity, we write this as a single function and use
the <code>type</code> argument to specify which estimator to use.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> est_lambda <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, type) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;M&quot;</span>) { <span class="fu">return</span>(<span class="fu">mean</span>(dat)) }</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;V&quot;</span>) { <span class="fu">return</span>(<span class="fu">var</span>(dat)) }</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  }</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> dat <span class="ot">&lt;-</span> <span class="fu">create_data</span>(<span class="at">n=</span><span class="dv">1000</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">est_lambda</span>(<span class="at">dat=</span>dat, <span class="at">type=</span><span class="st">&quot;M&quot;</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">19.646</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">est_lambda</span>(<span class="at">dat=</span>dat, <span class="at">type=</span><span class="st">&quot;V&quot;</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">20.8195</span></span></code></pre></div>
<h4 class="unnumbered" data-number="3.4" id="set-the-simulation-levels">Set the simulation levels</h4>
<p>Often, we wish to run the same simulation multiple times. We refer to
each run as a <em>simulation replicate</em>. We may wish to vary certain
features of the simulation between replicates. In this example, perhaps
we choose to vary the sample size and the estimator used to estimate
<span class="math inline">\(\lambda\)</span>. We refer to the features that vary as <em>simulation levels</em>; in
the example below, the simulation levels are the sample size (<code>n</code>) and
the estimator (<code>estimator</code>). We refer to the values that each simulation
level can take on as <em>level values</em>; in the example below, the <code>n</code> level
values are <code>10</code>, <code>100</code>, and <code>1000</code>, and the <code>estimator</code> level values are
<code>‘‘M’’</code> (for “sample mean”) and <code>‘‘V’’</code> (for “sample variance”). We also
refer to a combination of level values as a <em>scenario</em>; in this example,
the combination of <code>n=10</code> and <code>estimator=‘‘M’’</code> is one of the six
possible scenarios defined by the two values of <code>n</code> and the three values
of <code>estimator</code>. By default,
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> runs one
simulation replicate for each scenario, although the user will typically
want to increase this; 1,000 or 10,000 replicates per scenario is
common. An appropriate number of replicates per scenario may be informed
by the desired level of Monte Carlo error; see Section
<a href="#sec:mc_error" data-reference-type="ref" data-reference="sec:mc_error">5.6</a>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">estimator =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;V&quot;</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span></code></pre></div>
<p>Note that we make extensive use of the pipe operators (<code>%&gt;%</code> and <code>%&lt;&gt;%</code>)
from the <a href="https://CRAN.R-project.org/package=magrittr"><strong>magrittr</strong></a>
package (Bache and Wickham 2022). Briefly, the operator <code>%&gt;%</code> takes the
object to the left of the operator and “pipes” it to (the first argument
of) the function to the right of the operator; the operator <code>%&lt;&gt;%</code> does
the same thing, but then assigns the result back to the variable to the
left of the operator. For example, <code>x %&gt;% mean()</code> is equivalent to
<code>mean(x)</code> and <code>x %&lt;&gt;% mean()</code> is equivalent to <code>x &lt;- mean(x)</code>. See the
<a href="https://CRAN.R-project.org/package=magrittr"><strong>magrittr</strong></a>
documentation for further detail.</p>
<h4 class="unnumbered" data-number="3.5" id="create-a-simulation-script">Create a simulation script</h4>
<p>The simulation script is a user-written function that assembles the
pieces above (generating data, analyzing the data, and returning
results) to code the flow of a single simulation replicate. Within a
script, the level values for the current scenario can be referenced
using the special variable <code>L</code>. For instance, in the running example,
when the first simulation replicate is running, <code>L$estimator</code> will equal
<code>‘‘M’’</code> and <code>L$n</code> will equal <code>10</code>. In the next replicate, <code>L$estimator</code>
will equal <code>‘‘M’’</code> and <code>L$n</code> will equal <code>100</code>, and so on. The simulation
script will automatically have access to any functions or objects that
have been declared in the global environment.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    dat <span class="ot">&lt;-</span> <span class="fu">create_data</span>(<span class="at">n=</span>L<span class="sc">$</span>n)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    lambda_hat <span class="ot">&lt;-</span> <span class="fu">est_lambda</span>(<span class="at">dat=</span>dat, <span class="at">type=</span>L<span class="sc">$</span>estimator)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span> (<span class="fu">list</span>(<span class="st">&quot;lambda_hat&quot;</span><span class="ot">=</span>lambda_hat))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  })</span></code></pre></div>
<p>The simulation script should always return a list containing one or more
key-value pairs, where the keys are syntactically valid names. The
values may be simple data types (numbers, character strings, or boolean
values) or more complex data types (lists, dataframes, model objects,
etc.); see Section <a href="#ssec_complex" data-reference-type="ref" data-reference="ssec_complex">5.3</a> for how to handle complex data types. Note
that in this example, the estimators could have been coded instead as
two different functions and then called from within the script using the
<code>use_method</code> function.</p>
<h4 class="unnumbered" data-number="3.6" id="set-the-simulation-configuration">Set the simulation configuration</h4>
<p>The <code>set_config</code> function controls options related to the entire
simulation, such as the number of simulation replicates to run for each
scenario and the parallelization type, if desired (see Section
<a href="#sec:parallel" data-reference-type="ref" data-reference="sec:parallel">4</a>).
Packages needed for the simulation should be specified using the
<code>packages</code> argument of <code>set_config</code> (rather than using <code>library</code> or
<code>require</code>). We set <code>num_sim</code> to 100, and so
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> will run a
total of 600 simulation replicates (100 for each of the six scenarios).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">num_sim =</span> <span class="dv">100</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;stringr&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span></code></pre></div>
<h4 class="unnumbered" data-number="3.7" id="run-the-simulation">Run the simulation</h4>
<p>All 600 replicates are run at once and results are stored in the
simulation object.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span><span class="do">########################################| 100%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>Done. No errors or warnings detected.</span></code></pre></div>
<h4 class="unnumbered" data-number="3.8" id="view-and-summarize-results">View and summarize results</h4>
<p>Once the simulation replicates have finished running, the <code>summarize</code>
function can be used to calculate common summary statistics, such as
bias, variance, mean squared error (MSE), and confidence interval
coverage.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">list</span>(<span class="at">stat=</span><span class="st">&quot;bias&quot;</span>, <span class="at">name=</span><span class="st">&quot;bias_lambda&quot;</span>, <span class="at">estimate=</span><span class="st">&quot;lambda_hat&quot;</span>, <span class="at">truth=</span><span class="dv">20</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">list</span>(<span class="at">stat=</span><span class="st">&quot;mse&quot;</span>, <span class="at">name=</span><span class="st">&quot;mse_lambda&quot;</span>, <span class="at">estimate=</span><span class="st">&quot;lambda_hat&quot;</span>, <span class="at">truth=</span><span class="dv">20</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  level_id estimator    n n_reps bias_lambda   mse_lambda</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="dv">1</span>         M   <span class="dv">10</span>    <span class="dv">100</span> <span class="sc">-</span><span class="fl">0.17600000</span>   <span class="fl">1.52480000</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="dv">2</span>         V   <span class="dv">10</span>    <span class="dv">100</span> <span class="sc">-</span><span class="fl">1.80166667</span> <span class="fl">103.23599630</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        <span class="dv">3</span>         M  <span class="dv">100</span>    <span class="dv">100</span> <span class="sc">-</span><span class="fl">0.03770000</span>   <span class="fl">0.19165100</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>        <span class="dv">4</span>         V  <span class="dv">100</span>    <span class="dv">100</span>  <span class="fl">0.22910707</span>   <span class="fl">7.72262714</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>        <span class="dv">5</span>         M <span class="dv">1000</span>    <span class="dv">100</span>  <span class="fl">0.01285000</span>   <span class="fl">0.01553731</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>        <span class="dv">6</span>         V <span class="dv">1000</span>    <span class="dv">100</span>  <span class="fl">0.02514744</span>   <span class="fl">0.92133037</span></span></code></pre></div>
<p>In this example, we see that the MSE of the sample variance is much
higher than that of the sample mean and that MSE decreases with
increasing sample size for both estimators, as expected. From the
<code>n_reps</code> column, we see that 100 replicates were successfully run for
each scenario. Results for individual simulation replicates can also be
directly accessed via the <code>sim$results</code> dataframe.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">head</span>(sim<span class="sc">$</span>results)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  sim_uid level_id rep_id estimator  n      runtime lambda_hat</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="dv">1</span>        <span class="dv">1</span>      <span class="dv">1</span>         M <span class="dv">10</span> <span class="fl">0.0003290176</span>       <span class="fl">20.1</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="dv">7</span>        <span class="dv">1</span>      <span class="dv">2</span>         M <span class="dv">10</span> <span class="fl">0.0002038479</span>       <span class="fl">20.5</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       <span class="dv">8</span>        <span class="dv">1</span>      <span class="dv">3</span>         M <span class="dv">10</span> <span class="fl">0.0001709461</span>       <span class="fl">17.3</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="dv">9</span>        <span class="dv">1</span>      <span class="dv">4</span>         M <span class="dv">10</span> <span class="fl">0.0001630783</span>       <span class="fl">20.3</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>      <span class="dv">10</span>        <span class="dv">1</span>      <span class="dv">5</span>         M <span class="dv">10</span> <span class="fl">0.0001599789</span>       <span class="fl">18.3</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>      <span class="dv">11</span>        <span class="dv">1</span>      <span class="dv">6</span>         M <span class="dv">10</span> <span class="fl">0.0001561642</span>       <span class="fl">20.4</span></span></code></pre></div>
<p>Above, the <code>sim_uid</code> uniquely identifies a single simulation replicate
and the <code>level_id</code> uniquely identifies a scenario (i.e., a combination
of level values). The <code>rep_id</code> is unique within a given scenario and
identifies the index of that replicate within the scenario. The
<code>runtime</code> column shows the runtime of each replicate (in seconds).</p>
<h4 class="unnumbered" data-number="3.9" id="ssec_update">Update a simulation</h4>
<p>After running a simulation, a user may want to update it by adding
additional level values or replicates; this can be done with the
<code>update_sim</code> function. Prior to running <code>update_sim</code>, the functions
<code>set_levels</code> and/or <code>set_config</code> are used to declare the updates that
should be performed. For example, the following code sets the total
number of replicates to 200 (i.e., adding 100 replicates to those that
have already been run) for each scenario, and adds one additional level
value for <code>n</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim =</span> <span class="dv">200</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">estimator =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;V&quot;</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span></code></pre></div>
<p>After the levels and/or configuration are updated, <code>update_sim</code> is
called.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">update_sim</span>()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span><span class="do">########################################| 100%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>Done. No errors or warnings detected.</span></code></pre></div>
<p>Another call to <code>summarize</code> shows that the additional replicates were
successful:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">list</span>(<span class="at">stat=</span><span class="st">&quot;bias&quot;</span>, <span class="at">name=</span><span class="st">&quot;bias_lambda&quot;</span>, <span class="at">estimate=</span><span class="st">&quot;lambda_hat&quot;</span>, <span class="at">truth=</span><span class="dv">20</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">list</span>(<span class="at">stat=</span><span class="st">&quot;mse&quot;</span>, <span class="at">name=</span><span class="st">&quot;mse_lambda&quot;</span>, <span class="at">estimate=</span><span class="st">&quot;lambda_hat&quot;</span>, <span class="at">truth=</span><span class="dv">20</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  level_id estimator     n n_reps  bias_lambda   mse_lambda</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="dv">1</span>         M    <span class="dv">10</span>    <span class="dv">200</span> <span class="sc">-</span><span class="fl">0.205500000</span>  <span class="fl">1.875450000</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="dv">2</span>         V    <span class="dv">10</span>    <span class="dv">200</span> <span class="sc">-</span><span class="fl">1.189166667</span> <span class="fl">96.913110494</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        <span class="dv">3</span>         M   <span class="dv">100</span>    <span class="dv">200</span> <span class="sc">-</span><span class="fl">0.055000000</span>  <span class="fl">0.197541000</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>        <span class="dv">4</span>         V   <span class="dv">100</span>    <span class="dv">200</span>  <span class="fl">0.023244949</span>  <span class="fl">7.955606709</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>        <span class="dv">5</span>         M  <span class="dv">1000</span>    <span class="dv">200</span>  <span class="fl">0.017495000</span>  <span class="fl">0.017497115</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>        <span class="dv">6</span>         V  <span class="dv">1000</span>    <span class="dv">200</span>  <span class="fl">0.053941807</span>  <span class="fl">0.874700025</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>        <span class="dv">7</span>         M <span class="dv">10000</span>    <span class="dv">200</span> <span class="sc">-</span><span class="fl">0.005233000</span>  <span class="fl">0.002096102</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>        <span class="dv">8</span>         V <span class="dv">10000</span>    <span class="dv">200</span> <span class="sc">-</span><span class="fl">0.007580998</span>  <span class="fl">0.072997135</span></span></code></pre></div>
<p>It is also possible to delete level values. However, it is not possible
to add or delete <em>levels</em>, as this would require updating the simulation
script after the simulation has already run, which is not allowed.</p>
<h3 data-number="4" id="sec:parallel"><span class="header-section-number">4</span> Parallelization</h3>
<p>User-friendly parallelization is a hallmark of
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>. There are
two modes of parallelizing code using
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>, which we
refer to as <em>local parallelization</em> and <em>cluster parallelization</em>. Local
parallelization refers to splitting the computational work of a
simulation between multiple cores of a single computer (e.g., a
multicore laptop). Cluster parallelization refers to running a
simulation on a CCS using job arrays.
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> is
designed to automate as much of the parallelization process as possible.
We give an overview of each parallelization mode below.</p>
<h4 class="unnumbered" data-number="4.1" id="local-parallelization">Local parallelization</h4>
<p>Local parallelization is the easiest way to parallelize code, as the
entire process is handled by the package and executed on the user’s
computer. This mode is activated using <code>set_config</code>, as follows.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">parallel =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> handles
the mechanics related to parallelization internally using the base R
package <a href="https://CRAN.R-project.org/package=parallel"><strong>parallel</strong></a> (R
Core Team 2021). If a single simulation replicate runs in a very short
amount of time (e.g., less than one second), using local parallelization
can actually result in an <em>increase</em> in total runtime. This is because
there is a certain amount of computational overhead involved in the
parallelization mechanisms inside
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>. A speed
comparison can be performed by running the code twice, once with
<code>set_config(parallel = TRUE)</code> and once with
<code>set_config(parallel = FALSE)</code>, each followed by
<code>sim %&gt;% vars("total_runtime")</code>, to see the difference in total runtime.
The exact overhead involved with local parallelization will differ
between machines. A simple example of a speed comparison is given below:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="cf">for</span> (p <span class="cf">in</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>)) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim=</span><span class="dv">20</span>, <span class="at">parallel=</span>p)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="fu">return</span> (<span class="fu">list</span>(<span class="st">&quot;x&quot;</span><span class="ot">=</span><span class="dv">1</span>))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    })</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Parallelizing:&quot;</span>, p))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">print</span>(sim <span class="sc">%&gt;%</span> <span class="fu">vars</span>(<span class="st">&quot;total_runtime&quot;</span>))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span><span class="do">########################################| 100%</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>Done. No errors or warnings detected.</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Parallelizing: FALSE&quot;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">20.42414</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>Done. No errors or warnings detected.</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Parallelizing: TRUE&quot;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">4.41772</span></span></code></pre></div>
<p>Removing the line <code>Sys.sleep(1)</code> and rerunning the code above can give a
sense of the amount of overhead time incurred for a given simulation and
hardware configuration. If the user’s computer has <code>n</code> cores available,
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> will use
<code>n-1</code> cores by default. The <code>n_cores</code> argument of <code>set_config</code> can be
used to manually specify the number of cores to use, as follows.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">n_cores =</span> <span class="dv">2</span>)</span></code></pre></div>
<h4 class="unnumbered" data-number="4.2" id="cluster-parallelization">Cluster parallelization</h4>
<p>Parallelizing code using a CCS is more complicated, but
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> is built
to streamline this process as much as possible. A CCS is a supercomputer
that consists of a number of nodes, each of which may have multiple
cores. Typically, a user logs into the CCS and runs programs by
submitting “jobs” to the CCS using a special program called a job
scheduler. The job scheduler manages the process of running the jobs in
parallel across multiple nodes and/or multiple cores. Although there are
multiple ways to run code in parallel on a CCS,
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> makes use
of job arrays. The main cluster parallelization function in
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> is
<code>run_on_cluster</code>. Throughout this example, we use Slurm as an example
job scheduler, but an analogous workflow will apply to other job
scheduling software.</p>
<p>To illustrate the cluster parallelization workflow, consider the
simulation from Section <a href="#sec:overview" data-reference-type="ref" data-reference="sec:overview">3</a>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> create_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n) { <span class="fu">return</span>(<span class="fu">rpois</span>(<span class="at">n=</span>n, <span class="at">lambda=</span><span class="dv">20</span>)) }</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> est_lambda <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, type) {</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;M&quot;</span>) { <span class="fu">return</span>(<span class="fu">mean</span>(dat)) }</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;V&quot;</span>) { <span class="fu">return</span>(<span class="fu">var</span>(dat)) }</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  }</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(<span class="at">estimator =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;V&quot;</span>), <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    dat <span class="ot">&lt;-</span> <span class="fu">create_data</span>(L<span class="sc">$</span>n)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    lambda_hat <span class="ot">&lt;-</span> <span class="fu">est_lambda</span>(<span class="at">dat=</span>dat, <span class="at">type=</span>L<span class="sc">$</span>estimator)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;lambda_hat&quot;</span><span class="ot">=</span>lambda_hat))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  })</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim=</span><span class="dv">100</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&gt;%</span> <span class="fu">summarize</span>()</span></code></pre></div>
<p>To run this code on a CCS, we simply wrap it in the <code>run_on_cluster</code>
function. To use this function, we must break the code into three
blocks, called <code>first</code>, <code>main</code>, and <code>last</code>. The code in the <code>first</code>
block will run only once, and will set up the simulation object. When
this is finished,
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> will save
the simulation object in the filesystem of the CCS. The code in the
<code>main</code> block will then run once for each simulation replicate, and will
have access to the simulation object created in the <code>first</code> block. In
most cases, the code in the <code>main</code> block will simply include a single
call to <code>run</code> (or to <code>update_sim</code>, as detailed below). Finally, the code
in the <code>last</code> block will run after all simulation replicates have
finished running, and after
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> has
automatically compiled the results into the simulation object. Use of
the <code>run_on_cluster</code> function is illustrated below:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">run_on_cluster</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">first =</span> {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      create_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n) { <span class="fu">return</span>(<span class="fu">rpois</span>(<span class="at">n=</span>n, <span class="at">lambda=</span><span class="dv">20</span>)) }</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      est_lambda <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, type) {</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>        <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;M&quot;</span>) { <span class="fu">return</span>(<span class="fu">mean</span>(dat)) }</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>        <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;V&quot;</span>) { <span class="fu">return</span>(<span class="fu">var</span>(dat)) }</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      }</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(<span class="at">estimator =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;V&quot;</span>), <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>        dat <span class="ot">&lt;-</span> <span class="fu">create_data</span>(L<span class="sc">$</span>n)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>        lambda_hat <span class="ot">&lt;-</span> <span class="fu">est_lambda</span>(<span class="at">dat=</span>dat, <span class="at">type=</span>L<span class="sc">$</span>estimator)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>        <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;lambda_hat&quot;</span><span class="ot">=</span>lambda_hat))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      })</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim=</span><span class="dv">100</span>, <span class="at">n_cores=</span><span class="dv">20</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    },</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">main =</span> {</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    },</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">last =</span> {</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      sim <span class="sc">%&gt;%</span> <span class="fu">summarize</span>()</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    },</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">cluster_config =</span> <span class="fu">list</span>(<span class="at">js=</span><span class="st">&quot;slurm&quot;</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span></code></pre></div>
<p>Note that none of the actual simulation code changed (with the exception
of specifying <code>n_cores=20</code> in the <code>set_config</code> call); we simply divided
the code into chunks and placed these chunks into the appropriate block
(<code>first</code>, <code>main</code>, or <code>last</code>) within <code>run_on_cluster</code>. Additionally, we
specified which job scheduler to use in the <code>cluster_config</code> argument
list. The command <code>js_support</code> can be run in R to see a list of
supported job scheduler software; the value in the <code>js_code</code> column is
the value that should be specified in the <code>cluster_config</code> argument.
Unsupported job schedulers can still be used for cluster
parallelization, as detailed below. Note that the <code>cluster_config</code>
argument can also be used to specify which folder on the cluster should
be used to store the simulation object and associated simulation files
(the default is the working directory).</p>
<p>Next, we must give the job scheduler instructions on how to run the
above code. In the following, we assume that the R code above is stored
in a file called <code>my_simulation.R</code>. We also need to create a simple
shell script called <code>run_sim.sh</code> with the following two lines, which
will run <code>my_simulation.R</code> (we demonstrate this using BASH scripting
language, but any shell scripting language may be used).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#!/bin/bash</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> Rscript my_simulation.R</span></code></pre></div>
<p>If created on a local machine, the two simulation files
(<code>my_simulation.R</code> and <code>run_sim.sh</code>) must be transferred to the
filesystem of the CCS. Finally, we use the job scheduler to submit three
jobs. The first will run the <code>first</code> code, the second will run the
<code>main</code> code, and the third will run the <code>last</code> code. With Slurm, we run
the following three shell commands:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> sbatch <span class="sc">--</span>export<span class="ot">=</span>sim_run<span class="ot">=</span><span class="st">&#39;first&#39;</span> run_sim.sh</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Submitted batch job <span class="dv">101</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> sbatch <span class="sc">--</span>export<span class="ot">=</span>sim_run<span class="ot">=</span><span class="st">&#39;main&#39;</span> <span class="sc">--</span>array<span class="ot">=</span><span class="dv">1-20</span> <span class="sc">--</span>depend<span class="ot">=</span>afterok<span class="sc">:</span><span class="dv">101</span> run_sim.sh</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>Submitted batch job <span class="dv">102</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> sbatch <span class="sc">--</span>export<span class="ot">=</span>sim_run<span class="ot">=</span><span class="st">&#39;last&#39;</span> <span class="sc">--</span>depend<span class="ot">=</span>afterok<span class="sc">:</span><span class="dv">102</span> run_sim.sh</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>Submitted batch job <span class="dv">103</span></span></code></pre></div>
<p>In the first line, we submit the <code>run_sim.sh</code> script using the
<code>sim_run=‘first’</code> environment variable, which tells
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> to only
run the code in the <code>first</code> block. After running this, Slurm returns the
message <code>Submitted batch job 101</code>. The number <code>101</code> is called the “job
ID” and uniquely identifies the job on the CCS.</p>
<p>In the second line, we submit the <code>run_sim.sh</code> script using the
<code>sim_run=‘main’</code> environment variable and tell Slurm to run a job array
with “task IDs” 1-20. Each task corresponds to one core, and so in this
case 20 cores will be used. This number should equal the <code>n_cores</code>
number specified via <code>set_config</code>.
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> handles
the work of dividing the simulation replicates between the cores; the
only restriction is that the number of cores cannot exceed the total
number of simulation replicates.</p>
<p>Also note that we included the option <code>--depend=afterok:101</code>, which
instructs the job scheduler to wait until the first job finishes before
starting the job array. (In practice, the number 101 must be replaced
with whatever job ID Slurm assigned to the first job.) Once this command
is submitted, the code in the <code>main</code> block will be run for each
replicate. A temporary folder called <code>sim_results</code> will be created and
filled with temporary objects containing data on the results and/or
errors for each replicate.</p>
<p>In the third line, we submit the <code>run_sim.sh</code> script using the
<code>sim_run=’last’</code> environment variable. Again, we use
<code>--depend=afterok:102</code> to ensure this code does not run until all tasks
in the job array have finished. When this job runs,
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> will
compile the results from the <code>main</code> block, run the code in the <code>last</code>
block, save the simulation object to the filesystem, and delete the
temporary <code>sim_results</code> folder and its contents. If desired, the user
can leave the <code>last</code> block empty, but this third <code>sbatch</code> command should
be run anyway to compile the results and save the simulation object for
further analysis.</p>
<h5 class="unnumbered" data-number="4.2.1" id="further-automating-job-submission">Further automating job submission</h5>
<p>Advanced users may wish to automatically capture the job IDs so that
they don’t need to be entered manually; sample code showing how this can
be done is shown below:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> jid1<span class="ot">=</span><span class="er">$</span>(sbatch <span class="sc">--</span><span class="at">export=sim_run=</span><span class="st">&#39;first&#39;</span> run_sim.sh <span class="sc">|</span> sed <span class="st">&#39;s/Submitted batch job //&#39;</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> jid2<span class="ot">=</span><span class="er">$</span>(sbatch <span class="sc">--</span><span class="at">export=sim_run=</span><span class="st">&#39;main&#39;</span> <span class="sc">--</span><span class="at">array=</span><span class="dv">1-20</span> <span class="sc">--</span><span class="at">depend=</span>afterok<span class="sc">:</span><span class="er">$</span>jid1 <span class="sc">\</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    run_sim.sh <span class="sc">|</span> sed <span class="st">&#39;s/Submitted batch job //&#39;</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> sbatch <span class="sc">--</span>export<span class="ot">=</span>sim_run<span class="ot">=</span><span class="st">&#39;last&#39;</span> <span class="sc">--</span>depend<span class="ot">=</span>afterok<span class="sc">:</span><span class="er">$</span>jid2 run_sim.sh</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>Submitted batch job <span class="dv">103</span></span></code></pre></div>
<p>While this is slightly more complicated, this code allows all three
lines to be submitted simultaneously without the need to copy and paste
the job IDs manually every time.</p>
<h4 class="unnumbered" data-number="4.3" id="additional-cluster-parallelization-functionality">Additional cluster parallelization functionality</h4>
<h5 class="unnumbered" data-number="4.3.1" id="running-locally">Running locally</h5>
<p>The <code>run_on_cluster</code> function is programmed such that it can also be run
locally. In this case, the code within the <code>first</code>, <code>main</code>, and <code>last</code>
blocks will be executed in the calling environment of the
<code>run_on_cluster</code> function (typically the global environment); this can
be useful for testing simulations locally before sending them to a CCS.</p>
<h5 class="unnumbered" data-number="4.3.2" id="using-unsupported-job-schedulers">Using unsupported job schedulers</h5>
<p>There may be job schedulers that
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> does not
natively support. If this is the case,
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> can still
be used for cluster parallelization; this requires identifying the
environment variable that the job scheduler uses to uniquely identify
tasks within a job array. For example, Slurm uses the variable
<code>"SLURM_ARRAY_TASK_ID"</code> and Grid Engine uses the variable
<code>"SGE_TASK_ID"</code>. Once this variable is identified, it can be specified
in the <code>cluster_config</code> block, as follows:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">run_on_cluster</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">first =</span> {...},</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">main =</span> {...},</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">last =</span> {...},</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">cluster_config =</span> <span class="fu">list</span>(<span class="at">tid_var=</span><span class="st">&quot;SLURM_ARRAY_TASK_ID&quot;</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span></code></pre></div>
<h5 class="unnumbered" data-number="4.3.3" id="sssec_update_sim_on_cluster">Updating a simulation on a CCS</h5>
<p>To update a simulation on a CCS, the <code>update_sim_on_cluster</code> function
can be used. The workflow is similar to that of <code>run_on_cluster</code>, with
several key differences. Instead of creating a new simulation object in
the <code>first</code> block using <code>new_sim</code>, the existing simulation object (which
would have been saved to the filesystem when <code>run_on_cluster</code> was called
originally) is loaded using <code>readRDS</code>. Then, the functions <code>set_levels</code>
and/or <code>set_config</code> are called to specify the desired updates (see
Section <a href="#ssec_update" data-reference-type="ref" data-reference="ssec_update">3.9</a>). In the <code>main</code> block, <code>update_sim</code> is called
(instead of <code>run</code>). In the <code>last</code> block, code can remain the same or
change as needed. These differences are illustrated in the code below.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">update_sim_on_cluster</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">first =</span> {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      sim <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;sim.rds&quot;</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(<span class="at">n=</span><span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">500</span>,<span class="dv">1000</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    },</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">main =</span> {</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      sim <span class="sc">%&lt;&gt;%</span> <span class="fu">update_sim</span>()</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    },</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">last =</span> {</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      sim <span class="sc">%&gt;%</span> <span class="fu">summarize</span>()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    },</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">cluster_config =</span> <span class="fu">list</span>(<span class="at">js=</span><span class="st">&quot;slurm&quot;</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span></code></pre></div>
<p>Submission of this code via a job scheduler proceeds in the same manner
as described earlier for <code>run_on_cluster</code>.</p>
<h3 data-number="5" id="sec:advanced"><span class="header-section-number">5</span> Advanced functionality</h3>
<p>In this section, we review the following functionality, targeting
advanced users of the package:</p>
<ul>
<li><p>using the <code>batch</code> function, which allows for information to be shared
across simulation replicates;</p></li>
<li><p>using <em>complex simulation levels</em> in settings where simple levels
(e.g., a vector of numbers) are insufficient;</p></li>
<li><p>handling <em>complex return data</em> in settings where a single simulation
replicate returns nested lists, dataframes, model objects, etc.;</p></li>
<li><p>managing RNG seeds;</p></li>
<li><p>best practices for debugging and handling errors and warnings;</p></li>
<li><p>capturing Monte Carlo error using the <code>summarize</code> function.</p></li>
</ul>
<h4 class="unnumbered" data-number="5.1" id="using-the-batch-function-to-share-information-across-simulation-replicates">Using the batch function to share information across simulation replicates</h4>
<p>The <code>batch</code> function is useful for sharing data or objects between
simulation replicates. Essentially, it allows simulation replicates to
be divided into “batches;” all replicates in a given batch will then
share a certain set of objects. A common use case for this is a
simulation that involves using multiple methods to analyze a shared
dataset, and repeating this process over a number of dataset replicates.
This may be of interest if, for example, it is computationally expensive
to generate a simulated dataset.</p>
<p>To illustrate the use of <code>batch</code> using this example, we first consider
the following simulation:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> create_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n) { <span class="fu">rnorm</span>(<span class="at">n=</span>n, <span class="at">mean=</span><span class="dv">3</span>) }</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> est_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, type) {</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;est_mean&quot;</span>) { <span class="fu">return</span>(<span class="fu">mean</span>(dat)) }</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;est_median&quot;</span>) { <span class="fu">return</span>(<span class="fu">median</span>(dat)) }</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  }</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(<span class="at">est=</span><span class="fu">c</span>(<span class="st">&quot;est_mean&quot;</span>,<span class="st">&quot;est_median&quot;</span>))</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim=</span><span class="dv">3</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    dat <span class="ot">&lt;-</span> <span class="fu">create_data</span>(<span class="at">n=</span><span class="dv">100</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    mu_hat <span class="ot">&lt;-</span> <span class="fu">est_mean</span>(<span class="at">dat=</span>dat, <span class="at">type=</span>L<span class="sc">$</span>est)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;mu_hat&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(mu_hat,<span class="dv">2</span>),</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;dat_1&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(dat[<span class="dv">1</span>],<span class="dv">2</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    ))</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  })</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span><span class="do">########################################| 100%</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>Done. No errors or warnings detected.</span></code></pre></div>
<p>From the <code>‘‘dat_1’’</code> column of the results object (equal to the first
element of the <code>dat</code> vector created in the simulation script), we see
that a unique dataset was created for each simulation replicate:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim<span class="sc">$</span>results[<span class="fu">order</span>(sim<span class="sc">$</span>results<span class="sc">$</span>rep_id),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)<span class="sc">!=</span><span class="dv">5</span>]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  sim_uid level_id rep_id        est mu_hat dat_1</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="dv">1</span>        <span class="dv">1</span>      <span class="dv">1</span>   est_mean   <span class="fl">3.05</span>  <span class="fl">4.09</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="dv">2</span>        <span class="dv">2</span>      <span class="dv">1</span> est_median   <span class="fl">3.06</span>  <span class="fl">3.23</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="dv">3</span>        <span class="dv">1</span>      <span class="dv">2</span>   est_mean   <span class="fl">3.03</span>  <span class="fl">2.99</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="dv">5</span>        <span class="dv">2</span>      <span class="dv">2</span> est_median   <span class="fl">3.02</span>  <span class="fl">2.78</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       <span class="dv">4</span>        <span class="dv">1</span>      <span class="dv">3</span>   est_mean   <span class="fl">2.85</span>  <span class="fl">1.47</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       <span class="dv">6</span>        <span class="dv">2</span>      <span class="dv">3</span> est_median   <span class="fl">3.03</span>  <span class="fl">2.35</span></span></code></pre></div>
<p>Suppose that instead, we wish to analyze each simulated dataset using
multiple methods (in this case corresponding to <code>‘‘est_mean’’</code> and
<code>‘‘est_median’’</code>), and repeat this procedure a total of three times. We
can do this using the <code>batch</code> function, as follows:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> create_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n) { <span class="fu">rnorm</span>(<span class="at">n=</span>n, <span class="at">mean=</span><span class="dv">3</span>) }</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> est_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, type) {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;est_mean&quot;</span>) { <span class="fu">return</span>(<span class="fu">mean</span>(dat)) }</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;est_median&quot;</span>) { <span class="fu">return</span>(<span class="fu">median</span>(dat)) }</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  }</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(<span class="at">est=</span><span class="fu">c</span>(<span class="st">&quot;est_mean&quot;</span>,<span class="st">&quot;est_median&quot;</span>))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim=</span><span class="dv">3</span>, <span class="at">batch_levels=</span><span class="cn">NULL</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">batch</span>({</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      dat <span class="ot">&lt;-</span> <span class="fu">create_data</span>(<span class="at">n=</span><span class="dv">100</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    })</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    mu_hat <span class="ot">&lt;-</span> <span class="fu">est_mean</span>(<span class="at">dat=</span>dat, <span class="at">type=</span>L<span class="sc">$</span>est)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;mu_hat&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(mu_hat,<span class="dv">2</span>),</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;dat_1&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(dat[<span class="dv">1</span>],<span class="dv">2</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    ))</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  })</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span><span class="do">########################################| 100%</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>Done. No errors or warnings detected.</span></code></pre></div>
<p>In the code above, we changed two things. First, we added
<code>batch_levels=NULL</code> to the <code>set_config</code> call; this will be explained
below. Second, we wrapped the code line <code>dat &lt;- create_data(n=100)</code>
inside the <code>batch</code> function. Whatever code goes inside the <code>batch</code>
function will produce the same output for all simulations in a batch.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim<span class="sc">$</span>results[<span class="fu">order</span>(sim<span class="sc">$</span>results<span class="sc">$</span>rep_id),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)<span class="sc">!=</span><span class="dv">5</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  sim_uid level_id rep_id        est mu_hat dat_1</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="dv">1</span>        <span class="dv">1</span>      <span class="dv">1</span>   est_mean   <span class="fl">3.02</span>  <span class="fl">2.74</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="dv">2</span>        <span class="dv">2</span>      <span class="dv">1</span> est_median   <span class="fl">3.19</span>  <span class="fl">2.74</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="dv">3</span>        <span class="dv">1</span>      <span class="dv">2</span>   est_mean   <span class="fl">2.91</span>  <span class="fl">3.71</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="dv">5</span>        <span class="dv">2</span>      <span class="dv">2</span> est_median   <span class="fl">2.95</span>  <span class="fl">3.71</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       <span class="dv">4</span>        <span class="dv">1</span>      <span class="dv">3</span>   est_mean   <span class="fl">3.10</span>  <span class="fl">3.52</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       <span class="dv">6</span>        <span class="dv">2</span>      <span class="dv">3</span> est_median   <span class="fl">3.01</span>  <span class="fl">3.52</span></span></code></pre></div>
<p>In this case, from the <code>‘‘dat_1’’</code> column of the results object, we see
that one dataset was created and shared by the batch corresponding to
<code>sim_uids</code> 1 and 2 (likewise for <code>sim_uids</code> <span class="math inline">\(\{3,5\}\)</span> and <span class="math inline">\(\{4,6\}\)</span>).</p>
<p>However, the situation is often more complicated. Suppose we have a
simulation with multiple levels, some that correspond to creating data
and some that correspond to analyzing the data. Here, the <code>batch_levels</code>
argument of <code>set_config</code> plays a role. Specifically, this argument
should be a character vector equal to the names of the simulation levels
that are referenced (via the special variable <code>L</code>) from within a <code>batch</code>
block. In the example below, the levels <code>n</code> and <code>mu</code> are used within the
<code>batch</code> call, while the level <code>est</code> is not.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> create_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n, mu) { <span class="fu">rnorm</span>(<span class="at">n=</span>n, <span class="at">mean=</span>mu) }</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> est_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, type) {</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;est_mean&quot;</span>) { <span class="fu">return</span>(<span class="fu">mean</span>(dat)) }</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;est_median&quot;</span>) { <span class="fu">return</span>(<span class="fu">median</span>(dat)) }</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  }</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(<span class="at">n=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>), <span class="at">mu=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">est=</span><span class="fu">c</span>(<span class="st">&quot;est_mean&quot;</span>,<span class="st">&quot;est_median&quot;</span>))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim=</span><span class="dv">2</span>, <span class="at">batch_levels=</span><span class="fu">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;mu&quot;</span>), <span class="at">return_batch_id=</span>T)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">batch</span>({</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      dat <span class="ot">&lt;-</span> <span class="fu">create_data</span>(<span class="at">n=</span>L<span class="sc">$</span>n, <span class="at">mu=</span>L<span class="sc">$</span>mu)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    })</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    mu_hat <span class="ot">&lt;-</span> <span class="fu">est_mean</span>(<span class="at">dat=</span>dat, <span class="at">type=</span>L<span class="sc">$</span>est)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;mu_hat&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(mu_hat,<span class="dv">2</span>),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;dat_1&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(dat[<span class="dv">1</span>],<span class="dv">2</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    ))</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  })</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span><span class="do">########################################| 100%</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>Done. No errors or warnings detected.</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim<span class="sc">$</span>results[<span class="fu">order</span>(sim<span class="sc">$</span>results<span class="sc">$</span>batch_id),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)<span class="sc">!=</span><span class="dv">8</span>]</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>   sim_uid level_id rep_id batch_id   n mu        est mu_hat dat_1</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="dv">1</span>        <span class="dv">1</span>      <span class="dv">1</span>        <span class="dv">1</span>  <span class="dv">10</span>  <span class="dv">3</span>   est_mean   <span class="fl">2.87</span>  <span class="fl">4.29</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>        <span class="dv">5</span>        <span class="dv">5</span>      <span class="dv">1</span>        <span class="dv">1</span>  <span class="dv">10</span>  <span class="dv">3</span> est_median   <span class="fl">2.94</span>  <span class="fl">4.29</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="dv">9</span>        <span class="dv">1</span>      <span class="dv">2</span>        <span class="dv">2</span>  <span class="dv">10</span>  <span class="dv">3</span>   est_mean   <span class="fl">2.79</span>  <span class="fl">2.77</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>      <span class="dv">13</span>        <span class="dv">5</span>      <span class="dv">2</span>        <span class="dv">2</span>  <span class="dv">10</span>  <span class="dv">3</span> est_median   <span class="fl">2.73</span>  <span class="fl">2.77</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        <span class="dv">2</span>        <span class="dv">2</span>      <span class="dv">1</span>        <span class="dv">3</span> <span class="dv">100</span>  <span class="dv">3</span>   est_mean   <span class="fl">2.93</span>  <span class="fl">1.77</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>       <span class="dv">6</span>        <span class="dv">6</span>      <span class="dv">1</span>        <span class="dv">3</span> <span class="dv">100</span>  <span class="dv">3</span> est_median   <span class="fl">3.01</span>  <span class="fl">1.77</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="dv">10</span>        <span class="dv">2</span>      <span class="dv">2</span>        <span class="dv">4</span> <span class="dv">100</span>  <span class="dv">3</span>   est_mean   <span class="fl">2.80</span>  <span class="fl">4.44</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span>      <span class="dv">14</span>        <span class="dv">6</span>      <span class="dv">2</span>        <span class="dv">4</span> <span class="dv">100</span>  <span class="dv">3</span> est_median   <span class="fl">2.71</span>  <span class="fl">4.44</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>        <span class="dv">3</span>        <span class="dv">3</span>      <span class="dv">1</span>        <span class="dv">5</span>  <span class="dv">10</span>  <span class="dv">5</span>   est_mean   <span class="fl">5.49</span>  <span class="fl">4.78</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span>       <span class="dv">7</span>        <span class="dv">7</span>      <span class="dv">1</span>        <span class="dv">5</span>  <span class="dv">10</span>  <span class="dv">5</span> est_median   <span class="fl">5.25</span>  <span class="fl">4.78</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       <span class="dv">11</span>        <span class="dv">3</span>      <span class="dv">2</span>        <span class="dv">6</span>  <span class="dv">10</span>  <span class="dv">5</span>   est_mean   <span class="fl">4.57</span>  <span class="fl">4.48</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span>      <span class="dv">15</span>        <span class="dv">7</span>      <span class="dv">2</span>        <span class="dv">6</span>  <span class="dv">10</span>  <span class="dv">5</span> est_median   <span class="fl">4.62</span>  <span class="fl">4.48</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>        <span class="dv">4</span>        <span class="dv">4</span>      <span class="dv">1</span>        <span class="dv">7</span> <span class="dv">100</span>  <span class="dv">5</span>   est_mean   <span class="fl">4.98</span>  <span class="fl">5.66</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span>       <span class="dv">8</span>        <span class="dv">8</span>      <span class="dv">1</span>        <span class="dv">7</span> <span class="dv">100</span>  <span class="dv">5</span> est_median   <span class="fl">4.95</span>  <span class="fl">5.66</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>       <span class="dv">12</span>        <span class="dv">4</span>      <span class="dv">2</span>        <span class="dv">8</span> <span class="dv">100</span>  <span class="dv">5</span>   est_mean   <span class="fl">5.08</span>  <span class="fl">5.55</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span>      <span class="dv">16</span>        <span class="dv">8</span>      <span class="dv">2</span>        <span class="dv">8</span> <span class="dv">100</span>  <span class="dv">5</span> est_median   <span class="fl">5.14</span>  <span class="fl">5.55</span></span></code></pre></div>
<p>The batches were created such that each batch contained two replicates,
one for each level value of <code>est</code>. For expository purposes, we also
specified the <code>return_batch_id=T</code> option in <code>set_config</code> so that the
results object would return the <code>batch_id</code>. This is not necessary in
practice. The <code>batch_id</code> variable defines the batches; all simulations
that share the same <code>batch_id</code> are in a single batch. The
<code>return_batch_id=T</code> option can be useful to ensure correct usage of the
<code>batch</code> function.</p>
<p>We note the following about the <code>batch</code> function:</p>
<ul>
<li><p>The code within the <code>batch</code> code block must <em>only</em> create objects;
this code should not change or delete existing objects, as these
changes will be ignored.</p></li>
<li><p>In the majority of cases, the <code>batch</code> function will be called just
once, at the beginning of the simulation script. However, it can be
used anywhere in the script and can be called multiple times. The
<code>batch</code> function should never be used outside of the simulation
script.</p></li>
<li><p>Although we have illustrated the use of the <code>batch</code> function to create
a dataset to share between multiple simulation replicates, it can be
used for much more, such as taking a sample from an existing dataset
or computing shared nuisance function estimators.</p></li>
<li><p>If the simulation is being run in parallel (either locally or on a
CCS), <code>n_cores</code> cannot exceed the number of batches, since all
simulations within a batch must run on the same core.</p></li>
<li><p>If the simulation script uses the <code>batch</code> function, the simulation
cannot be updated using the <code>update_sim</code> or <code>update_sim_on_cluster</code>
functions, with the exception of updates that only entail removing
simulation replicates.</p></li>
</ul>
<h4 class="unnumbered" data-number="5.2" id="complex-simulation-levels">Complex simulation levels</h4>
<p>Often, simulation levels are simple, such as a vector of sample sizes:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">200</span>,<span class="dv">400</span>,<span class="dv">800</span>))</span></code></pre></div>
<p>However, there are many instances in which more complex objects are
needed. For these cases, instead of a vector of numbers or character
strings, a named list of lists can be used. The toy example below
illustrates this.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">distribution =</span> <span class="fu">list</span>(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;Beta 1&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">type=</span><span class="st">&quot;Beta&quot;</span>, <span class="at">params=</span><span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>)),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;Beta 2&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">type=</span><span class="st">&quot;Beta&quot;</span>, <span class="at">params=</span><span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">0.4</span>)),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;Normal&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">type=</span><span class="st">&quot;Normal&quot;</span>, <span class="at">params=</span><span class="fu">c</span>(<span class="fl">3.0</span>, <span class="fl">0.2</span>))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    )</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> create_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n, type, params) {</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;Beta&quot;</span>) {</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="fu">return</span>(<span class="fu">rbeta</span>(n, <span class="at">shape1=</span>params[<span class="dv">1</span>], <span class="at">shape2=</span>params[<span class="dv">2</span>]))</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    } <span class="cf">else</span> <span class="cf">if</span> (type<span class="sc">==</span><span class="st">&quot;Normal&quot;</span>) {</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="fu">return</span>(<span class="fu">rnorm</span>(n, <span class="at">mean=</span>params[<span class="dv">1</span>], <span class="at">sd=</span>params[<span class="dv">2</span>]))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    }</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  }</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    x <span class="ot">&lt;-</span> <span class="fu">create_data</span>(L<span class="sc">$</span>n, L<span class="sc">$</span>distribution<span class="sc">$</span>type, L<span class="sc">$</span>distribution<span class="sc">$</span>params)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;y&quot;</span><span class="ot">=</span><span class="fu">mean</span>(x)))</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  })</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span><span class="do">########################################| 100%</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>Done. No errors or warnings detected.</span></code></pre></div>
<p>Note that the list names (<code>‘‘Beta 1’’</code>, <code>‘‘Beta 2’’</code>, and <code>‘‘Normal’’</code>)
become the entries in the <code>sim$results</code> dataframe, as well as the
dataframe returned by <code>summarize</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="fu">list</span>(<span class="at">stat=</span><span class="st">&quot;mean&quot;</span>, <span class="at">x=</span><span class="st">&quot;y&quot;</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  level_id   n distribution n_reps    mean_y</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="dv">1</span>  <span class="dv">10</span>       Beta <span class="dv">1</span>      <span class="dv">1</span> <span class="fl">0.1635174</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="dv">2</span> <span class="dv">100</span>       Beta <span class="dv">1</span>      <span class="dv">1</span> <span class="fl">0.2740965</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        <span class="dv">3</span>  <span class="dv">10</span>       Beta <span class="dv">2</span>      <span class="dv">1</span> <span class="fl">0.6234866</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>        <span class="dv">4</span> <span class="dv">100</span>       Beta <span class="dv">2</span>      <span class="dv">1</span> <span class="fl">0.7664522</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>        <span class="dv">5</span>  <span class="dv">10</span>       Normal      <span class="dv">1</span> <span class="fl">3.0903062</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>        <span class="dv">6</span> <span class="dv">100</span>       Normal      <span class="dv">1</span> <span class="fl">3.0179944</span></span></code></pre></div>
<h4 class="unnumbered" data-number="5.3" id="ssec_complex">Complex return data</h4>
<p>In most situations, the results of simulations are numeric. However, we
may want to return more complex data, such as matrices, lists, or model
objects. To do this, we add a key-value pair to the list returned by the
simulation script with the special key <code>".complex"</code> and a list
(containing the complex data) as the value. This is illustrated in the
toy example below. Here, the simulation script estimates the parameters
of a linear regression and returns these as numeric, but also returns
the estimated covariance matrix and the entire model object.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(<span class="at">n=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> create_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    y <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="st">&quot;x&quot;</span><span class="ot">=</span>x, <span class="st">&quot;y&quot;</span><span class="ot">=</span>y))</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  }</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim=</span><span class="dv">2</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    dat <span class="ot">&lt;-</span> <span class="fu">create_data</span>(L<span class="sc">$</span>n)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;beta0_hat&quot;</span> <span class="ot">=</span> model<span class="sc">$</span>coefficients[[<span class="dv">1</span>]],</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;beta1_hat&quot;</span> <span class="ot">=</span> model<span class="sc">$</span>coefficients[[<span class="dv">2</span>]],</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="st">&quot;.complex&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>        <span class="st">&quot;model&quot;</span> <span class="ot">=</span> model,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>        <span class="st">&quot;cov_mtx&quot;</span> <span class="ot">=</span> <span class="fu">vcov</span>(model)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      )</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    ))</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  })</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span><span class="do">########################################| 100%</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>Done. No errors or warnings detected.</span></code></pre></div>
<p>After running this simulation, the numeric results can be accessed
directly via <code>sim$results</code> or using the <code>summarize</code> function, as usual:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">head</span>(sim<span class="sc">$</span>results)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  sim_uid level_id rep_id    n     runtime beta0_hat beta1_hat</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="dv">1</span>        <span class="dv">1</span>      <span class="dv">1</span>   <span class="dv">10</span> <span class="fl">0.012123823</span>  <span class="fl">2.113012</span>  <span class="fl">3.780972</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="dv">4</span>        <span class="dv">1</span>      <span class="dv">2</span>   <span class="dv">10</span> <span class="fl">0.001345873</span>  <span class="fl">2.058610</span>  <span class="fl">3.726216</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       <span class="dv">2</span>        <span class="dv">2</span>      <span class="dv">1</span>  <span class="dv">100</span> <span class="fl">0.006520033</span>  <span class="fl">2.784147</span>  <span class="fl">2.058041</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="dv">5</span>        <span class="dv">2</span>      <span class="dv">2</span>  <span class="dv">100</span> <span class="fl">0.001568794</span>  <span class="fl">3.066045</span>  <span class="fl">2.097569</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="dv">3</span>        <span class="dv">3</span>      <span class="dv">1</span> <span class="dv">1000</span> <span class="fl">0.001888037</span>  <span class="fl">3.144964</span>  <span class="fl">1.783498</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       <span class="dv">6</span>        <span class="dv">3</span>      <span class="dv">2</span> <span class="dv">1000</span> <span class="fl">0.002427101</span>  <span class="fl">3.125128</span>  <span class="fl">1.714405</span></span></code></pre></div>
<p>To examine the complex return data, we can use the special function
<code>get_complex</code>, as illustrated below:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> c5 <span class="ot">&lt;-</span> <span class="fu">get_complex</span>(sim, <span class="at">sim_uid=</span><span class="dv">5</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">print</span>(<span class="fu">summary</span>(c5<span class="sc">$</span>model))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">data =</span> dat)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    Min      <span class="dv">1</span>Q  Median      <span class="dv">3</span>Q     Max</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">2.7050</span> <span class="sc">-</span><span class="fl">0.7429</span>  <span class="fl">0.1183</span>  <span class="fl">0.7470</span>  <span class="fl">1.9673</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>(Intercept)   <span class="fl">3.0660</span>     <span class="fl">0.2127</span>  <span class="fl">14.413</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>x             <span class="fl">2.0976</span>     <span class="fl">0.3714</span>   <span class="fl">5.647</span> <span class="fl">1.59e-07</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> ‘<span class="sc">**</span><span class="er">*</span>’ <span class="fl">0.001</span> ‘<span class="sc">**</span>’ <span class="fl">0.01</span> ‘<span class="sc">*</span>’ <span class="fl">0.05</span> ‘.’ <span class="fl">0.1</span> ‘ ’ <span class="dv">1</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">1.003</span> on <span class="dv">98</span> degrees of freedom</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.2455</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.2378</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">31.89</span> on <span class="dv">1</span> and <span class="dv">98</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">1.593e-07</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">print</span>(c5<span class="sc">$</span>cov_mtx)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>            (Intercept)           x</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">0.04525148</span> <span class="sc">-</span><span class="fl">0.06968649</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>x           <span class="sc">-</span><span class="fl">0.06968649</span>  <span class="fl">0.13795995</span></span></code></pre></div>
<h4 class="unnumbered" data-number="5.4" id="random-number-generator-seeds">Random number generator seeds</h4>
<p>In statistical research, it is desirable to be able to reproduce the
exact results of a simulation study. Since R code often involves
stochastic (random) functions like <code>rnorm</code> or <code>sample</code> that return
different values when called multiple times, reproducibility is not
guaranteed. In a simple R script, calling the <code>set.seed</code> function at the
beginning of the script ensures that the stochastic functions that
follow will produce the same results whenever the script is run.
However, a more nuanced strategy is needed when running simulations.
When running 100 replicates of the same simulation, we do not want each
replicate to return identical results; rather, we would like for each
replicate to be different from one another, but for <em>the entire set of
replicates</em> to be the same when the entire simulation is run twice in a
row. <a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>
manages this process, even when simulations are being run in parallel
locally or on a cluster computing system. In
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>, a single
“global seed” is used to generate a different seed for each simulation
replicate. The <code>set_config</code> function is used to set or change this
global seed:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">seed=</span><span class="dv">123</span>)</span></code></pre></div>
<p>If a seed is not set using <code>set_config</code>,
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> will set a
random seed automatically so that the results can be replicated if
desired. To view this seed, we use the <code>vars</code> function:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">print</span>(<span class="fu">vars</span>(sim, <span class="st">&quot;seed&quot;</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">287577520</span></span></code></pre></div>
<h4 class="unnumbered" data-number="5.5" id="debugging-and-errorwarning-handling">Debugging and error/warning handling</h4>
<p>In the simulation coding workflow, errors are inevitable. Some errors
may affect all simulation replicates, while other errors may only affect
a subset of replicates. By default, when a simulation is run,
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> will not
stop if an error occurs; instead, errors are logged and stored in a
dataframe along with information about the simulation replicates that
resulted in those errors. Examining this dataframe by typing
<code>print(sim$errors)</code> can sometimes help to quickly pinpoint the issue.
This is demonstrated below:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim=</span><span class="dv">2</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">Sigma =</span> <span class="fu">list</span>(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="at">s1 =</span> <span class="fu">list</span>(<span class="at">mtx=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">nrow=</span><span class="dv">2</span>)),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="at">s3 =</span> <span class="fu">list</span>(<span class="at">mtx=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">9</span>), <span class="at">nrow=</span><span class="dv">2</span>)),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="at">s2 =</span> <span class="fu">list</span>(<span class="at">mtx=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">nrow=</span><span class="dv">2</span>)),</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>      <span class="at">s4 =</span> <span class="fu">list</span>(<span class="at">mtx=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">2</span>))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    )</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    x <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">mu=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">Sigma=</span>L<span class="sc">$</span>Sigma<span class="sc">$</span>mtx)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">x1=</span>x[<span class="dv">1</span>], <span class="at">x2=</span>x[<span class="dv">2</span>]))</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  })</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span><span class="do">########################################| 100%</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>Done. Errors detected <span class="cf">in</span> <span class="dv">25</span>% of simulation replicates. Warnings detected <span class="cf">in</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>% of simulation replicates.</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> <span class="fu">print</span>(sim<span class="sc">$</span>errors)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  sim_uid level_id rep_id Sigma      runtime                          message</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="dv">5</span>        <span class="dv">3</span>      <span class="dv">1</span>    s2 <span class="fl">0.0004692078</span> <span class="st">&#39;Sigma&#39;</span> is not positive definite</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="dv">6</span>        <span class="dv">3</span>      <span class="dv">2</span>    s2 <span class="fl">0.0006608963</span> <span class="st">&#39;Sigma&#39;</span> is not positive definite</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>                                                     call</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> L<span class="sc">$</span>Sigma<span class="sc">$</span>mtx)</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> L<span class="sc">$</span>Sigma<span class="sc">$</span>mtx)</span></code></pre></div>
<p>From the output above, we see that the code fails for the simulation
replicates that use the level with <code>Sigma="s2"</code> because it uses an
invalid (not positive definite) covariance matrix. Similarly, if a
simulation involves replicates that throw warnings, all warnings are
logged and stored in the dataframe <code>sim$warnings</code>. If an error occurs
for a subset of simulation replicates and that error is fixed, it is
possible to rerun the replicates that had errors, as follows:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">update_sim</span>(<span class="at">keep_errors=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>The workflow demonstrated above can be useful to pinpoint errors, but it
has two main drawbacks. First, it is undesirable to run a time-consuming
simulation involving hundreds or thousands of replicates, only to find
at the end that every replicate failed because of a typo. It may
therefore be useful to stop an entire simulation after a single error
has occurred. Second, it can sometimes be difficult to determine exactly
what caused an error without making use of more advanced debugging
tools. For both of these situations,
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> includes
the following configuration option:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">stop_at_error=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Setting <code>stop_at_error=TRUE</code> will stop the simulation when it encounters
any error. Furthermore, the error will be thrown by R in the usual way,
so if the simulation is being run in RStudio, the built-in debugging
tools (such as “Show Traceback” and “Rerun with debug”) can be used to
find and fix the bug. Placing a call to <code>browser</code> at the top of the
simulation script can also be useful for debugging.</p>
<h4 class="unnumbered" data-number="5.6" id="sec:mc_error">Monte Carlo error</h4>
<p>Statistical simulations are often based on the principle of Monte Carlo
approximation; specifically, pseudo-random sampling is used to evaluate
the performance of a statistical procedure under a particular
data-generating process. The performance of the procedure can be viewed
as a statistical parameter and, due to the fact that only a finite
number of simulation replicates can be performed, there is uncertainty
in any estimate of performance. This uncertainty is often referred to as
<em>Monte Carlo error</em> (see, e.g., (Lee and Young 1999)). We can quantify
Monte Carlo error using, for example, the standard error of the
performance estimator.</p>
<p>Measuring and reporting Monte Carlo error is a vital component of a
simulation study.
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> includes
an option in the <code>summarize</code> function to automatically estimate the
Monte Carlo standard error for any inferential summary statistic, e.g.,
estimator bias or confidence interval coverage. The standard error
estimates are based on the formulas provided in Morris, White, and
Crowther (2019). If the option <code>mc_se</code> is set to <code>TRUE</code>, estimates of
Monte Carlo standard error will be included in the summary data frame,
along with associated 95% confidence intervals based on a normal
approximation.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> create_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n) { <span class="fu">rpois</span>(n, <span class="at">lambda=</span><span class="dv">5</span>) }</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> est_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(dat) {</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span>(<span class="fu">mean</span>(dat))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  }</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(<span class="at">n=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim=</span><span class="dv">5</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    dat <span class="ot">&lt;-</span> <span class="fu">create_data</span>(L<span class="sc">$</span>n)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    lambda_hat <span class="ot">&lt;-</span> <span class="fu">est_mean</span>(<span class="at">dat=</span>dat)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">return</span> (<span class="fu">list</span>(<span class="st">&quot;lambda_hat&quot;</span><span class="ot">=</span>lambda_hat))</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  })</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span><span class="do">########################################| 100%</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>Done. No errors or warnings detected.</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> sim <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="fu">list</span>(<span class="at">stat=</span><span class="st">&quot;mse&quot;</span>, <span class="at">name=</span><span class="st">&quot;lambda_mse&quot;</span>, <span class="at">estimate=</span><span class="st">&quot;lambda_hat&quot;</span>, <span class="at">truth=</span><span class="dv">5</span>),</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>    <span class="at">mc_se =</span> <span class="cn">TRUE</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  )</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  level_id    n n_reps lambda_mse lambda_mse_mc_se lambda_mse_mc_ci_l</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="dv">1</span>   <span class="dv">10</span>      <span class="dv">5</span>  <span class="fl">0.5020000</span>      <span class="fl">0.274178774</span>      <span class="sc">-</span><span class="fl">0.0353903966</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="dv">2</span>  <span class="dv">100</span>      <span class="dv">5</span>  <span class="fl">0.0142800</span>      <span class="fl">0.012105759</span>      <span class="sc">-</span><span class="fl">0.0094472876</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        <span class="dv">3</span> <span class="dv">1000</span>      <span class="dv">5</span>  <span class="fl">0.0031878</span>      <span class="fl">0.001919004</span>      <span class="sc">-</span><span class="fl">0.0005734471</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  lambda_mse_mc_ci_u</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="fl">1.039390397</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="fl">0.038007288</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        <span class="fl">0.006949047</span></span></code></pre></div>
<h3 data-number="6" id="sec:discussion"><span class="header-section-number">6</span> Discussion</h3>
<p>In this article, we described
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>, an
open-source R package for structuring, maintaining, running, and
debugging statistical simulations. We reviewed the overall guiding
design principles of the package, illustrated its workflow and main
functions, highlighted local and CCS-based parallelization capabilities,
and demonstrated advanced functionality. It is our hope that this
article publicizes the existence of the package and leads to an increase
in the size and engagement of the active user community.</p>
<p><a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> is one of
several R packages aimed at users conducting statistical simulations but
is, to our knowledge, the only package explicitly intended for use in a
CCS environment. The
<a href="https://CRAN.R-project.org/package=simulator"><strong>simulator</strong></a> package
(Bien 2016) provides a modular and flexible framework to structure
simulations but contains no functionality designed specifically for
debugging simulations or leveraging a CCS. The
<a href="https://CRAN.R-project.org/package=simpr"><strong>simpr</strong></a> package (Brown and
Bye 2023) uses tidy principles but does not emphasize flexibility, with
a relatively limited scope. Likewise,
<a href="https://CRAN.R-project.org/package=simFrame"><strong>simFrame</strong></a> (Alfons,
Templ, and Filzmoser 2010), an object-oriented simulation package, makes
available a suite of relatively specific simulation tools, which are
intended primarily for survey statistics. Both
<a href="https://CRAN.R-project.org/package=SimDesign"><strong>SimDesign</strong></a> (Chalmers
and Adkins 2020) and
<a href="https://CRAN.R-project.org/package=simsalapar"><strong>simsalapar</strong></a> (Hofert
and Mächler 2013) are designed for ease of use but are somewhat less
modular than other packages, with a single function for generating
simulated data, running analyses, and summarizing results. The recent
<a href="https://CRAN.R-project.org/package=simChef"><strong>simChef</strong></a> package
(Duncan et al. 2024) uses a tidy grammar framework and has additional
functionality for preparing reports on the results of a simulation
study. Additionally, there are a host of packages available that aid in
simulating particular data structures, such as
<a href="https://CRAN.R-project.org/package=riskSimul"><strong>riskSimul</strong></a> (Hormann
and Basoglu 2023),
<a href="https://CRAN.R-project.org/package=GlmSimulatoR"><strong>GlmSimulatoR</strong></a>
(McMahan 2023), and
<a href="https://CRAN.R-project.org/package=PhenotypeSimulator"><strong>PhenotypeSimulator</strong></a>
(Meyer and Birney 2018), which can be used in conjunction with a package
for structuring simulations if applicable.</p>
<p>We chose to write this package specifically for the R programming
language since this language is widely used by statistical methods
developers; as evidence of this claim, a review of the top ten studies
from a simple Google Scholar search of the term “simulation study”
(restricted to the last five years) shows that, out of the eight studies
that stated the programming language used, six were coded using R
(Belias et al. 2019; Edelsbrunner, Flaig, and Schneider 2023; Todorov,
Searle-White, and Gerber 2020; Rusticus and Lovato 2019; Manolov 2019;
Bower et al. 2021; Hamza et al. 2021; Thompson et al. 2021). That being
said, it could be of practical value in the future to port the package
to other programming environments.</p>
<p>Moving forward, future development of the package will be driven mainly
by requests from active users, screening and prioritizing potential
additions or modifications based on the design principles articulated in
Section <a href="#sec:design" data-reference-type="ref" data-reference="sec:design">2</a>.
In particular, we hope to focus on improving parallelization
capabilities, including expansion of SimEngine to other parallelization
platforms (e.g., Apache Spark), support for futures/promises (as in the
<a href="https://CRAN.R-project.org/package=future"><strong>future</strong></a> package), and
further automation of the cluster parallelization process (possibly by
having <a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a>
automatically create and submit <code>sbatch</code> commands, as is done in the
<a href="https://CRAN.R-project.org/package=rslurm"><strong>rslurm</strong></a> package). Users
can navigate to <a href="https://github.com/Avi-Kenny/SimEngine/issues" class="uri">https://github.com/Avi-Kenny/SimEngine/issues</a> to
submit feature requests and view current open issues. Additionally,
because SimEngine is built using the R S3 class system, it is extensible
and allows for users to write additional methods customized to their
particular needs, workflow, and style, such as functionality for
plotting simulation results.</p>
<h3 class="unnumbered" id="computational-details">Computational details</h3>
<p>The results in this paper were obtained using R 4.3.2 with the
<a href="https://CRAN.R-project.org/package=SimEngine"><strong>SimEngine</strong></a> 1.4.0
package. R itself and all packages used are available from the
Comprehensive R Archive Network (CRAN) at <a href="https://CRAN.R-project.org/" class="uri">https://CRAN.R-project.org/</a>.</p>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-alfons2010object" class="csl-entry" role="listitem">
Alfons, Andreas, Matthias Templ, and Peter Filzmoser. 2010. “An
Object-Oriented Framework for Statistical Simulation: The R Package
simFrame.” <em>Journal of Statistical Software</em> 37: 1–36.
</div>
<div id="ref-arnold2011simulation" class="csl-entry" role="listitem">
Arnold, Benjamin F, Daniel R Hogan, John M Colford, and Alan E Hubbard.
2011. “Simulation Methods to Estimate Design Power: An Overview for
Applied Research.” <em>BMC Medical Research Methodology</em> 11 (1): 1–10.
</div>
<div id="ref-bache2022magrittr" class="csl-entry" role="listitem">
Bache, Stefan Milton, and Hadley Wickham. 2022. <em>Magrittr: A
Forward-Pipe Operator for R</em>.
<a href="https://CRAN.R-project.org/package=magrittr" class="uri">https://CRAN.R-project.org/package=magrittr</a>.
</div>
<div id="ref-belias2019statistical" class="csl-entry" role="listitem">
Belias, Michail, Maroeska M Rovers, Johannes B Reitsma, Thomas PA
Debray, and Joanna IntHout. 2019. “Statistical Approaches to Identify
Subgroups in Meta-Analysis of Individual Participant Data: A Simulation
Study.” <em>BMC Medical Research Methodology</em> 19: 1–13.
</div>
<div id="ref-bien2016simulator" class="csl-entry" role="listitem">
Bien, Jacob. 2016. “The Simulator: An Engine to Streamline Simulations.”
<em>arXiv Preprint arXiv:1607.00021</em>.
</div>
<div id="ref-bower2021capturing" class="csl-entry" role="listitem">
Bower, Hannah, Michael J Crowther, Mark J Rutherford, Therese M-L
Andersson, Mark Clements, Xing-Rong Liu, Paul W Dickman, and Paul C
Lambert. 2021. “Capturing Simple and Complex Time-Dependent Effects
Using Flexible Parametric Survival Models: A Simulation Study.”
<em>Communications in Statistics-Simulation and Computation</em> 50 (11):
3777–93.
</div>
<div id="ref-brown2023simpr" class="csl-entry" role="listitem">
Brown, Ethan, and Jeffrey Bye. 2023. <em>Simpr: Flexible
‘Tidyverse’-Friendly Simulations</em>.
<a href="https://CRAN.R-project.org/package=simpr" class="uri">https://CRAN.R-project.org/package=simpr</a>.
</div>
<div id="ref-chalmers2020writing" class="csl-entry" role="listitem">
Chalmers, R Philip, and Mark C Adkins. 2020. “Writing Effective and
Reliable Monte Carlo Simulations with the SimDesign Package.” <em>The
Quantitative Methods for Psychology</em> 16 (4): 248–80.
</div>
<div id="ref-duncan2024simchef" class="csl-entry" role="listitem">
Duncan, James, Tiffany Tang, Corrine F Elliott, Philippe Boileau, and
Bin Yu. 2024. “simChef: High-Quality Data Science Simulations in R.”
<em>Journal of Open Source Software</em> 9 (95): 6156.
</div>
<div id="ref-edelsbrunner2023simulation" class="csl-entry" role="listitem">
Edelsbrunner, Peter A, Maja Flaig, and Michael Schneider. 2023. “A
Simulation Study on Latent Transition Analysis for Examining Profiles
and Trajectories in Education: Recommendations for Fit Statistics.”
<em>Journal of Research on Educational Effectiveness</em> 16 (2): 350–75.
</div>
<div id="ref-hamza2021bayesian" class="csl-entry" role="listitem">
Hamza, Tasnim, Andrea Cipriani, Toshi A Furukawa, Matthias Egger, Nicola
Orsini, and Georgia Salanti. 2021. “A Bayesian Dose–Response
Meta-Analysis Model: A Simulations Study and Application.” <em>Statistical
Methods in Medical Research</em> 30 (5): 1358–72.
</div>
<div id="ref-hauck1984survey" class="csl-entry" role="listitem">
Hauck, Walter W, and Sharon Anderson. 1984. “A Survey Regarding the
Reporting of Simulation Studies.” <em>The American Statistician</em> 38 (3):
214–16.
</div>
<div id="ref-hofert2013parallel" class="csl-entry" role="listitem">
Hofert, Marius, and Martin Mächler. 2013. “Parallel and Other
Simulations in R Made Easy: An End-to-End Study.” <em>arXiv Preprint
arXiv:1309.4402</em>.
</div>
<div id="ref-riskSimul" class="csl-entry" role="listitem">
Hormann, Wolfgang, and Ismail Basoglu. 2023. <em>riskSimul: Risk
Quantification for Stock Portfolios Under the T-Copula Model</em>.
<a href="https://CRAN.R-project.org/package=riskSimul" class="uri">https://CRAN.R-project.org/package=riskSimul</a>.
</div>
<div id="ref-koehler2009assessment" class="csl-entry" role="listitem">
Koehler, Elizabeth, Elizabeth Brown, and Sebastien J-PA Haneuse. 2009.
“On the Assessment of Monte Carlo Error in Simulation-Based Statistical
Analyses.” <em>The American Statistician</em> 63 (2): 155–62.
</div>
<div id="ref-lee1999effect" class="csl-entry" role="listitem">
Lee, Stephen MS, and G Alastair Young. 1999. “The Effect of Monte Carlo
Approximation on Coverage Error of Double-Bootstrap Confidence
Intervals.” <em>Journal of the Royal Statistical Society Series B:
Statistical Methodology</em> 61 (2): 353–66.
</div>
<div id="ref-manolov2019simulation" class="csl-entry" role="listitem">
Manolov, Rumen. 2019. “A Simulation Study on Two Analytical Techniques
for Alternating Treatments Designs.” <em>Behavior Modification</em> 43 (4):
544–63.
</div>
<div id="ref-GlmSimulatoR" class="csl-entry" role="listitem">
McMahan, Greg. 2023. <em>GlmSimulatoR: Creates Ideal Data for Generalized
Linear Models</em>. <a href="https://CRAN.R-project.org/package=GlmSimulatoR" class="uri">https://CRAN.R-project.org/package=GlmSimulatoR</a>.
</div>
<div id="ref-PhenotypeSimulator" class="csl-entry" role="listitem">
Meyer, Hannah V, and Ewan Birney. 2018. “PhenotypeSimulator: A
Comprehensive Framework for Simulating Multi-Trait, Multi-Locus Genotype
to Phenotype Relationships.” <em>Bioinformatics</em> 34 (17): 2951–56.
</div>
<div id="ref-morris2019" class="csl-entry" role="listitem">
Morris, Tim P, Ian R White, and Michael J Crowther. 2019. “Using
Simulation Studies to Evaluate Statistical Methods.” <em>Statistics in
Medicine</em> 38 (11): 2074–2102.
</div>
<div id="ref-Rsoftware" class="csl-entry" role="listitem">
R Core Team. 2021. <em>R: A Language and Environment for Statistical
Computing</em>. Vienna, Austria: R Foundation for Statistical Computing.
<a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>.
</div>
<div id="ref-rusticus2019impact" class="csl-entry" role="listitem">
Rusticus, Shayna A, and Chris Y Lovato. 2019. “Impact of Sample Size and
Variability on the Power and Type I Error Rates of Equivalence Tests: A
Simulation Study.” <em>Practical Assessment, Research, and Evaluation</em> 19
(1): 11.
</div>
<div id="ref-thompson2021comparison" class="csl-entry" role="listitem">
Thompson, JA, K Hemming, A Forbes, K Fielding, and R Hayes. 2021.
“Comparison of Small-Sample Standard-Error Corrections for Generalised
Estimating Equations in Stepped Wedge Cluster Randomised Trials with a
Binary Outcome: A Simulation Study.” <em>Statistical Methods in Medical
Research</em> 30 (2): 425–39.
</div>
<div id="ref-todorov2020applying" class="csl-entry" role="listitem">
Todorov, Hristo, Emily Searle-White, and Susanne Gerber. 2020. “Applying
Univariate Vs. Multivariate Statistics to Investigate Therapeutic
Efficacy in (Pre) Clinical Trials: A Monte Carlo Simulation Study on the
Example of a Controlled Preclinical Neurotrauma Trial.” <em>PLoS One</em> 15
(3): e0230798.
</div>
<div id="ref-wakefield2013bayesian" class="csl-entry" role="listitem">
Wakefield, Jon. 2013. <em>Bayesian and Frequentist Regression Methods</em>.
Vol. 23. Springer.
</div>
</div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h3 class="appendix" data-number="7" id="supplementary-materials"><span class="header-section-number">7</span> Supplementary materials</h3>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2025-010.zip">RJ-2025-010.zip</a></p>
<h3 class="appendix" data-number="8" id="cran-packages-used"><span class="header-section-number">8</span> CRAN packages used</h3>
<p><a href="https://cran.r-project.org/package=SimEngine">SimEngine</a>, <a href="https://cran.r-project.org/package=magrittr">magrittr</a>, <a href="https://cran.r-project.org/package=parallel">parallel</a>, <a href="https://cran.r-project.org/package=simulator">simulator</a>, <a href="https://cran.r-project.org/package=simpr">simpr</a>, <a href="https://cran.r-project.org/package=simFrame">simFrame</a>, <a href="https://cran.r-project.org/package=SimDesign">SimDesign</a>, <a href="https://cran.r-project.org/package=simsalapar">simsalapar</a>, <a href="https://cran.r-project.org/package=simChef">simChef</a>, <a href="https://cran.r-project.org/package=riskSimul">riskSimul</a>, <a href="https://cran.r-project.org/package=GlmSimulatoR">GlmSimulatoR</a>, <a href="https://cran.r-project.org/package=PhenotypeSimulator">PhenotypeSimulator</a>, <a href="https://cran.r-project.org/package=future">future</a>, <a href="https://cran.r-project.org/package=rslurm">rslurm</a></p>
<h3 class="appendix" data-number="9" id="cran-task-views-implied-by-cited-packages"><span class="header-section-number">9</span> CRAN Task Views implied by cited packages</h3>
<p><a href="https://cran.r-project.org/view=Finance">Finance</a>, <a href="https://cran.r-project.org/view=HighPerformanceComputing">HighPerformanceComputing</a>, <a href="https://cran.r-project.org/view=MissingData">MissingData</a></p>
<h3 class="appendix" data-number="10" id="note"><span class="header-section-number">10</span> Note</h3>
<p>This article is converted from a Legacy LaTeX article using the
<a href="https://cran.r-project.org/package=texor">texor</a> package.
The pdf version is the official version. To report a problem with the html,
refer to CONTRIBUTE on the R Journal homepage.</p>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Kenny &amp; Wolock, "SimEngine: A Modular Framework for Statistical Simulations in R", The R Journal, 2025</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2025-010,
  author = {Kenny, Avi and Wolock, Charles J.},
  title = {SimEngine: A Modular Framework for Statistical Simulations in R},
  journal = {The R Journal},
  year = {2025},
  note = {https://doi.org/10.32614/RJ-2025-010},
  doi = {10.32614/RJ-2025-010},
  volume = {17},
  issue = {1},
  issn = {2073-4859},
  pages = {200-220}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
