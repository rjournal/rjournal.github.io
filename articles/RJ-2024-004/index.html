<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
      margin-bottom: 0em;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>Prediction, Bootstrapping and Monte Carlo Analyses Based on Linear Mixed Models with QAPE 2.0 Package</title>

<meta property="description" itemprop="description" content="The paper presents a new R package&#10;[**qape**](https://CRAN.R-project.org/package=qape) for prediction,&#10;accuracy estimation of various predictors and Monte Carlo simulation&#10;studies of properties of both predictors and estimators of accuracy&#10;measures. It allows to predict any population and subpopulation&#10;characteristics of the response variable based on the Linear Mixed&#10;Model (LMM). The response variable can be transformed, e.g. to&#10;logarithm and the data can be in the cross-sectional or longitudinal&#10;framework. Three bootstrap algorithms are developed: parametric,&#10;residual and double, allowing to estimate the prediction accuracy.&#10;Analyses can also include Monte Carlo simulation studies of properties&#10;of the methods used. Unlike other packages, in the prediction process&#10;the user can flexibly define the predictor, the model, the&#10;transformation function of the response variable, the predicted&#10;characteristics and the method of accuracy estimation."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2024-004/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2025-01-10"/>
<meta property="article:created" itemprop="dateCreated" content="2025-01-10"/>
<meta name="article:author" content="Alicja Wolny--Dominiak"/>
<meta name="article:author" content="Tomasz Ża̧dło"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Prediction, Bootstrapping and Monte Carlo Analyses Based on Linear Mixed Models with QAPE 2.0 Package"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="The paper presents a new R package&#10;[**qape**](https://CRAN.R-project.org/package=qape) for prediction,&#10;accuracy estimation of various predictors and Monte Carlo simulation&#10;studies of properties of both predictors and estimators of accuracy&#10;measures. It allows to predict any population and subpopulation&#10;characteristics of the response variable based on the Linear Mixed&#10;Model (LMM). The response variable can be transformed, e.g. to&#10;logarithm and the data can be in the cross-sectional or longitudinal&#10;framework. Three bootstrap algorithms are developed: parametric,&#10;residual and double, allowing to estimate the prediction accuracy.&#10;Analyses can also include Monte Carlo simulation studies of properties&#10;of the methods used. Unlike other packages, in the prediction process&#10;the user can flexibly define the predictor, the model, the&#10;transformation function of the response variable, the predicted&#10;characteristics and the method of accuracy estimation."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2024-004/"/>
<meta property="og:image" content="https://journal.r-project.org/articles/RJ-2024-004/mapaAll.png"/>
<meta property="og:image:width" content="1016"/>
<meta property="og:image:height" content="300"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Prediction, Bootstrapping and Monte Carlo Analyses Based on Linear Mixed Models with QAPE 2.0 Package"/>
<meta property="twitter:description" content="The paper presents a new R package&#10;[**qape**](https://CRAN.R-project.org/package=qape) for prediction,&#10;accuracy estimation of various predictors and Monte Carlo simulation&#10;studies of properties of both predictors and estimators of accuracy&#10;measures. It allows to predict any population and subpopulation&#10;characteristics of the response variable based on the Linear Mixed&#10;Model (LMM). The response variable can be transformed, e.g. to&#10;logarithm and the data can be in the cross-sectional or longitudinal&#10;framework. Three bootstrap algorithms are developed: parametric,&#10;residual and double, allowing to estimate the prediction accuracy.&#10;Analyses can also include Monte Carlo simulation studies of properties&#10;of the methods used. Unlike other packages, in the prediction process&#10;the user can flexibly define the predictor, the model, the&#10;transformation function of the response variable, the predicted&#10;characteristics and the method of accuracy estimation."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2024-004/"/>
<meta property="twitter:image" content="https://journal.r-project.org/articles/RJ-2024-004/mapaAll.png"/>
<meta property="twitter:image:width" content="1016"/>
<meta property="twitter:image:height" content="300"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Prediction, Bootstrapping and Monte Carlo Analyses Based on Linear Mixed Models with QAPE 2.0 Package"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2024-004"/>
<meta name="citation_pdf_url" content="RJ-2024-004.pdf"/>
<meta name="citation_volume" content="16"/>
<meta name="citation_issue" content="1"/>
<meta name="citation_doi" content="10.32614/RJ-2024-004"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="67"/>
<meta name="citation_lastpage" content="82"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2025/01/10"/>
<meta name="citation_publication_date" content="2025/01/10"/>
<meta name="citation_author" content="Alicja Wolny--Dominiak"/>
<meta name="citation_author_institution" content="Department of Statistical and Mathematical Methods in Economics"/>
<meta name="citation_author" content="Tomasz Ża̧dło"/>
<meta name="citation_author_institution" content="Department of Statistics, Econometrics and Mathematics"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Empirical best prediction under area-level poisson mixed models;citation_publisher=Springer;citation_volume=25;citation_author=Miguel Boubeta;citation_author=Marı́a José Lombardı́a;citation_author=Domingo Morales"/>
  <meta name="citation_reference" content="citation_title=Small area estimation-based prediction methods to track poverty: Validation and applications;citation_publisher=Springer;citation_volume=10;citation_author=Luc Christiaensen;citation_author=Peter Lanjouw;citation_author=Jill Luoto;citation_author=David Stifel"/>
  <meta name="citation_reference" content="citation_title=On properties of empirical best predictors;citation_publisher=Taylor &amp; Francis;citation_author=Adam Chwila;citation_author=Tomasz Żądło"/>
  <meta name="citation_reference" content="citation_title=Estimation of the mean squared error of predictors of small area linear parameters under a logistic mixed model;citation_publisher=Elsevier;citation_volume=51;citation_author=Wenceslao González-Manteiga;citation_author=Maríá José Lombardı́a;citation_author=Isabel Molina;citation_author=Domingo Morales;citation_author=Laureano Santamarı́a"/>
  <meta name="citation_reference" content="citation_title=Bootstrap mean squared error of small-area EBLUP;citation_volume=78;citation_author=Wenceslao González-Manteiga;citation_author=Maríá José Lombardı́a;citation_author=Isabel Molina;citation_author=Domingo Morales;citation_author=Laureano Santamarı́a"/>
  <meta name="citation_reference" content="citation_title=Estimation of genetic parameters;citation_volume=6;citation_author=Charles R Henderson"/>
  <meta name="citation_reference" content="citation_title=Empirical best prediction under unit-level logit mixed models;citation_publisher=Sciendo;citation_volume=32;citation_author=Tomáš Hobza;citation_author=Domingo Morales"/>
  <meta name="citation_reference" content="citation_title=REML estimation: Asymptotic behavior and related topics;citation_publisher=Institute of Mathematical Statistics;citation_volume=24;citation_author=Jiming Jiang"/>
  <meta name="citation_reference" content="citation_title=Unbiasedness of two-stage estimation and prediction procedures for mixed linear models;citation_publisher=Taylor &amp; Francis;citation_volume=10;citation_author=Raghu N Kackar;citation_author=David A Harville"/>
  <meta name="citation_reference" content="citation_title=The r package emdi for estimating and mapping regionally disaggregated indicators;citation_volume=91;citation_author=Ann-Kristin Kreutzmann;citation_author=Sören Pannier;citation_author=Natalia Rojas-Perilla;citation_author=Timo Schmid;citation_author=Matthias Templ;citation_author=Nikos Tzavidis"/>
  <meta name="citation_reference" content="citation_title=Small area estimation of poverty indicators;citation_publisher=Wiley Online Library;citation_volume=38;citation_author=Isabel Molina;citation_author=JNK2010 Rao"/>
  <meta name="citation_reference" content="citation_title=Small-area estimation by combining time-series and cross-sectional data;citation_publisher=Wiley Online Library;citation_volume=22;citation_author=Jon NK Rao;citation_author=Mingyu Yu"/>
  <meta name="citation_reference" content="citation_title=The linear least-squares prediction approach to two-stage sampling;citation_publisher=Taylor &amp; Francis Group;citation_volume=71;citation_author=Richard M Royall"/>
  <meta name="citation_reference" content="citation_title=On bootstrap estimators of some prediction accuracy measures of loss reserves in a non-life insurance company;citation_publisher=Taylor &amp; Francis;citation_author=Alicja Wolny-Dominiak;citation_author=Tomasz Żądło"/>
  <meta name="citation_reference" content="citation_title=On parametric bootstrap and alternatives of MSE;citation_author=T Żądło"/>
  <meta name="citation_reference" content="citation_title=On prediction of population and subpopulation characteristics for future periods;citation_publisher=Taylor &amp; Francis;citation_volume=461;citation_author=Tomasz Żądło"/>
  <meta name="citation_reference" content="citation_title=A longitudinal data analysis interpretation of credibility models;citation_publisher=Elsevier;citation_volume=24;citation_author=Edward W Frees;citation_author=Virginia R Young;citation_author=Yu Luo"/>
  <meta name="citation_reference" content="citation_title=A course in credibility theory and its applications;citation_publisher=Springer;citation_author=Hans Bühlmann;citation_author=Alois Gisler"/>
  <meta name="citation_reference" content="citation_title=Qape: Quantile of absolute prediction errors;citation_author=Alicja Wolny-Dominiak;citation_author=Tomasz Żądło"/>
  <meta name="citation_reference" content="citation_title=Estimates of income for small places: An application of james-stein procedures to census data;citation_publisher=Taylor &amp; Francis;citation_volume=74;citation_author=Robert E Fay III;citation_author=Roger A Herriot"/>
  <meta name="citation_reference" content="citation_title=JoSAE: Unit-level and area-level small area estimation;citation_author=Johannes Breidenbach"/>
  <meta name="citation_reference" content="citation_title=An error-components model for prediction of county crop areas using survey and satellite data;citation_publisher=Taylor &amp; Francis;citation_volume=83;citation_author=George E Battese;citation_author=Rachel M Harter;citation_author=Wayne A Fuller"/>
  <meta name="citation_reference" content="citation_title=Small area estimation;citation_publisher=John Wiley &amp; Sons;citation_author=John NK Rao;citation_author=Isabel Molina"/>
  <meta name="citation_reference" content="citation_title=Fitting linear mixed-effects models using lme4;citation_volume=67;citation_doi=10.18637/jss.v067.i01;citation_author=Douglas Bates;citation_author=Martin Mächler;citation_author=Ben Bolker;citation_author=Steve Walker"/>
  <meta name="citation_reference" content="citation_title=Msae: Multivariate fay herriot models for small area estimation;citation_author=Novia Permatasari;citation_author=Azka Ubaidillah"/>
  <meta name="citation_reference" content="citation_title=sae: An R package for small area estimation;citation_volume=7;citation_author=Isabel Molina;citation_author=Yolanda Marhuenda"/>
  <meta name="citation_reference" content="citation_title=Saery: Small area estimation for rao and yu model;citation_author=Maria Dolores Esteban Lefler;citation_author=Domingo Morales Gonzalez;citation_author=Agustin Perez Martin"/>
  <meta name="citation_reference" content="citation_title=Statistically based methodologies for mapping of radon’actual’concentrations: The case of minnesota;citation_publisher=Oxford University Press;citation_volume=56;citation_author=AV Nero;citation_author=SM Leiden;citation_author=DA Nolan;citation_author=PN Price;citation_author=S Rein;citation_author=KL Revzan;citation_author=HR Woolenberg;citation_author=AJ Gadgil"/>
  <meta name="citation_reference" content="citation_title=Bayesian prediction of mean indoor radon concentrations for minnesota counties;citation_publisher=LWW;citation_volume=71;citation_author=Phillip N Price;citation_author=Anthony V Nero;citation_author=Andrew Gelman"/>
  <meta name="citation_reference" content="citation_title=Bayesian measures of explained variance and pooling in multilevel (hierarchical) models;citation_publisher=Taylor &amp; Francis;citation_volume=48;citation_author=Andrew Gelman;citation_author=Iain Pardoe"/>
  <meta name="citation_reference" content="citation_title=Diagnostics for mixed/hierarchical linear models;citation_publisher=Iowa State University;citation_author=Adam Loy"/>
  <meta name="citation_reference" content="citation_title=Are you normal? The problem of confounded residual structures in hierarchical linear models;citation_publisher=Taylor &amp; Francis;citation_volume=24;citation_author=Adam Loy;citation_author=Heike Hofmann"/>
  <meta name="citation_reference" content="citation_title=Model choice and diagnostics for linear mixed-effects models using statistics on street corners;citation_publisher=Taylor &amp; Francis;citation_volume=26;citation_author=Adam Loy;citation_author=Heike Hofmann;citation_author=Dianne Cook"/>
  <meta name="citation_reference" content="citation_title=Review and comparison of measures of explained variation and model selection in linear mixed-effects models;citation_publisher=Elsevier;citation_author=Eva Cantoni;citation_author=Nadège Jacot;citation_author=Paolo Ghisletta"/>
  <meta name="citation_reference" content="citation_title=Analysis of local decisions using hierarchical modeling, applied to home radon measurement and remediation;citation_publisher=Institute of Mathematical Statistics;citation_volume=14;citation_author=Chiayu Lin;citation_author=Andrew Gelman;citation_author=Phillip N Price;citation_author=David H Krantz"/>
  <meta name="citation_reference" content="citation_title=Should you measure the radon concentration in your home?;citation_publisher=Duxbury Press;citation_author=Phillip N. Price;citation_author=Andrew Gelman"/>
  <meta name="citation_reference" content="citation_title=Interactive and dynamic graphics for data analysis: With r and GGobi;citation_publisher=Springer;citation_volume=1;citation_author=Dianne Cook;citation_author=Deborah F Swayne;citation_author=Andreas Buja"/>
  <meta name="citation_reference" content="citation_title=Data Analysis Using Regression and Multilevel/Hierarchical Models;citation_publisher=Cambridge University Press;citation_author=Andrew Gelman;citation_author=Jennifer Hill"/>
  <meta name="citation_reference" content="citation_title=HLMdiag: A suite of diagnostics for hierarchical linear models in R;citation_volume=56;citation_author=Adam Loy;citation_author=Heike Hofmann"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","date_received","journal","volume","issue","slug","citation_url","packages","preview","bibliography","CTV","legacy_pdf","legacy_converted","output","draft","pdf_url","doi","creative_commons","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Prediction, Bootstrapping and Monte Carlo Analyses Based on Linear Mixed Models with QAPE 2.0 Package"]},{"type":"character","attributes":{},"value":["The paper presents a new R package\n[**qape**](https://CRAN.R-project.org/package=qape) for prediction,\naccuracy estimation of various predictors and Monte Carlo simulation\nstudies of properties of both predictors and estimators of accuracy\nmeasures. It allows to predict any population and subpopulation\ncharacteristics of the response variable based on the Linear Mixed\nModel (LMM). The response variable can be transformed, e.g. to\nlogarithm and the data can be in the cross-sectional or longitudinal\nframework. Three bootstrap algorithms are developed: parametric,\nresidual and double, allowing to estimate the prediction accuracy.\nAnalyses can also include Monte Carlo simulation studies of properties\nof the methods used. Unlike other packages, in the prediction process\nthe user can flexibly define the predictor, the model, the\ntransformation function of the response variable, the predicted\ncharacteristics and the method of accuracy estimation."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Alicja Wolny--Dominiak"]},{"type":"character","attributes":{},"value":["Department of Statistical and Mathematical Methods in Economics"]},{"type":"character","attributes":{},"value":["University of Economics in Katowice","50, 1 Maja Street","40--287 Katowice","Poland","[alicja.wolny-dominiak@uekat.pl](alicja.wolny-dominiak@uekat.pl){.uri}\n","[web.ue.katowice.pl/woali/](web.ue.katowice.pl/woali/){.uri}\n"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Tomasz Ża̧dło"]},{"type":"character","attributes":{},"value":["Department of Statistics, Econometrics and Mathematics"]},{"type":"character","attributes":{},"value":["University of Economics in Katowice","50, 1 Maja Street","40--287 Katowice","Poland","[tomasz.zadlo@uekat.pl](tomasz.zadlo@uekat.pl){.uri}\n","[web.ue.katowice.pl/zadlo/](web.ue.katowice.pl/zadlo/){.uri}\n"]}]}]},{"type":"character","attributes":{},"value":["2025-01-10"]},{"type":"character","attributes":{},"value":["2022-08-12"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[67]},{"type":"integer","attributes":{},"value":[82]}]},{"type":"integer","attributes":{},"value":[16]},{"type":"integer","attributes":{},"value":[1]},{"type":"character","attributes":{},"value":["RJ-2024-004"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2024-004"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["qape","sae","msae","saery","JoSAE","emdi","HLMdiag","lme4"]},{"type":"list","attributes":{},"value":[]}]},{"type":"character","attributes":{},"value":["preview.png"]},{"type":"character","attributes":{},"value":["wolny-zadlo.bib"]},{"type":"character","attributes":{},"value":["Econometrics","Environmetrics","MixedModels","OfficialStatistics","Psychometrics","SpatioTemporal"]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","mathjax","md_extension"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"]},{"type":"character","attributes":{},"value":["-tex_math_single_backslash"]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["RJ-2024-004.pdf"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2024-004"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["/home/mitchell/R/x86_64-pc-linux-gnu-library/4.4/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2024-004/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["appendix.pdf","appendix.tex","boxAll.png","histAll.png","mapa1.png","mapa2.png","mapaAll.png","RJ-2024-004_files/anchor-4.2.2/anchor.min.js","RJ-2024-004_files/bowser-1.9.3/bowser.min.js","RJ-2024-004_files/distill-2.2.21/template.v2.js","RJ-2024-004_files/header-attrs-2.29/header-attrs.js","RJ-2024-004_files/jquery-3.6.0/jquery-3.6.0.js","RJ-2024-004_files/jquery-3.6.0/jquery-3.6.0.min.js","RJ-2024-004_files/jquery-3.6.0/jquery-3.6.0.min.map","RJ-2024-004_files/popper-2.6.0/popper.min.js","RJ-2024-004_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2024-004_files/tippy-6.2.7/tippy-light-border.css","RJ-2024-004_files/tippy-6.2.7/tippy.css","RJ-2024-004_files/tippy-6.2.7/tippy.umd.min.js","RJ-2024-004_files/webcomponents-2.0.0/webcomponents.js","RJ-2024-004.zip","RJournal.sty","RJwrapper_appendix.tex","RJwrapper.log","RJwrapper.tex","wolny-zadlo.bib","wolny-zadlo.tex"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.29/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Mathjax config (add automatic linebreaks when supported)
      // MathJax = {
      //    tex: {
      //        inlineMath: [['$', '$'], ['\\(', '\\)']],
      //        displayMath: [['$$', '$$'], ['\\[', '\\]']],
      //        tags: 'ams',
      //        multline: true,
      //    },
      //    options: {
      //        linebreaks: { automatic: true },
      //    },
      // };

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="' + slug + '.zip" class="dt-tag"><i class="fas fa-file-zipper"></i> Supplement</a>')

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").filter(function() {
        return !$(this).hasClass("subtitle");
      }).first();
      if (tpar) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append(tpar) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Prediction, Bootstrapping and Monte Carlo Analyses Based on Linear Mixed Models with QAPE 2.0 Package","description":"The paper presents a new R package\n[**qape**](https://CRAN.R-project.org/package=qape) for prediction,\naccuracy estimation of various predictors and Monte Carlo simulation\nstudies of properties of both predictors and estimators of accuracy\nmeasures. It allows to predict any population and subpopulation\ncharacteristics of the response variable based on the Linear Mixed\nModel (LMM). The response variable can be transformed, e.g. to\nlogarithm and the data can be in the cross-sectional or longitudinal\nframework. Three bootstrap algorithms are developed: parametric,\nresidual and double, allowing to estimate the prediction accuracy.\nAnalyses can also include Monte Carlo simulation studies of properties\nof the methods used. Unlike other packages, in the prediction process\nthe user can flexibly define the predictor, the model, the\ntransformation function of the response variable, the predicted\ncharacteristics and the method of accuracy estimation.","doi":"10.32614/RJ-2024-004","authors":[{"author":"Alicja Wolny--Dominiak","authorURL":"#","affiliation":"Department of Statistical and Mathematical Methods in Economics","affiliationURL":"#","orcidID":""},{"author":"Tomasz Ża̧dło","authorURL":"#","affiliation":"Department of Statistics, Econometrics and Mathematics","affiliationURL":"#","orcidID":""}],"publishedDate":"2025-01-10T00:00:00.000+00:00","citationText":"Wolny--Dominiak & Ża̧dło, 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues/2024-4">Current</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../submissions.html">Submit</a>
<a href="../../editors.html">Editorial board</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Prediction, Bootstrapping and Monte Carlo Analyses Based on Linear Mixed Models with QAPE 2.0 Package</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>The paper presents a new R package
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> for prediction,
accuracy estimation of various predictors and Monte Carlo simulation
studies of properties of both predictors and estimators of accuracy
measures. It allows to predict any population and subpopulation
characteristics of the response variable based on the Linear Mixed
Model (LMM). The response variable can be transformed, e.g. to
logarithm and the data can be in the cross-sectional or longitudinal
framework. Three bootstrap algorithms are developed: parametric,
residual and double, allowing to estimate the prediction accuracy.
Analyses can also include Monte Carlo simulation studies of properties
of the methods used. Unlike other packages, in the prediction process
the user can flexibly define the predictor, the model, the
transformation function of the response variable, the predicted
characteristics and the method of accuracy estimation.</p></p>
</div>

<div class="d-byline">
  Alicja Wolny–Dominiak  (Department of Statistical and Mathematical Methods in Economics)
  
,   Tomasz Ża̧dło  (Department of Statistics, Econometrics and Mathematics)
  
<br/>2025-01-10
</div>

<div class="d-article">
<div class="article">
<h3 data-number="1" id="intro"><span class="header-section-number">1</span> Introduction</h3>
<p>One of the tasks in application of mixed models in the real-life
problems is the prediction of random effects. Then, the predicted values
give the possibility for further prediction, e.g. characteristics of
interest such as sum, mean or quantiles or the future value of the
response variable for cross-sectional or longitudinal data.</p>
<p>Three main predictors of these characteristics are proposed in the
literature: Empirical Best Linear Unbiased Predictors - EBLUPs (see e.g.
<span class="citation" data-cites="henderson1950estimation">(<a href="#ref-henderson1950estimation" role="doc-biblioref">Henderson 1950</a>)</span> and <span class="citation" data-cites="royall1976linear">(<a href="#ref-royall1976linear" role="doc-biblioref">Royall 1976</a>)</span>), PLUG-IN predictors
(see e.g. <span class="citation" data-cites="boubeta2016empirical">(<a href="#ref-boubeta2016empirical" role="doc-biblioref">Boubeta et al. 2016</a>)</span>, <span class="citation" data-cites="chwila2019properties">(<a href="#ref-chwila2019properties" role="doc-biblioref">Chwila and Żądło 2019</a>)</span>,
<span class="citation" data-cites="hobza2016empirical">(<a href="#ref-hobza2016empirical" role="doc-biblioref">Hobza and Morales 2016</a>)</span>) and Empirical Best Predictors - EBPs (see e.g.
<span class="citation" data-cites="molina2010small">(<a href="#ref-molina2010small" role="doc-biblioref">Molina and Rao 2010</a>)</span>). Each assumes the LMM to model the response
variable.</p>
<p>The numerous successful applications of these three predictors for
cross-sectional and longitudinal data can be found in the model approach
in survey sampling, including the small area estimation. In paper
<span class="citation" data-cites="fay1979estimates">(<a href="#ref-fay1979estimates" role="doc-biblioref">Fay III and Herriot 1979</a>)</span> the Authors introduce the prediction of the mean
income for small places based on the special case of the LMM model
called Fay-Herriot model and the EBLUP. The analysis of poverty is
extended in many works, e.g. in <span class="citation" data-cites="molina2010small">(<a href="#ref-molina2010small" role="doc-biblioref">Molina and Rao 2010</a>)</span> and
<span class="citation" data-cites="christiaensen2012">(<a href="#ref-christiaensen2012" role="doc-biblioref">Christiaensen et al. 2012</a>)</span>. In turn, in <span class="citation" data-cites="SAE1988">(<a href="#ref-SAE1988" role="doc-biblioref">Battese et al. 1988</a>)</span> the Authors analyse the
total crop areas based on survey and satellite data using EBLUPs. The
proposed LMM model is known as the Battese-Harter-Fuller model. The
predictors are also exploited in the subject of experience rating in
non-life insurance, see <span class="citation" data-cites="frees1999">(<a href="#ref-frees1999" role="doc-biblioref">Frees et al. 1999</a>)</span> and <span class="citation" data-cites="buhlmann2005">(<a href="#ref-buhlmann2005" role="doc-biblioref">Bühlmann and Gisler 2005</a>)</span>, where the
longitudinal data are under consideration. The insurance premium for the
next period for every policy in the insurance portfolio is predicted.</p>
<p>A major challenge in this type of prediction is the estimation of the
prediction accuracy measure. Most often it is the Root Mean Squared
Error (RMSE), which is given in analytical form or can be e.g. estimated
using bootstrap. A feature of the distribution of the squared prediction
error is usually a very strong positive asymmetry. Because the mean is
not recommended as the appropriate measure of the central tendency in
such distributions, the alternative prediction accuracy measure called
the Quantile of Absolute Prediction Errors (QAPE), proposed by
<span class="citation" data-cites="zadlo2013parametric">(<a href="#ref-zadlo2013parametric" role="doc-biblioref">Żądło 2013</a>)</span> and <span class="citation" data-cites="zadlo2020bootstrap">(<a href="#ref-zadlo2020bootstrap" role="doc-biblioref">Wolny-Dominiak and Żądło 2020</a>)</span>, can be applied.</p>
<p>There is a variety of R packages to calculate the considered predictors
together with the accuracy measure of prediction, usually the RMSE. The
package <a href="https://CRAN.R-project.org/package=sae"><strong>sae</strong></a>, see <span class="citation" data-cites="sae">(<a href="#ref-sae" role="doc-biblioref">Molina and Marhuenda 2015</a>)</span>,
provides EBLUPs based on Fay-Herriot and Battese-Harter-Fuller models.
In turn, the multivariate EBLUP for Fay-Herriot models is implemented in
<a href="https://CRAN.R-project.org/package=msae"><strong>msae</strong></a>, see <span class="citation" data-cites="msae">(<a href="#ref-msae" role="doc-biblioref">Permatasari and Ubaidillah 2021</a>)</span>.
Several EBLUPs introduced in <span class="citation" data-cites="rao1994small">(<a href="#ref-rao1994small" role="doc-biblioref">Rao and Yu 1994</a>)</span> are implemented in package
<a href="https://CRAN.R-project.org/package=saery"><strong>saery</strong></a> introduced by
<span class="citation" data-cites="saery">(<a href="#ref-saery" role="doc-biblioref">Lefler et al. 2014</a>)</span>, likewise in
<a href="https://CRAN.R-project.org/package=JoSAE"><strong>JoSAE</strong></a>, see <span class="citation" data-cites="josae">(<a href="#ref-josae" role="doc-biblioref">Breidenbach 2018</a>)</span>, but
with additional heteroscedasticity analysis. The EBP is provided in the
package <a href="https://CRAN.R-project.org/package=emdi"><strong>emdi</strong></a> described in
<span class="citation" data-cites="kreutzmann2019r">(<a href="#ref-kreutzmann2019r" role="doc-biblioref">Kreutzmann et al. 2019</a>)</span>.</p>
<p>A new package in this area is our proposed package
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a>. It allows the
prediction of flexibly defined characteristics of the response variable
using the above three predictors, assuming an appropriate LMM. A novel
feature of the package
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a>, compared to those
already in place, is the ability of bootstrap estimation of the
prediction accuracy measures, both the RMSE and QAPE. Three types of
bootstrap procedures are provided: parametric, residual and double.</p>
<p>There are three groups of functions in this package: predictors values
calculation, bootstrap estimation of RMSE and QAPE measures, and Monte
Carlo (MC) analysis of properties of predictors and prediction accuracy
estimators. The prediction is based on a LMM model defined by the user
and allows to predict the population characteristics of the response
variable, which can be defined by a linear combination (in the case of
EBLUP), by any R function (e.g. <code>sum</code>) or any function defined by the
user (in the case of the EBP and PLUG-IN predictors). The package allows
for full flexibility in defining: the model, the predicted
characteristic, and the transformation of the response variable.</p>
<p>This paper is organized as follows. Firstly, the background of the LMM
is presented together with the theoretical foundations of the prediction
including prediction accuracy measures. Then, the package functionality
in the area of prediction is presented and illustrated. A short
application based on <code>radon</code> data, a cross-sectional dataset available
in <a href="https://CRAN.R-project.org/package=HLMdiag"><strong>HLMdiag</strong></a> package, to
predict three subpopulation characteristics is shown. Subsequently, the
theoretical background of the prediction accuracy measures estimation
based on bootstrap is presented. Implementations of bootstrap algorithms
in <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> are briefly
introduced. Finally, the procedure of the model-based Monte Carlo
simulation study is discussed. The paper ends with a conclusion.</p>
<h3 data-number="2" id="PAM"><span class="header-section-number">2</span> Prediction accuracy measures</h3>
<p>We consider the problem of prediction of any given function of the
population vector <span class="math inline">\(\mathbf{Y}\)</span> of the response variable:
<span class="math display" id="eq:theta">\[\label{theta}
\theta = f_{\theta}(\mathbf{Y})   \tag{1}\]</span>
under the LMM. It covers linear combinations of <span class="math inline">\(\mathbf{Y}\)</span> (such as
one future realization of the response variable or population and
subpopulation means and totals) but also other population and
subpopulation characteristics such quantiles and variability measures.</p>
<p>To assess the accuracy of the particular predictor <span class="math inline">\(\hat \theta\)</span>,
firstly, the prediction error is defined as <span class="math inline">\(U=\hat{\theta}-\theta\)</span>.
Therefore, the well-known RMSE has the following formula:
<span class="math display" id="eq:eq0">\[\label{eq0}
    RMSE(\hat{\theta})=\sqrt{E(\hat{\theta}-\theta)^{2}}=\sqrt{E({{U}^{2}})}.   \tag{2}\]</span>
The alternative to the RMSE based on the mean could be the QAPE based on
quantiles. It represents the <span class="math inline">\(p\)</span>th quantile of the absolute prediction
error <span class="math inline">\(|U|\)</span>, see <span class="citation" data-cites="zadlo2013parametric">(<a href="#ref-zadlo2013parametric" role="doc-biblioref">Żądło 2013</a>)</span> and <span class="citation" data-cites="zadlo2020bootstrap">(<a href="#ref-zadlo2020bootstrap" role="doc-biblioref">Wolny-Dominiak and Żądło 2020</a>)</span>, and
it is given by:
<span class="math display" id="eq:eq1">\[\label{eq1}
    QAPE_p(\hat{\theta}) = \inf \left\{ {x:P\left( {\left| {{\hat{\theta}-\theta}} \right| \le x} \right) \ge p} \right\} =\inf \left\{ {x:P\left( {\left| {{U}} \right| \le x} \right) \ge p} \right\}   \tag{3}\]</span>
This measure informs that at least <span class="math inline">\(p100\%\)</span> of observed absolute
prediction errors are smaller than or equal to <span class="math inline">\(QAPE_p(\hat{\theta})\)</span>,
while at least <span class="math inline">\((1-p)100\%\)</span> of them are higher than or equal to
<span class="math inline">\(QAPE_p(\hat{\theta})\)</span>. Quantiles reflect the relation between the
magnitude of the error and the probability of its realization. It means
that using the QAPE, it is possible to make a full description of the
distribution of prediction errors instead of using the average
(reflected by the RMSE). Furthermore, the MSE is the mean of positively
(usually very strongly) skewed squared prediction errors, where the mean
should not be used as a measure of the central tendency of positively
skewed distributions.</p>
<p>The above described accuracy prediction measures RMSE and QAPE can be
estimated using the bootstrap techniques. Their estimators as well as
the bootstrap distributions of the prediction errors based on any
(assumed or misspecified) model are provided in
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package, including
algorithms where the parallel computing is used.</p>
<p>In the <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package, the
whole prediction process has its own specific procedure, which can be
presented in the following steps.</p>
<div id="Proc1" class="procedure">
<p><strong>Procedure 1</strong>. <em>The process of prediction, accuracy measures
estimation and Monte Carlo simulation analyses in
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> </em></p>
<ol type="1">
<li><p><em>Define the characteristics of the response variable to predict,</em></p></li>
<li><p><em>provide the information on sample and population values,</em></p></li>
<li><p><em>define the LMM,</em></p></li>
<li><p><em>estimate parameters of the LMM,</em></p></li>
<li><p><em>predict the random variable <span class="math inline">\(\theta\)</span> using the chosen class of
predictors,</em></p></li>
<li><p><em>estimate the prediction accuracy measures RMSE and QAPE using one
of the developed bootstrap algorithms,</em></p></li>
<li><p><em>conduct simulation analyses of properties of predictors and
accuracy measures estimators under any (also misspecified) LMM
model.</em></p></li>
</ol>
</div>
<h3 data-number="3" id="the-prediction-under-lmm"><span class="header-section-number">3</span> The prediction under LMM</h3>
<p>The main functions of the
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package provide the
bootstrap estimation of prediction accuracy measures. However, it must
be preceded by the prediction process, including the choice of the LMM
and the predictor.</p>
<h4 class="unnumbered" data-number="3.1" id="the-model">The model</h4>
<p>Let <span class="math inline">\(\mathbf{Y}\)</span> denote the vector of response variables
<span class="math inline">\(Y_1, Y_2,..., Y_N\)</span>. Assuming, without a loss of generality, that only
the first <span class="math inline">\(n\)</span> realizations of <span class="math inline">\(Y_i\)</span> are observed, <span class="math inline">\(\mathbf{Y}\)</span> can be
decomposed as <span class="math inline">\(\mathbf{Y}=
\begin{bmatrix}
    \mathbf{Y}_s^T &amp; \mathbf{Y}_r^T
\end{bmatrix}^T\)</span> , where <span class="math inline">\(\mathbf{Y}_s\)</span> and <span class="math inline">\(\mathbf{Y}_r\)</span> are of
dimension <span class="math inline">\(n \times 1\)</span> and <span class="math inline">\((N - n) \times 1\)</span>, respectively. In all
notations, the subscript "s" is used for observed realizations of the
variable of interest and "r" for the unobserved ones. Two known
matrices of auxiliary variables are also considered, denoted by
<span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Z}\)</span>, which are associated with fixed and
random effects, respectively. The <span class="math inline">\(\mathbf{X}\)</span> matrix is of dimension
<span class="math inline">\(N \times p\)</span>, and it consists of <span class="math inline">\(p\)</span> regression variables. It can be
decomposed like <span class="math inline">\(\mathbf{Y}\)</span> as follows: <span class="math inline">\(\mathbf{X}=
\begin{bmatrix}
    \mathbf{X}_s^T &amp; \mathbf{X}_r^T
\end{bmatrix}^T\)</span>, where matrices <span class="math inline">\(\mathbf{X}_s\)</span> and <span class="math inline">\(\mathbf{X}_r\)</span>, both
known, are of dimension <span class="math inline">\(n \times p\)</span> and <span class="math inline">\((N-n) \times p\)</span>, respectively.
Similarly, the <span class="math inline">\(\mathbf{Z}\)</span> matrix of dimension <span class="math inline">\(N \times h\)</span> can be
written as follows: <span class="math inline">\(\mathbf{Z}=
\begin{bmatrix}
    \mathbf{Z}_s^T &amp; \mathbf{Z}_r^T
\end{bmatrix}^T\)</span>, where matrices <span class="math inline">\(\mathbf{Z}_s\)</span> and <span class="math inline">\(\mathbf{Z}_r\)</span>, both
known, are of dimension <span class="math inline">\(n \times h\)</span> and <span class="math inline">\((N-n) \times h\)</span>, respectively.</p>
<p>Then, let <span class="math inline">\(LMM(\mathbf{X}, \mathbf{Z}, \boldsymbol{\psi})\)</span> denotes the
LMM of the following form (e.g. <span class="citation" data-cites="rao2015small">(<a href="#ref-rao2015small" role="doc-biblioref">Rao and Molina 2015</a>)</span>, p. 98):
<span class="math display" id="eq:LMM">\[\label{LMM}
    \left\{ \begin{array}{c}
        \mathbf{Y}=\mathbf{X}\boldsymbol{\beta} + \mathbf{Z}\mathbf{v}+\mathbf{e} \\
        E(\mathbf{e})=\mathbf{0}, E(\mathbf{v})=\mathbf{0} \\
        Var(\mathbf{e})=\mathbf{R}(\pmb{\delta}), Var(\mathbf{v})=\mathbf{G}(\pmb{\delta})
    \end{array} \right.   \tag{4}\]</span>
The vector of parameters in model (<a href="#eq:LMM">(4)</a>) is then
<span class="math inline">\(\boldsymbol{\psi}=\begin{bmatrix}
    \boldsymbol{\beta}^T &amp;  \pmb{\delta}^T
\end{bmatrix}^T\)</span>, where <span class="math inline">\(\boldsymbol{\beta}\)</span> is a vector of fixed
effects of dimension <span class="math inline">\(p \times 1\)</span> and <span class="math inline">\(\pmb{\delta}\)</span> is a vector of
variance components. The random part of the model is described by the
known matrix <span class="math inline">\(\mathbf{Z}\)</span>, a vector <span class="math inline">\(\mathbf{v}\)</span> of random effects of
dimension <span class="math inline">\(h \times 1\)</span> and a vector <span class="math inline">\(\mathbf{e}\)</span> of random components of
dimension <span class="math inline">\(N\times 1\)</span>, where <span class="math inline">\(\mathbf{e}\)</span> and <span class="math inline">\(\mathbf{v}\)</span> are assumed
to be independent. The vector of random components <span class="math inline">\(\mathbf{e}\)</span> will be
decomposed similarly to the vector <span class="math inline">\(\mathbf{Y}\)</span>, i.e.
<span class="math inline">\(\mathbf{e}=\begin{bmatrix}
    \mathbf{e}_s^T &amp; \mathbf{e}_r^T
\end{bmatrix}^T\)</span>.</p>
<p>In the residual bootstrap implemented in
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a>, there is a need to
re-write the LMM model to take account of the specific structure of
data, i.e. the grouping variables taken into account in the random part
of the model. In this case, without a loss of the generality, the LMM
model can be written as follows:
<span class="math display" id="eq:LMMa">\[\label{LMMa}
    \mathbf{Y}=\mathbf{X}\boldsymbol{\beta} + \mathbf{Z}_1\mathbf{v}_1+...+\mathbf{Z}_l\mathbf{v}_l+...+\mathbf{Z}_L\mathbf{v}_L+\mathbf{e},   \tag{5}\]</span>
where <span class="math inline">\(\mathbf{v}_1,\dots,\mathbf{v}_l,\dots,\mathbf{v}_L\)</span> are
independent vectors of random effects assumed for different divisions of
the <span class="math inline">\(\mathbf{Y}\)</span> vector (under different grouping of the data) and
<span class="math inline">\(\mathbf{Z}_1, \dots, \mathbf{Z}_l, \dots, \mathbf{Z}_L\)</span> are known
matrices of auxiliary variables associated with random effects. Writing
in (<a href="#eq:LMMa">(5)</a>): <span class="math inline">\(\mathbf{Z}=
\begin{bmatrix}
    \mathbf{Z}_1 &amp; \dots &amp; \mathbf{0} &amp; \dots  &amp; \mathbf{0} \\
    \vdots &amp; \ddots &amp;  &amp;  &amp; \vdots \\
    \mathbf{0} &amp; \dots &amp; \mathbf{Z}_l &amp; \dots &amp; \mathbf{0} \\
    \vdots &amp;  &amp;  &amp; \ddots &amp; \vdots \\
    \mathbf{0} &amp; \dots &amp; \mathbf{0} &amp; \dots &amp; \mathbf{Z}_L \\
\end{bmatrix}\)</span> and <span class="math inline">\(\mathbf{v}=
\begin{bmatrix}
    \mathbf{v}_1^T &amp; \dots &amp; \mathbf{v}_l^T &amp; \dots  &amp; \mathbf{v}_L^T \\
\end{bmatrix}^T\)</span> the LMM model is obtained. Let</p>
<p><span class="math display" id="eq:vl">\[\label{vl}
\mathbf{v}_l=\left[ \mathbf{v}_{l1}^T \dots \mathbf{v}_{lk}^T \dots \mathbf{v}_{lK_l}^T \right]^T   \tag{6}\]</span>
be of dimension <span class="math inline">\(K_l J_l \times 1\)</span>, where <span class="math inline">\(\mathbf{v}_{lk}\)</span> is of
dimension <span class="math inline">\(J_l \times 1\)</span> for all <span class="math inline">\(k=1,...,K_l\)</span> and <span class="math inline">\(K_l\)</span> is the number
of random effects at the <span class="math inline">\(l\)</span>th level of grouping. Hence, <span class="math inline">\(\mathbf{Z}_l\)</span>
is <span class="math inline">\(N \times K_l J_l\)</span>. For example, if the random regression coefficient
model is considered with two random coefficients where both random
effects are subpopulation-specific, where <span class="math inline">\(D\)</span> is the number of
subpopulations, then <span class="math inline">\(L=1\)</span>, <span class="math inline">\(K_1=2\)</span> and <span class="math inline">\(J_1=D\)</span>.</p>
<h4 class="unnumbered" data-number="3.2" id="predictors">Predictors</h4>
<p>In the <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package, in
the general case the predicted characteristic is given by any function
of response variables:
<span class="math display" id="eq:ftheta">\[\label{ftheta}
\theta = f_{\theta}(\mathbf{Y}).   \tag{7}\]</span>
Under the <span class="math inline">\(LMM(\mathbf{X}, \mathbf{Z}, \boldsymbol{\psi})\)</span> model it
could be predicted using one of three predictors:</p>
<ol type="1">
<li><p>Empirical Best Linear Unbiased Predictor (EBLUP),</p></li>
<li><p>Empirical Best Predictor (EBP) under nested error LMM,</p></li>
<li><p>PLUG-IN predictor under the LMM.</p></li>
</ol>
<p>The first predictor (EBLUP) allows to predict the linear combination of
the response variables:
<span class="math display" id="eq:l-theta">\[\label{l.theta}
\theta = f_{\theta}(\mathbf{Y}) = \boldsymbol{\gamma}^T \mathbf{Y}= \boldsymbol{\gamma}_s^T \mathbf{Y}_s + \boldsymbol{\gamma}_r^T \mathbf{Y}_r,   \tag{8}\]</span>
where <span class="math inline">\(\boldsymbol{\gamma}\)</span> is a vector of weights. In this case, the
predicted characteristic <span class="math inline">\(\theta\)</span> is basically the linear combination of
the response variable. For example, if one of the elements of
<span class="math inline">\(\boldsymbol{\gamma}\)</span> equals 1 and the rest of the elements equals 0,
then one realization of the response variable is predicted. If all
elements in <span class="math inline">\(\boldsymbol{\gamma}\)</span> vector equal 1, then <span class="math inline">\(\theta\)</span> becomes
the sum of all <span class="math inline">\(Y_i\)</span>’s in the whole considered population dataset. The
two-stage EBLUP corresponds to the Best Linear Unbiased Predictor (BLUP)
introduced in <span class="citation" data-cites="henderson1950estimation">(<a href="#ref-henderson1950estimation" role="doc-biblioref">Henderson 1950</a>)</span> and <span class="citation" data-cites="royall1976linear">(<a href="#ref-royall1976linear" role="doc-biblioref">Royall 1976</a>)</span> as:
<span class="math display" id="eq:BLUP">\[\label{BLUP}
    \hat{\theta}^{BLUP} (\pmb{\delta}) = {\boldsymbol{\gamma}}_s^T \mathbf{Y}_s  + \hat{\theta}_r(\pmb{\delta}),   \tag{9}\]</span>
where the predictor of the linear combination
<span class="math inline">\(\boldsymbol{\gamma}_r^T \mathbf{Y}_r\)</span> of unobserved random variables is
given by
<span class="math inline">\(\hat{\theta}_r(\pmb{\delta})={\boldsymbol{\gamma }}_r^T {{\mathbf{X}}_r}{\tilde{\boldsymbol{\beta}} }(\pmb{\delta}) +\boldsymbol{\gamma }_r^T{\mathbf{Z}}_r{\mathbf{\tilde{v}}}(\pmb{\delta})\)</span>,
where <span class="math inline">\(\tilde{\boldsymbol{\beta}}(\pmb{\delta})\)</span> is the Best Linear
Unbiased Estimator of <span class="math inline">\(\boldsymbol{\beta}\)</span> and
<span class="math inline">\(\tilde{\mathbf{v}}(\pmb{\delta})\)</span> is the Best Linear Unbiased Predictor
of <span class="math inline">\(\mathbf{v}\)</span>, both presented in (<a href="#eq:LMM">(4)</a>). As shown by
<span class="citation" data-cites="zadlo2017EBLUP">(<a href="#ref-zadlo2017EBLUP" role="doc-biblioref">Żądło 2017</a>)</span> p. 8094, if
<span class="math inline">\(Cov(\mathbf{e}_r, \mathbf{e}_s)=\mathbf{0}\)</span>, then the predictor
(<a href="#eq:BLUP">(9)</a>) is the BLUP of <span class="math inline">\(\theta\)</span> defined as the linear
combination (<a href="#eq:l-theta">(8)</a>). Even if
<span class="math inline">\(Cov(\mathbf{e}_r, \mathbf{e}_s) \neq \mathbf{0}\)</span>, the predictor
<span class="math inline">\(\hat{\theta}_r(\pmb{\delta})\)</span> is the Best Linear Unbiased Predictor of
the following linear combination of <span class="math inline">\(\boldsymbol{\beta}\)</span> and
<span class="math inline">\(\mathbf{v}\)</span>:
<span class="math inline">\({\boldsymbol{\gamma }}_r^T{{\mathbf{X}}_r}{ {\boldsymbol{\beta}} } +\boldsymbol{\gamma }_r^T{\mathbf{Z}}_r{\mathbf{{v}}}\)</span>.
The EBLUP <span class="math inline">\(\hat\theta^{EBLUP}\)</span> is obtained by replacing the vector of
variance components <span class="math inline">\(\pmb{\delta}\)</span> in BLUP (<a href="#eq:BLUP">(9)</a>) with the
estimator <span class="math inline">\(\hat{\pmb{\delta}}\)</span>. If (a) the expectation of the predictor
is finite, (b) <span class="math inline">\(\hat{\pmb{\delta}}\)</span> is any even, translation-invariant
estimator of <span class="math inline">\(\pmb{\delta}\)</span>, (c) the distributions of both random
effects and random components are symmetric around <span class="math inline">\(\mathbf{0}\)</span> (not
necessarily normal), the EBLUP remains unbiased, as proved by
<span class="citation" data-cites="kackar1981unbiasedness">(<a href="#ref-kackar1981unbiasedness" role="doc-biblioref">Kackar and Harville 1981</a>)</span>.</p>
<p>To introduce the second predictor, called EBP, considered e.g. by
<span class="citation" data-cites="molina2010small">(<a href="#ref-molina2010small" role="doc-biblioref">Molina and Rao 2010</a>)</span>, firstly, the Best Predictor (BP) <span class="math inline">\(\hat{\theta}^{BP}\)</span>
of characteristic <span class="math inline">\(\theta(\mathbf{Y})\)</span> has to be defined. It is computed
by minimizing the Mean Squared Error
<span class="math inline">\(MSE(\hat\theta )=E(\hat\theta - \theta)^2\)</span> and can be written as
<span class="math inline">\(\hat\theta^{BP} = E(\theta|\mathbf{Y}_s)\)</span>. It means that the
conditional distribution of <span class="math inline">\(\mathbf{Y}_r|\mathbf{Y}_s\)</span> must be known to
compute its value while at least the parameters of this distribution,
denoted by <span class="math inline">\(\boldsymbol{\psi}\)</span> in (<a href="#eq:LMM">(4)</a>), are unknown. The EBP
<span class="math inline">\(\hat\theta^{EBP}\)</span> is obtained by replacing these parameters with
estimators <span class="math inline">\(\hat{\boldsymbol{\psi}}\)</span>. Its value can be computed
according to the Monte Carlo procedure presented in the supplementary
document for this paper.</p>
<p>The last predictor is the PLUG-IN predictor defined as (e.g.
<span class="citation" data-cites="chwila2019properties">(<a href="#ref-chwila2019properties" role="doc-biblioref">Chwila and Żądło 2019</a>)</span>):
<span class="math display">\[\hat{\theta}^{PLUG-IN}=\theta(\begin{bmatrix}
        \mathbf{Y}_s^T &amp; \mathbf{\hat{Y}}_r^T
    \end{bmatrix}^T),\]</span>
where <span class="math inline">\(\mathbf{\hat{Y}}_r\)</span> is the vector of fitted values of unobserved
random variables under the assumed model (any model specified by the
statistician). Under the LMM and if the linear combination of
<span class="math inline">\(\mathbf{Y}\)</span> is predicted, the PLUG-IN predictor is the EBLUP, but
generally, it is not optimal. However, it was shown in simulation
studies that it can have similar or even higher accuracy compared to
empirical (estimated) best predictors, where the best predictors
minimize the prediction mean squared errors (cf. e.g.
<span class="citation" data-cites="boubeta2016empirical">(<a href="#ref-boubeta2016empirical" role="doc-biblioref">Boubeta et al. 2016</a>)</span>, <span class="citation" data-cites="chwila2019properties">(<a href="#ref-chwila2019properties" role="doc-biblioref">Chwila and Żądło 2019</a>)</span>,
<span class="citation" data-cites="hobza2016empirical">(<a href="#ref-hobza2016empirical" role="doc-biblioref">Hobza and Morales 2016</a>)</span>). Moreover, the PLUG-IN predictor is less
computationally demanding than the EBP.</p>
<h4 class="unnumbered" data-number="3.3" id="predictors-in-qape">Predictors in <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a></h4>
<p>To deal with the LMM model, the
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package uses the
<code>lmer()</code> function from the
<a href="https://CRAN.R-project.org/package=lme4"><strong>lme4</strong></a> package, see
<span class="citation" data-cites="lme4">(<a href="#ref-lme4" role="doc-biblioref">Bates et al. 2015</a>)</span>. Assuming (<a href="#eq:LMM">(4)</a>) and based on <span class="math inline">\(\mathbf{Y}_s\)</span>, the
vector of model parameters
<span class="math inline">\(\boldsymbol{\psi} = [\boldsymbol{\beta}^T, \pmb{\delta}^T]^T\)</span> is
estimated using the Restricted Maximum Likelihood Method (REML), known
to be robust on non-normality, see e.g <span class="citation" data-cites="jiang1996reml">(<a href="#ref-jiang1996reml" role="doc-biblioref">Jiang 1996</a>)</span>, and
<span class="math inline">\(\hat{\boldsymbol{\psi}}\)</span> is obtained.</p>
<p>In order to obtain the predictor of <span class="math inline">\(\theta\)</span>, one of the three
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> functions can be
applied: <code>EBLUP()</code>, <code>ebpLMMne()</code> or <code>plugInLMM()</code>. Firstly, the
characteristic of response variables of interest has to be defined. It
is actually obvious for EBLUP, which can be used only to predict the
population/subpopulation linear combination (e.g. the sum) by using the
argument <code>gamma</code> equivalent to the population vector of weights
<span class="math inline">\(\boldsymbol{\gamma}\)</span> in (<a href="#eq:l-theta">(8)</a>). For other two predictors,
the EBP and the PLUG-IN, the input argument called <code>thetaFun</code> has to be
given (see <span class="math inline">\(f_{\theta}(.)\)</span> in (<a href="#eq:ftheta">(7)</a>)). Function <code>thetaFun</code>
could define one characteristic or a vector of characteristics, for
example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> thetaFun1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">median</span>(x)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> thetaFun2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="fu">sum</span>(x), <span class="fu">mean</span>(x), <span class="fu">sd</span>(x))</span></code></pre></div>
<p>Secondly, two groups of input arguments, common to all three predictors,
has to be provided:</p>
<ul>
<li><p>group 1 - arguments defining the sample and the population</p>
<ul>
<li><p><code>YS</code> - values of the dependent variable in the sample
(<span class="math inline">\(\mathbf{Y}_s\)</span>),</p></li>
<li><p><code>reg</code> - the population matrix of auxiliary variables named in
<code>fixed.part</code>, <code>random.part</code> and <code>division</code>,</p></li>
<li><p><code>con</code> - the population <span class="math inline">\(0-1\)</span> vector with <span class="math inline">\(1\)</span>s for elements in
the sample and <span class="math inline">\(0\)</span>s for elements which are not in the sample,</p></li>
</ul></li>
<li><p>group 2 - arguments defining the model</p>
<ul>
<li><p><code>fixed.part</code> - fixed-effects terms declared as in <code>lm4::lmer</code>
function,</p></li>
<li><p><code>random.part</code> - random-effects terms declared as in <code>lm4::lmer</code>
function,</p></li>
<li><p><code>weights</code> - the population vector of weights.</p></li>
</ul></li>
</ul>
<p>The weights make it possible to include heteroscedasticity of random
components in the LMM.</p>
<p>In <code>EBLUP()</code> and <code>plugInLMM()</code> the random-effects terms of the LMM have
to be declared as the input argument <code>random.part</code>. The form of the
<code>ebpLMMne</code> predictor, in turn, requires defining in the <code>ebpLMMne()</code>
function the so-called <code>division</code> argument instead of <code>random.part</code>.
This input represents the variable dividing the population dataset into
subsets, which are taken into account in the nested error linear mixed
model with ‘<code>division</code>’-specific random components (presented in
supplementary document for this paper).</p>
<p>In the process of prediction, it is often necessary to perform data
transformation before estimating the model parameters. An example is the
logarithmic scaling of the variable of interest. The
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package offers the
possibility for declaring the argument <code>backTrans</code> to conduct the data
back-transformation. Hence, a very flexible solution is used which
allows to use any transformation of the response variable such that the
back-transformation can be defined. This argument (available in R or
defined by the user function) should be the back-transformation function
of the already transformed dependent variable used to define the model,
e.g. for log-transformed <code>YS</code> used as the response variable:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> backTrans <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(x)</span></code></pre></div>
<p>The main output is the value of predictor <code>thetaP</code>. For each class of
predictors, there are two S3 methods registered for existing generic
functions <code>print</code> and <code>summary</code>. The full list of output arguments is
presented in detail in the <code>qape-manual</code> file, cf. <span class="citation" data-cites="qape">(<a href="#ref-qape" role="doc-biblioref">Wolny-Dominiak and Żądło 2023</a>)</span>.</p>
<h4 class="unnumbered" data-number="3.4" id="radon-data-and-the-model">Radon data and the model</h4>
<p>In order to demonstrate the functionality of the package’s main
functions, in the following examples the <code>radon</code> dataset available in
<a href="https://CRAN.R-project.org/package=HLMdiag"><strong>HLMdiag</strong></a> package
(<span class="citation" data-cites="HLMdiag">(<a href="#ref-HLMdiag" role="doc-biblioref">Loy and Hofmann 2014</a>)</span>) is analyzed. It contains the results of a survey measuring
radon concentrations in 919 owner-occupied homes in 85 counties of
Minnesota (see Figure <a href="#fig:map">1</a>). A study was conducted in
1987-1988 by the Minnesota Department of Health, showing that indoor
radon levels are higher in Minnesota compared to typical levels in the
U.S. In the data, the response variable <code>log.radon</code> (denoted in
(<a href="#eq:radon-model">(10)</a>) by <span class="math inline">\(log(Y_{ic})\)</span>) is the radon measurement in
logarithms of picoCurie per liter. The independent variables, on the
other hand, are: <code>uranium</code> (<span class="math inline">\(x_{1ic}\)</span>) the average county-level soil
uranium content, <code>basement</code> (<span class="math inline">\(x_{2ic}\)</span>) the 0-1 variable indicating the
level of the home at which the radon measurement was taken - 0 for
basement, 1 for the first floor, and <code>county</code> (denoted by subscript <span class="math inline">\(c\)</span>
in (<a href="#eq:radon-model">(10)</a>)) is county ID.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:map"></span>
<img src="mapaAll.png" alt="graphic without alt text" width="100%" />
<p class="caption">
Figure 1: The maps of characteristics of radon concentration in counties in picoCurie per liter. The gray colour means that the value is NA (Not Available)
</p>
</div>
</div>
<p>In all considered examples, the prediction for the county no. 26
(<code>county == 26</code>) is conducted and it is assumed that the observations in
this county from the first floor (<code>basement == 1</code>) are not available
(see Figure <a href="#fig:boxplot">2</a>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:boxplot"></span>
<img src="boxAll.png" alt="graphic without alt text" width="100%" />
<p class="caption">
Figure 2: The distributions of radon concentration in picoCurie per liter in counties. The red line indicates county no. 26
</p>
</div>
</div>
<p>The <code>radon</code> dataset is widely discussed in the literature. In the paper
<span class="citation" data-cites="nero1994statistically">(<a href="#ref-nero1994statistically" role="doc-biblioref">Nero et al. 1994</a>)</span>, the Authors used an ordinary regression model
to predict county geometric means of radon concentration using surficial
soil radium data from the National Uranium Resource Evaluation. In turn,
the paper <span class="citation" data-cites="price1996bayesian">(<a href="#ref-price1996bayesian" role="doc-biblioref">Price et al. 1996</a>)</span> focuses on the prediction of the
geometric mean of radon for each county, but using a Bayesian approach.
For the <code>radon</code> data we use the following model
<span class="math display" id="eq:radon-model">\[\label{radon.model}
    log(Y_{ic}) = \beta_1 x_{1ic} + (\beta_2 + v_{1c}) x_{2ic} + \beta_0 + v_{2c} + e_{ic},   \tag{10}\]</span>
where <span class="math inline">\(i=1,2,\dots,N\)</span>, <span class="math inline">\(c=1,2,\dots, C\)</span>, <span class="math inline">\(N = 919\)</span> observations,
<span class="math inline">\(C = 85\)</span> counties, <span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span> and <span class="math inline">\(\beta_0\)</span> are unknown fixed
effects, <span class="math inline">\(v_{1c}\)</span> and <span class="math inline">\(v_{2c}\)</span> are random effects, <span class="math inline">\(e_{ic}\)</span> are random
components, <span class="math inline">\(v_{1c}\)</span>, and <span class="math inline">\(e_{ic}\)</span> are mutually independent, <span class="math inline">\(v_{2c}\)</span>
and <span class="math inline">\(e_{ic}\)</span> are mutually independent too, <span class="math inline">\(Cor(v_{1c}, v_{2c}) = \rho\)</span>,
<span class="math inline">\(v_{1c} \sim (0, \sigma^2_{v_1})\)</span>, <span class="math inline">\(v_{2c} \sim (0, \sigma^2_{v_2})\)</span> and
<span class="math inline">\(e_{ic} \sim (0, \sigma^2_e)\)</span>. As can easily be seen, the considered
model is the random coefficient model with two correlated
<code>county</code>-specific random effects. Its syntax written using the package
<a href="https://CRAN.R-project.org/package=lme4"><strong>lme4</strong></a> notation is as
follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>radon.model <span class="ot">&lt;-</span>  <span class="fu">lmer</span>(log.radon <span class="sc">~</span> basement <span class="sc">+</span> uranium <span class="sc">+</span> (basement <span class="sc">|</span> county), <span class="at">data =</span> radon)</span></code></pre></div>
<p>This and similar LMMs are considered, analyzed, and used for the
considered dataset in many publications, with a good overview presented
in <span class="citation" data-cites="gelman_data_2006">(<a href="#ref-gelman_data_2006" role="doc-biblioref">Gelman and Hill 2006</a>)</span>. In <span class="citation" data-cites="gelman2006bayesian">(<a href="#ref-gelman2006bayesian" role="doc-biblioref">Gelman and Pardoe 2006</a>)</span>, based on their
preceding research <span class="citation" data-cites="price1996bayesian">(<a href="#ref-price1996bayesian" role="doc-biblioref">Price et al. 1996</a>)</span>, <span class="citation" data-cites="gelman1999analysis">(<a href="#ref-gelman1999analysis" role="doc-biblioref">Lin et al. 1999</a>)</span>,
<span class="citation" data-cites="peck_should_2005">(<a href="#ref-peck_should_2005" role="doc-biblioref">Price and Gelman 2005</a>)</span>, a very similar model but with additional
multivariate normality assumptions is studied, verified and chosen as
fitting well to the data within a Bayesian framework. The same model as
in <span class="citation" data-cites="gelman2006bayesian">(<a href="#ref-gelman2006bayesian" role="doc-biblioref">Gelman and Pardoe 2006</a>)</span> with its special cases is considered in
<span class="citation" data-cites="cantoni2021review">(<a href="#ref-cantoni2021review" role="doc-biblioref">Cantoni et al. 2021</a>)</span> but within the frequentist approach. Based on 25
measures of explained variation and model selection, the Authors
conclude that the same model as considered in our paper (with additional
normality assumption, however, which is not used in all cases considered
in that paper), "seems the best" <span class="citation" data-cites="cantoni2021review">(<a href="#ref-cantoni2021review" role="doc-biblioref">Cantoni et al. 2021 10</a>)</span> for the
<code>radon</code> data. Further tests of the model are presented by
<span class="citation" data-cites="loy2013diagnostics">(<a href="#ref-loy2013diagnostics" role="doc-biblioref">Loy 2013</a>)</span>, <span class="citation" data-cites="loy2015you">(<a href="#ref-loy2015you" role="doc-biblioref">Loy and Hofmann 2015</a>)</span> and <span class="citation" data-cites="loy2017model">(<a href="#ref-loy2017model" role="doc-biblioref">Loy et al. 2017</a>)</span> (see also
<span class="citation" data-cites="cook2007interactive">(<a href="#ref-cook2007interactive" role="doc-biblioref">Cook et al. 2007</a>)</span> for the introduction of the methodology) showing
among others: the normality and homescedasticity of random components,
the normality of the distribution of the random slope but – what is
important for our further considerations – the lack of the normality of
the random intercept. Since the problem of choosing and verifying a
model for the considered dataset is widely discussed in the literature,
we will focus on the issues that are new in this case, namely the
problem of prediction and estimation of the prediction accuracy as well
as the Monte Carlo analysis of predictors’ properties.</p>
<h4 class="unnumbered" data-number="3.5" id="example-1">Example 1</h4>
<p>This example shows the prediction procedure in the package
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a>. In the first step,
it is needed to define all the input arguments that will then be passed
to the prediction functions.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> Ypop <span class="ot">&lt;-</span> radon<span class="sc">$</span>log.radon <span class="co"># the population vector of the dependent variable</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># It is assumed that observations from the first floor</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># in county no. 26 are not available: </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> con <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(radon))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> con[radon<span class="sc">$</span>county <span class="sc">==</span> <span class="dv">26</span> <span class="sc">&amp;</span> radon<span class="sc">$</span>basement <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> YS <span class="ot">&lt;-</span> Ypop[con <span class="sc">==</span> <span class="dv">1</span>] <span class="co"># sample vector of the dependent variable</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> reg <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(radon, <span class="sc">-</span>log.radon) <span class="co"># the population matrix of auxiliary variables</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fixed.part <span class="ot">&lt;-</span> <span class="st">&#39;basement + uranium&#39;</span> <span class="co"># the fixed part of the considered model</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> random.part <span class="ot">&lt;-</span> <span class="st">&#39;(basement|county)&#39;</span> <span class="co"># the random part of the considered model</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># The vector of weights to define</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># the predicted linear combination -  the mean for county == 26:</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> gamma <span class="ot">&lt;-</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   (<span class="dv">1</span> <span class="sc">/</span> <span class="fu">sum</span>((radon<span class="sc">$</span>county <span class="sc">==</span> <span class="dv">26</span>))) <span class="sc">*</span> <span class="fu">ifelse</span>((radon<span class="sc">$</span>county <span class="sc">==</span> <span class="dv">26</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> estMSE <span class="ot">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># to include the naive MSE estimator of the EBLUP in the output</span></span></code></pre></div>
<p>Then the functions corresponding to each predictor can be used. First,
the EBLUP prediction in the package
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> is presented. As the
EBLUP is limited to the linear combination of random variables, the
predicted characteristic is simply the arithmetic mean. To be precise,
it is the mean of logarithms of measurements (instead of the mean of
measurements), because the EBLUP can be used only under the linear
(linearized) models. As in the LMM the homescedasticity of random
components is assumed, the input argument <code>weights = NULL</code> is set up.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> myeblup <span class="ot">&lt;-</span> <span class="fu">EBLUP</span>(YS, fixed.part, random.part, reg, con, gamma,  <span class="at">weights =</span> <span class="cn">NULL</span>, estMSE)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># the value of the predictor of the arithmetic mean</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of logarithms of radon measurements:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> myeblup<span class="sc">$</span>thetaP</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">1.306916</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> myeblup<span class="sc">$</span>neMSE <span class="co"># the value of the naive MSE estimator</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.002292732</span></span></code></pre></div>
<p>Hence, the predicted value of the arithmetic mean of logarithms of radon
measurements equals <span class="math inline">\(1.306916\)</span> log picoCurie per liter. The estimated
root of prediction MSE equals <span class="math inline">\(\sqrt{0.002292732} \approx 0.048\)</span> log
picoCurie per liter, but – what is important – it is the value of the
naive RMSE estimator <span class="citation" data-cites="rao2015small">(as defined by <a href="#ref-rao2015small" role="doc-biblioref">Rao and Molina 2015 106</a>)</span>, which means
that it ignores the decrease of accuracy due to the estimation of model
parameters.</p>
<p>The second part of this example shows the prediction of the arithmetic
mean, geometric mean and median of radon measurements (not logarithm of
radon measurements) in county no. 26 with the use of the PLUG-IN
predictor. It requires the setting of two input arguments: <code>thetaFun</code>
and <code>backTrans</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> thetaFun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">c</span>(<span class="fu">mean</span>(x[radon<span class="sc">$</span>county <span class="sc">==</span> <span class="dv">26</span>]), psych<span class="sc">::</span><span class="fu">geometric.mean</span>(x[radon<span class="sc">$</span>county <span class="sc">==</span> <span class="dv">26</span>]),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>     <span class="fu">median</span>(x[radon<span class="sc">$</span>county <span class="sc">==</span> <span class="dv">26</span>]))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   }</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> backTransExp <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(x) <span class="co"># back-transformation</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> myplugin <span class="ot">&lt;-</span> <span class="fu">plugInLMM</span>(YS, fixed.part, random.part, reg, con, <span class="at">weights =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                     <span class="at">backTrans =</span> backTransExp, thetaFun)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># values of the predictor of arithmetic mean, geometric mean</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># and median of radon measurements:</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> myplugin<span class="sc">$</span>thetaP</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">3.694761</span> <span class="fl">4.553745</span> <span class="fl">3.900000</span></span></code></pre></div>
<p>In this case we can conclude that the predicted values of the
aritmethmic mean, geometric mean and median in county no. 26 equal:
<span class="math inline">\(3.694761\)</span>, <span class="math inline">\(4.553745\)</span> and <span class="math inline">\(3.9\)</span> picoCurie per liter, respectively. The
problem of prediction accuracy estimation will be discussed in the next
sections of the paper.</p>
<p>The <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package allows
to use the Empirical Best Predictor (EBP) (see the supplementary
document for this paper) as well. It provides predicted values of any
function of the variable of interest, as the PLUG-IN predictor. However,
this requires stronger assumptions to be met. The EBP procedure
available in <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package
is prepared under the assumption of the normality of the variable of
interest after any transformation. However, in the case of the
considered model for logarithms of radon measurements, the assumption is
not met as we mentioned before based on the results presented in the
literature. It can also be verified using <code>normCholTest</code> function
(available in <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a>
package) as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">normCholTest</span>(radon.model, shapiro.test)<span class="sc">$</span>p.value</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">2.589407e-08</span></span></code></pre></div>
<p>Moreover, due to the fact of very time-consuming iterative procedure
used to compute the EBP for the general case, in the
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package the function
<code>ebpLMMne</code> uses a very fast procedure working only for nested error
Linear Mixed Models (see <span class="citation" data-cites="molina2010small">(<a href="#ref-molina2010small" role="doc-biblioref">Molina and Rao 2010</a>)</span>).</p>
<p>The prediction of any function of the random variables based on
cross-sectional data has been considered. Its special case, not
presented above but widely discussed in the econometric literature, is
the prediction of one random variable, in this case a radon measurement
for one non-observed owner-occupied home. Furthermore, the
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package is also
designed for prediction based on longitudinal data for current or future
periods as shown in examples for the <code>EBLUP</code>, <code>plugInLMM</code> and <code>ebpLMMne</code>
functions in the <code>qape-manual</code> file, cf. <span class="citation" data-cites="qape">(<a href="#ref-qape" role="doc-biblioref">Wolny-Dominiak and Żądło 2023</a>)</span>.</p>
<h3 data-number="4" id="bootstrap-procedures"><span class="header-section-number">4</span> Bootstrap procedures</h3>
<p>The <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package provides
three main types of bootstrap algorithms: the parametric bootstrap, the
residual bootstrap and the double-bootstrap.</p>
<p>The parametric bootstrap procedure is implemented according to
<span class="citation" data-cites="gonzales2007">(<a href="#ref-gonzales2007" role="doc-biblioref">González-Manteiga et al. 2007</a>)</span> and <span class="citation" data-cites="gonzales2008">(<a href="#ref-gonzales2008" role="doc-biblioref">González-Manteiga et al. 2008</a>)</span> and could be described in the
following steps:</p>
<ol type="1">
<li><p>based on <span class="math inline">\(n\)</span> observations of the dependent and independent variables
(<span class="math inline">\(\mathbf{Y}_s\)</span>, <span class="math inline">\(\mathbf{X}_s\)</span> and <span class="math inline">\(\mathbf{Z}_s\)</span>) estimate
<span class="math inline">\(\boldsymbol{\psi}\)</span> to obtain the vector of estimates
<span class="math inline">\(\boldsymbol{\hat{\psi}}\)</span>,</p></li>
<li><p>generate <span class="math inline">\(B\)</span> realizations <span class="math inline">\(y_{i}^{*(b)}\)</span> of <span class="math inline">\(Y_{i}\)</span>, under the
<span class="math inline">\(LMM(\mathbf{X}, \mathbf{Z}, \hat{\boldsymbol{\psi}})\)</span> and
multivariate normality of random effects and random components
obtaining<br />
<span class="math inline">\(\mathbf{y}^{*(b)}=\begin{bmatrix}
    y_{1}^{*(b)} &amp; ... &amp; y_{i}^{*(b)} &amp;... &amp; y_{N}^{*(b)}
    \end{bmatrix}^T\)</span>, where <span class="math inline">\(i=1, 2, ... ,N\)</span> and <span class="math inline">\(b=1, 2, ... ,B\)</span>,</p></li>
<li><p>decompose the vector <span class="math inline">\(\mathbf{y}^{*(b)}\)</span> as follows <span class="math inline">\(\begin{bmatrix}
        \mathbf{y}_s^{*(b)T} &amp; \mathbf{y}_r^{*(b)T}
    \end{bmatrix}^T\)</span>,</p></li>
<li><p>in the <span class="math inline">\(b\)</span>th iteration (<span class="math inline">\(b=1,2,...,B\)</span>)</p>
<ol type="1">
<li><p>compute the bootstrap realization
<span class="math inline">\(\theta^{*(b)}=\theta^{*(b)}(\mathbf{y}^{*(b)},\boldsymbol{\hat{\psi}})\)</span>
of random variable <span class="math inline">\(\theta\)</span>,</p></li>
<li><p>obtain the vector of estimates <span class="math inline">\(\boldsymbol{\hat{\psi}}^{*(b)}\)</span>
using <span class="math inline">\(\mathbf{y}_s^{*(b)}\)</span> and compute the bootstrap
realization of predictor <span class="math inline">\(\hat{\theta}\)</span> denoted by
<span class="math inline">\(\hat{\theta}^{*(b)}(\mathbf{y}_s^{*(b)},\boldsymbol{\hat{\psi}}^{*(b)})\)</span>
based on
<span class="math inline">\(LMM(\mathbf{X}, \mathbf{Z}, \boldsymbol{\hat{\psi}}^{*(b)})\)</span>,</p></li>
<li><p>compute bootstrap realizations of prediction error <span class="math inline">\(U^*\)</span> denoted
by <span class="math inline">\(u^*\)</span> and for the <span class="math inline">\(b\)</span>th iteration given by:
<span class="math display">\[\label{u*b}
            u^{*(b)}=\hat{\theta}^{*(b)}(\mathbf{y}_s^{*(b)},\boldsymbol{\hat{\psi}}^{*(b)})-\theta^{*(b)}
            (\mathbf{y}^{*(b)},\boldsymbol{\hat{\psi}}) =\hat{\theta}^{*(b)}-\theta^{*(b)},   (\#eq:u*b)\]</span></p></li>
</ol></li>
<li><p>compute the parametric bootstrap estimators of prediction accuracy
measures: RMSE and QAPE replacing prediction errors <span class="math inline">\(U\)</span> in
(<a href="#eq:eq0">(2)</a>) and (<a href="#eq:eq1">(3)</a>) by their bootstrap realizations.</p></li>
</ol>
<p>Another possible method to estimate the prediction accuracy measures is
the residual bootstrap. In what follows, we use the notation
<span class="math inline">\(srswr(\mathbf{A}, m)\)</span> to indicate the outcome of taking a simple random
sample with replacement of size <span class="math inline">\(m\)</span> of rows of matrix <span class="math inline">\(\mathbf{A}\)</span>. If
<span class="math inline">\(\mathbf{A}\)</span> is a vector, it simplifies to a simple random sample with
replacement of size <span class="math inline">\(m\)</span> of elements of <span class="math inline">\(\mathbf{A}\)</span>.</p>
<p>To obtain the algorithm of the residual bootstrap, it is enough to
replace step 2 of the parametric bootstrap procedure presented above
with the following procedure of the population data generation based on
(<a href="#eq:LMMa">(5)</a>):</p>
<ul>
<li>generate <span class="math inline">\(B\)</span> population vectors of the variable of interest, denoted
by <span class="math inline">\(\mathbf{y}^{*(b)}\)</span> as
<span class="math display" id="eq:LMMboot">\[\label{LMMboot}
        \mathbf{y}^{*(b)}=\mathbf{X}\hat{\boldsymbol{\beta}} + \mathbf{Z}_1\mathbf{v}^{*(b)}_1+...+\mathbf{Z}_l\mathbf{v}^{*(b)}_l+...+\mathbf{Z}_L\mathbf{v}^{*(b)}_L+\mathbf{e}^{*(b)},   \tag{11}\]</span>
where <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> is an estimator (e.g. REML) of
<span class="math inline">\({\boldsymbol{\beta}}\)</span>, <span class="math inline">\(\mathbf{e}^{*(b)}\)</span> is a vector of dimension
<span class="math inline">\(N \times 1\)</span> defined as
<span class="math inline">\(srswr(col_{1 \leq i \leq n } \hat{{e}}_{i}, N)\)</span>, where
<span class="math inline">\(\hat{{e}}_{i}\)</span> (<span class="math inline">\(i=1,2,...,n\)</span>) are residuals, <span class="math inline">\(\mathbf{v}^{*(b)}_l\)</span>
(for <span class="math inline">\(1,2,...,L\)</span>) is the vector of dimension <span class="math inline">\(K_l J_l \times 1\)</span>
built from the columns of the matrix: <span class="math inline">\(srswr \left(
    \left[ \begin{array}{ccccc}
        \hat{\mathbf{v}}_{l1} &amp;
        \dots &amp;
        \hat{\mathbf{v}}_{lk} &amp;
        \dots &amp;
        \hat{\mathbf{v}}_{lK_l}
    \end{array}
    \right], J_l
    \right)\)</span> of dimension <span class="math inline">\(J_l \times K_l\)</span>, where
<span class="math inline">\(\hat{\mathbf{v}}_{lk}\)</span> are estimates of elements of random effects
vector (<a href="#eq:vl">(6)</a>).</li>
</ul>
<p>The next 3–5 steps in this procedure are analogous to steps in the
parametric bootstrap procedure.</p>
<p>In the above-described step, it can be seen that if more than one vector
of random effect is assumed at the <span class="math inline">\(l\)</span>th level of grouping, then the
elements are not sampled with replacement independently. In this case,
rows of the matrix formed by these vectors are sampled with replacement.</p>
<p>The residual bootstrap algorithm can also be performed with so-called
"correction procedure". This procedure, which can improve the
properties of the residual bootstrap estimators due to the
underdispersion of the uncorrected residual bootstrap distributions, is
presented in the supplementary document for this paper.</p>
<h3 data-number="5" id="bootstrap-in-qape"><span class="header-section-number">5</span> Bootstrap in <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a></h3>
<p>Two bootstrap procedures are implemented in separate functions:
<code>bootPar()</code> (the parametric bootstrap) and <code>bootRes()</code> (the residual
bootstrap). According to the general Procedure <a href="#Proc1">1</a>, the step
preceding the bootstrap procedure in both functions is the definition of
the predictor object. It must be one of the following: <code>EBLUP</code>,
<code>ebpLMMne</code> or <code>plugInLMM</code>. This object has to be passed to <code>bootPar()</code>
or <code>bootRes()</code> as the input parameter <code>predictor</code>. The other input
parameters are intuitive: <code>B</code> - the number of bootstrap iterations and
<code>p</code> - order of quantiles in the estimated QAPEs.</p>
<p>The additional input parameter in <code>bootRes()</code> is a logical condition
called <code>correction</code>, which makes it possible to include an additional
correction term for both random effects and random components, presented
in the supplementary document for this paper, to avoid the problem of
underdispersion of residual bootstrap distributions.</p>
<p>The main output values in both functions are basically the measures:
<code>estRMSE</code> and <code>estQAPE</code> computed based on (<a href="#eq:eq0">(2)</a>) and
(<a href="#eq:eq1">(3)</a>), respectively, where prediction errors are replaced by
their bootstrap realizations. There is also the output <code>error</code> being the
vector of bootstrap realizations of prediction errors, which is useful
e.g. in in-depth analysis of the prediction accuracy and for graphical
presentation of results. To estimate these accuracy measures, we use
below the residual bootstrap with the correction procedure.</p>
<p>As previously stated, our package utilizes the <code>lmer()</code> function from
the <a href="https://CRAN.R-project.org/package=lme4"><strong>lme4</strong></a> package for
estimating model parameters. However, this function has been known to
generate convergence warnings in certain situations, listed for example
by <span class="citation" data-cites="lme4">(<a href="#ref-lme4" role="doc-biblioref">Bates et al. 2015</a>)</span> p. 25, when the estimated variances of random effects are
close to zero. Such scenarios may occur when models are estimated for
smaller or medium-sized datasets, when complex variance-covariance
structures are assumed, or when the grouping variable considered for
random effects has only a few levels. Although we have not observed such
issues estimating model parameters based on the original dataset
required to compute values of the predictors in previous sections,
bootstrapping or Monte Carlo simulations are more complex cases. This is
because, based on the estimates of model parameters, the values of the
dependent variables are generated <span class="math inline">\(B\)</span> times, and then model parameters
are estimated in each out of <span class="math inline">\(B\)</span> iterations. Therefore, in at least some
iterations, dependent variable values may be randomly generated giving
realizations, where the variance of the random effect is relatively
close to zero. As a result, estimates of model parameters can be
obtained; however, convergence issues implying warnings may occur. In
such cases, there are at least two possible solutions. The first option
is to discard iterations with warnings, which would imply that the
dependent variable would not follow the assumed model as required, but
instead only its conditional version with relatively high values of
variances of random effects. It will imply overdispersed bootstrap
distribution of random effects, which will affect the bias of the
bootstrap estimators of accuracy measures. The second option is to
consider all generated realizations, despite convergence warnings, as
long as the parameters can be estimated for all iterations. We opted for
the latter solution, as argued in <span class="citation" data-cites="lme4">(<a href="#ref-lme4" role="doc-biblioref">Bates et al. 2015</a>)</span> p. 25, who noted that "being
able to fit a singular model is an advantage: when the best fitting
model lies on the boundary of a constrained space".</p>
<h4 class="unnumbered" data-number="5.1" id="example-2">Example 2</h4>
<p>The analyses presented in Example 1 are continued. We extend the
previous results to include the issue of estimating the prediction
accuracy of the considered predictors. The use of functions for this
estimation primarily requires an object of class predictor, here
"myplugin".</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">class</span>(myplugin)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;plugInLMM&quot;</span></span></code></pre></div>
<p>The short chunk of the R code presents the residual bootstrap estimators
of the RMSE (<code>estRMSE</code>) and the QAPE (<code>estQAPE</code>) of the PLUG-IN
predictors (<code>plugin</code>) of previously analyzed three characteristics of
radon measurements in county no. 26: the arithmetic mean, geometric mean
and median. In this and subsequent examples we make the computations for
relatively high number of iterations allowing, in our opinion, to get
reliable results. These results are also used to prepare Figure
<a href="#fig:hist">3</a>. However, the computations are time-consuming. The
supplementary R file contains the same chunks of the code but the number
of iterations applied is smaller in order to execute the code swiftly.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># accuracy measures estimates based on</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># the residual bootstrap with the correction:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> B <span class="ot">&lt;-</span> <span class="dv">500</span> <span class="co"># number of bootstrap iterations</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.9</span>) <span class="co"># orders of Quantiles of Absolute Prediction Error</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">set.seed</span>(<span class="dv">1056</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> residBoot <span class="ot">&lt;-</span> <span class="fu">bootRes</span>(myplugin, B, p, <span class="at">correction =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># values of estimated RMSEs of the predictor of three characteristics:</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># the arithmetic mean, geometric mean and median of radon measurements, respectively:</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> residBoot<span class="sc">$</span>estRMSE</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.1848028</span> <span class="fl">0.2003681</span> <span class="fl">0.2824359</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># values of estimated QAPEs</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># (of order 0.75 in the first row, and of order 0.9 in the second row)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of the predictor of three characteristics:</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># the arithmetic mean, geometric mean and median of radon measurements,</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># in the 1st, 2nd and 3rd column, respectively:</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> residBoot<span class="sc">$</span>estQAPE</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>         [,<span class="dv">1</span>]      [,<span class="dv">2</span>]      [,<span class="dv">3</span>]</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span>% <span class="fl">0.1533405</span> <span class="fl">0.2135476</span> <span class="fl">0.2908988</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="dv">90</span>% <span class="fl">0.2813886</span> <span class="fl">0.3397411</span> <span class="fl">0.4374534</span></span></code></pre></div>
<p>Let us concentrate on interpretations of estimators of accuracy measures
for the predictor of the geometric mean, i.e. the second value of
<code>residBoot$estRMSE</code>, and values in the second column of
<code>residBoot$estQAPE</code>. It is estimated that the average difference between
predicted values of the geometric mean and their unknown realizations
equals <span class="math inline">\(0.2003681\)</span> picoCurie per liter. Furthermore, it is estimated
that at least <span class="math inline">\(75\%\)</span> of absolute prediction errors of the predictor of
the geometric mean are smaller or equal to <span class="math inline">\(0.2135476\)</span> picoCurie per
liter and at least <span class="math inline">\(25\%\)</span> of absolute prediction errors of the predictor
are higher or equal to <span class="math inline">\(0.2135476\)</span> picoCurie per liter. Finally, it is
estimated that at least <span class="math inline">\(90\%\)</span> of absolute prediction errors of the
predictor of the geometric mean are smaller or equal to <span class="math inline">\(0.3397411\)</span>
picoCurie per liter and at least <span class="math inline">\(10\%\)</span> of absolute prediction errors of
the predictor are higher or equal to <span class="math inline">\(0.3397411\)</span> picoCurie per liter.
The distributions of bootstrap absolute prediction errors with values of
estimated RMSEs and QAPEs for the considered three prediction problems
are presented in Figure <a href="#fig:hist">3</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:hist"></span>
<img src="histAll.png" alt="graphic without alt text" width="100%" />
<p class="caption">
Figure 3: The histograms of bootstrap absolute prediction errors for myplugin (for PLUG-IN predictors of the arithmetic mean, geometric mean and median) for B=500
</p>
</div>
</div>
<p>Since the assumption of normality is not met, the parametric bootstrap
should not be used in this case. For this reason, we do not present the
results for this method below, although – but for illustrative purposes
only – they are presented in the supplementary R file. Moreover, these
analyses can also be conducted using <code>bootParFuture()</code> and
<code>bootResFuture()</code> functions where parallel computing algorithms are
applied. The input arguments and the output of these functions are the
same as in <code>bootPar()</code> and <code>bootRes()</code>. Examples based on these
functions are also included in the supplementary R file.</p>
<h3 data-number="6" id="bootstrap-under-the-misspecified-model-in-qape"><span class="header-section-number">6</span> Bootstrap under the misspecified model in <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a></h3>
<p>The <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package also
allows to use predictors under a model different from the assumed one
(e.g. a simpler or more robust model), but estimate its accuracy under
the assumed model. In this case, the parametric and residual bootstrap
procedures are implemented in <code>bootParMis()</code> and <code>bootResMis()</code>
functions. These functions allow to estimate the accuracy of two
predictors under the model correctly specified for the first of them. Of
course, it is expected that the estimated accuracy of the first
predictor will be better than of the second one, but the key issue can
be the difference between estimates of accuracy measures. A small
difference, even to the second predictor’s disadvantage, may be treated
by the user as an argument for using the second predictor due to its
properties, such as robustness or simplicity.</p>
<p>The considered functions allow to estimate the accuracy of two
predictors, which belong to the class <code>plugInLMM</code>, under the model used
to define the first of them. The remaining arguments are the same as in
<code>bootPar()</code> and <code>bootRes()</code> functions: <code>B</code> - the number of bootstrap
iterations, and <code>p</code> - orders of QAPE estimates to be taken into account.</p>
<p>The output results of <code>bootParMis()</code> and <code>bootResMis()</code> include –
similarly to <code>bootPar()</code> and <code>bootRes()</code> functions – estimates of the
RMSEs and QAPEs of both predictors (denoted here by: <code>estRMSElmm</code>,
<code>estRMSElmmMis</code>, <code>estQAPElmm</code> and <code>estQAPElmmMis</code>), and boostrap
realizations of their prediction errors (<code>errorLMM</code> and <code>errorLMMmis</code>).</p>
<h4 class="unnumbered" data-number="6.1" id="example-3">Example 3</h4>
<p>In this example, we study the same accuracy measures as in Example 2,
but the aim is to compare the predictor <code>myplugin</code> and other predictor
defined under the misspecified LMM. First, the misspecified model has to
be defined, and a relevant predictor has to be computed.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fixed.part.mis <span class="ot">&lt;-</span> <span class="st">&#39;1&#39;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> random.part.mis <span class="ot">&lt;-</span> <span class="st">&#39;(1|county)&#39;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> myplugin.mis <span class="ot">&lt;-</span> <span class="fu">plugInLMM</span>(YS, fixed.part.mis, random.part.mis, reg, con,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                         <span class="at">weights =</span> <span class="cn">NULL</span>, <span class="at">backTrans =</span> backTransExp, thetaFun)</span></code></pre></div>
<p>Having two objects: <code>myplugin</code> and <code>myplugin.mis</code>, one can proceed to a
comparison by estimating bootstrap prediction accuracy performed using
the residual bootstrap with correction procedure. In this case, we
estimate the prediction accuracy of these two predictors under the model
used to define the first of them.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">set.seed</span>(<span class="dv">1056</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> residBootMis <span class="ot">&lt;-</span> <span class="fu">bootResMis</span>(myplugin, myplugin.mis, B, p, <span class="at">correction =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># residual bootstrap with the correction RMSE estimators</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of &#39;plugin&#39; of: arithmetic mean, geometric mean and median</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of radon measurements in county 26:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> residBootMis<span class="sc">$</span>estRMSElmm</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.1848028</span> <span class="fl">0.2003681</span> <span class="fl">0.2824359</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># residual bootstrap with the correction RMSE estimators</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of &#39;plugin.mis&#39; of: arithmetic mean, geometric mean and median</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of radon measurements in county 26:</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> residBootMis<span class="sc">$</span>estRMSElmmMis</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.1919184</span> <span class="fl">0.3192304</span> <span class="fl">0.2762137</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># residual bootstrap with the correction QAPE estimators of order 0.75 and 0.9</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of &#39;plugin&#39; of: arithmetic mean, geometric mean and median</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of radon measurements in county 26:</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> residBootMis<span class="sc">$</span>estQAPElmm</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>         [,<span class="dv">1</span>]      [,<span class="dv">2</span>]      [,<span class="dv">3</span>]</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span>% <span class="fl">0.1533405</span> <span class="fl">0.2135476</span> <span class="fl">0.2908988</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="dv">90</span>% <span class="fl">0.2813886</span> <span class="fl">0.3397411</span> <span class="fl">0.4374534</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># residual bootstrap with the correction QAPE estimators of order 0.75 and 0.9</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of &#39;plugin.mis&#39; of: arithmetic mean, geometric mean and median</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of radon measurements in county 26:</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> residBootMis<span class="sc">$</span>estQAPElmmMis</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>         [,<span class="dv">1</span>]      [,<span class="dv">2</span>]      [,<span class="dv">3</span>]</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span>% <span class="fl">0.2267062</span> <span class="fl">0.3802836</span> <span class="fl">0.3255197</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="dv">90</span>% <span class="fl">0.2813787</span> <span class="fl">0.4970726</span> <span class="fl">0.4489399</span></span></code></pre></div>
<p>The results, presented above, were obtained for the same number of
bootstrap iterations as in Example 2 (<span class="math inline">\(B = 500\)</span>). If we compare, under
the model defined in <code>plugin</code>, estimated RMSEs of <code>plugin</code> and
<code>plugin.mis</code> predictors of the geometric mean given by <span class="math inline">\(0.2003681\)</span> and
<span class="math inline">\(0.3192304\)</span> picoCurie per liter, respectively, we can state that the
estimated accuracy (measured by RMSE estimators) of the first predictor
is better comparing with the second one. If we are not interested in the
average accuracy measures but in the right tail of the distribution of
prediction errors, we can use estimates of QAPE of order 0.9 to compare
the accuracy. The result for the <code>plugin.mis</code> of the geometric mean
equals to <span class="math inline">\(0.4970726\)</span> picoCurie per liter, and it is higher comparing
with <span class="math inline">\(0.3397411\)</span> picoCurie per liter obtained for <code>plugin</code> for the same
prediction problem. Hence, in this case, the accuracy comparison based
both on the RMSE and QAPE leads to the same finding.</p>
<p>In the previous paragraph, we have focused on the results for the case
of prediction of the geometric mean. If the comparison is made for the
case of prediction of the arithmetic mean (the first column of output
results) or the median (the third column of output results), we will
come to the same conclusion regarding the estimated accuracy of <code>plugin</code>
and <code>plugin.mis</code> as in the case of prediction of the geometric mean.</p>
<p>Similarly to the residual bootstrap, the parametric bootstrap procedure
<code>paramBootMis</code> available in
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package can be
performed. However, in the considered case the normality assumption is
not met (as discussed above) and the procedure is not recommended. The
appropriate chunk of the R code is presented in the supplementary R
file, but it is solely intended for illustrative purposes.</p>
<h3 data-number="7" id="monte-carlo-simulation-analyses"><span class="header-section-number">7</span> Monte Carlo simulation analyses</h3>
<p>In the previous section, our aim was to estimate the prediction accuracy
under correctly specified or misspecified model. In this section, we do
not estimate the accuracy, but we approximate the true prediction
accuracy under the specified model in the Monte Carlo simulation study.
The crucial difference is that in this case, the model parameters used
are obtained based on the whole population dataset, not the sample. If
the number of iterations is large enough, we can treat the computed
values of the measures as their true values, which are unknown in
practice.</p>
<p>The last step of the analysis in
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package presented in
Procedure <a href="#Proc1">1</a> is the Monte Carlo (MC) simulation analysis of:</p>
<ul>
<li><p>properties of predictors</p></li>
<li><p>and properties of parametric, residual and double bootstrap
estimators of accuracy measures.</p></li>
</ul>
<p>The whole Monte Carlo procedure is as follows.</p>
<div id="Proc2" class="procedure">
<p><strong>Procedure 2</strong>. <em>Model-based Monte Carlo simulation analyses in
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> </em></p>
<ol type="1">
<li><p><em>define the population vector of the dependent variable and the
population matrix of auxiliary variables,</em></p></li>
<li><p><em>provide the information on the division of the population into the
sampled and non-sampled part,</em></p></li>
<li><p><em>define <span class="math inline">\(\theta\)</span> - the characteristics of the response variable to
be predicted,</em></p></li>
<li><p><em>define the predictors <span class="math inline">\(\hat{\theta}\)</span> and accuracy measures
estimators which properties are to be assessed,</em></p></li>
<li><p><em>define the model to be used to generate realizations of the values
of the dependent variable and estimate its parameters based on
population data,</em></p></li>
<li><p><em>For k=1, 2, ..., K</em></p>
<ol type="1">
<li><p><em>generate the population vector of the response variable based
on the assumed model,</em></p></li>
<li><p><em>based on population data, compute the characteristics <span class="math inline">\(\theta\)</span>,
denoted by <span class="math inline">\(\theta_k\)</span>,</em></p></li>
<li><p><em>based on sample data, estimate the parameters of the LMM,</em></p></li>
<li><p><em>based on sample data, compute values of predictors
<span class="math inline">\(\hat{\theta}\)</span>, denoted by <span class="math inline">\(\hat{\theta}_k\)</span>,</em></p></li>
<li><p><em>based on sample data, estimate the accuracy of <span class="math inline">\(\hat{\theta}\)</span>
using bootstrap methods,</em></p></li>
</ol></li>
<li><p><em>End For</em></p></li>
<li><p><em>compute accuracy measures of predictors using <span class="math inline">\(\hat{\theta}_k\)</span> and
<span class="math inline">\(\theta_k\)</span> (for <span class="math inline">\(k=1,2, ..., K\)</span>),</em></p></li>
<li><p><em>compute accuracy measures of estimators of prediction accuracy
measures.</em></p></li>
</ol>
</div>
<h3 data-number="8" id="monte-carlo-analyses-in-qape"><span class="header-section-number">8</span> Monte Carlo analyses in <a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a></h3>
<p>In order to perform a Monte Carlo (MC) analysis on the properties of
predictors, it is necessary to have access to the entire population data
for both dependent and independent variables. The function <code>mcLMMmis()</code>
can be used with the following arguments. Firstly, the population values
of the dependent variable (after a necessary transformation) should be
declared as <code>Ypop</code>. By using the <code>Ypop</code> values, we can estimate the
model parameters based on the entire population data (assuming that they
are known). This allows us to generate values of the dependent variable
in the simulation study that can mimic its distribution in the entire
population, not just in the sample. This approach ensures that our
simulation study can be an accurate representation of the random process
in the entire population, resembling the real-world scenario. Secondly,
three predictors: <code>predictorLMMmis</code>, <code>predictorLMM</code>, <code>predictorLMM2</code>,
which belong to the class <code>plugInLMM</code>, are to be defined. The first one
is used only to define the (possibly misspecified) model used to
generate population values of the response variables. Accuracy of
<code>predictorLMM</code> and <code>predictorLMM2</code> is assessed in the simulation study.
The next two arguments include the number of MC iterations <code>K</code> and
orders <code>p</code> of QAPEs used to assess the prediction accuracy. Finally, it
should be noted that it is possible to modify covariance matrices of
random components and random effects based on the model defined in
<code>predictorLMMmis</code>, which are used tThiso generate values of the
dependent variable. It is possible by declaring values of <code>ratioR</code> and
<code>ratioG</code> arguments, which the diagonal elements of covariance matrices
of random components and random effects, respectively, are divided by.</p>
<p>The output of this function covers the following statistics of both
predictors computed in the simulation study: relative biases (<code>rBlmm</code>
and <code>rBlmm2</code>), relative RMSEs (<code>rRMSElmm</code> and <code>rRMSElmm2</code>) and QAPEs
(<code>QAPElmm</code> and <code>QAPElmm2</code>). Simulation-based prediction errors of both
predictors (<code>errorLMM</code> and <code>errorLMM2</code>) are also taken into account.</p>
<h4 class="unnumbered" data-number="8.1" id="example-4">Example 4</h4>
<p>In the example, an MC simulation is carried out assuming the <code>myplugin</code>
predictor. The goal is to approximate the true accuracy of the
prediction assuming model (<a href="#eq:radon-model">(10)</a>). Hence, in the package
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a>, all input predictor
objects in the function <code>mcLMMmis</code> have to be defined as <code>myplugin</code>.  </p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># input arguments:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>predictorLMMmis <span class="ot">&lt;-</span> myplugin <span class="co"># to define the model</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>predictorLMM <span class="ot">&lt;-</span> myplugin <span class="co"># which properties are assessed in the simulation study</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>predictorLMM2 <span class="ot">&lt;-</span> myplugin  <span class="co"># which properties are assessed in the sim. study</span></span></code></pre></div>
<p>Except that no modification of covariance matrices has to be used.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># diag. elements of the covariance matrix of random components are divided by:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ratioR <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># diag. elements of the covariance matrix of random effects are divided by:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>ratioG <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>We specify the number of Monte Carlo iterations.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">500</span> <span class="co"># the number of MC iterations</span></span></code></pre></div>
<p>The analysis is conducted in the object <code>MC</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">set.seed</span>(<span class="dv">1086</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> MC <span class="ot">&lt;-</span> <span class="fu">mcLMMmis</span>(Ypop, predictorLMMmis, predictorLMM, predictorLMM2,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                        K, p, ratioR, ratioG)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># relative bias of &#39;predictorLMM&#39;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of the arithmetic mean, geometric mean and median in county 26 (in %):</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> MC<span class="sc">$</span>rBlmm</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">1.73208393</span> <span class="sc">-</span><span class="fl">0.04053178</span> <span class="sc">-</span><span class="fl">5.22355236</span></span></code></pre></div>
<p>Results of the relative biases are obtained. It is seen, that under the
assumed model the values of the considered predictor of the geometric
mean (the second value of <code>MC$rBlmm</code>) are smaller than possible
realizations of the geometric mean on average by <span class="math inline">\(0.04053178\%\)</span>. In
turn, the relative RMSEs are as follows.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># relative RMSE of &#39;predictorLMM&#39;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of the arithmetic mean, geometric mean and median in county 26 (in %):</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> MC<span class="sc">$</span>rRMSElmm</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">3.429465</span> <span class="fl">4.665810</span> <span class="fl">7.146678</span></span></code></pre></div>
<p>In the considered case, the average difference between predicted values
of the geometric mean and its possible realizations (the second value of
<code>MC$rRMSElmm</code>) equals <span class="math inline">\(4.665810\%\)</span>. It should be noted that this value
can be treated as the true value of the relative RMSE (if the number of
iterations is large enough), not the estimated value obtained in
Examples 2 and 3.</p>
<p>Finally, QAPEs of orders 0.75 and 0.9 are considered.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># QAPE of order 0.75 and 0.9 of &#39;predictorLMM&#39;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># of the arithmetic mean, geometric mean and median in county 26:</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> MC<span class="sc">$</span>QAPElmm</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>         [,<span class="dv">1</span>]      [,<span class="dv">2</span>]      [,<span class="dv">3</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span>% <span class="fl">0.1491262</span> <span class="fl">0.1989504</span> <span class="fl">0.2919221</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="dv">90</span>% <span class="fl">0.2895684</span> <span class="fl">0.2959457</span> <span class="fl">0.4728064</span></span></code></pre></div>
<p>Let us interpret the results presented in the second column of
<code>MC$QAPElmm</code>. At least <span class="math inline">\(75\%\)</span> (<span class="math inline">\(90\%\)</span>) of absolute prediction errors of
the predictor of the geometric mean are smaller or equal to <span class="math inline">\(0.1989504\)</span>
(<span class="math inline">\(0.2959457\)</span>) picoCurie per liter and at least <span class="math inline">\(25\%\)</span> (<span class="math inline">\(10\%\)</span>) of
absolute prediction errors of the predictor are higher or equal to
<span class="math inline">\(0.1989504\)</span> (<span class="math inline">\(0.2959457\)</span>) picoCurie per liter. Similar to the values of
the rRMSEs in the previous code chunk, the values can be considered to
be true QAPE values, not the estimates presented in Examples 2 and 3.</p>
<p>In Example 4, the accuracy of one predictor under the model used to
define this predictor was presented. A more complex version of the
simulation study, where the properties of two predictors are studied
under the model defined by the third predictor, is presented in the
supplementary R file. What is more, the
<a href="https://CRAN.R-project.org/package=qape"><strong>qape</strong></a> package also allows
to use <code>mcBootMis()</code> function to conduct MC analyses of properties of
accuracy measure estimators (estimators of MSEs and QAPEs) of two
predictors (which belong to the class <code>plugInLMM</code>) declared as
arguments. The model used in the simulation study is declared in the
first predictor, but the properties of accuracy measures estimators of
both predictors are studied. Output results of <code>mcBootMis()</code> covers
simulation results on properties of different accuracy measures
estimators, including the relative biases and relative RMSEs of the
parametric bootstrap MSE estimators of both predictors. The same
simulation-based statistics but for parametric bootstrap QAPE estimators
are also included. Other bootstrap methods, including the residual
bootstrap with and without the correction procedure, are also taken into
account. The full list of output arguments of <code>mcBootMis()</code> function are
presented in <code>qape-manual</code> file, cf. <span class="citation" data-cites="qape">(<a href="#ref-qape" role="doc-biblioref">Wolny-Dominiak and Żądło 2023</a>)</span>.</p>
<h3 data-number="9" id="conclusions"><span class="header-section-number">9</span> Conclusions</h3>
<p>The package enables R users to make predictions and assess the accuracy
under linear mixed models based on different methods in a fast and
intuitive manner – not only based on the RMSE but also based on
Quantiles of Absolute Prediction Errors. It also covers functions which
allow to conduct Monte Carlo simulation analyses of properties of the
methods of users interest. Its main advantage, compared to other
packages, is the considerable flexibility in terms of defining the model
(as in the <a href="https://CRAN.R-project.org/package=lme4"><strong>lme4</strong></a> package)
and the predicted characteristic, but also the transformation of the
response variable.</p>
<p>In our opinion, the package is useful for scientists, practitioners and
decision-makers in all areas of research where accurate estimates and
forecasts for different types of data (including cross-sectional and
longitudinal data) and for different characteristics play the crucial
role. We believe that it will be of special interest to survey
statisticians interested in the prediction for subpopulations with small
or even zero sample sizes, called small areas.</p>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h3 class="appendix" data-number="10" id="supplementary-materials"><span class="header-section-number">10</span> Supplementary materials</h3>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2024-004.zip">RJ-2024-004.zip</a></p>
<h3 class="appendix" data-number="11" id="cran-packages-used"><span class="header-section-number">11</span> CRAN packages used</h3>
<p><a href="https://cran.r-project.org/package=qape">qape</a>, <a href="https://cran.r-project.org/package=sae">sae</a>, <a href="https://cran.r-project.org/package=msae">msae</a>, <a href="https://cran.r-project.org/package=saery">saery</a>, <a href="https://cran.r-project.org/package=JoSAE">JoSAE</a>, <a href="https://cran.r-project.org/package=emdi">emdi</a>, <a href="https://cran.r-project.org/package=HLMdiag">HLMdiag</a>, <a href="https://cran.r-project.org/package=lme4">lme4</a></p>
<h3 class="appendix" data-number="12" id="cran-task-views-implied-by-cited-packages"><span class="header-section-number">12</span> CRAN Task Views implied by cited packages</h3>
<p><a href="https://cran.r-project.org/view=Econometrics">Econometrics</a>, <a href="https://cran.r-project.org/view=Environmetrics">Environmetrics</a>, <a href="https://cran.r-project.org/view=MixedModels">MixedModels</a>, <a href="https://cran.r-project.org/view=OfficialStatistics">OfficialStatistics</a>, <a href="https://cran.r-project.org/view=Psychometrics">Psychometrics</a>, <a href="https://cran.r-project.org/view=SpatioTemporal">SpatioTemporal</a></p>
<h3 class="appendix" data-number="13" id="note"><span class="header-section-number">13</span> Note</h3>
<p>This article is converted from a Legacy LaTeX article using the
<a href="https://cran.r-project.org/package=texor">texor</a> package.
The pdf version is the official version. To report a problem with the html,
refer to CONTRIBUTE on the R Journal homepage.</p>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-lme4" class="csl-entry" role="listitem">
D. Bates, M. Mächler, B. Bolker and S. Walker. Fitting linear mixed-effects models using <span class="nocase">lme4</span>. <em>Journal of Statistical Software</em>, 67(1): 1–48, 2015. DOI <a href="https://doi.org/10.18637/jss.v067.i01">10.18637/jss.v067.i01</a>.
</div>
<div id="ref-SAE1988" class="csl-entry" role="listitem">
G. E. Battese, R. M. Harter and W. A. Fuller. An error-components model for prediction of county crop areas using survey and satellite data. <em>Journal of the American Statistical Association</em>, 83(401): 28–36, 1988.
</div>
<div id="ref-boubeta2016empirical" class="csl-entry" role="listitem">
M. Boubeta, M. J. Lombardı́a and D. Morales. Empirical best prediction under area-level poisson mixed models. <em>Test</em>, 25(3): 548–569, 2016.
</div>
<div id="ref-josae" class="csl-entry" role="listitem">
J. Breidenbach. <em>JoSAE: Unit-level and area-level small area estimation.</em> 2018. URL <a href="https://CRAN.R-project.org/package=JoSAE">https://CRAN.R-project.org/package=JoSAE</a>. R package version 0.3.0.
</div>
<div id="ref-buhlmann2005" class="csl-entry" role="listitem">
H. Bühlmann and A. Gisler. <em>A course in credibility theory and its applications.</em> Springer, 2005.
</div>
<div id="ref-cantoni2021review" class="csl-entry" role="listitem">
E. Cantoni, N. Jacot and P. Ghisletta. Review and comparison of measures of explained variation and model selection in linear mixed-effects models. <em>Econometrics and Statistics</em>, 2021.
</div>
<div id="ref-christiaensen2012" class="csl-entry" role="listitem">
L. Christiaensen, P. Lanjouw, J. Luoto and D. Stifel. Small area estimation-based prediction methods to track poverty: Validation and applications. <em>The Journal of Economic Inequality</em>, 10(2): 267–297, 2012.
</div>
<div id="ref-chwila2019properties" class="csl-entry" role="listitem">
A. Chwila and T. Żądło. On properties of empirical best predictors. <em>Communications in Statistics-Simulation and Computation</em>, 1–34, 2019.
</div>
<div id="ref-cook2007interactive" class="csl-entry" role="listitem">
D. Cook, D. F. Swayne and A. Buja. <em>Interactive and dynamic graphics for data analysis: With r and GGobi.</em> Springer, 2007.
</div>
<div id="ref-fay1979estimates" class="csl-entry" role="listitem">
R. E. Fay III and R. A. Herriot. Estimates of income for small places: An application of james-stein procedures to census data. <em>Journal of the American Statistical Association</em>, 74(366a): 269–277, 1979.
</div>
<div id="ref-frees1999" class="csl-entry" role="listitem">
E. W. Frees, V. R. Young and Y. Luo. A longitudinal data analysis interpretation of credibility models. <em>Insurance: Mathematics and Economics</em>, 24(3): 229–247, 1999.
</div>
<div id="ref-gelman_data_2006" class="csl-entry" role="listitem">
A. Gelman and J. Hill. <em>Data <span>Analysis</span> <span>Using</span> <span>Regression</span> and <span>Multilevel</span>/<span>Hierarchical</span> <span>Models</span>.</em> 1st edition Cambridge ; New York: Cambridge University Press, 2006.
</div>
<div id="ref-gelman2006bayesian" class="csl-entry" role="listitem">
A. Gelman and I. Pardoe. Bayesian measures of explained variance and pooling in multilevel (hierarchical) models. <em>Technometrics</em>, 48(2): 241–251, 2006.
</div>
<div id="ref-gonzales2008" class="csl-entry" role="listitem">
W. González-Manteiga, M. J. Lombardı́a, I. Molina, D. Morales and L. Santamarı́a. Bootstrap mean squared error of small-area EBLUP. <em>Journal of Statistical Computation and Simulation</em>, 78: 443–462, 2008.
</div>
<div id="ref-gonzales2007" class="csl-entry" role="listitem">
W. González-Manteiga, M. J. Lombardı́a, I. Molina, D. Morales and L. Santamarı́a. Estimation of the mean squared error of predictors of small area linear parameters under a logistic mixed model. <em>Computational Statistics &amp; Data Analysis</em>, 51: 2720–2733, 2007.
</div>
<div id="ref-henderson1950estimation" class="csl-entry" role="listitem">
C. R. Henderson. Estimation of genetic parameters. <em>Biometrics</em>, 6(2): 186–187, 1950.
</div>
<div id="ref-hobza2016empirical" class="csl-entry" role="listitem">
T. Hobza and D. Morales. Empirical best prediction under unit-level logit mixed models. <em>Journal of official statistics</em>, 32(3): 661–692, 2016.
</div>
<div id="ref-jiang1996reml" class="csl-entry" role="listitem">
J. Jiang. REML estimation: Asymptotic behavior and related topics. <em>The Annals of Statistics</em>, 24(1): 255–286, 1996.
</div>
<div id="ref-kackar1981unbiasedness" class="csl-entry" role="listitem">
R. N. Kackar and D. A. Harville. Unbiasedness of two-stage estimation and prediction procedures for mixed linear models. <em>Communications in statistics-theory and methods</em>, 10(13): 1249–1261, 1981.
</div>
<div id="ref-kreutzmann2019r" class="csl-entry" role="listitem">
A.-K. Kreutzmann, S. Pannier, N. Rojas-Perilla, T. Schmid, M. Templ and N. Tzavidis. The r package emdi for estimating and mapping regionally disaggregated indicators. <em>Journal of Statistical Software</em>, 91: 2019.
</div>
<div id="ref-saery" class="csl-entry" role="listitem">
M. D. E. Lefler, D. M. Gonzalez and A. P. Martin. <em>Saery: Small area estimation for rao and yu model.</em> 2014. URL <a href="https://CRAN.R-project.org/package=saery">https://CRAN.R-project.org/package=saery</a>. R package version 1.0.
</div>
<div id="ref-gelman1999analysis" class="csl-entry" role="listitem">
C. Lin, A. Gelman, P. N. Price and D. H. Krantz. Analysis of local decisions using hierarchical modeling, applied to home radon measurement and remediation. <em>Statistical Science</em>, 14(3): 305–337, 1999.
</div>
<div id="ref-loy2013diagnostics" class="csl-entry" role="listitem">
A. Loy. Diagnostics for mixed/hierarchical linear models. 2013.
</div>
<div id="ref-loy2015you" class="csl-entry" role="listitem">
A. Loy and H. Hofmann. Are you normal? The problem of confounded residual structures in hierarchical linear models. <em>Journal of Computational and Graphical Statistics</em>, 24(4): 1191–1209, 2015.
</div>
<div id="ref-HLMdiag" class="csl-entry" role="listitem">
A. Loy and H. Hofmann. <span>HLMdiag</span>: A suite of diagnostics for hierarchical linear models in <span>R</span>. <em>Journal of Statistical Software</em>, 56(5): 1–28, 2014. URL <a href="https://www.jstatsoft.org/article/view/v056i05">https://www.jstatsoft.org/article/view/v056i05</a>.
</div>
<div id="ref-loy2017model" class="csl-entry" role="listitem">
A. Loy, H. Hofmann and D. Cook. Model choice and diagnostics for linear mixed-effects models using statistics on street corners. <em>Journal of Computational and Graphical Statistics</em>, 26(3): 478–492, 2017.
</div>
<div id="ref-sae" class="csl-entry" role="listitem">
I. Molina and Y. Marhuenda. <span class="nocase">sae</span>: An <span>R</span> package for small area estimation. <em>The R Journal</em>, 7(1): 81–98, 2015. URL <a href="https://journal.r-project.org/archive/2015/RJ-2015-007/RJ-2015-007.pdf">https://journal.r-project.org/archive/2015/RJ-2015-007/RJ-2015-007.pdf</a>.
</div>
<div id="ref-molina2010small" class="csl-entry" role="listitem">
I. Molina and J. Rao. Small area estimation of poverty indicators. <em>Canadian Journal of Statistics</em>, 38(3): 369–385, 2010.
</div>
<div id="ref-nero1994statistically" class="csl-entry" role="listitem">
A. Nero, S. Leiden, D. Nolan, P. Price, S. Rein, K. Revzan, H. Woolenberg and A. Gadgil. Statistically based methodologies for mapping of radon’actual’concentrations: The case of minnesota. <em>Radiation Protection Dosimetry</em>, 56(1-4): 215–219, 1994.
</div>
<div id="ref-msae" class="csl-entry" role="listitem">
N. Permatasari and A. Ubaidillah. <em>Msae: Multivariate fay herriot models for small area estimation.</em> 2021. URL <a href="https://CRAN.R-project.org/package=msae">https://CRAN.R-project.org/package=msae</a>. R package version 0.1.4.
</div>
<div id="ref-peck_should_2005" class="csl-entry" role="listitem">
P. N. Price and A. Gelman. Should you measure the radon concentration in your home? In <em>Statistics: <span>A</span> <span>Guide</span> to the <span>Unknown</span></em>, 4th edition pages. 149–170 2005. Belmont, CA: Duxbury Press. ISBN 978-0-534-37282-8.
</div>
<div id="ref-price1996bayesian" class="csl-entry" role="listitem">
P. N. Price, A. V. Nero and A. Gelman. Bayesian prediction of mean indoor radon concentrations for minnesota counties. <em>Health Physics</em>, 71(6): 922–936, 1996.
</div>
<div id="ref-rao2015small" class="csl-entry" role="listitem">
J. N. Rao and I. Molina. <em>Small area estimation.</em> John Wiley &amp; Sons, 2015.
</div>
<div id="ref-rao1994small" class="csl-entry" role="listitem">
J. N. Rao and M. Yu. Small-area estimation by combining time-series and cross-sectional data. <em>Canadian Journal of Statistics</em>, 22(4): 511–528, 1994.
</div>
<div id="ref-royall1976linear" class="csl-entry" role="listitem">
R. M. Royall. The linear least-squares prediction approach to two-stage sampling. <em>Journal of the American Statistical Association</em>, 71(355): 657–664, 1976.
</div>
<div id="ref-zadlo2020bootstrap" class="csl-entry" role="listitem">
A. Wolny-Dominiak and T. Żądło. On bootstrap estimators of some prediction accuracy measures of loss reserves in a non-life insurance company. <em>Communications in Statistics-Simulation and Computation</em>, 1–16, 2020.
</div>
<div id="ref-qape" class="csl-entry" role="listitem">
A. Wolny-Dominiak and T. Żądło. <em>Qape: Quantile of absolute prediction errors.</em> 2023. URL <a href="https://CRAN.R-project.org/package=qape">https://CRAN.R-project.org/package=qape</a>. R package version 2.0.
</div>
<div id="ref-zadlo2013parametric" class="csl-entry" role="listitem">
T. Żądło. On parametric bootstrap and alternatives of MSE. In <em>Proceedings of 31st international conference mathematical methods in economics</em>, pages. 1081–1086 2013.
</div>
<div id="ref-zadlo2017EBLUP" class="csl-entry" role="listitem">
T. Żądło. On prediction of population and subpopulation characteristics for future periods. <em>Communications in Statistics-Simulation and Computation</em>, 461(10): 8086–8104, 2017.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Wolny--Dominiak &amp; Ża̧dło, "Prediction, Bootstrapping and Monte Carlo Analyses Based on Linear Mixed Models with QAPE 2.0 Package", The R Journal, 2025</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2024-004,
  author = {Wolny--Dominiak, Alicja and Ża̧dło, Tomasz},
  title = {Prediction, Bootstrapping and Monte Carlo Analyses Based on Linear Mixed Models with QAPE 2.0 Package},
  journal = {The R Journal},
  year = {2025},
  note = {https://doi.org/10.32614/RJ-2024-004},
  doi = {10.32614/RJ-2024-004},
  volume = {16},
  issue = {1},
  issn = {2073-4859},
  pages = {67-82}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
