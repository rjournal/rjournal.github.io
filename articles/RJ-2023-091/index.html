<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>A Comparison of R Tools for Nonlinear Least Squares Modeling</title>

<meta property="description" itemprop="description" content="Our Google Summer of Code project &quot;Improvements to `nls()`&quot; investigated rationalizing R tools for nonlinear regression and nonlinear estimation tools by considering usability, maintainability, and functionality, especially for a Gauss-Newton solver. &lt;!-- JN: copyedit essentially accepted --&gt; The rich features of `nls()` are weakened by several deficiencies and inconsistencies such as a lack of stabilization of the Gauss-Newton solver. Further considerations are the usability and  maintainability of the code base that provides the functionality `nls()` claims to offer. Various packages, including our `nlsr`, provide alternative capabilities. We consider the differences in goals, approaches, and features of different tools for nonlinear least squares modeling in R. Discussion of  these matters is relevant to improving R generally as well as its  nonlinear estimation tools."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2023-091/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2024-04-11"/>
<meta property="article:created" itemprop="dateCreated" content="2024-04-11"/>
<meta name="article:author" content="John C. Nash"/>
<meta name="article:author" content="Arkajyoti Bhattacharjee"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="A Comparison of R Tools for Nonlinear Least Squares Modeling"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Our Google Summer of Code project &quot;Improvements to `nls()`&quot; investigated rationalizing R tools for nonlinear regression and nonlinear estimation tools by considering usability, maintainability, and functionality, especially for a Gauss-Newton solver. &lt;!-- JN: copyedit essentially accepted --&gt; The rich features of `nls()` are weakened by several deficiencies and inconsistencies such as a lack of stabilization of the Gauss-Newton solver. Further considerations are the usability and  maintainability of the code base that provides the functionality `nls()` claims to offer. Various packages, including our `nlsr`, provide alternative capabilities. We consider the differences in goals, approaches, and features of different tools for nonlinear least squares modeling in R. Discussion of  these matters is relevant to improving R generally as well as its  nonlinear estimation tools."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2023-091/"/>
<meta property="og:image" content="https://journal.r-project.org/articles/RJ-2023-091/RJ-2023-091_files/figure-html5/ex01-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="A Comparison of R Tools for Nonlinear Least Squares Modeling"/>
<meta property="twitter:description" content="Our Google Summer of Code project &quot;Improvements to `nls()`&quot; investigated rationalizing R tools for nonlinear regression and nonlinear estimation tools by considering usability, maintainability, and functionality, especially for a Gauss-Newton solver. &lt;!-- JN: copyedit essentially accepted --&gt; The rich features of `nls()` are weakened by several deficiencies and inconsistencies such as a lack of stabilization of the Gauss-Newton solver. Further considerations are the usability and  maintainability of the code base that provides the functionality `nls()` claims to offer. Various packages, including our `nlsr`, provide alternative capabilities. We consider the differences in goals, approaches, and features of different tools for nonlinear least squares modeling in R. Discussion of  these matters is relevant to improving R generally as well as its  nonlinear estimation tools."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2023-091/"/>
<meta property="twitter:image" content="https://journal.r-project.org/articles/RJ-2023-091/RJ-2023-091_files/figure-html5/ex01-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="768"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="A Comparison of R Tools for Nonlinear Least Squares Modeling"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2023-091"/>
<meta name="citation_pdf_url" content="RJ-2023-091.pdf"/>
<meta name="citation_volume" content="15"/>
<meta name="citation_issue" content="4"/>
<meta name="citation_doi" content="10.32614/RJ-2023-091"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="198"/>
<meta name="citation_lastpage" content="215"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2024/04/11"/>
<meta name="citation_publication_date" content="2024/04/11"/>
<meta name="citation_author" content="John C. Nash"/>
<meta name="citation_author_institution" content="retired professor, University of Ottawa"/>
<meta name="citation_author" content="Arkajyoti Bhattacharjee"/>
<meta name="citation_author_institution" content="Indian Institute of Technology"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Nonlinear Regression Analysis and Its Applications;citation_publisher=Wiley;citation_author=Douglas M. Bates;citation_author=Donald G. Watts"/>
  <meta name="citation_reference" content="citation_title=A Relative Offset Orthogonality Convergence Criterion for Nonlinear least Squares;citation_volume=23;citation_author=Douglas M. Bates;citation_author=Donald G. Watts"/>
  <meta name="citation_reference" content="citation_title=NISTnls: Nonlinear least squares examples from NIST;citation_author=Douglas M. Bates"/>
  <meta name="citation_reference" content="citation_title=Nonlinear statistical models;citation_publisher=Wiley;citation_author=A. Ronald Gallant"/>
  <meta name="citation_reference" content="citation_title=Bioconductor: Open software development for computational biology and bioinformatics;citation_volume=5;citation_doi=10.1186/gb-2004-5-10-r80;citation_author=Robert C. Gentleman;citation_author=Vincent J. Carey;citation_author=Douglas M. Bates;citation_author=Ben Bolstad;citation_author=Marcel Dettling;citation_author=Sandrine Dudoit;citation_author=Byron Ellis;citation_author=Laurent Gautier;citation_author=Yongchao Ge;citation_author=Jeff Gentry;citation_author=Kurt Hornik;citation_author=Torsten Hothorn;citation_author=Wolfgang Huber;citation_author=Stefano Iacus;citation_author=Rafael Irizarry;citation_author=Friedrich Leisch;citation_author=Cheng Li;citation_author=Martin Maechler;citation_author=Anthony J. Rossini;citation_author=Gunther Sawitzki;citation_author=Colin Smith;citation_author=Gordon Smyth;citation_author=Luke Tierney;citation_author=Jean YH Yang;citation_author=Jianhua Zhang"/>
  <meta name="citation_reference" content="citation_title=The differentiation of pseudo-inverses and nonlinear least squares problems whose variables separate;citation_volume=10;citation_author=G. H. Golub;citation_author=V. Pereyra"/>
  <meta name="citation_reference" content="citation_title=gslnls: GSL Nonlinear Least-Squares Fitting;citation_author=Joris Chau"/>
  <meta name="citation_reference" content="citation_title=The modified gauss-newton method for the fitting of non-linear regression functions by least squares;citation_volume=3;citation_author=H. O. Hartley"/>
  <meta name="citation_reference" content="citation_title=Statistical tools for nonlinear regression: A practical guide with S-PLUS examples, 2nd edition;citation_publisher=Springer-Verlag;citation_author=S. Huet;citation_author=A. Bouvier;citation_author=M.-A. Poursat;citation_author=E. Jolivet"/>
  <meta name="citation_reference" content="citation_title=devtools: Tools to Make Developing R Packages Easier;citation_author=Hadley Wickham;citation_author=Jim Hester;citation_author=Winston Chang;citation_author=Jennifer Bryan"/>
  <meta name="citation_reference" content="citation_title=testthat: Get Started with Testing;citation_volume=3;citation_author=Hadley Wickham"/>
  <meta name="citation_reference" content="citation_title=Minimizing a nonlinear sum of squares function on a small computer;citation_volume=19;citation_author=John C. Nash"/>
  <meta name="citation_reference" content="citation_title=Compact numerical methods for computers: Linear algebra and function minimisation;citation_publisher=Adam Hilger;citation_author=John C. Nash"/>
  <meta name="citation_reference" content="citation_title=Nonlinear Parameter Estimation: An Integrated System in BASIC;citation_publisher=Marcel Dekker;citation_author=John C. Nash;citation_author=Mary Walker-Smith"/>
  <meta name="citation_reference" content="citation_title=A method for the solution of certain non-linear problems in least squares;citation_volume=2;citation_author=Kenneth Levenberg"/>
  <meta name="citation_reference" content="citation_title=An Algorithm for Least-Squares Estimation of Nonlinear Parameters;citation_publisher=SIAM;citation_volume=11;citation_author=Donald W. Marquardt"/>
  <meta name="citation_reference" content="citation_title=nlraa: Nonlinear Regression for Agricultural Applications;citation_author=Fernando Miguez"/>
  <meta name="citation_reference" content="citation_title=minpack.lm: R interface to the Levenberg-Marquardt nonlinear least-squares algorithm found in MINPACK, plus support for bounds;citation_publisher=R Project for Statistical Computing;citation_author=Timur V. Elzhov;citation_author=Katharine M. Mullen;citation_author=Andrej-Nikolai Spiess;citation_author=Ben Bolker"/>
  <meta name="citation_reference" content="citation_title=nlsmsn: Fitting Nonlinear Models with Scale Mixture of Skew-Normal Distributions;citation_author=Marcos Prates;citation_author=Victor Lachos;citation_author=Aldo Garay"/>
  <meta name="citation_reference" content="citation_title=Nlstac: An r package for fitting separable nonlinear models;citation_author=Mariano Rodriguez-Arias;citation_author=Juan Antonio Fernandez;citation_author=Javier Cabello;citation_author=Rafael Benitez"/>
  <meta name="citation_reference" content="citation_title=Nonlinear estimation combining visual fitting with optimization methods;citation_publisher=American Statistical Association;citation_author=John C. Nash;citation_author=Paul Velleman"/>
  <meta name="citation_reference" content="citation_title=Function minimization and nonlinear least squares in R;citation_volume=14;citation_doi=https://doi.org/10.1002/wics.1580;citation_author=John C. Nash"/>
  <meta name="citation_reference" content="citation_title=nls2: Non-linear regression with brute force;citation_author=G. Grothendieck"/>
  <meta name="citation_reference" content="citation_title=Nlshelper: Convenient functions for non-linear regression;citation_author=Remko Duursma"/>
  <meta name="citation_reference" content="citation_title=Nlsic: Non linear least squares with inequality constraints;citation_author=Serguei Sokol"/>
  <meta name="citation_reference" content="citation_title=nlsMicrobio: Data sets and nonlinear regression models dedicated to predictive microbiology;citation_author=Florent Baty;citation_author=Marie-Laure Delignette-Muller"/>
  <meta name="citation_reference" content="citation_title=nls.multstart: Robust Non-Linear Regression using AIC Scores;citation_author=Daniel Padfield;citation_author=Granville Matheson"/>
  <meta name="citation_reference" content="citation_title=nlsr: Functions for Nonlinear Least Squares Solutions;citation_author=John C Nash;citation_author=Duncan Murdoch"/>
  <meta name="citation_reference" content="citation_title=Variable projection for nonlinear least squares problems;citation_publisher=Springer US;citation_volume=54;citation_issn=0926-6003;citation_author=Dianne P. O’Leary;citation_author=Bert W. Rust"/>
  <meta name="citation_reference" content="citation_title=Bbmle: Tools for general maximum likelihood estimation;citation_author=Ben Bolker;citation_author=R Development Core Team"/>
  <meta name="citation_reference" content="citation_title=Making a package from base R files;citation_author=John C. Nash;citation_author=Arkajyoti Bhattacharjee"/>
  <meta name="citation_reference" content="citation_title=Fitting linear mixed-effects models using lme4;citation_volume=67;citation_doi=10.18637/jss.v067.i01;citation_author=Douglas Bates;citation_author=Martin Mächler;citation_author=Ben Bolker;citation_author=Steve Walker"/>
  <meta name="citation_reference" content="citation_title=Nlme: Linear and nonlinear mixed effects models;citation_author=Jose Pinheiro;citation_author=Douglas Bates;citation_author=Saikat DebRoy;citation_author=Deepayan Sarkar;citation_author=Nlme: Linear and nonlinear mixed effects models"/>
  <meta name="citation_reference" content="citation_title=Nlstools: Tools for nonlinear regression diagnostics;citation_author=Florent Baty;citation_author=Marie-Laure Delignette-Muller"/>
  <meta name="citation_reference" content="citation_title=&lt;i&gt;Optimx&lt;/i&gt;: A replacement and extension of the optim() function;citation_publisher=Nash Information Services Inc.; Johns Hopkins University;citation_author=John C Nash;citation_author=Ravi Varadhan"/>
  <meta name="citation_reference" content="citation_title=Nonlinear regression modeling: A unified practical approach;citation_publisher=Marcel Dekker Inc.;citation_author=David A. Ratkowsky"/>
  <meta name="citation_reference" content="citation_title=crsnls: Nonlinear Regression Parameters Estimation by ’CRS4HC’ and ’CRS4HCe’;citation_author=Josef Tvrdík"/>
  <meta name="citation_reference" content="citation_title=Onls: Orthogonal nonlinear least-squares regression;citation_author=Onls: Orthogonal nonlinear least-squares regression"/>
  <meta name="citation_reference" content="citation_title=Nonlinear estimation.;citation_publisher=New York etc.: Springer-Verlag;citation_author=Gavin J. S. Ross"/>
  <meta name="citation_reference" content="citation_title=Nonlinear regression;citation_publisher=Wiley;citation_author=G. A. F. Seber;citation_author=C. J. Wild"/>
  <meta name="citation_reference" content="citation_title=A new algorithm to fit exponential decays without initial guess;citation_publisher=Faculty of Sciences and Mathematics, University of Nis, Serbia;citation_doi=10.2298/fil1812233t;citation_author=Juan Antonio Fernandez Torvisco;citation_author=Mariano Rodriguez-Arias;citation_author=Javier Cabello Sanchez"/>
  <meta name="citation_reference" content="citation_title=Adaptive population-based search: Application to estimation of nonlinear regression parameters;citation_volume=52;citation_author=Adaptive population-based search: Application to estimation of nonlinear regression parameters"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","type","preamble","date","date_received","journal","volume","issue","slug","packages","draft","preview","bibliography","CTV","output","pdf_url","citation_url","doi","creative_commons","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["A Comparison of R Tools for Nonlinear Least Squares Modeling"]},{"type":"character","attributes":{},"value":["Our Google Summer of Code project \"Improvements to `nls()`\" investigated rationalizing R tools for nonlinear regression and nonlinear estimation tools by considering usability, maintainability, and functionality, especially for a Gauss-Newton solver. <!-- JN: copyedit essentially accepted --> The rich features of `nls()` are weakened by several deficiencies and inconsistencies such as a lack of stabilization of the Gauss-Newton solver. Further considerations are the usability and  maintainability of the code base that provides the functionality `nls()` claims to offer. Various packages, including our `nlsr`, provide alternative capabilities. We consider the differences in goals, approaches, and features of different tools for nonlinear least squares modeling in R. Discussion of  these matters is relevant to improving R generally as well as its  nonlinear estimation tools."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","orcid_id","email"]}},"value":[{"type":"character","attributes":{},"value":["John C. Nash"]},{"type":"character","attributes":{},"value":["retired professor, University of Ottawa"]},{"type":"character","attributes":{},"value":["Telfer School of Management","Ottawa ON Canada K1N 6N5"]},{"type":"character","attributes":{},"value":["0000-0002-2762-8039"]},{"type":"character","attributes":{},"value":["profjcnash@gmail.com"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email"]}},"value":[{"type":"character","attributes":{},"value":["Arkajyoti Bhattacharjee"]},{"type":"character","attributes":{},"value":["Indian Institute of Technology"]},{"type":"character","attributes":{},"value":["Department of Mathematics and Statistics","Kanpur"]},{"type":"character","attributes":{},"value":["arkastat98@gmail.com"]}]}]},{"type":"character","attributes":{},"value":["package"]},{"type":"character","attributes":{},"value":["\\DeclareTextSymbolDefault{\\textasciigrave}{TS1}"]},{"type":"character","attributes":{},"value":["2024-04-11"]},{"type":"character","attributes":{},"value":["2023-02-27"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[198]},{"type":"integer","attributes":{},"value":[215]}]},{"type":"integer","attributes":{},"value":[15]},{"type":"integer","attributes":{},"value":[4]},{"type":"character","attributes":{},"value":["RJ-2023-091"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"NULL"},{"type":"NULL"}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["preview.png"]},{"type":"character","attributes":{},"value":["ComparingNLStools.bib"]},{"type":"list","attributes":{},"value":[]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","legacy_pdf"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["RJ-2023-091.pdf"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2023-091"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2023-091"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["/Library/Frameworks/R.framework/Versions/sitelib-4.4-arm64/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2023-091/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["ComparingNLStools_files/anchor-4.2.2/anchor.min.js","ComparingNLStools_files/bowser-1.9.3/bowser.min.js","ComparingNLStools_files/distill-2.2.21/template.v2.js","ComparingNLStools_files/figure-html5/ex01-1.png","ComparingNLStools_files/figure-latex/ex01-1.pdf","ComparingNLStools_files/header-attrs-2.25/header-attrs.js","ComparingNLStools_files/jquery-3.6.0/jquery-3.6.0.js","ComparingNLStools_files/jquery-3.6.0/jquery-3.6.0.min.js","ComparingNLStools_files/jquery-3.6.0/jquery-3.6.0.min.map","ComparingNLStools_files/popper-2.6.0/popper.min.js","ComparingNLStools_files/tippy-6.2.7/tippy-bundle.umd.min.js","ComparingNLStools_files/tippy-6.2.7/tippy-light-border.css","ComparingNLStools_files/tippy-6.2.7/tippy.css","ComparingNLStools_files/tippy-6.2.7/tippy.umd.min.js","ComparingNLStools_files/webcomponents-2.0.0/webcomponents.js","ComparingNLStools.bib","ComparingNLStools.log","ComparingNLStools.pdf","ComparingNLStools.tex","preamble.tex","RJ-2023-091_files/anchor-4.2.2/anchor.min.js","RJ-2023-091_files/bowser-1.9.3/bowser.min.js","RJ-2023-091_files/distill-2.2.21/template.v2.js","RJ-2023-091_files/figure-html5/ex01-1.png","RJ-2023-091_files/header-attrs-2.25/header-attrs.js","RJ-2023-091_files/jquery-3.6.0/jquery-3.6.0.js","RJ-2023-091_files/jquery-3.6.0/jquery-3.6.0.min.js","RJ-2023-091_files/jquery-3.6.0/jquery-3.6.0.min.map","RJ-2023-091_files/popper-2.6.0/popper.min.js","RJ-2023-091_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2023-091_files/tippy-6.2.7/tippy-light-border.css","RJ-2023-091_files/tippy-6.2.7/tippy.css","RJ-2023-091_files/tippy-6.2.7/tippy.umd.min.js","RJ-2023-091_files/webcomponents-2.0.0/webcomponents.js","RJ-2023-091.log","RJ-2023-091.pdf","RJ-2023-091.tex","RJ-2023-091.zip","RJournal.sty","RJwrapper.aux","RJwrapper.log","RJwrapper.out","RJwrapper.tex","Rlogo-5.png","Run231101.sh"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.25/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="' + slug + '.zip" class="dt-tag"><i class="fas fa-file-zipper"></i> Supplement</a>')

      // adds Abstract: in front of the first <p> in the title section --
      // unless it happens to be the subtitle (FIXME: this is a bad hack - can't distill do this?)
      var tpar = $("d-title p:not(:empty)").first();
      if (tpar && ! tpar.hasClass("subtitle")) {
        const abstract = $('<d-abstract>')
        abstract.append('<b>Abstract:</b><br>')
        abstract.append($("d-title p:not(:empty)").first()) // Move description to d-abstract
        $("d-title p:empty").remove() // Remove empty paragraphs after title
        abstract.append(buttons)
        abstract.insertAfter($('d-title')) // Add abstract section after title */
      }

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"A Comparison of R Tools for Nonlinear Least Squares Modeling","description":"Our Google Summer of Code project \"Improvements to `nls()`\" investigated rationalizing R tools for nonlinear regression and nonlinear estimation tools by considering usability, maintainability, and functionality, especially for a Gauss-Newton solver. <!-- JN: copyedit essentially accepted --> The rich features of `nls()` are weakened by several deficiencies and inconsistencies such as a lack of stabilization of the Gauss-Newton solver. Further considerations are the usability and  maintainability of the code base that provides the functionality `nls()` claims to offer. Various packages, including our `nlsr`, provide alternative capabilities. We consider the differences in goals, approaches, and features of different tools for nonlinear least squares modeling in R. Discussion of  these matters is relevant to improving R generally as well as its  nonlinear estimation tools.","doi":"10.32614/RJ-2023-091","authors":[{"author":"John C. Nash","authorURL":"#","affiliation":"retired professor, University of Ottawa","affiliationURL":"#","orcidID":"0000-0002-2762-8039"},{"author":"Arkajyoti Bhattacharjee","authorURL":"#","affiliation":"Indian Institute of Technology","affiliationURL":"#","orcidID":""}],"publishedDate":"2024-04-11T00:00:00.000+00:00","citationText":"Nash & Bhattacharjee, 2024"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues/2024-3">Current</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../submissions.html">Submit</a>
<a href="../../editors.html">Editorial board</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>A Comparison of R Tools for Nonlinear Least Squares Modeling</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Our Google Summer of Code project “Improvements to <code>nls()</code>” investigated rationalizing R tools for nonlinear regression and nonlinear estimation tools by considering usability, maintainability, and functionality, especially for a Gauss-Newton solver. <!-- JN: copyedit essentially accepted --> The rich features of <code>nls()</code> are weakened by several deficiencies and inconsistencies such as a lack of stabilization of the Gauss-Newton solver. Further considerations are the usability and maintainability of the code base that provides the functionality <code>nls()</code> claims to offer. Various packages, including our <code>nlsr</code>, provide alternative capabilities. We consider the differences in goals, approaches, and features of different tools for nonlinear least squares modeling in R. Discussion of these matters is relevant to improving R generally as well as its nonlinear estimation tools.</p></p>
</div>

<div class="d-byline">
  John C. Nash  (retired professor, University of Ottawa)
  
,   Arkajyoti Bhattacharjee  (Indian Institute of Technology)
  
<br/>2024-04-11
</div>

<div class="d-article">
<h2 data-number="1" id="the-nls-function"><span class="header-section-number">1</span> The <code>nls()</code> function</h2>
<p><code>nls()</code> is a Comprehensive R Archive Network (CRAN: <em><a href="https://cran.r-project.org" class="uri">https://cran.r-project.org</a></em>)
tool that has remarkable and wide-ranging features for estimating nonlinear
statistical models that are expressed as <strong>formulas</strong>.
<!-- JN: copyedit comment integrated -->
The function dates to the 1980s and the work related to <span class="citation" data-cites="bateswatts">Bates and Watts (<a href="#ref-bateswatts" role="doc-biblioref">1988</a>)</span> in S (see
<em><a href="https://en.wikipedia.org/wiki/S_%28programming_language%29" class="uri">https://en.wikipedia.org/wiki/S_%28programming_language%29</a></em>).</p>
<p>In particular, we
note that it</p>
<ul>
<li>can call calculations in other programming languages
<!-- JN: copyedit comment integrated --></li>
<li>allows weighted or subset data
<!-- JN: copyedit comment integrated --></li>
<li>can estimate bound-constrained parameters</li>
<li>provides partially linear model handling mechanism
<!-- JN: copyedit comment integrated --></li>
<li>permits parameters to be indexed over a set of related data</li>
<li>produces measures of variability (i.e., standard error estimates) for the
estimated parameters</li>
<li>has related profiling capabilities for exploring the likelihood surface as
parameters are changed</li>
<li>links to many pre-coded (<code>selfStart</code>) models that do not require
initial parameter values.</li>
</ul>
<p>Due to its extensive range of features and prolonged history, the code has become untidy and overly patched, making it challenging to maintain and ripe for improvement in its underlying methods.
<!-- JN: copyedit comment integrated --></p>
<h2 data-number="2" id="scope-of-our-comparison"><span class="header-section-number">2</span> Scope of our comparison</h2>
<p>Besides the base-R <code>nls()</code> function, we will pay particular attention
to <strong>nlsr</strong> (<span class="citation" data-cites="nlsr2023manual">Nash and Murdoch (<a href="#ref-nlsr2023manual" role="doc-biblioref">2023</a>)</span>),
<strong>minpack.lm</strong> (<span class="citation" data-cites="minpacklm12">Elzhov et al. (<a href="#ref-minpacklm12" role="doc-biblioref">2012</a>)</span>), and <strong>gslnls</strong> (<span class="citation" data-cites="gslnls23">Chau (<a href="#ref-gslnls23" role="doc-biblioref">2023</a>)</span>) which are
general nonlinear least-squares solvers in the CRAN repository.
While we will provide capsule comments for some other CRAN packages,
those in the Bioconductor (<span class="citation" data-cites="Bioconductor">Gentleman et al. (<a href="#ref-Bioconductor" role="doc-biblioref">2004</a>)</span>) collection are more
specialized, and those on repositories such as
GitHub (<a href="https://github.com" class="uri">https://github.com</a>) and Gitlab (<a href="https://about.gitlab.com" class="uri">https://about.gitlab.com</a>),
while interesting, do not have the checking applied to CRAN packages.
<!-- JN: revised text combining 2 copyedit comments --></p>
<!-- ## Principal messages -->
<!-- Ed: How does this relate to the comparisons? -->
<!-- JN: It is a precis of the content.  -->
<p>Our work aimed at unifying nonlinear modeling functionality in R,
<!-- JN: removed "was" as suggesgted -->
ideally in a refactored <code>nls()</code> function. The primary messages from this work
are:</p>
<ul>
<li><p>For R <strong>users</strong>, we would advise that it is most efficient to carry out
nonlinear modeling or least squares by adapting working scripts, preferably those
<!-- JN: added wording to clarify what we are advising users to do -->
with documentation and using recent tools. If there is a suspicion that there
may be ill-conditioning, package <code>nlsr</code> or the example we give in the
section “Comparison notes for formula-setup solutions” below of how to
find singular values of the Jacobian allow these diagnostics to be calculated.
<!-- JN: reference to section added ?have I done this correctly? --></p></li>
<li><p>For R <strong>developers</strong>, we invite and encourage discussion of the design choices,
since these
have downstream implications for ease of use, adaptation to new features, and
efficiency of ongoing maintenance.
<!-- JN: Could not understand how copyedit "such as" would be applied --></p></li>
</ul>
<h2 data-number="3" id="some-other-cran-packages-for-nonlinear-modeling"><span class="header-section-number">3</span> Some other CRAN packages for nonlinear modeling</h2>
<!-- JN: copyedit suggestion incorporated -->
<p><code>onls</code> (<span class="citation" data-cites="R-onls-manual">Spiess, Andrej-Nikolai (<a href="#ref-R-onls-manual" role="doc-biblioref">2022</a>)</span>) is used for optimising and estimating nonlinear models
by minimizing the sum of squares of <strong>orthogonal</strong> residuals rather than vertical
residuals. The objective is therefore different and involves nontrivial extra
calculation. A vignette with the package and the blog article
<a href="https://www.r-bloggers.com/2015/01/introducing-orthogonal-nonlinear-least-squares-regression-in-r/" class="uri">https://www.r-bloggers.com/2015/01/introducing-orthogonal-nonlinear-least-squares-regression-in-r/</a>
give some description with illustrative graphs. <code>onls</code> appears to be limited to
problems with one independent and one dependent variable. The Wikipedia article
<a href="https://en.wikipedia.org/wiki/Total_least_squares" class="uri">https://en.wikipedia.org/wiki/Total_least_squares</a> presents an overview of some
<!-- Ed. Anything specific from the Wikipedia article that is worth citing? -->
<!-- JN: Commentary would add too much material of tangential nature. -->
ideas, with references to the literature. The approach needs a wider
discussion and tutorial examples to allow its merits to be judged than can be
included here.</p>
<p><code>crsnls</code> (<span class="citation" data-cites="R-crsnls-manual">Tvrdík (<a href="#ref-R-crsnls-manual" role="doc-biblioref">2016</a>)</span>) – This package allows nonlinear estimation by
controlled random search via two methods. There is unfortunately no vignette.
A modest trial we carried out showed <code>nlsr::nlxb()</code> gave the same results in
a small fraction of the time required by either of the methods in <code>crsnls</code>. The
method discussed in <span class="citation" data-cites="tvrdik2007">Josef Tvrdík and Ivan Křivý and Ladislav Mišík (<a href="#ref-tvrdik2007" role="doc-biblioref">2007</a>)</span> claims better reliability in finding solutions
than a Levenberg-Marquardt code (actually from Matlab), but the tests were conducted
on the extreme NIST examples mentioned next.</p>
<p><code>NISTnls</code> (<span class="citation" data-cites="NISTnls-manual">Bates (<a href="#ref-NISTnls-manual" role="doc-biblioref">2012</a>)</span>) – This package provides R code and data for a set of
(numerically ill-conditioned) nonlinear least squares problems from the U.S. National
Institute for Standards and Technology. These may not represent real-world situations.</p>
<p><code>nlshelper</code> (<span class="citation" data-cites="nlshelper-manual">Duursma (<a href="#ref-nlshelper-manual" role="doc-biblioref">2017</a>)</span>) – This package, which unfortunately lacks a
vignette, provides a few utilities for summarizing, testing, and plotting
non-linear regression models estimated with nls(), nlsList() or nlme() that
are linked or grouped in some way.</p>
<p><code>nlsic</code> (<span class="citation" data-cites="nlsic22">Sokol (<a href="#ref-nlsic22" role="doc-biblioref">2022</a>)</span>) – This solves nonlinear least squares problems with optional
equality and/or inequality constraints. It is clearly not about modeling, and
the input and output are quite different from class <code>nls</code> methods. However, there do
not appear to be other R packages with these capabilities.</p>
<p><code>nlsMicrobio</code> (<span class="citation" data-cites="nlsMicrobio-manual">Baty and Delignette-Muller (<a href="#ref-nlsMicrobio-manual" role="doc-biblioref">2014</a>)</span>) – Data sets and nonlinear regression models
dedicated to predictive microbiology, including a vignette, by authors of the
<code>nlstools</code> package.</p>
<p><code>nlstools</code> (<span class="citation" data-cites="p-nlstools">Baty and Delignette-Muller (<a href="#ref-p-nlstools" role="doc-biblioref">2013</a>)</span>) – This package provides several tools for aiding the estimation
of nonlinear models, particularly using <code>nls()</code>. The vignette is actually a journal
article, and the authors have considerable experience in the subject.</p>
<p><code>nlsmsn</code> (<span class="citation" data-cites="m-nlsmsn">Prates et al. (<a href="#ref-m-nlsmsn" role="doc-biblioref">2021</a>)</span>) – Fit univariate non-linear scale mixture of skew-normal (NL-SMSN)
regression, with details in Garay, Lachos, and Abanto-Valle (2011). The problem
here is to minimize an objective that is modified from the traditional sum of squared
residuals.</p>
<p><code>nls.multstart</code> (<span class="citation" data-cites="nlsmultstart">Padfield and Matheson (<a href="#ref-nlsmultstart" role="doc-biblioref">2020</a>)</span>) – Non-linear least squares regression using
AIC scores with the Levenberg-Marquardt algorithm using multiple starting values
for increasing the chance that the minimum found is the global minimum.</p>
<p><code>nls2</code> (<span class="citation" data-cites="nls2-22">Grothendieck (<a href="#ref-nls2-22" role="doc-biblioref">2022</a>)</span>) – Nonlinear least squares by brute force has similar
motivations to <code>nls.multstart</code>, but uses <code>nls()</code> within multiple trials. The author
has extensive expertise in R.</p>
<p><code>nlstac</code> (<span class="citation" data-cites="m-nlstac">Rodriguez-Arias et al. (<a href="#ref-m-nlstac" role="doc-biblioref">2020</a>)</span>) – A set of functions implementing the algorithm described in
<span class="citation" data-cites="Torvisco2018">Torvisco et al. (<a href="#ref-Torvisco2018" role="doc-biblioref">2018</a>)</span> for fitting separable nonlinear regression curves. The
special class of problem for which this package is intended is an important and
difficult one. No vignette is provided, unfortunately.</p>
<p><code>easynls</code> – Fit and plot some nonlinear models. Thirteen models are treated, but
there is minimal documentation and no vignette. Package <code>nlraa</code> is to be preferred.</p>
<p><code>nlraa</code> (<span class="citation" data-cites="MiguezNLRAA2021">Miguez (<a href="#ref-MiguezNLRAA2021" role="doc-biblioref">2021</a>)</span>) – a set of nonlinear <em>selfStart</em> models, primarily from
agriculture. Most include analytic Jacobian code.</p>
<p><code>optimx</code> (<span class="citation" data-cites="p-optimx">Nash and Varadhan (<a href="#ref-p-optimx" role="doc-biblioref">2011</a>)</span>) – This provides
optimizers that can be applied to minimize a nonlinear function which could be
a nonlinear sum of squares. Not generally recommended if nonlinear
least squares programs can be easily used, but provides a check and alternative
solvers.</p>
<h2 data-number="4" id="an-illustrative-example"><span class="header-section-number">4</span> An illustrative example</h2>
<p>The Hobbs weed infestation problem (<span class="citation" data-cites="cnm79">Nash (<a href="#ref-cnm79" role="doc-biblioref">1979 120</a>)</span>) is a growth-curve modeling
task. Its very succinct statement
provides the “short reproducible example” much requested on R mailing lists.
The problem is small and seemingly straightforward, yet presents such
difficulties that optimization researchers have asked if it is contrived
rather than a real problem from a field researcher. The data and graph follow.
<!-- JN: merged copyedit comments to explain "nasty". --></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>weed</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5.308</span>, <span class='fl'>7.24</span>, <span class='fl'>9.638</span>, <span class='fl'>12.866</span>, <span class='fl'>17.069</span>, <span class='fl'>23.192</span>, <span class='fl'>31.443</span>,</span>
<span>          <span class='fl'>38.558</span>, <span class='fl'>50.156</span>, <span class='fl'>62.948</span>, <span class='fl'>75.995</span>, <span class='fl'>91.972</span><span class='op'>)</span></span>
<span><span class='va'>tt</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>12</span></span>
<span><span class='va'>weeddf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>tt</span>, <span class='va'>weed</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>weeddf</span>, main<span class='op'>=</span><span class='st'>"Hobbs weed infestation data"</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="RJ-2023-091_files/figure-html5/ex01-1.png" width="90%" /></p>
</div>
<!-- 231018: attempt to address comments in 2report1 on modeling vs least squares -->
<p>While model estimation is increasingly automated, nonlinear regression
should use background knowledge and graphs to obtain an understanding of
the general magnitude of the parameters. Indeed, the “visual fitting” approach
(<span class="citation" data-cites="nash1996nonlinear">Nash and Velleman (<a href="#ref-nash1996nonlinear" role="doc-biblioref">1996</a>)</span>) mentioned later accords with this viewpoint, as does use
of the <strong>Logistic3T</strong> variant of the model, as well as discussions in <span class="citation" data-cites="Ross90">Ross (<a href="#ref-Ross90" role="doc-biblioref">1990</a>)</span>,
<span class="citation" data-cites="Seber89Wild">Seber and Wild (<a href="#ref-Seber89Wild" role="doc-biblioref">1989</a>)</span>, <span class="citation" data-cites="bateswatts">Bates and Watts (<a href="#ref-bateswatts" role="doc-biblioref">1988</a>)</span>, and <span class="citation" data-cites="Gallant87">Gallant (<a href="#ref-Gallant87" role="doc-biblioref">1987</a>)</span>.
Our emphasis on the software resilience to starting parameters that are, in the
sense of statistical modeling, “silly” comes from over half a century of dealing
with users whose interests and understanding are very far from those of statistical
modelers. Thus, we seek methods and codes that obtain reasonable answers under
highly unfavourable conditions. Nevertheless, a proper approach to
nonlinear modeling is to apply all available knowledge to the task.
<!-- end 231018 work --></p>
<p>Three suggested models for this data are (with names to allow for easy reference)</p>
<p><strong>Logistic3U</strong>:
<span class="math display">\[  y \approx  b_1 / (1 + b_2 * exp(- b_3 * t)) \]</span></p>
<p><strong>Logistic3S</strong>:
<span class="math display">\[ y \approx  100 * c_1 / (1 + 10 * c_2 * exp(- 0.1 * c_3 * t)) \]</span></p>
<p><strong>Logistic3T</strong>:
<span class="math display">\[ y \approx Asym / (1 + exp((xmid - t)/scal)) \]</span></p>
<p>where we will use <code>weed</code> for <span class="math inline">\(y\)</span> and <code>tt</code> for <span class="math inline">\(t\)</span>.
The functions above are equivalent, but the first is generally more awkward
to solve numerically due to its poor scaling. The parameters of the three forms
are related as follows:</p>
<p><span class="math display">\[   Asym =  b_1 = 100 * c_1 \]</span>
<span class="math display">\[ exp(xmid/scal)  =  b_2 = 10 * c_2 \]</span>
<span class="math display">\[ 1/scal  =  b_3 = 0.1*c3 \]</span>
To allow for a simpler discussion, let us say that the parameters form a
<!-- add "a" -->
(named) vector
<span class="math inline">\(p\)</span> and the model function is called <span class="math inline">\(model(p)\)</span> with <span class="math inline">\(r = y - model(p)\)</span>.</p>
<p>We wish to minimize the sum of squared residuals, which is our loss (or objective) function.
Starting with some guess for the parameters, we aim to alter these parameters to obtain a smaller
loss function. We then iterate until we can make no further progress.</p>
<p>Let us consider there are <span class="math inline">\(n\)</span> parameters and <span class="math inline">\(m\)</span> residuals.
The loss function is
<span class="math display">\[ S(p) = r&#39; r = \sum_{i=1}^m { r_i^2 }\]</span>
The gradient of <span class="math inline">\(S(p)\)</span> is
<span class="math display">\[ g = 2 * J&#39; r\]</span>
where the Jacobian <span class="math inline">\(J\)</span> is given by elements
<span class="math display">\[ J_{i,j} = \partial r_i / \partial p_j \]</span>
and the Hessian is defined by elements
<span class="math display">\[ H_{i,j} = \partial ^2 S(p) / {\partial p_i \partial p_j} \]</span>
If we expand the Hessian for nonlinear least squares problems, we find
<span class="math display">\[  0.5 * H_{i,j} = \sum_{k = 1}^m{ J_{k,i} J_{k,j}}  + \sum_{k = 1}^m {r_k * \partial{r_k}/{\partial p_i \partial p_j}}\]</span>
Let us use <span class="math inline">\(D_{i,j}\)</span> for the elements of the second term of this expression.
What is generally called <strong>Newton’s method</strong> for function minimization tries
to set the gradient to zero (to find a stationary point of the function <span class="math inline">\(S(p)\)</span>).
This leads to <strong>Newton’s equation</strong>
<span class="math display">\[ H \delta = -g \]</span>
Given a set of parameters <span class="math inline">\(p\)</span>, we solve this equation for <span class="math inline">\(\delta\)</span>, adjust <span class="math inline">\(p\)</span>
to <span class="math inline">\(p + \delta\)</span> and iterate, hopefully to converge on a solution.
Applying this to a sum of squares problem gives
<span class="math display">\[ 0.5 * H \delta = (J&#39;J + D) \delta = - J&#39; r\]</span>
In this expression, only the elements of <span class="math inline">\(D\)</span> have second partial derivatives.
Gauss, attempting to model planetary orbits, had small residuals, and noted
that these multiplied the second partial derivatives of <span class="math inline">\(r\)</span>, so he approximated
<span class="math display">\[ 0.5 * H \approx J&#39; J\]</span>
by assuming <span class="math inline">\(D \approx 0\)</span>. This results in the Gauss-Newton method where we
solve
<span class="math display">\[ J&#39; J \delta = - J&#39; r\]</span>
though we can avoid some loss of accuracy by not forming the inner product matrix
<span class="math inline">\(J&#39; J\)</span> and solving the linear least squares matrix problem
<span class="math display">\[ J \delta \approx -r \]</span>
by one of several matrix decomposition methods.</p>
<p>In reality, there are many problems where <span class="math inline">\(D\)</span> should not be ignored, but the work
<!-- were to where -->
to compute it precisely is considerable. Many work-arounds have been
proposed, of which the Levenberg-Marquardt stabilization
(<span class="citation" data-cites="Levenberg1944">Levenberg (<a href="#ref-Levenberg1944" role="doc-biblioref">1944</a>)</span>, <span class="citation" data-cites="Marquardt1963">Marquardt (<a href="#ref-Marquardt1963" role="doc-biblioref">1963</a>)</span>) is
the most commonly used. For convenience, we will use “Marquardt”, as we believe he
first incorporated the ideas into a practical computer program.</p>
<p>The usual suggestion is that <span class="math inline">\(D\)</span> be replaced by a multiple of the unit matrix or else
a multiple of the diagonal part of <span class="math inline">\(J&#39; J\)</span>. In low precision, some elements of
<span class="math inline">\(J&#39; J\)</span> could underflow to zero (<span class="citation" data-cites="jn77ima">Nash (<a href="#ref-jn77ima" role="doc-biblioref">1977</a>)</span>), and a linear combination of both
choices is an effective compromise. Various choices for
<span class="math inline">\(D\)</span>, as well as a possible line search along the
direction <span class="math inline">\(\delta\)</span> rather than a unit step (<span class="citation" data-cites="Hartley1961">Hartley (<a href="#ref-Hartley1961" role="doc-biblioref">1961</a>)</span>),
give rise to several variant
algorithms. “Marquardt’s method” is a family of methods. Fortunately, most choices
work well.</p>
<h3 data-number="4.1" id="problem-setup"><span class="header-section-number">4.1</span> Problem setup</h3>
<p>Let us specify in R the three model formulas and set some starting
values for parameters. These starting points are not equivalent and
are deliberately crude choices. Workers performing many calculations
of a similar nature should try to provide good starting points to reduce
computation time and avoid finding a false solution.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># model formulas</span></span>
<span><span class='va'>frmu</span> <span class='op'>&lt;-</span> <span class='va'>weed</span> <span class='op'>~</span> <span class='va'>b1</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='va'>b2</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>b3</span> <span class='op'>*</span> <span class='va'>tt</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>frms</span> <span class='op'>&lt;-</span> <span class='va'>weed</span> <span class='op'>~</span> <span class='fl'>100</span> <span class='op'>*</span> <span class='va'>c1</span><span class='op'>/</span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fl'>10</span><span class='op'>*</span> <span class='va'>c2</span><span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.1</span> <span class='op'>*</span> <span class='va'>c3</span><span class='op'>*</span> <span class='va'>tt</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>frmt</span> <span class='op'>&lt;-</span> <span class='va'>weed</span> <span class='op'>~</span> <span class='va'>Asym</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>xmid</span> <span class='op'>-</span> <span class='va'>tt</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>scal</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='co'>#</span></span>
<span><span class='co'># Starting parameter sets</span></span>
<span><span class='va'>stu1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>b1 <span class='op'>=</span> <span class='fl'>1</span>, b2 <span class='op'>=</span> <span class='fl'>1</span>, b3 <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='va'>sts1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>c1 <span class='op'>=</span> <span class='fl'>1</span>, c2 <span class='op'>=</span> <span class='fl'>1</span>, c3 <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='va'>stt1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>Asym <span class='op'>=</span> <span class='fl'>1</span>, xmid <span class='op'>=</span> <span class='fl'>1</span>, scal <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>One of the useful features of <code>nls()</code> is the possibility of a <code>selfStart</code> model,
where starting parameter values are not required. However, if a <code>selfStart</code> model
is not available, <code>nls()</code> sets all the starting parameters
to 1. This is tolerable but could be improved by using a set of values
that are all slightly different, which, in the case of the example
model <span class="math inline">\(y \,\sim\, a \,*\, exp(-b \,*\, x) + c\,*\,exp(-d \,*\, x)\)</span>
would avoid a singular Jacobian because <span class="math inline">\(b\)</span> and <span class="math inline">\(d\)</span> were equal in value.
Program modifications to give a sequence like 1.0, 1.1, 1.2, 1.3 for the four
parameters are fairly obvious.</p>
<p>It is also possible to provide R functions for the residual and Jacobian.
This is usually much more work for the user if the formula setup is possible.
To illustrate, we show the functions for the unscaled 3 parameter logistic.
<!-- 231018: added a note to explain deficiencies -->
The particular form of these explicit residual and Jacobian functions comes from
their translation from BASIC codes of the 1970s, as adapted in <span class="citation" data-cites="jnmws87">Nash and Walker-Smith (<a href="#ref-jnmws87" role="doc-biblioref">1987</a>)</span>. The use
of the Laplace form of the residual and the inclusion of data within the functions
reflects choices of that era that are at odds with current practice. Some users
still want or need to provide problems as explicit functions, particularly
for problems that are not regressions. For example, the Rosenbrock banana-valley
test problem can be provided this way, where the two “residuals” are different
functional forms.</p>
<!-- 231018: removed "this variant uses looping" -->
<!-- Added note on form of the residual. See Stigler (1986) -->
<!--   History of Statistics pg.34 -->
<!-- Note: UNscaled, not scaled -->
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Logistic3U</span></span>
<span><span class='va'>hobbs.res</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>{</span> <span class='co'># unscaled Hobbs weeds problem -- residual</span></span>
<span>  <span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>!=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"hobbs.res -- parameter vector n!=3"</span><span class='op'>)</span></span>
<span>  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5.308</span>, <span class='fl'>7.24</span>, <span class='fl'>9.638</span>, <span class='fl'>12.866</span>, <span class='fl'>17.069</span>, <span class='fl'>23.192</span>, <span class='fl'>31.443</span>, </span>
<span>           <span class='fl'>38.558</span>, <span class='fl'>50.156</span>, <span class='fl'>62.948</span>, <span class='fl'>75.995</span>, <span class='fl'>91.972</span><span class='op'>)</span></span>
<span>  <span class='va'>tt</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>12</span></span>
<span>  <span class='va'>res</span> <span class='op'>&lt;-</span> <span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span> <span class='op'>*</span> <span class='va'>tt</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-</span> <span class='va'>y</span></span>
<span>  <span class='co'># Note: this form of the residual, from Laplace (1788) in the form</span></span>
<span>  <span class='co'># of "fitted - observed" has been used in our software for half</span></span>
<span>  <span class='co'># a century, but sometimes concerns users of the more traditional</span></span>
<span>  <span class='co'># "observed - fitted" form</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>hobbs.jac</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span> <span class='co'># unscaled Hobbs weeds problem -- Jacobian</span></span>
<span>  <span class='va'>jj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0.0</span>, <span class='fl'>12</span>, <span class='fl'>3</span><span class='op'>)</span></span>
<span>  <span class='va'>tt</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>12</span></span>
<span>  <span class='va'>yy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span> <span class='op'>*</span> <span class='va'>tt</span><span class='op'>)</span></span>
<span>  <span class='va'>zz</span> <span class='op'>&lt;-</span> <span class='fl'>1.0</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>*</span> <span class='va'>yy</span><span class='op'>)</span></span>
<span>  <span class='va'>jj</span><span class='op'>[</span><span class='va'>tt</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>zz</span></span>
<span>  <span class='va'>jj</span><span class='op'>[</span><span class='va'>tt</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>*</span> <span class='va'>zz</span> <span class='op'>*</span> <span class='va'>zz</span> <span class='op'>*</span> <span class='va'>yy</span></span>
<span>  <span class='va'>jj</span><span class='op'>[</span><span class='va'>tt</span>, <span class='fl'>3</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>*</span> <span class='va'>zz</span> <span class='op'>*</span> <span class='va'>zz</span> <span class='op'>*</span> <span class='va'>yy</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>*</span> <span class='va'>tt</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>jj</span>, <span class='st'>"gradient"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='va'>jj</span></span>
<span>  <span class='va'>jj</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<h2 data-number="5" id="estimation-of-models-specified-as-formulas"><span class="header-section-number">5</span> Estimation of models specified as formulas</h2>
<p>Using a formula specification was a principal advantage made
with <code>nls()</code> when it became available in S sometime in the 1980s. It uses a
Gauss-Newton (i.e., unstabilized) iteration with a step reduction line
search. This works very efficiently as long as <span class="math inline">\(J\)</span> is not ill-conditioned.
Below we see <code>nls()</code> does poorly on the example problem. To save page space,
we use 1-line result display functions from package <code>nlsr</code>, namely <code>pnls()</code>
and <code>pshort()</code>.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>Error in nls(formula = frmu, start = stu1, data = weeddf) : 
  singular gradient</code></pre>
<pre><code>Error in nls(formula = frms, start = sts1, data = weeddf) : 
  singular gradient</code></pre>
<pre><code>Error in nls(formula = frmt, start = stt1, data = weeddf) : 
  singular gradient</code></pre>
</div>
<p>Here we see the infamous “singular gradient” termination message of <code>nls()</code>.
<!-- Added comment to point out selfStart should be used. -->
Users should, of course, be using the <code>SSlogis</code> <em>selfStart</em> tool, but ignorance
of this possibility or a slight variant in the model can easily lead to outcomes
similar to those seen here.
<!-- End added comment --></p>
<h3 data-number="5.1" id="solution-attempts-with-nlsr"><span class="header-section-number">5.1</span> Solution attempts with nlsr</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code>unlx1:residual sumsquares =  2.5873  on  12 observations
    after  19    Jacobian and  25 function evaluations
  name            coeff          SE       tstat      pval      gradient    JSingval   
b1               196.186         11.31      17.35  3.167e-08  -4.859e-09        1011  
b2               49.0916         1.688      29.08  3.284e-10  -3.099e-08      0.4605  
b3               0.31357      0.006863      45.69  5.768e-12   2.305e-06     0.04714  </code></pre>
<pre><code>snlx1  -- ss= 2.5873 :  c1 = 1.9619  c2 = 4.9092  c3 = 3.1357; 34 res/ 23 jac</code></pre>
<pre><code>tnlx1  -- ss= 2.5873 :  Asym = 196.19  xmid = 12.417  scal = 3.1891; 36 res/ 27 jac</code></pre>
</div>
<p>Though we have found solutions, the Jacobian is essentially singular as
shown by its singular
values. Note that these are displayed by package <code>nlsr</code> in a single column in
the output to provide a compact layout, but the values do not correspond to
the individual parameters in
whose row they appear; they are a property of the whole problem.</p>
<h3 data-number="5.2" id="solution-attempts-with-minpack.lm"><span class="header-section-number">5.2</span> Solution attempts with minpack.lm</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code>unlm1  -- ss= 2.5873 :  b1 = 196.19  b2 = 49.092  b3 = 0.31357; 17  itns</code></pre>
<pre><code>snlm1  -- ss= 2.5873 :  c1 = 1.9619  c2 = 4.9092  c3 = 3.1357; 7  itns</code></pre>
<pre><code>Error in nlsModel(formula, mf, start, wts) : 
  singular gradient matrix at initial parameter estimates</code></pre>
</div>
<h3 data-number="5.3" id="solution-attempts-with-gslnls"><span class="header-section-number">5.3</span> Solution attempts with gslnls</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code>ugslnls1  -- ss= 2.5873 :  b1 = 196.19  b2 = 49.092  b3 = 0.31357; 25  itns</code></pre>
<pre><code>sgslnls1  -- ss= 2.5873 :  c1 = 1.9619  c2 = 4.9092  c3 = 3.1357; 9  itns</code></pre>
<pre><code>tgslnls1  -- ss= 9205.4 :  Asym = 35.532  xmid = 20846  scal = -1745.2; 47  itns</code></pre>
</div>
<h3 data-number="5.4" id="comparison-notes-for-formula-setup-solutions"><span class="header-section-number">5.4</span> Comparison notes for formula-setup solutions</h3>
<p><code>nlsr::nlxb()</code> uses <code>print()</code> to output standard errors and
singular values of the Jacobian (for diagnostic purposes). By contrast,
<code>minpack.lm::nlsLM()</code> and <code>nls()</code>
use <code>summary()</code>, which does not display the sum of squares, while <code>print()</code>
gives the sum of squares, but not the standard error of the residuals.</p>
<p>The singular values allow us to gauge how “nearly singular” the
Jacobian is at the solution, and the ratio of the smallest to largest of the
singular values is a simple but effective measure. The ratios are
4.6641e-05 for Logistic3U, 0.021022 for Logistic3S, and 0.001055 for
Logistic3T, so Logistic3S is the “least singular”.</p>
<p>The results from <code>nlsLM</code> and <code>gsl_nls</code> for the transformed model Logistic3T have a very
large sum of squares, which may suggest that these programs have failed.
Since <code>nls()</code>, <code>nlsLM()</code>, and <code>gsl_nls()</code> do not
offer singular values, we need to extract the Jacobian and compute its
singular values. The following script shows how to do this, using as Jacobian what is called
the <code>gradient</code> element in the returned solution for these solvers.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># for nlsLM</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>tnlm1</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>{</span></span>
<span>   <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Cannot compute solution -- likely singular Jacobian"</span><span class='op'>)</span></span>
<span> <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>  </span>
<span>   <span class='va'>JtnlsLM</span> <span class='op'>&lt;-</span> <span class='va'>tnlm1</span><span class='op'>$</span><span class='va'>m</span><span class='op'>$</span><span class='fu'>gradient</span><span class='op'>(</span><span class='op'>)</span> <span class='co'># actually the Jacobian</span></span>
<span>   <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span><span class='op'>(</span><span class='va'>JtnlsLM</span><span class='op'>)</span><span class='op'>$</span><span class='va'>d</span> <span class='co'># Singular values</span></span>
<span><span class='op'>}</span>   </span></code></pre>
</div>
<pre><code>[1] &quot;Cannot compute solution -- likely singular Jacobian&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># for gsl_nls</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>tgslnls1</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>   <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Cannot compute solution -- likely singular Jacobian"</span><span class='op'>)</span></span>
<span><span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>  </span>
<span>   <span class='va'>JtnlsLM</span> <span class='op'>&lt;-</span> <span class='va'>tgslnls1</span><span class='op'>$</span><span class='va'>m</span><span class='op'>$</span><span class='fu'>gradient</span><span class='op'>(</span><span class='op'>)</span></span>
<span>   <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span><span class='op'>(</span><span class='va'>JtnlsLM</span><span class='op'>)</span><span class='op'>$</span><span class='va'>d</span> <span class='co'># Singular values</span></span>
<span><span class='op'>}</span>   </span></code></pre>
</div>
<pre><code>[1] 3.4641e+00 9.8541e-09 3.8249e-11</code></pre>
</div>
<p>We see that there are differences in detail, but the more important result is that
two out of three singular values are essentially 0. Our Jacobian is singular, and no
method of the Gauss-Newton type should be able to continue. Indeed, from the parameters
reported at this saddle point, <code>nlsr::nlxb()</code> cannot proceed.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>stspecial</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>Asym <span class='op'>=</span> <span class='fl'>35.532</span>,  xmid <span class='op'>=</span> <span class='fl'>43376</span>,  scal <span class='op'>=</span> <span class='op'>-</span><span class='fl'>2935.4</span><span class='op'>)</span></span>
<span><span class='va'>badstart</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'>nlxb</span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>frmt</span>, start <span class='op'>=</span> <span class='va'>stspecial</span>, data <span class='op'>=</span> <span class='va'>weeddf</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>badstart</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>badstart</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>residual sumsquares =  9205.4  on  12 observations
    after  2    Jacobian and  2 function evaluations
  name            coeff          SE       tstat      pval      gradient    JSingval   
Asym             35.5321            NA         NA         NA  -9.694e-09       3.464  
xmid               43376            NA         NA         NA  -1.742e-09    2.61e-10  
scal             -2935.4            NA         NA         NA    -2.4e-08    7.12e-16  </code></pre>
</div>
<h2 data-number="6" id="functional-specification-of-problems"><span class="header-section-number">6</span> Functional specification of problems</h2>
<p>We illustrate how to solve nonlinear least squares problems using
a function to define the residual. Note that <code>gsl_nls()</code> requires
a vector <code>y</code> that is the length of the vector returned by the
function supplied, e.g., <code>hobbs.res()</code>. <code>gsl_nls</code> uses
a numerical approximation for the Jacobian if the argument <code>jac</code>
is missing. Note function <code>nlsr::pnlslm()</code> for a 1-line display of
the results of <code>minpack.lm::nls.lm()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre><code>hobnlfb&lt;-nlfb(start=stu1, resfn=hobbs.res, jacfn=hobbs.jac)</code></pre>
<pre><code>hobnlfb  -- ss= 2.5873 :  b1 = 196.19  b2 = 49.092  b3 = 0.31357; 25 res/ 19 jac</code></pre>
<pre><code>hobnlm&lt;-nls.lm(par=stu1, fn=hobbs.res, jac=hobbs.jac)</code></pre>
<pre><code>hobnlm  -- ss= 2.5873 :  b1 = 196.19  b2 = 49.092  b3 = 0.31357; 17  itns</code></pre>
<pre><code>hobgsln&lt;-gsl_nls(start=stu1, fn=hobbs.res, y=rep(0,12))</code></pre>
<pre><code>hobgsln  -- ss= 2.5873 :  b1 = 196.19  b2 = 49.092  b3 = 0.31357; 25  itns</code></pre>
<pre><code>hobgsl&lt;-gsl_nls(start=stu1, fn=hobbs.res, y=rep(0,12), jac=hobbs.jac)</code></pre>
<pre><code>hobgsl  -- ss= 2.5873 :  b1 = 196.19  b2 = 49.092  b3 = 0.31357; 25  itns</code></pre>
</div>
<h2 data-number="7" id="design-goals-termination-tests-and-output-objects"><span class="header-section-number">7</span> Design goals, termination tests, and output objects</h2>
<p>The output object of <code>nlxb()</code> is smaller than the class <code>nls</code> object returned
by <code>nls()</code>, <code>nlsLM()</code>, and <code>gsl_nls()</code>. Package <code>nlsr</code> emphasizes the solution
of the nonlinear least squares problem rather than the estimation of a nonlinear
model that fits or explains the data. The object of class <code>nls</code> allows for
a number of specialized modeling and diagnostic extensions. For compatibility,
the <code>nlsr</code> package has the function <code>wrapnlsr()</code>, for which <code>nlsr()</code> is an alias.
This uses <code>nlxb()</code> to find good parameters, then calls <code>nls()</code> to return the class
<code>nls</code> object. Unless particular modeling features are needed, the use of
<code>wrapnlsr()</code> is unnecessary and wasteful of resources.</p>
<p>The design goals of the different tools may also be revealed in the so-called
“convergence tests” for the iterative solvers. In the manual page for <code>nls()</code>
in R 4.0.0, there was the warning:<br />
&gt; <em>Do not use <code>nls</code> on artificial “zero-residual” data</em><br />
<!-- Used double space to force linefeed -->
with the suggested addition of small perturbations to the data. This admits
<code>nls()</code> could not solve well-posed problems unless data is polluted
with errors. Zero-residual problems are not always artificial,
since problems in function approximation and nonlinear equations can be
approached with nonlinear least squares. Fortunately, a small adjustment
to the “termination test” for the program, rather than for the
“convergence” of the underlying algorithm, fixes the defect. The test
is the Relative Offset Convergence
Criterion (see <span class="citation" data-cites="BatesWatts81">Bates and Watts (<a href="#ref-BatesWatts81" role="doc-biblioref">1981</a>)</span>). This scales an estimated reduction in the loss
function by its current value. If the loss function is very small, we are close
to a zero-divide. Adding a small quantity to the divisor avoids trouble.
In 2021, one of us (J. Nash) proposed that <code>nls.control()</code> have an
additional parameter <code>scaleOffset</code> with a default value of zero. Setting it to a
small number – 1.0 is a reasonable choice – allows small-residual problems
(i.e., near-exact fits) to be dealt with easily. We call this the
<strong>safeguarded relative offset convergence criterion</strong>, and it has been in <code>nlsr</code>
since it was introduced. The default value
gives the legacy behavior. This improvement has been in the R distributed code
since version 4.1.0.</p>
<p>Additional termination tests can be used. <code>nlsr</code> has a <strong>small sum of
squares</strong> test (<strong>smallsstest</strong>) that compares the latest evaluated sum of squared
(weighted) residuals to <code>e4</code> times the initial sum of squares, where
<code>e4 &lt;- (100*.Machine$double.eps)^4</code> is approximately 2.43e-55.</p>
<p>Termination after what may be considered excessive computation is also important.
<code>nls()</code> stops after <code>maxiter</code> “iterations”. The meaning of “iteration” may require an
examination of the code for the different algorithms. <code>nlsr</code> terminates execution
when the number of residual or Jacobian evaluations exceed set limits. Generally,
we prefer larger limits than the default <code>maxiter = 50</code> of <code>nls()</code> to avoid stopping
early, though this may result in some unnecessary computations.</p>
<h3 data-number="7.1" id="returned-results-of-nls-and-other-tools"><span class="header-section-number">7.1</span> Returned results of nls() and other tools</h3>
<p>As mentioned, the output of <code>nls()</code>, <code>minpack.lm::nlsLM()</code>, or
<code>gslnls::gsl_nls()</code> is an object of class “nls” which has a quite rich structure
described in the manual files or revealed by applying the <code>str()</code> function to the
result of <code>nls()</code>. The complexity of this object is a challenge to users. Let us
use for example <code>result &lt;- snlm1</code> as the returned object from <code>nlsLM()</code> for the
Logistic3S problem. The <code>data</code> return element
is an R symbol. To actually access the data from this element, we need to use
the syntax:</p>
<pre><code>eval(parse(text = result$data))</code></pre>
<p>However, if the call is made with <code>model = TRUE</code>, then there is a returned element
<code>model</code> which contains the data, and we can list its contents using:</p>
<pre><code>ls(result$model)</code></pre>
<p>and if there is an element called <code>xdata</code>, then it can be accessed as
<code>result$model$xdata</code>.</p>
<p>By contrast, <code>nlsr::nlxb()</code> returns a much simpler structure of 11 items
in one level. Moreover, <code>nlxb</code> explicitly returns the sum of squares, the residual vector, Jacobian, and counts of evaluations.</p>
<h3 data-number="7.2" id="when-to-compute-ancillary-information"><span class="header-section-number">7.2</span> When to compute ancillary information</h3>
<p>Tools that produce a class <code>nls</code> output object create a rich set of functions
and structures that are then used in a variety of modeling tasks, including the
least squares solution. By contrast,
<code>nlsr</code> computes quantities as they are requested or needed, with additional
features in separate functions. For example, the singular values of the Jacobian
are actually computed in the <code>print</code> and <code>summary</code> methods for the result.
These two approaches
lead to different consequences for performance and how features are
provided. <code>nlsr</code> has antecedents in the methods of <span class="citation" data-cites="cnm79">Nash (<a href="#ref-cnm79" role="doc-biblioref">1979</a>)</span>, where storage for
data and programs was at a ridiculous premium in the small computers of the era.
Thus, the code in <code>nlsr</code> is likely of value for workers to copy and modify
for customized tools.</p>
<h2 data-number="8" id="jacobian-calculation"><span class="header-section-number">8</span> Jacobian calculation</h2>
<p>Gauss-Newton/Marquardt methods all need a Jacobian matrix at each iteration.
By default, <code>nlsr::nlxb()</code> will try to evaluate this using analytic
expressions using symbolic and automatic differentiation tools.
When using a formula specification of the model, <code>nls()</code>, <code>minpack.lm::nlsLM()</code>
and <code>gslnls::gsl_nls()</code> use a finite difference approximation to compute the
Jacobian, though <code>gsl_nls()</code> does have an option to attempt symbolic expressions.
Package <code>nlsr</code> provides, via appropriate calling syntax, four numeric approximation
options for the Jacobian, with a further control <code>ndstep</code> for the size of the
step used in the approximation. These options allow programming choices to be
examined. Users can largely ignore them.</p>
<p>Using the “gradient” attribute of the output of the Jacobian function to hold
the Jacobian matrix lets us embed this in the residual function as well,
so that the call to <code>nlsr::nlfb()</code> can be made with the same name used for
both residual and Jacobian function arguments. This programming trick saves a
lot of trouble for the package developer, but it can be a nuisance for users
trying to understand the code.</p>
<p>As far as we can understand the logic in <code>nls()</code>, the Jacobian computation during
parameter estimation is carried out within the called C-language program
and its wrapper R code function <code>numericDeriv()</code>, part of
<code>./src/library/stats/R/nls.R</code>
in the R distribution source code. This is used to provide Jacobian information in
the <code>nlsModel()</code> and <code>nlsModel.plinear()</code> functions, which are not exported for
general use. <code>gsl_nls()</code> also appears to use <code>numericDeriv()</code>.</p>
<p><code>numericDeriv()</code> uses a
simple forward difference approximation of derivatives, though a central
difference approximation can be specified in control parameters.
We are unclear why <code>numericDeriv()</code> in base R calls <code>C_numeric_deriv</code>,
as we were easily able to create a more compact version entirely in R.
See <em><a href="https://github.com/nashjc/RNonlinearLS/tree/main/DerivsNLS" class="uri">https://github.com/nashjc/RNonlinearLS/tree/main/DerivsNLS</a></em>.</p>
<p><code>minpack.lm::nlsLM()</code> invokes <code>numericDeriv()</code> in its local
version of <code>nlsModel()</code>, but it appears to use an internal approximate Jacobian
code from
the original Fortran <code>minpack</code> code, namely, <code>lmdif.f</code>. Such differences in approach
can lead to different behavior, usually minor, but sometimes annoying with
ill-conditioned problems.</p>
<ul>
<li><p>A pasture regrowth problem (<span class="citation" data-cites="Huet2004">Huet et al. (<a href="#ref-Huet2004" role="doc-biblioref">2004</a>)</span>, page 1, based on <span class="citation" data-cites="Ratkowsky1983">Ratkowsky (<a href="#ref-Ratkowsky1983" role="doc-biblioref">1983</a>)</span>) has a
poorly conditioned Jacobian and <code>nls()</code> fails with “singular gradient”.
Worse, numerical approximation to the Jacobian gives the error
“singular gradient matrix at initial parameter estimates” for <code>minpack.lm::nlsLM</code>
so that the Marquardt stabilization is unable to take effect, while the analytic
derivatives of <code>nlsr::nlxb</code> give a solution.</p></li>
<li><p>Karl Schilling (private communication) provided an example where a model specified
with the formula <code>y ~ a * (x ˆ b)</code> causes <code>nlsr::nlxb</code> to fail because the partial
derivative w.r.t. <code>b</code> is <code>a * (x ^ b * log(x))</code>. If there is data for which <code>x = 0</code>,
the derivative is undefined, but the model can be computed. In such cases,
we observed that <code>nls()</code> and
<code>minpack.lm::nlsLM</code> found a solution, though this seems to be a lucky accident.</p></li>
</ul>
<h3 data-number="8.1" id="jacobian-code-in-selfstart-models"><span class="header-section-number">8.1</span> Jacobian code in selfStart models</h3>
<p>Analytic Jacobian code can be provided to all the solvers discussed.
Most <code>selfStart</code> models that automatically provide starting parameters
also include such code. There is documentation in R
of <code>selfStart</code> models, but their construction is non-trivial. A number
of such models are included with base R in <code>./src/library/stats/R/zzModels.R</code>,
with package <code>nlraa</code> (<span class="citation" data-cites="MiguezNLRAA2021">Miguez (<a href="#ref-MiguezNLRAA2021" role="doc-biblioref">2021</a>)</span>) providing a richer set.
There are also some in the now-archived package <code>NRAIA</code>.
These provide the Jacobian in the “gradient” attribute of the “one-sided” formula
that defines each model, and these Jacobians are often the analytic forms.</p>
<p>The <code>nls()</code> function, after
computing the “right-hand side” or <code>rhs</code> of the residual, checks to see if the
“gradient” attribute is defined, otherwise using <code>numericDeriv()</code> to compute a
Jacobian into that attribute. This code is within the <code>nlsModel()</code> or
<code>nlsModel.plinear()</code> functions. The use of analytic Jacobians
almost certainly contributes to the good performance of <code>nls()</code> on <code>selfStart</code>
models.</p>
<p>The use of <code>selfStart</code> models with
<code>nlsr</code> is described in the “Introduction to nlsr” vignette. However, since <code>nlsr</code>
generally can use very crude starting values, we have rarely needed them, though
it should be pointed out that our work is primarily diagnostic. If we were carrying
out a large number of similar estimations, such initial parameters are
critical to efficiency.</p>
<p>In considering <code>selfStart</code> models, we noted that the base-R function <code>SSlogis</code>
is intended to solve problem <strong>Logistic3T</strong> above. When this function is used
via <code>getInitial()</code> to find
starting values, it actually calls <code>nls()</code> with the ‘plinear’ algorithm
and finds a (full) solution. It then passes the solution coefficients to the default
algorithm unnecessarily. Moreover, the implicit double call is, in our view, prone to creating
errors in code maintenance.
To provide simpler starting parameters, the function <code>SSlogisJN</code>
is now part of the package <code>nlsr</code>, but is most useful for <code>nls()</code>.</p>
<p>Users may also want to profit from the Jacobian code of <code>selfStart</code> models
but supply explicit starting values other than those suggested by <code>getInitial()</code>.
This does not appear to be possible with <code>nls()</code>. <code>nlsr::nlxb()</code> always requires
starting parameters, and can either use <code>getInitial()</code> to find them from the <code>selfStart</code>
model or provide explicit values, but the formula used in the call to <code>nlxb()</code>
still involves the <code>selfStart</code> function.</p>
<!-- tssx <-try(nls(weed ~ SSlogis(tt, Asym, xmid, scale), start=stt1, data=weeddf)) -->
<!-- tssx <-try(nls(weed ~ SSlogis(tt, Asym=1, xmid=1, scale=1),  data=weeddf)) -->
<!-- tssx <-try(nls(weed ~ SSlogis(tt, Asym, xmid, scale),  data=weeddf))summary(tssx) -->
<p>We are also surprised that the
analytic expressions for the Jacobian (“gradient”) in the <code>SSLogis</code> function
and others save quantities in “hidden”
variables, i.e., with names preceded by “.”.
These are then not displayed by the <code>ls()</code>
command, making them difficult to access by users who may wish to create
their own <code>selfStart</code> model via copy and edit.
Interactive tools, such as “visual fitting” (<span class="citation" data-cites="nash1996nonlinear">Nash and Velleman (<a href="#ref-nash1996nonlinear" role="doc-biblioref">1996</a>)</span>) might be
worth considering as another way to find starting parameters, but we know of no
R capability of this type.</p>
<p>As a side note, the introduction of <code>scaleOffset</code> in R 4.1.1 to deal with the
convergence test for small residual problems now requires that the <code>getInitial()</code>
function have dot-arguments (<code>...</code>) in its argument list. This illustrates the
entanglement of many features in <code>nls()</code> that complicate its maintenance and
improvement.</p>
<h2 data-number="9" id="bounds-constraints-on-parameters"><span class="header-section-number">9</span> Bounds constraints on parameters</h2>
<p>For many problems, we know that parameters cannot be bigger or smaller than some
externally known limits. Such limits should be built into models, but there
are some important details for using the tools in R.</p>
<ul>
<li><p><code>nls()</code> can only impose bounds if the <code>algorithm = "port"</code> argument is
used in the call. Unfortunately, the documentation warns us:</p>
<p><em>The algorithm = “port” code appears unfinished, and does not even
check that the starting value is within the bounds. Use with
caution, especially where bounds are supplied.</em></p></li>
<li><p><code>gsl_nls()</code> does not offer bounds.</p></li>
<li><p>bounds are part of the default method for package <code>nlsr</code>.</p></li>
<li><p><code>nlsLM()</code> includes bounds in the standard call, but we have observed cases
where it fails to get the correct answer. From an examination of the code,
we believe the authors have not taken into account all possibilities, though
all programs have some weakness regarding constrained optimization in that
programmers have to work with assumptions on the scale of numbers,
and some problems will be outside the scope envisaged.</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Start MUST be feasible i.e. on or within bounds</span></span>
<span><span class='va'>anlshob1b</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>frms</span>, start <span class='op'>=</span> <span class='va'>sts1</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>,</span>
<span>             upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>6</span>,<span class='fl'>3</span><span class='op'>)</span>, algorithm <span class='op'>=</span> <span class='st'>'port'</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anlshob1b</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'>pnls</span><span class='op'>(</span><span class='va'>anlshob1b</span><span class='op'>)</span> <span class='co'>#  check the answer (short form)</span></span></code></pre>
</div>
<pre><code>anlshob1b  -- ss= 9.4726 :  c1 = 2  c2 = 4.4332  c3 = 3; 12  itns</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># nlsLM seems NOT to work with bounds in this example</span></span>
<span><span class='va'>anlsLM1b</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'>nlsLM</span><span class='op'>(</span><span class='va'>frms</span>, start <span class='op'>=</span> <span class='va'>sts1</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>, upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>6</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anlsLM1b</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'>pnls</span><span class='op'>(</span><span class='va'>anlsLM1b</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>anlsLM1b  -- ss= 881.02 :  c1 = 2  c2 = 6  c3 = 3; 2  itns</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># also no warning if starting out of bounds, but gets a good answer!!</span></span>
<span><span class='va'>st4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>c1 <span class='op'>=</span> <span class='fl'>4</span>, c2 <span class='op'>=</span> <span class='fl'>4</span>, c3 <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span><span class='va'>anlsLMob</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'>nlsLM</span><span class='op'>(</span><span class='va'>frms</span>, start <span class='op'>=</span> <span class='va'>st4</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>, upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>6</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anlsLMob</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'>pnls</span><span class='op'>(</span><span class='va'>anlsLMob</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>anlsLMob  -- ss= 9.4726 :  c1 = 2  c2 = 4.4332  c3 = 3; 4  itns</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Try nlsr::nlxb()</span></span>
<span><span class='va'>anlx1b</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'>nlxb</span><span class='op'>(</span><span class='va'>frms</span>, start <span class='op'>=</span> <span class='va'>sts1</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>, upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>6</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anlx1b</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'>pshort</span><span class='op'>(</span><span class='va'>anlx1b</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>anlx1b  -- ss= 9.4726 :  c1 = 2  c2 = 4.4332  c3 = 3; 12 res/ 12 jac</code></pre>
</div>
<h3 data-number="9.1" id="philosophical-considerations"><span class="header-section-number">9.1</span> Philosophical considerations</h3>
<p>Bounds on parameters raise some interesting questions about how
uncertainty in parameter estimates should be computed or reported. That is, the
traditional “standard errors” are generally taken to imply symmetric intervals about
the point estimate in which the parameter may be expected to be found with some
probability under certain assumptions.
Bounds change those assumptions and hence the interpretation of estimates of
uncertainty, whether by traditional approximations from the <span class="math inline">\(J&#39; J\)</span> matrix or from methods
such as profile likelihood or bootstrap. At the time of writing,
<code>nlsr::nlxb()</code> does not compute standard errors nor their derived statistics
when bounds are active to avoid providing misleading information.</p>
<h3 data-number="9.2" id="fixed-parameters-masks"><span class="header-section-number">9.2</span> Fixed parameters (masks)</h3>
<p>Let us try to fix (mask) the first parameter in the first two example problems.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Hobbsmaskx.R -- masks with formula specification of the problem</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'>nlsr</span><span class='op'>)</span>; <span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'>minpack.lm</span><span class='op'>)</span>; <span class='va'>traceval</span> <span class='op'>&lt;-</span> <span class='cn'>FALSE</span></span>
<span><span class='va'>stu</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>b1 <span class='op'>=</span> <span class='fl'>200</span>, b2 <span class='op'>=</span> <span class='fl'>50</span>, b3 <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='co'># a default starting vector (named!)</span></span>
<span><span class='va'>sts</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>c1 <span class='op'>=</span> <span class='fl'>2</span>, c2 <span class='op'>=</span> <span class='fl'>5</span>, c3 <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='co'># a default scaled starting vector (named!)</span></span>
<span><span class='co'># fix first parameter</span></span>
<span><span class='va'>anxbmsk1</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/nlsr/man/nlxb.html'>nlxb</a></span><span class='op'>(</span><span class='va'>frmu</span>, start <span class='op'>=</span> <span class='va'>stu</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>200</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span>, </span>
<span>      upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>200</span>, <span class='fl'>60</span>, <span class='fl'>3</span><span class='op'>)</span>, trace<span class='op'>=</span><span class='va'>traceval</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anxbmsk1</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>anxbmsk1</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>residual sumsquares =  2.6182  on  12 observations
    after  4    Jacobian and  4 function evaluations
  name            coeff          SE       tstat      pval      gradient    JSingval   
b1                   200U M         NA         NA         NA           0          NA  
b2               49.5108          1.12      44.21  8.421e-13  -2.887e-07        1022  
b3              0.311461      0.002278      136.8  1.073e-17   0.0001635      0.4569  </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>anlM1</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/minpack.lm/man/nlsLM.html'>nlsLM</a></span><span class='op'>(</span><span class='va'>frmu</span>, start <span class='op'>=</span> <span class='va'>stu</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>200</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span>, </span>
<span>      upper<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>200</span>, <span class='fl'>60</span>, <span class='fl'>3</span><span class='op'>)</span>, trace <span class='op'>=</span> <span class='va'>traceval</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anlM1</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/pkg/nlsr/man/pnls.html'>pnls</a></span><span class='op'>(</span><span class='va'>anlM1</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>anlM1  -- ss= 2.6182 :  b1 = 200  b2 = 49.511  b3 = 0.31146; 4  itns</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>anlsmsk1</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>frmu</span>, start <span class='op'>=</span> <span class='va'>stu</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>200</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span>, </span>
<span>    upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>200</span>, <span class='fl'>60</span>, <span class='fl'>3</span><span class='op'>)</span>,  algorithm <span class='op'>=</span> <span class='st'>"port"</span>, trace <span class='op'>=</span> <span class='va'>traceval</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anlsmsk1</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/pkg/nlsr/man/pnls.html'>pnls</a></span><span class='op'>(</span><span class='va'>anlsmsk1</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>anlsmsk1  -- ss= 2.6182 :  b1 = 200  b2 = 49.511  b3 = 0.31146; 5  itns</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Hobbs scaled problem with bounds, formula specification</span></span>
<span><span class='va'>anlxmsks1</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/nlsr/man/nlxb.html'>nlxb</a></span><span class='op'>(</span><span class='va'>frms</span>, start <span class='op'>=</span> <span class='va'>sts</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>                  upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>6</span>, <span class='fl'>30</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anlxmsks1</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>anlxmsks1</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>residual sumsquares =  2.6182  on  12 observations
    after  4    Jacobian and  4 function evaluations
  name            coeff          SE       tstat      pval      gradient    JSingval   
c1                     2U M         NA         NA         NA           0          NA  
c2               4.95108         0.112      44.21  8.421e-13  -2.981e-06       104.2  
c3               3.11461       0.02278      136.8  1.073e-17   1.583e-05       4.482  </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>anlshmsk1</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>frms</span>, start <span class='op'>=</span> <span class='va'>sts</span>, trace <span class='op'>=</span> <span class='va'>traceval</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, </span>
<span>                 lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span>, upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>6</span>, <span class='fl'>30</span><span class='op'>)</span>, algorithm <span class='op'>=</span> <span class='st'>'port'</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anlshmsk1</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/pkg/nlsr/man/pnls.html'>pnls</a></span><span class='op'>(</span><span class='va'>anlshmsk1</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>anlshmsk1  -- ss= 2.6182 :  c1 = 2  c2 = 4.9511  c3 = 3.1146; 5  itns</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>anlsLMmsks1</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/minpack.lm/man/nlsLM.html'>nlsLM</a></span><span class='op'>(</span><span class='va'>frms</span>, start <span class='op'>=</span> <span class='va'>sts</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>,</span>
<span>                 upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>6</span>,<span class='fl'>30</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anlsLMmsks1</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/pkg/nlsr/man/pnls.html'>pnls</a></span><span class='op'>(</span><span class='va'>anlsLMmsks1</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>anlsLMmsks1  -- ss= 2.6182 :  c1 = 2  c2 = 4.9511  c3 = 3.1146; 4  itns</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Test with all parameters masked</span></span>
<span><span class='va'>anlxmskall</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/nlsr/man/nlxb.html'>nlxb</a></span><span class='op'>(</span><span class='va'>frms</span>, start<span class='op'>=</span><span class='va'>sts</span>, data<span class='op'>=</span><span class='va'>weeddf</span>, lower<span class='op'>=</span><span class='va'>sts</span>, upper<span class='op'>=</span><span class='va'>sts</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>anlxmskall</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>anlxmskall</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>residual sumsquares =  158.23  on  12 observations
    after  0    Jacobian and  1 function evaluations
  name            coeff          SE       tstat      pval      gradient    JSingval   
c1                     2U M         NA         NA         NA          NA          NA  
c2                     5U M         NA         NA         NA          NA          NA  
c3                     3U M         NA         NA         NA          NA          NA  </code></pre>
</div>
<p><code>nlsr</code> has an output format that indicates the constraint status of the parameter
estimates. For <code>nlsr</code>, we have chosen to suppress the calculation of
approximate standard errors in the parameters when constraints are active because
their meaning under constraints is unclear, though we believe this
policy worthy of discussion and further investigation.</p>
<h2 data-number="10" id="stabilization-of-gauss-newton-computations"><span class="header-section-number">10</span> Stabilization of Gauss-Newton computations</h2>
<p>All four major tools illustrated solve some variant of the Gauss-Newton
equations. <code>nls()</code> uses a modification of an approach suggested by <span class="citation" data-cites="Hartley1961">Hartley (<a href="#ref-Hartley1961" role="doc-biblioref">1961</a>)</span>,
while <code>nlsr</code>, <code>gslnls</code>, and <code>minpack.lm</code> use flavors of <span class="citation" data-cites="Marquardt1963">Marquardt (<a href="#ref-Marquardt1963" role="doc-biblioref">1963</a>)</span>. <code>gslnls</code>
offers an accelerated Marquardt method and three alternative methods which we
have not investigated.
Control settings for <code>nlxb()</code> or <code>nlfb()</code> allow exploration of Hartley and Marquardt
algorithm variants. In general, the Levenberg-Marquardt stabilization
is important in obtaining
solutions in methods of the Gauss-Newton family, as <code>nls()</code> terminates
too frequently and unnecessarily with <code>singular gradient</code> errors.</p>
<h3 data-number="10.1" id="programming-language"><span class="header-section-number">10.1</span> Programming language</h3>
<p>An important choice made in developing <code>nlsr</code> was to code entirely within the R
programming language. <code>nls()</code> uses a mix of R, C, and Fortran, as does <code>minpack.lm</code>.
<code>gslnls</code> is an R wrapper to various C-language routines in the GNU Scientific
Library (<span class="citation" data-cites="GSL-manual">Galassi et al. (<a href="#ref-GSL-manual" role="doc-biblioref">2009</a>)</span>).
Generally, keeping to a single programming language can allow for
easier maintenance and upgrades. It also avoids some work when there are changes
or upgrades to libraries for the non-R languages.
R is usually considered slower
than most computing environments because it keeps track of objects and
because it is usually interpreted. In recent years, the
performance penalty for using code entirely in R has been much reduced
with the just-in-time compiler and other improvements. All-R computation
may now offer acceptable performance. In <code>nlsr</code>, the use of R may be a
smaller performance cost than the aggressive approach to a solution,
which can cause more iterations to be used.</p>
<h2 data-number="11" id="data-sources-for-problems"><span class="header-section-number">11</span> Data sources for problems</h2>
<p><code>nls()</code> can be called without specifying the <code>data</code> argument. In this case, it will
search in the available environments (i.e., workspaces) for suitable data objects.
We do not like this approach, but it is “the R way”. R allows users to leave many
objects in the default (<code>.GlobalEnv</code>) workspace. Moreover, users have to actively
suppress saving this workspace (<code>.RData</code>) on exit, otherwise any such file in
the path will be loaded on startup. R users in our
acquaintance avoid saving the workspace because of lurking data and
functions that may cause unwanted results.</p>
<h3 data-number="11.1" id="feature-subsetting"><span class="header-section-number">11.1</span> Feature: Subsetting</h3>
<p><code>nls()</code> and other class <code>nls</code> tools accept an argument <code>subset</code>. This acts through
the mediation of <code>model.frame</code>, which is not obvious in the
source code files
<code>/src/library/stats/R/nls.R</code> and<br />
<code>/src/library/stats/src/nls.C</code>.
Having <code>subset</code> at the level of the call to a function like
<code>nls()</code> saves effort, but it does mean that the programmer of the
solver needs to be aware of the
origin (and value) of objects such as the data, residuals and Jacobian.
By preference,
we would implement subsetting by zero-value weights, with observation counts
(and degrees of freedom) computed via the numbers of non-zero weights. Alternatively,
we would extract a working dataframe from the relevant elements in the original.</p>
<h3 data-number="11.2" id="feature-na.action-missing-value-treatment"><span class="header-section-number">11.2</span> Feature: na.action (missing value treatment)</h3>
<p><code>na.action</code> is an argument to the <code>nls()</code> function, but it does not appear
obviously in the source code, often being handled behind the scenes after
referencing the option <code>na.action</code>. This feature also changes the data
supplied to our nonlinear least squares solver.
A useful, but possibly dated, description is given in:
<em><a href="https://stats.idre.ucla.edu/r/faq/how-does-r-handle-missing-values/" class="uri">https://stats.idre.ucla.edu/r/faq/how-does-r-handle-missing-values/</a></em>.
The typical default action, which can be seen by using the command
<code>getOption("na.action")</code>
is <code>na.omit</code>. This option removes from computations any observations
containing missing values (i.e. any row of a data frame containing an NA).
<code>na.exclude</code> does much of the same for solver computations, but keeps the rows with
NA elements so that predictions are in the correct row position. We recommend that
workers test output to verify the behavior is as wanted.
See <em><a href="https://stats.stackexchange.com/questions/492955/should-i-use-na-omit-or-na-exclude-in-a-linear-model-in-r" class="uri">https://stats.stackexchange.com/questions/492955/should-i-use-na-omit-or-na-exclude-in-a-linear-model-in-r</a></em>.
As with <code>subset</code>, our concern with <code>na.action</code> is that users may be unaware of the
effects of an option they may not even be aware has been set. Should <code>na.fail</code> be the default?</p>
<h3 data-number="11.3" id="feature-model-frame"><span class="header-section-number">11.3</span> Feature: model frame</h3>
<p><code>model</code> is an argument to the <code>nls()</code> and related functions, which is documented as:</p>
<blockquote>
<p><strong>model</strong> logical. If true, the model frame is returned as part of the object. Default is FALSE.</p>
</blockquote>
<p>Indeed, the argument only gets used when <code>nls()</code> is about to return its result
object, and the
element <code>model</code> is NULL unless the calling argument <code>model</code> is TRUE. Using the
same name for both function argument and object element could be confusing.
<!-- JN: reworded to make clear our concern. -->
Despite this, the model frame is used within the function code in
the form of the object
<code>mf</code>. We feel that users could benefit from more extensive documentation and
examples of its use since it is used to implement features like <code>subset</code>.</p>
<h3 data-number="11.4" id="weights-on-observations"><span class="header-section-number">11.4</span> Weights on observations</h3>
<p>All four main tools we consider here allow a <code>weights</code> argument that
specifies a vector of fixed weights the same length as the number of residuals.
Each residual is multiplied by the square root of the corresponding weight.
Where available, the values returned by the
<code>residuals()</code> function are weighted, and the <code>fitted()</code> or <code>predict()</code> function are
used to compute raw residuals.</p>
<p>While fixed weights may be useful, there are many problems for which
we want weights that are determined at least partially from the model
parameters, for
example, a measure of the standard deviation of observations.
Such dynamic weighting situations are discussed in the vignette
“Introduction to nlsr” of package <code>nlsr</code> in section
<em>Weights that are functions of the model parameters</em>.
<code>minpack.lm</code> offers a function <code>wfct()</code> to
facilitate such weighting. Care is advised
in applying such ideas.</p>
<h3 data-number="11.5" id="weights-in-returned-functions-from-nls"><span class="header-section-number">11.5</span> Weights in returned functions from nls()</h3>
<p>The function <code>resid()</code> (an alias for <code>residuals()</code>) gives weighted residuals
like <code>result$m$resid()</code>. The function <code>nlsModel()</code>
<!-- JN: copyedit suggestion accepted -->
allows us to compute residuals for particular coefficient sets.
We have had to extract <code>nlsModel()</code> from the base R code and include it via a code chunk
(not echoed here for space) because it is not exported to the working namespace,
We could also explicitly <code>source()</code> this code.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>wts</span> <span class='op'>&lt;-</span> <span class='fl'>0.5</span> <span class='op'>^</span> <span class='va'>tt</span> <span class='co'># simple weights</span></span>
<span><span class='va'>frmlogis</span> <span class='op'>&lt;-</span> <span class='va'>weed</span> <span class='op'>~</span> <span class='va'>Asym</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>xmid</span> <span class='op'>-</span> <span class='va'>tt</span><span class='op'>)</span><span class='op'>/</span><span class='va'>scal</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>Asym</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>; <span class='va'>xmid</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>; <span class='va'>scal</span> <span class='op'>&lt;-</span> <span class='fl'>1</span></span>
<span><span class='va'>nowt</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>weed</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/SSlogis.html'>SSlogis</a></span><span class='op'>(</span><span class='va'>tt</span>, <span class='va'>Asym</span>, <span class='va'>xmid</span>, <span class='va'>scal</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># UNWEIGHTED</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>nowt</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>rnowt</span> <span class='op'>&lt;-</span> <span class='va'>nowt</span><span class='op'>$</span><span class='va'>m</span><span class='op'>$</span><span class='fu'>resid</span><span class='op'>(</span><span class='op'>)</span> <span class='co'># This has UNWEIGHTED residual and Jacobian. Does NOT take coefficients.</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>rnowt</span>, <span class='st'>"gradient"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span> </span>
<span><span class='op'>}</span> <span class='kw'>else</span> <span class='va'>rnowt</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span></span>
<span><span class='va'>rnowt</span></span></code></pre>
</div>
<pre><code> [1] -0.011900  0.032755 -0.092030 -0.208782 -0.392634  0.057594
 [7]  1.105728 -0.715786  0.107647  0.348396 -0.652592  0.287569</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>usewt</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>weed</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/SSlogis.html'>SSlogis</a></span><span class='op'>(</span><span class='va'>tt</span>, <span class='va'>Asym</span>, <span class='va'>xmid</span>, <span class='va'>scal</span><span class='op'>)</span>, weights <span class='op'>=</span> <span class='va'>wts</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>usewt</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>rusewt</span> <span class='op'>&lt;-</span> <span class='va'>usewt</span><span class='op'>$</span><span class='va'>m</span><span class='op'>$</span><span class='fu'>resid</span><span class='op'>(</span><span class='op'>)</span> <span class='co'># WEIGHTED. Does NOT take coefficients.</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>rusewt</span>, <span class='st'>"gradient"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span></span>
<span><span class='op'>}</span> <span class='kw'>else</span> <span class='va'>rusewt</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span></span>
<span><span class='va'>rusewt</span></span></code></pre>
</div>
<pre><code> [1]  0.0085640  0.0324442 -0.0176652 -0.0388479 -0.0579575  0.0163623
 [7]  0.1042380 -0.0411766  0.0052509  0.0084324 -0.0194246 -0.0024053</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>## source("nlsModel.R") # or use {r nlsmodelsource, echo=FALSE} code chunk</span></span>
<span><span class='va'>nmod0</span> <span class='op'>&lt;-</span> <span class='fu'>nlsModel</span><span class='op'>(</span><span class='va'>frmlogis</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>Asym <span class='op'>=</span> <span class='fl'>1</span>, xmid <span class='op'>=</span> <span class='fl'>1</span>, scal <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>, wts <span class='op'>=</span> <span class='va'>wts</span><span class='op'>)</span></span>
<span><span class='va'>rn0</span> <span class='op'>&lt;-</span> <span class='va'>nmod0</span><span class='op'>$</span><span class='fu'>resid</span><span class='op'>(</span><span class='op'>)</span> <span class='co'># Parameters are supplied in nlsModel() `start` above.</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>rn0</span>, <span class='st'>"gradient"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>; <span class='va'>rn0</span> <span class='co'># weighted residuals at starting coefficients</span></span></code></pre>
</div>
<pre><code> [1] 3.3998 3.2545 3.0961 2.9784 2.8438 2.7748 2.6910 2.3474 2.1724
[10] 1.9359 1.6572 1.4214</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>nmod</span> <span class='op'>&lt;-</span> <span class='fu'>nlsModel</span><span class='op'>(</span><span class='va'>frmlogis</span>, data <span class='op'>=</span> <span class='va'>weeddf</span>, start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>usewt</span><span class='op'>)</span>, wts <span class='op'>=</span> <span class='va'>wts</span><span class='op'>)</span></span>
<span><span class='va'>rn</span> <span class='op'>&lt;-</span> <span class='va'>nmod</span><span class='op'>$</span><span class='fu'>resid</span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>rn</span>,<span class='st'>"gradient"</span><span class='op'>)</span><span class='op'>&lt;-</span><span class='cn'>NULL</span>; <span class='va'>rn</span> <span class='co'># same as rusewt</span></span></code></pre>
</div>
<pre><code> [1]  0.0085640  0.0324442 -0.0176652 -0.0388479 -0.0579575  0.0163623
 [7]  0.1042380 -0.0411766  0.0052509  0.0084324 -0.0194246 -0.0024053</code></pre>
</div>
<h2 data-number="12" id="minor-issues-with-nonlinear-least-squares-tools"><span class="header-section-number">12</span> Minor issues with nonlinear least-squares tools</h2>
<h3 data-number="12.1" id="interim-output-from-the-port-algorithm"><span class="header-section-number">12.1</span> Interim output from the “port” algorithm</h3>
<p>As the <code>nls()</code> <strong>man</strong> page states, when the “port” algorithm is used with the
<code>trace</code> argument TRUE, the iterations display the objective function value which
is 1/2 the sum of squares (or deviance). The trace display is likely
embedded in the Fortran of the <code>nlminb</code> routine that is called to execute
the “port” algorithm, but the factor of 2 discrepancy is nonetheless
unfortunate for users.</p>
<h3 data-number="12.2" id="failure-to-return-the-best-result-achieved"><span class="header-section-number">12.2</span> Failure to return the best result achieved</h3>
<p>If <code>nls()</code> reaches a point where it cannot continue but has not found a point
where the relative offset convergence criterion is met, it may simply exit,
especially if a “singular gradient” (singular Jacobian) is found. However,
this may occur AFTER the function has made considerable progress in reducing
the sum of squared residuals.
<!-- An example is to be found in the `Tetra_1.R` example from the `nlsCompare` package. -->
<!-- AB: Are we far enough along to include reference? -->
Here is an abbreviated example:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>time</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span> <span class='fl'>1</span>,  <span class='fl'>2</span>,  <span class='fl'>3</span>,  <span class='fl'>4</span>,  <span class='fl'>6</span> , <span class='fl'>8</span>, <span class='fl'>10</span>, <span class='fl'>12</span>, <span class='fl'>16</span><span class='op'>)</span></span>
<span><span class='va'>conc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span> <span class='fl'>0.7</span>, <span class='fl'>1.2</span>, <span class='fl'>1.4</span>, <span class='fl'>1.4</span>, <span class='fl'>1.1</span>, <span class='fl'>0.8</span>, <span class='fl'>0.6</span>, <span class='fl'>0.5</span>, <span class='fl'>0.3</span><span class='op'>)</span></span>
<span><span class='va'>NLSdata</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>time</span>,<span class='va'>conc</span><span class='op'>)</span></span>
<span><span class='va'>NLSstart</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>lrc1 <span class='op'>=</span> <span class='op'>-</span><span class='fl'>2</span>, lrc2 <span class='op'>=</span> <span class='fl'>0.25</span>, A1 <span class='op'>=</span> <span class='fl'>150</span>, A2 <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span> <span class='co'># a starting vector (named!)</span></span>
<span><span class='va'>NLSformula</span> <span class='op'>&lt;-</span> <span class='va'>conc</span> <span class='op'>~</span> <span class='va'>A1</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lrc1</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>time</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>A2</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lrc2</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>time</span><span class='op'>)</span></span>
<span><span class='va'>tryit</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>NLSformula</span>, data <span class='op'>=</span> <span class='va'>NLSdata</span>, start <span class='op'>=</span> <span class='va'>NLSstart</span>, trace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>61216.    (3.56e+03): par = (-2 0.25 150 50)
2.1757    (2.23e+01): par = (-1.9991 0.31711 2.6182 -1.3668)
1.6211    (7.14e+00): par = (-1.9605 -2.6203 2.5753 -0.55599)
Error in nls(NLSformula, data = NLSdata, start = NLSstart, trace = TRUE) : 
  singular gradient</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>tryit</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>tryit</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Note that the sum of squares has been reduced from 61216 to 1.6211, but
unless <code>trace</code> is invoked, the user will not get any information about this.
Changing this in the <code>nls()</code> function could be useful to R users, and would
be almost trivial.</p>
<h2 data-number="13" id="estimating-models-that-are-partially-linear"><span class="header-section-number">13</span> Estimating models that are partially linear</h2>
<p>The variable projection method (<span class="citation" data-cites="Golub1973">Golub and Pereyra (<a href="#ref-Golub1973" role="doc-biblioref">1973</a>)</span>, <span class="citation" data-cites="OlearyRust13">O’Leary and Rust (<a href="#ref-OlearyRust13" role="doc-biblioref">2013</a>)</span>) is
usually much more effective than general approaches in finding good solutions
to nonlinear least squares
problems when some of the parameters appear linearly. In our logistic examples,
the asymptote parameters are an illustration. However, identifying which parameters
are linear and communicating this information to estimating functions
is not a trivial task. <code>nls()</code> has an option <code>algorithm = "plinear"</code> that allows some partially linear
models to be solved. The other tools, as far as we are aware, do not offer any
such capability. The <code>nlstac</code> package uses a different algorithm for similar goals.</p>
<p>Within <code>nls()</code> itself we must, unfortunately, use
different specifications with different <code>algorithm</code> options.
For example, the explicit model <code>y ~ a * x + b</code> does not work with the linear
modeling function <code>lm()</code>, which requires this model to be specified as <code>y ~ x</code>.
Within <code>nls()</code>, consider the following FOUR different specifications for the same
problem, plus an intuitive choice, labeled <code>fm2a</code>, that does not work.
In this failed attempt, putting the <code>Asym</code> parameter in the model causes the
<code>plinear</code> algorithm
to try to add another term to the model. We believe this is unfortunate, and would
like to see a consistent syntax. At the time of writing, we do
not foresee a resolution for this issue. In the example, we have not evaluated
the commands to save space.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>DNase1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>DNase</span>, <span class='va'>Run</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span> <span class='co'># select the data</span></span>
<span><span class='co'>## using a selfStart model - do not specify the starting parameters</span></span>
<span><span class='va'>fm1</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>density</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/SSlogis.html'>SSlogis</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>conc</span><span class='op'>)</span>, <span class='va'>Asym</span>, <span class='va'>xmid</span>, <span class='va'>scal</span><span class='op'>)</span>, <span class='va'>DNase1</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>fm1</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fm1</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## using conditional linearity - leave out the Asym parameter</span></span>
<span><span class='va'>fm2</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>density</span> <span class='op'>~</span> <span class='fl'>1</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>xmid</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>conc</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>scal</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>                 data <span class='op'>=</span> <span class='va'>DNase1</span>, start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>xmid <span class='op'>=</span> <span class='fl'>0</span>, scal <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>                 algorithm <span class='op'>=</span> <span class='st'>"plinear"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>fm2</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fm2</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## without conditional linearity</span></span>
<span><span class='va'>fm3</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>density</span> <span class='op'>~</span> <span class='va'>Asym</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>xmid</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>conc</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>scal</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>                 data <span class='op'>=</span> <span class='va'>DNase1</span>,</span>
<span>                 start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>Asym <span class='op'>=</span> <span class='fl'>3</span>, xmid <span class='op'>=</span> <span class='fl'>0</span>, scal <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>fm3</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fm3</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## using Port's nl2sol algorithm</span></span>
<span><span class='va'>fm4</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>density</span> <span class='op'>~</span> <span class='va'>Asym</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>xmid</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>conc</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>scal</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>                 data <span class='op'>=</span> <span class='va'>DNase1</span>, start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>Asym <span class='op'>=</span> <span class='fl'>3</span>, xmid <span class='op'>=</span> <span class='fl'>0</span>, scal <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>                 algorithm <span class='op'>=</span> <span class='st'>"port"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>fm4</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fm4</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>## using conditional linearity AND Asym does not work</span></span>
<span><span class='va'>fm2a</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/nls.html'>nls</a></span><span class='op'>(</span><span class='va'>density</span> <span class='op'>~</span> <span class='va'>Asym</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>xmid</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>conc</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>scal</span><span class='op'>)</span><span class='op'>)</span>, </span>
<span>                 data <span class='op'>=</span> <span class='va'>DNase1</span>, start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>Asym<span class='op'>=</span><span class='fl'>3</span>, xmid <span class='op'>=</span> <span class='fl'>0</span>, scal <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>                 algorithm <span class='op'>=</span> <span class='st'>"plinear"</span>, trace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>fm2a</span>, <span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fm2a</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 data-number="14" id="models-with-indexed-parameters"><span class="header-section-number">14</span> Models with indexed parameters</h2>
<p>Some models have several common parameters and
others that are tied to particular cases.
The <strong>man</strong> file for <code>nls()</code> includes an example of a situation in which
parameters are indexed but which uses the “plinear” option as an added complication.
Running this example reveals that the answers for the parameters are not indexed
as in a vector.
<!-- e.g. `coef(musc.2)` is a single level vector of parameters.  -->
That is, we do not see <code>a[1], a[2], a[3]</code> but <code>a1, a2, a3</code>.
<!-- This is because the model -->
<!-- must integrate all the parameters because `th` is a common parameter across the index `Strip`. -->
This is no doubt because programming for indexed parameters is challenging.
<!-- However, we believe the current structure could cause confusion and error, and  -->
<!-- propose an alternative approach below. -->
We note that there are capabilities in packages for mixed-effects modeling
such as <code>nlme</code> (<span class="citation" data-cites="p-nlme">Pinheiro et al. (<a href="#ref-p-nlme" role="doc-biblioref">2013</a>)</span>), <code>bbmle</code> (<span class="citation" data-cites="p-bbmle">Bolker and Team (<a href="#ref-p-bbmle" role="doc-biblioref">2013</a>)</span>), and <code>lme4</code> (<span class="citation" data-cites="p-lme4">Bates et al. (<a href="#ref-p-lme4" role="doc-biblioref">2015</a>)</span>) for
estimating models of such type.</p>
<h2 data-number="15" id="tests-and-use-case-examples"><span class="header-section-number">15</span> Tests and use-case examples</h2>
<p>Maintainers of packages need suitable tests and use-case examples in order</p>
<ul>
<li>to ensure packages work properly, in particular, giving
results comparable to or better than the functions they are to replace.</li>
<li>to test individual solver functions to ensure they work across the range of
calling mechanisms, that is, different ways of supplying inputs to the solver(s);</li>
<li>to pose “silly” inputs to see if these bad inputs are caught by the programs.</li>
</ul>
<p>Such goals align with the aims of <strong>unit testing</strong>
(e.g., <em><a href="https://towardsdatascience.com/unit-testing-in-r-68ab9cc8d211" class="uri">https://towardsdatascience.com/unit-testing-in-r-68ab9cc8d211</a></em>, <span class="citation" data-cites="HWtestthat11">Wickham (<a href="#ref-HWtestthat11" role="doc-biblioref">2011</a>)</span>, <span class="citation" data-cites="HWdevtools21">Wickham et al. (<a href="#ref-HWdevtools21" role="doc-biblioref">2021</a>)</span>
and the conventional R package testing tools).
In our work, one of us (AB) has developed a working prototype package at <em><a href="https://github.com/ArkaB-DS/nlsCompare" class="uri">https://github.com/ArkaB-DS/nlsCompare</a></em> .
A primary design objective of this is to allow the summarization of multiple tests in
a compact output. The prototype has a vignette to illustrate its use.</p>
<h2 data-number="16" id="documentation-and-resources"><span class="header-section-number">16</span> Documentation and resources</h2>
<p>In our investigation, we built several resources, which are now part of
the repository <em><a href="https://github.com/nashjc/RNonlinearLS/" class="uri">https://github.com/nashjc/RNonlinearLS/</a></em>. Particular items
are:</p>
<ul>
<li><p>A BibTex bibliography for use with all documents in this project, but which
has wider application to nonlinear least squares projects in general
(<em><a href="https://github.com/nashjc/RNonlinearLS/blob/main/BibSupport/ImproveNLS.bib" class="uri">https://github.com/nashjc/RNonlinearLS/blob/main/BibSupport/ImproveNLS.bib</a></em>).</p></li>
<li><p><code>MachID.R</code> offers a suggested concise summary function
to identify a particular computational system used for tests. A discussion
of how it was built and the resources needed across platforms is given in
at <em><a href="https://github.com/nashjc/RNonlinearLS/tree/main/MachineSummary" class="uri">https://github.com/nashjc/RNonlinearLS/tree/main/MachineSummary</a></em>.</p></li>
<li><p><span class="citation" data-cites="PkgFromRbase22">Nash and Bhattacharjee (<a href="#ref-PkgFromRbase22" role="doc-biblioref">2022</a>)</span> is an explanation of the construction of the <code>nlspkg</code> from the
<code>nls()</code> code in R-base.</p></li>
<li><p>As the 2021 Summer of Code period was ending, one of us (JN) was invited to prepare
a review of optimization in R. Ideas from the present work have been instrumental
in the creation of <span class="citation" data-cites="NashWires22">Nash (<a href="#ref-NashWires22" role="doc-biblioref">2022</a>)</span>.</p></li>
</ul>
<h2 data-number="17" id="future-of-nonlinear-model-estimation-in-r"><span class="header-section-number">17</span> Future of nonlinear model estimation in R</h2>
<p>Given its importance to R, it is possible that <code>nls()</code> will remain more or less
as it has been for the past several decades. If so, the focus of discussion
should be the measures needed to secure its continued operation for legacy
purposes and how that may be accomplished.
We welcome an opportunity to participate in such conversations.</p>
<p>To advance the stability and maintainability of R, we believe the program
objects (R functions)
that are created by tools such as <code>nls()</code> should have minimal
cross-linkages and side-effects.
The aspects of <code>nls()</code> that concern us follow.</p>
<ul>
<li><p>R tools presume data and parameters needed are available in an
accessible environment. This provides a compact syntax to invoke the
calculations, but the wrong data can be used if the
internal search finds a valid name that is not the object we want,
or if <code>subset</code> or <code>na.action</code> settings modify the selection, or
<code>weights</code> are applied.</p></li>
<li><p>Mixing of R, C and Fortran code adds to the burden of following the
program logic.</p></li>
<li><p>The class <code>nls</code> structure simplifies calls with its rich set of functions, but
also adds to the task of understanding what has been done. A design that isolates
the setup, solution, and post-solution parts of complicated calculations reduces
the number of objects that must be kept in alignment.</p></li>
</ul>
<p>Given the existence of examples of good practices such as analytic derivatives,
stabilized solution of Gauss-Newton equations, and bounds-constrained parameters,
base R tools should
be moving to incorporate them. These capabilities are available now by
using several tools, but it would be helpful if they were unified.</p>
<h2 data-number="18" id="acknowledgments"><span class="header-section-number">18</span> Acknowledgments</h2>
<p>Hans Werner Borchers was helpful in developing the GSoC project motivating this article
and in comments on this and related work. Heather Turner co-mentored the project
and helped guide the progress of the work. Exchanges with Fernando Miguez helped to
clarify aspects of <code>selfStart</code> models and instigated the “Introduction to nlsr”
vignette. Colin Gillespie (package <code>benchmarkme</code>) has been helpful in guiding our
attempts to succinctly summarize computing environments. We thank one of the referees
for pointing out that it is important to use background knowledge and graphs to
guide modeling. Simon Urbanek gave some important practical help with preparing
files for publication.
<!-- JN: added Simon. Removed # References which duplicated subhead --></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h3 class="appendix" data-number="18.1" id="supplementary-materials"><span class="header-section-number">18.1</span> Supplementary materials</h3>
<p>Supplementary materials are available in addition to this article. It can be downloaded at
<a href="RJ-2023-091.zip">RJ-2023-091.zip</a></p>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-NISTnls-manual" class="csl-entry" role="listitem">
D. M. Bates. <em><span class="nocase">NISTnls: Nonlinear least squares examples from NIST</span>.</em> 2012. URL <a href="https://CRAN.R-project.org/package=NISTnls">https://CRAN.R-project.org/package=NISTnls</a>. R package version 0.9-13. Original source from National Institutes for Standards and Technology <span>https://www.itl.nist.gov/div898/strd/nls/nls_main.shtml</span> with R port by Douglas Bates.
</div>
<div id="ref-BatesWatts81" class="csl-entry" role="listitem">
D. M. Bates and D. G. Watts. <span class="nocase">A Relative Offset Orthogonality Convergence Criterion for Nonlinear least Squares</span>. <em>Technometrics</em>, 23(2): 179–183, 1981.
</div>
<div id="ref-bateswatts" class="csl-entry" role="listitem">
D. M. Bates and D. G. Watts. <em><span class="nocase">Nonlinear Regression Analysis and Its Applications</span>.</em> Wiley, 1988.
</div>
<div id="ref-p-lme4" class="csl-entry" role="listitem">
D. Bates, M. Mächler, B. Bolker and S. Walker. Fitting linear mixed-effects models using <span class="nocase">lme4</span>. <em>Journal of Statistical Software</em>, 67(1): 1–48, 2015. DOI <a href="https://doi.org/10.18637/jss.v067.i01">10.18637/jss.v067.i01</a>.
</div>
<div id="ref-nlsMicrobio-manual" class="csl-entry" role="listitem">
F. Baty and M.-L. Delignette-Muller. <em>nlsMicrobio: Data sets and nonlinear regression models dedicated to predictive microbiology.</em> 2014. R package version 0.0-1.
</div>
<div id="ref-p-nlstools" class="csl-entry" role="listitem">
F. Baty and M.-L. Delignette-Muller. <em>Nlstools: Tools for nonlinear regression diagnostics.</em> 2013. R package version 0.0-15.
</div>
<div id="ref-p-bbmle" class="csl-entry" role="listitem">
B. Bolker and R. D. C. Team. <em>Bbmle: Tools for general maximum likelihood estimation.</em> 2013. URL <a href="http://CRAN.R-project.org/package=bbmle">http://CRAN.R-project.org/package=bbmle</a>. R package version 1.0.13.
</div>
<div id="ref-gslnls23" class="csl-entry" role="listitem">
J. Chau. <em><span class="nocase">gslnls: GSL Nonlinear Least-Squares Fitting</span>.</em> 2023. URL <a href="https://CRAN.R-project.org/package=gslnls">https://CRAN.R-project.org/package=gslnls</a>. R package version 1.1.2.
</div>
<div id="ref-nlshelper-manual" class="csl-entry" role="listitem">
R. Duursma. <em>Nlshelper: Convenient functions for non-linear regression.</em> 2017. URL <a href="https://CRAN.R-project.org/package=nlshelper">https://CRAN.R-project.org/package=nlshelper</a>. R package version 0.2.
</div>
<div id="ref-minpacklm12" class="csl-entry" role="listitem">
T. V. Elzhov, K. M. Mullen, A.-N. Spiess and B. Bolker. <em><span class="nocase">minpack.lm: R interface to the Levenberg-Marquardt nonlinear least-squares algorithm found in MINPACK, plus support for bounds</span>.</em> R Project for Statistical Computing, 2012. URL <a href="http://CRAN.R-project.org/package=minpack.lm">http://CRAN.R-project.org/package=minpack.lm</a>. R package version 1.1-6.
</div>
<div id="ref-GSL-manual" class="csl-entry" role="listitem">
M. Galassi, J. Davies, J. Theiler, B. Gough and G. Jungman. <em><span class="nocase">GNU Scientific Library - Reference Manual, Third Edition, for GSL Version 1.12 (3. ed.)</span>.</em> Free Software Foundation, 2009.
</div>
<div id="ref-Gallant87" class="csl-entry" role="listitem">
A. R. Gallant. <em>Nonlinear statistical models.</em> Wiley, 1987.
</div>
<div id="ref-Bioconductor" class="csl-entry" role="listitem">
R. C. Gentleman, V. J. Carey, D. M. Bates, B. Bolstad, M. Dettling, S. Dudoit, B. Ellis, L. Gautier, Y. Ge, J. Gentry, et al. Bioconductor: Open software development for computational biology and bioinformatics. <em><span>Genome Biology</span></em>, 5(R80): 2004. DOI <a href="https://doi.org/10.1186/gb-2004-5-10-r80">10.1186/gb-2004-5-10-r80</a>.
</div>
<div id="ref-Golub1973" class="csl-entry" role="listitem">
G. H. Golub and V. Pereyra. The differentiation of pseudo-inverses and nonlinear least squares problems whose variables separate. <em>SIAM Journal of Numerical Analysis</em>, 10(2): 413–432, 1973.
</div>
<div id="ref-nls2-22" class="csl-entry" role="listitem">
G. Grothendieck. <em>nls2: Non-linear regression with brute force.</em> 2022. URL <a href="https://CRAN.R-project.org/package=nls2">https://CRAN.R-project.org/package=nls2</a>. R package version 0.3-3.
</div>
<div id="ref-Hartley1961" class="csl-entry" role="listitem">
H. O. Hartley. The modified gauss-newton method for the fitting of non-linear regression functions by least squares. <em>Technometrics</em>, 3: 269–280, 1961.
</div>
<div id="ref-Huet2004" class="csl-entry" role="listitem">
S. Huet, A. Bouvier, M.-A. Poursat and E. Jolivet. <em>Statistical tools for nonlinear regression: A practical guide with <span>S-PLUS</span> examples, 2nd edition.</em> Berlin &amp; New York: Springer-Verlag, 2004.
</div>
<div id="ref-tvrdik2007" class="csl-entry" role="listitem">
Josef Tvrdík and Ivan Křivý and Ladislav Mišík. Adaptive population-based search: Application to estimation of nonlinear regression parameters. <em><span>Computational Statistics &amp; Data Analysis</span></em>, 52(2): 713–724, 2007. URL <a href="https://doi.org/10.1016/j.csda.2006.10.014">https://doi.org/10.1016/j.csda.2006.10.014</a>.
</div>
<div id="ref-Levenberg1944" class="csl-entry" role="listitem">
K. Levenberg. A method for the solution of certain non-linear problems in least squares. <em>Quarterly of Applied Mathematics</em>, 2: 164–168, 1944.
</div>
<div id="ref-Marquardt1963" class="csl-entry" role="listitem">
D. W. Marquardt. <span class="nocase">An Algorithm for Least-Squares Estimation of Nonlinear Parameters</span>. <em>SIAM Journal on Applied Mathematics</em>, 11(2): 431–441, 1963.
</div>
<div id="ref-MiguezNLRAA2021" class="csl-entry" role="listitem">
F. Miguez. <em><span class="nocase">nlraa: Nonlinear Regression for Agricultural Applications</span>.</em> 2021. URL <a href="https://CRAN.R-project.org/package=nlraa">https://CRAN.R-project.org/package=nlraa</a>. R package version 0.89.
</div>
<div id="ref-cnm79" class="csl-entry" role="listitem">
J. C. Nash. <em>Compact numerical methods for computers: Linear algebra and function minimisation.</em> Bristol: Adam Hilger, 1979. Second Edition, 1990, Bristol: Institute of Physics Publications.
</div>
<div id="ref-NashWires22" class="csl-entry" role="listitem">
J. C. Nash. <span class="nocase">Function minimization and nonlinear least squares in R</span>. <em>WIREs Computational Statistics</em>, 14(e1580): 2022. URL <a href="https://wires.onlinelibrary.wiley.com/doi/abs/10.1002/wics.1580">https://wires.onlinelibrary.wiley.com/doi/abs/10.1002/wics.1580</a>.
</div>
<div id="ref-jn77ima" class="csl-entry" role="listitem">
J. C. Nash. Minimizing a nonlinear sum of squares function on a small computer. <em>Journal of the Institute for Mathematics and its Applications</em>, 19: 231–237, 1977. JNfile: 77IMA J Appl Math-1977-NASH-231-7.pdf.
</div>
<div id="ref-PkgFromRbase22" class="csl-entry" role="listitem">
J. C. Nash and A. Bhattacharjee. Making a package from base <span>R</span> files. <em>R-bloggers</em>, 2022. URL <a href="https://www.r-bloggers.com/2022/01/making-a-package-from-base-r-files/">https://www.r-bloggers.com/2022/01/making-a-package-from-base-r-files/</a>.
</div>
<div id="ref-nlsr2023manual" class="csl-entry" role="listitem">
J. C. Nash and D. Murdoch. <em><span class="nocase">nlsr: Functions for Nonlinear Least Squares Solutions</span>.</em> 2023. R package version 2023.8.31.
</div>
<div id="ref-p-optimx" class="csl-entry" role="listitem">
J. C. Nash and R. Varadhan. <em><em>Optimx</em>: A replacement and extension of the <span class="nocase">optim()</span> function.</em> Nash Information Services Inc.; Johns Hopkins University, 2011. R package version 2011-3.5.
</div>
<div id="ref-nash1996nonlinear" class="csl-entry" role="listitem">
J. C. Nash and P. Velleman. Nonlinear estimation combining visual fitting with optimization methods. In <em>Proceedings of the section on physical and engineering sciences of the american statistical association</em>, pages. 256–261 1996. American Statistical Association. Presented to the 1995 Spring Research Conference on Industrial Statistics, June 1995 in Waterloo, Ontario. JNfile: 96NashVellemanSRC95x.pdf, slides: 95SRC-nashvellemanvisualfittingslides.pdf.
</div>
<div id="ref-jnmws87" class="csl-entry" role="listitem">
J. C. Nash and M. Walker-Smith. <em><span class="nocase">Nonlinear Parameter Estimation: An Integrated System in BASIC</span>.</em> New York: Marcel Dekker, 1987. See <a href="http://www.nashinfo.com/nlpe.htm" class="uri">http://www.nashinfo.com/nlpe.htm</a> for a downloadable version of this plus some extras.
</div>
<div id="ref-OlearyRust13" class="csl-entry" role="listitem">
D. P. O’Leary and B. W. Rust. Variable projection for nonlinear least squares problems. <em>Computational Optimization and Applications</em>, 54(3): 579–593, 2013.
</div>
<div id="ref-nlsmultstart" class="csl-entry" role="listitem">
D. Padfield and G. Matheson. <em><span class="nocase">nls.multstart: Robust Non-Linear Regression using AIC Scores</span>.</em> 2020. URL <a href="https://CRAN.R-project.org/package=nls.multstart">https://CRAN.R-project.org/package=nls.multstart</a>. R package version 1.2.0.
</div>
<div id="ref-p-nlme" class="csl-entry" role="listitem">
J. Pinheiro, D. Bates, S. DebRoy, D. Sarkar and R Core Team. <em>Nlme: Linear and nonlinear mixed effects models.</em> 2013. R package version 3.1-111.
</div>
<div id="ref-m-nlsmsn" class="csl-entry" role="listitem">
M. Prates, V. Lachos and A. Garay. <em><span class="nocase">nlsmsn: Fitting Nonlinear Models with Scale Mixture of Skew-Normal Distributions</span>.</em> 2021. URL <a href="https://CRAN.R-project.org/package=nlsmsn">https://CRAN.R-project.org/package=nlsmsn</a>. R package version 0.0-6.
</div>
<div id="ref-Ratkowsky1983" class="csl-entry" role="listitem">
D. A. Ratkowsky. <em>Nonlinear regression modeling: A unified practical approach.</em> New York; Basel: Marcel Dekker Inc., 1983.
</div>
<div id="ref-m-nlstac" class="csl-entry" role="listitem">
M. Rodriguez-Arias, J. A. Fernandez, J. Cabello and R. Benitez. <em>Nlstac: An r package for fitting separable nonlinear models.</em> 2020. URL <a href="https://CRAN.R-project.org/package=nlstac">https://CRAN.R-project.org/package=nlstac</a>. R package version 0.1.0.
</div>
<div id="ref-Ross90" class="csl-entry" role="listitem">
G. J. S. Ross. <em>Nonlinear estimation.</em> New York etc.: Springer-Verlag, 1990.
</div>
<div id="ref-Seber89Wild" class="csl-entry" role="listitem">
G. A. F. Seber and C. J. Wild. <em><span class="nocase">Nonlinear regression</span>.</em> New York: Wiley, 1989.
</div>
<div id="ref-nlsic22" class="csl-entry" role="listitem">
S. Sokol. <em>Nlsic: Non linear least squares with inequality constraints.</em> 2022. URL <a href="https://CRAN.R-project.org/package=nlsic">https://CRAN.R-project.org/package=nlsic</a>. R package version 1.0.1.
</div>
<div id="ref-R-onls-manual" class="csl-entry" role="listitem">
Spiess, Andrej-Nikolai. <em>Onls: Orthogonal nonlinear least-squares regression.</em> 2022. URL <a href="https://CRAN.R-project.org/package=onls">https://CRAN.R-project.org/package=onls</a>. R package version 0.1-2.
</div>
<div id="ref-Torvisco2018" class="csl-entry" role="listitem">
J. A. F. Torvisco, M. Rodriguez-Arias and J. C. Sanchez. A new algorithm to fit exponential decays without initial guess. <span>Faculty of Sciences and Mathematics, University of Nis, Serbia</span>. 2018. DOI <a href="https://doi.org/10.2298/fil1812233t">10.2298/fil1812233t</a>.
</div>
<div id="ref-R-crsnls-manual" class="csl-entry" role="listitem">
J. Tvrdík. <em><span class="nocase">crsnls: Nonlinear Regression Parameters Estimation by ’CRS4HC’ and ’CRS4HCe’</span>.</em> 2016. URL <a href="https://CRAN.R-project.org/package=crsnls">https://CRAN.R-project.org/package=crsnls</a>. R package version 0.2.
</div>
<div id="ref-HWtestthat11" class="csl-entry" role="listitem">
H. Wickham. <span class="nocase">testthat: Get Started with Testing</span>. <em>The R Journal</em>, 3: 5–10, 2011. URL <a href="https://journal.r-project.org/archive/2011-1/RJournal\_2011-1\_Wickham.pdf">https://journal.r-project.org/archive/2011-1/RJournal\_2011-1\_Wickham.pdf</a>.
</div>
<div id="ref-HWdevtools21" class="csl-entry" role="listitem">
H. Wickham, J. Hester, W. Chang and J. Bryan. <em><span class="nocase">devtools: Tools to Make Developing R Packages Easier</span>.</em> 2021. URL <a href="https://CRAN.R-project.org/package=devtools">https://CRAN.R-project.org/package=devtools</a>. R package version 2.4.3.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Nash &amp; Bhattacharjee, "A Comparison of R Tools for Nonlinear Least Squares Modeling", The R Journal, 2024</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2023-091,
  author = {Nash, John C. and Bhattacharjee, Arkajyoti},
  title = {A Comparison of R Tools for Nonlinear Least Squares Modeling},
  journal = {The R Journal},
  year = {2024},
  note = {https://doi.org/10.32614/RJ-2023-091},
  doi = {10.32614/RJ-2023-091},
  volume = {15},
  issue = {4},
  issn = {2073-4859},
  pages = {198-215}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
