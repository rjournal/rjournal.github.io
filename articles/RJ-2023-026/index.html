<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>nlmeVPC: Visual Model Diagnosis for the Nonlinear Mixed Effect Model</title>

<meta property="description" itemprop="description" content="A nonlinear mixed effects model is useful when the data are repeatedly measured within the same unit or correlated between units. Such models are widely used in medicine, disease mechanics, pharmacology, ecology, social science, psychology, etc. After fitting the nonlinear mixed effect model, model diagnostics are essential for verifying that the results are reliable. The visual predictive check (VPC) has recently been highlighted as a visual diagnostic tool for pharmacometric models. This method can also be applied to general nonlinear mixed effects models. However, functions for VPCs in existing R packages are specialized for pharmacometric model diagnosis, and are not suitable for general nonlinear mixed effect models. In this paper, we propose nlmeVPC, an R package for the visual diagnosis of various nonlinear mixed effect models. The nlmeVPC package allows for more diverse model diagnostics, including visual diagnostic tools that extend the concept of VPCs along with the capabilities of existing R packages."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2023-026/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2023-08-26"/>
<meta property="article:created" itemprop="dateCreated" content="2023-08-26"/>
<meta name="article:author" content="Eun-Hwa Kang"/>
<meta name="article:author" content="Myungji Ko"/>
<meta name="article:author" content="Eun-Kyung Lee"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="nlmeVPC: Visual Model Diagnosis for the Nonlinear Mixed Effect Model"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="A nonlinear mixed effects model is useful when the data are repeatedly measured within the same unit or correlated between units. Such models are widely used in medicine, disease mechanics, pharmacology, ecology, social science, psychology, etc. After fitting the nonlinear mixed effect model, model diagnostics are essential for verifying that the results are reliable. The visual predictive check (VPC) has recently been highlighted as a visual diagnostic tool for pharmacometric models. This method can also be applied to general nonlinear mixed effects models. However, functions for VPCs in existing R packages are specialized for pharmacometric model diagnosis, and are not suitable for general nonlinear mixed effect models. In this paper, we propose nlmeVPC, an R package for the visual diagnosis of various nonlinear mixed effect models. The nlmeVPC package allows for more diverse model diagnostics, including visual diagnostic tools that extend the concept of VPCs along with the capabilities of existing R packages."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2023-026/"/>
<meta property="og:image" content="https://journal.r-project.org/articles/RJ-2023-026/RJ-2023-026_files/figure-html5/Fig0-1.png"/>
<meta property="og:image:width" content="1536"/>
<meta property="og:image:height" content="2304"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="nlmeVPC: Visual Model Diagnosis for the Nonlinear Mixed Effect Model"/>
<meta property="twitter:description" content="A nonlinear mixed effects model is useful when the data are repeatedly measured within the same unit or correlated between units. Such models are widely used in medicine, disease mechanics, pharmacology, ecology, social science, psychology, etc. After fitting the nonlinear mixed effect model, model diagnostics are essential for verifying that the results are reliable. The visual predictive check (VPC) has recently been highlighted as a visual diagnostic tool for pharmacometric models. This method can also be applied to general nonlinear mixed effects models. However, functions for VPCs in existing R packages are specialized for pharmacometric model diagnosis, and are not suitable for general nonlinear mixed effect models. In this paper, we propose nlmeVPC, an R package for the visual diagnosis of various nonlinear mixed effect models. The nlmeVPC package allows for more diverse model diagnostics, including visual diagnostic tools that extend the concept of VPCs along with the capabilities of existing R packages."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2023-026/"/>
<meta property="twitter:image" content="https://journal.r-project.org/articles/RJ-2023-026/RJ-2023-026_files/figure-html5/Fig0-1.png"/>
<meta property="twitter:image:width" content="1536"/>
<meta property="twitter:image:height" content="2304"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="nlmeVPC: Visual Model Diagnosis for the Nonlinear Mixed Effect Model"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2023-026"/>
<meta name="citation_pdf_url" content="RJ-2023-026.pdf"/>
<meta name="citation_volume" content="15"/>
<meta name="citation_issue" content="1"/>
<meta name="citation_doi" content="10.32614/RJ-2023-026"/>
<meta name="citation_journal_title" content="The R Journal"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="83"/>
<meta name="citation_lastpage" content="100"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2023/08/26"/>
<meta name="citation_publication_date" content="2023/08/26"/>
<meta name="citation_author" content="Eun-Hwa Kang"/>
<meta name="citation_author_institution" content="Ewha Womans University"/>
<meta name="citation_author" content="Myungji Ko"/>
<meta name="citation_author_institution" content="Ewha Womans University"/>
<meta name="citation_author" content="Eun-Kyung Lee"/>
<meta name="citation_author_institution" content="Ewha Womans University"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=R: A language and environment for statistical computing;citation_publisher=R Foundation for Statistical Computing;citation_author=R: A language and environment for statistical computing"/>
  <meta name="citation_reference" content="citation_title=Nonlinear models for repeated measurement data;citation_publisher=Routledge;citation_author=Marie Davidian"/>
  <meta name="citation_reference" content="citation_title=ggplot2 : Elegance graphics for data analysis;citation_publisher=Springer;citation_author=H Wickham"/>
  <meta name="citation_reference" content="citation_title=Nlme: Linear and nonlinear mixed effects models. R package version 3.1-159;citation_author=José Pinheiro;citation_author=Douglas Bates;citation_author=Saikat DebRoy;citation_author=Deepayan Sarkar;citation_author=Siem Heisterkamp;citation_author=Bert Van Willigen;citation_author=R Maintainer"/>
  <meta name="citation_reference" content="citation_title=Nlraa: Nonlinear regression for agricultural applications. R package version 1.5;citation_author=Fernando Miguez"/>
  <meta name="citation_reference" content="citation_title=Vpc: Create visual predictive checks. R package version 1.2.2;citation_author=R Keizer"/>
  <meta name="citation_reference" content="citation_title=Nonlinear mixed-effects model development and simulation using nlmixr and related r open-source packages;citation_publisher=Wiley Online Library;citation_volume=8;citation_doi=10.1002/psp4.12445;citation_author=Matthew Fidler;citation_author=Justin J Wilkins;citation_author=Richard Hooijmaijers;citation_author=Teun M Post;citation_author=Rik Schoemaker;citation_author=Mirjam N Trame;citation_author=Yuan Xiong;citation_author=Wenping Wang"/>
  <meta name="citation_reference" content="citation_title=Model-informed precision dosing of vancomycin via continuous infusion: A clinical fit-for-purpose evaluation of published PK models;citation_publisher=Elsevier;citation_volume=59;citation_doi=10.1016/j.ijantimicag.2022.106579;citation_author=Astrid Heus;citation_author=David W Uster;citation_author=Veerle Grootaert;citation_author=Nele Vermeulen;citation_author=Annemie Somers;citation_author=Diana Huis In’t Veld;citation_author=Sebastian G Wicha;citation_author=Pieter A De Cock"/>
  <meta name="citation_reference" content="citation_title=Model evaluation of continuous data pharmacometric models: Metrics and graphics;citation_publisher=Wiley Online Library;citation_volume=6;citation_doi=10.1002/psp4.12161;citation_author=THT Nguyen;citation_author=M-S Mouksassi;citation_author=Nicholas Holford;citation_author=N Al-Huniti;citation_author=I Freedman;citation_author=Andrew C Hooker;citation_author=J John;citation_author=Mats O Karlsson;citation_author=DR Mould;citation_author=JJ Pérez Ruixo;citation_author=Model evaluation of continuous data pharmacometric models: Metrics and graphics"/>
  <meta name="citation_reference" content="citation_title=Predictive modeling to study the treatment-shortening potential of novel tuberculosis drug regimens, toward bundling of preclinical data;citation_publisher=Oxford University Press US;citation_volume=225;citation_doi=10.1093/infdis/jiab101;citation_author=Saskia E Mudde;citation_author=Rami Ayoun Alsoud;citation_author=Aart Meijden;citation_author=Anna M Upton;citation_author=Manisha U Lotlikar;citation_author=Ulrika SH Simonsson;citation_author=Hannelore I Bax;citation_author=Jurriaan EM Steenwinkel"/>
  <meta name="citation_reference" content="citation_title=Predictive performance of parent-metabolite population pharmacokinetic models of (s)-ketamine in healthy volunteers;citation_publisher=Springer;citation_volume=77;citation_doi=10.1007/s00228-021-03104-1;citation_author=ME Otto;citation_author=KR Bergmann;citation_author=G Jacobs;citation_author=Michiel J Esdonk"/>
  <meta name="citation_reference" content="citation_title=Mixed-effects models in s and s-PLUS;citation_publisher=Springer New York;citation_doi=10.1007/978-1-4419-0318-1;citation_author=José C. Pinheiro;citation_author=Douglas M. Bates"/>
  <meta name="citation_reference" content="citation_title=Diagnosing model diagnostics;citation_publisher=Nature Publishing Group;citation_volume=82;citation_doi=10.1038/sj.clpt.6100241;citation_author=MO Karlsson;citation_author=RM Savic"/>
  <meta name="citation_reference" content="citation_title=A tutorial on visual predictive checks;citation_volume=1434;citation_author=MATS O Karlsson;citation_author=NICK Holford"/>
  <meta name="citation_reference" content="citation_title=Perl-speaks-NONMEM (PsN)—a perl module for NONMEM related programming;citation_publisher=Elsevier;citation_volume=75;citation_doi=10.1016/j.cmpb.2003.11.003;citation_author=Lars Lindbom;citation_author=Jakob Ribbing;citation_author=E Niclas Jonsson"/>
  <meta name="citation_reference" content="citation_title=NONMEM users guide introduction to NONMEM 7.2.0;citation_author=Robert J Bauer"/>
  <meta name="citation_reference" content="citation_title=Visualizing statistical models: Removing the blindfold;citation_publisher=Wiley Online Library;citation_volume=8;citation_doi=10.1002/sam.11271;citation_author=Hadley Wickham;citation_author=Dianne Cook;citation_author=Heike Hofmann"/>
  <meta name="citation_reference" content="citation_title=A regression approach to visual predictive checks for population pharmacometric models;citation_publisher=Wiley Online Library;citation_volume=7;citation_doi=10.1002/psp4.12319;citation_author=Kris M Jamsen;citation_author=Kashyap Patel;citation_author=Keith Nieforth;citation_author=Carl MJ Kirkpatrick"/>
  <meta name="citation_reference" content="citation_title=Extensions to the visual predictive check to facilitate model performance evaluation;citation_publisher=Springer;citation_volume=35;citation_doi=10.1007/s10928-007-9081-1;citation_author=Teun M Post;citation_author=Jan I Freijer;citation_author=Bart A Ploeger;citation_author=Meindert Danhof"/>
  <meta name="citation_reference" content="citation_title=Automatic data binning for improved visual diagnosis of pharmacometric models;citation_publisher=Springer;citation_volume=38;citation_doi=10.1007/s10928-011-9223-3;citation_author=Marc Lavielle;citation_author=Kevin Bleakley"/>
  <meta name="citation_reference" content="citation_title=Average shifted histograms: Effective nonparametric density estimations in several dimensions;citation_volume=13;citation_doi=10.1214/aos/1176349654;citation_author=David W Scott"/>
  <meta name="citation_reference" content="citation_title=Standardized visual predictive check versus visual predictive check for model evaluation;citation_publisher=Wiley Online Library;citation_volume=52;citation_doi=10.1177/0091270010390040;citation_author=Diane D Wang;citation_author=Shuzhong Zhang"/>
  <meta name="citation_reference" content="citation_title=Pitfalls of using numerical predictive checks for population physiologically-based pharmacokinetic model evaluation;citation_publisher=Springer;citation_volume=46;citation_doi=10.1007/s10928-019-09636-5;citation_author=Anil R Maharaj;citation_author=Huali Wu;citation_author=Christoph P Hornik;citation_author=Michael Cohen-Wolkowiez"/>
  <meta name="citation_reference" content="citation_title=Modeling and simulation workbench for NONMEM: Tutorial on pirana, PsN, and xpose;citation_publisher=Wiley Online Library;citation_volume=2;citation_doi=10.1038/psp.2013.24;citation_author=Ron J Keizer;citation_author=MO Karlsson;citation_author=A Hooker"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","date","description","draft","author","type","output","bibliography","date_received","volume","issue","slug","journal","pdf_url","citation_url","doi","creative_commons","packages","CTV","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["nlmeVPC: Visual Model Diagnosis for the Nonlinear Mixed Effect Model"]},{"type":"character","attributes":{},"value":["2023-08-26"]},{"type":"character","attributes":{},"value":["A nonlinear mixed effects model is useful when the data are repeatedly measured within the same unit or correlated between units. Such models are widely used in medicine, disease mechanics, pharmacology, ecology, social science, psychology, etc. After fitting the nonlinear mixed effect model, model diagnostics are essential for verifying that the results are reliable. The visual predictive check (VPC) has recently been highlighted as a visual diagnostic tool for pharmacometric models. This method can also be applied to general nonlinear mixed effects models. However, functions for VPCs in existing R packages are specialized for pharmacometric model diagnosis, and are not suitable for general nonlinear mixed effect models. In this paper, we propose nlmeVPC, an R package for the visual diagnosis of various nonlinear mixed effect models. The nlmeVPC package allows for more diverse model diagnostics, including visual diagnostic tools that extend the concept of VPCs along with the capabilities of existing R packages."]},{"type":"logical","attributes":{},"value":[false]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Eun-Hwa Kang"]},{"type":"character","attributes":{},"value":["Ewha Womans University"]},{"type":"character","attributes":{},"value":["Department of Statistics, Ewha Womans University, Seoul, Korea"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address"]}},"value":[{"type":"character","attributes":{},"value":["Myungji Ko"]},{"type":"character","attributes":{},"value":["Ewha Womans University"]},{"type":"character","attributes":{},"value":["Department of Statistics, Ewha Womans University, Seoul, Korea"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Eun-Kyung Lee"]},{"type":"character","attributes":{},"value":["Ewha Womans University"]},{"type":"character","attributes":{},"value":["Department of Statistics, Ewha Womans University, Seoul, Korea"]},{"type":"character","attributes":{},"value":["lee.eunk@ewha.ac.kr"]},{"type":"character","attributes":{},"value":["0000-0003-0817-5000"]}]}]},{"type":"character","attributes":{},"value":["package"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["EunKyung_Lee.bib"]},{"type":"character","attributes":{},"value":["2022-02-24"]},{"type":"integer","attributes":{},"value":[15]},{"type":"integer","attributes":{},"value":[1]},{"type":"character","attributes":{},"value":["RJ-2023-026"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["The R Journal"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"integer","attributes":{},"value":[83]},{"type":"integer","attributes":{},"value":[100]}]},{"type":"character","attributes":{},"value":["RJ-2023-026.pdf"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2023-026"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2023-026"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["nlmeVPC","xpose4","vpc","nlmixr2","ggplot2","quantreg","nlme","nlraa"]},{"type":"list","attributes":{},"value":[]}]},{"type":"character","attributes":{},"value":["Agriculture","ChemPhys","DifferentialEquations","Econometrics","Environmetrics","Finance","HighPerformanceComputing","MixedModels","OfficialStatistics","Optimization","Pharmacokinetics","Phylogenetics","Psychometrics","ReproducibleResearch","Robust","Spatial","SpatioTemporal","Survival","TeachingStatistics"]},{"type":"character","attributes":{},"value":["/Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/library/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2023-026/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["2022-52-copyedit.pdf","CoverLetter_Lee.pdf","data/simdataF.rda","data/simdataT.rda","distill-preview.png","EunKyung_Lee.bib","EunKyung_Lee.tex","EunKyungLee_files/figure-html5/Fig0-1.png","EunKyungLee_files/figure-html5/Fig1-1.png","EunKyungLee_files/figure-html5/Fig2-1.png","EunKyungLee_files/figure-html5/Fig3-1.png","EunKyungLee_files/figure-html5/Fig4-1.png","EunKyungLee_files/figure-html5/Fig5-1.png","EunKyungLee_files/figure-html5/M11-1.png","EunKyungLee_files/figure-html5/M12-1.png","EunKyungLee_files/figure-html5/M13-1.png","EunKyungLee_files/figure-html5/M14-1.png","EunKyungLee_files/figure-html5/M15-1.png","EunKyungLee_files/figure-html5/M16-1.png","EunKyungLee_files/figure-html5/M17-1.png","EunKyungLee_files/figure-html5/M18-1.png","EunKyungLee_files/figure-latex/Fig0-1.pdf","EunKyungLee_files/figure-latex/Fig1-1.pdf","EunKyungLee_files/figure-latex/Fig2-1.pdf","EunKyungLee_files/figure-latex/Fig3-1.pdf","EunKyungLee_files/figure-latex/Fig4-1.pdf","EunKyungLee_files/figure-latex/Fig5-1.pdf","EunKyungLee_files/figure-latex/M11-1.pdf","EunKyungLee_files/figure-latex/M12-1.pdf","EunKyungLee_files/figure-latex/M13-1.pdf","EunKyungLee_files/figure-latex/M14-1.pdf","EunKyungLee_files/figure-latex/M15-1.pdf","EunKyungLee_files/figure-latex/M16-1.pdf","EunKyungLee_files/figure-latex/M17-1.pdf","EunKyungLee_files/figure-latex/M18-1.pdf","EunKyungLee.knit.md~","EunKyungLee.log","EunKyungLee.tex","plotP/fig-002.pdf","plotP/fig-004.pdf","plotP/fig-007.pdf","plotP/fig-008.pdf","plotP/fig-010.pdf","plotP/fig-013.pdf","plotP/fig-015.pdf","plotP/fig-017.pdf","plotP/fig-020.pdf","plotP/fig-022.pdf","plotP/fig-024.pdf","plotP/fig-026.pdf","plotP/fig-028.pdf","plotP/fig-030.pdf","plotP/fig-032.pdf","plotP/fig-035.pdf","plotP/fig-037.pdf","plotP/fig-039.pdf","plotP/fig-041.pdf","plotP/fig-043.pdf","plotP/fig-045.pdf","plotP/fig-047.pdf","plotP/fig-049.pdf","plotP/fig-051.pdf","plotP/fig-053.pdf","plotP/fig-055.pdf","plotP/fig-056.pdf","plotPNG/Fig0-1.png","plotPNG/Fig1-1.png","plotPNG/Fig2-1.png","plotPNG/Fig3-1.png","plotPNG/Fig4-1.png","plotPNG/Fig5-1.png","plotPNG/M11-1.png","plotPNG/M12-1.png","plotPNG/M13-1.png","plotPNG/M14-1.png","plotPNG/M15-1.png","plotPNG/M16-1.png","plotPNG/M17-1.png","plotPNG/M18-1.png","ResponseToReviewer.pdf","RJ-2023-026_files/figure-html5/Fig0-1.png","RJ-2023-026_files/figure-html5/Fig1-1.png","RJ-2023-026_files/figure-html5/Fig2-1.png","RJ-2023-026_files/figure-html5/Fig3-1.png","RJ-2023-026_files/figure-html5/Fig4-1.png","RJ-2023-026_files/figure-html5/Fig5-1.png","RJ-2023-026_files/figure-html5/M11-1.png","RJ-2023-026_files/figure-html5/M12-1.png","RJ-2023-026_files/figure-html5/M13-1.png","RJ-2023-026_files/figure-html5/M14-1.png","RJ-2023-026_files/figure-html5/M15-1.png","RJ-2023-026_files/figure-html5/M16-1.png","RJ-2023-026_files/figure-html5/M17-1.png","RJ-2023-026_files/figure-html5/M18-1.png","RJ-2023-026_files/figure-latex/Fig0-1.pdf","RJ-2023-026_files/figure-latex/Fig1-1.pdf","RJ-2023-026_files/figure-latex/Fig2-1.pdf","RJ-2023-026_files/figure-latex/Fig3-1.pdf","RJ-2023-026_files/figure-latex/Fig4-1.pdf","RJ-2023-026_files/figure-latex/Fig5-1.pdf","RJ-2023-026_files/figure-latex/M11-1.pdf","RJ-2023-026_files/figure-latex/M12-1.pdf","RJ-2023-026_files/figure-latex/M13-1.pdf","RJ-2023-026_files/figure-latex/M14-1.pdf","RJ-2023-026_files/figure-latex/M15-1.pdf","RJ-2023-026_files/figure-latex/M16-1.pdf","RJ-2023-026_files/figure-latex/M17-1.pdf","RJ-2023-026_files/figure-latex/M18-1.pdf","RJ-2023-026.log","RJ-2023-026.pdf","RJ-2023-026.tex","RJournal.sty","RJwrapper.aux","RJwrapper.log","RJwrapper.out","RJwrapper.tex","Rlogo-5.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.25/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const cite_url = get_meta('citation_url', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="' + slug + '.zip" class="dt-tag"><i class="fas fa-file-zipper"></i> Supplement</a>')


      const abstract = $('<d-abstract>')
      abstract.append('<b>Abstract:</b><br>')
      abstract.append($("d-title p:not(:empty)").first()) // Move description to d-abstract
      $("d-title p:empty").remove() // Remove empty paragraphs after title
      abstract.append(buttons)
      abstract.insertAfter($('d-title')) // Add abstract section after title

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const year = ((jrtitle == "R News") ? 2000 : 2008) + parseInt(volume)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<a class="volume" href="../../issues/'+year+'-'+issue+'">'+volume+'/'+issue+'</a>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }

    .header-section-number {
      margin-right: 0.5em;
    }
    
    d-appendix .citation-appendix,
    .d-appendix .citation-appendix {
      color: rgb(60, 60, 60);
    }

    d-article h2 {
      border-bottom: 0px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 0rem;
    }
    d-article h3 {
      font-size: 20px;
    }
    d-article h4 {
      font-size: 18px;
      text-transform: none;
    }

    @media (min-width: 1024px) {
      d-article h2 {
        font-size: 32px;
      }
      d-article h3 {
        font-size: 24px;
      }
      d-article h4 {
        font-size: 20px;
      }
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"nlmeVPC: Visual Model Diagnosis for the Nonlinear Mixed Effect Model","description":"A nonlinear mixed effects model is useful when the data are repeatedly measured within the same unit or correlated between units. Such models are widely used in medicine, disease mechanics, pharmacology, ecology, social science, psychology, etc. After fitting the nonlinear mixed effect model, model diagnostics are essential for verifying that the results are reliable. The visual predictive check (VPC) has recently been highlighted as a visual diagnostic tool for pharmacometric models. This method can also be applied to general nonlinear mixed effects models. However, functions for VPCs in existing R packages are specialized for pharmacometric model diagnosis, and are not suitable for general nonlinear mixed effect models. In this paper, we propose nlmeVPC, an R package for the visual diagnosis of various nonlinear mixed effect models. The nlmeVPC package allows for more diverse model diagnostics, including visual diagnostic tools that extend the concept of VPCs along with the capabilities of existing R packages.","doi":"10.32614/RJ-2023-026","authors":[{"author":"Eun-Hwa Kang","authorURL":"#","affiliation":"Ewha Womans University","affiliationURL":"#","orcidID":""},{"author":"Myungji Ko","authorURL":"#","affiliation":"Ewha Womans University","affiliationURL":"#","orcidID":""},{"author":"Eun-Kyung Lee","authorURL":"#","affiliation":"Ewha Womans University","affiliationURL":"#","orcidID":"0000-0003-0817-5000"}],"publishedDate":"2023-08-26T00:00:00.000+00:00","citationText":"Kang, et al., 2023"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../issues/2024-1">Current</a>
<a href="../../issues.html">Issues</a>
<a href="../../news.html">News</a>
<a href="../../submissions.html">Submit</a>
<a href="../../editors.html">Editorial board</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>nlmeVPC: Visual Model Diagnosis for the Nonlinear Mixed Effect Model</h1>

<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>A nonlinear mixed effects model is useful when the data are repeatedly measured within the same unit or correlated between units. Such models are widely used in medicine, disease mechanics, pharmacology, ecology, social science, psychology, etc. After fitting the nonlinear mixed effect model, model diagnostics are essential for verifying that the results are reliable. The visual predictive check (VPC) has recently been highlighted as a visual diagnostic tool for pharmacometric models. This method can also be applied to general nonlinear mixed effects models. However, functions for VPCs in existing R packages are specialized for pharmacometric model diagnosis, and are not suitable for general nonlinear mixed effect models. In this paper, we propose nlmeVPC, an R package for the visual diagnosis of various nonlinear mixed effect models. The nlmeVPC package allows for more diverse model diagnostics, including visual diagnostic tools that extend the concept of VPCs along with the capabilities of existing R packages.</p></p>
</div>

<div class="d-byline">
  Eun-Hwa Kang  (Ewha Womans University)
  
,   Myungji Ko  (Ewha Womans University)
  
,   Eun-Kyung Lee  (Ewha Womans University)
  
<br/>2023-08-26
</div>

<div class="d-article">
<h2 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>After fitting a model, diagnosing the fitted model is essential for verifying that the results are reliable <span class="citation" data-cites="nguyen2017model">(<a href="#ref-nguyen2017model" role="doc-biblioref">Nguyen et al. 2017</a>)</span>. For linear models, the residuals are usually used to determine the goodness of fit of the fitted model. However, due to random effects and nonlinearity, residuals are less useful for diagnosing fit in nonlinear mixed effects models. Therefore, various diagnostic tools for this type of model have been developed. The nonlinear mixed effect model is useful when the data are repeatedly measured within the same unit, or the relationship between the dependent and independent variables is nonlinear. It is widely used in various fields, including medicine, disease mechanics, pharmacology, ecology, pharmacometrics, social science, and psychology <span class="citation" data-cites="pinheiro2006mixed davidian2017nonlinear">(<a href="#ref-pinheiro2006mixed" role="doc-biblioref">Pinheiro and Bates 2000</a>; <a href="#ref-davidian2017nonlinear" role="doc-biblioref">Davidian 2017</a>)</span>. Recently, among the various diagnostic tools applicable to nonlinear mixed models, simulation-based diagnostic methods have been developed in the field of pharmacology <span class="citation" data-cites="karlsson2007diagnosing">(<a href="#ref-karlsson2007diagnosing" role="doc-biblioref">Karlsson and Savic 2007</a>)</span>. The visual predictive check (VPC; <span class="citation" data-cites="karlsson2008tutorial">Karlsson and Holford (<a href="#ref-karlsson2008tutorial" role="doc-biblioref">2008</a>)</span>) is a critical diagnostic tool that visually tests for the adequacy of the fitted model. It allows for the diagnosis of fixed and random effects in mixed models <span class="citation" data-cites="karlsson2008tutorial">(<a href="#ref-karlsson2008tutorial" role="doc-biblioref">Karlsson and Holford 2008</a>)</span> in the original data space.
Currently, it is a widely used method for diagnosing population pharmacometric models:
<span class="citation" data-cites="heus2022model">Heus et al. (<a href="#ref-heus2022model" role="doc-biblioref">2022</a>)</span> used the VPC method to evaluate their population pharmacokinetic models of vancomycin, <span class="citation" data-cites="mudde2022predictive">Mudde et al. (<a href="#ref-mudde2022predictive" role="doc-biblioref">2022</a>)</span> checked their final population PK model for each regimen of antituberculosis drug using the VPC method, and <span class="citation" data-cites="otto2021predictive">Otto et al. (<a href="#ref-otto2021predictive" role="doc-biblioref">2021</a>)</span> compares the predictive performance of parent-metabolite models of (S)-ketamine with the VPC method. This VPC method can be used for general nonlinear mixed effect models, including hierarchical models.</p>
<p>The <a href="#">psn</a> <span class="citation" data-cites="lindbom2004perl">(<a href="#ref-lindbom2004perl" role="doc-biblioref">Lindbom et al. 2004</a>)</span> and <a href="https://cran.r-project.org/package=xpose4">xpose4</a> <span class="citation" data-cites="keizer2013modeling">(<a href="#ref-keizer2013modeling" role="doc-biblioref">Keizer et al. 2013</a>)</span> packages provide various diagnostic methods for pharmacometric models in R <span class="citation" data-cites="R">(<a href="#ref-R" role="doc-biblioref">R Core Team 2023</a>)</span>, including the VPC plot. These packages were developed only for the pharmacometricians, and the users needed to use the NONMEM software <span class="citation" data-cites="bauer2011nonmem">(<a href="#ref-bauer2011nonmem" role="doc-biblioref">Bauer 2011</a>)</span> for generating inputs of functions in these two packages. However, NONMEM is licensed software, and it is mainly designed towards the analysis of population pharmacometric models. Therefore, it is not easy for nonpharmacometrician to use NONMEM and to draw the VPC plot through <a href="#">psn</a> and <a href="#">xpose4</a>. Recently, the <a href="https://cran.r-project.org/package=vpc">vpc</a> <span class="citation" data-cites="keizer2018vpc">(<a href="#ref-keizer2018vpc" role="doc-biblioref">Keizer 2021</a>)</span> package and <a href="https://cran.r-project.org/package=nlmixr2">nlmixr2</a> <span class="citation" data-cites="fidler2019nonlinear">(<a href="#ref-fidler2019nonlinear" role="doc-biblioref">Fidler et al. 2019</a>)</span> package have been developed to draw VPC plots in R without results from NONMEM. However, <a href="#">vpc</a> package provides the function for drawing the original VPC plot only. <a href="#">nlmixr2</a> was developed initially for fitting general dynamic models. To check the fitted model, <a href="#">nlmixr2</a> provides a function to use graphical diagnostics in <a href="#">xpose4</a> with the <code>nlmixr2</code> model object. Also, <a href="#">nlmixr2</a> uses the VPC plot in the <a href="#">vpc</a> package with the <code>nlmixr2</code> model object. Therefore, both packages only provide a function to draw the basic VPC plot, and the other newly developed simulation-based methods, including extensions of VPC, are not provided.</p>
<p>We have developed a new R package, <a href="#">nlmeVPC</a>, to provide a suite for various visual checking methods for the nonlinear mixed models. This package includes various state-of-the-art model diagnostic methods based on the visual comparison between the original and simulated data. Most methods compare the statistics calculated from the observed data to the statistics from the simulated data. Percentiles, for example, the <span class="math inline">\(10^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, and <span class="math inline">\(90^{th}\)</span> percentiles, are widely used to summarize relevant statistics from the observed and simulated data. We compare the similarities between the statistics from the observed data and those from the simulated data in two different spaces: the data space and the model space <span class="citation" data-cites="wickham2015visualizing">(<a href="#ref-wickham2015visualizing" role="doc-biblioref">Wickham et al. 2015</a>)</span>. The original data comprise the data space. Usually, the data space is represented by the independent and dependent variables, such as time and blood concentration, in the pharmacokinetic data. On the other hand, the model space is composed of quantities obtained from the fitted model, for example, residuals and summary values from the fitted model. From this viewpoint, we categorize the well-known visual diagnostic tools into two categories. One method compares the observed and simulated data in the original data space, and the other in the model space. In the method with the data space, we developed functions for the original VPC (<code>VPCgraph</code>), the additive quantile regression VPC (<code>aqrVPC</code>), and the bootstrap VPC (<code>bootVPC</code>). In addition, we proposed a new VPC method: the average shifted VPC (<code>asVPC</code>). In the method with the model space, the coverage plot (<code>coverageplot</code>) and the quantified VPC (<code>quantVPC</code>) are included. For a more detailed diagnosis, we developed a coverage detailed plot (<code>coverageDetailplot</code>). In <a href="#">nlmeVPC</a>, the <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> package <span class="citation" data-cites="ggplot2Hadley2nd">(<a href="#ref-ggplot2Hadley2nd" role="doc-biblioref">Wickham 2016</a>)</span> is used to create all plots.</p>
<h2 data-number="2" id="nonlinear-mixed-effect-model"><span class="header-section-number">2</span> Nonlinear mixed effect model</h2>
<p>The general nonlinear mixed effect model is defined as follow:
<span class="math display">\[
y_{ij} = f(x_{ij}, \theta, \eta_i, \epsilon_{ij}) \\
\eta_i \sim N(0,\Omega) \nonumber\\
\epsilon_{ij}  \sim N(0, \Sigma)\nonumber
\]</span>
where <span class="math inline">\(y_{ij}\)</span> is the dependent variable of the <span class="math inline">\(j^{th}\)</span> observation of the <span class="math inline">\(i^{th}\)</span> individual, <span class="math inline">\(x_{ij}\)</span> is the independent variable, <span class="math inline">\(f\)</span> is the nonlinear function of <span class="math inline">\(x_{ij}\)</span>, <span class="math inline">\(\theta\)</span> is the population parameter, <span class="math inline">\(\eta_i\)</span> represents the variability of the individual <span class="math inline">\(i\)</span>, and <span class="math inline">\(\epsilon_{ij}\)</span> represents the random error. From the data, <span class="math inline">\(\theta\)</span> , <span class="math inline">\(\Omega\)</span>, and <span class="math inline">\(\Sigma\)</span> are estimated. For the simulated data, the fitted model <span class="math inline">\(y_{ij} = f(x_{ij}, \hat{\theta}, \eta_i, \epsilon_{ij})\)</span>, <span class="math inline">\(\eta_i \sim N(0,\hat\Omega)\)</span>, <span class="math inline">\(\epsilon_{ij} \sim N(0, \hat\Sigma)\)</span> are used.</p>
<h2 data-number="3" id="validation-in-the-data-space"><span class="header-section-number">3</span> Validation in the data space</h2>
<p>The VPC is the most popular model validation method in the pharmacometrics area. It was developed to diagnose population pharmacokinetic/pharmacodynamic models visually.
The main idea of the VPC is to compare the distribution of observations and the distribution of predicted values, where the distribution of predicted values is obtained from simulated data drawn from the fitted model. If the fitted model explains the observed data well, these two distributions should be similar.
Both distributions can be represented in the original data space that consists X axis as the independent variable and Y axis as the dependent variable.
It allows us to compare the observed data with the fitted model in the original data space. In <a href="#">nlmeVPC</a>, we include an original VPC plot, an additive quantile regression VPC <span class="citation" data-cites="jamsen2018regression">(<a href="#ref-jamsen2018regression" role="doc-biblioref">Jamsen et al. 2018</a>)</span>, and a bootstrap VPC <span class="citation" data-cites="post2008extensions">(<a href="#ref-post2008extensions" role="doc-biblioref">Post et al. 2008</a>)</span>. We also proposed a new approach to draw the VPC: the average shifted VPC.</p>
<h3 data-number="3.1" id="visual-predictive-check"><span class="header-section-number">3.1</span> Visual Predictive Check</h3>
<p>The visual predictive check (VPC; <span class="citation" data-cites="karlsson2008tutorial">Karlsson and Holford (<a href="#ref-karlsson2008tutorial" role="doc-biblioref">2008</a>)</span>) is based on the principle that if the fitted model adequately describes the observed data, the distribution of the simulated data from the fitted model should be similar to the distribution of the observed data. There are several ways to compare the similarities between the distributions. In the VPC approach, profiles of quantiles are used. Two profiles are mainly used to compare the distributions of observations and predictions. One profile is from the upper bound of the prediction intervals, and the other is from the lower bound. These prediction intervals are calculated from the simulated data. 90<span class="math inline">\(\%\)</span> prediction intervals are usually used. For small and sparse samples, 80<span class="math inline">\(\%\)</span> prediction interval is also used. The lower and upper bounds of 80<span class="math inline">\(\%\)</span> prediction interval are the <span class="math inline">\(10^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentiles of the simulated data. Figure <a href="#fig:Fig0">1</a>(A) shows the “scatter” type of the VPC plot. Dots indicate the observed data. Two dashed blue lines represent profiles of the <span class="math inline">\(10^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentiles of the simulated data, and the solid blue line represents the <span class="math inline">\(50^{th}\)</span> percentile. If the fitted model represents the observed data well, most observed data should lie between profiles of <span class="math inline">\(10^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentiles.</p>
<p>Figure <a href="#fig:Fig0">1</a>(B) is the “percentile” type of the VPC plot. In this plot, profiles of percentiles from the observed data are compared to profiles of percentiles from the simulated data. Two dashed red lines represent profiles of the <span class="math inline">\(10^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentiles of the observed data, and the solid red line represents profiles of the <span class="math inline">\(50^{th}\)</span> percentile of the observed data. If the fitted model represents the observed data well, two profiles in each percentile - one from the original data and the other from the simulated data - are similar.</p>
<p>Figure <a href="#fig:Fig0">1</a>(C) is the “CI” type of the VPC plot. The solid red line represents the <span class="math inline">\(50^{th}\)</span> percentile of the observed data, and dashed red lines represent the <span class="math inline">\(10^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentiles of the observed data. Light blue areas represent the 95<span class="math inline">\(\%\)</span> confidence areas of the <span class="math inline">\(10^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentiles, and pink areas represent the 95<span class="math inline">\(\%\)</span> confidence areas of the <span class="math inline">\(50^{th}\)</span> percentile. These confidence areas were calculated from the simulated data. After calculating percentiles in each simulated data, we find 95<span class="math inline">\(\%\)</span> confidence intervals for each percentile and use this to draw the areas. In this plot, it is necessary to verify that the profiles of the original data are in confidence areas of each profile from the simulated data in each percentile. If each percentile line of the observed data is in the corresponding confidence area, this can be evidence
that the fitted model represents the observed data quite well. Otherwise, the fitted model needs to be improved. The “CI” type of the VPC plot is the most widely used type in pharmacometrics.</p>
<p>The percentiles of the dependent variable are calculated in each bin. To estimate the percentiles accurately, enough data points need to lie within each bin. No binning means that the number of bins is equal to the number of different independent variable values. In this case, the VPC plot shows all details of the relationship between the independent and dependent variables. However, the resulting lines become too irregular to show meaningful trends or patterns.</p>
<p>As the number of bins decreases, the lines become smoother and more regular, however this can come at the loss of information if too much smoothing is used. Therefore, the selection of the best number of bins is crucial. The way of determining cutoffs for bin also plays an important role. <span class="citation" data-cites="lavielle2011automatic">Lavielle and Bleakley (<a href="#ref-lavielle2011automatic" role="doc-biblioref">2011</a>)</span> proposed a procedure for finding the optimal bin configuration automatically, including the optimal number of bins and the optimal bin cutoffs.
<code>VPCgraph</code> provides the automatic binning with <code>optK</code> and <code>makeCOVbin</code>; here, <code>optK</code> finds the optimal number of bins, and <code>makeCOVbin</code> finds the optimal cutoffs of bins using Lavielle and Bleakley’s method.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:Fig0"></span>
<img src="RJ-2023-026_files/figure-html5/Fig0-1.png" alt="The visual predictive check plot. The solid red line represents the $50^{th}$ percentile of the observed data, and dashed red lines represent the $10^{th}$ and $90^{th}$ percentiles of the observed data. The solid blue line represents the $50^{th}$ percentile of the simularted data, and dashed blue lines represent the $10^{th}$ and $90^{th}$ percentiles of the simulated data. Light blue and pink areas represent the 95\% confidence areas of the $10^{th}$, $50^{th}$ and $90^{th}$ percentile lines." width="100%" />
<p class="caption">
Figure 1: The visual predictive check plot. The solid red line represents the <span class="math inline">\(50^{th}\)</span> percentile of the observed data, and dashed red lines represent the <span class="math inline">\(10^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentiles of the observed data. The solid blue line represents the <span class="math inline">\(50^{th}\)</span> percentile of the simularted data, and dashed blue lines represent the <span class="math inline">\(10^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentiles of the simulated data. Light blue and pink areas represent the 95% confidence areas of the <span class="math inline">\(10^{th}\)</span>, <span class="math inline">\(50^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentile lines.
</p>
</div>
</div>
<h3 data-number="3.2" id="additive-quantile-regression-vpc"><span class="header-section-number">3.2</span> Additive quantile regression VPC</h3>
<p>To overcome the difficulties of making bins as well as determining the number of bins,
<span class="citation" data-cites="jamsen2018regression">Jamsen et al. (<a href="#ref-jamsen2018regression" role="doc-biblioref">2018</a>)</span> used additive quantile regression to calculate the quantiles of the observed and simulated data. This regression method makes it possible to estimate quantiles without discrete binning, which is especially useful when the data are insufficient, irregular, or inappropriate to configure the bins. To fit the additive quantile regression, we used the <code>rqss</code> function in the <a href="https://cran.r-project.org/package=quantreg">quantreg</a> <span class="citation" data-cites="quantreg">(<a href="#ref-quantreg" role="doc-biblioref">Koenker 2023</a>)</span> package and developed the <code>aqrVPC</code> function to draw the VPC type plot with additive quantile regression. Figure <a href="#fig:Fig1">2</a> shows the additive quantile regression VPC plot. The solid and dashed lines represent the <span class="math inline">\(10^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, and <span class="math inline">\(90^{th}\)</span> additive quantile regression lines of the observed data, and the pink and light blue areas represent the confidence areas of the additive quantile regression lines of the simulated data. Lines and areas in the additive quantile regression VPC plot are much smoother than those in the original VPC plot.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:Fig1"></span>
<img src="RJ-2023-026_files/figure-html5/Fig1-1.png" alt="The additive equantile VPC plot.  Dots indicate the observed data. The solid and dashed blue lines represent the $10^{th}$, $50^{th}$, and $90^{th}$ percentiles of the simulated data. The solid red line represents the $50^{th}$ percentile line. Light blue and pink areas represent the 95\% confidence areas of the $10^{th}$, $50^{th}$ and $90^{th}$ percentile lines." width="100%" />
<p class="caption">
Figure 2: The additive equantile VPC plot. Dots indicate the observed data. The solid and dashed blue lines represent the <span class="math inline">\(10^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, and <span class="math inline">\(90^{th}\)</span> percentiles of the simulated data. The solid red line represents the <span class="math inline">\(50^{th}\)</span> percentile line. Light blue and pink areas represent the 95% confidence areas of the <span class="math inline">\(10^{th}\)</span>, <span class="math inline">\(50^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentile lines.
</p>
</div>
</div>
<h3 data-number="3.3" id="bootstrap-vpc"><span class="header-section-number">3.3</span> Bootstrap VPC</h3>
<p>The bootstrap VPC <span class="citation" data-cites="post2008extensions">(<a href="#ref-post2008extensions" role="doc-biblioref">Post et al. 2008</a>)</span> compares the distribution of the simulated data to the distribution of the bootstrap samples drawn from the observed data.
This plot reflects the uncertainty of the observed data and allows for more objective comparisons with the predicted median.</p>
<p>Figure <a href="#fig:Fig2">3</a> shows the bootstrap VPC plot using <code>bootVPC</code>. The solid and dashed blue lines represent the <span class="math inline">\(10^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, and <span class="math inline">\(90^{th}\)</span> percentiles of the simulated data. The solid red line represents the <span class="math inline">\(50^{th}\)</span> percentile line, and the pink areas represent the 95<span class="math inline">\(\%\)</span> confidence areas of the <span class="math inline">\(50^{th}\)</span> percentile line, calculated from the bootstrap samples of the observed data. If the solid blue line and the solid red line are similar, the solid blue line is in the pink area, and the pink area is located between two dashed blue lines,
then this is evidence that the fitted model fit the observed data well.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:Fig2"></span>
<img src="RJ-2023-026_files/figure-html5/Fig2-1.png" alt="The bootstrap VPC plot. Dots indicate the observed data. The solid and dashed blue lines represent the $10^{th}$, $50^{th}$, and $90^{th}$ percentiles of the simulated data. The solid red line represents the $50^{th}$ percentile line, and the pink areas represent the 95\% confidence areas of the $50^{th}$ percentile line, calculated from the bootstrap samples of the observed data." width="100%" />
<p class="caption">
Figure 3: The bootstrap VPC plot. Dots indicate the observed data. The solid and dashed blue lines represent the <span class="math inline">\(10^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, and <span class="math inline">\(90^{th}\)</span> percentiles of the simulated data. The solid red line represents the <span class="math inline">\(50^{th}\)</span> percentile line, and the pink areas represent the 95% confidence areas of the <span class="math inline">\(50^{th}\)</span> percentile line, calculated from the bootstrap samples of the observed data.
</p>
</div>
</div>
<h3 data-number="3.4" id="average-shifted-vpc"><span class="header-section-number">3.4</span> Average shifted VPC</h3>
<p>Even though binning mitigates the problem with highly irregular data, the VPC plot still has a precision problem with sparse data. In this paper, we propose a new approach to draw the adapted VPC plot from the average shifted histograms <span class="citation" data-cites="scott1985ash">(<a href="#ref-scott1985ash" role="doc-biblioref">Scott 1985</a>)</span>.
A histogram is a widely used method for displaying the density of a single continuous variable. However, histograms can look quite different based on different choice of bin width and anchor.
This requires computing an optimal bin width.
To overcome the problem with the choice of bin width and to obtain smoother estimates, <span class="citation" data-cites="scott1985ash">Scott (<a href="#ref-scott1985ash" role="doc-biblioref">1985</a>)</span> proposed the averaged shifted histogram (ASH). The idea behind ASH is to make <span class="math inline">\(K\)</span> different histograms with different anchors and to combine them via a weighted average. For each histogram, the starting point is shifted by <span class="math inline">\(d/K\)</span>, where <span class="math inline">\(d\)</span> is the width of the bin. We extend this idea to the VPC graph and propose the average shifted visual predictive check (asVPC) plot.</p>
<p>The binning of the VPC varies from the traditional binning in a histogram. The width of the bins is determined such that each bins contains the same, fixed number of observations, and as such the width of each bin is different. To apply the ASH idea to the VPC, we divide our data into <span class="math inline">\(K*B\)</span> bins along with the independent variable, where each bin has a different width but the same number of observations. Here, <span class="math inline">\(B\)</span> is the number of the original bins in the VPC plot, and <span class="math inline">\(K\)</span> is the number of the histograms averaged in the asVPC plot.</p>
<p>To draw the VPC plots, the following information is needed from each bin:</p>
<ol type="A">
<li><p>the median of the independent variable and percentiles of the dependent variable of the observed data.</p></li>
<li><p>the median of the independent variable and percentiles of the dependent variable of the simulated data.</p></li>
<li><p>95<span class="math inline">\(\%\)</span> confidence interval of percentiles (usually <span class="math inline">\(10^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, and <span class="math inline">\(90^{th}\)</span> percentiles) of the dependent variable, calculated from the simulated data.</p></li>
</ol>
<p>These values are also needed to produce confidence areas and percentile lines in the asVPC plot. Furthermore, additional steps are needed for asVPC. To find the median of the independent variable and percentiles of the dependent variable using the ASH algorithm, the following procedures are needed:</p>
<ol type="1">
<li><p>Divide the independent variable into <span class="math inline">\(N=K*B\)</span> bins.</p></li>
<li><p>For <span class="math inline">\(i = 1, \cdots, N\)</span>,</p>
<ol type="a">
<li>If <span class="math inline">\(i &lt; K\)</span>, combine <span class="math inline">\(bin_1, \cdots, bin_{i+K-1}\)</span>\
else if <span class="math inline">\(K\le i\le N-K\)</span> , combine <span class="math inline">\(bin_{i-K+1}, \cdots, bin_{i+K-1}\)</span>\
else if <span class="math inline">\(N-K &lt; i\)</span> , combine <span class="math inline">\(bin_{i-K+1}, \cdots, bin_N\)</span></li>
<li>Calculate the median of the independent variable and the weighted percentiles of the dependent variable in the combined bin</li>
</ol></li>
<li><p>Collect the medians of the independent variable and the weighted percentiles of the dependent variable from 2, and connect them to the lines.</p></li>
</ol>
<p>We can implement (A) and (B) by applying these procedures separately to the observed and simulated data. Additionally, (C) can be implemented using these procedures for each simulated dataset. First, we find the weighted percentiles, combine the results from each simulated dataset, and then calculate the 95<span class="math inline">\(\%\)</span> confidence intervals of each percentile. Using these three quantities (A), (B), and (C), we can draw the VPC type plot with the ASH approach, producing the asVPC plot.</p>
<h4 class="unnumbered" data-number="3.4.1" id="determining-the-weights">Determining the weights</h4>
<p>In the asVPC plot, the observations in each bin are combined using weights. Typically, the data near the center of the integrated bin have higher weights, and the data far from the center have smaller weights. This idea is used in the ASH algorithm as well as the density estimation literature. We suggest two different ways to apply weights for the asVPC calculation.</p>
<ul>
<li><p>Bin-related weight: For each bin in the combined bin, K-1 bins in both directions have weights and the other bins have no weight. Use <span class="math inline">\(\frac{1}{K}\)</span>, <span class="math inline">\(\cdots\)</span>, <span class="math inline">\(\frac{i-1}{K}\)</span>, <span class="math inline">\(\cdots\)</span>, <span class="math inline">\(\frac{K-1}{K}\)</span>, <span class="math inline">\(1\)</span>, <span class="math inline">\(\frac{K-1}{K}\)</span>, <span class="math inline">\(\cdots\)</span>, <span class="math inline">\(\frac{i-1}{K}\)</span>, <span class="math inline">\(\cdots\)</span>, <span class="math inline">\(\frac{1}{K}\)</span> as weights for 2K-1 bins. This approach is the same as the original ASH approach.</p></li>
<li><p>Distance-related weight: Use the reciprocal of the distance from the center of the independent variable in each combined bin so that the points near the center have higher weights and the points far from the center have lower weights.</p></li>
</ul>
<p>Figure <a href="#fig:Fig3">4</a> shows the results from the <code>asVPC</code> function using bin-related weights and distance-related weights. The solid and dashed lines represent the average shifted quantile lines of the observed data, and the pink and light blue areas represent the confidence areas of the simulated data. The lines in the asVPC plot are smoother than those in the original VPC plot, and the confidence areas in the asVPC plot are thinner than those in the original VPC plot.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:Fig3"></span>
<img src="RJ-2023-026_files/figure-html5/Fig3-1.png" alt="The average shifted VPC plot. Dots indicate the observed data. The solid line represents the 50th quantiles of the observed data, and dashed lines represent the $10^{th}$ and $90^{th}$ percentiles of the observed data. Light blue and pink areas represent the 95\% confidence areas of the $10^{th}$, $50^{th}$, and $90^{th}$ percentiles." width="100%" />
<p class="caption">
Figure 4: The average shifted VPC plot. Dots indicate the observed data. The solid line represents the 50th quantiles of the observed data, and dashed lines represent the <span class="math inline">\(10^{th}\)</span> and <span class="math inline">\(90^{th}\)</span> percentiles of the observed data. Light blue and pink areas represent the 95% confidence areas of the <span class="math inline">\(10^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, and <span class="math inline">\(90^{th}\)</span> percentiles.
</p>
</div>
</div>
<h2 data-number="4" id="validation-in-the-model-space"><span class="header-section-number">4</span> Validation in the model space</h2>
<p>To validate the fitted model in the model space, we need to choose appropriate statistics to visualize and describe them in the model space. In <a href="#">nlmeVPC</a>, we use the same statistics, that is quantiles, as the VPC plot in the data space, and compare them in two ways - numerically and visually. The numerical predictive check and the coverage plot are two commonly used methods in pharmacometrics. However, there is a limitation to detecting the illness of the fitted model. These methods combine the results of all ranges of the independent variable, and it is helpful to see the overall fitness. However, it is not easy to detect the detailed discrepancy between the fitted model and the observed data. To overcome this limitation, we developed a new plot, the coverage detailed plot, to compensate for the shortness of the coverage plot.</p>
<h3 data-number="4.1" id="numerical-predictive-check"><span class="header-section-number">4.1</span> Numerical predictive check</h3>
<p>The VPC plot visually compares the observed data to the simulated percentiles in the data space. On the other hand, the numerical predictive check (NPC; <span class="citation" data-cites="wang2012standardized">Wang and Zhang (<a href="#ref-wang2012standardized" role="doc-biblioref">2012</a>)</span>; <span class="citation" data-cites="karlsson2007diagnosing">Karlsson and Savic (<a href="#ref-karlsson2007diagnosing" role="doc-biblioref">2007</a>)</span>)
numerically compares the observed data to the simulated data. For a given level of prediction (for example, 90<span class="math inline">\(\%\)</span>), the predicted interval is calculated using the simulated data, and the number of the observed data points outside of the prediction interval is counted, both below the lower bound and above the upper bound. The expected number of points below the lower bound of the predicted interval (for example, 5<span class="math inline">\(\%\)</span> of observations) is also calculated and compared to the observed number. If these two numbers are similar, the suggested model is suitable <span class="citation" data-cites="maharaj2019pitfalls">(<a href="#ref-maharaj2019pitfalls" role="doc-biblioref">Maharaj et al. 2019</a>)</span>.</p>
<p><code>NumericalCheck</code> provides information summarizing the results of the NPC for various prediction levels.
<code>PI</code> is the prediction level <span class="math inline">\(\times\)</span> 100 and <code>n</code> is the number of observations.
<code>"Expected points below PI"</code> and <code>"Expected points above PI"</code> are respectively the expected numbers below and above the PI; <code>"points below PI"</code> and <code>"points above PI"</code> respectively represent the numbers of points below and above the PI;
<code>"95%CIBelowFrom(%)"</code> and <code>"95%CIBelowTo(%)"</code> represent the 95<span class="math inline">\(\%\)</span> confidence interval of <code>"points below PI(%)"</code>; and <code>"95%CIAboveFrom(%)"</code> and <code>"95%CIAboveTo(%)"</code> represent the 95<span class="math inline">\(\%\)</span> confidence interval of <code>"points above PI(%)"</code>. If <code>"points below PI(%)"</code> is in the
95<span class="math inline">\(\%\)</span> confidence intervals of <code>"points below PI(%)"</code> and is similar to <code>"Expected points below PI"</code>, and if
<code>"points above PI(%)"</code> is in the
95<span class="math inline">\(\%\)</span> confidence intervals of <code>"points above PI(%)"</code> and is similar to <code>"Expected points above PI"</code>, this is the evidence that the fitted model explains the data well.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'>NumericalCheck</span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span>,pred.level<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0.2</span>,<span class='fl'>0.4</span>,<span class='fl'>0.6</span>,<span class='fl'>0.8</span>,<span class='fl'>0.9</span><span class='op'>)</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>$</span><span class='va'>NPC</span></span></code></pre>
</div>
<pre><code>  PI   n Expected points below PI points below PI points below PI(%)
1  0 132                     66.0              57           43.18182
2 20 132                     52.8              46           34.84848
3 40 132                     39.6              37           28.03030
4 60 132                     26.4              27           20.45455
5 80 132                     13.2              17           12.87879
6 90 132                      6.6               7            5.30303
  95%CIBelowFrom(%) 95%CIBelowTo(%) Expected points above PI
1        35.6060606        56.81818                     66.0
2        26.8750000        48.88258                     52.8
3        20.4545455        36.76136                     39.6
4        11.3636364        26.15530                     26.4
5         3.7878788        16.66667                     13.2
6         0.3598485        10.64394                      6.6
  points above PI points above PI(%) 95%CIAboveFrom(%)
1              63          47.727273         34.090909
2              49          37.121212         25.359848
3              35          26.515152         16.666667
4              28          21.212121         10.965909
5              12           9.090909          2.632576
6               5           3.787879          1.117424
  95%CIAboveTo(%)
1       55.303030
2       46.609848
3       36.003788
4       25.000000
5       15.549242
6        8.333333</code></pre>
</div>
<h3 data-number="4.2" id="coverage-plot"><span class="header-section-number">4.2</span> Coverage plot</h3>
<p>The result of the NPC is a table with many values, which, while useful, can be difficult to parse visually. The coverage plot <span class="citation" data-cites="karlsson2008tutorial">(<a href="#ref-karlsson2008tutorial" role="doc-biblioref">Karlsson and Holford 2008</a>)</span> was developed to help visually check the fitted model with the NPC result.
In each level of the predicted interval, the ratios between the expected number of data points (Exp) outside the prediction interval and the observed number of data points (Obs)
outside the prediction interval are calculated. These ratios are calculated separately for the upper and lower bound of the prediction interval. For example, when the prediction level is 90, a 90<span class="math inline">\(\%\)</span> prediction interval is used, and 10<span class="math inline">\(\%\)</span> of the observations are expected to locate outside this prediction interval. To be more precise, 5<span class="math inline">\(\%\)</span> of observations are expected to be above the upper limit, and 5<span class="math inline">\(\%\)</span> of observations are expected to be below the lower limit.</p>
<p>The coverage plot with the NPC result can diagnose a model using multiple prediction intervals. The X-axis represents the prediction level, and the Y-axis represents Obs/Exp. The closer Obs/Exp is to 1, the more appropriate the model is. Furthermore, the confidence intervals of Obs/Exp values are obtained using simulated data and then expressed together in the plot for a more objective comparison. This plot can provide more information than the VPC plot, which interprets only a couple of quantiles - usually the 10<span class="math inline">\(\%\)</span>, 50<span class="math inline">\(\%\)</span>, and 90<span class="math inline">\(\%\)</span> percentiles.</p>
<p>The <a href="#">xpose4</a> package <span class="citation" data-cites="keizer2013modeling">(<a href="#ref-keizer2013modeling" role="doc-biblioref">Keizer et al. 2013</a>)</span> provides a coverage plot. However,
to draw the coverage plot using <a href="#">xpose4</a>, PsN <span class="citation" data-cites="lindbom2004perl">(<a href="#ref-lindbom2004perl" role="doc-biblioref">Lindbom et al. 2004</a>)</span> software is needed to calculate the NPC result. Therefore, we developed <code>coverageplot</code> to draw the coverage plot using the results from <code>NumericalCheck</code>.</p>
<p>Figure <a href="#fig:Fig4">5</a>(A) shows the coverage plot. The X-axis shows the level of the prediction interval. The Y-axis show the ratio between the observed number of data and the expected number of data of the lower and upper parts in each level of the prediction interval. The white line is the reference line, and the gray area represents the confidence areas of the ratios in each prediction level. If the solid lines are near the white line or in the gray area, we can conclude that the suggested model is suitable.</p>
<h3 data-number="4.3" id="coverage-detailed-plot"><span class="header-section-number">4.3</span> Coverage detailed plot</h3>
<p>Unlike the VPC plot, which represents the data space, the information in the observed data space does not come together in the coverage plot, which makes it difficult to determine whether the model is overestimated, underestimated, or adequate in the specific region of the data space. To overcome this limitation of the coverage plot, we propose a new method called the coverage detailed plot.
The percentages of observations above the prediction interval are calculated in each bin of the independent variable. Additionally, the percentages of observations below the prediction interval are calculated. The white dots in the plot represent the expected percentages. If the percentages of upper and lower observations are near the white dots, we can conclude that the suggested model is suitable for the specific prediction interval.</p>
<p>Figure <a href="#fig:Fig4">5</a>(B) is the result of <code>coverageDetailplot</code> when the prediction level is 80<span class="math inline">\(\%\)</span>. The white dots represent the expected percentages of the lower and upper the prediction intervals, 10<span class="math inline">\(\%\)</span>, and 90<span class="math inline">\(\%\)</span>, respectively. The upper and lower percentages of observation in each time bin are shown in darker gray. The left bin(before 0.045 hours) shows all light gray in the coverage detailed plot, and it is quite different patterns from the expected one. However, it is mainly due to the characteristics of this example data. All observations in this bin are 0. It makes the lower and upper bound of the prediction interval all 0, and the lower and upper percentages become 0.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:Fig4"></span>
<img src="RJ-2023-026_files/figure-html5/Fig4-1.png" alt="The coverage plot and the coverage detailed plot for the 80\% prediction interval. In the coverage plot, the X-axis is the level of the prediction interval. The Y-axis is the ratio between the number of observed data and the number of expected data of the lower and upper parts in each level of the prediction interval. The white line is the reference line, and the gray area represents the confidence area of the ratios. If the solid lines are near the white line, we can conclude that the suggested model is suitable. In the coverage detailed plot, the white dots represent the expected percentages of lower and upper prediction intervals of, 10\%, and 90\%, respectively. The upper and lower percentages of observation in each time bin are darker gray." width="90%" />
<p class="caption">
Figure 5: The coverage plot and the coverage detailed plot for the 80% prediction interval. In the coverage plot, the X-axis is the level of the prediction interval. The Y-axis is the ratio between the number of observed data and the number of expected data of the lower and upper parts in each level of the prediction interval. The white line is the reference line, and the gray area represents the confidence area of the ratios. If the solid lines are near the white line, we can conclude that the suggested model is suitable. In the coverage detailed plot, the white dots represent the expected percentages of lower and upper prediction intervals of, 10%, and 90%, respectively. The upper and lower percentages of observation in each time bin are darker gray.
</p>
</div>
</div>
<h3 data-number="4.4" id="quantified-vpc"><span class="header-section-number">4.4</span> Quantified VPC</h3>
<p><span class="citation" data-cites="post2008extensions">Post et al. (<a href="#ref-post2008extensions" role="doc-biblioref">2008</a>)</span> proposed the quantified VPC (QVPC). It expanded the existing VPC, including information about missing data.
The QVPC plot visually represents actual and unavailable observations around the predicted medians through the form of percent, regardless of the observed data’s density or shape. Here, “unavailable observations” refer to all kinds of missing values and unobserved data that occur for various reasons, including deviations and unexpected omissions.</p>
<p>If the model is appropriate, observations at each time bin are allocated randomly around the predicted median of the model. In the QVPC plot, white dots represent the model’s predicted median in each bin. If the borderlines above and below are close to the white dots, we can conclude that the fitted model describes the observed data well.</p>
<p>Figure <a href="#fig:Fig5">6</a> shows the result of <code>quantVPC</code>. The darker gray areas represent the percentages below the median. The lighter gray areas represent the percentage above. The brightest gray areas represent the percent unavailable in each time bin. The white dots represent the ideal location where the above and the below percentages meet. In this example, there is no missing value.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:Fig5"></span>
<img src="RJ-2023-026_files/figure-html5/Fig5-1.png" alt="The quantified VPC plot. The darker gray areas represent the percentages below the median, the lighter gray areas represent the percentage above, and the brightest gray areas represent the percent unavailable in each time bin. The white dots represent the ideal location where the above and the below percentages meet." width="100%" />
<p class="caption">
Figure 6: The quantified VPC plot. The darker gray areas represent the percentages below the median, the lighter gray areas represent the percentage above, and the brightest gray areas represent the percent unavailable in each time bin. The white dots represent the ideal location where the above and the below percentages meet.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table>
<caption>
<span id="tab:table1">Table 1: </span>List of functions to check the validity of model with the observed data and the simulated data
</caption>
<thead>
<tr>
<th style="text-align:left;">
Function
</th>
<th style="text-align:left;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
VPCgraph
</td>
<td style="text-align:left;">
draw the original VPC plot
</td>
</tr>
<tr>
<td style="text-align:left;">
aqrVPC
</td>
<td style="text-align:left;">
draw the additive quantile regression VPC plot
</td>
</tr>
<tr>
<td style="text-align:left;">
bootVPC
</td>
<td style="text-align:left;">
draw the bootstrap VPC plot
</td>
</tr>
<tr>
<td style="text-align:left;">
asVPC
</td>
<td style="text-align:left;">
draw VPC using ASH method
</td>
</tr>
<tr>
<td style="text-align:left;">
NujmericalCheck
</td>
<td style="text-align:left;">
calculate the numbers to check coverage in each prediction level
</td>
</tr>
<tr>
<td style="text-align:left;">
coverageplot
</td>
<td style="text-align:left;">
plot the result of NumericalCheck
</td>
</tr>
<tr>
<td style="text-align:left;">
coverageDetailplot
</td>
<td style="text-align:left;">
plot for checking specific prediction level
</td>
</tr>
<tr>
<td style="text-align:left;">
quantVPC
</td>
<td style="text-align:left;">
plot for the quantified VPC
</td>
</tr>
</tbody>
</table>
</div>
<div class="layout-chunk" data-layout="l-body">
<table>
<caption>
<span id="tab:table2">Table 2: </span>Summary of the arguments of functions in nlmeVPC
</caption>
<thead>
<tr>
<th style="text-align:left;">
Argument
</th>
<th style="text-align:left;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
orig_data
</td>
<td style="text-align:left;">
A data frame of original data with X and Y variable
</td>
</tr>
<tr>
<td style="text-align:left;">
sim_data
</td>
<td style="text-align:left;">
A matrix of simulated data with only Y values collected
</td>
</tr>
<tr>
<td style="text-align:left;">
type
</td>
<td style="text-align:left;">
Type of VPC graph; ‘CI’, ‘percentile’, or ‘scatter’
</td>
</tr>
<tr>
<td style="text-align:left;">
weight_method
</td>
<td style="text-align:left;">
The way to put weights in <code>asVPC</code>; ‘bin’ or ‘distance’
</td>
</tr>
<tr>
<td style="text-align:left;">
N_xbin
</td>
<td style="text-align:left;">
Number of bins in X variable
</td>
</tr>
<tr>
<td style="text-align:left;">
probs
</td>
<td style="text-align:left;">
A numeric vector of probabilities
</td>
</tr>
<tr>
<td style="text-align:left;">
conf.level
</td>
<td style="text-align:left;">
Confidence level of the interval
</td>
</tr>
<tr>
<td style="text-align:left;">
X_name
</td>
<td style="text-align:left;">
Name of X variable in<code>orig_data</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Y_name
</td>
<td style="text-align:left;">
Name of Y variable in <code>orig_data</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
subject_name
</td>
<td style="text-align:left;">
Name of subject variable in <code>orig_data</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
MissingDV
</td>
<td style="text-align:left;">
Name of missing indicator variable in <code>orig_data</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
DV_point
</td>
<td style="text-align:left;">
Draw point (X, Y) in the plot if TRUE; omit if FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
CIvpc_type
</td>
<td style="text-align:left;">
Type of CI area in VPC graph; ‘line’ or ‘segment’
</td>
</tr>
<tr>
<td style="text-align:left;">
bin_grid
</td>
<td style="text-align:left;">
Draw grid lines for binning in X variable if TRUE; omit if FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
plot_caption
</td>
<td style="text-align:left;">
Put caption with additional information if TRUE; omit if FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
plot_flag
</td>
<td style="text-align:left;">
Draw plot if TRUE; generate data for drawing plot if FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
linesize
</td>
<td style="text-align:left;">
Size of line in the plot
</td>
</tr>
<tr>
<td style="text-align:left;">
pointsize
</td>
<td style="text-align:left;">
Size of point in the plot
</td>
</tr>
<tr>
<td style="text-align:left;">
captionsize
</td>
<td style="text-align:left;">
Size of caption
</td>
</tr>
<tr>
<td style="text-align:left;">
maxK
</td>
<td style="text-align:left;">
The maximum number of bins
</td>
</tr>
<tr>
<td style="text-align:left;">
Kmethod
</td>
<td style="text-align:left;">
The way to calculate the penalty in automatic binning; ‘cluster’ or ‘kernel’
</td>
</tr>
<tr>
<td style="text-align:left;">
beta
</td>
<td style="text-align:left;">
Additional parameter for automatic binning, used in <code>optK</code> function
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda
</td>
<td style="text-align:left;">
Additional parameter for automatic binning, used in <code>optK</code> function
</td>
</tr>
</tbody>
</table>
</div>
<h2 data-number="5" id="the-nlmevpc-package-structure-and-functionality"><span class="header-section-number">5</span> The nlmeVPC package: structure and functionality</h2>
<p>Table <a href="#tab:table1">1</a> shows the list of functions and Table <a href="#tab:table2">2</a> shows the list of arguments used in the functions of <a href="#">nlmeVPC</a>. The following codes are for Figure <a href="#fig:Fig0">1</a> to Figure <a href="#fig:Fig5">6</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>nlmeVPC</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>origdata</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>simdata</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/optK.html'>optK</a></span><span class='op'>(</span><span class='va'>origdata</span><span class='op'>$</span><span class='va'>TIME</span><span class='op'>)</span><span class='op'>$</span><span class='va'>K</span></span></code></pre>
</div>
<pre><code>[1] 8</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Figure 1</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/VPCgraph.html'>VPCgraph</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span>,type<span class='op'>=</span><span class='st'>"scatter"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"(A) Visual Predictive Check : scatter"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/VPCgraph.html'>VPCgraph</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span>,type<span class='op'>=</span><span class='st'>"percentile"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"(B) Visual Predictive Check : percentile"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/VPCgraph.html'>VPCgraph</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span>,type<span class='op'>=</span><span class='st'>"CI"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"(C) Visual Predictive Check : CI"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='co'># Figure 2</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/aqrVPC.html'>aqrVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span><span class='op'>)</span> <span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Figure 3</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/bootVPC.html'>bootVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span> </span>
<span><span class='co'># Figure 4</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/asVPC.html'>asVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span>,type<span class='op'>=</span><span class='st'>"CI"</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span>,N_hist<span class='op'>=</span><span class='fl'>3</span>,weight_method<span class='op'>=</span><span class='st'>"bin"</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/asVPC.html'>asVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span>,type<span class='op'>=</span><span class='st'>"CI"</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span>,N_hist<span class='op'>=</span><span class='fl'>3</span>,weight_method<span class='op'>=</span><span class='st'>"distance"</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='co'># Numerical Predictive Check</span></span>
<span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/NumericalCheck.html'>NumericalCheck</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span>,pred.level<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0.2</span>,<span class='fl'>0.4</span>,<span class='fl'>0.6</span>,<span class='fl'>0.8</span>,<span class='fl'>0.9</span><span class='op'>)</span><span class='op'>)</span><span class='op'>$</span><span class='va'>NPC</span></span>
<span></span>
<span><span class='co'># Figure 5</span></span>
<span> </span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/coverageplot.html'>coverageplot</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span> <span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"(A) Coverage Plot"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/coverageDetailplot.html'>coverageDetailplot</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span>,predL<span class='op'>=</span><span class='fl'>0.8</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"(B) Coverage Detailed plot: PI = 80"</span><span class='op'>)</span></span>
<span> </span>
<span><span class='co'># Figure 6</span></span>
<span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/quantVPC.html'>quantVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We use an example to show how to use functions in <a href="#">nlmeVPC</a> and how they work.</p>
<h3 data-number="5.1" id="example"><span class="header-section-number">5.1</span> Example</h3>
<p>The <code>origdata</code> in <a href="#">nlmeVPC</a> is from an experiment on the pharmacokinetics of theophylline. Twelve patients were given oral doses of theophylline, and blood concentrations were measured at 11 time points over the next 25 hours. Each patient had different time points.
We consider the following first-order absorption one-compartment model:</p>
<p><span class="math display">\[
y_{ij}= \frac{Amt_i * Ke_i *Ka_i}{Cl_i} \left(\exp( -Ke_i * TIME_{ij})-\exp(-Ka_i * TIME_{ij})\right) +\varepsilon_{ij}.
\]</span></p>
<p>In this model, <span class="math inline">\(y_{ij}\)</span> is the theophylline concentration at <span class="math inline">\(TIME_{ij}\)</span> after an initial dose of <span class="math inline">\(Amt_i\)</span>. The pharmacokinetic parameters are the absorption rate constant <span class="math inline">\(Ka\)</span>, the elimination rate constant <span class="math inline">\(Ke\)</span>, and the clearance <span class="math inline">\(Cl\)</span>.
In this example, two different models are fitted and diagnosed using functions in the <a href="#">nlmeVPC</a> package. In Model 1, <span class="math inline">\(Ka\)</span> and <span class="math inline">\(Cl\)</span> are considered as random effects. In Model 2, <span class="math inline">\(Ke\)</span> is considered as random effect, and <span class="math inline">\(Ka\)</span> and <span class="math inline">\(Cl\)</span> are considered only as a fixed effect. The <a href="https://cran.r-project.org/package=nlme">nlme</a> <span class="citation" data-cites="nlme">(<a href="#ref-nlme" role="doc-biblioref">Pinheiro et al. 2022</a>)</span> and <a href="https://cran.r-project.org/package=nlraa">nlraa</a> <span class="citation" data-cites="nlraa">(<a href="#ref-nlraa" role="doc-biblioref">Miguez 2022</a>)</span> packages are used to fit the nonlinear mixed models and to generate the simulated data from the fitted model.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://svn.r-project.org/R-packages/trunk/nlme/'>nlme</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>nlraa</span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>nlmeVPC</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>origdata</span><span class='op'>)</span></span>
<span><span class='va'>origdataT</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nlme/man/groupedData.html'>groupedData</a></span><span class='op'>(</span><span class='va'>DV</span><span class='op'>~</span><span class='va'>TIME</span><span class='op'>|</span><span class='va'>ID</span>,<span class='va'>origdata</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Model 1 (True) </span></span>
<span><span class='va'>T.nlme</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nlme/man/nlme.html'>nlme</a></span><span class='op'>(</span><span class='va'>DV</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lKe</span><span class='op'>+</span><span class='va'>lKa</span><span class='op'>-</span><span class='va'>lCl</span><span class='op'>)</span><span class='op'>*</span><span class='va'>AMT</span><span class='op'>*</span></span>
<span>               <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lKe</span><span class='op'>)</span><span class='op'>*</span><span class='va'>TIME</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lKa</span><span class='op'>)</span><span class='op'>*</span><span class='va'>TIME</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span></span>
<span>               <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lKa</span><span class='op'>)</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lKe</span><span class='op'>)</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>origdataT</span>,</span>
<span>             fixed<span class='op'>=</span><span class='va'>lKa</span><span class='op'>+</span><span class='va'>lKe</span><span class='op'>+</span><span class='va'>lCl</span><span class='op'>~</span><span class='fl'>1</span>,</span>
<span>             random<span class='op'>=</span><span class='va'>lKa</span><span class='op'>+</span><span class='va'>lCl</span><span class='op'>~</span><span class='fl'>1</span>,</span>
<span>             start<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>lKe<span class='op'>=</span><span class='op'>-</span><span class='fl'>2</span>,lKa<span class='op'>=</span><span class='fl'>1.5</span>,lCl<span class='op'>=</span><span class='op'>-</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123456</span><span class='op'>)</span></span>
<span><span class='va'>sim.T</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nlraa/man/simulate_nlme.html'>simulate_nlme</a></span><span class='op'>(</span>object<span class='op'>=</span><span class='va'>T.nlme</span>,nsim<span class='op'>=</span><span class='fl'>100</span>,psim<span class='op'>=</span><span class='fl'>3</span>,level<span class='op'>=</span><span class='fl'>1</span>,value<span class='op'>=</span><span class='st'>"data.frame"</span>,data <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span></span>
<span><span class='va'>simdata.T</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>sim.T</span><span class='op'>$</span><span class='va'>sim.y</span>,ncol<span class='op'>=</span><span class='fl'>100</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Model 2 (Wrong)</span></span>
<span><span class='va'>F.nlme</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nlme/man/nlme.html'>nlme</a></span><span class='op'>(</span><span class='va'>DV</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lKe</span><span class='op'>+</span><span class='va'>lKa</span><span class='op'>-</span><span class='va'>lCl</span><span class='op'>)</span><span class='op'>*</span><span class='va'>AMT</span><span class='op'>*</span></span>
<span>                <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lKe</span><span class='op'>)</span><span class='op'>*</span><span class='va'>TIME</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lKa</span><span class='op'>)</span><span class='op'>*</span><span class='va'>TIME</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span></span>
<span>                <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lKa</span><span class='op'>)</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>lKe</span><span class='op'>)</span><span class='op'>)</span>, data<span class='op'>=</span><span class='va'>origdataT</span>,</span>
<span>              fixed<span class='op'>=</span><span class='va'>lKa</span><span class='op'>+</span><span class='va'>lKe</span><span class='op'>+</span><span class='va'>lCl</span><span class='op'>~</span><span class='fl'>1</span>,</span>
<span>              random<span class='op'>=</span><span class='va'>lKe</span><span class='op'>~</span><span class='fl'>1</span>,</span>
<span>              start<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>lKe<span class='op'>=</span><span class='op'>-</span><span class='fl'>2</span>,lKa<span class='op'>=</span><span class='fl'>1.5</span>,lCl<span class='op'>=</span><span class='op'>-</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>sim.F</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nlraa/man/simulate_nlme.html'>simulate_nlme</a></span><span class='op'>(</span>object<span class='op'>=</span><span class='va'>F.nlme</span>,nsim<span class='op'>=</span><span class='fl'>100</span>,psim<span class='op'>=</span><span class='fl'>3</span>,level<span class='op'>=</span><span class='fl'>1</span>,value<span class='op'>=</span><span class='st'>"data.frame"</span>,data <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span></span>
<span><span class='va'>simdata.F</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>sim.F</span><span class='op'>$</span><span class='va'>sim.y</span>,ncol<span class='op'>=</span><span class='fl'>100</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Figure 7</span></span>
<span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/VPCgraph.html'>VPCgraph</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.T</span>,type<span class='op'>=</span><span class='st'>"CI"</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 1"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/VPCgraph.html'>VPCgraph</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.F</span>,type<span class='op'>=</span><span class='st'>"CI"</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 2"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='co'># Figure 8</span></span>
<span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/aqrVPC.html'>aqrVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.T</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 1"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/aqrVPC.html'>aqrVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.F</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 2"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='co'># Figure 9</span></span>
<span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/asVPC.html'>asVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.T</span>,type<span class='op'>=</span><span class='st'>"CI"</span>,weight_method<span class='op'>=</span><span class='st'>"distance"</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 1"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/asVPC.html'>asVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.F</span>,type<span class='op'>=</span><span class='st'>"CI"</span>,weight_method<span class='op'>=</span><span class='st'>"distance"</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 2"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Figure 10</span></span>
<span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/bootVPC.html'>bootVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.T</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 1"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/bootVPC.html'>bootVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.F</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 2"</span>,caption<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='co'># Figure 11</span></span>
<span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/coverageplot.html'>coverageplot</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.T</span>,conf.level<span class='op'>=</span><span class='fl'>0.9</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 1"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/coverageplot.html'>coverageplot</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.F</span>,conf.level<span class='op'>=</span><span class='fl'>0.9</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 2"</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='co'># Figure 12</span></span>
<span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/coverageDetailplot.html'>coverageDetailplot</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.T</span>,predL<span class='op'>=</span><span class='fl'>0.5</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 1"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/coverageDetailplot.html'>coverageDetailplot</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.F</span>,predL<span class='op'>=</span><span class='fl'>0.5</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 2"</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='co'># Figure 13</span></span>
<span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/coverageDetailplot.html'>coverageDetailplot</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.T</span>,predL<span class='op'>=</span><span class='fl'>0.8</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 1"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/coverageDetailplot.html'>coverageDetailplot</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.F</span>,predL<span class='op'>=</span><span class='fl'>0.8</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 2"</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='co'># Figure 14</span></span>
<span> </span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/quantVPC.html'>quantVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.T</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 1"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/nlmeVPC/man/quantVPC.html'>quantVPC</a></span><span class='op'>(</span><span class='va'>origdata</span>,<span class='va'>simdata.F</span>,N_xbin<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title<span class='op'>=</span><span class='st'>"Model 2"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Figure <a href="#fig:M11">7</a> shows the <code>VPCgraph</code> for Model 1 and Model 2.
The solid line represents the 50<span class="math inline">\(^{th}\)</span> percentile of the observed data, and the dashed lines represent the 10<span class="math inline">\(^{th}\)</span> and 90<span class="math inline">\(^{th}\)</span> percentiles of the observed data. In Model 1, all quantile lines (the solid and dashed lines) are in the confidence area. However, the 10<span class="math inline">\(^{th}\)</span> and 90<span class="math inline">\(^{th}\)</span> percentiles in Model 2 are mostly outside the confidence area, especially at 0 to 5 hours.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:M11"></span>
<img src="RJ-2023-026_files/figure-html5/M11-1.png" alt="The VPC plots of Model 1 and Model 2." width="100%" />
<p class="caption">
Figure 7: The VPC plots of Model 1 and Model 2.
</p>
</div>
</div>
<p>Figure <a href="#fig:M12">8</a> shows the results of <code>aqrVPC</code>, and Figure <a href="#fig:M13">9</a> shows the results of <code>asVPC</code> for Model 1 and Model 2. The additive quantile regression VPCs and the average shifted VPCs show similar patterns to the original VPCs. Model 1 shows all quantile lines in the confidence area, and the 10<span class="math inline">\(^{th}\)</span> and 90<span class="math inline">\(^{th}\)</span> percentiles in Model 2 are mostly outside the confidence area.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:M12"></span>
<img src="RJ-2023-026_files/figure-html5/M12-1.png" alt="The additive quantile regression VPC plots for Model 1 and Model 2." width="100%" />
<p class="caption">
Figure 8: The additive quantile regression VPC plots for Model 1 and Model 2.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:M13"></span>
<img src="RJ-2023-026_files/figure-html5/M13-1.png" alt="The average shifted VPC plots for Model 1 and Model 2." width="100%" />
<p class="caption">
Figure 9: The average shifted VPC plots for Model 1 and Model 2.
</p>
</div>
</div>
<p>Figure <a href="#fig:M14">10</a> shows the results of <code>bootVPC</code> for Model 1 and Model 2. The solid and dashed blue lines show the <span class="math inline">\(10^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, and <span class="math inline">\(90^{th}\)</span> percentiles of the simulated data. The solid red line represents the <span class="math inline">\(50^{th}\)</span> percentile line of the observed data, and the pink areas represent the 95<span class="math inline">\(\%\)</span> confidence areas of the <span class="math inline">\(50^{th}\)</span> percentile line, calculated from the bootstrap samples of the observed data.
The solid blue line is in the pink area, and the two solid red and blue lines are almost identical in both models.
The dashed blue lines in Model 1 cover most of the observed data. However, the dashed blue lines in Model 2 do not cover the observed data. Many observed data points lie outside these dashed blue lines in Model 2, especially in 0 to 10 hours.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:M14"></span>
<img src="RJ-2023-026_files/figure-html5/M14-1.png" alt="The bootstrap VPC plots for Model 1 and Model 2." width="100%" />
<p class="caption">
Figure 10: The bootstrap VPC plots for Model 1 and Model 2.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:M15"></span>
<img src="RJ-2023-026_files/figure-html5/M15-1.png" alt="The coverage plots for Model 1 and Model 2." width="100%" />
<p class="caption">
Figure 11: The coverage plots for Model 1 and Model 2.
</p>
</div>
</div>
<p>Figure <a href="#fig:M15">11</a> shows the <code>coverageplot</code> results for Model 1 and Model 2. The lines are in the gray area and close to the white line in Model 1. However, the lines in Model 2 are not in the gray area, especially when the PI value is large. Figures <a href="#fig:M16">12</a> and <a href="#fig:M17">13</a> show the results of <code>coverageDetailplot</code> for Model 1 and Model 2 when PIs are 50<span class="math inline">\(\%\)</span> and 80<span class="math inline">\(\%\)</span>.
The upper and lower percentages in both figures are close to the white points in Model 1. On the other hand, the upper percentages of the most time bins are far from the white points in Model 2, especially the time bin (3.54,5.28] when PI = 50<span class="math inline">\(\%\)</span>. When PI = 80<span class="math inline">\(\%\)</span>, most upper and lower percentages are far from the white points.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:M16"></span>
<img src="RJ-2023-026_files/figure-html5/M16-1.png" alt="The coverage detailed plots for Model 1 and Model 2 when PI=50\%." width="100%" />
<p class="caption">
Figure 12: The coverage detailed plots for Model 1 and Model 2 when PI=50%.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:M17"></span>
<img src="RJ-2023-026_files/figure-html5/M17-1.png" alt="The coverage detailed plots for Model 1 and Model 2 when PI=80\%." width="100%" />
<p class="caption">
Figure 13: The coverage detailed plots for Model 1 and Model 2 when PI=80%.
</p>
</div>
</div>
<p>Figure <a href="#fig:M18">14</a> shows the results of <code>quantVPC</code> for Model 1 and Model 2. In Model 2, the right tail area (after 11 hours) looks quite different from the expected pattern. The above percentages are much larger than the below percentages.</p>
<p>The results from Figure <a href="#fig:M11">7</a> through Figure <a href="#fig:M18">14</a> show that Model 1 explains the <code>origdata</code> quite well. However, Model 2 shows different patterns than Model 1 in most figures. We can conclude that Model 1 is better than Model 2, and treating <span class="math inline">\(Ka\)</span> and <span class="math inline">\(Cl\)</span> as random effects is better.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:M18"></span>
<img src="RJ-2023-026_files/figure-html5/M18-1.png" alt="The quantified VPC plots for Model 1 and Model 2." width="100%" />
<p class="caption">
Figure 14: The quantified VPC plots for Model 1 and Model 2.
</p>
</div>
</div>
<h2 data-number="6" id="summary"><span class="header-section-number">6</span> Summary</h2>
<p>This paper introduces the <a href="#">nlmeVPC</a> package. The VPC and its extensions are useful for validating the nonlinear mixed effect model. The <a href="#">nlmeVPC</a> package provides various visual diagnostic tools for the nonlinear mixed effect model in two different approaches: validation in data space and model space. Both approaches are valuable. Validation in data space can compare the fitted model with the original data, and validation in model space provides detailed comparisons in various ways. In the <a href="#">nlmeVPC</a> package, we also provide new approaches - <code>asVPC</code> and <code>coverageDetailplot</code>. Here, <code>asVPC</code> provides a more precise VPC plot, and <code>coverageDetailplot</code> provides the detailed feature of the fitted model that is not captured in the coverage plot. Even though the coverage plot does not show any problem with the fitted model, the coverage detailed plot can reveal the problem in a specific region (Figures <a href="#fig:M14">10</a>, <a href="#fig:M15">11</a>, and <a href="#fig:M16">12</a>).</p>
<h2 data-number="7" id="acknowledgements"><span class="header-section-number">7</span> Acknowledgements</h2>
<p>This work was supported by the National Research Foundation of Korea(NRF) grant funded by the Korea government(MSIT) (2018R1A2B6001251). This paper was prepared by extracting part of Eun-Hwa Kang and Myungji Ko’s master thesis.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h3 class="appendix" data-number="7.1" id="cran-packages-used"><span class="header-section-number">7.1</span> CRAN packages used</h3>
<p><a href="https://cran.r-project.org/package=nlmeVPC">nlmeVPC</a>, <a href="https://cran.r-project.org/package=xpose4">xpose4</a>, <a href="https://cran.r-project.org/package=vpc">vpc</a>, <a href="https://cran.r-project.org/package=nlmixr2">nlmixr2</a>, <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a>, <a href="https://cran.r-project.org/package=quantreg">quantreg</a>, <a href="https://cran.r-project.org/package=nlme">nlme</a>, <a href="https://cran.r-project.org/package=nlraa">nlraa</a></p>
<h3 class="appendix" data-number="7.2" id="cran-task-views-implied-by-cited-packages"><span class="header-section-number">7.2</span> CRAN Task Views implied by cited packages</h3>
<p><a href="https://cran.r-project.org/view=Agriculture">Agriculture</a>, <a href="https://cran.r-project.org/view=ChemPhys">ChemPhys</a>, <a href="https://cran.r-project.org/view=DifferentialEquations">DifferentialEquations</a>, <a href="https://cran.r-project.org/view=Econometrics">Econometrics</a>, <a href="https://cran.r-project.org/view=Environmetrics">Environmetrics</a>, <a href="https://cran.r-project.org/view=Finance">Finance</a>, <a href="https://cran.r-project.org/view=HighPerformanceComputing">HighPerformanceComputing</a>, <a href="https://cran.r-project.org/view=MixedModels">MixedModels</a>, <a href="https://cran.r-project.org/view=OfficialStatistics">OfficialStatistics</a>, <a href="https://cran.r-project.org/view=Optimization">Optimization</a>, <a href="https://cran.r-project.org/view=Pharmacokinetics">Pharmacokinetics</a>, <a href="https://cran.r-project.org/view=Phylogenetics">Phylogenetics</a>, <a href="https://cran.r-project.org/view=Psychometrics">Psychometrics</a>, <a href="https://cran.r-project.org/view=ReproducibleResearch">ReproducibleResearch</a>, <a href="https://cran.r-project.org/view=Robust">Robust</a>, <a href="https://cran.r-project.org/view=Spatial">Spatial</a>, <a href="https://cran.r-project.org/view=SpatioTemporal">SpatioTemporal</a>, <a href="https://cran.r-project.org/view=Survival">Survival</a>, <a href="https://cran.r-project.org/view=TeachingStatistics">TeachingStatistics</a></p>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-bauer2011nonmem" class="csl-entry" role="listitem">
R. J. Bauer. NONMEM users guide introduction to NONMEM 7.2.0. <em>ICON Development Solutions Ellicott City, MD</em>, 2011. URL <a href="https://www.iconplc.com/innovation/nonmem/">https://www.iconplc.com/innovation/nonmem/</a>.
</div>
<div id="ref-davidian2017nonlinear" class="csl-entry" role="listitem">
M. Davidian. <em>Nonlinear models for repeated measurement data.</em> Routledge, 2017.
</div>
<div id="ref-fidler2019nonlinear" class="csl-entry" role="listitem">
M. Fidler, J. J. Wilkins, R. Hooijmaijers, T. M. Post, R. Schoemaker, M. N. Trame, Y. Xiong and W. Wang. Nonlinear mixed-effects model development and simulation using nlmixr and related r open-source packages. <em>CPT: pharmacometrics &amp; systems pharmacology</em>, 8(9): 621–633, 2019. URL <a href="https://doi.org/10.1002/psp4.12445">https://doi.org/10.1002/psp4.12445</a>.
</div>
<div id="ref-heus2022model" class="csl-entry" role="listitem">
A. Heus, D. W. Uster, V. Grootaert, N. Vermeulen, A. Somers, D. H. In’t Veld, S. G. Wicha and P. A. De Cock. Model-informed precision dosing of vancomycin via continuous infusion: A clinical fit-for-purpose evaluation of published PK models. <em>International Journal of Antimicrobial Agents</em>, 59(5): 106579, 2022. URL <a href="https://doi.org/10.1016/j.ijantimicag.2022.106579">https://doi.org/10.1016/j.ijantimicag.2022.106579</a>.
</div>
<div id="ref-jamsen2018regression" class="csl-entry" role="listitem">
K. M. Jamsen, K. Patel, K. Nieforth and C. M. Kirkpatrick. A regression approach to visual predictive checks for population pharmacometric models. <em>CPT: pharmacometrics &amp; systems pharmacology</em>, 7(10): 678–686, 2018. URL <a href="https://doi.org/10.1002/psp4.12319">https://doi.org/10.1002/psp4.12319</a>.
</div>
<div id="ref-karlsson2008tutorial" class="csl-entry" role="listitem">
M. O. Karlsson and N. Holford. A tutorial on visual predictive checks. In <em>17th meeting of the population approach group in europe, marseille, france, page abstr</em>, 2008. URL <a href="https://www.page-meeting.org/?abstract=1434">https://www.page-meeting.org/?abstract=1434</a>.
</div>
<div id="ref-karlsson2007diagnosing" class="csl-entry" role="listitem">
M. Karlsson and R. Savic. Diagnosing model diagnostics. <em>Clinical Pharmacology &amp; Therapeutics</em>, 82(1): 17–20, 2007. URL <a href="https://doi.org/10.1038/sj.clpt.6100241">https://doi.org/10.1038/sj.clpt.6100241</a>.
</div>
<div id="ref-keizer2018vpc" class="csl-entry" role="listitem">
R. Keizer. Vpc: Create visual predictive checks. R package version 1.2.2. 2021. URL <a href="https://cran.r-project.org/web/packages/vpc/index.html">https://cran.r-project.org/web/packages/vpc/index.html</a>.
</div>
<div id="ref-keizer2013modeling" class="csl-entry" role="listitem">
R. J. Keizer, M. Karlsson and A. Hooker. Modeling and simulation workbench for NONMEM: Tutorial on pirana, PsN, and xpose. <em>CPT: pharmacometrics &amp; systems pharmacology</em>, 2(6): 1–9, 2013. URL <a href="https://doi.org/10.1038/psp.2013.24">https://doi.org/10.1038/psp.2013.24</a>.
</div>
<div id="ref-quantreg" class="csl-entry" role="listitem">
R. Koenker. Quantreg: Quantile regression. R package version 5.95. 2023. URL <a href="https://cran.r-project.org/web/packages/quantreg/index.html">https://cran.r-project.org/web/packages/quantreg/index.html</a>.
</div>
<div id="ref-lavielle2011automatic" class="csl-entry" role="listitem">
M. Lavielle and K. Bleakley. Automatic data binning for improved visual diagnosis of pharmacometric models. <em>Journal of pharmacokinetics and pharmacodynamics</em>, 38(6): 861–871, 2011. URL <a href="https://doi.org/10.1007/s10928-011-9223-3">https://doi.org/10.1007/s10928-011-9223-3</a>.
</div>
<div id="ref-lindbom2004perl" class="csl-entry" role="listitem">
L. Lindbom, J. Ribbing and E. N. Jonsson. Perl-speaks-NONMEM (PsN)—a perl module for NONMEM related programming. <em>Computer methods and programs in biomedicine</em>, 75(2): 85–94, 2004. URL <a href="https://doi.org/10.1016/j.cmpb.2003.11.003">https://doi.org/10.1016/j.cmpb.2003.11.003</a>.
</div>
<div id="ref-maharaj2019pitfalls" class="csl-entry" role="listitem">
A. R. Maharaj, H. Wu, C. P. Hornik and M. Cohen-Wolkowiez. Pitfalls of using numerical predictive checks for population physiologically-based pharmacokinetic model evaluation. <em>Journal of pharmacokinetics and pharmacodynamics</em>, 46(3): 263–272, 2019. URL <a href="https://doi.org/10.1007/s10928-019-09636-5">https://doi.org/10.1007/s10928-019-09636-5</a>.
</div>
<div id="ref-nlraa" class="csl-entry" role="listitem">
F. Miguez. Nlraa: Nonlinear regression for agricultural applications. R package version 1.5. 2022. URL <a href="https://cran.r-project.org/web/packages/nlraa/index.html">https://cran.r-project.org/web/packages/nlraa/index.html</a>.
</div>
<div id="ref-mudde2022predictive" class="csl-entry" role="listitem">
S. E. Mudde, R. Ayoun Alsoud, A. van der Meijden, A. M. Upton, M. U. Lotlikar, U. S. Simonsson, H. I. Bax and J. E. de Steenwinkel. Predictive modeling to study the treatment-shortening potential of novel tuberculosis drug regimens, toward bundling of preclinical data. <em>The Journal of Infectious Diseases</em>, 225(11): 1876–1885, 2022. URL <a href="https://doi.org/10.1093/infdis/jiab101">https://doi.org/10.1093/infdis/jiab101</a>.
</div>
<div id="ref-nguyen2017model" class="csl-entry" role="listitem">
T. Nguyen, M.-S. Mouksassi, N. Holford, N. Al-Huniti, I. Freedman, A. C. Hooker, J. John, M. O. Karlsson, D. Mould, J. Pérez Ruixo, et al. Model evaluation of continuous data pharmacometric models: Metrics and graphics. <em>CPT: pharmacometrics &amp; systems pharmacology</em>, 6(2): 87–109, 2017. URL <a href="https://doi.org/10.1002/psp4.12161">https://doi.org/10.1002/psp4.12161</a>.
</div>
<div id="ref-otto2021predictive" class="csl-entry" role="listitem">
M. Otto, K. Bergmann, G. Jacobs and M. J. van Esdonk. Predictive performance of parent-metabolite population pharmacokinetic models of (s)-ketamine in healthy volunteers. <em>European journal of clinical pharmacology</em>, 77(8): 1181–1192, 2021. URL <a href="https://doi.org/10.1007/s00228-021-03104-1">https://doi.org/10.1007/s00228-021-03104-1</a>.
</div>
<div id="ref-pinheiro2006mixed" class="csl-entry" role="listitem">
J. C. Pinheiro and D. M. Bates. <em>Mixed-effects models in s and s-<span>PLUS</span>.</em> Springer New York, 2000. URL <a href="https://doi.org/10.1007/978-1-4419-0318-1">https://doi.org/10.1007/978-1-4419-0318-1</a>.
</div>
<div id="ref-nlme" class="csl-entry" role="listitem">
J. Pinheiro, D. Bates, S. DebRoy, D. Sarkar, S. Heisterkamp, B. Van Willigen and R. Maintainer. Nlme: Linear and nonlinear mixed effects models. R package version 3.1-159. 2022. URL <a href="https://cran.r-project.org/web/packages/nlme/index.html">https://cran.r-project.org/web/packages/nlme/index.html</a>.
</div>
<div id="ref-post2008extensions" class="csl-entry" role="listitem">
T. M. Post, J. I. Freijer, B. A. Ploeger and M. Danhof. Extensions to the visual predictive check to facilitate model performance evaluation. <em>Journal of pharmacokinetics and pharmacodynamics</em>, 35(2): 185–202, 2008. URL <a href="https://doi.org/10.1007/s10928-007-9081-1">https://doi.org/10.1007/s10928-007-9081-1</a>.
</div>
<div id="ref-R" class="csl-entry" role="listitem">
R Core Team. R: A language and environment for statistical computing. 2023. URL <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-scott1985ash" class="csl-entry" role="listitem">
D. W. Scott. Average shifted histograms: Effective nonparametric density estimations in several dimensions. <em>Annals of Statistics</em>, 13(3): 1024–1040, 1985. URL <a href="https://doi.org/10.1214/aos/1176349654">https://doi.org/10.1214/aos/1176349654</a>.
</div>
<div id="ref-wang2012standardized" class="csl-entry" role="listitem">
D. D. Wang and S. Zhang. Standardized visual predictive check versus visual predictive check for model evaluation. <em>The Journal of Clinical Pharmacology</em>, 52(1): 39–54, 2012. URL <a href="https://doi.org/10.1177/0091270010390040">https://doi.org/10.1177/0091270010390040</a>.
</div>
<div id="ref-ggplot2Hadley2nd" class="csl-entry" role="listitem">
H. Wickham. <em>ggplot2 : Elegance graphics for data analysis.</em> Springer, 2016.
</div>
<div id="ref-wickham2015visualizing" class="csl-entry" role="listitem">
H. Wickham, D. Cook and H. Hofmann. Visualizing statistical models: Removing the blindfold. <em>Statistical Analysis and Data Mining: The ASA Data Science Journal</em>, 8(4): 203–225, 2015. URL <a href="https://doi.org/10.1002/sam.11271">https://doi.org/10.1002/sam.11271</a>.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Kang, et al., "nlmeVPC: Visual Model Diagnosis for the Nonlinear Mixed Effect Model", The R Journal, 2023</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2023-026,
  author = {Kang, Eun-Hwa and Ko, Myungji and Lee, Eun-Kyung},
  title = {nlmeVPC: Visual Model Diagnosis for the Nonlinear Mixed Effect Model},
  journal = {The R Journal},
  year = {2023},
  note = {https://doi.org/10.32614/RJ-2023-026},
  doi = {10.32614/RJ-2023-026},
  volume = {15},
  issue = {1},
  issn = {2073-4859},
  pages = {83-100}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
